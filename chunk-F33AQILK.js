import{b as Se,c as st,e as Dt,f as R,g as Me,h as be,j as De,k as at,l as ke,m as ze,n as W,o as Pe,p as kt,q as Re,r as Ze,s as Ie,t as Ve,w as zt,x as Pt,y as Ce}from"./chunk-SSPYZF7P.js";import{a as Ae}from"./chunk-XX3XW27Y.js";import{a as B}from"./chunk-EXNBPOL5.js";import{a as Te}from"./chunk-AT3LJJPR.js";import{b as xe}from"./chunk-6GAANBZQ.js";import{a as u,c as ye,d as bt}from"./chunk-4JIR4MZV.js";import{a as Mt}from"./chunk-PGB3OOVZ.js";import{a as le,b as ce,c as z,f as me,i as de,p as ue,q as fe,r as Tt,s as ve,u as ge,v as St,w as _e,y as we}from"./chunk-BC7GBJHB.js";import{a as k}from"./chunk-EBLTZITF.js";import{c as ae}from"./chunk-XLL67PCY.js";import{a as q}from"./chunk-MCO7DSFO.js";import{a as ot}from"./chunk-EM35R6FY.js";import{a as ne,b as re,d as pe,i as he}from"./chunk-QXXXCEV5.js";import{g as it}from"./chunk-DA3SDKGO.js";import{h as se}from"./chunk-RNC4P66O.js";import{c as oe}from"./chunk-7LHOQXZT.js";import{a as O}from"./chunk-K75TK42V.js";import{d as D}from"./chunk-OLOKUDVI.js";import{a as ie}from"./chunk-PIHANKUA.js";import{g as j,i as ee}from"./chunk-EQZWYK27.js";import{a as Xt,f as te,m as et}from"./chunk-ZQIC5NFT.js";import{a as Qt,c as _}from"./chunk-VIEK2X23.js";import{d as Yt}from"./chunk-NJWTSROP.js";import{a as Jt}from"./chunk-D3R25AF2.js";import{a as M,b as F,e as Wt,i as N,j as tt,k as $t}from"./chunk-TG45K3WR.js";import{b as xt}from"./chunk-ACP3S2CH.js";import{a as n}from"./chunk-QGVBCWUY.js";import{H as g}from"./chunk-MYO4NP2N.js";import{e as r}from"./chunk-NFIPKH6V.js";import{f as yt,l as d}from"./chunk-5QEXLALV.js";import{d as Ut}from"./chunk-BWO7LS2H.js";import{e as A}from"./chunk-HEVQSRJ2.js";import{I as Bt,b as Ft,d as U,j as jt,p as wt,w as qt}from"./chunk-4PTIEWMT.js";import{b as S}from"./chunk-YOFFGXOB.js";import{g as b}from"./chunk-XRGPJ3QY.js";import{a as Kt}from"./chunk-QBWJMFH5.js";import{a as X,b as Lt,f as Gt}from"./chunk-VTHXE323.js";var Rt,Zt,P=Rt=class extends g{constructor(){super(...arguments),this.left=0,this.top=0,this.right=0,this.bottom=0}clone(){return new Rt({left:this.left,top:this.top,right:this.right,bottom:this.bottom})}};n([r()],P.prototype,"left",void 0),n([r()],P.prototype,"top",void 0),n([r()],P.prototype,"right",void 0),n([r()],P.prototype,"bottom",void 0),P=Rt=n([d("esri.views.2d.PaddedViewState.Padding")],P);var E=Zt=class extends Mt{constructor(...e){super(...e),this.paddedViewState=new Mt,this._updateContent=(()=>{let t=ot();return()=>{let i=this._get("size"),o=this._get("padding");if(!i||!o)return;let s=this.paddedViewState;re(t,o.left+o.right,o.top+o.bottom),pe(t,i,t),ne(s.size,t);let a=s.viewpoint;a&&(this.viewpoint=a)}})(),this.addHandles(M(()=>[this.size,this.padding],()=>this._updateContent(),N)),this.padding=new P,this.size=[0,0]}set padding(e){this._set("padding",e||new P)}set viewpoint(e){if(e){this.paddedViewState.viewpoint=e;let t=e,i=this._get("padding");i&&(t=fe(e.clone(),e,this._get("size"),i));let{targetGeometry:o,rotation:s,scale:a}=t,{x:p,y:h,spatialReference:l}=o,m=this._viewpoint2D;m.center[0]=p,m.center[1]=h,m.rotation=s,m.scale=a,m.spatialReference=l,this._update()}}clone(){return new Zt({padding:this.padding.clone(),size:this.size.slice(),viewpoint:this.paddedViewState.viewpoint.clone(),pixelRatio:this.pixelRatio})}};n([r()],E.prototype,"paddedViewState",void 0),n([r({type:P})],E.prototype,"padding",null),n([r()],E.prototype,"viewpoint",null),E=Zt=n([d("esri.views.2d.PaddedViewState")],E);var H=E;var nt=class{constructor(t){this.view=t,this._stationaryHandle=null,this._frameTaskHandle=null,this._updateParameters=null,this._updateRequested=!1,this._scheduler=ae(),this._schedulerHandle=F(()=>this._scheduler.updating,()=>this.requestFrame()),this.stationary=!0,this.prepare=()=>{this._updateParameters&&(this._updateParameters.state=this.view.state,this._updateParameters.stationary=this.view.stationary,this._updateParameters.pixelRatio=window.devicePixelRatio,this._updateParameters.renderingOptions=this.view.renderingOptions,this._updateParameters.targetState.copy(this.view.state),this.view.animation?.target==null||Bt(this.view.animation.target)||(this._updateParameters.targetState.viewpoint=this.view.animation.target))},this.update=i=>{if(this._updateRequested=!1,this.view?.destroyed)return;let{allLayerViews:o,graphicsView:s,labelManager:a,state:{id:p}}=this.view;o?.forEach(this._updateLayerView,this),a!=null&&(a.lastUpdateId!==p&&(a.viewChange(),a.lastUpdateId=p),a.updateRequested&&a.processUpdate(this._updateParameters)),s!=null&&(s.lastUpdateId!==p&&(s.viewChange(),s.lastUpdateId=p),s.updateRequested&&s.processUpdate(this._updateParameters)),this.view.graphicsTileStore?.setViewState(this._updateParameters.state),this.view.animation?this._scheduler.state=q.ANIMATING:this.view.interacting?this._scheduler.state=q.INTERACTING:this._scheduler.state=q.IDLE,this._scheduler.frame(i)||this._updateRequested||this._scheduler.state!==q.IDLE||this._frameTaskHandle?.pause()}}destroy(){this.stop(),this._schedulerHandle.remove(),this._scheduler.destroy()}get scheduler(){return this._scheduler}start(){if(this._frameTaskHandle)return;let t=this.view;this.stationary=t.stationary,this._updateParameters={state:t.state,targetState:new H,pixelRatio:window.devicePixelRatio,stationary:this.stationary,renderingOptions:t.renderingOptions},this._stationaryHandle=M(()=>t.stationary,i=>{this.stationary=i,this.requestFrame()}),this._frameTaskHandle=A(this),this.requestUpdate()}stop(){this._frameTaskHandle&&(this._updateRequested=!1,this._stationaryHandle?.remove(),this._frameTaskHandle.remove(),this._updateParameters=this._stationaryHandle=this._frameTaskHandle=null,this.stationary=!0)}requestUpdate(){this._updateRequested||(this._updateRequested=!0,this.requestFrame())}requestFrame(){this._frameTaskHandle&&this._frameTaskHandle.resume()}_updateLayerView(t){if(!t.attached)return void this.requestUpdate();let i=this.view.state,o=t.lastUpdateId;o!=null&&(this.stationary||t.moving)||(t.moving=!0),o!==i.id&&t.viewChange(),this.stationary&&t.moving&&(t.moving=!1,t.moveEnd()),t.lastUpdateId=i.id,t.updateRequested&&t.processUpdate(this._updateParameters),"layerViews"in t&&t.layerViews?.forEach(this._updateLayerView,this)}};var $=class extends g{constructor(e){super(e),this._gotoTask=null}destroy(){this._gotoTask=null}goTo(e,t){return Gt(this,null,function*(){if(!e)return void b.getLogger(this).error("#goTo()","target cannot be null or undefined");let i=new B;this.view.animation=i,yield Wt(()=>this.view.ready,t);let o=Lt(X({},t),{animate:t?.animate??!Te(),animationMode:t?.animationMode??"auto"}),{extent:s,spatialReference:a,size:p,viewpoint:h,constraints:l,padding:m,allLayerViews:c}=this.view,v=ce(e,{extent:s,spatialReference:a,size:p,viewpoint:h,constraints:l,padding:m,allLayerViews:c,pickClosestTarget:t?.pickClosestTarget??!0});return i?.update(v),this._gotoTask={},o.animate?this._gotoAnimated(v,o):this._gotoImmediate(v,o)})}_gotoImmediate(e,t){let i=this._gotoTask,o=this.view.animation,s=e.then(a=>{if(wt(t),i!==this._gotoTask)throw new S("view:goto-interrupted","Goto was interrupted");this.view.viewpoint=o.target=a,o.finish()});return this._cancellableGoTo(i,o,s,t)}_gotoAnimated(e,t){let i=this._gotoTask,o=this.view.animation;if(!o)return Promise.resolve();let s=e.then(a=>{if(wt(t),i!==this._gotoTask)throw new S("view:goto-interrupted","Goto was interrupted");return o.update(a),this.view.animationManager.animate(o,this.view.viewpoint,t),o.when().then(()=>{},()=>{})});return this._cancellableGoTo(i,o,s,t)}_cancellableGoTo(e,t,i,o){let s=()=>e===this._gotoTask;return qt(i,o).finally(()=>{s()&&(t.done||t.stop())})}};n([r({constructOnly:!0})],$.prototype,"view",void 0),$=n([d("esri.views.2d.GoToManager")],$);function Ne(e,t){let{spatialReference:i}=t,o=[t.x,t.y],s,a,p,h,l=[0,0],m=Le(e);for(let x=0;x<m.length;x++){let I=m[x];for(let T=0;T<I.length-1;T++){oe(l,o,I,T);let C=he(o,l);(s==null||C<s)&&(s=C,a=[...l],p=x,h=T)}}if(s==null||!a||p==null||h==null)throw new S("nearest-coordinate:failed","Failed to find the nearest coordinate");let[c,v]=a;return{coordinate:new _({x:c,y:v,spatialReference:i}),distance:s}}function Le(e){switch(e.type){case"extent":return[[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]];case"polygon":return e.rings;case"polyline":return e.paths}}var It,Z=It=class extends O.NumericIdentifiableMixin(g){constructor(e){super(e),this.geometry=null,this.spatialReference=null}get normalizedGeometry(){if(this.geometry==null||!this.spatialReference)return null;if(!this.spatialReference.equals(this.geometry.spatialReference))try{return it(this.geometry,this.spatialReference)}catch(e){return b.getLogger(this).error("#constraints.geometry","could not project the geometry to the view's spatial reference",{geometry:this.geometry,spatialReference:this.spatialReference,error:e}),null}return this.geometry}constrain(e,t){if(this.normalizedGeometry==null)return e;let i=e.targetGeometry;if(this.normalizedGeometry.type==="extent"?Xt(this.normalizedGeometry,i):te(this.normalizedGeometry,i))return e;let{coordinate:o}=Ne(this.normalizedGeometry,i);return o&&(e.targetGeometry=o),e}clone(){return new It({geometry:this.geometry?.clone(),spatialReference:this.spatialReference?.clone()})}};n([r({constructOnly:!0})],Z.prototype,"geometry",void 0),n([r({readOnly:!0})],Z.prototype,"normalizedGeometry",null),n([r({constructOnly:!0})],Z.prototype,"spatialReference",void 0),Z=It=n([d("esri.views.2d.constraints.GeometryConstraint")],Z);var Vt,J=Vt=class extends O.NumericIdentifiableMixin(g){constructor(){super(...arguments),this.enabled=!0,this.rotationEnabled=!0}constrain(e,t){return this.enabled&&t&&(this.rotationEnabled||(e.rotation=t.rotation)),e}clone(){return new Vt({enabled:this.enabled,rotationEnabled:this.rotationEnabled})}};n([r()],J.prototype,"enabled",void 0),n([r()],J.prototype,"rotationEnabled",void 0),J=Vt=n([d("esri.views.2d.constraints.RotationConstraint")],J);var Ct=J;var At,y=At=class extends O.NumericIdentifiableMixin(g){constructor(e){super(e),this._lodByScale={},this._scales=[],this.effectiveLODs=null,this.effectiveMinZoom=-1,this.effectiveMaxZoom=-1,this.effectiveMinScale=0,this.effectiveMaxScale=0,this.lods=null,this.minZoom=-1,this.maxZoom=-1,this.minScale=0,this.maxScale=0,this.snapToZoom=!0}initialize(){let e,{lods:t,minScale:i,maxScale:o,minZoom:s,maxZoom:a}=this,p=-1,h=-1,l=!1,m=!1;if(i!==0&&o!==0&&i<o&&([i,o]=[o,i]),!t?.length)return this._set("effectiveMinScale",i),void this._set("effectiveMaxScale",o);t=t.map(c=>c.clone()),t.sort((c,v)=>v.scale-c.scale),t.forEach((c,v)=>c.level=v);for(let c of t)!l&&i>0&&i>=c.scale&&(p=c.level,l=!0),!m&&o>0&&o>=c.scale&&(h=e?e.level:-1,m=!0),e=c;s===-1&&(s=i===0?0:p),a===-1&&(a=o===0?t.length-1:h),s=Math.max(s,0),s=Math.min(s,t.length-1),a=Math.max(a,0),a=Math.min(a,t.length-1),s>a&&([s,a]=[a,s]),i=t[s].scale,o=t[a].scale,t.splice(0,s),t.splice(a-s+1,t.length),t.forEach((c,v)=>{this._lodByScale[c.scale]=c,this._scales[v]=c.scale}),this._set("effectiveLODs",t),this._set("effectiveMinZoom",s),this._set("effectiveMaxZoom",a),this._set("effectiveMinScale",i),this._set("effectiveMaxScale",o)}constrain(e,t){if(t&&e.scale===t.scale)return e;let i=this.effectiveMinScale,o=this.effectiveMaxScale,s=e.targetGeometry,a=t&&t.targetGeometry,p=o!==0&&e.scale<o,h=i!==0&&e.scale>i;if(p||h){let l=h?i:o;if(t&&a){let m=(l-t.scale)/(e.scale-t.scale);s.x=a.x+(s.x-a.x)*m,s.y=a.y+(s.y-a.y)*m}e.scale=l}return this.snapToZoom&&this.effectiveLODs&&(e.scale=this._getClosestScale(e.scale)),e}fit(e){if(!this.effectiveLODs||!this.snapToZoom)return this.constrain(e,null);let t=this.scaleToZoom(e.scale),i=Math.abs(t-Math.floor(t));return e.scale=this.zoomToScale(i>.99?Math.round(t):Math.floor(t)),e}zoomToScale(e){if(!this.effectiveLODs)return 0;e-=this.effectiveMinZoom,e=Math.max(0,e);let t=this._scales;if(e<=0)return t[0];if(e>=t.length)return t[t.length-1];let i=Math.floor(e),o=Math.ceil(e);return t[i]+(e-i)*(t[o]-t[i])}scaleToZoom(e){if(!this.effectiveLODs)return-1;let t=this._scales,i,o;if(e>=t[0])return this.effectiveMinZoom;if(e<=t[t.length-1])return this.effectiveMaxZoom;for(let s=0;s<t.length-1;s++){if(i=t[s],o=t[s+1],o===e)return s+this.effectiveMinZoom+1;if(i>e&&o<e)return s+this.effectiveMinZoom+1-(e-o)/(i-o)}return-1}snapToClosestScale(e){if(!this.effectiveLODs)return e;let t=this.scaleToZoom(e);return this.zoomToScale(Math.round(t))}snapToNextScale(e,t=.5){if(!this.effectiveLODs)return e*t;let i=Math.round(this.scaleToZoom(e));return this.zoomToScale(i+1)}snapToPreviousScale(e,t=2){if(!this.effectiveLODs)return e*t;let i=Math.round(this.scaleToZoom(e));return this.zoomToScale(i-1)}clone(){return new At({lods:this.lods,minZoom:this.minZoom,maxZoom:this.maxZoom,minScale:this.minScale,maxScale:this.maxScale})}_getClosestScale(e){return this._lodByScale[e]||(e=this._scales.reduce((t,i)=>Math.abs(i-e)<=Math.abs(t-e)?i:t,this._scales[0])),this._lodByScale[e].scale}};n([r({readOnly:!0})],y.prototype,"effectiveLODs",void 0),n([r({readOnly:!0})],y.prototype,"effectiveMinZoom",void 0),n([r({readOnly:!0})],y.prototype,"effectiveMaxZoom",void 0),n([r({readOnly:!0})],y.prototype,"effectiveMinScale",void 0),n([r({readOnly:!0})],y.prototype,"effectiveMaxScale",void 0),n([r()],y.prototype,"lods",void 0),n([r()],y.prototype,"minZoom",void 0),n([r()],y.prototype,"maxZoom",void 0),n([r()],y.prototype,"minScale",void 0),n([r()],y.prototype,"maxScale",void 0),n([r()],y.prototype,"snapToZoom",void 0),y=At=n([d("esri.views.2d.constraints.ZoomConstraint")],y);var Nt=y;var Ge={base:null,key:"type",typeMap:{extent:et,polygon:se}},f=class extends g{constructor(e){super(e),this.lods=null,this.minScale=0,this.maxScale=0,this.minZoom=-1,this.maxZoom=-1,this.rotationEnabled=!0,this.snapToZoom=!0,this.customConstraints=new xt}destroy(){this.view=null}get effectiveLODs(){return this._zoom.effectiveLODs}get effectiveMinScale(){return this._zoom.effectiveMinScale}get effectiveMaxScale(){return this._zoom.effectiveMaxScale}get effectiveMinZoom(){return this._zoom.effectiveMinZoom}get effectiveMaxZoom(){return this._zoom.effectiveMaxZoom}set geometry(e){e?this._set("geometry",e):this._set("geometry",null)}get version(){return`${this._zoom?.uid}/${this._rotation?.uid}/${this._geometry?.uid}`}get _geometry(){let e=this._get("_geometry");return e&&this.geometry===e.geometry&&this.view?.constraintsInfo.spatialReference===e.spatialReference?e:new Z({geometry:this.geometry,spatialReference:this.view?.constraintsInfo.spatialReference})}get _rotation(){return new Ct({rotationEnabled:this.rotationEnabled})}get _zoom(){let e=this._get("_zoom"),t=this.lods||this.view?.constraintsInfo.lods,i=this.minZoom,o=this.maxZoom,s=this.minScale,a=this.maxScale,p=this.snapToZoom;return e&&e.lods===t&&e.minZoom===i&&e.maxZoom===o&&e.minScale===s&&e.maxScale===a&&e.snapToZoom===p?e:new Nt({lods:t,minZoom:i,maxZoom:o,minScale:s,maxScale:a,snapToZoom:p})}canZoomInTo(e){let t=this.effectiveMaxScale;return t===0||e>=t}canZoomOutTo(e){let t=this.effectiveMinScale;return t===0||e<=t}constrain(e,t){return this._zoom.constrain(e,t),this._rotation.constrain(e,t),this._geometry.constrain(e,t),this.customConstraints.forEach(i=>i.constrain(e,t)),e}constrainByGeometry(e){return this._geometry.constrain(e),this.customConstraints.forEach(t=>t.applyPanConstraint?.(e)),e}fit(e){return this._zoom.fit(e)}zoomToScale(e){return this._zoom.zoomToScale(e)}scaleToZoom(e){return this._zoom.scaleToZoom(e)}snapScale(e){return this._zoom.snapToClosestScale(e)}snapToNextScale(e){return this._zoom.snapToNextScale(e)}snapToPreviousScale(e){return this._zoom.snapToPreviousScale(e)}};n([r({readOnly:!0})],f.prototype,"effectiveLODs",null),n([r({readOnly:!0})],f.prototype,"effectiveMinScale",null),n([r({readOnly:!0})],f.prototype,"effectiveMaxScale",null),n([r({readOnly:!0})],f.prototype,"effectiveMinZoom",null),n([r({readOnly:!0})],f.prototype,"effectiveMaxZoom",null),n([r({types:Ge,value:null})],f.prototype,"geometry",null),n([r({type:[ie]})],f.prototype,"lods",void 0),n([r()],f.prototype,"minScale",void 0),n([r()],f.prototype,"maxScale",void 0),n([r()],f.prototype,"minZoom",void 0),n([r()],f.prototype,"maxZoom",void 0),n([r()],f.prototype,"rotationEnabled",void 0),n([r()],f.prototype,"snapToZoom",void 0),n([r({type:xt})],f.prototype,"customConstraints",void 0),n([r()],f.prototype,"view",void 0),n([r({readOnly:!0})],f.prototype,"version",null),n([r({type:Z,readOnly:!0})],f.prototype,"_geometry",null),n([r({type:Ct})],f.prototype,"_rotation",null),n([r({readOnly:!0,type:Nt})],f.prototype,"_zoom",null),f=n([d("esri.views.2d.MapViewConstraints")],f);var Ot=f;var w=class extends g{constructor(e){super(e),this.constraints=null,this.ready=!1,this.resizeAlign="center",this.addHandles([M(()=>this.constraints?.version,t=>{this.constraints&&t&&this.ready&&(this.state.viewpoint=this.constraints.fit(this.state.paddedViewState.viewpoint))},N)])}get center(){if(!this.ready)return this._get("center");let{center:e,spatialReference:t}=this.state.paddedViewState;return this.state.commitProperty("id"),new _({x:e[0],y:e[1],spatialReference:t})}set center(e){if(e==null)return;if(!this.ready)return void this._set("center",e);let t;try{t=this._project(e,this.state.spatialReference)}catch(o){return void b.getLogger(this).error(new S("mapview:invalid-center","could not project the value in the view's spatial reference",{input:e,error:o}))}let i=this.viewpoint;Tt(i,i,t),this.viewpoint=i}get extent(){return this.ready?(this.state.commitProperty("id"),this.state.paddedViewState.extent.clone()):this._get("extent")}set extent(e){if(e==null)return;if(!e.width||!e.height)return void b.getLogger(this).error(new S("mapview:invalid-extent","invalid extent size"));if(!this.ready)return this._set("extent",e),this._set("center",void 0),this._set("viewpoint",void 0),this._set("scale",void 0),void this._set("zoom",void 0);let t;try{t=this._project(e,this.state.spatialReference)}catch(o){return void b.getLogger(this).error(new S("mapview:invalid-extent","could not project the value in the view's spatial reference",{error:o}))}let i=this.viewpoint;me(i,i,t,this.state.size,{constraints:this.constraints}),this.viewpoint=i}get padding(){return this.ready?this.state.padding:this._get("padding")}set padding(e){this.ready?(this.state.padding=e,this._set("padding",this.state.padding)):this._set("padding",e)}get resolution(){return this.ready?(this.state.commitProperty("id"),this.state.resolution):0}get rotation(){return this.ready?(this.state.commitProperty("id"),this.state.rotation):this._get("rotation")}set rotation(e){if(isNaN(e))return;if(!this.ready)return void this._set("rotation",e);let t=this.viewpoint;ge(t,t,e),this.viewpoint=t}get scale(){return this.ready?(this.state.commitProperty("id"),this.state.scale):this._get("scale")}set scale(e){if(!e||isNaN(e))return;if(!this.ready){this._set("scale",e),this._set("zoom",void 0);let i=this._get("extent");return void(i&&(this._set("extent",void 0),this._set("center",i.center)))}let t=this.viewpoint;St(t,t,e),this.viewpoint=t}get viewpoint(){return this.ready?this.state.paddedViewState.viewpoint.clone():this._get("viewpoint")}set viewpoint(e){if(e==null)return;if(!this.ready)return this._set("viewpoint",e),this._set("extent",void 0),this._set("center",void 0),this._set("zoom",void 0),void this._set("scale",void 0);let t,i;try{t=this._project(e,this.state.spatialReference),!e.scale||isNaN(e.scale)?i=new S("mapview:invalid-viewpoint",`invalid scale value of ${e.scale}`):e.targetGeometry==null&&(i=new S("mapview:invalid-viewpoint","geometry not defined"))}catch(s){i=new S("mapview:invalid-viewpoint","could not project the value in the view's spatial reference",{error:s})}if(i)return void b.getLogger(this).error(i);this._scaleBeforeChangingSpatialReference=null;let o=new k({targetGeometry:new _,scale:0,rotation:0});z(o,t),this.constraints?.constrain(o,this.state.paddedViewState.viewpoint),this.state.viewpoint=o,this._set("viewpoint",o)}get visibleArea(){return this.ready?this.state.visibleArea:null}get zoom(){return this.ready?this.constraints?.scaleToZoom(this.scale)??-1:this._get("zoom")}set zoom(e){if(!(e>=0))return;if(!this.ready){this._set("zoom",e),this._set("scale",void 0);let o=this._get("extent");return void(o&&(this._set("extent",void 0),this._set("center",o.center)))}let t=this.constraints?.zoomToScale(e)??0;if(!t)return void this._set("zoom",-1);let i=this.viewpoint;St(i,i,t),this.viewpoint=i,this._set("zoom",this.constraints?.scaleToZoom(this.scale)??-1)}getUserStartupOptions(e){if(!e[0]&&!e[1])return{center:void 0,rotation:void 0,scale:void 0};let{padding:t,constraints:i}=this,o=this._get("center"),s=this._get("extent"),a=this._get("scale"),p=this._get("rotation"),h=this._get("viewpoint"),l=this._get("zoom"),m=l!=null&&i!=null&&i.zoomToScale(l)||void 0,c,v,x,I=h?.rotation,T=h?.targetGeometry;T?.type==="extent"?c=T:T?.type==="point"&&(v=T,x=h?.scale);let C=s??c;return{center:o??v??C?.center,rotation:p??I,scale:(a??m??x??(C&&le(C,[e[0]-t.left-t.right,e[1]-t.top-t.bottom])))||void 0}}startup(e,t,i,o){let s=e.targetGeometry;try{this._project(e,i)}catch(a){b.getLogger(this).warn(new yt("mapview:startup-projection-error","projection of initial viewpoint to the view's spatial reference, defaulting to the initial viewpoint.",{center:s.toJSON(),spatialReference:i,error:a})),e.targetGeometry=o||new _({x:0,y:0,spatialReference:i})}this.constraints?.fit(e),this._set("state",new H({padding:this.padding,size:t,viewpoint:e})),this._set("ready",!0)}teardown(){this._set("ready",!1);let{center:[e,t],spatialReference:i,rotation:o,scale:s}=this.state.paddedViewState,a=new _({x:e,y:t,spatialReference:i});this._set("viewpoint",null),this._set("extent",null),this._set("center",a),this._set("zoom",-1),this._set("rotation",o),this._set("scale",s),this._set("state",null)}changeSpatialReference(e){let t=this.state.paddedViewState.clone();if(this._scaleBeforeChangingSpatialReference==null)this._scaleBeforeChangingSpatialReference=t.scale;else{let h=t.viewpoint.clone();h.scale=this._scaleBeforeChangingSpatialReference,t.viewpoint=h}let i=t.clone(),[o,s]=t.center,a=null;try{a=this._project(new _({x:o,y:s,spatialReference:t.spatialReference}),e)}catch(h){Jt()||b.getLogger(this).warn(new yt("mapview:spatial-reference-change","could not project the view's center to the new spatial reference",{center:a?.toJSON(),spatialReference:e,error:h}))}a||(a=new _({x:0,y:0,spatialReference:e}));let p=Tt(new k({targetGeometry:new _,scale:0,rotation:0}),t.viewpoint,a);i.viewpoint=p;try{let l=[t.size[0]/2,t.size[1]/2],m=[l[0]+20,l[1]],c=t.toMap([0,0],m),{x:v,y:x}=this._project(new _({x:c[0],y:c[1],spatialReference:t.spatialReference}),e);c[0]=v,c[1]=x,i.toScreen(c,c);let I=ue(l,c,m),T=Math.hypot(c[0]-l[0],c[1]-l[1])/20;!Number.isFinite(T)||Math.abs(T)>4?(p.rotation=0,p.targetGeometry=new _({x:0,y:0,spatialReference:e})):(p.scale*=T,p.scale>Kt("mapview-srswitch-adjust-rotation-scale-threshold")?p.rotation=0:p.rotation+=Number.isFinite(I)?I:0)}catch{}this._get("constraints")?.constrain(p,void 0),this._get("state").viewpoint=p}resize(e,t){if(!this.ready)return;let i=this.state,o=this.state.paddedViewState.viewpoint,s=this.state.paddedViewState.size.slice();i.size=[e,t],ve(o,o,s,this.state.paddedViewState.size,this.resizeAlign),o=this.constraints?.constrain(o,void 0)??o,this.state.viewpoint=o}toMap(e){if(!this.ready)return null;let t=[0,0],[i,o]=this.state.toMap(t,[e.x,e.y]),s=this.state.spatialReference;return new _({x:i,y:o,spatialReference:s})}toScreen(e,t){if(!this.ready)return null;let i=this._project(e,this.state.spatialReference),o=[i.x,i.y];return t?.pickClosestTarget===!1||this.state.paddedViewState.wrapMapCoordinate(o,o),this.state.toScreen(o,o),D(o[0],o[1])}_project(e,t){let i=e?.targetGeometry||e;if(!t)return e;if(!i)return null;if(t.imageCoordinateSystem||i.spatialReference?.imageCoordinateSystem||Yt(t,i.spatialReference))return e;let o=it(i,t);if(!o)throw new S("mapview:projection-not-possible","projecting input geometry to target spatial reference returned a null value",{geometry:i,spatialReference:t});return Ke(e)?(e.targetGeometry=o,e):o}};function Ke(e){return e?.declaredClass==="esri.Viewpoint"}n([r({type:_})],w.prototype,"center",null),n([r()],w.prototype,"constraints",void 0),n([r({type:et})],w.prototype,"extent",null),n([r({value:{top:0,right:0,bottom:0,left:0},cast:e=>X({top:0,right:0,bottom:0,left:0},e)})],w.prototype,"padding",null),n([r()],w.prototype,"ready",void 0),n([r()],w.prototype,"resizeAlign",void 0),n([r({readOnly:!0})],w.prototype,"resolution",null),n([r({type:Number})],w.prototype,"rotation",null),n([r({type:Number})],w.prototype,"scale",null),n([r({readOnly:!0})],w.prototype,"state",void 0),n([r({type:k})],w.prototype,"viewpoint",null),n([r({readOnly:!0})],w.prototype,"visibleArea",null),n([r()],w.prototype,"zoom",null),w=n([d("esri.views.2d.ViewStateManager")],w);var Y=class extends u{constructor(t,i){super(!0),this._view=t,this.registerIncoming("double-click",i,o=>this._handleDoubleClick(o,i))}_handleDoubleClick(t,i){Se(t.data,"primary")&&(t.stopPropagation(),i?this._view.mapViewNavigation.zoomOut([t.data.x,t.data.y]):this._view.mapViewNavigation.zoomIn([t.data.x,t.data.y]))}};var rt=class extends u{constructor(t,i,o){super(!0),this.view=t,this.pointerType=i,this.registerIncoming("double-tap-drag",o,s=>this._handleDoubleTapDrag(s))}_handleDoubleTapDrag(t){let{data:i}=t,{pointerType:o}=i;if(o!==this.pointerType)return;t.stopPropagation();let{action:s,delta:a}=i,{view:p}=this,{mapViewNavigation:h}=p;switch(s){case"begin":{let{scale:l}=p;this._startScale=l,this._currentScale=l,this._previousDelta=a,h.begin();break}case"update":{if(this._previousDelta.y===a.y)return;this._previousDelta=a;let l=1.015**a.y,m=this._startScale*l,c=m/this._currentScale;h.setViewpointImmediate(c),this._currentScale=m;break}case"end":{let{constraints:l}=p,{effectiveLODs:m,snapToZoom:c}=l;if(!c||!m)return void h.end();let v=l.snapScale(this._currentScale),x=(a.y>0?Math.max(v,l.snapToPreviousScale(this._startScale)):Math.min(v,l.snapToNextScale(this._startScale)))/this._currentScale;h.zoom(x).then(()=>{h.end()});break}}}};var pt=class extends u{constructor(t,i,o){super(!0),this.view=t,this.pointerActions=i,this.registerIncoming("drag",o,s=>this._handleDrag(s)),this.registerIncoming("pointer-down",()=>this.stopMomentumNavigation())}onInstall(t){super.onInstall(t),this._dragEventSeparator=new R({start:(i,o)=>{this.view.mapViewNavigation.pan.begin(this.view,o.data),o.stopPropagation()},update:(i,o)=>{this.view.mapViewNavigation.pan.update(this.view,o.data),o.stopPropagation()},end:(i,o)=>{this.view.mapViewNavigation.pan.end(this.view,o.data),o.stopPropagation()},condition:(i,o)=>i===1&&st(o.data,this.pointerActions)})}_handleDrag(t){let i=this.view.mapViewNavigation;i.pinch.zoomMomentum||i.pinch.rotateMomentum?this.stopMomentumNavigation():this._dragEventSeparator.handle(t)}stopMomentumNavigation(){this.view.mapViewNavigation.pan.stopMomentumNavigation()}};var ht=class extends u{constructor(t,i,o){super(!0),this._view=t,this.pointerActions=i;let s=this._view.mapViewNavigation;this._dragEventSeparator=new R({start:(a,p)=>{s.rotate.begin(this._view,p.data),p.stopPropagation()},update:(a,p)=>{s.rotate.update(this._view,p.data),p.stopPropagation()},end:(a,p)=>{s.rotate.end(),p.stopPropagation()},condition:(a,p)=>a===1&&st(p.data,this.pointerActions)}),this.registerIncoming("drag",o,a=>this._dragEventSeparator.handle(a))}};var lt=class extends u{constructor(t){super(!0),this._view=t,this._frameTask=null,this._watchHandles=new Ut,this._currentDevice=null,this._transformation={translation:[0,0,0],heading:0,tilt:0,zoom:0},this._handle=this.registerIncoming("gamepad",i=>this._handleGamePadEvent(i)),this._handle.pause()}onInstall(t){super.onInstall(t),this._watchHandles.add([M(()=>this._view.navigation.gamepad?.enabled,i=>{i?(this._handle.resume(),this._frameTask||(this._frameTask=A({update:o=>this._frameUpdate(o.deltaTime)}))):(this._handle.pause(),this._frameTask&&(this._frameTask.remove(),this._frameTask=null))},tt)])}onUninstall(){this._watchHandles.removeAll(),this._frameTask&&(this._frameTask.remove(),this._frameTask=null),super.onUninstall()}_handleGamePadEvent(t){let i=this._view.navigation.gamepad.device;i&&t.data.device!==i||this._currentDevice&&this._currentDevice!==t.data.device||(t.data.action==="end"?(this._currentDevice=null,Me(this._transformation)):(this._currentDevice=t.data.device,be(t.data,this._view.navigation.gamepad,this._transformation)),this._frameTask?.resume())}_frameUpdate(t){let i=this._transformation;if(De(i))return void this._frameTask?.pause();let o=this._view.viewpoint.clone(),s=this._view.navigation.gamepad.velocityFactor,a=Fe*s*t;we(o,o,[i.translation[0]*a,-i.translation[1]*a]);let p=1+i.translation[2]*je*t,h=this._view.constraints.rotationEnabled?-i.heading*Ue*t:0,l=this._view.size,m=[l[0]/2,l[1]];_e(o,o,p,h,m,l);let c=this._view.constraints.constrain(o,this._view.viewpoint);this._view.viewpoint=c}},Ue=.06,Fe=.7,je=6e-4;var ct=class extends u{constructor(t,i,o){super(!0),this.view=t,this.keys=i,this._isSticky=!1,this._pressedKeys=new Set,this._timeout=void 0,this._currentDirection=void 0,this._stickyKeyDuration=200,this._handleKey=s=>{let a=this._keyMap[s.data.key];if(s.modifiers.has("Meta")||s.modifiers.has("Control"))return void this._stopMovement();if(a==null)return;s.stopPropagation(),s.preventDefault();let p=s.type==="key-down";if(this._pressedKeys[p?"add":"delete"](a),p){if(this._direction===a)return;this._direction=a,this._isSticky=!1,this._setTimeout(()=>{this._isSticky&&this._handlePopKey()})}else{let h=this._timeout===void 0,l=this._pressedKeys.size>0;h||l?this._handlePopKey():this._isSticky=!0}},this._handlePopKey=()=>{this._direction=Array.from(this._pressedKeys).pop(),this._direction==null&&this._stopMovement()},this._stopMovement=()=>{this._isSticky=!1,this._direction=void 0,this._pressedKeys.clear(),this._setTimeout(void 0)},this._keyMap={[i.left]:"left",[i.right]:"right",[i.up]:"up",[i.down]:"down"},this.registerIncoming("key-down",o,this._handleKey),this.registerIncoming("key-up",o,this._handleKey),this.registerIncoming("blur",o,this._stopMovement),this._visibilityHandle=at(s=>s?null:this._stopMovement())}onUninstall(){this._stopMovement(),this._visibilityHandle?.remove()}get _direction(){return this._currentDirection}set _direction(t){let i=this._currentDirection!=null;if(t!=null){if(i||this.view.mapViewNavigation.begin(),this._currentDirection!==t)switch(t){case"left":this.view.mapViewNavigation.continuousPanLeft();break;case"right":this.view.mapViewNavigation.continuousPanRight();break;case"up":this.view.mapViewNavigation.continuousPanUp();break;case"down":this.view.mapViewNavigation.continuousPanDown()}}else i&&this.view.mapViewNavigation.stop();this._currentDirection=t}_setTimeout(t){clearTimeout(this._timeout),this._timeout=t===void 0?void 0:setTimeout(()=>{this._timeout=void 0,t()},this._stickyKeyDuration)}};var mt=class extends u{constructor(t,i,o){super(!0),this.view=t,this.keys=i,this._keyToDirection=new Map,this._pressed=!1,this._addKeysMapping(i),this.registerIncoming("key-down",o,s=>this._handleKeyDown(s)),this.registerIncoming("key-up",o,s=>this._handleKeyUp(s)),this.registerIncoming("blur",o,()=>this._handleStop()),this._visibilityHandle=at(s=>s?null:this._handleStop())}onUninstall(){this._visibilityHandle?.remove(),this._handleStop()}_addKeysMapping(t){this._addKeyMapping(t.clockwise,"clockwise"),this._addKeyMapping(t.counterClockwise,"counterClockwise"),this._addKeyMapping(t.reset,"reset")}_addKeyMapping(t,i){for(let o of t)this._keyToDirection.set(o,i)}_handleKeyDown(t){t.data.repeat||this._handleKey(t,!0)}_handleKeyUp(t){this._handleKey(t,!1)}_handleStop(){this._pressed&&(this._pressed=!1,this.view.mapViewNavigation.stop())}_handleKey(t,i){let o=t.modifiers;if(o.size>0&&!o.has("Shift")||!this.view.constraints.rotationEnabled)return;let s=this._keyToDirection.get(t.data.key);if(this._pressed=s!=null,this._pressed){if(t.preventDefault(),i)switch(this.view.mapViewNavigation.begin(),s){case"clockwise":this.view.mapViewNavigation.continuousRotateClockwise();break;case"counterClockwise":this.view.mapViewNavigation.continuousRotateCounterclockwise();break;case"reset":this.view.mapViewNavigation.resetRotation()}else this._pressed=!1,this.view.mapViewNavigation.stop();t.stopPropagation()}}};var L;(function(e){e[e.IN=0]="IN",e[e.OUT=1]="OUT"})(L||(L={}));var dt=class extends u{constructor(t,i,o){super(!0),this.view=t,this.keys=i,this._keysToZoomAction={},this.registerIncoming("key-down",o,s=>this._handleKeyDown(s)),i.zoomIn.forEach(s=>this._keysToZoomAction[s]=L.IN),i.zoomOut.forEach(s=>this._keysToZoomAction[s]=L.OUT)}_handleKeyDown(t){this._handleKey(t)}_handleKey(t){let i=t.modifiers;if(i.size>0&&!i.has("Shift"))return;let{key:o}=t.data;if(!(o in this._keysToZoomAction))return;let s=this._keysToZoomAction[o],{mapViewNavigation:a}=this.view,p=null;switch(s){case L.IN:p=a.zoomIn();break;case L.OUT:p=a.zoomOut();break;default:return}a.begin(),p.then(()=>a.end()),t.stopPropagation()}};var qe=.6,ut=class extends u{constructor(t,i){super(!0),this._view=t,this._canZoom=!0,this.registerIncoming("mouse-wheel",i,o=>this._handleMouseWheel(o))}_handleMouseWheel(t){if(this._view.navigation.actionMap.mouseWheel!=="zoom"||(t.preventDefault(),t.stopPropagation(),!this._canZoom))return;let i=this._view.mapViewNavigation,{x:o,y:s,deltaY:a}=t.data,p=1/qe**(1/60*a),h=i.zoom(p,[o,s]);h&&(this._canZoom=!1,h.catch(()=>{}).then(()=>{this._canZoom=!0,i.end()}))}};var ft=class extends u{constructor(t){super(!0),this.view=t,this.registerIncoming("drag",o=>this._handleDrag(o)),this.registerIncoming("pointer-down",()=>this._stopMomentumNavigation());let i=this.view.mapViewNavigation;this._dragEventSeparator=new R({start:(o,s)=>{i.pinch.begin(this.view,s.data),s.stopPropagation()},update:(o,s)=>{i.pinch.update(this.view,s.data),s.stopPropagation()},end:(o,s)=>{i.pinch.end(this.view),s.stopPropagation()},condition:o=>o>=2})}_handleDrag(t){this._dragEventSeparator.handle(t)}_stopMomentumNavigation(){this.view.mapViewNavigation.pinch.stopMomentumNavigation()}};var vt=class extends u{constructor(t=W.maximumDoubleClickDelay,i=W.maximumDoubleClickDistance,o=W.maximumDoubleTouchDelay,s=W.maximumDoubleTouchDistance,a=jt){super(!1),this._maximumDoubleClickDelay=t,this._maximumDoubleClickDistance=i,this._maximumDoubleTouchDelay=o,this._maximumDoubleTouchDistance=s,this._clock=a,this._doubleTapDragReady=!1,this._doubleTapDragActive=!1,this._dragStartCenter=D(0,0),this._pointerState=new Map,this._doubleTapDrag=this.registerOutgoing("double-tap-drag"),this._dragEventSeparator=new R({start:(p,h)=>this._dragStart(p,h),update:(p,h)=>this._dragUpdate(h),end:(p,h)=>this._dragEnd(h)}),this.registerIncoming("drag",p=>this._dragEventSeparator.handle(p)),this.registerIncoming("pointer-down",p=>this._handlePointerDown(p)),this.registerIncoming("pointer-up",()=>this._handlePointerUp())}onUninstall(){this._pointerState.forEach(t=>{t.doubleTapTimeout=U(t.doubleTapTimeout)})}get hasPendingInputs(){for(let t of this._pointerState.values())if(t.doubleTapTimeout!=null)return!0;return!1}_clearPointerDown(t){let i=this._pointerState.get(t);i&&(i.doubleTapTimeout=U(i.doubleTapTimeout),this._pointerState.delete(t),this.refreshHasPendingInputs())}_dragStart(t,i){if(!this._doubleTapDragReady||t!==1)return;this._doubleTapDragReady=!1,this._doubleTapDragActive=!0;let{data:o,modifiers:s}=i,{center:a}=o;this._dragStartCenter=a;let p=Et("begin",D(0,0),o);this._doubleTapDrag.emit(p,void 0,s),i.stopPropagation()}_dragUpdate(t){if(!this._doubleTapDragActive)return;let{data:i,modifiers:o}=t,{center:s}=i,a=Et("update",D(s.x-this._dragStartCenter.x,s.y-this._dragStartCenter.y),i);this._doubleTapDrag.emit(a,void 0,o),t.stopPropagation()}_dragEnd(t){if(!this._doubleTapDragActive)return;let{data:i,modifiers:o}=t,{center:s}=i,a=Et("end",D(s.x-this._dragStartCenter.x,s.y-this._dragStartCenter.y),i);this._doubleTapDrag.emit(a,void 0,o),this._doubleTapDragActive=!1,t.stopPropagation()}_handlePointerDown(t){let{data:i}=t,o=kt(i),s=this._pointerState.get(o),{pointerType:a}=i.native;if(s){let p=a==="touch"?this._maximumDoubleTouchDistance:this._maximumDoubleClickDistance;this._clearPointerDown(o),Pe(s.event.data,i)>p?this._storePointerDown(t):this._doubleTapDragReady=!0}else this._storePointerDown(t)}_handlePointerUp(){this._doubleTapDragReady=!1}_storePointerDown(t){let{data:i}=t,{pointerType:o}=i.native,s=kt(i),a=o==="touch"?this._maximumDoubleTouchDelay:this._maximumDoubleClickDelay,p=this._clock.setTimeout(()=>this._clearPointerDown(s),a);this._pointerState.set(s,{event:t,doubleTapTimeout:p}),this.refreshHasPendingInputs()}};function Et(e,t,i){let{button:o,buttons:s,pointer:a,pointers:p,pointerType:h,timestamp:l}=i;return{action:e,delta:t,button:o,buttons:s,pointer:a,pointers:p,pointerType:h,timestamp:l}}var gt={counter:"Control",pan:{left:"ArrowLeft",right:"ArrowRight",up:"ArrowUp",down:"ArrowDown"},zoom:{zoomIn:["=","+"],zoomOut:["-","_"]},rotate:{clockwise:["a","A"],counterClockwise:["d","D"],reset:["n","N"]}},Oe=Symbol("handles"),V=class extends g{initialize(){let e=()=>this.view?.ready;this.addHandles([F(()=>!e(),()=>this._disconnect()),F(e,()=>this._connect())])}destroy(){this._disconnect()}get latestPointerType(){return this._inputManager?.latestPointerType}get latestPointerLocation(){return this._inputManager?.latestPointerLocation}get multiTouchActive(){return this._inputManager?.multiTouchActive??!1}isModifierKeyDown(e){return this._inputManager?.isModifierKeyDown(e)??!1}_disconnect(){this.view.viewEvents.disconnect(),this.removeHandles(Oe),this._inputManager=Ft(this._inputManager)}_connect(){let e=this.view.surface,t=new ke(e,this.view.input),i=[new Ze,new Ie,new Ve,new Re(this.view.navigation),new vt],o=new ye({eventSource:t,recognizers:i}),s=new pt(this.view,["primary"]),a=new ht(this.view,["secondary"]);o.installHandlers("prevent-context-menu",[new ze],bt.INTERNAL),o.installHandlers("navigation",[new ft(this.view),new lt(this.view),new ut(this.view),new Y(this.view),new Y(this.view,[gt.counter]),s,new ct(this.view,gt.pan),new dt(this.view,gt.zoom),new mt(this.view,gt.rotate),a,new rt(this.view,"touch")],bt.INTERNAL),this.view.viewEvents.connect(o),this._source=t,this._inputManager=o,this.addHandles([M(()=>this.view?.navigation?.browserTouchPanEnabled,p=>{this._source&&(this._source.browserTouchPanningEnabled=!p)},tt),M(()=>{let{actionMap:p}=this.view.navigation;return{panActions:Dt("pan",p),rotateActions:Dt("rotate",p)}},({panActions:p,rotateActions:h})=>{s.pointerActions=p,a.pointerActions=h},$t)],Oe)}get test(){}};n([r()],V.prototype,"view",void 0),n([r()],V.prototype,"latestPointerType",null),n([r()],V.prototype,"latestPointerLocation",null),n([r()],V.prototype,"multiTouchActive",null),V=n([d("esri.views.2d.input.MapViewInputManager")],V);var Ee=V;var He=160,G=class extends g{constructor(){super(...arguments),this._timer=void 0}get stationary(){return!this._timer}flip(){this._timestamp=performance.now(),this._timer==null&&(this._timer=setInterval(()=>{performance.now()-this._timestamp>=He&&this.clear()},He))}clear(){this._timer&&(clearInterval(this._timer),this._timer=void 0)}};n([r()],G.prototype,"_timer",void 0),n([r()],G.prototype,"stationary",null),G=n([d("esri.views.2d.support.StationaryManager")],G);var ja=e=>{let t=class extends e{constructor(...i){super(...i),this.fullOpacity=1,this.stateManager=new w({constraints:new Ot({view:this})}),this.goToManager=new $({view:this}),this.stationaryManager=new G,this.mapViewNavigation=null,this.renderingOptions={samplingMode:"dynamic",edgeLabelsVisible:!1,labelsAnimationTime:0,labelCollisionsEnabled:!1},this.frameTask=new nt(this),this.inputManager=new Ee({view:this}),this.viewEvents=new xe(this),this.padding={top:0,right:0,bottom:0,left:0},this.addHandles([M(()=>this.viewpoint,()=>this.stationaryManager.flip(),N),this.on("resize",o=>this.stateManager.resize(o.width,o.height))])}get constraintsInfo(){return{lods:null,spatialReference:null}}get extent(){return this.stateManager?.extent??null}set extent(i){this.stateManager.extent=i}get state(){return this.stateManager.state}get interacting(){return this.navigating}get stationary(){return!this.animation&&!this.navigating&&!this.resizing&&this.stationaryManager.stationary}set animation(i){let o=this._get("animation");if(i===o)return;if(o&&o.stop(),i!==this.animationManager.animation&&this.animationManager.stop(),!i||i.isFulfilled())return void this._set("animation",null);this._set("animation",i);let s=()=>{this.destroyed||i===this._get("animation")&&(this._set("animation",null),this.frameTask?.requestFrame())};i.when(s,s)}get constraints(){return this.stateManager?.constraints}set constraints(i){i.view=this;let o=this.stateManager.constraints;this.stateManager.constraints=i,o?.destroy()}get padding(){return this.stateManager?.padding}set padding(i){this.stateManager&&(this.stateManager.padding=i)}get resizeAlign(){return this.stateManager.resizeAlign}set resizeAlign(i){this.stateManager.resizeAlign=i}get rotation(){return this.stateManager.rotation??0}set rotation(i){let{rotationEnabled:o}=this.constraints;this.constraints.rotationEnabled=!0,this.stateManager.rotation=i,this.constraints.rotationEnabled=o}get viewpoint(){return this.stateManager.viewpoint??null}set viewpoint(i){this.stateManager.viewpoint=i,this.frameTask.requestFrame()}on(i,o,s,a){return this.inputManager&&this.viewEvents.on(i,o,s,a)||super.on(i,o)}hasEventListener(i){return super.hasEventListener(i)||this.viewEvents.hasHandler(i)}goTo(i,o){return this.goToManager.goTo(i,o)}};return n([r({readOnly:!0})],t.prototype,"animationManager",void 0),n([r({readOnly:!0})],t.prototype,"fullOpacity",void 0),n([r()],t.prototype,"stateManager",void 0),n([r()],t.prototype,"constraintsInfo",null),n([r()],t.prototype,"extent",null),n([r()],t.prototype,"goToManager",void 0),n([r({readOnly:!0})],t.prototype,"state",null),n([r({readOnly:!0})],t.prototype,"mapViewNavigation",void 0),n([r()],t.prototype,"renderingOptions",void 0),n([r({readOnly:!0})],t.prototype,"interacting",null),n([r()],t.prototype,"stationary",null),n([r()],t.prototype,"animation",null),n([r({type:Ot})],t.prototype,"constraints",null),n([r({readOnly:!0})],t.prototype,"inputManager",void 0),n([r()],t.prototype,"padding",null),n([r()],t.prototype,"resizeAlign",null),n([r()],t.prototype,"rotation",null),n([r({readOnly:!0})],t.prototype,"viewEvents",void 0),n([r({type:k})],t.prototype,"viewpoint",null),t=n([d("esri.views.Viewport2DMixin")],t),t};var Q=class{constructor(t){this._view=t,this.viewpoint=new k({targetGeometry:new _,scale:0,rotation:0})}get view(){return this._view}get size(){let[t,i]=this._view.size;return Math.sqrt(t*t+i*i)}get scale(){return this.viewpoint.scale}get rotation(){return this.viewpoint.rotation}get center(){return this.viewpoint.targetGeometry}get scaleToResolutionFactor(){return de(this.center.spatialReference)}pixelsPerPanAtZoom(t){return 1/(t*this.scaleToResolutionFactor)}zoomAtPixelsPerPan(t){return 1/(t*this.scaleToResolutionFactor)}pixelsPerRotate(){return this.size/2}compareTo(t,i){i.pan=Qt(this.center,t.center);let o=Math.abs(t.rotation-this.rotation);o=o>=180?360-o:o,i.rotate=ee(o),i.sourceZoom=this.scale,i.targetZoom=t.scale}interpolate(t,i,o){let{pan:s,rotate:a,zoom:p,zoomOffset:h}=o,{center:l}=this;l.spatialReference=t.center.spatialReference,l.x=j(t.center.x,i.center.x,s),l.y=j(t.center.y,i.center.y,s),this.viewpoint.scale=j(t.scale,i.scale+h,p);let m=t.rotation,c=i.rotation;Math.abs(c-m)>=180&&(m+=360*(m<c?1:-1)),this.viewpoint.rotation=j(m,c,a)}copyFrom(t){z(this.viewpoint,t.viewpoint),this._view=t.view}};var Be=2e3,We=64,Ht=class{constructor(t){this._view=t,this._animation=new Ce(()=>new Q(this._view)),this._current=new Q(this._view)}get _source(){return this._animation.definition.source}get _target(){return this._animation.definition.target}get duration(){return this._animation.time}get animation(){return this._animation}update(t,i,o={}){z(this._current.viewpoint,t),z(this._source.viewpoint,t),z(this._target.viewpoint,i),this._animation.update(this._source,this._target,o)}applyRatio(t,i){this._animation.cameraAt(i,this._current),z(t,this._current.viewpoint)}},K=class extends g{constructor(e){super(e),this._animation=null,this._destinationViewState=new H,this.updateFunction=null,this.easing=zt.ease,this.viewpoint=new k({targetGeometry:new _,scale:0,rotation:0}),this._updateTask=A({postRender:this._postRender.bind(this)}),this._updateTask.pause(),this._transition=new Ht(e.view)}destroy(){this._updateTask=U(this._updateTask)}get animation(){return this._animation}set animation(e){this._animation=e,this.view.animation=e}animate(e,t,i){this.stop();let o=this.viewpoint;z(o,t);let s=e.target;this._transition.update(this.viewpoint,s,{apex:{maximumDistance:Math.min(Math.min(t.scale,s.scale)*We,this.view.constraints.effectiveMinScale),desiredSlope:5e-8},duration:i?.duration,maxDuration:i?.animationMode==="auto"?1/0:i?.maxDuration??Pt.maxDuration,speedFactor:i?.speedFactor,easing:(typeof i?.easing=="string"?zt[i.easing]:i?.easing)||this.easing}),i?.animationMode==="auto"&&(this._destinationViewState.copy(this.view.state),this._destinationViewState.viewpoint=s,$e(this._transition.animation,i,this.view.state,this._destinationViewState)||this._transition.update(this.viewpoint,s,{duration:0}));let a=()=>{this.animation===e&&this._updateTask&&(e.state==="finished"&&(this._transition.applyRatio(this.viewpoint,1),this.view.state&&(this.view.state.viewpoint=this.viewpoint.clone())),this.animation=null,this.updateFunction=null)};return e.when(a,a),this._startTime=performance.now(),this._updateTask.resume(),this.animation=e,e}animateContinuous(e,t){this.stop(),this.updateFunction=t,this.viewpoint=e;let i=new B({target:e.clone()}),o=()=>{this.animation===i&&this._updateTask&&(this.animation=null,this.updateFunction=null)};return i.when(o,o),this._startTime=performance.now(),this._updateTask.resume(),this.animation=i,i}stop(){this.animation&&(this.animation.stop(),this.animation=null,this.updateFunction=null)}_postRender(e){let t=this.animation;if(t&&t.state!==B.State.STOPPED){if(this.updateFunction)this.updateFunction(this.viewpoint,e.deltaTime),this.animation?.update(this.viewpoint);else{let i=performance.now()-this._startTime,o=this._transition.duration,s=o>0?i/o:1,a=s>=1;this._transition.applyRatio(this.viewpoint,s),a&&this.animation?.finish()}this.view.state&&(this.view.state.viewpoint=this.viewpoint.clone())}else this._updateTask.pause()}};function $e(e,t,i,o){if(t?.duration!=null)return!0;let{time:s,isLinear:a}=e,p=t?.speedFactor||1;if(s>(t?.maxDuration??Pt.maxDuration/p))return!1;if(a){let l=ot(),m=D(...o.toScreen(l,...i.center)),c=D(...i.toScreen(l,...o.center)),v=c!=null&&c.x>-1*i.size[0]&&c.x<(1.5+.5)*i.size[0]&&c.y>-1*i.size[1]&&c.y<(1.5+.5)*i.size[1],x=m!=null&&m.x>-1*o.size[0]&&m.x<(1.5+.5)*o.size[0]&&m.y>-1*o.size[1]&&m.y<(1.5+.5)*o.size[1];if(s>Be/p&&!v&&!x)return!1}return!0}n([r()],K.prototype,"easing",void 0),n([r()],K.prototype,"view",void 0),n([r()],K.prototype,"viewpoint",void 0),K=n([d("esri.views.2d.AnimationManager")],K);var Sn=K;var _t=class extends Ae{constructor(e){super(e),this.components=["attribution","zoom"]}};n([r()],_t.prototype,"components",void 0),_t=n([d("esri.views.ui.2d.DefaultUI2D")],_t);var Vn=_t;export{Ot as a,w as b,ja as c,Sn as d,Vn as e};
