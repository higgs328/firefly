import{n as W,p as J,q as V}from"./chunk-7BFE2ZPI.js";import{a as S,b as q,c as G,d as B,e as $}from"./chunk-LYLB72RT.js";import"./chunk-6VXJCXVR.js";import{$ as I,C as y,Ca as a,Da as P,Eb as p,Fa as i,Gb as _,J as f,L as h,Mb as N,Nb as A,Ob as M,P as D,Rb as k,aa as O,bc as Z,cc as v,dc as U,fa as T,fb as w,h as m,i as z,kb as E,la as n,n as L,nb as j,rb as l,sa as C,vb as R}from"./chunk-MV64C3PS.js";var H=(()=>{class r{mapService=n(S);zone=n(P);id=i.required();data=j();minzoom=i();maxzoom=i();attribution=i();buffer=i();tolerance=i();cluster=i();clusterRadius=i();clusterMaxZoom=i();clusterMinPoints=i();clusterProperties=i();lineMetrics=i();generateId=i();promoteId=i();filter=i();dynamic=i();updateFeatureData=new L;sub=new z;sourceAdded=!1;featureIdCounter=0;ngOnInit(){this.data()||this.data.set({type:"FeatureCollection",features:[]});let e=this.mapService.mapLoaded$.subscribe(()=>{this.init();let t=f(this.mapService.mapInstance,"styledata").pipe(h(()=>!this.mapService.mapInstance.getSource(this.id()))).subscribe(()=>{this.init()});this.sub.add(t)});this.sub.add(e)}ngOnChanges(e){if(this.sourceAdded&&((e.minzoom&&!e.minzoom.isFirstChange()||e.maxzoom&&!e.maxzoom.isFirstChange()||e.attribution&&!e.attribution.isFirstChange()||e.buffer&&!e.buffer.isFirstChange()||e.tolerance&&!e.tolerance.isFirstChange()||e.cluster&&!e.cluster.isFirstChange()||e.clusterRadius&&!e.clusterRadius.isFirstChange()||e.clusterMaxZoom&&!e.clusterMaxZoom.isFirstChange()||e.clusterMinPoints&&!e.clusterMinPoints.isFirstChange()||e.clusterProperties&&!e.clusterProperties.isFirstChange()||e.lineMetrics&&!e.lineMetrics.isFirstChange()||e.generateId&&!e.generateId.isFirstChange()||e.promoteId&&!e.promoteId.isFirstChange()||e.filter&&!e.filter.isFirstChange()||e.dynamic&&!e.dynamic.isFirstChange())&&(this.ngOnDestroy(),this.ngOnInit()),e.data&&!e.data.isFirstChange())){let t=this.mapService.getSource(this.id());if(t===void 0)return;t.setData(this.data())}}ngOnDestroy(){this.sub.unsubscribe(),this.sourceAdded&&(this.mapService.removeSource(this.id()),this.sourceAdded=!1)}getClusterExpansionZoom(e){return m(this,null,function*(){let t=this.mapService.getSource(this.id());return this.zone.run(()=>m(this,null,function*(){return new Promise((o,u)=>{t.getClusterExpansionZoom(e,(c,d)=>{c?u(c):o(d)})})}))})}getClusterChildren(e){return m(this,null,function*(){let t=this.mapService.getSource(this.id());return this.zone.run(()=>m(this,null,function*(){return new Promise((o,u)=>{t.getClusterChildren(e,(c,d)=>{c?u(c):o(d)})})}))})}getClusterLeaves(e,t,o){return m(this,null,function*(){let u=this.mapService.getSource(this.id());return this.zone.run(()=>m(this,null,function*(){return new Promise((c,d)=>{u.getClusterLeaves(e,t,o,(x,X)=>{x?d(x):c(X||[])})})}))})}_addFeature(e){this.data().features.push(e),this.updateFeatureData.next(null)}_removeFeature(e){let t=this.data(),o=t.features.indexOf(e);o>-1&&t.features.splice(o,1),this.updateFeatureData.next(null)}_getNewFeatureId(){return++this.featureIdCounter}init(){let e={type:"geojson",data:this.data(),minzoom:this.minzoom(),maxzoom:this.maxzoom(),attribution:this.attribution(),buffer:this.buffer(),tolerance:this.tolerance(),cluster:this.cluster(),clusterRadius:this.clusterRadius(),clusterMaxZoom:this.clusterMaxZoom(),clusterMinPoints:this.clusterMinPoints(),clusterProperties:this.clusterProperties(),lineMetrics:this.lineMetrics(),generateId:this.generateId(),promoteId:this.promoteId(),filter:this.filter(),dynamic:this.dynamic()};this.mapService.addSource(this.id(),e);let t=this.updateFeatureData.pipe(D(0)).subscribe(()=>{let o=this.mapService.getSource(this.id());o!==void 0&&o.setData(this.data())});this.sub.add(t),this.sourceAdded=!0}static \u0275fac=function(t){return new(t||r)};static \u0275cmp=l({type:r,selectors:[["mgl-geojson-source"]],inputs:{id:[1,"id"],data:[1,"data"],minzoom:[1,"minzoom"],maxzoom:[1,"maxzoom"],attribution:[1,"attribution"],buffer:[1,"buffer"],tolerance:[1,"tolerance"],cluster:[1,"cluster"],clusterRadius:[1,"clusterRadius"],clusterMaxZoom:[1,"clusterMaxZoom"],clusterMinPoints:[1,"clusterMinPoints"],clusterProperties:[1,"clusterProperties"],lineMetrics:[1,"lineMetrics"],generateId:[1,"generateId"],promoteId:[1,"promoteId"],filter:[1,"filter"],dynamic:[1,"dynamic"]},outputs:{data:"dataChange"},features:[C],decls:0,vars:0,template:function(t,o){},encapsulation:2,changeDetection:0})}return r})();var K=(()=>{class r{mapService=n(S);id=i.required();source=i();type=i.required();metadata=i();sourceLayer=i();filter=i();layout=i();paint=i();before=i();minzoom=i();maxzoom=i();layerClick=new a;layerDblClick=new a;layerMouseDown=new a;layerMouseUp=new a;layerMouseEnter=new a;layerMouseLeave=new a;layerMouseMove=new a;layerMouseOver=new a;layerMouseOut=new a;layerContextMenu=new a;layerTouchStart=new a;layerTouchEnd=new a;layerTouchCancel=new a;layerAdded=!1;sub;ngOnInit(){this.sub=this.mapService.mapLoaded$.pipe(O(()=>f(this.mapService.mapInstance,"styledata").pipe(y(()=>!1),h(()=>!this.mapService.mapInstance.getLayer(this.id())),I(!0)))).subscribe(e=>this.init(e))}ngOnChanges(e){this.layerAdded&&(e.paint&&!e.paint.isFirstChange()&&this.mapService.setLayerAllPaintProperty(this.id(),e.paint.currentValue),e.layout&&!e.layout.isFirstChange()&&this.mapService.setLayerAllLayoutProperty(this.id(),e.layout.currentValue),e.filter&&!e.filter.isFirstChange()&&this.mapService.setLayerFilter(this.id(),e.filter.currentValue),e.before&&!e.before.isFirstChange()&&this.mapService.setLayerBefore(this.id(),e.before.currentValue),(e.minzoom&&!e.minzoom.isFirstChange()||e.maxzoom&&!e.maxzoom.isFirstChange())&&this.mapService.setLayerZoomRange(this.id(),this.minzoom(),this.maxzoom()))}ngOnDestroy(){this.layerAdded&&this.mapService.removeLayer(this.id()),this.sub&&this.sub.unsubscribe()}init(e){let t={layerOptions:{id:this.id(),type:this.type(),source:this.source(),metadata:this.metadata(),"source-layer":this.sourceLayer(),minzoom:this.minzoom(),maxzoom:this.maxzoom(),filter:this.filter(),layout:this.layout(),paint:this.paint()},layerEvents:{layerClick:this.layerClick,layerDblClick:this.layerDblClick,layerMouseDown:this.layerMouseDown,layerMouseUp:this.layerMouseUp,layerMouseEnter:this.layerMouseEnter,layerMouseLeave:this.layerMouseLeave,layerMouseMove:this.layerMouseMove,layerMouseOver:this.layerMouseOver,layerMouseOut:this.layerMouseOut,layerContextMenu:this.layerContextMenu,layerTouchStart:this.layerTouchStart,layerTouchEnd:this.layerTouchEnd,layerTouchCancel:this.layerTouchCancel}};this.mapService.addLayer(t,e,this.before()),this.layerAdded=!0}static \u0275fac=function(t){return new(t||r)};static \u0275cmp=l({type:r,selectors:[["mgl-layer"]],inputs:{id:[1,"id"],source:[1,"source"],type:[1,"type"],metadata:[1,"metadata"],sourceLayer:[1,"sourceLayer"],filter:[1,"filter"],layout:[1,"layout"],paint:[1,"paint"],before:[1,"before"],minzoom:[1,"minzoom"],maxzoom:[1,"maxzoom"]},outputs:{layerClick:"layerClick",layerDblClick:"layerDblClick",layerMouseDown:"layerMouseDown",layerMouseUp:"layerMouseUp",layerMouseEnter:"layerMouseEnter",layerMouseLeave:"layerMouseLeave",layerMouseMove:"layerMouseMove",layerMouseOver:"layerMouseOver",layerMouseOut:"layerMouseOut",layerContextMenu:"layerContextMenu",layerTouchStart:"layerTouchStart",layerTouchEnd:"layerTouchEnd",layerTouchCancel:"layerTouchCancel"},features:[C],decls:0,vars:0,template:function(t,o){},encapsulation:2})}return r})();var g=class r{firestore=n(W);trailsRef;trails;constructor(){this.trailsRef=V(this.firestore,"trails"),this.trails=J(this.trailsRef,{idField:"id"}).pipe(y(s=>s.map(e=>JSON.parse(e.geojson))))}static \u0275fac=function(e){return new(e||r)};static \u0275prov=T({token:r,factory:r.\u0275fac,providedIn:"root"})};var ee=()=>({"line-color":"#000000","line-width":5}),te=()=>({"line-join":"round","line-cap":"round"}),ie=()=>["get","display_color"],re=r=>({"line-color":r,"line-width":2}),F=class r{trailService=n(g);featureCollection;ngOnInit(){this.trailService.trails.subscribe(s=>{this.featureCollection={features:s,type:"FeatureCollection"}})}static \u0275fac=function(e){return new(e||r)};static \u0275cmp=l({type:r,selectors:[["app-trail-layer"]],decls:3,vars:11,consts:[["id","trails-source",3,"data"],["id","trails-outline","type","line",3,"source","paint","layout"],["id","trails-line","type","line",3,"source","paint"]],template:function(e,t){e&1&&M(0,"mgl-geojson-source",0)(1,"mgl-layer",1)(2,"mgl-layer",2),e&2&&(p("data",t.featureCollection),w(),p("source","trails-source")("paint",v(6,ee))("layout",v(7,te)),w(),p("source","trails-source")("paint",U(9,re,v(8,ie))))},dependencies:[H,K],encapsulation:2})};var Q=class r extends B{style=this.styles.wildland;constructor(s){super(s)}static \u0275fac=function(e){return new(e||r)(E($))};static \u0275cmp=l({type:r,selectors:[["app-wildland-scene"]],features:[Z([G]),R],decls:2,vars:4,consts:[[1,"map-container",3,"mapCreate","zoom","center"]],template:function(e,t){e&1&&(N(0,"mgl-map",0),k("mapCreate",function(u){return t.mapCreate(u)}),M(1,"app-trail-layer"),A()),e&2&&(_(t.style),p("zoom",t.zoom)("center",t.center))},dependencies:[q,F],styles:[".map-container[_ngcontent-%COMP%]{height:100vh;width:100%}"]})};export{Q as WildlandSceneComponent};
