import{d as ie,e as ae,f as ne,g as le}from"./chunk-EOMINWGE.js";import{a as oe,b as se}from"./chunk-TFDME2PB.js";import{b as re}from"./chunk-7A3ZNBEY.js";import{b as te,f as D}from"./chunk-IKNLDVQM.js";import{a as _}from"./chunk-2JW3DUYT.js";import{b as ee}from"./chunk-KVIHP5QH.js";import{c as X}from"./chunk-WBPLJNRU.js";import{g as Y}from"./chunk-456M7HFK.js";import{b as G,c as H,d as z,e as P,f as j,g as I}from"./chunk-XR5FT7TQ.js";import{y as J}from"./chunk-KALOJIUA.js";import{h as Z}from"./chunk-RNC4P66O.js";import{i as K}from"./chunk-7LHOQXZT.js";import{d as U}from"./chunk-OLOKUDVI.js";import{B as q,G as F,a as N,i as W,k as B,l as Q}from"./chunk-KVM6SHDX.js";import{c as R}from"./chunk-VIEK2X23.js";import{a as k}from"./chunk-5XCFNEYX.js";import{f as E}from"./chunk-RAI4DTMT.js";import{b as L}from"./chunk-ACP3S2CH.js";import{a as O}from"./chunk-T7DXJKX7.js";import{a as n}from"./chunk-QGVBCWUY.js";import{H as V}from"./chunk-MYO4NP2N.js";import{e as l}from"./chunk-NFIPKH6V.js";import{l as v}from"./chunk-5QEXLALV.js";import{K as $,b as C,u as M,w as T,z as w}from"./chunk-4PTIEWMT.js";import{a as S}from"./chunk-TG2UTNEO.js";import{a as A,f as p}from"./chunk-VTHXE323.js";var m=class extends V{constructor(e){super(e),this.coordinates=void 0,this.strokeDash=[],this.strokeWidth=1,this.strokeColor=[0,0,0,1],this.strokeDashColor=[255,255,255,1],this.fillColor=[0,0,0,0],this.visible=!0,this.isDecoration=!0}get _strokeStyle(){let e=this.strokeColor;return`rgba(${e[0]}, ${e[1]}, ${e[2]}, ${e[3]})`}get _strokeBackgroundStyle(){let e=this.strokeDashColor;return`rgba(${e[0]}, ${e[1]}, ${e[2]}, ${e[3]})`}get _fillStyle(){let e=this.fillColor;return`rgba(${e[0]}, ${e[1]}, ${e[2]}, ${e[3]})`}get _renderCoordinates(){let e=[];if(!this.coordinates)return{coordinates:e,rect:F};let t=q(W(N(F),this.coordinates),2*this.strokeWidth);t[0]=Math.floor(t[0]),t[1]=Math.floor(t[1]),t[2]=Math.ceil(t[2]+.5),t[3]=Math.ceil(t[3]+.5);for(let o of this.coordinates)e.push([Math.floor(o[0]-t[0])+.5,Math.floor(o[1]-t[1])+.5]);return e.reverse(),{coordinates:e,rect:t}}render(){let{coordinates:e,rect:t}=this._renderCoordinates,o=B(t),s=Q(t);return k("div",{classes:{"esri-outline-overlay-item":!0},styles:{left:t[0]+"px",top:t[1]+"px",width:o+"px",height:s+"px",visibility:this.visible?"visible":"hidden"}},k("svg",{height:s,styles:{display:"block"},width:o},k("polygon",{fill:this._fillStyle,points:e.map(([r,i])=>`${r},${i}`).join(" "),stroke:this._strokeBackgroundStyle,"stroke-width":this.strokeWidth}),k("polygon",{fill:"transparent",points:e.map(([r,i])=>`${r},${i}`).join(" "),stroke:this._strokeStyle,"stroke-dasharray":this.strokeDash.length?this.strokeDash.join(" "):void 0,"stroke-width":this.strokeWidth})))}renderCanvas(){}};n([l()],m.prototype,"coordinates",void 0),n([l()],m.prototype,"strokeDash",void 0),n([l()],m.prototype,"strokeWidth",void 0),n([l()],m.prototype,"strokeColor",void 0),n([l()],m.prototype,"strokeDashColor",void 0),n([l()],m.prototype,"fillColor",void 0),n([l()],m.prototype,"visible",void 0),n([l()],m.prototype,"isDecoration",void 0),n([l({readOnly:!0})],m.prototype,"_strokeStyle",null),n([l({readOnly:!0})],m.prototype,"_strokeBackgroundStyle",null),n([l({readOnly:!0})],m.prototype,"_fillStyle",null),n([l({readOnly:!0})],m.prototype,"_renderCoordinates",null),m=n([v("esri.views.overlay.OutlineOverlayItem")],m);var ce=m;var y=class extends O.EventedMixin(ee){constructor(e){super(e),this._overlayItem=void 0,this.geometryType=null,this.mode=null,this.type="draw-screen"}initialize(){this.drawOperation=this._makeDrawOperation();let e=t=>this.drawOperation.on(t,o=>{this._updateVisuals(),this.emit(t,o)});this.addHandles([e("vertex-add"),e("vertex-remove"),e("vertex-update"),e("cursor-update"),e("complete")]),this.finishToolCreation()}destroy(){this.drawOperation=C(this.drawOperation),this._set("view",null)}get canRedo(){return this.drawOperation.canRedo}get canUndo(){return this.drawOperation.canUndo}set centeredToggled(e){this._set("centeredToggled",e),this._updateVisuals()}set enabled(e){this.drawOperation.interactive=e,this._set("enabled",e)}set uniformSizeToggled(e){this._set("uniformSizeToggled",e),this._updateVisuals()}get updating(){return this.drawOperation?.updating??!1}get cursor(){return this.geometryType==="point"?"default":"crosshair"}completeCreateOperation(){this.drawOperation.complete()}onInputEvent(e){this.destroyed||this.drawOperation.onInputEvent(e)}redo(){this.drawOperation.redo()}undo(){this.drawOperation.undo()}reset(){}_makeDrawOperation(){let{view:e}=this;return new te({view:e,manipulators:this.manipulators,geometryType:ye(this.geometryType),drawingMode:this.mode,hasZ:!1,defaultZ:0,snapToSceneEnabled:!1,drawSurface:new D,hasM:!1,snappingManager:null,snappingVisualizer:null,graphic:null,cursor:this.cursor})}get coordinates(){let{drawOperation:e}=this;if(!e?.geometryIncludingUncommittedVertices.length)return[];let{coordinateHelper:t}=e,o=e.committableVertex,s=e.committedVertices.slice();o!=null&&s.push(t.pointToArray(o));let r=s.length;switch(this.geometryType){case"circle":case"rectangle":{let i=new re(X,D.spatialReference),a=this.geometryType==="circle"?ne:ie,c=this.geometryType==="circle"?le:ae;if(r===1&&e.isCompleted){let u=s[0],d=i.makeMapPoint(u[0]+he,u[1]);return a([u,d],i,!0)?.geometry.rings[0]??[]}if(r===2){let u=this.geometryType!=="rectangle",d=this.centeredToggled!==u,h=this.geometryType!=="rectangle";return(this.uniformSizeToggled!==h?a(s,i,d)?.geometry.rings[0]:c(s,i,d)?.geometry.rings[0])??[]}return[]}}return s}_updateVisuals(){if(!this._overlayItem){let e=new ce({strokeDash:[5],strokeDashColor:[255,255,255,255]});this.view.overlay?.addItem(e),this.addHandles(S(()=>{this.view.overlay?.removeItem(e),e?.destroy(),this._overlayItem=void 0})),this._overlayItem=e}this._overlayItem.coordinates=this.coordinates}onDeactivate(){this.drawOperation.isCompleted||this.drawOperation.cancel()}};function ye(e){switch(e){case"polygon":case"point":return e;case"circle":case"rectangle":return"segment"}}n([l({value:!1})],y.prototype,"centeredToggled",null),n([l()],y.prototype,"drawOperation",void 0),n([l({value:!0})],y.prototype,"enabled",null),n([l({value:!1})],y.prototype,"uniformSizeToggled",null),n([l({constructOnly:!0})],y.prototype,"geometryType",void 0),n([l({constructOnly:!0})],y.prototype,"mode",void 0),n([l({readOnly:!0})],y.prototype,"type",void 0),n([l({readOnly:!0})],y.prototype,"updating",null),n([l({constructOnly:!0,nonNullable:!0})],y.prototype,"view",void 0),n([l()],y.prototype,"cursor",null),y=n([v("esri.views.draw.DrawScreenTool")],y);var he=48;function ge(){return p(this,null,function*(){return import("./chunk-FOYQ56X5.js")})}function fe(){return p(this,null,function*(){return ge().then(({contains:e,intersects:t,overlaps:o,simplify:s})=>({contains:e,intersects:t,overlaps:o,simplify:s}))})}function de(e){return p(this,null,function*(){let{currentSelection:t,selector:o,signal:s,sources:r,view:i}=e;if(!r?.length)return{added:[],removed:[]};let{layers:a,layerViews:c,graphicsLayers:u}=_e(r),d=(yield T(Promise.all([we(o,a,i,s),ke(o,c,i,s),ve(o,u,i)]),s)).flat();if(!t)return{added:d,removed:[]};let h=t.toArray(),g=d.filter(x=>!pe(h,x)),b=h.filter(x=>!pe(d,x));return t.removeMany(b),t.addMany(g),{added:g,removed:b}})}var ve=(e,t,o)=>p(void 0,null,function*(){return Oe({candidates:t.flatMap(s=>s.graphics.toArray())??[],selector:e,view:o})}),we=(e,t,o,s)=>p(void 0,null,function*(){let r=yield w(Se({selector:e,signal:s,layers:t,view:o}));return r?me(r):[]}),ke=(e,t,o,s)=>p(void 0,null,function*(){let r=yield w(be({selector:e,signal:s,layerViews:t,view:o}));return r?me(r):[]});function me(e){let t=[];for(let o=0;o<e.length;o++){let s=e[o];s.status==="fulfilled"&&t.push(...s.value)}return t}function _e(e){let t=[],o=[],s=[];return e.forEach(r=>{G(r)?t.push(r):(P(r)||j(r))&&r.layers?.length?t.push(...r.layers.toArray()):z(r)&&r.sublayers?.length?s.push(...r.sublayers.toArray()):H(r)?s.push(r):Y(r)&&o.push(r)}),{layers:t,layerViews:o,graphicsLayers:s}}function pe(e,t){if(e.includes(t))return!0;let o=t.getObjectId(),s=o!=null,{layer:r,uid:i}=t;return s?e.some(a=>{if(r===a.layer)return o===a.getObjectId()}):e.some(a=>{if(r===a.layer)return i===a.uid})}function be(e){return p(this,null,function*(){let{layerViews:t,selector:o,signal:s,view:r}=e;return T(Promise.allSettled(t.map(i=>p(this,null,function*(){let a=i.createQuery(),{geometry:c}=ue(o,i.layer,r);return a.outFields=["*"],a.geometry=c,a.returnGeometry=!0,a.outSpatialReference=r.spatialReference,i.queryFeatures(a,{signal:s}).then(({features:u})=>u)}))),s)})}function Se(e){return p(this,null,function*(){let{layers:t,selector:o,signal:s,view:r}=e;return T(Promise.allSettled(t.map(i=>p(this,null,function*(){return i.queryFeatures(Te(i.createQuery(),o,i,r),{signal:s}).then(({features:a})=>a)}))),s)})}function ue(e,t,o){let s="renderer"in t?oe({renderer:t.renderer}):0,r=e.type==="point"?se(e,s,o):e,i="displayField"in t?t.displayField:null,a=J({displayField:i,fields:t.fields}),c=[t.objectIdField];if(a!=null&&t.fieldsIndex.has(a)&&c.push(a),"globalIdField"in t&&t.globalIdField!=null&&t.fieldsIndex.has(t.globalIdField)&&c.push(t.fieldsIndex.get(t.globalIdField).name),I(t)&&t.subtypeField!=null&&t.fieldsIndex.has(t.subtypeField)&&c.push(t.fieldsIndex.get(t.subtypeField).name),"utilityNetworks"in o.map&&o.map.utilityNetworks?.length&&(I(t)||t.type==="feature")){let u=t.fieldsIndex.get("assetgroup"),d=t.fieldsIndex.get("assettype");u?.name&&c.push(u.name),d?.name&&c.push(d.name)}return{geometry:r,outFields:c}}function Te(e,t,o,s){let{outFields:r,geometry:i}=ue(t,o,s);return e.outFields=r,e.geometry=i,e.returnGeometry=!0,e.outSpatialReference=s.spatialReference,e}function Oe(e){return p(this,null,function*(){let{selector:t,candidates:o,view:s}=e;if(!o?.length||!t)return[];let{spatialReference:r}=s,i=t,a=yield fe();return o.filter(c=>c.geometry&&c.geometry.type!=="mesh"&&a.intersects(r,i,c.geometry))})}var xe=100,f=class extends O.EventedAccessor{constructor(e){super(e),this._processTask=null,this.options=null,this.selection=new L,this.sources=null,this._process=$((t,o)=>p(this,null,function*(){let{callback:s,selector:r,completed:i}=t,a=E(c=>p(this,null,function*(){let{options:u,sources:d,selection:h,view:g}=this;if(!(!d?.length&&!g?.selectionManager.sources.length)&&g){if(r&&d!=null){let b=yield de({currentSelection:h,selector:r,signal:c,sources:d,view:g});i&&u?.persistSelection!==!1&&g.selectionManager?.updateSelection(A({current:h.toArray()},b))}s&&s()}else h.removeAll()}));return M(o,()=>a.abort()),this._processTask=a,a.promise}),xe)}initialize(){this._setup()}cancel(){this.removeAllHandles(),this._processTask?.abort()}_setup(){return p(this,null,function*(){let{view:e}=this;if(yield e.whenReady(),this.destroyed)return;let t=this.options,o=t?.createTool??"rectangle",s=t?.mode??(o==="polygon"?"click":"hybrid"),r=Symbol();this._tool=new y({view:e,mode:s,geometryType:o}),t?.selectOnComplete||this.addHandles(this._tool.on(["cursor-update","vertex-add","vertex-remove"],()=>w(this._process({selector:this._selectionArea}))),r),this.addHandles([e.on("key-down",i=>{if(!i.repeat)switch(i.key){case _.constraint:this._tool.uniformSizeToggled=!0,i.stopPropagation();break;case _.center:this._tool.centeredToggled=!0,i.stopPropagation()}}),e.on("key-up",i=>{switch(i.key){case _.constraint:this._tool.uniformSizeToggled=!1,i.stopPropagation();break;case _.center:this._tool.centeredToggled=!1,i.stopPropagation()}}),this._tool.on("complete",i=>p(this,null,function*(){this.removeHandles(r);let a=()=>{this.removeAllHandles(),this.emit("complete",{aborted:i.aborted,selection:this.selection.toArray()})};i.aborted?(this.cancel(),this.selection.removeAll(),a()):yield this._process({selector:this._selectionArea,callback:a,completed:!0})}))],r),this.addHandles(S(()=>e.tools.remove(this._tool))),e.addAndActivateTool(this._tool)})}get _selectionArea(){let e=U(),t=this._tool.coordinates,o=this.view.spatialReference,s=i=>{e.x=i[0],e.y=i[1];let{x:a,y:c}=this.view.toMap(e);return[a,c]};if(t.length===0)return;if(t.length===1||t.every(([i,a])=>i===t[0][0]&&a===t[0][1])){let[i,a]=s(t[0]);return new R({x:i,y:a,spatialReference:o})}let r=t.map(s);if(r.length!==0)return K(r)||r.reverse(),new Z({spatialReference:o,rings:[r]})}};n([l()],f.prototype,"options",void 0),n([l({readOnly:!0})],f.prototype,"selection",void 0),n([l()],f.prototype,"sources",void 0),n([l({constructOnly:!0})],f.prototype,"view",void 0),f=n([v("esri.widgets.support.Selector2D.SelectionOperation")],f);var Dt=f;export{Dt as a};
