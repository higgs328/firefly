import{c as v,f as y,g as _,i as Dt,j as S,k as Q,l as R,o as Ot,p as Pt,q as B,r as $,t as tt,u as jt,y as Vt}from"./chunk-CHALI33A.js";import{c as X}from"./chunk-2I3LIA7G.js";import{a as M}from"./chunk-EBLTZITF.js";import{a as H}from"./chunk-GUIIGAD3.js";import{d as Y}from"./chunk-H2NTHPNN.js";import{a as q}from"./chunk-KJFE7WVE.js";import{n as Et}from"./chunk-7HMNN4FJ.js";import{a as Ft}from"./chunk-342NGUMP.js";import{c as Ct}from"./chunk-GNEAU6X4.js";import{a as Zt}from"./chunk-LAX5536Z.js";import{F as L,G as wt,K as xt,d as ft,j as pt,l as T,p as gt,q as ht,r as yt,t as dt}from"./chunk-GJ2QRXGN.js";import{b as A}from"./chunk-HKJZ7WI6.js";import{b as Bt}from"./chunk-EO2H4LIH.js";import{a as Gt,d as Tt}from"./chunk-DJW5LMRG.js";import{a as At}from"./chunk-DEH76MSI.js";import{a as Mt}from"./chunk-ALWV3RJ2.js";import{b as vt,c as p,d as Rt,e as bt,n as zt,p as U,z as St}from"./chunk-6B5XFA6F.js";import{o as N,p as w}from"./chunk-DA3SDKGO.js";import{a as ut}from"./chunk-MDZTV2VL.js";import{a as z}from"./chunk-BOVYXYHK.js";import{D as mt,a as lt}from"./chunk-KVM6SHDX.js";import{m as ct}from"./chunk-ZQIC5NFT.js";import{c as d}from"./chunk-VIEK2X23.js";import{a as st}from"./chunk-XKIFGPJO.js";import{a as K}from"./chunk-7F5DJLJT.js";import{c as J}from"./chunk-RAI4DTMT.js";import{p as k}from"./chunk-4PTIEWMT.js";import{b as W}from"./chunk-YOFFGXOB.js";import{f}from"./chunk-VTHXE323.js";var Lt=.66;function Wt(t){return 360-Y.normalize(t)}function D(t){return Y.normalize(360-t)}function Wn(t,n,e){let a=n.camera;if(a!=null)return Ut(a,_(t));let{targetGeometry:i}=n;if(i==null)return null;let{camera:o,mode:r}=kt(t,n.rotation,e);if(i.type==="point")return Yt(t,n,i,o,r);let s=i.extent;return s==null?null:jt(t,s,o.heading,o.tilt,r)}function Nt(t,n,e,a){return f(this,null,function*(){let i=n.camera;if(i!=null)return qt(i,_(t),a);let{targetGeometry:o}=n;if(o==null)throw new Error("Viewpoint has no targetGeometry!");let{camera:r,mode:s}=kt(t,n.rotation,e);if(o.type==="point")return Ht(t,n,o,r,s,a);let c=o.extent;if(c==null)throw new Error("Target geometry has no extent!");return tt(t,c,r.heading,r.tilt,s,a)})}function Ut(t,n){let e=t.position,a;try{a=N(e,n)}catch{return null}if(!a)return null;let i=t.clone();return i.position=a.clone(),i}function qt(t,n,e){return f(this,null,function*(){let a=t.position,i=yield w(a,n,{signal:e});k(e);let o=t.clone();return o.position=i.clone(),o})}function kt(t,n,e){let a=S(t,t.state.camera),i=y.ADJUST;return n!=null&&(a.heading=Wt(n),i=y.LOCKED),e!=null&&(a.tilt=e),{camera:a,mode:i}}function Yt(t,n,e,a,i){let o=t.spatialReference,r;try{r=N(e.clone(),o)}catch{return null}if(!r)return null;let s=n.scale!=null?Q(t,n.scale):t.state.camera.distance;return Pt(t,r,s,a,i)}function Ht(t,n,e,a,i,o){return f(this,null,function*(){let r=t.spatialReference,s=yield w(e.clone(),r,{signal:o});k(o);let c=n.scale!=null?Q(t,n.scale):t.state.camera.distance;return B(t,s,c,a,i,o)})}function kn(t,n,e=null){return e==null&&(e=new M),rt(t,null,n.clone(),e)}function Jn(t,n,e){return f(this,null,function*(){let a=rn(t,n);if(!a)throw new W("viewpointutils-create:no-target","Missing target for creating viewpoint");let i=new H({fov:t.camera.fov}),o=new M({camera:i});if(a.target instanceof M)return x(yield Qt(t,a.target,a,e,o));if(a.target instanceof H)return x(yield Kt(t,a.target,e,o));let r=a.scale!=null||a.zoom!=null;if(a.target instanceof ct){let m=a.target.xmin===a.target.xmax||a.target.ymin===a.target.ymax;return x(r||m?yield at(t,a,a.target.center,i,e,o):yield en(t,a,a.target,i,e,o))}let s=new ot,c=r?Xt(t,a):void 0;if(yield Jt(t,a.target,c,s,e),isFinite(s.boundingBox[0])){let m;if(dt(s.boundingBox,l),g.x=l[0],g.y=l[1],g.z=l[2],g.spatialReference=t.spatialReference,isFinite(g.z)&&s.hasZ?m=xt(s.boundingBox):(g.z=void 0,m=mt(wt(s.boundingBox,cn))),r||m)return x(yield at(t,a,g,i,e,o));let h=sn(t,s.screenSpaceObjects);return x(yield on(t,a,g,s.boundingBox,h,i,e,o))}return a.position?x(yield tn(t,a,i,o,e)):x(yield nn(t,a,i,e,o))})}function it(t,n){return n.scale==null&&n.zoom!=null?Vt(t,n.zoom):n.scale}function Xt(t,n){let e=it(t,n);return e?Ct(e):void 0}function O(t,n){let e=!1;return n.heading!=null?(t.heading=n.heading,e=!0):n.rotation!=null&&(t.heading=Wt(n.rotation),e=!0),n.tilt!=null&&(t.tilt=n.tilt,e=!0),n.fov!=null&&(t.fov=n.fov),e}function rt(t,n,e,a){let i=t.spatialReference||K.WGS84;if(n??=Dt(t,e),n==null)return a;let o=new d({spatialReference:i});return q(n.center,t.renderSpatialReference,o)&&(a.targetGeometry=o,a.scale=R(t,n.distance),a.rotation=D(e.heading),a.camera=e),a}function E(t,n,e,a){return f(this,null,function*(){let i=()=>new W("viewpointutils:invalid-geometry","The target is missing a valid geometry");if(!n)throw i();n.type==="mesh"&&(n=n.extent);let o=t.basemapTerrain.spatialReference;if(!n.hasZ&&t.basemapTerrain){let u;switch(n.type){case"point":u=n;break;case"multipoint":case"polyline":u=n.extent?.center;break;case"extent":u=n.center;break;case"polygon":u=n.centroid}u!=null&&o&&t.elevationProvider?(u=yield w(u,o,{signal:a}),l[2]=X(t.elevationProvider,u)??0):l[2]=0}let r=ln[n.type],s=new Array;if(r(n,n.hasZ?u=>{s.push([u[0],u[1],u[2]])}:u=>{s.push([u[0],u[1]])},l),s.length===0)throw i();let c=n.spatialReference,m=t.spatialReference,h=yield w(new ut({spatialReference:c,hasZ:n.hasZ,hasM:!1,points:s}),m,{signal:a});if(n.hasZ&&(e.hasZ=!0),n.hasZ)for(let[u,b,P]of h.points)l[0]=u,l[1]=b,l[2]=P,T(e.boundingBox,l);else for(let[u,b]of h.points)l[0]=u,l[1]=b,T(e.boundingBox,l)})}function _t(t,n,e,a,i){return f(this,null,function*(){let o=yield J(t.whenViewForGraphic(n));if(o.ok===!1||o.value==null||!("whenGraphicBounds"in o.value))return void(yield E(t,n.geometry,a,i));let r=o.value,s=yield J(r.whenGraphicBounds(n,{minDemResolution:e}));if(s.ok===!1||!s.value)return void(yield E(t,n.geometry,a,i));let{screenSpaceObjects:c,boundingBox:m}=s.value;pt(a.boundingBox,m),c&&c.forEach(h=>{a.screenSpaceObjects.push(h)}),isFinite(m[2])&&(a.hasZ=!0)})}function Jt(t,n,e,a,i){return f(this,null,function*(){if(Array.isArray(n)&&n.length===2){let o=n[0],r=n[1];if(typeof o=="number"&&typeof r=="number")return g.x=o,g.y=r,g.z=void 0,g.spatialReference=t.spatialReference?.isGeographic?t.spatialReference:K.WGS84,void(yield E(t,g,a,i))}n&&"map"in n&&typeof n.map=="function"?yield Promise.allSettled(n.map(o=>Jt(t,o,e,a,i))):n instanceof st?yield E(t,n,a,i):n instanceof Zt&&(yield _t(t,n,e,a,i))})}function Qt(t,n,e,a,i){return f(this,null,function*(){if(n.camera)return Kt(t,n.camera,a,i);i.scale=n.scale,i.rotation=n.rotation,i.targetGeometry=n.targetGeometry!=null?n.targetGeometry.clone():null,i.camera=null,e.heading!=null?i.rotation=D(e.heading):e.rotation!=null&&(i.rotation=e.rotation);let o=it(t,e);return o!=null&&(i.scale=o),i.camera=yield Nt(t,i,e.tilt,a),i})}function Kt(t,n,e,a){return f(this,null,function*(){let i=t.spatialReference,o=yield w(n.position,i,{signal:e}),r=n.clone();return r.position=o,rt(t,null,r,a)})}function $t(t,n,e,a,i,o,r){return f(this,null,function*(){let s=t.renderSpatialReference;return yield A(n,nt,s,0,{signal:r}),yield A(e,C,s,0,{signal:r}),o.targetGeometry=new d(n),i.position=new d(e),bt(F,nt,C),$(t,C,F,a.up,i),o.scale=R(t,U(C,nt)),o.rotation=D(i.heading),o.camera=i,o})}function at(t,n,e,a,i,o){return f(this,null,function*(){o.targetGeometry=e.clone();let r=v(t);if(n.position)return $t(t,o.targetGeometry,n.position,r,a,o,i);if(n.zoomFactor){let c=r.distance/n.zoomFactor,m=zt(l,r.viewForward,-c);r.eye=Rt(l,r.center,m),o.scale=R(t,c)}S(t,r,a);let s=O(a,n)?y.LOCKED:y.ADJUST;if(!n.zoomFactor){let c=it(t,n);if(c==null){yield A(o.targetGeometry,l,t.renderSpatialReference,0,{signal:i});let m=Et(r.frustum,l)?U(r.eye,l):r.distance;o.camera=yield B(t,o.targetGeometry,m,a,s),o.scale=R(t,m)}else o.scale=c,o.camera=yield Ot(t,o.targetGeometry,o.scale,a,s,i)}return o})}function tn(t,n,e,a,i){return f(this,null,function*(){let o=v(t);vt(F,o.viewForward),$(t,o.eye,F,o.up,et);let r=t.spatialReference,{position:s}=n;if(s){let c=yield w(s,r,{signal:i});e.position=c}else e.position=new d;return e.heading=n.heading!=null?n.heading:et.heading,e.tilt=n.tilt!=null?n.tilt:et.tilt,rt(t,null,e,a)})}function nn(t,n,e,a,i){return f(this,null,function*(){if(n.heading!=null||n.rotation!=null||n.scale!=null||n.tilt!=null||n.zoom!=null||n.zoomFactor!=null){let o=v(t),{spatialReference:r,renderSpatialReference:s}=t,c=new d({spatialReference:r});return q(o.center,s,c)?at(t,n,c,e,a,i):i}return i.scale=t.scale,i.camera=t.camera.clone(),O(i.camera,n),i})}function en(t,n,e,a,i,o){return f(this,null,function*(){o.targetGeometry=e.clone();let r=v(t);S(t,r,a);let s=O(a,n)?y.LOCKED:y.ADJUST;return o.camera=yield tt(t,e,a.heading,a.tilt,s,i),o})}function an(t,n,e,a,i){let o=0;e.z!=null?o=e.z:t.basemapTerrain&&t.elevationProvider&&(o=X(t.elevationProvider,e)),p(l,e.x,e.y,o),Bt(t.spatialReference,l,It,t.renderSpatialReference),Gt(Z,It),Tt(Z,Z),L(G);let r=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];for(let j=0;j<r.length;j++){let V=r[j],I=a[V[2]];isFinite(I)||(I=o),p(l,a[V[0]],a[V[1]],I),Ft(l,t.spatialReference,l,t.renderSpatialReference),T(G,St(l,l,Z))}let s=gt(G),c=yt(G),m=ht(G),h=1/Math.tan(n.fovX/2),u=1/Math.tan(n.fovY/2),b=.5*Math.sqrt(s*s+m*m)*Math.max(u,h)+.5*c,P=.5*c*u+.5*Math.max(s,m);return Math.max(b,P)/i}function on(t,n,e,a,i,o,r,s){return f(this,null,function*(){s.targetGeometry=e.clone();let c=v(t),m=an(t,c,e,a,i);S(t,c,o);let h=O(o,n)?y.LOCKED:y.ADJUST;return s.camera=yield B(t,s.targetGeometry,m,o,h,r),s.scale=R(t,m),s})}function rn(t,n){if(!n||!t.spatialReference)return null;let e={target:void 0};return"declaredClass"in n||Array.isArray(n)?e.target=n:(Object.assign(e,n),!e.target&&"center"in n&&n.center&&(e.target=n.center)),e}function x(t){return t?.camera!=null&&(t.rotation=D(t.camera.heading)),t}function sn(t,n){let e=Lt;if(!n.length)return e;let a=Number.NEGATIVE_INFINITY;for(let i=0;i<n.length;i++){let o=n[i].screenSpaceBoundingRect;a=Math.max(a,Math.abs(o[0]),Math.abs(o[1]),Math.abs(o[2]),Math.abs(o[3]))}return e-a/Math.min(t.width,t.height)*2}var ot=class{constructor(){this.hasZ=!1,this.boundingBox=L(),this.screenSpaceObjects=new Array}},l=z(),It=Mt(),Z=At(),G=ft(),cn=lt(),F=z(),C=z(),nt=z(),et={heading:0,tilt:0},g=new d,ln={point(t,n,e){e[0]=t.x,e[1]=t.y,t.z!=null&&(e[2]=t.z),n(e)},polygon(t,n,e){let a=t.hasZ;for(let i=0;i<t.rings.length;i++){let o=t.rings[i];for(let r=0;r<o.length;r++)e[0]=o[r][0],e[1]=o[r][1],a&&(e[2]=o[r][2]),n(e)}},polyline(t,n,e){let a=t.hasZ;for(let i=0;i<t.paths.length;i++){let o=t.paths[i];for(let r=0;r<o.length;r++)e[0]=o[r][0],e[1]=o[r][1],a&&(e[2]=o[r][2]),n(e)}},multipoint(t,n,e){let a=t.points,i=t.hasZ;for(let o=0;o<a.length;o++)e[0]=a[o][0],e[1]=a[o][1],i&&(e[2]=a[o][2]),n(e)},extent(t,n,e){t.zmin!=null&&t.zmax!=null?(n(p(e,t.xmin,t.ymin,t.zmin)),n(p(e,t.xmax,t.ymin,t.zmin)),n(p(e,t.xmin,t.ymax,t.zmin)),n(p(e,t.xmax,t.ymax,t.zmin)),n(p(e,t.xmin,t.ymin,t.zmax)),n(p(e,t.xmax,t.ymin,t.zmax)),n(p(e,t.xmin,t.ymax,t.zmax)),n(p(e,t.xmax,t.ymax,t.zmax))):(n(p(e,t.xmin,t.ymin,e[2])),n(p(e,t.xmax,t.ymin,e[2])),n(p(e,t.xmin,t.ymax,e[2])),n(p(e,t.xmax,t.ymax,e[2])))}};export{Wn as a,Nt as b,kn as c,Jn as d};
