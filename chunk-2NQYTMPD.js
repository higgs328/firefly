import{a as v}from"./chunk-Y6AUTJNM.js";import{a as w}from"./chunk-PKVI3POI.js";import{a as F}from"./chunk-55O4EG62.js";import{n as y}from"./chunk-Y4PJQPM4.js";import{a as V}from"./chunk-JQAW4OB5.js";import{a as M}from"./chunk-K75TK42V.js";import{a as l,c as _,j as c}from"./chunk-TG45K3WR.js";import{a as s}from"./chunk-QGVBCWUY.js";import{e as i}from"./chunk-NFIPKH6V.js";import{l as g}from"./chunk-5QEXLALV.js";import{z as f}from"./chunk-4PTIEWMT.js";import{a as h,b as m,f as d}from"./chunk-VTHXE323.js";var e=class extends M.IdentifiableMixin(v){constructor(t){super(t),this.group=null,this.type="utilityNetworkAssociations",this.featureItem=null,this._updatingHandlesSetUp=new V,this.addHandles([l(()=>({feature:this.feature,element:this.element,layer:this.layer}),a=>this._createAssociationVM(a),c),l(()=>this.feature,()=>this._setFeatureItem()),l(()=>this.associatedLayer,(a,o)=>this._updateLayerEditHandle(a,o),c)])}destroy(){this._associationsVM?.destroy(),this._updatingHandlesSetUp.destroy()}get activeAssociationType(){return this._associationsVM?.activeAssociationType}get associatedFeatures(){let{associatedLayer:t}=this;if(t)return this.associatedFeatureInfos.get(t)}get associatedFeatureInfos(){let{_associationsVM:t}=this;if(!t?.associationFeatures?.size||!t?.utilityNetwork)return new Map;let{associationFeatures:a}=t,o=new Map;return a.forEach((r,p)=>{let u=r.map(n=>{if(n.title==null){let b=w(n.feature);return m(h({},n),{title:b})}return n});o.set(p,u)}),o}get associatedLayer(){return this._get("associatedLayer")}set associatedLayer(t){this._associationsVM.showAllEnabled=t!=null,this._set("associatedLayer",t)}get associationsViewModel(){return this._associationsVM}get canAddAssociation(){let{editable:t,utilityNetwork:a}=this;return!(!a||!this.loaded)&&t}get editable(){return this.evaluatedEditableExpression??!0}get featureCount(){return this._associationsVM?.featureCount??0}get viewModel(){return this._associationsVM}get loaded(){return this._associationsVM?.state!=="loading"&&!this._updatingHandlesSetUp.updating}get map(){return this._get("map")}set map(t){t&&this._associationsVM?.set("map",t),this._set("map",t)}get utilityNetwork(){return this._associationsVM?.utilityNetwork}get associationTypes(){return this._associationsVM?.associationTypes??this.element.associationTypes}get visible(){let{utilityNetwork:t}=this;return!!t&&(this.evaluatedVisibilityExpression!=null?this.evaluatedVisibilityExpression:this.element!=null)}get updating(){return this._associationsVM?.state==="loading"||this._associationsVM?.state==="querying"}refresh(){return d(this,null,function*(){yield f(this._associationsVM.refresh())})}_updateLayerEditHandle(t,a){a&&"layerId"in a&&this.removeHandles(a?.layerId),y(t)&&this.addHandles(_(()=>t,"edits",()=>this.refresh()),t.layerId)}_createAssociationVM(t){let{feature:a,element:o,layer:r}=t;if(this._associationsVM?.destroy(),!a||!o||!r)return;let{map:p,associationTypes:u}=this;y(r)&&(this._associationsVM=new F({graphic:a,layer:r,map:p,associationTypes:u,source:"featureForm",title:this.label,description:this.description}))}_setFeatureItem(){this._updatingHandlesSetUp.addPromise(d(this,null,function*(){let{feature:t,layer:a}=this;t&&a&&"getFeatureTitle"in a&&(this.featureItem={feature:t,label:yield a.getFeatureTitle(t)})}))}};s([i()],e.prototype,"_associationsVM",void 0),s([i()],e.prototype,"activeAssociationType",null),s([i()],e.prototype,"associatedFeatures",null),s([i()],e.prototype,"associatedFeatureInfos",null),s([i()],e.prototype,"associatedLayer",null),s([i()],e.prototype,"associationsViewModel",null),s([i()],e.prototype,"canAddAssociation",null),s([i()],e.prototype,"editable",null),s([i()],e.prototype,"featureCount",null),s([i()],e.prototype,"viewModel",null),s([i()],e.prototype,"group",void 0),s([i()],e.prototype,"loaded",null),s([i()],e.prototype,"map",null),s([i()],e.prototype,"utilityNetwork",null),s([i()],e.prototype,"associationTypes",null),s([i({readOnly:!0})],e.prototype,"type",void 0),s([i()],e.prototype,"visible",null),s([i()],e.prototype,"updating",null),s([i()],e.prototype,"featureItem",void 0),e=s([g("esri.widgets.FeatureForm.UtilityNetworkAssociationInput")],e);var O=e;export{O as a};
