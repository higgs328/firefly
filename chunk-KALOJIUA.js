import{b as z}from"./chunk-KMMTNF7G.js";import{d as o,e as G}from"./chunk-HX2VGIR2.js";import{a as H}from"./chunk-JLPLCY2B.js";import{e as f}from"./chunk-VDO6JJ3Y.js";import{t as c}from"./chunk-MYO4NP2N.js";import{i as P}from"./chunk-4PTIEWMT.js";import{b as C}from"./chunk-YOFFGXOB.js";import{b as U,c as k}from"./chunk-6MRUJ2UW.js";import{a as R,b as $,f as a}from"./chunk-VTHXE323.js";var X="HH:mm",I="HH:mm:ss",j="HH:mm:ss.SSS",ze={HM:X,HMS:I,HMS_MS:j},re=[j,I,X,"TT"],le="yyyy-MM-dd",Xe=I;function b(e){if(!e||!o(e))return null;let i=f.fromFormat(e,le);return i.isValid?i:null}function x(e){return e&&o(e)?P(re,i=>{let n=f.fromFormat(e,i);return n.isValid?n:null})??null:null}function w(e){if(!e||!o(e))return null;let i=f.fromISO(e);return i.isValid?i:null}var s;(function(e){e.VALUE_OUT_OF_RANGE="domain-validation-error::value-out-of-range",e.INVALID_CODED_VALUE="domain-validation-error::invalid-coded-value"})(s||(s={}));var q=new Set(["integer","small-integer","big-integer","esriFieldTypeInteger","esriFieldTypeSmallInteger","esriFieldTypeBigInteger"]);function ae(e){return e!=null&&q.has(e.type)}function E(e){return e!=null&&(e.type==="date-only"||e.type==="esriFieldTypeDateOnly")}function h(e){return e!=null&&(e.type==="timestamp-offset"||e.type==="esriFieldTypeTimestampOffset")}function S(e){return e!=null&&(e.type==="time-only"||e.type==="esriFieldTypeTimeOnly")}var se=new Set(["single","double","esriFieldTypeSingle","esriFieldTypeDouble"]),oe=c(q,se);function ue(e){return e!=null&&oe.has(e.type)}function de(e){return e!=null&&(e.type==="string"||e.type==="esriFieldTypeString")}function Je(e,i,n){let t=n??e?.domain;if(!t)return null;switch(t.type){case"range":{let{min:r,max:l}=m(e,t);if(r!=null&&+i<r||l!=null&&+i>l)return s.VALUE_OUT_OF_RANGE;break}case"coded-value":case"codedValue":if(t.codedValues==null||t.codedValues.every(r=>r==null||r.code!==i))return s.INVALID_CODED_VALUE}return null}function m(e,i){let n=i??e?.domain;if(!n||n.type!=="range")return;let t="range"in n?n.range[0]:n.minValue,r="range"in n?n.range[1]:n.maxValue,l=ae(e);return E(e)||S(e)||h(e)?$(R({},ce(e,r,t)),{isInteger:l}):{min:t!=null&&typeof t=="number"?t:null,max:r!=null&&typeof r=="number"?r:null,rawMin:t,rawMax:r,isInteger:l}}function Qe(e,i){switch(i.type){case"range":{let{min:n,max:t}=m(e,i);return E(e)||S(e)||h(e)?!!n&&!!t:typeof n=="number"&&Number.isFinite(n)&&typeof t=="number"&&Number.isFinite(t)}case"codedValue":case"coded-value":{let n=typeof i.codedValues[0].code;if(n==="string"&&de(e)||n==="number"&&ue(e))return!0}}return!1}function ce(e,i,n){return E(e)?{min:b(n)?.toMillis(),max:b(i)?.toMillis(),rawMin:n,rawMax:i}:S(e)?{min:x(n)?.toMillis(),max:x(i)?.toMillis(),rawMin:n,rawMax:i}:h(e)?{min:w(n)?.toMillis(),max:w(i)?.toMillis(),rawMin:n,rawMax:i}:{max:null,min:null}}function B(e){if(!e)return;let i=e.match(fe);return i?.groups?i.groups.doubleQuoted??i.groups.singleQuoted??i.groups.dotNotation:void 0}var fe=/^(\$feature\[(?:"(?<doubleQuoted>[^"]+)"|'(?<singleQuoted>[^']+)')\]|\$feature\.(?<dotNotation>[a-zA-Z_][a-zA-Z0-9_]*))$/i;function Ze(e){return e.match(me)?.[1]?.replace(/\\'/g,"'")??null}var me=/^hash\(\$feature\['((\\'|[^'])+)'\]\) \* 8\.381e-8$/;var pe=/^([0-9_])/,ge=/[^a-z0-9_\u0080-\uffff]+/gi;function oi(e){return e==null?null:e.trim().replaceAll(ge,"_").replace(pe,"F$1")||null}var ye=["field","field2","field3","normalizationField","rotationInfo.field","proportionalSymbolInfo.field","proportionalSymbolInfo.normalizationField","colorInfo.field","colorInfo.normalizationField"],Fe=["field","normalizationField"];function ui(e,i){if(e!=null&&i!=null){for(let n of Array.isArray(e)?e:[e])if(J(ye,n,i),"visualVariables"in n&&n.visualVariables)for(let t of n.visualVariables)J(Fe,t,i)}}function J(e,i,n){if(e)for(let t of e){let r=U(t,i),l=r&&typeof r!="function"&&n.get(r);l&&k(t,l.name,i)}}function di(e,i){if(e!=null&&i?.fields?.length)if("startField"in e){let n=i.get(e.startField),t=i.get(e.endField);e.startField=n?.name??null,e.endField=t?.name??null}else{let n=i.get(e.startTimeField),t=i.get(e.endTimeField);e.startTimeField=n?.name??null,e.endTimeField=t?.name??null}}var N=new Set;function F(e,i){return e&&i?(N.clear(),p(N,e,i),Array.from(N).sort()):[]}function p(e,i,n){if(n)if(i?.fields?.length)if(n.includes("*"))for(let{name:t}of i.fields)e.add(t);else for(let t of n)T(e,i,t);else{if(n.includes("*"))return e.clear(),void e.add("*");for(let t of n)t!=null&&e.add(t)}}function T(e,i,n){if(typeof n=="string")if(i){let t=i.get(n);t&&e.add(t.name)}else e.add(n)}function ci(e,i){return i==null||e==null?[]:i.includes("*")?(e.fields??[]).map(n=>n.name):i}function fi(e,i,n=1){if(!i||!e)return[];if(i.includes("*"))return["*"];let t=F(e,i);return t.length/e.fields.length>=n?["*"]:t}function u(e,i,n){return a(this,null,function*(){if(!n)return;let t,r=B(n);if(r)t=[r];else{let{arcadeUtils:l}=yield z();t=l.extractFieldNames(n,i?.fields?.map(d=>d.name))}for(let l of t)T(e,i,l)})}function O(e,i,n){return a(this,null,function*(){if(n&&n!=="1=1"){let t=yield H(n,i);if(!t.isStandardized)throw new C("fieldUtils:collectFilterFields","Where clause is not standardized",{where:n});p(e,i,t.fieldNames)}})}function mi({displayField:e,fields:i}){return e||(i?.length?D(i,"name-or-title")||D(i,"unique-identifier")||D(i,"type-or-category")||Te(i):null)}function Te(e){for(let i of e){if(!i?.name)continue;let n=i.name.toLowerCase();if(n.includes("name")||n.includes("title"))return i.name}return null}function D(e,i){for(let n of e)if(n?.valueType&&n.valueType===i)return n.name;return null}function pi(e){return a(this,null,function*(){if(!e)return[];let i=new Set;return yield Ie(i,e),Array.from(i).sort()})}function Ie(e,i){return a(this,null,function*(){if(!i)return;let n=i.elevationInfo?.featureExpressionInfo;return n?n.collectRequiredFields(e,i.fieldsIndex):void 0})}function be(e,i,n){n.onStatisticExpression?u(e,i,n.onStatisticExpression.expression):e.add(n.onStatisticField)}function gi(e,i,n){return a(this,null,function*(){if(!i||!n||!("fields"in n))return;let t=[],r=n.popupTemplate;t.push(Q(e,i,r)),n.fields&&t.push(...n.fields.map(l=>a(this,null,function*(){return be(e,i.fieldsIndex,l)}))),yield Promise.all(t)})}function yi(e,i){return a(this,null,function*(){let{fieldsIndex:n,trackInfo:t}=i;if(!i||!t||!n)return;let r=[t.latestObservations.renderer?.collectRequiredFields(e,n),t.previousObservations.renderer?.collectRequiredFields(e,n),t.trackLines.renderer?.collectRequiredFields(e,n)];t.popupTemplate&&r.push(Q(e,i,t.popupTemplate));for(let l of[t.latestObservations.labelingInfo,t.previousObservations.labelingInfo,t.trackLines.labelingInfo])if(l)for(let d of l)r.push(Z(e,n,d));yield Promise.all(r)})}function Q(e,i,n){return a(this,null,function*(){let t=[];n?.expressionInfos&&t.push(...n.expressionInfos.map(l=>u(e,i.fieldsIndex,l.expression)));let r=n?.content;if(Array.isArray(r))for(let l of r)l.type==="expression"&&l.expressionInfo&&t.push(u(e,i.fieldsIndex,l.expressionInfo.expression));yield Promise.all(t)})}function Fi(e,i,n){return a(this,null,function*(){i&&(i.timeInfo&&n?.timeExtent&&p(e,i.fieldsIndex,[i.timeInfo.startField,i.timeInfo.endField]),i.floorInfo&&p(e,i.fieldsIndex,[i.floorInfo.floorField]),n?.where!=null&&(yield O(e,i.fieldsIndex,n.where)))})}function Ti(e,i,n){return a(this,null,function*(){i&&n&&(yield Promise.all(n.map(t=>xe(e,i,t))))})}function xe(e,i,n){return a(this,null,function*(){i&&n&&(n.valueExpression?yield u(e,i.fieldsIndex,n.valueExpression):n.field&&T(e,i.fieldsIndex,n.field))})}function Ii(e){return a(this,null,function*(){if(!e)return[];let i="timeInfo"in e&&e.timeInfo;return i?F(e.fieldsIndex,[e.trackIdField,i.startField,i.endField]):[]})}function bi(e){return e?F(e.fieldsIndex,W(e)):[]}function we(e){if(!e)return[];let i=e.geometryFieldsInfo;return i?F(e.fieldsIndex,[i.shapeAreaField,i.shapeLengthField]):[]}function xi(e,i,n){return a(this,null,function*(){if(!i||!n)return;let t=i.fieldsIndex;yield Promise.all(n.filters.map(r=>O(e,t,r.where)))})}var Ee=new Set(["oid","global-id","guid"]),he=new Set(["oid","global-id"]),Se=[/^fnode_$/i,/^tnode_$/i,/^lpoly_$/i,/^rpoly_$/i,/^poly_$/i,/^shape$/i,/^shape_$/i,/^subclass$/i,/^subclass_$/i,/^rings_ok$/i,/^rings_nok$/i,/perimeter/i,/objectid/i,/_i$/i];function Ne(e){let i=new Set;Y(e).forEach(t=>i.add(t)),we(e).forEach(t=>i.add(t.toLowerCase()));let n=e&&"infoFor3D"in e?e.infoFor3D:void 0;return n&&(Object.values(n.assetMapFieldRoles).forEach(t=>i.add(t.toLowerCase())),Object.values(n.transformFieldRoles).forEach(t=>i.add(t.toLowerCase()))),Array.from(i)}function W(e){if(!e)return[];let i="editFieldsInfo"in e&&e.editFieldsInfo;if(!i)return[];let{creationDateField:n,creatorField:t,editDateField:r,editorField:l}=i;return[n,t,r,l].filter(Boolean)}function Y(e){return W(e).map(i=>i.toLowerCase())}function wi(e,i){return e.editable&&!Ee.has(e.type)&&!Y(i).includes(e.name?.toLowerCase()??"")}function Ei(e,i){let n=e.name?.toLowerCase()??"";return!(i?.objectIdField!=null&&n===i.objectIdField.toLowerCase()||i?.globalIdField!=null&&n===i.globalIdField.toLowerCase()||Ne(i).includes(n)||he.has(e.type)||Se.some(t=>t.test(n)))}function hi(e){return a(this,null,function*(){if(!e)return[];let i=new Set;return yield De(i,e),Array.from(i).sort()})}function De(e,i){return a(this,null,function*(){let{labelingInfo:n,fieldsIndex:t}=i;n?.length&&(yield Promise.all(n.map(r=>Z(e,t,r))))})}function Z(e,i,n){return a(this,null,function*(){if(!n)return;let t=n.getLabelExpression(),r=n.where;if(t.type==="arcade")yield u(e,i,t.expression);else{let l=t.expression.match(/{[^}]*}/g);l&&l.forEach(d=>{T(e,i,d.slice(1,-1))})}yield O(e,i,r)})}function Si(e){let i=e.defaultValue;return i!==void 0&&K(e,i)?i:e.nullable?null:void 0}function Ni(e){let i=typeof e=="string"?{type:e}:e;return Re(i)?255:i.type==="esriFieldTypeDate"||i.type==="date"?8:void 0}function M(e){return typeof e=="number"&&!isNaN(e)&&isFinite(e)}function Ve(e){return e===null||M(e)}function _e(e){return e===null||Number.isInteger(e)}function ve(){return!0}function K(e,i){let n;switch(e.type){case"date":case"integer":case"long":case"small-integer":case"big-integer":case"esriFieldTypeDate":case"esriFieldTypeInteger":case"esriFieldTypeLong":case"esriFieldTypeSmallInteger":case"esriFieldTypeBigInteger":n=e.nullable?_e:Number.isInteger;break;case"double":case"single":case"esriFieldTypeSingle":case"esriFieldTypeDouble":n=e.nullable?Ve:M;break;case"string":case"esriFieldTypeString":n=e.nullable?G:o;break;default:n=ve}return arguments.length===1?n:n(i)}var ee=["integer","small-integer","big-integer"],ie=["single","double"],Di=[...ee,...ie],Ae=["esriFieldTypeInteger","esriFieldTypeSmallInteger","esriFieldTypeBigInteger"],Oe=["esriFieldTypeSingle","esriFieldTypeDouble"],ne=new Set([...ee,...Ae]),Me=new Set([...ie,...Oe]),Le=c(ne,Me);function Vi(e){return e!=null&&ne.has(e.type)}function te(e){return e!=null&&Le.has(e.type)}function Re(e){return e!=null&&(e.type==="string"||e.type==="esriFieldTypeString")}function _i(e){return e!=null&&(e.type==="date"||e.type==="esriFieldTypeDate")}function vi(e){return e!=null&&(e.type==="date-only"||e.type==="esriFieldTypeDateOnly")}function Ai(e){return e!=null&&(e.type==="timestamp-offset"||e.type==="esriFieldTypeTimestampOffset")}function Oi(e){return e!=null&&(e.type==="time-only"||e.type==="esriFieldTypeTimeOnly")}function Mi(e){return e!=null&&(e.type==="oid"||e.type==="esriFieldTypeOID")}function Li(e){return e!=null&&(e.type==="global-id"||e.type==="esriFieldTypeGlobalID")}function Ri(e,i){return $e(e,i)===null}var g,y;function $i(e){return e==null||typeof e=="number"&&isNaN(e)?null:e}function $e(e,i){return e==null||e.nullable&&i===null?null:K(e,i)?te(e)&&!Ue(e.type,Number(i))?g.OUT_OF_RANGE:null:y.INVALID_TYPE}function Ue(e,i){let n=typeof e=="string"?L(e):e;if(!n)return!1;let t=n.min,r=n.max;return n.isInteger?Number.isInteger(i)&&i>=t&&i<=r:i>=t&&i<=r}function Ui(e,i){return m(e,i)||(te(e)?L(e.type):void 0)}function L(e){switch(e){case"esriFieldTypeSmallInteger":case"small-integer":return V;case"esriFieldTypeInteger":case"integer":return _;case"esriFieldTypeBigInteger":case"big-integer":return v;case"esriFieldTypeSingle":case"single":return A;case"esriFieldTypeDouble":case"double":return ke}}function ki(e){if(!M(e))return null;if(Number.isInteger(e)){if(e>=V.min&&e<=V.max)return"esriFieldTypeSmallInteger";if(e>=_.min&&e<=_.max)return"esriFieldTypeInteger";if(e>=v.min&&e<=v.max)return"esriFieldTypeBigInteger"}return e>=A.min&&e<=A.max?"esriFieldTypeSingle":"esriFieldTypeDouble"}(function(e){e.OUT_OF_RANGE="numeric-range-validation-error::out-of-range"})(g||(g={})),function(e){e.INVALID_TYPE="type-validation-error::invalid-type"}(y||(y={}));var V={min:-32768,max:32767,isInteger:!0,rawMin:-32768,rawMax:32767},_={min:-2147483648,max:2147483647,isInteger:!0,rawMin:-2147483648,rawMax:2147483647},v={min:-Number.MAX_SAFE_INTEGER,max:Number.MAX_SAFE_INTEGER,isInteger:!0,rawMin:-Number.MAX_SAFE_INTEGER,rawMax:Number.MAX_SAFE_INTEGER},A={min:-34e37,max:12e37,isInteger:!1,rawMin:-34e37,rawMax:12e37},ke={min:-Number.MAX_VALUE,max:Number.MAX_VALUE,isInteger:!1,rawMin:-Number.MAX_VALUE,rawMax:Number.MAX_VALUE};function Ci(e,i,n){switch(e){case s.INVALID_CODED_VALUE:return`Value ${n} is not in the coded domain - field: ${i.name}, domain: ${JSON.stringify(i.domain)}`;case s.VALUE_OUT_OF_RANGE:return`Value ${n} is out of the range of valid values - field: ${i.name}, domain: ${JSON.stringify(i.domain)}`;case y.INVALID_TYPE:return`Value ${n} is not a valid value for the field type - field: ${i.name}, type: ${i.type}, nullable: ${i.nullable}`;case g.OUT_OF_RANGE:{let{min:t,max:r}=L(i.type);return`Value ${n} is out of range for the number type - field: ${i.name}, type: ${i.type}, value range is ${t} to ${r}`}}}function Pi(e,i){return!Ce(e,i,null)}function Ce(e,i,n){if(!i?.attributes||!e){if(n!=null)for(let l of e??[])n.add(l);return!0}let t=new Set(Object.keys(i.attributes)),r=!1;for(let l of e)if(!t.has(l)){if(r=!0,n==null)break;n.add(l)}return r}function Gi(e,i){return a(this,null,function*(){let n=new Set;for(let t of i)yield u(n,e.fieldsIndex,t);return Array.from(n).sort()})}function Hi(e){return!!e&&["raster.itempixelvalue","raster.servicepixelvalue"].some(i=>e.toLowerCase().startsWith(i))}function zi(e,i){return a(this,null,function*(){let n=new Set;return e?.collectRequiredFields&&(yield e.collectRequiredFields(n,i)),Array.from(n).sort()})}function Xi(e){let i=e?.match(/{[^}]+}/g);return i?i.map(n=>n.slice(1,-1).split(":")[0].trim()):[]}export{ze as a,le as b,Xe as c,b as d,x as e,w as f,s as g,Je as h,m as i,Qe as j,ce as k,B as l,Ze as m,oi as n,ye as o,Fe as p,ui as q,di as r,F as s,p as t,T as u,ci as v,fi as w,u as x,mi as y,pi as z,Ie as A,gi as B,yi as C,Q as D,Fi as E,Ti as F,Ii as G,bi as H,we as I,xi as J,Ne as K,W as L,Y as M,wi as N,Ei as O,hi as P,De as Q,Si as R,Ni as S,K as T,ee as U,ie as V,Di as W,Ae as X,Oe as Y,Vi as Z,te as _,Re as $,_i as aa,vi as ba,Ai as ca,Oi as da,Mi as ea,Li as fa,Ri as ga,g as ha,y as ia,$i as ja,$e as ka,Ue as la,Ui as ma,ki as na,V as oa,_ as pa,v as qa,A as ra,ke as sa,Ci as ta,Pi as ua,Ce as va,Gi as wa,Hi as xa,zi as ya,Xi as za};
