import{b as h,c as I,d as x,n as v,s as C,x as O}from"./chunk-6B5XFA6F.js";import{a as l,c as L,f as b}from"./chunk-BOVYXYHK.js";import{b as A,g}from"./chunk-EQZWYK27.js";var _=class{constructor(i=b()){this.intensity=i}},d=class{constructor(i=b(),t=L(.57735,.57735,.57735)){this.intensity=i,this.direction=t}},m=class{constructor(i=b(),t=L(.57735,.57735,.57735),s=!0,r=1,a=1){this.intensity=i,this.direction=t,this.castShadows=s,this.specularStrength=r,this.environmentStrength=a}},u=class{constructor(){this.r=[0],this.g=[0],this.b=[0]}};function j(n,i,t){(t=t||n).length=n.length;for(let s=0;s<n.length;s++)t[s]=n[s]*i[s];return t}function y(n,i,t){(t=t||n).length=n.length;for(let s=0;s<n.length;s++)t[s]=n[s]*i;return t}function f(n,i,t){(t=t||n).length=n.length;for(let s=0;s<n.length;s++)t[s]=n[s]+i[s];return t}function V(n){return(n+1)*(n+1)}function N(n){return A(Math.floor(Math.sqrt(n)-1),0,2)}function q(n,i,t){let s=n[0],r=n[1],a=n[2],o=t||[];return o.length=V(i),i>=0&&(o[0]=.28209479177),i>=1&&(o[1]=.4886025119*s,o[2]=.4886025119*a,o[3]=.4886025119*r),i>=2&&(o[4]=1.09254843059*s*r,o[5]=1.09254843059*r*a,o[6]=.31539156525*(3*a*a-1),o[7]=1.09254843059*s*a,o[8]=.54627421529*(s*s-r*r)),o}function k(n,i){let t=V(n),s=i||{r:[],g:[],b:[]};s.r.length=s.g.length=s.b.length=t;for(let r=0;r<t;r++)s.r[r]=s.g[r]=s.b[r]=0;return s}function D(n,i){let t=N(i.r.length);for(let s of n)C(M,s.direction),q(M,t,c),j(c,S),y(c,s.intensity[0],p),f(i.r,p),y(c,s.intensity[1],p),f(i.g,p),y(c,s.intensity[2],p),f(i.b,p);return i}function E(n,i){q(M,0,c);for(let t of n)i.r[0]+=c[0]*S[0]*t.intensity[0]*4*Math.PI,i.g[0]+=c[0]*S[0]*t.intensity[1]*4*Math.PI,i.b[0]+=c[0]*S[0]*t.intensity[2]*4*Math.PI;return i}function z(n,i,t,s){k(i,s),I(t.intensity,0,0,0);let r=!1,a=G,o=J,w=K;a.length=0,o.length=0,w.length=0;for(let e of n)e instanceof m&&!r?(h(t.direction,e.direction),h(t.intensity,e.intensity),t.specularStrength=e.specularStrength,t.environmentStrength=e.environmentStrength,t.castShadows=e.castShadows,r=!0):e instanceof m||e instanceof d?a.push(e):e instanceof _?o.push(e):e instanceof u&&w.push(e);D(a,s),E(o,s);for(let e of w)f(s.r,e.r),f(s.g,e.g),f(s.b,e.b)}var G=[],J=[],K=[],c=[0],p=[0],M=l(),S=[3.141593,2.094395,2.094395,2.094395,.785398,.785398,.785398,.785398,.785398];var F=class{constructor(){this.color=l(),this.intensity=1}},P=class{constructor(){this.direction=l(),this.ambient=new F,this.diffuse=new F}},Q=.4,B=class{constructor(){this._shOrder=2,this._legacy=new P,this.globalFactor=.5,this.noonFactor=.5,this._sphericalHarmonics=new u,this._mainLight=new m(l(),L(1,0,0),!1)}get legacy(){return this._legacy}get sh(){return this._sphericalHarmonics}get mainLight(){return this._mainLight}set(i){z(i,this._shOrder,this._mainLight,this._sphericalHarmonics),h(this._legacy.direction,this._mainLight.direction);let t=1/Math.PI;this._legacy.ambient.color[0]=.282095*this._sphericalHarmonics.r[0]*t,this._legacy.ambient.color[1]=.282095*this._sphericalHarmonics.g[0]*t,this._legacy.ambient.color[2]=.282095*this._sphericalHarmonics.b[0]*t,v(this._legacy.diffuse.color,this._mainLight.intensity,t),h(H,this._legacy.diffuse.color),v(H,H,Q*this.globalFactor),x(this._legacy.ambient.color,this._legacy.ambient.color,H)}copyFrom(i){this._sphericalHarmonics.r=Array.from(i.sh.r),this._sphericalHarmonics.g=Array.from(i.sh.g),this._sphericalHarmonics.b=Array.from(i.sh.b),h(this._mainLight.direction,i.mainLight.direction),h(this._mainLight.intensity,i.mainLight.intensity),this._mainLight.castShadows=i.mainLight.castShadows,this._mainLight.specularStrength=i.mainLight.specularStrength,this._mainLight.environmentStrength=i.mainLight.environmentStrength,this.globalFactor=i.globalFactor,this.noonFactor=i.noonFactor}lerpLighting(i,t,s){if(O(this._mainLight.intensity,i.mainLight.intensity,t.mainLight.intensity,s),this._mainLight.environmentStrength=g(i.mainLight.environmentStrength,t.mainLight.environmentStrength,s),this._mainLight.specularStrength=g(i.mainLight.specularStrength,t.mainLight.specularStrength,s),h(this._mainLight.direction,t.mainLight.direction),this._mainLight.castShadows=t.mainLight.castShadows,this.globalFactor=g(i.globalFactor,t.globalFactor,s),this.noonFactor=g(i.noonFactor,t.noonFactor,s),i.sh.r.length===t.sh.r.length)for(let r=0;r<t.sh.r.length;r++)this._sphericalHarmonics.r[r]=g(i.sh.r[r],t.sh.r[r],s),this._sphericalHarmonics.g[r]=g(i.sh.g[r],t.sh.g[r],s),this._sphericalHarmonics.b[r]=g(i.sh.b[r],t.sh.b[r],s);else for(let r=0;r<t.sh.r.length;r++)this._sphericalHarmonics.r[r]=t.sh.r[r],this._sphericalHarmonics.g[r]=t.sh.g[r],this._sphericalHarmonics.b[r]=t.sh.b[r]}},H=l();export{_ as a,d as b,m as c,Q as d,B as e};
