import{a as Te}from"./chunk-M3BFYJNF.js";import{a as D,b as Fe}from"./chunk-QYEHKB5C.js";import{a as Ce}from"./chunk-PT2T74VZ.js";import{a as le,b as Ae,c as de,d as ce,e as me,f as he}from"./chunk-GTCK26BQ.js";import{a as pe}from"./chunk-HB42CTAY.js";import{a as G,b as xe}from"./chunk-ZQ2SHTTW.js";import{d as Ee}from"./chunk-B3VPRADQ.js";import{a as be}from"./chunk-QWX4TI27.js";import{a as Y}from"./chunk-FHBFWDFD.js";import{a as Ie}from"./chunk-AT3LJJPR.js";import{c as Q}from"./chunk-Y4PJQPM4.js";import{a as Me}from"./chunk-MDSLION2.js";import{a as W}from"./chunk-AXYQJCCX.js";import{a as o}from"./chunk-5XCFNEYX.js";import{a as R}from"./chunk-GQL2MBZT.js";import{b as H}from"./chunk-EBIFNV2H.js";import{g as z}from"./chunk-FB4M3WPV.js";import{a as j}from"./chunk-G4DZJMGT.js";import{a as B}from"./chunk-7P44K2YD.js";import{b as ae}from"./chunk-32OAXCA4.js";import{a as C,c as ye,j as A}from"./chunk-TG45K3WR.js";import{a as r}from"./chunk-QGVBCWUY.js";import{e as n}from"./chunk-NFIPKH6V.js";import{l as b}from"./chunk-5QEXLALV.js";import{F as we,b as ge}from"./chunk-4PTIEWMT.js";import{d as ne}from"./chunk-XRGPJ3QY.js";import{a as O,f as M}from"./chunk-VTHXE323.js";var Ve={base:"esri-feature-attachments"},P=class extends R{constructor(e,t){super(e,t),this._featureElementInfo=null,this.attachmentsWidget=new be,this.headingLevel=2,this.viewModel=new le}initialize(){this._featureElementInfo=new D,this.addHandles([C(()=>[this.viewModel?.description,this.viewModel?.title,this.headingLevel],()=>this._setupFeatureElementInfo(),A),C(()=>this.viewModel,e=>this.attachmentsWidget.viewModel=e,A)])}destroy(){this.attachmentsWidget.viewModel=null,this.attachmentsWidget.destroy(),this._featureElementInfo?.destroy()}get description(){return this.viewModel.description}set description(e){this.viewModel.description=e}get displayType(){return this.attachmentsWidget.displayType}set displayType(e){this.attachmentsWidget.displayType=e}get graphic(){return this.viewModel.graphic}set graphic(e){this.viewModel.graphic=e}get title(){return this.viewModel.title}set title(e){this.viewModel.title=e}render(){let{attachmentsWidget:e}=this;return o("div",{class:Ve.base},this._featureElementInfo?.render(),e?.render())}_setupFeatureElementInfo(){let{description:e,title:t,headingLevel:i}=this;this._featureElementInfo?.set({description:e,title:t,headingLevel:i})}};r([n({readOnly:!0})],P.prototype,"attachmentsWidget",void 0),r([n()],P.prototype,"description",null),r([n()],P.prototype,"displayType",null),r([n()],P.prototype,"graphic",null),r([n()],P.prototype,"headingLevel",void 0),r([n()],P.prototype,"title",null),r([n({type:le})],P.prototype,"viewModel",void 0),P=r([b("esri.widgets.Feature.FeatureAttachments")],P);var Re=P;var ue="esri-feature-content",fe={base:ue,loaderContainer:`${ue}__loader-container`,loader:`${ue}__loader`},U=class extends R{constructor(e,t){super(e,t),this.viewModel=null,this._addTargetToAnchors=i=>{Array.from(i.querySelectorAll("a")).forEach(s=>{Q(s.href)&&!s.hasAttribute("target")&&s.setAttribute("target","_blank")})}}get creator(){return this.viewModel?.creator}set creator(e){this.viewModel&&(this.viewModel.creator=e)}get graphic(){return this.viewModel?.graphic}set graphic(e){this.viewModel&&(this.viewModel.graphic=e)}render(){let e=this.viewModel?.state;return o("div",{class:fe.base},e==="loading"?this._renderLoading():this._renderCreated())}_renderLoading(){return o("div",{class:fe.loaderContainer,key:"loader"},o("div",{class:fe.loader}))}_renderCreated(){let e=this.viewModel?.created;return e?e instanceof HTMLElement?o("div",{afterCreate:this._attachToNode,bind:e,key:e}):G(e)?o("div",{key:e},!e.destroyed&&e.render()):o("div",{afterCreate:this._addTargetToAnchors,innerHTML:e,key:e}):null}_attachToNode(e){let t=this;e.appendChild(t)}};r([n()],U.prototype,"creator",null),r([n()],U.prototype,"graphic",null),r([n({type:Ae})],U.prototype,"viewModel",void 0),U=r([b("esri.widgets.Feature.FeatureContent")],U);var K=U;var J="esri-feature-fields",ee={base:J,fieldHeader:`${J}__field-header`,fieldData:`${J}__field-data`,fieldDataDate:`${J}__field-data--date`},N=class extends R{constructor(e,t){super(e,t),this._featureElementInfo=null,this.viewModel=new de,this.messages=null,this.messagesURIUtils=null}initialize(){this._featureElementInfo=new D,this.addHandles(C(()=>[this.viewModel?.description,this.viewModel?.title],()=>this._setupFeatureElementInfo(),A))}destroy(){this._featureElementInfo?.destroy()}get attributes(){return this.viewModel.attributes}set attributes(e){this.viewModel.attributes=e}get description(){return this.viewModel.description}set description(e){this.viewModel.description=e}get expressionInfos(){return this.viewModel.expressionInfos}set expressionInfos(e){this.viewModel.expressionInfos=e}get fieldInfos(){return this.viewModel.fieldInfos}set fieldInfos(e){this.viewModel.fieldInfos=e}get title(){return this.viewModel.title}set title(e){this.viewModel.title=e}render(){return o("div",{class:ee.base},this._featureElementInfo?.render(),this._renderFields())}_renderFieldInfo(e,t){let{attributes:i}=this.viewModel,s=e.fieldName||"",a=e.label||s,d=i?i[s]==null?"":i[s]:"",l=!!e.format?.dateFormat,c=typeof d=="number"&&!l?this._forceLTR(d):Te(this.messagesURIUtils,d),p={[ee.fieldDataDate]:l};return o("tr",{key:`fields-element-info-row-${s}-${t}`},o("th",{class:ee.fieldHeader,innerHTML:a,key:`fields-element-info-row-header-${s}-${t}`}),o("td",{class:this.classes(ee.fieldData,p),innerHTML:c,key:`fields-element-info-row-data-${s}-${t}`}))}_renderFields(){let{formattedFieldInfos:e}=this.viewModel;return e?.length?o("table",{class:Y.table,summary:this.messages.fieldsSummary},o("tbody",null,e.map((t,i)=>this._renderFieldInfo(t,i)))):null}_setupFeatureElementInfo(){let{description:e,title:t}=this;this._featureElementInfo?.set({description:e,title:t})}_forceLTR(e){return`&lrm;${e}`}};r([n()],N.prototype,"attributes",null),r([n()],N.prototype,"description",null),r([n()],N.prototype,"expressionInfos",null),r([n()],N.prototype,"fieldInfos",null),r([n()],N.prototype,"title",null),r([n({type:de,nonNullable:!0})],N.prototype,"viewModel",void 0),r([n(),W("esri/widgets/Feature/t9n/Feature")],N.prototype,"messages",void 0),r([n(),W("esri/widgets/support/t9n/uriUtils")],N.prototype,"messagesURIUtils",void 0),N=r([b("esri.widgets.Feature.FeatureFields")],N);var te=N;var g="esri-feature-media",x={base:g,mediaContainer:`${g}__container`,mediaItemContainer:`${g}__item-container`,mediaItem:`${g}__item`,mediaItemText:`${g}__item-text`,mediaItemTitle:`${g}__item-title`,mediaItemCaption:`${g}__item-caption`,mediaNavigation:`${g}__item-navigation`,mediaPagination:`${g}__pagination`,mediaPaginationText:`${g}__pagination-text`,mediaPrevious:`${g}__previous`,mediaPreviousIconLTR:`${g}__previous-icon`,mediaPreviousIconRTL:`${g}__previous-icon--rtl`,mediaNext:`${g}__next`,mediaNextIconLTR:`${g}__next-icon`,mediaNextIconRTL:`${g}__next-icon--rtl`,mediaChart:`${g}__chart`,mediaPaginationButton:`${g}__pagination-button`,mediaPaginationIcon:`${g}__pagination-icon`,mediaChartRendered:`${g}__chart--rendered`},ve=15,X="category",Z="value",He="rgba(50, 50, 50, 1)",De=250,Xe=500,ze=200,T=class extends R{constructor(e,t){super(e,t),this._refreshTimer=null,this._refreshIntervalInfo=null,this._featureElementInfo=null,this._chartRootMap=new WeakMap,this.viewModel=new ce,this.messages=null,this._disposeChart=i=>{this._chartRootMap.get(i)?.dispose(),this._chartRootMap.delete(i)},this._createChart=i=>M(this,null,function*(){let{destroyed:s,viewModel:a}=this;if(s||!a||!i)return;let{createRoot:d}=yield import("./chunk-ANT3FQ54.js"),l=yield d(i);this._chartRootMap.set(i,l),this._renderChart({mediaInfo:a.activeMediaInfo,root:l})})}initialize(){this._featureElementInfo=new D,this.addHandles([C(()=>[this.viewModel?.activeMediaInfo,this.viewModel?.activeMediaInfoIndex],()=>this._setupMediaRefreshTimer(),A),C(()=>[this.viewModel?.description,this.viewModel?.title],()=>this._setupFeatureElementInfo(),A)])}loadDependencies(){return H({icon:()=>import("./chunk-7Z2RNQA3.js")})}destroy(){this._clearMediaRefreshTimer(),this._featureElementInfo?.destroy()}get attributes(){return this.viewModel.attributes}set attributes(e){this.viewModel.attributes=e}get activeMediaInfoIndex(){return this.viewModel.activeMediaInfoIndex}set activeMediaInfoIndex(e){this.viewModel.activeMediaInfoIndex=e}get description(){return this.viewModel.description}set description(e){this.viewModel.description=e}get fieldInfoMap(){return this.viewModel.fieldInfoMap}set fieldInfoMap(e){this.viewModel.fieldInfoMap=e}get layer(){return this.viewModel.layer}set layer(e){this.viewModel.layer=e}get mediaInfos(){return this.viewModel.mediaInfos}set mediaInfos(e){this.viewModel.mediaInfos=e}get popupTemplate(){return this.viewModel.popupTemplate}set popupTemplate(e){this.viewModel.popupTemplate=e}get relatedInfos(){return this.viewModel.relatedInfos}set relatedInfos(e){this.viewModel.relatedInfos=e}get title(){return this.viewModel.title}set title(e){this.viewModel.title=e}render(){return o("div",{bind:this,class:x.base,onkeyup:this._handleMediaKeyup},this._featureElementInfo?.render(),this._renderMedia())}_renderMedia(){let{formattedMediaInfoCount:e,activeMediaInfoIndex:t}=this.viewModel,i=this._renderMediaText();return e?o("div",{class:x.mediaContainer,key:"media-element-container"},this._renderMediaInfo(),o("div",{class:x.mediaNavigation},i,e>1?o("div",{class:x.mediaPagination},this._renderMediaPageButton("previous"),o("span",{class:x.mediaPaginationText},B(this.messages.pageText,{index:t+1,total:e})),this._renderMediaPageButton("next")):null)):null}_renderMediaText(){let{activeMediaInfo:e}=this.viewModel;if(!e)return null;let t=e&&e.title?o("div",{class:x.mediaItemTitle,innerHTML:e.title,key:"media-title"}):null,i=e&&e.caption?o("div",{class:x.mediaItemCaption,innerHTML:e.caption,key:"media-caption"}):null;return t||i?o("div",{class:x.mediaItemText,key:"media-text"},t,i):null}_renderImageMediaInfo(e){if(!e.value)return null;let{_refreshIntervalInfo:t}=this,{activeMediaInfoIndex:i,formattedMediaInfoCount:s}=this.viewModel,{value:a,refreshInterval:d,altText:l,title:c,type:p}=e,{sourceURL:k,linkURL:u}=a,m=Q(u??void 0)?"_blank":"_self",_=m==="_blank"?"noreferrer":"",v=d?t:null,w=v?v.timestamp:0,E=v?v.sourceURL:k,L=o("img",{alt:l||c,key:`media-${p}-${i}-${s}-${w}`,src:E??void 0});return(u?o("a",{href:u,rel:_,target:m,title:c},L):null)??L}_renderChartMediaInfo(e){let{activeMediaInfoIndex:t,formattedMediaInfoCount:i}=this.viewModel;return o("div",{afterCreate:this._createChart,afterRemoved:this._disposeChart,bind:this,class:x.mediaChart,key:`media-${e.type}-${t}-${i}`})}_renderMediaInfoType(){let{activeMediaInfo:e}=this.viewModel;return e?e.type==="image"?this._renderImageMediaInfo(e):e.type.includes("chart")?this._renderChartMediaInfo(e):null:null}_renderMediaInfo(){let{activeMediaInfo:e}=this.viewModel;return e?o("div",{class:x.mediaItemContainer,key:"media-container"},o("div",{class:x.mediaItem,key:"media-item-container"},this._renderMediaInfoType())):null}_renderMediaPageButton(e){if(this.viewModel.formattedMediaInfoCount<2)return null;let t=e==="previous",i=t?this.messages.previous:this.messages.next,s=t?"chevron-left":"chevron-right",a=t?"media-previous":"media-next",d=t?this._previous:this._next;return o("button",{"aria-label":i,bind:this,class:x.mediaPaginationButton,key:a,onclick:d,tabIndex:0,title:i,type:"button"},o("calcite-icon",{class:x.mediaPaginationIcon,icon:s,scale:"s"}))}_setupFeatureElementInfo(){let{description:e,title:t}=this;this._featureElementInfo?.set({description:e,title:t})}_next(){this.viewModel.next()}_previous(){this.viewModel.previous()}_getRenderer(){if(!this.viewModel)return;let{isAggregate:e,layer:t}=this.viewModel;return e&&t?.featureReduction&&"renderer"in t.featureReduction?t.featureReduction.renderer:t?.renderer}_getSeriesColors(e){return M(this,null,function*(){let{colorAm5:t}=yield import("./chunk-HSCQX2WN.js"),i=new Map;return e.forEach(s=>{s.color&&i.set(s,t(s.color.toCss(!0)))}),i})}_getRendererColors(){return M(this,null,function*(){let{colorAm5:e}=yield import("./chunk-HSCQX2WN.js"),t=new Map,i=this._getRenderer(),s="default";if(!i)return t;let a=yield Ee(i);return a.delete(s),Array.from(a.values()).every(d=>d?.length===1)&&Array.from(a.keys()).forEach(d=>{let l=a.get(d)?.[0]?.toCss(!0);l&&t.set(d,e(l))}),t})}_handleMediaKeyup(e){let{key:t}=e;t==="ArrowLeft"&&(e.stopPropagation(),this.viewModel.previous()),t==="ArrowRight"&&(e.stopPropagation(),this.viewModel.next())}_canAnimateChart(){return!!this.viewModel&&!!this.viewModel.abilities.chartAnimation&&!Ie()}_getChartAnimationMS(){return this._canAnimateChart()?De:0}_getChartSeriesAnimationMS(){return this._canAnimateChart()?Xe:0}_renderChart(e){return M(this,null,function*(){let{root:t,mediaInfo:i}=e,{value:s,type:a}=i,{ResponsiveThemeAm5:d,DarkThemeAm5:l,AnimatedThemeAm5:c,ColorSetAm5:p,ThemeAm5:k,esriChartColorSet:u}=yield import("./chunk-HSCQX2WN.js"),m=k.new(t);m.rule("ColorSet").set("colors",u),m.rule("ColorSet").set("reuse",!0);let _=[d.new(t),m];Me()&&_.push(l.new(t)),this._canAnimateChart()&&_.push(c.new(t)),t.setThemes(_);let v=yield this._getRendererColors(),w=yield this._getSeriesColors(s.series),E=p.new(t,{}),L=w.get(s.series[0]),$=L?{lineSettings:{stroke:L}}:void 0,F=s.series.map((S,Pe)=>{let _e=w.get(S)||v.get(S.fieldName)||E.getIndex(Pe);return O({[X]:S.tooltip,[Z]:S.value,columnSettings:{fill:_e,stroke:_e}},$)}).filter(S=>a!=="pie-chart"||S.value!=null&&S.value>0);a==="pie-chart"?this._createPieChart(e,F):this._createXYChart(e,F)})}_getDirection(){return z(this.container)?"rtl":"ltr"}_customizeChartTooltip(e,t="horizontal"){return M(this,null,function*(){let{colorAm5:i}=yield import("./chunk-HSCQX2WN.js");e.setAll({pointerOrientation:t}),e.get("background")?.setAll({stroke:i(He)}),e.label.setAll({direction:this._getDirection(),oversizedBehavior:"wrap",maxWidth:ze})})}_createPieChart(e,t){return M(this,null,function*(){let{TooltipAm5:i}=yield import("./chunk-HSCQX2WN.js"),{PieChartAm5:s,PieSeriesAm5:a}=yield import("./chunk-KV2AQRPP.js"),{mediaInfo:d,root:l}=e,{title:c}=d,p=5,k=d?.altText||d?.title||"",u=l.container.children.push(s.new(l,{ariaLabel:k,focusable:!0,paddingBottom:p,paddingTop:p,paddingLeft:p,paddingRight:p})),m=`{category}: {valuePercentTotal.formatNumber('0.00')}%
 ({value})`,_=i.new(l,{labelText:m}),v=u.series.push(a.new(l,{name:c,valueField:Z,categoryField:X,tooltip:_}));v.ticks.template.set("forceHidden",!0),v.labels.template.set("forceHidden",!0),v.slices.template.states.create("active",{shiftRadius:p}),this._customizeChartTooltip(_),v.slices.template.setAll({ariaLabel:m,focusable:!0,templateField:"columnSettings"}),v.data.setAll(t),v.appear(this._getChartSeriesAnimationMS()),u.appear(this._getChartAnimationMS()),u.root.dom.classList.toggle(x.mediaChartRendered,!0)})}_getMinSeriesValue(e){let t=0;return e.forEach(i=>t=Math.min(i.value,t)),t}_createColumnChart(e,t,i){return M(this,null,function*(){let{TooltipAm5:s,ScrollbarAm5:a}=yield import("./chunk-HSCQX2WN.js"),{CategoryAxisAm5:d,AxisRendererXAm5:l,ValueAxisAm5:c,AxisRendererYAm5:p,ColumnSeriesAm5:k}=yield import("./chunk-P3YNJDS4.js"),{mediaInfo:u,root:m}=t,{value:_,title:v}=u;e.setAll({wheelX:"panX",wheelY:"zoomX"});let w=e.xAxes.push(d.new(m,{renderer:l.new(m,{inversed:z(this.container)}),categoryField:X}));w.get("renderer").labels.template.setAll({forceHidden:!0});let E=e.yAxes.push(c.new(m,{renderer:p.new(m,{inside:!1}),min:this._getMinSeriesValue(_.series)}));E.get("renderer").labels.template.setAll({direction:this._getDirection()});let L="{categoryX}",$=s.new(m,{labelText:L}),F=e.series.push(k.new(m,{name:v,xAxis:w,yAxis:E,valueYField:Z,categoryXField:X,tooltip:$}));this._customizeChartTooltip($),F.columns.template.setAll({ariaLabel:L,focusable:!0,templateField:"columnSettings"}),_.series.length>ve&&e.set("scrollbarX",a.new(m,{orientation:"horizontal"})),w.data.setAll(i),F.data.setAll(i),F.appear(this._getChartSeriesAnimationMS()),e.appear(this._getChartAnimationMS())})}_createBarChart(e,t,i){return M(this,null,function*(){let{TooltipAm5:s,ScrollbarAm5:a}=yield import("./chunk-HSCQX2WN.js"),{CategoryAxisAm5:d,AxisRendererXAm5:l,ValueAxisAm5:c,AxisRendererYAm5:p,ColumnSeriesAm5:k}=yield import("./chunk-P3YNJDS4.js"),{mediaInfo:u,root:m}=t,{value:_,title:v}=u;e.setAll({wheelX:"panY",wheelY:"zoomY"});let w=e.yAxes.push(d.new(m,{renderer:p.new(m,{inversed:!0}),categoryField:X}));w.get("renderer").labels.template.setAll({forceHidden:!0});let E=e.xAxes.push(c.new(m,{renderer:l.new(m,{inside:!1,inversed:z(this.container)}),min:this._getMinSeriesValue(_.series)}));E.get("renderer").labels.template.setAll({direction:this._getDirection()});let L="{categoryY}",$=s.new(m,{labelText:L}),F=e.series.push(k.new(m,{name:v,xAxis:E,yAxis:w,valueXField:Z,categoryYField:X,tooltip:$}));this._customizeChartTooltip($,"vertical"),F.columns.template.setAll({ariaLabel:L,focusable:!0,templateField:"columnSettings"}),_.series.length>ve&&e.set("scrollbarY",a.new(m,{orientation:"vertical"})),w.data.setAll(i),F.data.setAll(i),F.appear(this._getChartSeriesAnimationMS()),e.appear(this._getChartAnimationMS())})}_createLineChart(e,t,i){return M(this,null,function*(){let{TooltipAm5:s,ScrollbarAm5:a}=yield import("./chunk-HSCQX2WN.js"),{CategoryAxisAm5:d,AxisRendererXAm5:l,ValueAxisAm5:c,AxisRendererYAm5:p,LineSeriesAm5:k}=yield import("./chunk-P3YNJDS4.js"),{root:u,mediaInfo:m}=t,{value:_,title:v}=m;e.setAll({wheelX:"panX",wheelY:"zoomX"});let w=e.xAxes.push(d.new(u,{renderer:l.new(u,{inversed:z(this.container)}),categoryField:X}));w.get("renderer").labels.template.setAll({forceHidden:!0});let E=e.yAxes.push(c.new(u,{renderer:p.new(u,{inside:!1}),min:this._getMinSeriesValue(_.series)}));E.get("renderer").labels.template.setAll({direction:this._getDirection()});let L="{categoryX}",$=i[0]?.lineSettings?.stroke,F=s.new(u,{getFillFromSprite:!$,labelText:L});$&&F.get("background")?.setAll({fill:$});let S=e.series.push(k.new(u,{name:v,xAxis:w,yAxis:E,valueYField:Z,categoryXField:X,tooltip:F}));S.strokes.template.setAll({templateField:"lineSettings"}),this._customizeChartTooltip(F,"vertical"),_.series.length>ve&&e.set("scrollbarX",a.new(u,{orientation:"horizontal"})),w.data.setAll(i),S.data.setAll(i),S.appear(this._getChartSeriesAnimationMS()),e.appear(this._getChartAnimationMS())})}_createXYChart(e,t){return M(this,null,function*(){let{XYChartAm5:i,XYCursorAm5:s}=yield import("./chunk-P3YNJDS4.js"),{root:a,mediaInfo:d}=e,{type:l}=d,c=d?.altText||d?.title||"",p=a.container.children.push(i.new(a,{ariaLabel:c,focusable:!0,panX:!0,panY:!0}));p.set("cursor",s.new(a,{})),l==="column-chart"&&(yield this._createColumnChart(p,e,t)),l==="bar-chart"&&(yield this._createBarChart(p,e,t)),l==="line-chart"&&(yield this._createLineChart(p,e,t)),p.root.dom.classList.toggle(x.mediaChartRendered,!0)})}_clearMediaRefreshTimer(){let{_refreshTimer:e}=this;e&&(clearTimeout(e),this._refreshTimer=null)}_updateMediaInfoTimestamp(e){let t=Date.now();this._refreshIntervalInfo={timestamp:t,sourceURL:e&&this._getImageSource(e,t)}}_setupMediaRefreshTimer(){this._clearMediaRefreshTimer();let{activeMediaInfo:e}=this.viewModel;e?.type==="image"&&e?.refreshInterval>0&&this._setRefreshTimeout(e)}_setRefreshTimeout(e){let{refreshInterval:t,value:i}=e,s=6e4*t;this._updateMediaInfoTimestamp(i.sourceURL);let a=setInterval(()=>{this._updateMediaInfoTimestamp(i.sourceURL)},s);this._refreshTimer=a}_getImageSource(e,t){let i=e.includes("?")?"&":"?",[s,a=""]=e.split("#");return`${s}${i}timestamp=${t}${a?"#":""}${a}`}};r([n()],T.prototype,"_refreshIntervalInfo",void 0),r([n()],T.prototype,"attributes",null),r([n()],T.prototype,"activeMediaInfoIndex",null),r([n()],T.prototype,"description",null),r([n()],T.prototype,"fieldInfoMap",null),r([n()],T.prototype,"layer",null),r([n()],T.prototype,"mediaInfos",null),r([n()],T.prototype,"popupTemplate",null),r([n()],T.prototype,"relatedInfos",null),r([n()],T.prototype,"title",null),r([n({type:ce})],T.prototype,"viewModel",void 0),r([n(),W("esri/widgets/Feature/t9n/Feature")],T.prototype,"messages",void 0),T=r([b("esri.widgets.Feature.FeatureMedia")],T);var ie=T;var ke="esri-feature",Le={base:`${ke}-expression`,loadingSpinnerContainer:`${ke}__loading-container`},se=class extends R{constructor(e,t){super(e,t),this._contentWidget=null,this.viewModel=new me}initialize(){this.addHandles(C(()=>this.viewModel?.contentElementViewModel,()=>this._setupExpressionWidget(),A))}loadDependencies(){return H({loader:()=>import("./chunk-4Z3TWS6O.js")})}destroy(){this._destroyContentWidget()}render(){let{state:e}=this.viewModel;return o("div",{class:Le.base},e==="loading"?this._renderLoading():e==="disabled"?null:this._contentWidget?.render())}_renderLoading(){return o("div",{class:Le.loadingSpinnerContainer,key:"loading-container"},o("calcite-loader",{inline:!0,label:""}))}_destroyContentWidget(){let{_contentWidget:e}=this;e&&(e.viewModel=null,e.destroy()),this._contentWidget=null}_setupExpressionWidget(){let{contentElementViewModel:e,contentElement:t}=this.viewModel,i=t?.type;this._destroyContentWidget();let s=e?i==="fields"?new te({viewModel:e}):i==="media"?new ie({viewModel:e}):i==="text"?new K({viewModel:e}):null:null;this._contentWidget=s,this.scheduleRender()}};r([n({type:me})],se.prototype,"viewModel",void 0),se=r([b("esri.widgets.Feature.FeatureExpression")],se);var $e=se;var re,oe="esri-feature",q=`${oe}-relationship`,V={base:q,listContainer:`${q}__list`,listItem:`${q}__list-item`,listItemHidden:`${q}__list-item--hidden`,listContainerQuerying:`${q}__list--querying`,featureObserver:`${oe}__feature-observer`,stickySpinnerContainer:`${oe}__sticky-loading-container`,loadingSpinnerContainer:`${oe}__loading-container`},Se={title:!0,description:!0},y=re=class extends R{constructor(e,t){super(e,t),this._featureElementInfo=null,this._relatedFeatureIntersectionObserverNode=null,this._relatedFeatureIntersectionObserver=new IntersectionObserver(([i])=>{i?.isIntersecting&&this._increaseFeaturePage()},{root:window.document}),this.flowItems=null,this.flowType="feature-relationship",this.headingLevel=2,this.viewModel=new pe,this.messages=null,this.messagesCommon=null,this.visibleElements=O({},Se),this._increaseFeaturePage=()=>{let{state:i,showAllEnabled:s,relatedFeatures:a,featuresPerPage:d,featurePage:l}=this.viewModel;i==="ready"&&s&&a.length>=d*l&&this.viewModel.featurePage++}}initialize(){this._featureElementInfo=new D,this.addHandles([C(()=>[this.viewModel.description,this.viewModel.title,this.headingLevel],()=>this._setupFeatureElementInfo(),A),C(()=>[this.viewModel.state,this.viewModel.showAllEnabled,this._relatedFeatureIntersectionObserverNode],()=>this._handleRelatedFeatureObserverChange()),ye(()=>this.viewModel.relatedFeatureViewModels,"change",()=>this._setupRelatedFeatureViewModels())])}loadDependencies(){return H({chip:()=>import("./chunk-YJHYFSU4.js"),icon:()=>import("./chunk-7Z2RNQA3.js"),list:()=>import("./chunk-4MPCQ5DO.js"),"list-item":()=>import("./chunk-MRM6JRFU.js"),loader:()=>import("./chunk-4Z3TWS6O.js"),notice:()=>import("./chunk-PEKK3NZO.js")})}destroy(){this._unobserveRelatedFeatureObserver(),this._featureElementInfo=ge(this._featureElementInfo)}get displayShowAllButton(){let{showAllEnabled:e,featureCount:t,displayCount:i,state:s,allCategoriesCount:a}=this.viewModel;return!e&&s==="ready"&&(!!a&&(a>i||i===0)||!!t&&(t>i||i===0))}get displayListItems(){let{relatedFeatureViewModels:e,allCategoriesCount:t}=this.viewModel;return this.displayShowAllButton||!!e.length||!!t}get allItemsDescription(){let{messages:e}=this,{featureCount:t,allCategories:i,allCategoriesCount:s}=this.viewModel;return B(e?.numberRecords,{number:ae(i?s:t)})}get description(){return this.viewModel.description}set description(e){this.viewModel.description=e}get title(){let{activeCategory:e,title:t}=this.viewModel;return e?.name??t}set title(e){this.viewModel.title=e}castVisibleElements(e){return O(O({},Se),e)}render(){let{state:e}=this.viewModel;return o("div",{class:this.classes(V.base,Y.widget)},this._featureElementInfo?.render(),e==="loading"?this._renderLoading():e==="disabled"?this._renderRelationshipNotFound():this._renderRelatedFeatures())}_selectCategory(e){return M(this,null,function*(){let{flowItems:t,featureVisibleElements:i,viewModel:s}=this;t&&(s.activeCategory=e,s.showAllEnabled=!0,t.push(new re({flowItems:t,featureVisibleElements:i,visibleElements:{title:!1,description:!1},viewModel:s})))})}_selectRecord(e){return M(this,null,function*(){let{flowItems:t,featureVisibleElements:i}=this;if(!t)return;e.abilities={relationshipContent:!0};let{default:s}=yield import("./chunk-GYY65P3G.js");t.push(new s({flowItems:t,flowType:this.flowType,viewModel:e,visibleElements:i}))})}_showAllRecords(){let{flowItems:e}=this;if(!e)return;let{viewModel:t,featureVisibleElements:i}=this;t.showAllEnabled=!0;let s=new re({flowItems:e,featureVisibleElements:i,visibleElements:{title:!1,description:!1},viewModel:t});e.push(s)}_renderStickyLoading(){return this.viewModel.state==="querying"?o("div",{class:V.stickySpinnerContainer,key:"sticky-loader"},this._renderLoadingIcon()):null}_renderLoadingIcon(){return o("calcite-loader",{inline:!0,label:""})}_renderLoading(){return o("div",{class:V.loadingSpinnerContainer,key:"loading-container"},this._renderLoadingIcon())}_renderShowAllIconNode(){return o("calcite-icon",{icon:"list",scale:"s",slot:"content-end"})}_renderChevronIconNode(){let e=z(this.container)?"chevron-left":"chevron-right";return o("calcite-icon",{icon:e,scale:"s",slot:"content-end"})}_renderCategory(e){let{count:t,name:i,value:s}=e,a=ae(t);return o("calcite-list-item",{class:V.listItem,disabled:!t,key:s,label:i,onCalciteListItemSelect:()=>this._selectCategory(e)},o("calcite-chip",{label:a,scale:"s",slot:"content-end"},a),this._renderChevronIconNode())}_renderRelatedFeature(e){let{itemDescriptionFieldName:t}=this.viewModel,i=e.title;e.description=t&&e.formattedAttributes?.global[t];let s=e.state==="loading";return o("calcite-list-item",{class:this.classes(V.listItem,{[V.listItemHidden]:s}),description:ne(e.description??""),key:e.uid,label:ne(i),onCalciteListItemSelect:()=>this._selectRecord(e)},this._renderChevronIconNode())}_renderShowAllListItem(){return this.displayShowAllButton?o("calcite-list-item",{description:this.allItemsDescription,key:"show-all-item",label:this.messages?.showAll,onCalciteListItemSelect:()=>this._showAllRecords()},this._renderShowAllIconNode()):null}_renderNoRelatedFeaturesMessage(){return o("calcite-notice",{icon:"information",key:"no-related-features-message",kind:"brand",open:!0,scale:"s",width:"full"},o("div",{slot:"message"},this.messages?.noRelatedFeatures))}_renderFeatureObserver(){return o("div",{afterCreate:this._relatedFeatureIntersectionObserverCreated,bind:this,class:V.featureObserver,key:"feature-observer"})}_renderList(){let{relatedFeatureViewModels:e,categories:t}=this.viewModel;return o("calcite-list",{displayMode:"flat",label:this.messages?.relatedFeaturesList},t?.map(i=>this._renderCategory(i))??e.toArray().map(i=>this._renderRelatedFeature(i)),this._renderShowAllListItem())}_renderRelatedFeatures(){let{displayListItems:e}=this,{state:t}=this.viewModel;return o("div",{class:this.classes(V.listContainer,{[V.listContainerQuerying]:t==="querying"}),key:"list-container"},e?this._renderList():t==="ready"?this._renderNoRelatedFeaturesMessage():null,this._renderStickyLoading(),this._renderFeatureObserver())}_renderRelationshipNotFound(){return o("calcite-notice",{icon:"exclamation-mark-triangle",key:"relationship-not-found",kind:"danger",open:!0,scale:"s",width:"full"},o("div",{slot:"message"},this.messages?.relationshipNotFound))}_setupRelatedFeatureViewModels(){let{relatedFeatureViewModels:e}=this.viewModel,t="related-feature-viewmodels";this.removeHandles(t),e?.forEach(i=>{this.addHandles(C(()=>[i.title,i.state],()=>this.scheduleRender(),A),t)}),this.scheduleRender()}_setupFeatureElementInfo(){let{headingLevel:e,visibleElements:t}=this,i=t.description&&this.description,s=t.title&&this.title;this._featureElementInfo?.set({description:i,title:s,headingLevel:e})}_handleRelatedFeatureObserverChange(){return M(this,null,function*(){this._unobserveRelatedFeatureObserver();let{state:e,showAllEnabled:t}=this.viewModel;yield we(0),this._relatedFeatureIntersectionObserverNode&&e==="ready"&&t&&this._relatedFeatureIntersectionObserver.observe(this._relatedFeatureIntersectionObserverNode)})}_relatedFeatureIntersectionObserverCreated(e){this._relatedFeatureIntersectionObserverNode=e}_unobserveRelatedFeatureObserver(){this._relatedFeatureIntersectionObserverNode&&this._relatedFeatureIntersectionObserver.unobserve(this._relatedFeatureIntersectionObserverNode)}};r([n()],y.prototype,"_relatedFeatureIntersectionObserverNode",void 0),r([n({readOnly:!0})],y.prototype,"displayShowAllButton",null),r([n({readOnly:!0})],y.prototype,"displayListItems",null),r([n({readOnly:!0})],y.prototype,"allItemsDescription",null),r([n()],y.prototype,"description",null),r([n()],y.prototype,"featureVisibleElements",void 0),r([n()],y.prototype,"flowItems",void 0),r([n()],y.prototype,"flowType",void 0),r([n()],y.prototype,"headingLevel",void 0),r([n()],y.prototype,"title",null),r([n({type:pe})],y.prototype,"viewModel",void 0),r([n(),W("esri/widgets/Feature/t9n/Feature")],y.prototype,"messages",void 0),r([n(),W("esri/t9n/common")],y.prototype,"messagesCommon",void 0),r([n()],y.prototype,"visibleElements",void 0),r([j("visibleElements")],y.prototype,"castVisibleElements",null),y=re=r([b("esri.widgets.Feature.FeatureRelationship")],y);var We=y;var I="esri-feature",h={base:I,container:`${I}__size-container`,title:`${I}__title`,main:`${I}__main-container`,btn:`${I}__button`,icon:`${I}__icon`,content:`${I}__content`,contentNode:`${I}__content-node`,contentNodeText:`${I}__content-node--text`,contentElement:`${I}__content-element`,text:`${I}__text`,lastEditedInfo:`${I}__last-edited-info`,fields:`${I}__fields`,fieldHeader:`${I}__field-header`,fieldData:`${I}__field-data`,fieldDataDate:`${I}__field-data--date`,loadingSpinnerContainer:`${I}__loading-container`};var Ne=e=>{let t=class extends e{constructor(){super(...arguments),this.renderNodeContent=i=>G(i)&&!i.destroyed?o("div",{class:h.contentNode,key:i},i.render()):i instanceof HTMLElement?o("div",{afterCreate:this._attachToNode,bind:i,class:h.contentNode,key:i}):xe(i)?o("div",{afterCreate:this._attachToNode,bind:i.domNode,class:h.contentNode,key:i}):null}_attachToNode(i){let s=this;i.appendChild(s)}};return t=r([b("esri.widgets.Feature.support.FeatureContentMixin")],t),t};var Oe={title:!0,content:!0,lastEditedInfo:!0},f=class extends Ne(R){constructor(e,t){super(e,t),this._contentWidgets=[],this.flowType="feature",this.flowItems=null,this.headingLevel=2,this.messages=null,this.messagesCommon=null,this.visibleElements=O({},Oe),this.viewModel=new he}initialize(){this.addHandles(C(()=>this.viewModel?.contentViewModels,()=>this._setupContentWidgets(),A))}loadDependencies(){return H({notice:()=>import("./chunk-PEKK3NZO.js"),loader:()=>import("./chunk-4Z3TWS6O.js")})}destroy(){this._destroyContentWidgets()}get graphic(){return this.viewModel.graphic}set graphic(e){this.viewModel.graphic=e}get defaultPopupTemplateEnabled(){return this.viewModel.defaultPopupTemplateEnabled}set defaultPopupTemplateEnabled(e){this.viewModel.defaultPopupTemplateEnabled=e}get isTable(){return this.viewModel.isTable}get icon(){return"polygon"}set icon(e){this._overrideIfSome("icon",e)}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get location(){return this.viewModel.location}set location(e){this.viewModel.location=e}get spatialReference(){return this.viewModel.spatialReference}set spatialReference(e){this.viewModel.spatialReference=e}get timeZone(){return this.viewModel.timeZone}set timeZone(e){this.viewModel.timeZone=e}get title(){return this.viewModel.title}castVisibleElements(e){return O(O({},Oe),e)}get map(){return this.viewModel.map}set map(e){this.viewModel.map=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}setActiveMedia(e,t){return this.viewModel.setActiveMedia(e,t)}nextMedia(e){return this.viewModel.nextMedia(e)}previousMedia(e){return this.viewModel.previousMedia(e)}render(){let{state:e}=this.viewModel,t=o("div",{class:h.container,key:"container"},this._renderTitle(),e==="error"?this._renderError():e==="loading"?this._renderLoading():this._renderContentContainer());return o("div",{class:this.classes(h.base,Y.widget)},t)}_renderError(){let{messagesCommon:e,messages:t,visibleElements:i}=this;return o("calcite-notice",{icon:"exclamation-mark-circle",kind:"danger",open:!0,scale:"s"},i.title?o("div",{key:"error-title",slot:"title"},e.errorMessage):null,o("div",{key:"error-message",slot:"message"},t.loadingError))}_renderLoading(){return o("div",{class:h.loadingSpinnerContainer,key:"loading-container"},o("calcite-loader",{inline:!0,label:""}))}_renderContentContainer(){let{visibleElements:e}=this;return e.content?o("div",{class:h.main},[this._renderContent(),this._renderLastEditInfo()]):null}_renderTitle(){let{visibleElements:e,title:t}=this;return e.title?o(Ce,{class:h.title,innerHTML:t,level:this.headingLevel}):null}_renderContent(){let e=this.viewModel.content,t="content";if(!e)return null;if(Array.isArray(e))return e.length?o("div",{class:h.contentNode,key:`${t}-content-elements`},e.map(this._renderContentElement,this)):null;if(typeof e=="string"){let i=this._contentWidgets[0];return!i||i.destroyed?null:o("div",{class:this.classes(h.contentNode,h.contentNodeText),key:`${t}-content`},i.render())}return this.renderNodeContent(e)}_renderContentElement(e,t){let{visibleElements:i}=this;if(typeof i.content!="boolean"&&!i.content?.[e.type])return null;switch(e.type){case"attachments":return this._renderAttachments(t);case"custom":return this._renderCustom(e,t);case"fields":return this._renderFields(t);case"media":return this._renderMedia(t);case"text":return this._renderText(e,t);case"expression":return this._renderExpression(t);case"relationship":return this._renderRelationship(t);case"utility-network-associations":return this._renderAssociation(t);default:return null}}_renderAttachments(e){let t=this._contentWidgets[e];if(!t||t.destroyed)return null;let{state:i,attachmentInfos:s}=t.viewModel;return i==="loading"||s.length>0?o("div",{class:this.classes(h.contentElement),key:this._buildKey("attachments-element",e)},t.render()):null}_renderRelationship(e){let t=this._contentWidgets[e];return t&&!t.destroyed&&this.flowItems?o("div",{class:h.contentElement,key:this._buildKey("relationship-element",e)},t.render()):null}_renderAssociation(e){let t=this._contentWidgets[e];return t&&!t.destroyed&&this.flowItems?o("div",{class:h.contentElement,key:this._buildKey("utility-network-association-element",e)},t.render()):null}_renderExpression(e){let t=this._contentWidgets[e];return t&&!t.destroyed&&t.viewModel.contentElement?o("div",{class:h.contentElement,key:this._buildKey("expression-element",e)},t.render()):null}_renderCustom(e,t){let{creator:i}=e,s=this._contentWidgets[t];return!s||s.destroyed?null:i?o("div",{class:h.contentElement,key:this._buildKey("custom-element",t)},s.render()):null}_renderFields(e){let t=this._contentWidgets[e];return!t||t.destroyed?null:o("div",{class:h.contentElement,key:this._buildKey("fields-element",e)},t.render())}_renderMedia(e){let t=this._contentWidgets[e];return!t||t.destroyed?null:o("div",{class:h.contentElement,key:this._buildKey("media-element",e)},t.render())}_renderLastEditInfo(){let{visibleElements:e,messages:t}=this,{lastEditInfo:i}=this.viewModel;if(!i||!e.lastEditedInfo)return null;let{date:s,user:a}=i,d=i.type==="edit"?a?t.lastEditedByUser:t.lastEdited:a?t.lastCreatedByUser:t.lastCreated,l=B(d,{date:s,user:a});return o("div",{class:this.classes(h.lastEditedInfo,h.contentElement),key:"edit-info-element"},l)}_renderText(e,t){let i=e.text,s=this._contentWidgets[t];return!s||s.destroyed?null:i?o("div",{class:this.classes(h.contentElement,h.text),key:this._buildKey("text-element",t)},s.render()):null}_buildKey(e,...t){return`${e}__${this.viewModel?.graphic?.uid||"0"}-${t.join("-")}`}_destroyContentWidget(e){e&&(e.viewModel=null,!e.destroyed&&e.destroy())}_destroyContentWidgets(){this._contentWidgets.forEach(e=>this._destroyContentWidget(e)),this._contentWidgets=[]}_setupContentWidgets(){this._destroyContentWidgets();let{headingLevel:e,visibleElements:t,flowItems:i,viewModel:s}=this,a=s?.content,{contentViewModels:d}=s;if(Array.isArray(a))a.forEach((l,c)=>{if(l.type==="attachments"&&(this._contentWidgets[c]=new Re({displayType:l.displayType,headingLevel:t.title&&e<6?e+1:e,viewModel:d[c]})),l.type==="fields"&&(this._contentWidgets[c]=new te({viewModel:d[c]})),l.type==="media"&&(this._contentWidgets[c]=new ie({viewModel:d[c]})),l.type==="text"&&(this._contentWidgets[c]=new K({viewModel:d[c]})),l.type==="custom"&&(this._contentWidgets[c]=new K({viewModel:d[c]})),l.type==="expression"&&(this._contentWidgets[c]=new $e({viewModel:d[c]})),l.type==="relationship"){let p=new We({flowItems:i,featureVisibleElements:t,viewModel:d[c]});this._contentWidgets[c]=p}if(l.type==="utility-network-associations"){let p=u=>M(this,null,function*(){let{viewModel:m,listType:_,title:v}=u;if(!i)return;m.activeAssociationType=_;let{default:w}=yield import("./chunk-AX5DYMH5.js"),E=new w({viewModel:m,parentFeatureViewModel:s,listType:_,title:v,featureVisibleElements:t,description:s.title,flowItems:i});i.push(E)}),k=new Fe({flowItems:i,onSelectAssociationType:p,parentFeatureViewModel:s,featureVisibleElements:t,viewModel:d[c]});this._contentWidgets[c]=k}},this);else{let l=d[0];l&&!l.destroyed&&(this._contentWidgets[0]=new K({viewModel:l}))}this.scheduleRender()}};r([n()],f.prototype,"flowType",void 0),r([n()],f.prototype,"graphic",null),r([n()],f.prototype,"defaultPopupTemplateEnabled",null),r([n()],f.prototype,"flowItems",void 0),r([n()],f.prototype,"headingLevel",void 0),r([n({readOnly:!0})],f.prototype,"isTable",null),r([n()],f.prototype,"icon",null),r([n()],f.prototype,"label",null),r([n()],f.prototype,"location",null),r([n(),W("esri/widgets/Feature/t9n/Feature")],f.prototype,"messages",void 0),r([n(),W("esri/t9n/common")],f.prototype,"messagesCommon",void 0),r([n()],f.prototype,"spatialReference",null),r([n()],f.prototype,"timeZone",null),r([n({readOnly:!0})],f.prototype,"title",null),r([n()],f.prototype,"visibleElements",void 0),r([j("visibleElements")],f.prototype,"castVisibleElements",null),r([n()],f.prototype,"map",null),r([n()],f.prototype,"view",null),r([n({type:he})],f.prototype,"viewModel",void 0),f=r([b("esri.widgets.Feature")],f);var Fs=f;export{h as a,Ne as b,Fs as c};
