import{b as N}from"./chunk-YCTD57IA.js";import{a as C}from"./chunk-ZZRMWUJR.js";import{a as P}from"./chunk-2VMZZJFA.js";import{a as H}from"./chunk-4HILTGRJ.js";import{b as E}from"./chunk-JF73MJ44.js";import{a as b}from"./chunk-QOSJTJHZ.js";import"./chunk-JKHGG7T4.js";import"./chunk-2HQALWZQ.js";import{b as I,c as U}from"./chunk-7NTCDIVV.js";import"./chunk-KZXCI3DC.js";import"./chunk-I76R3PW5.js";import"./chunk-6RE36L2Q.js";import"./chunk-JANRGUJ7.js";import"./chunk-UBEQHTGJ.js";import"./chunk-PHODKV66.js";import"./chunk-JPMGMA4B.js";import"./chunk-6DALCDDU.js";import"./chunk-5A7AFZJT.js";import"./chunk-Z5EURZKA.js";import"./chunk-PE276TWH.js";import"./chunk-BMZ3PE5Y.js";import"./chunk-EHG7JRYJ.js";import"./chunk-FNY6LFKI.js";import"./chunk-IBVI7JQ7.js";import"./chunk-2DFFQEIV.js";import"./chunk-TERDLNGF.js";import"./chunk-4JY7PCV4.js";import"./chunk-BBB7KLHV.js";import"./chunk-J2AEVBSH.js";import"./chunk-5ODXFRPI.js";import"./chunk-E5QCV5LT.js";import"./chunk-QS3EYJPF.js";import"./chunk-HJJZ2AXH.js";import"./chunk-TPNSUEHH.js";import"./chunk-SMVNQSZ4.js";import"./chunk-Z2QGLRDB.js";import"./chunk-7IDFDPA3.js";import"./chunk-VL2YL74P.js";import"./chunk-P2AJD2R2.js";import"./chunk-UMJIJLDA.js";import"./chunk-E5NFS3KN.js";import"./chunk-HQHD6BMN.js";import"./chunk-AIKKGGPG.js";import"./chunk-RDGG4TVD.js";import"./chunk-3IQFPOUU.js";import"./chunk-I4CY6X6S.js";import"./chunk-VQ4QGNRX.js";import"./chunk-4KXJ537H.js";import"./chunk-JIRULGDT.js";import"./chunk-QJGOWIJD.js";import"./chunk-QML26MQC.js";import"./chunk-RNZY2XUD.js";import"./chunk-JXPUHKCT.js";import{y as V}from"./chunk-XR5FT7TQ.js";import"./chunk-LAX5536Z.js";import"./chunk-N3HRYLNW.js";import"./chunk-4DBMALZW.js";import"./chunk-CVWWHM2V.js";import"./chunk-6OQYVEQJ.js";import"./chunk-YOXOWGT6.js";import"./chunk-EFZOSMYP.js";import"./chunk-WI7F4ZKJ.js";import"./chunk-MJ7M24NH.js";import"./chunk-GJH4QFRX.js";import"./chunk-T63F7663.js";import"./chunk-O4V2VBSK.js";import"./chunk-5TKRKB5E.js";import"./chunk-XAGMDNNR.js";import"./chunk-OP2TLIUN.js";import"./chunk-T2THIR6K.js";import"./chunk-LORHDXEB.js";import"./chunk-BBBPJI4H.js";import"./chunk-45BTW5EG.js";import"./chunk-TPFBHGDM.js";import"./chunk-73NLRHJD.js";import"./chunk-PNFEUBDF.js";import"./chunk-6RCCEJDL.js";import"./chunk-PQ2TNDUX.js";import"./chunk-6X6MKRQ3.js";import"./chunk-FQFHMHYU.js";import"./chunk-SZMEI3WL.js";import"./chunk-KKVGD67U.js";import"./chunk-MYOJWRDU.js";import"./chunk-L7UKJKHG.js";import"./chunk-V2IENAEU.js";import"./chunk-QAGQFNF2.js";import"./chunk-SY7JS2VW.js";import"./chunk-WK57SDN6.js";import"./chunk-AG4V3ZUO.js";import"./chunk-YWLMJ26A.js";import"./chunk-QAWNU3UJ.js";import"./chunk-HRQT4R6X.js";import"./chunk-44BHLWQ4.js";import"./chunk-5BPM64SU.js";import"./chunk-PMVHHMQJ.js";import"./chunk-NAFOM5UA.js";import"./chunk-DO7UF2F2.js";import"./chunk-ZTR6OS44.js";import"./chunk-VRTKAD2J.js";import"./chunk-DBLKLHK2.js";import"./chunk-UTE3ASAZ.js";import"./chunk-2AFEAPEX.js";import"./chunk-GNGXUEWV.js";import"./chunk-QBI5NDCA.js";import"./chunk-NOHW2DKR.js";import"./chunk-HVJAAM3A.js";import"./chunk-ACPEJEHK.js";import"./chunk-I7B3LWNP.js";import"./chunk-YP2E5N4E.js";import"./chunk-QLMNLSCT.js";import"./chunk-P55G5ATK.js";import"./chunk-JT3K52KQ.js";import"./chunk-SPLEGG4R.js";import"./chunk-Y4TJDUGP.js";import"./chunk-6PAFOJ4W.js";import"./chunk-74SDGE57.js";import"./chunk-FRXWHX3T.js";import"./chunk-DTDQ5X42.js";import"./chunk-RX2HFR4X.js";import"./chunk-AZW7YPTQ.js";import"./chunk-NJLJX4X6.js";import"./chunk-DZHFTD24.js";import"./chunk-K57Z4J34.js";import"./chunk-VWG3KVOU.js";import"./chunk-JOEUVLAN.js";import"./chunk-JZQDGIDQ.js";import"./chunk-CZ6CGC7I.js";import"./chunk-7B6U3N62.js";import"./chunk-46WDO5LS.js";import"./chunk-G5EYK5KM.js";import"./chunk-YJKJQU3F.js";import"./chunk-OK4K3OQT.js";import"./chunk-BPWNCOXC.js";import"./chunk-VNS4CQ27.js";import"./chunk-AVMO6LCR.js";import"./chunk-TEGPMVWT.js";import"./chunk-CLQRQC3Y.js";import"./chunk-KSNU73LO.js";import"./chunk-FACEVGRE.js";import"./chunk-5XTCPT52.js";import{a as L}from"./chunk-JQAW4OB5.js";import"./chunk-R3XLNYYB.js";import"./chunk-2HYVVLKS.js";import"./chunk-XRTA5GHC.js";import"./chunk-Y6XW36QP.js";import"./chunk-ZXKU6WBY.js";import"./chunk-BMYVPMAK.js";import"./chunk-6F25LG6O.js";import"./chunk-6KRFVLII.js";import"./chunk-GJ2QRXGN.js";import"./chunk-DEH76MSI.js";import"./chunk-ALWV3RJ2.js";import"./chunk-6B5XFA6F.js";import"./chunk-TJ6P6NLD.js";import"./chunk-NX5B6XBR.js";import"./chunk-2JABY6DU.js";import"./chunk-MPRKSQLC.js";import"./chunk-57TARQ4F.js";import"./chunk-6RBQSBA2.js";import"./chunk-CSNRCIB5.js";import"./chunk-3JGYBNJA.js";import"./chunk-DA3SDKGO.js";import"./chunk-ZOEPYNM4.js";import"./chunk-57VFBGF3.js";import"./chunk-GWBRHLNH.js";import"./chunk-BJH4F4SM.js";import"./chunk-Z3RBZHAK.js";import"./chunk-NMLYCCKN.js";import"./chunk-ZC6EBRE4.js";import"./chunk-KALOJIUA.js";import"./chunk-KMMTNF7G.js";import"./chunk-E7AX56GD.js";import"./chunk-IDVLLREH.js";import"./chunk-DWLSVYOY.js";import"./chunk-PQGCNP5H.js";import"./chunk-UASS7NJI.js";import"./chunk-WZRAC35O.js";import"./chunk-KUYAWYSS.js";import"./chunk-MIS6QMFE.js";import"./chunk-MDZTV2VL.js";import"./chunk-RNC4P66O.js";import"./chunk-7LHOQXZT.js";import"./chunk-BCREO4Q5.js";import"./chunk-U4QEPZJ3.js";import"./chunk-KJUZWSCL.js";import"./chunk-3WO6D7MU.js";import"./chunk-BUZ3SPLE.js";import"./chunk-K75TK42V.js";import"./chunk-CELWVZPW.js";import"./chunk-OLOKUDVI.js";import"./chunk-DYTVXYAV.js";import"./chunk-ZTOZWLEE.js";import"./chunk-RJWOVI3M.js";import"./chunk-RSDQHAJX.js";import"./chunk-BOVYXYHK.js";import"./chunk-KVM6SHDX.js";import"./chunk-HX2VGIR2.js";import"./chunk-ERDKAICI.js";import"./chunk-EQZWYK27.js";import"./chunk-JLPLCY2B.js";import"./chunk-2GJBUR2F.js";import{a as M}from"./chunk-DKGGDYJI.js";import"./chunk-5LA3PVK5.js";import"./chunk-IR6XCBC4.js";import"./chunk-C6JPAW54.js";import"./chunk-WD3OPXCN.js";import"./chunk-FA3WGIU4.js";import"./chunk-WWVPA6PE.js";import"./chunk-YPMM52MU.js";import"./chunk-BBR7CJCO.js";import"./chunk-ZQIC5NFT.js";import"./chunk-VIEK2X23.js";import"./chunk-XKIFGPJO.js";import"./chunk-PEW2PLAN.js";import"./chunk-Q6Y4JG7Q.js";import"./chunk-7F5DJLJT.js";import"./chunk-CX5IFQZJ.js";import"./chunk-NJWTSROP.js";import"./chunk-D3R25AF2.js";import"./chunk-ARRCN5K3.js";import"./chunk-SLAWDKDA.js";import"./chunk-4N4D2YQX.js";import"./chunk-G4DZJMGT.js";import"./chunk-K5T5FD5C.js";import"./chunk-MVHHPJM7.js";import"./chunk-VDO6JJ3Y.js";import"./chunk-WFKZLI6F.js";import"./chunk-X2B63YVS.js";import"./chunk-BAEF3CT6.js";import"./chunk-AUAZP44J.js";import"./chunk-PVDFCTA4.js";import"./chunk-KNVXE32P.js";import{W as x}from"./chunk-76ATOSLU.js";import"./chunk-CCJU4DSH.js";import{a as m,c as _}from"./chunk-TG45K3WR.js";import"./chunk-RAI4DTMT.js";import{b as f}from"./chunk-ACP3S2CH.js";import"./chunk-HVAXZ2NA.js";import"./chunk-T7DXJKX7.js";import"./chunk-TYYVNQUR.js";import{a as v}from"./chunk-QGVBCWUY.js";import{H as y}from"./chunk-MYO4NP2N.js";import{e as p}from"./chunk-NFIPKH6V.js";import"./chunk-JPU2PQZC.js";import{l as k}from"./chunk-5QEXLALV.js";import"./chunk-P6QFA5MM.js";import"./chunk-DGTD7Y73.js";import"./chunk-LI2SX4T6.js";import"./chunk-BWO7LS2H.js";import"./chunk-HEVQSRJ2.js";import"./chunk-OVHPPCBL.js";import"./chunk-SNFOAZZQ.js";import"./chunk-AML4XSEF.js";import"./chunk-4PTIEWMT.js";import"./chunk-TG2UTNEO.js";import{b as a}from"./chunk-YOFFGXOB.js";import{g as w}from"./chunk-XRGPJ3QY.js";import"./chunk-6MRUJ2UW.js";import"./chunk-2LI2GKBQ.js";import"./chunk-QBWJMFH5.js";import{c as S,f as s}from"./chunk-VTHXE323.js";var u=class extends y{constructor(e){super(e),this._portalLookup=new Map,this._updatingHandlesLoad=new L,this._updatingHandlesExecute=new L,this.advancedEditingUserTypeExtensionLookup=new Map,this.executionError=void 0,this.featureServiceLookup=new Map,this.loadError=void 0,this.serverVersionLookup=new Map,this.serviceNameLookup=new Map,this.userLookup=new Map,this.versionIdentifierLookup=new Map,this.versionInfoLookup=new Map,this.versionAdministratorLookup=new Map,this.versionManagementServiceLookup=new Map,this.versioningStateLookup=new Map,this.view=null,this.versioningStates=null}initialize(){this._viewChangeHandle(),this.addHandles([m(()=>this.view,()=>{this._resetAllLookupProperties(),this._viewChangeHandle()}),m(()=>this.versioningStates,()=>{this._resetVersioningLookupProperties(),this._setVersioningStatesLookups()})])}destroy(){this._updatingHandlesLoad.destroy(),this._updatingHandlesExecute.destroy()}get state(){return this._updatingHandlesLoad.updating?"loading":this.loadError?"disabled":this._updatingHandlesExecute.updating?"executing":this.executionError?"failed":"ready"}alterVersion(e){return s(this,null,function*(){return this._updatingHandlesExecute.addPromise(this._alterVersionInternal(e))})}changeVersion(e,r,o){return s(this,null,function*(){return this._updatingHandlesExecute.addPromise(this._changeVersionInternal(e,r,o))})}createVersion(e){return s(this,null,function*(){return this._updatingHandlesExecute.addPromise(this._createVersionInternal(e))})}deleteVersion(e,r,o){return s(this,null,function*(){return this._updatingHandlesExecute.addPromise(this._deleteVersionInternal(e,r,o))})}getVersionInfos(e){return s(this,null,function*(){return this._updatingHandlesExecute.addPromise(this._getVersionInfosInternal(e))})}_alterVersionInternal(e){return s(this,null,function*(){if(this.state==="disabled")throw this._logError("version-management-view-model:load-error",this.loadError),new a("version-management-view-model:load-error",this.loadError);this._setExecutionError();let r=this.versioningStateLookup.get(e.featureServerUrl);if(!r)throw this._logError("version-management-view-model:execution-error","no-versioning-state-found"),new a("version-management-view-model:execution-error",this.executionError);if(!this.serverVersionLookup.has(e.featureServerUrl)||this.serverVersionLookup.get(e.featureServerUrl)<=11.1)throw this._logError("version-management-view-model:execution-error","no-valid-enterprise-version"),new a("version-management-view-model:execution-error",this.executionError);if(!this.advancedEditingUserTypeExtensionLookup.get(e.featureServerUrl))throw this._logError("version-management-view-model:execution-error","no-advanced-editing-user-type-extension"),new a("version-management-view-model:execution-error",this.executionError);let h=e,{featureServerUrl:o,versionIdentifier:n}=h,t=S(h,["featureServerUrl","versionIdentifier"]),i=yield r.alterVersion(n,t).catch(l=>{throw this._logExecutionError(l),l});return yield this.getVersionInfos(o),i})}_changeVersionInternal(e,r,o){return s(this,null,function*(){if(this.state==="disabled")throw this._logError("version-management-view-model:load-error",this.loadError),new a("version-management-view-model:load-error",this.loadError);this._setExecutionError();let n=this.versioningStateLookup.get(e);if(!n)throw this._logError("version-management-view-model:execution-error","no-versioning-state-found"),new a("version-management-view-model:execution-error",this.executionError);let t={name:r,guid:o};return yield n.changeVersion(t).catch(i=>{throw this._logExecutionError(i),i})})}_updateVersionableItems(e){this._updatingHandlesLoad.addPromise(s(this,null,function*(){E(e.added).forEach(r=>{let o=r.featureServiceUrl,n=this.versioningStateLookup.get(o);n&&(n.versionableItems.find(t=>t.versionableItem===r.versionableItem)||n.versionableItems.add(r))}),E(e.removed).forEach(r=>{let{allLayers:o,allTables:n}=this.view.map,t=r.featureServiceUrl,i=this.versioningStateLookup.get(t);if(!i)return void this._logError("version-management-view-model:execution-error","no-version-management-service-found");let h=d=>(d.type==="feature"||d.type==="subtype-group")&&(d.url?.includes(t)??!1);[...o.filter(h),...n.filter(h)].length||(this.featureServiceLookup.delete(t),this.serviceNameLookup.delete(t),this.versioningStateLookup.delete(t),this.versioningStates.remove(i));let l=i.versionableItems.find(d=>d.versionableItem===r.versionableItem);l&&i.versionableItems.remove(l)})}))}_createVersionInternal(e){return s(this,null,function*(){if(this.state==="disabled")throw this._logError("version-management-view-model:load-error",this.loadError),new a("version-management-view-model:load-error",this.loadError);this._setExecutionError();let r=e.featureServerUrl,o=this.versioningStateLookup.get(r);if(!o)throw this._logError("version-management-view-model:execution-error","no-versioning-state-found"),new a("version-management-view-model:execution-error",this.executionError);let n=this.advancedEditingUserTypeExtensionLookup.get(e.featureServerUrl),t=this.userLookup.get(r).toUpperCase(),i=this._isEmptyString(e.ownerName)?t:e.ownerName?.trim().toUpperCase();if(i!==t){if(this.serverVersionLookup.get(r)<=11.1)throw this._logError("version-management-view-model:execution-error","versioning-api-error"),new a("version-management-view-model:execution-error",this.executionError);if(!n)throw this._logError("version-management-view-model:execution-error","no-advanced-editing-user-type-extension"),new a("version-management-view-model:execution-error",this.executionError)}let h=yield this.versioningStateLookup.get(r)?.getVersionInfos();if(i?.toUpperCase()==="SDE"&&e.versionName.toUpperCase()==="DEFAULT"||h?.find(d=>d.versionIdentifier.name.toUpperCase()===(i+"."+e.versionName).toUpperCase()||d.versionIdentifier.name.toUpperCase()===(t+"."+e.versionName).toUpperCase()))throw this._logError("version-management-view-model:execution-error","no-valid-version-name"),new a("version-management-view-model:execution-error",this.executionError);let l=yield o.versionManagementService.createVersion({versionName:e.versionName,access:i!==t?"public":e.access,description:e.description}).catch(d=>{throw this._logExecutionError(d),d});if(i!==t){let{guid:d,name:c}=l.versionIdentifier,g={featureServerUrl:r,versionIdentifier:{guid:d,name:c},access:e.access,ownerName:i};(yield this.alterVersion(g))||this.deleteVersion(r,t+"."+e.versionName,l.versionIdentifier.guid)}return yield this.getVersionInfos(r),h=yield this.versioningStateLookup.get(r)?.getVersionInfos(),h?.find(d=>d.versionIdentifier.guid===l.versionIdentifier.guid)})}_deleteVersionInternal(e,r,o){return s(this,null,function*(){if(this.state==="disabled")throw this._logError("version-management-view-model:load-error",this.loadError),new a("version-management-view-model:load-error",this.loadError);this._setExecutionError();let n=this.versioningStateLookup.get(e);if(!n)throw this._logError("version-management-view-model:execution-error","no-versioning-state-found"),new a("version-management-view-model:execution-error",this.executionError);if(this.serverVersionLookup.get(e)<=11.1)throw this._logError("version-management-view-model:execution-error","versioning-api-error"),new a("version-management-view-model:execution-error",this.executionError);if(!this.advancedEditingUserTypeExtensionLookup.get(e))throw this._logError("version-management-view-model:execution-error","no-advanced-editing-user-type-extension"),new a("version-management-view-model:execution-error",this.executionError);let t={name:r,guid:o};return yield n.deleteVersion(t).catch(i=>{throw this._logExecutionError(i),new a("version-management-view-model:execution-error",this.executionError)})})}_getVersionInfosInternal(e){return s(this,null,function*(){if(this.state==="disabled")throw this._logError("version-management-view-model:load-error",this.loadError),new a("version-management-view-model:load-error",this.loadError);this._setExecutionError();let r=this.featureServiceLookup.get(e)?.featureService;if(!r)throw this._logError("version-management-view-model:execution-error","no-feature-service-found"),new a("version-management-view-model:execution-error",this.executionError);r.loaded||(yield r.load().catch(i=>{throw this._logExecutionError(i),i}));let o=r.url;this.serverVersionLookup.set(o,r.sourceJSON?.currentVersion??0),this.serverVersionLookup.get(o)<=11.1&&this.advancedEditingUserTypeExtensionLookup.set(o,!1);let n=this.userLookup.get(e);this._portalLookup.get(e)&&n?(this.advancedEditingUserTypeExtensionLookup.set(o,yield U(this._portalLookup.get(e),n,"advediting")),this.versionAdministratorLookup.set(o,yield I(this._portalLookup.get(e),n,"features:user:manageVersions"))):(this.advancedEditingUserTypeExtensionLookup.set(o,!1),this.versionAdministratorLookup.set(o,!1));let t=this.versioningStateLookup.get(e);if(!t)throw this._logError("version-management-view-model:execution-error","no-versioning-state-found"),new a("version-management-view-model:execution-error",this.executionError);return t.loaded||(yield t.load().catch(i=>{throw this._logExecutionError(i),i})),yield t.getVersionInfos(!0).catch(i=>{throw this._logExecutionError(i),i})})}_isEmptyString(e){return!e||e.trim().length===0}_logError(e,r){switch(w.getLogger(this).error(new a(e,r)),e){case"version-management-view-model:load-error":this._setLoadError(r);break;case"version-management-view-model:execution-error":this._setExecutionError(r)}}_logExecutionError(e){this._logError("version-management-view-model:execution-error",e.message)}_viewChangeHandle(){return s(this,null,function*(){this._updatingHandlesLoad.addPromise(s(this,null,function*(){if(this._setLoadError(),!this.view)return void this._setLoadError("no-view-property");if(this.view&&this.view.type!=="2d")return void this._logError("version-management-view-model:load-error","sceneView-not-supported");this.removeHandles("map-change-handle"),this.addHandles([m(()=>this.view?.map,()=>{this._resetAllLookupProperties(),this._mapChangeHandle(this.versioningStates)})],"map-change-handle");let e=yield this._getVersioningStates();yield this._mapChangeHandle(e)}))})}_mapChangeHandle(e){return s(this,null,function*(){this._updatingHandlesLoad.addPromise(s(this,null,function*(){this._setLoadError(),this.removeHandles("map-layers-tables-change-handle"),this.addHandles([_(()=>this.view?.map.allLayers,"change",r=>{(r.added.some(({type:o})=>o==="feature")||r.removed.some(({type:o})=>o==="feature")||r.added.some(({type:o})=>o==="subtype-group")||r.removed.some(({type:o})=>o==="subtype-group"))&&(this._resetServiceRelatedLookupProperties(),this._propertiesChangeInternal(this.versioningStates),this._updateVersionableItems(r))}),_(()=>this.view?.map.allTables,"change",r=>{(r.added.some(({type:o})=>o==="feature")||r.removed.some(({type:o})=>o==="feature")||r.added.some(({type:o})=>o==="subtype-group")||r.removed.some(({type:o})=>o==="subtype-group"))&&(this._resetServiceRelatedLookupProperties(),this._propertiesChangeInternal(this.versioningStates),this._updateVersionableItems(r))})],"map-layers-tables-change-handle"),yield this._propertiesChangeInternal(e)}))})}_propertiesChangeInternal(e){return s(this,null,function*(){this._updatingHandlesLoad.addPromise(s(this,null,function*(){let r=t=>t.type==="feature"||t.type==="subtype-group",{allLayers:o,allTables:n}=this.view.map;if(this._setLoadError(),this.featureServiceLookup=C([...o.filter(r),...n.filter(r)]),this.featureServiceLookup.size){this._updateFeatureServiceLookup(e),this.serviceNameLookup=new Map;for(let t of this.featureServiceLookup.values()){let{featureService:i,featureService:{url:h}}=t;if(!this.serviceNameLookup.has(h)){if(i.loaded||(yield i.load().catch(g=>{w.getLogger(this).error(g)})),!i.versionManagementServiceUrl){this.featureServiceLookup.delete(h);continue}let l=yield V(h),d=new M({authMode:"immediate",url:l});yield d.load().catch(g=>{w.getLogger(this).error(g)});let c=d.user?.username;if(!i.loaded||!d.loaded||!c)continue;this.serviceNameLookup.set(x(h),h.split("/").at(-2)),this.userLookup.set(h,c),this._portalLookup.set(h,d)}}this.removeHandles("versioning-states-change-handle"),e.forEach(t=>this._handleVersioningStateLookupUpdate(t)),yield this._updateVersioningStates(e),this.versioningStates=e}else this._logError("version-management-view-model:load-error","no-feature-services")}))})}_updateFeatureServiceLookup(e){for(let r of e){let o=r.featureServiceUrl;if(!this.featureServiceLookup.has(o)){let n=new b({url:o}),t=r.versionableItems.toArray().flatMap(i=>i.type==="network"?null:i.versionableItem).filter(i=>!!i);this.featureServiceLookup.set(o,{featureService:n,layers:t})}}}_updateVersioningStates(e){return s(this,null,function*(){for(let r of this.featureServiceLookup.values()){let o=r.featureService;if(o.versionManagementServiceUrl){if(!e.find(n=>n.featureServiceUrl===o.url)&&o.versionManagementServiceUrl){let n=new f(E(r.layers)),t=new H({versionManagementService:new P({url:o.versionManagementServiceUrl}),versionableItems:n});e.add(t),this._handleVersioningStateLookupUpdate(t)}yield this.getVersionInfos(o.url)}}})}_getVersioningStates(){return s(this,null,function*(){return this.versioningStates&&this.versioningStates.length?this.versioningStates:this.view?yield N(this.view,!1):(this._logError("version-management-view-model:load-error","no-view-property"),new f)})}_handleVersioningStateLookupUpdate(e){this.versioningStateLookup.set(e.featureServiceUrl,e),this._addHandlesToVersioningState(e),this.versionIdentifierLookup.set(e.featureServiceUrl,e.currentVersionInfo?.versionIdentifier),this.versionManagementServiceLookup.set(e.featureServiceUrl,e.versionManagementService)}_setVersioningStatesLookups(){return s(this,null,function*(){this._updatingHandlesLoad.addPromise(s(this,null,function*(){this.versioningStates&&(this.removeHandles("versioning-states-change-handle"),this._updateFeatureServiceLookup(this.versioningStates),this.versioningStates.forEach(e=>this._handleVersioningStateLookupUpdate(e)),yield this._updateVersioningStates(this.versioningStates))}))})}_addHandlesToVersioningState(e){this.addHandles([m(()=>e.versionInfos,()=>{this.versionInfoLookup.set(e.featureServiceUrl,e.versionInfos)}),m(()=>e.currentVersionInfo?.versionIdentifier,()=>{this.versionIdentifierLookup.set(e.featureServiceUrl,e.currentVersionInfo?.versionIdentifier)})],"versioning-states-change-handle")}_resetVersioningLookupProperties(){this.versionIdentifierLookup=new Map,this.versionInfoLookup=new Map,this.versionManagementServiceLookup=new Map,this.versioningStateLookup=new Map}_resetAllLookupProperties(){this._portalLookup=new Map,this.advancedEditingUserTypeExtensionLookup=new Map,this.serverVersionLookup=new Map,this.userLookup=new Map,this.versioningStates=new f,this._resetVersioningLookupProperties(),this._resetServiceRelatedLookupProperties()}_resetServiceRelatedLookupProperties(){this.featureServiceLookup=new Map,this.serviceNameLookup=new Map}_setExecutionError(e){this._set("executionError",e)}_setLoadError(e){this._set("loadError",e)}};v([p()],u.prototype,"_portalLookup",void 0),v([p()],u.prototype,"advancedEditingUserTypeExtensionLookup",void 0),v([p({readOnly:!0})],u.prototype,"executionError",void 0),v([p()],u.prototype,"featureServiceLookup",void 0),v([p({readOnly:!0})],u.prototype,"loadError",void 0),v([p()],u.prototype,"serverVersionLookup",void 0),v([p()],u.prototype,"serviceNameLookup",void 0),v([p({readOnly:!0})],u.prototype,"state",null),v([p()],u.prototype,"userLookup",void 0),v([p()],u.prototype,"versionIdentifierLookup",void 0),v([p()],u.prototype,"versionInfoLookup",void 0),v([p()],u.prototype,"versionAdministratorLookup",void 0),v([p()],u.prototype,"versionManagementServiceLookup",void 0),v([p()],u.prototype,"versioningStateLookup",void 0),v([p()],u.prototype,"view",void 0),v([p()],u.prototype,"versioningStates",void 0),u=v([k("esri.widgets.VersionManagement.VersionManagementViewModel")],u);var oe=u;export{oe as default};
