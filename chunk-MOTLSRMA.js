import{C as v}from"./chunk-WCHIR27X.js";import{a as f,b as y}from"./chunk-QGGZPZNN.js";import{a as d}from"./chunk-26JWDTE3.js";import{e as u,f as g}from"./chunk-456M7HFK.js";import{e as p}from"./chunk-TG45K3WR.js";import{a as r}from"./chunk-QGVBCWUY.js";import{e as l}from"./chunk-NFIPKH6V.js";import{l as m}from"./chunk-5QEXLALV.js";import{b as n}from"./chunk-YOFFGXOB.js";var V=w=>{let a=class extends w{constructor(){super(...arguments),this.hasMixedImageFormats=!0}get imageFormatIsOpaque(){return!1}get fullExtent(){return this.layer.fullExtent}get isOpaque(){return this.fullOpacity>=1&&this.imageFormatIsOpaque}get visibleAtCurrentScale(){if(!u(this.layer.minScale,this.layer.maxScale)||!this.view.scale)return!0;let e=Math.round(this.view.basemapTerrain.tilingScheme.levelAtScale(this.view.scale));return e>=this.displayLevelRange.minLevel&&e<=this.displayLevelRange.maxLevel}get dataScaleRange(){let e=this.tileInfo.lods,i=e[0].scale,t=e[e.length-1].scale;if("tilemapCache"in this.layer&&this.layer.tilemapCache){let{effectiveMinLOD:s,effectiveMaxLOD:o}=this.layer.tilemapCache;i=this.tileInfo.lodAt(s).scale,t=this.tileInfo.lodAt(o).scale}return{minScale:i,maxScale:t}}canResume(){let e=this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null;return this.visible&&this.layer?.loaded&&!this.parent?.suspended&&this.view?.ready&&g(e)&&this.visibleAtCurrentTimeExtent||!1}get dataLevelRange(){let{minScale:e,maxScale:i}=this.dataScaleRange;return this.levelRangeFromScaleRange(e,i)}get displayLevelRange(){let e=this.layer.minScale||this.dataScaleRange.minScale,i=this.layer.maxScale||this.dataScaleRange.maxScale,t=this.levelRangeFromScaleRange(e,i);return this.layer.maxScale&&t.maxLevel++,t}get performanceInfo(){return new d(this.view.basemapTerrain.getUsedMemoryForLayerView(this))}getTileUrl(e){return this.layer.getTileUrl(e[0],e[1],e[2])}_addTilingSchemeMatchPromise(){if(this.fullExtent==null)return this.addResolvingPromise(Promise.reject(new n("tilingscheme:extent-not-defined","This layer doesn't define a fullExtent.")));let e=this._getTileInfoSupportError(this.tileInfo,this.fullExtent);if(e)return this.addResolvingPromise(Promise.reject(e));this.addResolvingPromise(p(()=>this.view?.basemapTerrain?.tilingSchemeLocked).then(()=>{let i=this.view.basemapTerrain.tilingScheme,t="tilemapCache"in this.layer?this.layer.tilemapCache?.effectiveMaxLOD:void 0,s=this._getTileInfoCompatibilityError(this.tileInfo,i,t);if(s)throw s}))}_getTileInfoSupportError(e,i){let t=v(e,i,this.view.spatialReference,this.view.state.viewingMode,"tilemapCache"in this.layer?this.layer.tilemapCache?.effectiveMaxLOD:void 0);if(!t)return;let s={layer:this.layer,error:t};switch(t.name){case"tilingscheme:spatial-reference-mismatch":case"tilingscheme:global-unsupported-spatial-reference":case"tilingscheme:local-unsupported-spatial-reference":return new n("layerview:spatial-reference-incompatible","The spatial reference of this layer does not meet the requirements of the view",s);default:return new n("layerview:tiling-scheme-unsupported","The tiling scheme of this layer is not supported by SceneView",s)}}_getTileInfoCompatibilityError(e,i,t){return e!=null&&i.compatibleWith(e,t)?null:new n("layerview:tiling-scheme-incompatible","The tiling scheme of this layer is incompatible with the tiling scheme of the surface")}levelRangeFromScaleRange(e,i){let t={minLevel:0,maxLevel:1/0},s=this.view&&this.view.basemapTerrain&&this.view.basemapTerrain.tilingScheme;if(!s)return t;let o=s.levels[0],c=S=>{let h=Math.log(o.scale/S)/Math.LN2;return .5-Math.abs(.5-h%1)<1e-9?Math.round(h):Math.ceil(h)};return e!=null&&e>0&&(t.minLevel=Math.max(0,c(e))),i!=null&&i>0&&(t.maxLevel=Math.max(0,c(i))),t}isUpdating(){return!!(this.view&&this.view.basemapTerrain&&this.view.basemapTerrain.updating)}};return r([l({readOnly:!0})],a.prototype,"imageFormatIsOpaque",null),r([l({readOnly:!0})],a.prototype,"updating",void 0),r([l(y)],a.prototype,"updatingProgress",void 0),r([l(f)],a.prototype,"updatingProgressValue",void 0),r([l()],a.prototype,"hasMixedImageFormats",void 0),r([l()],a.prototype,"fullExtent",null),r([l({readOnly:!0})],a.prototype,"isOpaque",null),r([l({readOnly:!0})],a.prototype,"visibleAtCurrentScale",null),r([l()],a.prototype,"dataScaleRange",null),r([l({readOnly:!0})],a.prototype,"dataLevelRange",null),r([l({readOnly:!0})],a.prototype,"displayLevelRange",null),r([l()],a.prototype,"layer",void 0),a=r([m("esri.views.3d.layers.TiledLayerView3D")],a),a};export{V as a};
