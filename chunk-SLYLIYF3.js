import{d as B}from"./chunk-4JIR4MZV.js";import{b as z}from"./chunk-HUWVQAJL.js";import{a as f,e as q,j as x}from"./chunk-TG45K3WR.js";import{f as N}from"./chunk-RAI4DTMT.js";import{a as h}from"./chunk-QGVBCWUY.js";import{o as g}from"./chunk-MYO4NP2N.js";import{e as d}from"./chunk-NFIPKH6V.js";import{l as v}from"./chunk-5QEXLALV.js";import{D as G,H as S,L as F,p as k}from"./chunk-4PTIEWMT.js";import{b as w}from"./chunk-YOFFGXOB.js";import{g as E}from"./chunk-XRGPJ3QY.js";import{a as L}from"./chunk-QBWJMFH5.js";import{a as T,f as m}from"./chunk-VTHXE323.js";var y={widthBreakpoint:{getValue(r){let i=r.viewSize[0],e=r.breakpoints,t=this.values;return i<=e.xsmall?t.xsmall:i<=e.small?t.small:i<=e.medium?t.medium:i<=e.large?t.large:t.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-width-xsmall esri-view-width-less-than-small esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",small:"esri-view-width-small esri-view-width-greater-than-xsmall esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",medium:"esri-view-width-medium esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-less-than-large esri-view-width-less-than-xlarge",large:"esri-view-width-large esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-less-than-xlarge",xlarge:"esri-view-width-xlarge esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-greater-than-large"}},heightBreakpoint:{getValue(r){let i=r.viewSize[1],e=r.breakpoints,t=this.values;return i<=e.xsmall?t.xsmall:i<=e.small?t.small:i<=e.medium?t.medium:i<=e.large?t.large:t.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-height-xsmall esri-view-height-less-than-small esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",small:"esri-view-height-small esri-view-height-greater-than-xsmall esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",medium:"esri-view-height-medium esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-less-than-large esri-view-height-less-than-xlarge",large:"esri-view-height-large esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-less-than-xlarge",xlarge:"esri-view-height-xlarge esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-greater-than-large"}},orientation:{getValue(r){let i=r.viewSize,e=i[0],t=i[1],s=this.values;return t>=e?s.portrait:s.landscape},values:{portrait:"portrait",landscape:"landscape"},valueToClassName:{portrait:"esri-view-orientation-portrait",landscape:"esri-view-orientation-landscape"}}},P={xsmall:544,small:768,medium:992,large:1200};function j(r){let i=r;return i&&i.xsmall<i.small&&i.small<i.medium&&i.medium<i.large}function V(r,i){return i?y[r].valueToClassName[i].split(" "):[]}var Q=r=>{let i=class extends r{constructor(...e){super(...e),this.orientation=null,this.widthBreakpoint=null,this.heightBreakpoint=null,this.breakpoints=P}initialize(){this.addHandles(f(()=>[this.breakpoints,this.size],()=>this._updateClassNames(),x))}destroy(){this.destroyed||this._removeActiveClassNames()}set breakpoints(e){if(e!==this._get("breakpoints")){if(!j(e)){let t=JSON.stringify(P,null,2);console.warn("provided breakpoints are not valid, using defaults:"+t),e=P}this._set("breakpoints",T({},e))}}_updateClassNames(){if(!this.container)return;let e=g.acquire(),t=g.acquire(),s,o=!1;for(s in y){let n=this[s],a=y[s].getValue({viewSize:this.size,breakpoints:this.breakpoints});n!==a&&(o=!0,this[s]=a,V(s,n).forEach(l=>t.push(l)),V(s,a).forEach(l=>e.push(l)))}o&&(this._applyClassNameChanges(e,t),g.release(e),g.release(t))}_applyClassNameChanges(e,t){let s=this.container;s&&(t.forEach(o=>s.classList.remove(o)),e.forEach(o=>s.classList.add(o)))}_removeActiveClassNames(){let e=this.container;if(!e)return;let t;for(t in y)V(t,this[t]).forEach(s=>e.classList.remove(s))}};return h([d()],i.prototype,"breakpoints",null),h([d()],i.prototype,"orientation",void 0),h([d()],i.prototype,"widthBreakpoint",void 0),h([d()],i.prototype,"heightBreakpoint",void 0),i=h([v("esri.views.BreakpointsOwner")],i),i};function c(r){return r!=null&&"open"in r&&"declaredClass"in r}function H(r){return r!=null&&"declaredClass"in r&&"dockOptions"in r}var me=r=>{let i=class extends r{constructor(){super(...arguments),this._popupSetupTask=null,this.popup={},this.popupEnabled=!0}initialize(){this.addHandles([f(()=>[this.ui,this.popup],([e,t],s)=>{let o="popup",n="manual";if(s){let[a,l]=s;a&&c(l)&&(l.view=null,H(l)&&a.remove(l,o))}e&&c(t)&&(t.view=this,H(t)&&e.add(t,{key:o,position:n,internal:!0}))},x),this.on("click",e=>{this.popup&&this.popupEnabled&&(e.pointerType!=="mouse"||e.button===0)&&(c(this.popup)?this.popup.viewModel.handleViewClick(e):e.async(()=>m(this,null,function*(){yield this.setupPopup(),c(this.popup)&&!this.destroyed&&this.ready&&this.popupEnabled&&this.popup.viewModel.handleViewClick(e)})))},B.WIDGET)]),q(()=>this.ready&&this.popupEnabled&&!this.updating).then(()=>{import("./chunk-XHWFHO6F.js")})}destroy(){this.destroyed||this.closePopup()}openPopup(e){return m(this,null,function*(){if(c(this.popup))return this.popup.open(e);try{if(yield this.setupPopup(),!this.popup)return void E.getLogger(this).error(new w("view:null-popup","Popup is null and can't be opened"));this.popup.open(e)}catch{}})}closePopup(){this._popupSetupTask?.abort(),c(this.popup)&&this.popup.close()}fetchPopupFeatures(e,t){return m(this,null,function*(){return yield this.when(),this._popupHitsToFeatures(yield this._getPopupHits(e,t),t)})}setupPopup(){return m(this,null,function*(){if(this._popupSetupTask?.abort(),this.popup&&!c(this.popup))return this._popupSetupTask=N(e=>m(this,null,function*(){let{default:t}=yield import("./chunk-XHWFHO6F.js");if(k(e),!this.popup||c(this.popup))return;let s=this.popup;delete s.open,delete s.close,this.popup=new t(s)})),this._popupSetupTask.promise})}_popupHitsToFeatures(o,n){return m(this,arguments,function*({location:e,hits:t},s){let a=[],l=[],b=!1,C=S(s,L("popup-view-fetch-timeout")??I),W=p=>{let u=new _(p);return l.push(u),a.push(u.promise),u},A=p=>{let u=l.at(-1);return u&&u.layerView===p&&!b?u:W(p)};for(let p of t)"graphic"in p?(A(p.layerView).graphics.push(p.graphic),b=!1):(a.push(p.layerView.fetchPopupFeaturesAtLocation(p.mapPoint,C)),b=!0);l.map(p=>p.resolve(C));let O=G(a).then(p=>p.filter(u=>!!u).flat());return{pendingFeatures:a,allGraphicsPromise:O,location:e}})}_getPopupHits(e,t){return m(this,null,function*(){let{hits:s,location:o}=yield this.popupHitTest(e);k(t);let n=[];for(let a of s)if("graphic"in a){if(this._isValidPopupGraphic(a.graphic,t)){let l=this._isValidPopupGraphicsLayerView(a.layerView)?a.layerView:void 0;n.push({graphic:a.graphic,layerView:l})}}else this._isValidPopupLocationLayerView(a.layerView)&&n.push({mapPoint:a.mapPoint,layerView:a.layerView});return{hits:n,location:o}})}_isValidPopupGraphic(e,t){return e&&!!e.getEffectivePopupTemplate(t?.defaultPopupTemplateEnabled)}_isValidPopupGraphicsLayerView(e){return!e||(!("layer"in e)||!e.suspended)&&"fetchPopupFeaturesFromGraphics"in e}_isValidPopupLocationLayerView(e){return(!("layer"in e)||!e.suspended)&&"fetchPopupFeaturesAtLocation"in e}};return h([d()],i.prototype,"popup",void 0),h([d()],i.prototype,"popupEnabled",void 0),i=h([v("esri.views.PopupView")],i),i},_=class{constructor(i){this.layerView=i,this._resolver=F(),this.graphics=[]}get promise(){return this._resolver.promise}resolve(i){let{layerView:e,graphics:t,_resolver:s}=this;if(!e)return s.resolve(t),s.promise;let o;return e.fetchPopupFeaturesFromGraphics(t,i).catch(n=>(o=n,null)).then(n=>{n?s.resolve(n):s.reject(o)}),s.promise}},I=5e3;function fe(r){let i=z();return i.available?r==="3d"&&i.majorPerformanceCaveat?new w("webgl:major-performance-caveat-detected",`Your WebGL implementation (${i.unmaskedRenderer}) doesn't seem to support hardware accelerated rendering. Check your browser settings or if your GPU is in a blocklist.`):i.supportsHighPrecisionFragment?i.supportsVertexShaderSamplers?null:new w("webgl:vertex-shader-samplers-required","WebGL support for vertex shader samplers is required but not supported."):new w("webgl:high-precision-fragment-required","WebGL support for high precision fragment shaders is required but not supported."):new w("webgl:required","WebGL2 is required but not supported.",new Error().stack)}export{Q as a,me as b,fe as c};
