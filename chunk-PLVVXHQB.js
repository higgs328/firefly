import{O as X,W as F,X as Y,Y as j,ja as C}from"./chunk-XXEY6HOD.js";import{G as z,p as W}from"./chunk-6B5XFA6F.js";import{a as R}from"./chunk-BOVYXYHK.js";import{i as M,j as b}from"./chunk-EQZWYK27.js";import{j as O}from"./chunk-Q6Y4JG7Q.js";import{a as p,b as w}from"./chunk-VTHXE323.js";function G(a,o){let{cameraLocation:t,pointsToTransform:r,scalingFactor:c}=k(a,o.cameraLocation,o.rotationMatrix),i=new Array;return S(r,i,p(w(p({},o),{cameraLocation:t,scalingFactor:c}),K(o))),Array.isArray(a)?i:i[0]}function aa(a,o,t){return G(a?o.map(r=>O(r)):o,t).map(r=>w(p({},r),{z:1}))}function S(a,o,t){let{affineTransformations:r,cameraLocation:c,focalLengthX:i,focalLengthY:L,principalOffsetPoint:f,radialDistortionCoefficients:s,rotationMatrix:e,scalingFactor:h,tangentialDistortionCoefficients:u}=t;for(let V of a){let n=R();z(n,V,c),n[0]=n[0]/h,n[1]=n[1]/h;let l=-i*((e[0]*n[0]+e[3]*n[1]+e[6]*n[2])/(e[2]*n[0]+e[5]*n[1]+e[8]*n[2])),g=-L*((e[1]*n[0]+e[4]*n[1]+e[7]*n[2])/(e[2]*n[0]+e[5]*n[1]+e[8]*n[2])),m=l*l+g*g,N=0,v=0,x=0,T=0,d=0,P=0,H=0;s&&(N=s[0]??0,v=s[1]??0,x=s[2]??0),u&&(T=u[0],d=u[1]),f&&(P=f[0]??0,H=f[1]??0);let I=1+N*m+v*m*m+x*m*m*m,y=l*I+T*(m+2*l**2)+2*d*l*g,A=g*I+d*(m+2*g**2)+2*T*l*g;y+=P,A+=H;let q=Number(r[0])+Number(r[1])*y+Number(r[2])*A,E=Number(r[3])+Number(r[4])*y+Number(r[5])*A;o.push({x:q,y:E})}}function oa(a,o){let{cameraHeading:t,imageHeight:r,imageWidth:c}=o,{cameraLocation:i,pointsToTransform:L}=B(a,o.cameraLocation),f=new Array;for(let s of L){let e=W(i,s),h=C(b(Math.atan2(s[0]-i[0],s[1]-i[1]))-t),u=b(Math.acos((i[2]-s[2])/e));f.push(X(h,u,c,r))}return Array.isArray(a)?f:f[0]}function k(a,o,t){let r=Array.isArray(a)||"items"in a?a:[a];F(r,o),D(r,o),Y(t);let c=j(o.y,o.spatialReference);return{pointsToTransform:r.map(i=>i.toArray()),scalingFactor:c,cameraLocation:o.toArray()}}function B(a,o){let t=Array.isArray(a)||"items"in a?a:[a];return F(t,o),D(t,o),{pointsToTransform:t.map(r=>r.toArray()),cameraLocation:o.toArray()}}function D(a,o){if(a.some(t=>!t.spatialReference.equals(o.spatialReference)))throw new Error("Input points and camera location must have the same spatial reference")}function J(a){return a?.focalLength!=null}function K(a){if(J(a))return{focalLengthX:a.focalLength,focalLengthY:a.focalLength};let{imageWidth:o,imageHeight:t,horizontalFieldOfView:r,verticalFieldOfView:c}=a;return{focalLengthX:o/(2*Math.tan(M(r)/2)),focalLengthY:t/(2*Math.tan(M(c)/2))}}export{G as a,aa as b,oa as c};
