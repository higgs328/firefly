import{a as x,b as N,c as y}from"./chunk-74EUEJXX.js";import{a as V}from"./chunk-LORHDXEB.js";import{a as b}from"./chunk-SLAWDKDA.js";import{b as c}from"./chunk-ACP3S2CH.js";import{a as o}from"./chunk-QGVBCWUY.js";import{H as w}from"./chunk-MYO4NP2N.js";import{e as i}from"./chunk-NFIPKH6V.js";import{l as _}from"./chunk-5QEXLALV.js";import{p as h,y as v}from"./chunk-4PTIEWMT.js";import{o as g}from"./chunk-QBWJMFH5.js";import{f as d}from"./chunk-VTHXE323.js";var O="overview",I=e=>t=>{let l=e.toLowerCase();return t.sublayers.find(n=>n.modelName?.toLowerCase()===l)??null},S=I("fullmodel"),C=I(O);function U(e){let t=S(e);t!=null&&(t.visible=!0);let l=C(e);l!=null&&(l.visible=!1)}function $(e,t){let l=A(e,t);if(l==null)return null;let n=l.fieldName;if(n==null||!n)return null;let a=E(e,n),r=new Map;for(let u of l.mostFrequentValues??[])typeof u=="number"&&r.set(u,a!=null?a.getName(u):String(u));return{fieldName:n,fieldValueMap:r}}function E(e,t){for(let l of e.allSublayers.items){let n=l.type==="building-component"?l.getFieldDomain?.(t):null;if(n&&n.type==="coded-value")return n}return null}function A(e,t){let l=e.summaryStatistics?.fields??[],n=t.toLowerCase();return l.find(a=>a.modelName?.toLowerCase()===n)??null}function M(){let e=new AbortController;return t=>d(this,null,function*(){e.abort(),e=new AbortController;let l={signal:e.signal},n=t.toArray().map(a=>D(a,l));yield Promise.all(n),h(l)})}function D(e,t){return d(this,null,function*(){yield e.load(t),yield e.loadAll(),h(t),e.summaryStatistics&&(yield e.summaryStatistics.load(t))})}function m(e){let t={fieldValueMap:new Map,allowedValues:[]};for(let l of e){let n=l.fieldValueMap,a=t.fieldValueMap;n.forEach((r,u)=>{a.has(u)||(a.set(u,r),t.allowedValues.push(u))})}return t.allowedValues.sort((l,n)=>l-n),t}function F(e){let t=null;for(let l of e)t=t!=null?Math.min(t,l):l;return t}function B(e){let t=null;for(let l of e)t=t!=null?Math.max(t,l):l;return t}function f(e,t){return t.allowedValues.length>0?P(e,t.allowedValues):null}function P(e,t){if(t.length===0)return e;if(e===1/0)return t[t.length-1];if(e===-1/0)return t[0];let l=t[0],n=Math.abs(l-e);for(let a of t){let r=Math.abs(a-e);r<n&&(l=a,n=r)}return l}var s=class extends w{constructor(e){super(e),this.state="disabled",this._valueBeforeReady=null,this._domainInfo=m([]),this._loadLayers=M(),this.layers=new c}initialize(){this.addHandles(this.layers.on("change",()=>this._onLayersChange())),this._onLayersChange()}destroy(){this._set("state","disabled")}get enabled(){return this.allowedValues.length>0&&this._get("enabled")}set enabled(e){e!==this.enabled&&this.allowedValues.length>0&&this._set("enabled",e)}get value(){return(this.state==="ready"?this._get("value"):this._valueBeforeReady)??0}set value(e){if(this.state!=="ready")return void(this._valueBeforeReady=e);if(e===this.value)return;let t=f(e,this);t!=null&&this._set("value",t)}get min(){return F(this.allowedValues)}get max(){return B(this.allowedValues)}get allowedValues(){return this._domainInfo.allowedValues}set allowedValues(e){e==null?this._clearOverride("allowedValues"):this._override("allowedValues",e);let t=f(this.value,this);t!=null&&(this.value=t)}get hasNext(){if(!this.enabled)return!0;let e=this._valueIndex;return e>=0&&e<this.allowedValues.length-1}get hasPrevious(){return!this.enabled||this._valueIndex>0}set layers(e){let t=this._get("layers");this._set("layers",V(e,t))}get filterExpressions(){return{solid:null,xRay:null}}get _valueIndex(){return g(this.allowedValues,this.value)}select(e){if(this.state!=="ready")return void(this._valueBeforeReady=e);f(e,this)!=null&&(this.enabled=!0,this.value=e)}clear(){this.state==="ready"?this.enabled=!1:this._valueBeforeReady=null}next(){let{state:e,allowedValues:t,enabled:l,hasNext:n,_valueIndex:a}=this;if(e==="ready"||this._valueBeforeReady==null){if(t.length!==0)return l?void(n&&(this.value=t[a+1])):(this.enabled=!0,void(this.value=t[0]))}else this._valueBeforeReady++}previous(){let{state:e,allowedValues:t,enabled:l,hasPrevious:n,_valueIndex:a}=this;if(e==="ready"||this._valueBeforeReady==null){if(t.length!==0)return l?void(n&&(this.value=t[a-1])):(this.enabled=!0,void(this.value=t[t.length-1]))}else this._valueBeforeReady++}getValueLabel(e){return this.layers.length===0?null:this._domainInfo.fieldValueMap.get(e)??null}_onLayersChange(){return d(this,null,function*(){if(this._set("state","loading"),this._domainInfo=m([]),this.layers.length!==0)try{yield this._loadLayers(this.layers),this._setup()}catch(e){v(e)||this._set("state","failed")}})}};o([i({value:!1,nonNullable:!0})],s.prototype,"enabled",null),o([i({nonNullable:!0})],s.prototype,"value",null),o([i({readOnly:!0})],s.prototype,"min",null),o([i({readOnly:!0})],s.prototype,"max",null),o([i()],s.prototype,"allowedValues",null),o([i({readOnly:!0})],s.prototype,"hasNext",null),o([i({readOnly:!0})],s.prototype,"hasPrevious",null),o([i({type:c,nonNullable:!0})],s.prototype,"layers",null),o([i({nonNullable:!0})],s.prototype,"state",void 0),o([i()],s.prototype,"_valueBeforeReady",void 0),o([i({readOnly:!0})],s.prototype,"_valueIndex",null),o([i()],s.prototype,"_domainInfo",void 0),s=o([_("esri.widgets.BuildingExplorer.BuildingNumericFilterViewModel")],s);var ae=s;var L="__BUILDING_EXPLORER_FILTER__";function he(){return`${b()}${L}`}function p(e){let t=typeof e=="string"?e:e.id;return!!t&&t.includes(L)}function ce(e,t){for(let l of e.items)for(let n of l.filters.items){if(!p(n))continue;let a=t(n);if(a!=null)return a}return null}function ye(e,t){e.forEach(l=>{let n=l.filters.filter(r=>!p(r));t!=null&&n.push(t),J(l.filters,n)||(l.filters=n);let a=l.filters.find(r=>p(r));l.activeFilterId=a!=null?a.id:null})}function J(e,t){let l=t.length;if(e==null||e.length!==l)return!1;for(let n=0;n<l;++n){let a=t.at(n).toJSON(),r=e.at(n).toJSON();if(a.id="",r.id="",JSON.stringify(a)!==JSON.stringify(r))return!1}return!0}function me(e){let t=R(e);return t?new y({filterExpression:t,filterMode:new N}):null}function pe(e){let t=R(e);return t?new y({filterExpression:t,filterMode:new x}):null}function R(e){return e.filter(t=>!!t).map(t=>`(${t})`).join(" AND ")}export{S as a,U as b,$ as c,M as d,m as e,ae as f,he as g,ce as h,ye as i,me as j,pe as k};
