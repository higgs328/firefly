import{b as Ye}from"./chunk-G7OX7M4Q.js";import"./chunk-ZO3XNOAM.js";import"./chunk-YKYZUPXZ.js";import{a as Je}from"./chunk-3R6TU6NH.js";import"./chunk-I46LG53M.js";import{$a as ke,Aa as ie,Ab as Ce,Bb as he,Da as X,K as R,N as xe,O as te,R as ye,S as y,T as L,X as Re,Ya as Le,cb as Fe,gb as se,kb as ne,l as U,ob as Me,ub as ae,v as Ae,xb as _e,yb as re,zb as M}from"./chunk-A2QQP5DF.js";import"./chunk-LTHAIW3V.js";import{a as ee}from"./chunk-RRQS6PLL.js";import{K as De,k as x}from"./chunk-WFHQTMIY.js";import{a as w}from"./chunk-XAZOVQGA.js";import{$ as fe,Da as Oe,Ea as Se,F as J,G as Ee,Ha as K,Ka as T,N as D,O as I,Q as Y,a as pe,aa as Pe,b as ue,o as ce,oa as Ge,ub as A,v as ge,z as de}from"./chunk-V3KEO7AJ.js";import{d as F,e as W}from"./chunk-QGVBCWUY.js";import{a as ze}from"./chunk-VTHXE323.js";var qe=class{constructor(e,n,i,s,a=100){this.m_startPt=e.clone(),this.m_endPt=n.clone(),this.m_cE2=s,this.m_cE=Math.sqrt(this.m_cE2),this.m_c1By2e=1/(2*this.m_cE),this.m_cRpu=i.getGCS().getUnit().getUnitToBaseFactor(),this.isPcs=i.getCoordinateSystemType()===2,this.PEProjcs=i.getPECoordSys(),this.m_points=Se(2*a,Number.NaN)}setSegmentEndPoints(e,n){this.m_startPt.assign(e),this.m_endPt.assign(n)}makeFunctor(){return e=>{let n=[0,0];n[0]=this.m_startPt.x*(1-e)+this.m_endPt.x*e,n[1]=this.m_startPt.y*(1-e)+this.m_endPt.y*e,this.isPcs&&Ce.projToGeogCenter(this.PEProjcs,1,n,0);let i=Math.sin(n[1]*this.m_cRpu);return this.m_cE2===0?i:-Math.log((1-this.m_cE*i)/(1+this.m_cE*i))*this.m_c1By2e+i/(1-this.m_cE2*i*i)}}};function Qe(p,e,n){let i=new w;p.queryEnvelope(i);let s=De(e,i,!0).total(),a=e.getPannableExtent();a.xmin=i.xmin-10*s,a.xmax=i.xmax+10*s;let t=new xe().execute(p,a,e,n).getImpl().querySegmentIterator();t.stripAttributes();let _=ne();e.querySpheroidData(_);let o=_.e2,m=o===0?2:1,l=new A(0,0),r=new A(0,0),h=new J(0),u=new qe(l,r,e,o,100);for(;t.nextPath();)for(;t.hasNextSegment();){let d=t.nextSegment();l.assign(d.getStartXY()),r.assign(d.getEndXY()),u.setSegmentEndPoints(l,r);let g=U(6,0,1,1e-12,1e-15,u.makeFunctor());h.pe((r.x-l.x)*g)}let c=_.majorSemiAxis;return m*c*c*(1-o)*Math.PI*h.getResult()/e.getPannableExtent().width()}function Ve(p,e,n,i,s){let a=Ke(p,e,s),t=Ue(p,a.first,n,i,s),_=1,o=0,m=0;do{if(_++,a.first*=.5,a.first<50*e.getTolerance(0))return t;a.second*=2,m=Ue(p,a.first,n,i,s),o=Math.abs(m-t),t=m}while(Math.abs(t)>1&&o>1e-8*Math.abs(t)&&(a.second<65e3&&_<8||_<4));return m}function Ue(p,e,n,i,s){let a=new te().execute(p,e,0,0,s),t;t=i?new X().execute(a,i,s):a;let _=n.getUnit().getUnitToBaseFactor()===1?Math.PI/180:1,o=new w;t.queryEnvelope(o);let m=new w,l=new w,r=new w;m.setCoords({xmin:o.xmin,ymin:75*_,xmax:o.xmax,ymax:90*_}),l.setCoords({xmin:o.xmin,ymin:-60*_,xmax:o.xmax,ymax:75*_}),r.setCoords({xmin:o.xmin,ymin:-90*_,xmax:o.xmax,ymax:-60*_}),m.inflateCoords(.01*m.width(),0),l.inflateCoords(.01*l.width(),0),r.inflateCoords(.01*r.width(),0);let h=0;return h+=Te(t,m,n,s),h+=Te(t,l,n,s),h+=Te(t,r,n,s),h}function Te(p,e,n,i){let s=new xe().execute(p,e,n,i);if(s!==null&&!s.isEmpty()){let a=new w;s.queryEnvelope(a);let{first:t,second:_}=We(n,a,!1),o=se(n,t,null),m=new X().execute(s,o,i).calculateArea2D();return _&&t.destroy(),m}return 0}var oe=[null,null,null,null,null,null,null];function Ze(p,e,n){let i=p.getUnit().getUnitToBaseFactor(),s=e.getCenter();s.scale(180*i/Math.PI);let a=new A;a.x=0,a.y=0;let t=0;if(t===0){s.y>45?(a.y=T,t=0):s.y<-45?(a.y=-T,t=1):s.x>=45&&s.x<135?(a.x=T,t=2):s.x>=135||s.x<-135?(a.x=T,t=3):s.x<-45&&s.x>=-135?(a.x=-T,t=4):(a.x=0,t=5);let S=i*Math.sqrt(Pe(e.xmin-e.xmax)+Pe(e.ymin-e.ymax)),f=a.clone(),P=e.getCenter();if(P.scale(i),t<2&&(f.x=P.x),A.distance(f,P)+.5*S>T)return null}let _=oe[t];if(_!==null&&_.getGCS().equalHorizontal(p))return _;let o=p.getText(),m=a.x,l=a.y,r=0,h=0,u=0,c=-1;t!==6?c=M.PE_PRJ_LAMBERT_AZIMUTHAL_EQAREA:(pe(n),u=0,c=M.PE_PRJ_CYLINDRICAL_EQAREA);let d=ae("EqualAreaPCS"),g;c===M.PE_PRJ_LAMBERT_AZIMUTHAL_EQAREA?g=`PROJCS["${d}",${o},PROJECTION["Lambert_Azimuthal_Equal_Area"],PARAMETER["False_Easting",${r}],PARAMETER["False_Northing",${h}],PARAMETER["Central_Meridian",${m}],PARAMETER["Latitude_of_Origin",${l}],UNIT["Meter",1.0]]`:c===M.PE_PRJ_CYLINDRICAL_EQAREA?g=`PROJCS["${d}",${o},PROJECTION["Cylindrical_Equal_Area"],PARAMETER["False_Easting",${r}],PARAMETER["False_Northing",${h}],PARAMETER["Central_Meridian",${m}],PARAMETER["Standard_Parallel_1",${u}],PARAMETER["Latitude_of_Origin",${l}],UNIT["Meter",1.0]]`:ge("getEqualAreaPcsFixed");let E=Me(g);return oe[t]&&oe[t].destroy(),oe[t]=E,E}function We(p,e,n){let i=Ze(p,e,n);if(i!==null)return K(i,!1);let s=p.getText(),a=p.getUnit().getUnitToBaseFactor(),t=(e.xmin+e.width()/2)*a,_=(e.ymin+e.height()/2)*a,o=0,m=0,l=0,r=0,h=-1;e.ymin*a>=75*Math.PI/180||e.ymax*a<=-60*Math.PI/180?h=M.PE_PRJ_LAMBERT_AZIMUTHAL_EQAREA:e.ymin>0||e.ymax<0?(l=(e.ymin+1/3*e.height())*a,r=(e.ymin+2/3*e.height())*a,h=M.PE_PRJ_ALBERS):(l=(e.ymin+2/3*e.height())*a,h=M.PE_PRJ_CYLINDRICAL_EQAREA);let u=ae("EqualAreaPCS"),c;return h===M.PE_PRJ_LAMBERT_AZIMUTHAL_EQAREA?c=`PROJCS["${u}",${s},PROJECTION["Lambert_Azimuthal_Equal_Area"],PARAMETER["False_Easting",${o}],PARAMETER["False_Northing",${m}],PARAMETER["Central_Meridian",${t}],PARAMETER["Latitude_of_Origin",${_}],UNIT["Meter",1.0]]`:h===M.PE_PRJ_ALBERS?c=`PROJCS["${u}",${s},PROJECTION["Albers"],PARAMETER["False_Easting",${o}],PARAMETER["False_Northing",${m}],PARAMETER["Central_Meridian",${t}],PARAMETER["Standard_Parallel_1",${l}],PARAMETER["Standard_Parallel_2",${r}],PARAMETER["Latitude_of_Origin",${_}],UNIT["Meter",1.0]]`:h===M.PE_PRJ_CYLINDRICAL_EQAREA?c=`PROJCS["${u}",${s},PROJECTION["Cylindrical_Equal_Area"],PARAMETER["False_Easting",${o}],PARAMETER["False_Northing",${m}],PARAMETER["Central_Meridian",${t}],PARAMETER["Standard_Parallel_1",${l}],PARAMETER["Latitude_of_Origin",${_}],UNIT["Meter",1.0]]`:ge("getEqualAreaPCSInstance"),K(Me(c),!0)}function Ke(p,e,n){let i=p.calculateLength2D(),s=new Je().execute(p,e,n)/25e3,a=i/p.getSegmentCount()*2,t=Math.min(a,i/s);return t===0&&(t=1),K(t,i/t)}var be=class{getOperatorType(){return 10314}supportsCurves(){return!0}accelerateGeometry(e,n,i){return!1}canAccelerateGeometry(e){return!1}execute(e,n,i){if(n.getCoordinateSystemType()===0&&ce(""),e.isEmpty()||e.getDimension()<2)return 0;if(de(e),e.getGeometryType()===ue.enumEnvelope){let m=new Ae;return m.addEnvelope(e,!1),this.execute(m,n,i)}let s=e;e.getDescription().getAttributeCount()>1&&(s=e.clone(),s.dropAllAttributes());let a=new te().execute(s,0,n.getTolerance(0),0,i),t=null,_=n.getGCS();_!==n&&(t=se(n,_));let o=new ie().execute(a,n,!1,i);return o.isEmpty()?0:(o===e&&(o=e.clone()),n.isPannable()?Qe(o,n,i):Ve(o,n,_,t,i))}};function we(){return{m_p_PCS:new A,m_factor:Number.NaN,setValues:et,assign:tt}}function et(p,e){this.m_factor=p,this.m_p_PCS.assign(e)}function tt(p){this.m_factor=p.m_factor,this.m_p_PCS.assign(p.m_p_PCS)}var Ie=class{constructor(e,n,i,s){this.m_ptStart=new x,this.m_ptEnd=new x,this.m_ptStart.assign(n),this.m_ptEnd.assign(i),this.m_deltaX=this.m_ptEnd.x-this.m_ptStart.x,this.m_deltaY=this.m_ptEnd.y-this.m_ptStart.y,this.m_e=Math.sqrt(e),this.m_e2=e,this.m_c1MinusE2=1-e;let a=Math.sin(s),t;t=this.m_e2===0?2*a:a*(D(this.m_e*a)+1/(1-this.m_e2*a*a)),this.m_baseA=t}setSegmentEndPoints(e,n){this.m_ptStart.assign(e),this.m_ptEnd.assign(n),this.m_deltaX=this.m_ptEnd.x-this.m_ptStart.x,this.m_deltaY=this.m_ptEnd.y-this.m_ptStart.y}makeFunctor(){return e=>{let n=1-e,i=n*this.m_ptStart.x+e*this.m_ptEnd.x,s=n*this.m_ptStart.y+e*this.m_ptEnd.y,a=n*this.m_ptStart.z+e*this.m_ptEnd.z,t=i*i+s*s,_=a/Math.sqrt(a*a+this.m_c1MinusE2*this.m_c1MinusE2*t),o;return this.m_e2===0?o=2*_:o=_*(D(this.m_e*_)+1/(1-this.m_e2*_*_)),(this.m_deltaY*i-this.m_deltaX*s)/t*(o-this.m_baseA)}}};function it(){return{e:Number.NaN,one_p_e:Number.NaN,one_m_e:Number.NaN,one_m_e_2:Number.NaN,atanh_e_over_e:Number.NaN,half_qp:Number.NaN,f:Number.NaN,z:Number.NaN}}function Ne(){return{sin_phi:Number.NaN,one_p_sin_phi:Number.NaN,one_m_sin_phi:Number.NaN,one_m_e_2_sin_2_phi:Number.NaN,sin_half_phi_pf:Number.NaN,sin_half_phi_pz:Number.NaN,sin_half_asin_e_sin_phi_pf:Number.NaN,sin_half_asin_e_sin_phi_pz:Number.NaN,atanh_sin_phi:Number.NaN,atanh_esin_phi:Number.NaN,make_negative:!1,initialize:st,changeSign:nt,assign:at,clone:_t}}function st(p,e,n,i){let s=.5*p;this.sin_phi=Math.sin(p);let a=e*this.sin_phi,t=.5*Math.asin(a);this.one_p_sin_phi=1+this.sin_phi,this.one_m_sin_phi=1-this.sin_phi,this.one_m_e_2_sin_2_phi=(1+a)*(1-a),this.sin_half_phi_pf=Math.sin(s+n),this.sin_half_phi_pz=Math.sin(s+i),this.sin_half_asin_e_sin_phi_pf=Math.sin(t+n),this.sin_half_asin_e_sin_phi_pz=Math.sin(t+i),this.atanh_sin_phi=Math.log(this.sin_half_phi_pf/this.sin_half_phi_pz),this.atanh_esin_phi=Math.log(this.sin_half_asin_e_sin_phi_pf/this.sin_half_asin_e_sin_phi_pz)}function nt(){this.sin_phi=-this.sin_phi;let p=this.one_p_sin_phi;this.one_p_sin_phi=this.one_m_sin_phi,this.one_m_sin_phi=p,p=this.sin_half_phi_pf,this.sin_half_phi_pf=this.sin_half_phi_pz,this.sin_half_phi_pz=p,p=this.sin_half_asin_e_sin_phi_pf,this.sin_half_asin_e_sin_phi_pf=this.sin_half_asin_e_sin_phi_pz,this.sin_half_asin_e_sin_phi_pz=p,this.atanh_sin_phi=-this.atanh_sin_phi,this.atanh_esin_phi=-this.atanh_esin_phi}function at(p){this.sin_phi=p.sin_phi,this.one_p_sin_phi=p.one_p_sin_phi,this.one_m_sin_phi=p.one_m_sin_phi,this.one_m_e_2_sin_2_phi=p.one_m_e_2_sin_2_phi,this.sin_half_phi_pf=p.sin_half_phi_pf,this.sin_half_phi_pz=p.sin_half_phi_pz,this.sin_half_asin_e_sin_phi_pf=p.sin_half_asin_e_sin_phi_pf,this.sin_half_asin_e_sin_phi_pz=p.sin_half_asin_e_sin_phi_pz,this.atanh_sin_phi=p.atanh_sin_phi,this.atanh_esin_phi=p.atanh_esin_phi,this.make_negative=p.make_negative}function _t(){return ze({},this)}var ve=class{constructor(e,n,i){this.m_transformPCS2GCS=null,this.m_scaleToRadians=new ee,this.m_scaleToDegrees=new ee,this.m_progressTracker=i,pe(n!==4),this.m_curveType=n,this.m_inputSR=e,e&&e.getCoordinateSystemType()!==0||ce(""),this.m_inputGCS=e.getGCS(),this.m_a=0,this.m_eSquared=0,this.m_b=0,this.m_rpu=0}executePolygonGeodeticArea(e){let n,i=e.clone();if(i.dropAllAttributes(),e.hasNonLinearSegments()&&(i=new te().execute(i,0,this.m_inputSR.getTolerance(0),0,this.m_progressTracker)),this.m_inputSR.isPannable()){let t=new w;i.queryEnvelope(t);let _=this.m_inputSR.getPannableExtent();if(!_.containsEnvelope(t)){let o=_.getCenterX()-t.getCenterX(),m=new ee;m.setShiftCoords(o,0),i.applyTransformation(m),t.move(o,0);let l=new Ee;_.queryIntervalX(l);let r=new Ee;t.queryIntervalX(r),i=l.contains(r)?Le(i,this.m_inputSR):new X().foldInto360RangeGeodetic(i,this.m_inputSR,this.m_curveType)}}if(this.m_transformPCS2GCS?(i=new ie().execute(i,this.m_inputSR,!1,this.m_progressTracker),n=i.createInstance(),Fe(this.m_transformPCS2GCS,i,n,this.m_progressTracker)||(n=new X().execute(i,this.m_transformPCS2GCS,this.m_progressTracker))):n=new ie().execute(i,this.m_inputGCS,!1,this.m_progressTracker),n.isEmpty())return 0;if(this.m_curveType===1){let t=ne();return this.m_inputGCS.querySpheroidData(t),this.m_a=t.majorSemiAxis,this.m_eSquared=t.e2,this.loxodromeArea(n)}let s=n.getImpl();this.m_rpu=this.m_inputGCS.getUnit().getUnitToBaseFactor(),this.m_scaleToRadians.setScale(this.m_rpu),s.applyTransformation(this.m_scaleToRadians),this.m_scaleToDegrees=this.m_scaleToRadians,this.m_scaleToDegrees.invertThis();let a=ne();if(this.m_inputGCS.querySpheroidData(a),this.m_a=a.majorSemiAxis,this.m_b=a.minorSemiAxis,this.m_eSquared=a.e2,this.m_curveType===2)return this.executeClippedPolygonGreatEllipticArea(n);{let t={stack:[],error:void 0,hasError:!1};try{let _=re.unit(9101),o=this.m_inputGCS.getPECoordSys(),m=F(t,o.cloneAlterUnits(_),!1),l,r,h=this.executeClippedPolygonGeodeticArea(n,m,0),u=0;do u++,l=this.executeClippedPolygonGeodeticArea(n,m,u),r=Math.abs(l-h),h=l;while(Math.abs(l)>1&&r>1e-8*Math.abs(l)&&u<7);return l}catch(_){t.error=_,t.hasError=!0}finally{W(t)}}}executeClippedPolygonGeodeticArea(e,n,i){let s={stack:[],error:void 0,hasError:!1};try{let a=new w;e.queryEnvelope(a);let t=F(s,this.getEqualAreaPCSInstance(n,a),!1),_=e.clone();ke(t,_);let o=50,m=_.getImpl().getAttributeStreamRef(0),l=e.getImpl().getAttributeStreamRef(0),r=F(s,new _e,!1),h=F(s,new _e,!1),u=40,c=[0,0],d=Oe(we,u),g=Se(u,-1),E=we(),S=we(),f,P,v=t,N=_.calculateArea2D(),q=new J(0),G=.5*Math.PI,B=1e-10*Math.abs(N)+1e-6,me=e.getPathCount(),O,k,$,b,C=new A,z=new A,H=new A,j=new A,Q=new A,V=new A,$e,le;for(k=e.getPathStart(0),O=0;O<me;O++,k=$)for($=e.getPathEnd(O),m.queryPoint2D($-1<<1,H),l.queryPoint2D($-1<<1,C),Math.abs(C.y)>G&&(C.y=Y(G,C.y)),b=k;b<$;b++,H.assign(j),C.assign(z)){if(m.queryPoint2D(b<<1,j),l.queryPoint2D(b<<1,z),Math.abs(z.y)>G&&(z.y=Y(G,z.y)),$e=A.distance(H,j),$e<o||C.y===0&&z.y===0)continue;he.geodeticDistance(this.m_a,this.m_eSquared,C.x,C.y,z.x,z.y,r,h,null,this.m_curveType);let Be=r.val,He=h.val;for(E.setValues(0,H),S.setValues(1,j),P=i,d[0].assign(S),g[0]=i,f=0;f>=0;){le=.5*(E.m_factor+S.m_factor),he.geodeticCoordinate(this.m_a,this.m_eSquared,C.x,C.y,Be*le,He,r,h,this.m_curveType),Q.x=r.val,Q.y=h.val,c[0]=Q.x,c[1]=Q.y,Ce.geogToProj(v,1,c),V.x=c[0],V.y=c[1];let je=-V.offset(E.m_p_PCS,S.m_p_PCS),Z=.5*je*A.distance(E.m_p_PCS,S.m_p_PCS);if(q.pe(Z),Math.abs(Z)>B||Math.abs(Z)>0&&P>0)S.setValues(le,V),f++,d[f].assign(S),Math.abs(Z)<=B?(P--,g[f-1]=P,g[f]=P):(P=g[f-1],g[f]=P);else{if(f<=0)break;E.assign(S),f--,S.assign(d[f]),P=g[f]}}}return N+=q.getResult(),Math.abs(N)}catch(a){s.error=a,s.hasError=!0}finally{W(s)}}executeClippedPolygonGreatEllipticArea(e){let n=[],i=[],s=new A,a=new A,t=y(1,this.m_eSquared,new A(0,.5*Math.PI)),_=new J(0),o=new J(0),m=new J(0),l=new x,r=new x,h=new w;e.queryLooseEnvelope(h);let u=0;h.containsCoords(h.xmin,0)||(u=Math.abs(h.ymin)<Math.abs(h.ymax)?h.ymin:h.ymax);let c=new Ie(this.m_eSquared,l,r,u),d=this.m_a*this.m_a,g=e.getImpl().querySegmentIterator();for(g.stripAttributes();g.nextPath();)for(;g.hasNextSegment();){let E=g.nextSegment();s.assign(E.getStartXY()),a.assign(E.getEndXY()),a.x-s.x>Math.PI?s.x+=2*Math.PI:a.x-s.x<-Math.PI&&(a.x+=2*Math.PI),this.splitSegmentCrossingItegralThreshold(E,n,i);for(let S of n)l.assign(y(this.m_a,this.m_eSquared,S.getStartXY())),r.assign(y(this.m_a,this.m_eSquared,S.getEndXY())),c.setSegmentEndPoints(l,r),this.adaptiveIntegrationWithRomberg(c,_);for(let S of i){let f=S.getStartXY(),P=S.getEndXY(),v=u;f.y<0&&(P=Ge(f,f=P),f.y=-f.y,P.y=-P.y,v=-v);let N=y(1,this.m_eSquared,f),q=y(1,this.m_eSquared,P),G=Math.min(f.y,P.y),B=Re(this.m_eSquared,f.x,P.x,v,G);o.pe(B);let me=Math.abs(Re(this.m_eSquared,f.x,P.x,G,T)),O=new x;O.setSub(N,t);let k=new x;k.setSub(q,t);let $=new x;$.setCrossProductVector(O,k);let b=d*(me-.5*$.length());b=Y(b,P.x-f.x),m.pe(b)}n.length=0,i.length=0}return m.getResult()+d*(.5*(1-this.m_eSquared)*_.getResult()+o.getResult())}getEqualAreaPCSInstance(e,n){let i=n.getCenterX(),s=0,a=0,t,_,o=n.height(),m,l;(m=n.ymin>45*Math.PI/180||n.ymax<45*-Math.PI/180)?t=Y(.5*Math.PI,n.getCenterY()):(t=n.getCenterY(),_=n.ymin+o*(2/3));let r=ae("EqualAreaPCS"),h=e.toString();return l=m?re.fromString(M.PE_TYPE_PROJCS,`PROJCS["${r}", ${h}, PROJECTION["Lambert_Azimuthal_Equal_Area"],PARAMETER["False_Easting",${s}],PARAMETER["False_Northing", ${a}],PARAMETER["Central_Meridian", ${i}], PARAMETER["Latitude_of_Origin", ${t}], UNIT["Meter",1.0]]`):re.fromString(M.PE_TYPE_PROJCS,`PROJCS["${r}", ${h}, PROJECTION["Cylindrical_Equal_Area"],PARAMETER["False_Easting", ${s}],PARAMETER["False_Northing", ${a}],PARAMETER["Central_Meridian", ${i}],PARAMETER["Standard_Parallel_1", ${_}],PARAMETER["Latitude_of_Origin", ${t}],UNIT["Meter",1.0]]`),l}splitSegmentCrossingItegralThreshold(e,n,i){let _=y(this.m_a,this.m_eSquared,new A(0,T)),o=y(this.m_a,this.m_eSquared,new A(0,-T)),m=this.splitSegmentPassingThroughPole(e);for(let l of m){let r=l.getStartXY(),h=l.getEndXY(),u=y(this.m_a,this.m_eSquared,r),c=y(this.m_a,this.m_eSquared,h),d=new A,g=new x,E=x.sqrDistance(_,u),S=x.sqrDistance(u,c);if(E<=100){if(!(S>400)){i.push(new R({start:r,end:h}));continue}g.assign(c.sub(u)),g.normalizeThis(),g.assign(u.add(g.mul(20))),d.assign(L(this.m_a,this.m_eSquared,g)),i.push(new R({start:r,end:d})),r.assign(d)}if(u.assign(y(this.m_a,this.m_eSquared,r)),E=x.sqrDistance(_,c),S=x.sqrDistance(u,c),E<=100){if(!(S>400)){i.push(new R({start:r,end:h}));continue}g.assign(c.sub(u)),g.normalizeThis(),g.assign(c.sub(g.mul(20))),d.assign(L(this.m_a,this.m_eSquared,g)),i.push(new R({start:d,end:h})),h.assign(d)}if(u.assign(y(this.m_a,this.m_eSquared,r)),c.assign(y(this.m_a,this.m_eSquared,h)),E=x.sqrDistance(o,u),S=x.sqrDistance(u,c),E<=100){if(!(S>400)){i.push(new R({start:r,end:h}));continue}g.assign(c.sub(u)),g.normalizeThis(),g.assign(u.add(g.mul(20))),d.assign(L(this.m_a,this.m_eSquared,g)),i.push(new R({start:r,end:d})),r.assign(d)}if(u.assign(y(this.m_a,this.m_eSquared,r)),c.assign(y(this.m_a,this.m_eSquared,h)),E=x.sqrDistance(o,c),S=x.sqrDistance(u,c),E<=100){if(!(S>400)){i.push(new R({start:r,end:h}));continue}g.assign(c.sub(u)),g.normalizeThis(),g.assign(c.sub(g.mul(20))),d.assign(L(this.m_a,this.m_eSquared,g)),i.push(new R({start:d,end:h})),h.assign(d)}n.push(new R({start:r,end:h}))}}splitSegmentPassingThroughPole(e){let n={stack:[],error:void 0,hasError:!1};try{let i=[],s=new x,a=new x,t=new x,_=new A,o=20,m=3.124139361,l=10,r=e.getStartXY(),h=e.getEndXY(),u=F(n,new _e,!1);if(he.geodeticDistance(this.m_a,this.m_eSquared,r.x,r.y,h.x,h.y,u,null,null,2),Math.abs(h.x-r.x)>m&&u.val>o){let c=new Ye(new A(0,90),r.divide(this.m_rpu),h.divide(this.m_rpu),this.m_inputGCS,2,2),d=ye(c.makeFunctor(),0,1,1e-10);if(d.second<=l&&d.first>0&&d.first<1)return s.assign(y(this.m_a,this.m_eSquared,r)),a.assign(y(this.m_a,this.m_eSquared,h)),fe(s,a,d.first,t),_.assign(L(this.m_a,this.m_eSquared,t)),i.push(new R({start:r,end:_})),i.push(new R({start:_,end:h})),i;if(c.setPointDistFrom(new A(0,-90)),d=ye(c.makeFunctor(),0,1,1e-10),d.second<=l&&d.first>0&&d.first<1)return s.assign(y(this.m_a,this.m_eSquared,r)),a.assign(y(this.m_a,this.m_eSquared,h)),fe(s,a,d.first,t),_.assign(L(this.m_a,this.m_eSquared,t)),i.push(new R({start:r,end:_})),i.push(new R({start:_,end:h})),i}return i.push(new R({start:r,end:h})),i}catch(i){n.error=i,n.hasError=!0}finally{W(n)}}adaptiveIntegrationWithRomberg(e,n){let i=e.makeFunctor(),s=0,a=1,t=i(s),_=i(a),o=1e-17,m=1e-14,l=(s+a)/2,r=i(l),h=Math.abs(r-t),u=Math.abs(_-r),c=0;for(;c++<32&&(h/u<.1||u/h<.1);)h<u?(n.pe(U(5,s,l,m,o,i)),s=l,t=r):(n.pe(U(5,l,a,m,o,i)),a=l,_=r),l=(s+a)/2,r=Math.abs(i(l)),h=Math.abs(r-t),u=Math.abs(_-r);n.pe(U(5,s,a,m,o,i))}loxodromeAreaHemi(e,n,i,s,a){let t=i.clone(),_=a.clone(),o,m,l,r,h,u,c,d,g,E,S,f,P,v,N,q;return t.make_negative&&t.changeSign(),_.make_negative&&_.changeSign(),S=s-n,Math.abs(t.sin_phi)===1||Math.abs(_.sin_phi)===1?e.half_qp*S:t.sin_phi===_.sin_phi?(E=.5*e.one_m_e_2*t.sin_phi*(1/t.one_m_e_2_sin_2_phi+D(e.e*t.sin_phi))*S,E):(N=Math.log(_.sin_half_phi_pf*t.sin_half_phi_pz/(_.sin_half_phi_pz*t.sin_half_phi_pf)),q=Math.log(_.sin_half_asin_e_sin_phi_pf*t.sin_half_asin_e_sin_phi_pz/(_.sin_half_asin_e_sin_phi_pz*t.sin_half_asin_e_sin_phi_pf)),this.m_eSquared===1?(h=0,o=.5*(N+_.sin_phi/_.one_m_e_2_sin_2_phi-t.sin_phi/t.one_m_e_2_sin_2_phi),m=0):(h=-2*e.atanh_e_over_e*(Math.log(_.one_p_sin_phi/t.one_p_sin_phi)-e.e*q),o=(N-e.e*q)/e.one_m_e_2,m=(Math.log(_.one_m_e_2_sin_2_phi/t.one_m_e_2_sin_2_phi)+h/e.atanh_e_over_e)/e.one_m_e_2),l=-q*(t.atanh_esin_phi+_.atanh_esin_phi),r=1/t.one_m_e_2_sin_2_phi-1/_.one_m_e_2_sin_2_phi,u=I(_.one_m_sin_phi/e.one_p_e,e.e)-I(t.one_m_sin_phi/e.one_p_e,e.e),c=I(_.one_p_sin_phi/e.one_p_e,e.e)-I(t.one_p_sin_phi/e.one_p_e,e.e),d=I(t.one_m_sin_phi/-e.one_m_e,e.e)-I(_.one_m_sin_phi/-e.one_m_e,e.e),g=I(t.one_p_sin_phi/-e.one_m_e,e.e)-I(_.one_p_sin_phi/-e.one_m_e,e.e),E=.25/o*(m+l+r+h+.5*(u+c+d+g)),E+=e.half_qp,f=.5*e.one_m_e_2*t.sin_phi*(1/t.one_m_e_2_sin_2_phi+D(e.e*t.sin_phi)),P=.5*e.one_m_e_2*_.sin_phi*(1/_.one_m_e_2_sin_2_phi+D(e.e*_.sin_phi)),P<f&&(v=f,f=P,P=v),E<f&&(E=f),E>P&&(E=P),E*=S,E)}loxodromeArea(e){let n=Math.PI/180,i=0,s=it(),a=Ne(),t=Ne();s.e=Math.sqrt(this.m_eSquared),s.one_p_e=1+s.e,s.one_m_e=1-s.e,s.one_m_e_2=1-this.m_eSquared,s.atanh_e_over_e=D(s.e),this.m_eSquared>=1?s.half_qp=1:s.half_qp=.5*(1+s.atanh_e_over_e*s.one_m_e_2),s.f=.25*Math.PI,s.z=.75*Math.PI,t.initialize(0,s.e,s.f,s.z);let _=e.getPathCount(),o=new A,m=new A,l=e.getImpl().getAttributeStreamRef(0);for(let r=0;r<_;r++){let h=e.getPathStart(r),u=e.getPathEnd(r);if(!(u-h<=1)){l.queryPoint2D(2*(u-1),o);for(let c=h;c<u;c++){l.queryPoint2D(2*c,m);let d=o.y*n,g=m.y*n;if(c===h?(a.initialize(d,s.e,s.f,s.z),a.make_negative=!1):a.assign(t),t.initialize(g,s.e,s.f,s.z),t.make_negative=!1,o.y*m.y<0){if(o.y>=90&&m.y<=-90||m.y>=90&&o.y<=-90)return Number.NaN;let E=Ne();E.initialize(0,s.e,s.f,s.z),E.make_negative=!1;let S=a.atanh_sin_phi-s.e*a.atanh_esin_phi,f=t.atanh_sin_phi-s.e*t.atanh_esin_phi,P=(f*o.x-S*m.x)/(f-S);d<0?(a.make_negative=!0,i-=this.loxodromeAreaHemi(s,o.x*n,a,P*n,E),a.make_negative=!1,i+=this.loxodromeAreaHemi(s,P*n,E,m.x*n,t)):(i+=this.loxodromeAreaHemi(s,o.x*n,a,P*n,E),t.make_negative=!0,i-=this.loxodromeAreaHemi(s,P*n,E,m.x*n,t),t.make_negative=!1)}else o.y>=0?i+=this.loxodromeAreaHemi(s,o.x*n,a,m.x*n,t):(a.make_negative=!0,t.make_negative=!0,i-=this.loxodromeAreaHemi(s,o.x*n,a,m.x*n,t),a.make_negative=!1,t.make_negative=!1);o.assign(m)}}}return this.m_a*i*this.m_a}calculate(e){if(e.isEmpty()||e.getDimension()<2)return 0;if(e.getGeometryType()===ue.enumEnvelope){let n=new Ae;return n.addEnvelope(e,!1),this.calculate(n)}return this.m_inputSR!==this.m_inputGCS&&this.m_transformPCS2GCS===null&&(this.m_transformPCS2GCS=se(this.m_inputSR,this.m_inputGCS,null)),this.executePolygonGeodeticArea(e)}},Xe=class{getOperatorType(){return 10311}supportsCurves(){return!0}accelerateGeometry(e,n,i){return!1}canAccelerateGeometry(e){return!1}execute(e,n,i,s){return de(e),i===4?new be().execute(e,n,s):new ve(n,i,s).calculate(e)}};export{Xe as OperatorGeodeticArea};
