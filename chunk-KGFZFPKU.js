import{a as _}from"./chunk-JQAW4OB5.js";import{a as y}from"./chunk-T7DXJKX7.js";import{a as s}from"./chunk-QGVBCWUY.js";import{e as i}from"./chunk-NFIPKH6V.js";import{l as m}from"./chunk-5QEXLALV.js";import{L as c,t as l}from"./chunk-4PTIEWMT.js";import{b as d}from"./chunk-YOFFGXOB.js";import{a as p,b as h,f as o}from"./chunk-VTHXE323.js";var e=class extends y.EventedAccessor{constructor(t){super(t),this._indexHistory=[],this._lastStepIndex=-1,this._stepIndex=-1,this._updatingHandles=new _,this._handleKeys={afterCommit:"after-commit",beforeCommit:"before-commit"},this.data=void 0,this.started=!1,this.steps=[],this.type=null,this._pendingOperation=null}destroy(){this._updatingHandles.destroy()}get hasNextStep(){let{steps:t}=this;return!!(t&&this._stepIndex<t.filter(n=>!n.parent).length-1)}get hasPreviousStep(){return this._stepIndex>0}get reliesOnOwnerAdminPrivileges(){return!1}get hasInvalidFormTemplate(){return!1}get shouldShowAttachments(){return!1}get shouldAllowAttachmentEditing(){return!1}get stepId(){let{steps:t}=this,n=t&&t[this._stepIndex];return n&&n.id}get helpMessage(){}get hasPendingEdits(){return!1}get keyboardCancellationEnabled(){return!0}get updating(){return this._updatingHandles.updating}back(t=()=>Promise.resolve(!0)){return o(this,null,function*(){this.hasPendingEdits&&!(yield t())||(this.hasPreviousStep?yield this.previous({cancelCurrentStep:!0}):yield this.cancel({force:!0}))})}cancel(){return o(this,arguments,function*(t={force:!0}){return t.force!==!1?this._cancel(t):new Promise((n,a)=>{this.emit("cancel-request",{controller:{allow:()=>{this._cancel(h(p({},t),{force:!0})).then(n)},deny:()=>a(new d("workflow:cancel-denied","Request to cancel workflow was denied."))}})})})}commit(){return o(this,null,function*(){this.removeHandles(this._handleKeys.beforeCommit),this.onCommit&&(yield this.onCommit(this.data)),this.removeHandles(this._handleKeys.afterCommit),this.emit("commit")})}go(t){return o(this,null,function*(){let{steps:n}=this,a=n.findIndex(r=>r.id===t);this._indexHistory.push(this._stepIndex),yield this._go(a)})}next(){return o(this,null,function*(){this._indexHistory.push(this._stepIndex),yield this._go(this._stepIndex+1)})}previous(){return o(this,arguments,function*(t={cancelCurrentStep:!1}){yield this._go(this._indexHistory.pop(),t.cancelCurrentStep)})}reset(){return o(this,null,function*(){yield this._cancel({emitCancelEvent:!1}),yield this.start()})}save(){return o(this,null,function*(){yield this.commit(),yield this.reset()})}start(){return o(this,null,function*(){this._set("started",!0);let t=this._stepIndex===-1?0:this._stepIndex;yield this._go(t)})}_cancel(){return o(this,arguments,function*({emitCancelEvent:t=!0,error:n}={}){this.started&&(this._set("started",!1),yield this._transaction(()=>this.steps[this._stepIndex]?.tearDown({canceled:!0}))),this.removeHandles([this._handleKeys.afterCommit,this._handleKeys.beforeCommit]),this._resetIndexing(t),t&&this.emit("cancel",{error:n})})}_go(t=-1,n=!1){return this._transaction(()=>o(this,null,function*(){let{steps:a}=this;if(!(t<=-1||t>=a.length)){if(!this.started)return this._stepIndex=t,void this._notifyStepProps();this._lastStepIndex>-1&&(yield a[this._lastStepIndex].tearDown({canceled:n}));try{yield a[t].setUp()}catch(r){l(r)}this._lastStepIndex=t,this._stepIndex=t,this._notifyStepProps()}}))}_transaction(t){return o(this,null,function*(){let n=this._pendingOperation,a=c(),r=(n??Promise.resolve()).then(()=>a.promise);this._pendingOperation=r,this._updatingHandles.addPromise(r);try{n&&(yield n),yield t()}finally{a.resolve(),r===this._pendingOperation&&(this._pendingOperation=null)}})}_resetIndexing(t=!0){this._stepIndex=-1,this._lastStepIndex=-1,this._indexHistory.length=0,t&&this._notifyStepProps()}_notifyStepProps(){this.notifyChange("stepId"),this.notifyChange("hasPreviousStep"),this.notifyChange("hasNextStep")}};s([i()],e.prototype,"data",void 0),s([i()],e.prototype,"hasNextStep",null),s([i()],e.prototype,"hasPreviousStep",null),s([i()],e.prototype,"onCommit",void 0),s([i()],e.prototype,"reliesOnOwnerAdminPrivileges",null),s([i()],e.prototype,"hasInvalidFormTemplate",null),s([i()],e.prototype,"shouldShowAttachments",null),s([i()],e.prototype,"shouldAllowAttachmentEditing",null),s([i()],e.prototype,"started",void 0),s([i({readOnly:!0})],e.prototype,"stepId",null),s([i()],e.prototype,"steps",void 0),s([i({readOnly:!0})],e.prototype,"type",void 0),s([i()],e.prototype,"helpMessage",null),s([i()],e.prototype,"hasPendingEdits",null),s([i()],e.prototype,"keyboardCancellationEnabled",null),s([i()],e.prototype,"updating",null),e=s([m("esri.widgets.Editor.Workflow")],e);var H=e;export{H as a};
