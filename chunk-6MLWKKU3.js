import{a as Oa}from"./chunk-SCX5V5ZM.js";import{c as Q,e as Ia}from"./chunk-DFZB6AM2.js";import{a as y,d as N,l as d}from"./chunk-RGD6ZU25.js";import{a as F,b as ba,c as Da,g as Pa,j as z,k as K,l as Ra}from"./chunk-XGBN53IG.js";import{b as u}from"./chunk-62UTK67Z.js";import{a as J}from"./chunk-SLOUGIU5.js";import{l as Ea}from"./chunk-Z7TBAZRW.js";import{j as Ta,k as ya,l as xa,o as Sa,p as Aa}from"./chunk-QXSQOLB3.js";import{j as b}from"./chunk-J5AEP4US.js";import{b as j,d as g}from"./chunk-4NUW747S.js";import{a as W}from"./chunk-ONYJLWAD.js";import{j as wa}from"./chunk-ZM24RY22.js";import{a as Y}from"./chunk-6F25LG6O.js";import{a as X}from"./chunk-ALWV3RJ2.js";import{H as va,c as L,e as fa,n as Ma,u as sa,v as ga,w as na}from"./chunk-6B5XFA6F.js";import{g as V,h as da,k as ha,n as ra,o as Z,p as ma,s as _a}from"./chunk-ZTOZWLEE.js";import{a as q,c as f}from"./chunk-BOVYXYHK.js";import{b as ua}from"./chunk-EQZWYK27.js";import{a as O,b as ca,j as B}from"./chunk-TG45K3WR.js";import{a as G}from"./chunk-T7DXJKX7.js";import{d as R}from"./chunk-BWO7LS2H.js";import{b as k,d as pa}from"./chunk-4PTIEWMT.js";import{a as I,d as H}from"./chunk-TG2UTNEO.js";import{a as la}from"./chunk-QBWJMFH5.js";import{a as T,b as P}from"./chunk-VTHXE323.js";var h;(function(l){l[l.TRANSLATE_Z=0]="TRANSLATE_Z",l[l.TRANSLATE_XY=1]="TRANSLATE_XY",l[l.SCALE=2]="SCALE",l[l.ROTATE=3]="ROTATE",l[l.SCALE_ROTATE=4]="SCALE_ROTATE"})(h||(h={}));var La=Math.ceil(46.666666666666664),Xa=160,Ba=.5,qa=24,Va=9,Wa=Xa+30,Ja=Xa+53,Ka=60,Qa=23,$a=5*Math.PI/12,at=1*Math.PI/3,tt=10,et=.2,it=30,rt=53,st=.2,nt=.3,ot=200,lt=3,pt=1e6;function C(l,a,t){let e=(i,r)=>{a({action:i,object:l,dxScreen:r.screenDeltaX,dyScreen:r.screenDeltaY})};return t((i,r,n)=>(r.next(s=>(s.action==="start"&&e("start",s),s)).next(Da(l)).next(s=>{switch(s.action){case"start":case"update":(s.translationX||s.translationY||s.translationZ)&&e("update",s);break;case"end":e("end",s)}return s}),{steps:r,cancel:n=n.next(Pa(l)).next(s=>(e("end",{screenDeltaX:0,screenDeltaY:0}),s))}))}function dt(l){if(l?.axis==null)return 1;let{mapStart:a,mapEnd:t,axis:e}=l,i=[t.x-a.x,t.y-a.y];return i[0]*e[0]+i[1]*e[1]>0?1:-1}var v=class{constructor(){this._available=!0}set location(a){this._forEachManipulator3D(t=>t.location=a)}set elevationAlignedLocation(a){this._forEachManipulator3D(t=>t.elevationAlignedLocation=a)}set elevationInfo(a){this._forEachManipulator3D(t=>t.elevationInfo=a)}get renderLocation(){let a;return this._forEachManipulator3D(t=>{a||(a=t.renderLocation)}),a}set renderLocation(a){this._forEachManipulator3D(t=>t.renderLocation=a)}get available(){return this._available}set available(a){this._available=a,this._forEachManipulator3D(t=>t.available=a)}get hovering(){return this.someManipulator(a=>a.hovering)}get grabbing(){return this.someManipulator(a=>a.grabbing)}get dragging(){return this.someManipulator(a=>a.dragging)}get selected(){return this.someManipulator(a=>a.selected)}hasManipulator(a){return this.someManipulator(t=>t===a)}someManipulator(a){let t=!1;return this.forEachManipulator(e=>{!t&&a(e)&&(t=!0)}),t}_forEachManipulator3D(a){this.forEachManipulator((t,e)=>{t instanceof y&&a(t,e)})}};var $=class extends v{constructor(){super(...arguments),this._interactive=!0}get interactive(){return this._interactive}set interactive(a){this._interactive!==a&&(this._interactive=a),this._updateManipulatorInteractivity()}_updateManipulatorInteractivity(){let a=!this.grabbing&&this._interactive;this.forEachManipulator(t=>{t.interactive=a||t.grabbing})}};var aa=class extends v{constructor(a){super(),this._handles=new R,this._arrowManipulatorInfos=new Array,this._angle=0,this._scale=1,this._radius=70,this._updateAfterDrag=!1,this.events=new G,this._tool=a.tool,this._view=a.view,this._opaqueMaterial=this._createMaterial(),this._transparentMaterial=this._createMaterial(.5),a.radius!=null&&(this._radius=a.radius),this._createManipulators(),this.forEachManipulator(t=>this._tool.manipulators.add(t))}set orthogonalAvailable(a){this._arrowManipulatorInfos.length>=3&&(this._arrowManipulatorInfos[1].manipulator.available=a,this._arrowManipulatorInfos[3].manipulator.available=a)}destroy(){this._handles=k(this._handles),this.forEachManipulator(a=>{this._tool.manipulators.remove(a),a.destroy()}),this._tool=null,this._view=null,this._arrowManipulatorInfos.length=0}forEachManipulator(a){for(let{manipulator:t}of this._arrowManipulatorInfos)a(t,h.TRANSLATE_XY)}createManipulatedObjectDragPipeline(a,t,e){if(!t.operations)return I();let i=t.operations.data.spatialReference,r=t.graphic;return C(t,e,n=>this.createDragPipeline((s,o,p,c,m)=>({steps:o,cancel:p}=a(s,o,p,c,m),n(s,o,p)),t.elevationInfo,i,r))}createDragPipeline(a,t,e,i){return H(this._arrowManipulatorInfos.map(({manipulator:r},n)=>F(r,(s,o,p,c,m)=>{let _=o.next(w=>P(T({},w),{manipulatorType:h.TRANSLATE_XY})).next(K(this._view,s.elevationAlignedLocation)).next(Q(this._view,s.elevationAlignedLocation,t,e,i)).next(ba(s.location,this.angle+(n+1)*Math.PI*.5)).next(z());a(s,_,p,c,m)})))}get angle(){return this._angle}set angle(a){this._angle=a,this.dragging?this._updateAfterDrag=!0:this._updateManipulatorTransform()}get displayScale(){return this._scale}set displayScale(a){this._scale=a,this._updateManipulatorTransform()}get radius(){return this._radius}set radius(a){this._radius!==a&&(this._radius=a,this._updateManipulators())}_updateManipulators(){for(let a=0;a<this._arrowManipulatorInfos.length;a++)this._updateArrowManipulator(this._arrowManipulatorInfos[a],a);this._updateManipulatorTransform()}_updateArrowManipulator({manipulator:a,transform:t},e){let i=this._radius/70,r=54*i,n=r*Math.sqrt(3)/2,s=Sa(this._opaqueMaterial,n,r/2,r/2,.02);Aa(s,ra(g.get(),L(j.get(),0,-n/3,0))),a.renderObjects=[new d(s,u.Focused),new d(s.instantiate({material:this._transparentMaterial}),u.Unfocused)],a.radius=n/3*2*1.2;let o=_a(g.get(),e*Math.PI/2),p=ra(g.get(),L(j.get(),0,100*i,0));V(t,o,p)}_createManipulators(){for(let a=0;a<4;a++){let t=this._createArrowManipulator(a);this._arrowManipulatorInfos.push(t)}this._updateManipulatorTransform()}_updateManipulatorTransform(){let a=this.angle,t=ma(g.get(),a,f(0,0,1));if(t==null)return;let e=Z(g.get(),L(j.get(),this.displayScale,this.displayScale,this.displayScale)),i=V(g.get(),e,t);for(let r of this._arrowManipulatorInfos){let n=V(g.get(),i,r.transform);r.manipulator.modelTransform=n}}_createArrowManipulator(a){let t=new y({view:this._view,autoScaleRenderObjects:!1,worldOriented:!0,focusMultiplier:1,touchMultiplier:1,collisionType:{type:"disc",direction:f(0,0,1)}}),e={manipulator:t,transform:X()};return this._updateArrowManipulator(e,a),this._handles.add(t.events.on("drag",i=>{this._updateAfterDrag&&i.action==="end"&&!this.dragging&&(this._updateManipulatorTransform(),this._updateAfterDrag=!1)})),e}_createMaterial(a=1){let t=new J({cullFace:W.Back,renderOccluded:b.Transparent,isDecoration:!0});return this._handles.add(O(()=>Y.toUnitRGBA(this._view.effectiveTheme.accentColor),e=>{e[3]*=a,t.setParameters({color:e})},B)),t}get test(){}};var ta=class{constructor(){this._view=null,this._elevationInfo=null,this._lastDragEvent=null,this._next=null,this._enabled=!1}get enabled(){return this._enabled}set enabled(a){if(this._enabled!==a&&this._lastDragEvent!=null&&this._next!=null){let t=this._lastDragEvent.mapEnd,e=this._snap(this._lastDragEvent.screenEnd);if(e!=null){let i={action:"update",mapStart:this._lastDragEvent.mapStart,mapEnd:a===!0?e:t,screenStart:this._lastDragEvent.screenEnd,screenEnd:this._lastDragEvent.screenEnd};this._next.execute(i)}}this._enabled=a}_snap(a){let t=this._view!=null?this._view.toMap(a,{exclude:[]}):null;return t!=null&&this._view!=null&&(t.z=Ea(t,this._view,this._elevationInfo)),t}createDragEventPipelineStep(a,t){this._view=a,this._elevationInfo=t,this._lastDragEvent=null;let e=new Ra;return this._next=e,[i=>{if(this._lastDragEvent=i.action!=="end"?T({},i):null,this._enabled){let r=this._snap(i.screenEnd);return r!=null?{action:i.action,mapStart:i.mapStart,mapEnd:r,screenStart:i.screenStart,screenEnd:i.screenEnd}:null}return{action:i.action,mapStart:i.mapStart,mapEnd:i.mapEnd,screenStart:i.screenStart,screenEnd:i.screenEnd}},e]}};var ea=class extends v{constructor(a){super(),this._handles=new R,this._snapToScene=new ta,this._scale=1,this._radius=70,this._view=a.view,this._tool=a.tool,this._discMaterial=this._createMaterial(),this._discMaterialTransparent=this._createMaterial(.5),a.snapToScene!=null&&(this.snapToScene=a.snapToScene),a.radius!=null&&(this._radius=a.radius),this._createManipulator(),this.forEachManipulator(t=>this._tool.manipulators.add(t))}destroy(){this._handles=k(this._handles),this.forEachManipulator(a=>{this._tool.manipulators.remove(a),a.destroy()}),this._tool=null,this._view=null,this._manipulator=null}forEachManipulator(a){a(this._manipulator,h.TRANSLATE_XY)}get displayScale(){return this._scale}set displayScale(a){this._scale=a,this._updateManipulatorTransform()}get snapToScene(){return this._snapToScene.enabled}set snapToScene(a){this._snapToScene.enabled=a}get radius(){return this._radius}set radius(a){a!==this._radius&&(this._radius=a,this._updateManipulator())}get discManipulator(){return this._manipulator}createManipulatedObjectDragPipeline(a,t,e){if(!t.operations)return I();let i=t.graphic,r=t.elevationInfo,n=t.operations.data.spatialReference;return C(t,e,s=>this.createDragPipeline((o,p,c,m,_)=>({steps:p,cancel:c}=a(o,p,c,m,_),s(o,p,c)),r,n,i))}createDragPipeline(a,t,e,i){let r=this._view;return F(this._manipulator,(n,s,o,p,c)=>{let m=s.next(K(r,n.elevationAlignedLocation)).next(Q(r,n.elevationAlignedLocation,t,e,i)).next(...this._snapToScene.createDragEventPipelineStep(r,t)).next(_=>P(T({},_),{manipulatorType:h.TRANSLATE_XY})).next(z());a(n,m,o,p,c)})}_updateManipulatorTransform(){let a=Z(g.get(),L(j.get(),this.displayScale,this.displayScale,this.displayScale));this._manipulator.modelTransform=a}_createManipulator(){let a=this._view;this._manipulator=new y({view:a,worldSized:!1,autoScaleRenderObjects:!1,focusMultiplier:1,touchMultiplier:1,collisionType:{type:"disc",direction:f(0,0,1)},worldOriented:!0}),this._updateManipulator()}_updateManipulator(){let a=ya(this._discMaterial,.02,1,128,f(0,0,1),f(0,0,0));a.transformation=Z(X(),f(this._radius,this._radius,this._radius)),this._manipulator.renderObjects=[new d(a,u.Focused),new d(a.instantiate({material:this._discMaterialTransparent}),u.Unfocused)],this._manipulator.radius=80*(this._radius/70)}_createMaterial(a=1){let t=new J({cullFace:W.Back,renderOccluded:b.Transparent,isDecoration:!0});return this._handles.add(O(()=>Y.toUnitRGBA(this._view.effectiveTheme.accentColor),e=>{e[3]*=a,t.setParameters({color:e})},B)),t}get test(){}};var ia=class extends v{constructor(a){super(),this._radius=70,this.events=new G,this._tool=a.tool,this._view=a.view;let t=new Oa({getTheme:()=>this._view.effectiveTheme});this._settings=t,a.radius!=null&&(this._radius=a.radius);let e=this._view.effectiveTheme.accentColor;this._materials={materialUnfocused:N(x(e,1,.25),b.Occlude),materialFocused:N(x(e,1,0),b.Occlude),materialOccludedUnfocused:N(x(e,.7,0),t.zManipulator.renderOccluded),materialOccludedFocused:N(x(e,.85,0),t.zManipulator.renderOccluded)},this._themeHandle=O(()=>this._view.effectiveTheme.accentColor,i=>{let r=x(i,1,.25),n=x(i,1,0),s=x(i,.7,0),o=x(i,.85,0),{materialUnfocused:p,materialFocused:c,materialOccludedUnfocused:m,materialOccludedFocused:_}=this._materials;p.setParameters({color:r}),c.setParameters({color:n}),m.setParameters({color:s}),_.setParameters({color:o})}),this._createManipulator(),this.forEachManipulator(i=>this._tool.manipulators.add(i))}destroy(){this._themeHandle=pa(this._themeHandle),this._manipulator.applyObjectTransform=ka,this.forEachManipulator(a=>{this._tool.manipulators.remove(a),a.destroy()})}forEachManipulator(a){a(this._manipulator,h.TRANSLATE_Z)}createManipulatedObjectDragPipeline(a,t,e){if(!t.operations)return I();let i=t.operations.data.spatialReference;return C(t,e,r=>this.createDragPipeline((n,s,o,p,c)=>({steps:s,cancel:o}=a(n,s,o,p,c),r(n,s,o)),i))}createDragPipeline(a,t){let e=this._view;return F(this._manipulator,(i,r,n,s,o)=>{let p=r.next(c=>P(T({},c),{manipulatorType:h.TRANSLATE_Z})).next(Ia(e,i.renderLocation,t)).next(z());a(i,p,n,s,o)})}get radius(){return this._radius}set radius(a){a!==this._radius&&(this._radius=a,this._updateManipulator())}_updateManipulator(){let a=this._settings,t=this._radius/70,e=a.zManipulator.height*t,i=a.zManipulator.coneHeight*t,r=a.zManipulator.coneWidth*t,n=a.zManipulator.width*t,s=[f(0,0,0),f(0,0,e)],o=[f(0,0,0),f(0,0,e+i)],p=(()=>{let E=X();return da(E,E,[0,0,e]),ha(E,E,Math.PI/2),E})(),{materialUnfocused:c,materialFocused:m,materialOccludedUnfocused:_,materialOccludedFocused:w}=this._materials,D=xa(c,s,n/2,16,!1),A=Ta(c,i,r/2,16,!1);A.transformation=p,this._manipulator.renderObjects=[new d(A,u.Unfocused),new d(D,u.Unfocused),new d(A.instantiate({material:m}),u.Focused),new d(D.instantiate({material:m}),u.Focused),new d(A.instantiate({material:_}),u.Unfocused),new d(D.instantiate({material:_}),u.Unfocused),new d(A.instantiate({material:w}),u.Focused),new d(D.instantiate({material:w}),u.Focused)],this._manipulator.radius=n/2+2,this._manipulator.collisionType={type:"line",paths:[o]}}_createManipulator(){let a=this._view,t=new y({view:a,autoScaleRenderObjects:!1,worldSized:!1,selectable:!1,cursor:"ns-resize",elevationInfo:this.elevationInfo,worldOriented:!0,collisionPriority:1.6});t.applyObjectTransform=e=>{let i=a.state.camera,r=Ya;a.renderCoordsHelper.toRenderCoords(this._manipulator.elevationAlignedLocation,r);let n=va(i.eye,r),s=i.computeRenderPixelSizeAtDist(n),o=fa(U,r,i.eye);sa(o,o);let p=Na;a.renderCoordsHelper.worldUpAtPosition(Ya,p);let c=Math.abs(ga(o,p)),m=na(U,o,p),_=na(U,m,p),w=ua(c,.01,1),D=1-Math.sqrt(1-w*w)/w/i.fullWidth,A=this._settings,E=this._radius/70,za=A.zManipulator.width*E;Ma(_,sa(_,_),(1/D-1)*n+s*za),e[12]-=U[0],e[13]-=U[1],e[14]-=U[2]},this._manipulator=t,this._updateManipulator()}get test(){}};function x(l,a,t){let e=wa(l,t);return e.a*=a,Y.toUnitRGBA(e)}var Ya=q(),U=q(),Na=q(),ka=()=>{};var ja=class extends ${constructor(a){super(),this._handles=new R;let{tool:t,view:e,snapToScene:i,radius:r}=a;this._view=e,this.xyManipulation=new ea({tool:t,view:e,snapToScene:i,radius:r}),this.xyAxisManipulation=new aa({tool:t,view:e,radius:r}),this.zManipulation=new ia({tool:t,view:e,radius:r}),this.xyManipulation.available=a.xyAvailable,this.xyAxisManipulation.available=a.xyAxisAvailable,this.zManipulation.available=a.zAvailable,this._autoHideXYAxis(),this.forEachManipulator(n=>this._handles.add(n.events.on("grab-changed",()=>this._updateManipulatorInteractivity())))}destroy(){this._handles.destroy(),this.xyManipulation.destroy(),this.xyAxisManipulation.destroy(),this.zManipulation.destroy()}createManipulatedObjectDragPipeline(a,t,e){return H([this.xyManipulation.createManipulatedObjectDragPipeline((i,r,n,s,o)=>a(S.XY,i,r,n,s,o),t,e),this.xyAxisManipulation.createManipulatedObjectDragPipeline((i,r,n,s,o)=>a(S.XY_AXIS,i,r,n,s,o),t,e),this.zManipulation.createManipulatedObjectDragPipeline((i,r,n,s,o)=>a(S.Z,i,r,n,s,o),t,e)])}createDragPipeline(a,t,e,i){return H([this.xyManipulation.createDragPipeline((r,n,s,o,p)=>a(S.XY,r,n,s,o,p),t,e,i),this.xyAxisManipulation.createDragPipeline((r,n,s,o,p)=>a(S.XY_AXIS,r,n,s,o,p),t,e,i),this.zManipulation.createDragPipeline((r,n,s,o,p)=>a(S.Z,r,n,s,o,p),e)])}set snapToScene(a){this.xyManipulation.snapToScene=a}set angle(a){this.xyAxisManipulation.angle=a}set radius(a){this.xyAxisManipulation.radius=a,this.xyManipulation.radius=a,this.zManipulation.radius=a}set displayScale(a){this.xyManipulation.displayScale=a,this.xyAxisManipulation.displayScale=a}forEachManipulator(a){this.xyManipulation.forEachManipulator(t=>a(t,h.TRANSLATE_XY)),this.xyAxisManipulation.forEachManipulator(t=>a(t,h.TRANSLATE_XY)),this.zManipulation.forEachManipulator(t=>a(t,h.TRANSLATE_Z))}get _xyAxisVisible(){let a=this.xyManipulation.someManipulator(t=>t.focused)||this.xyAxisManipulation.someManipulator(t=>t.focused);return this._view.inputManager&&this._view.inputManager.latestPointerType==="touch"||a}_autoHideXYAxis(){let a=this.xyAxisManipulation,t=this.xyManipulation;if(la("esri-mobile"))return;let e=[];t.forEachManipulator(r=>e.push(r)),a.forEachManipulator(r=>e.push(r));let i=()=>{let r=[];this._xyAxisVisible||a.forEachManipulator(n=>r.push(n.disableDisplay())),this._handles.remove(Fa),this._handles.add(r,Fa)};for(let r of e)this._handles.add(r.events.on("focus-changed",i));this._view.inputManager&&this._handles.add(ca(()=>this._view.inputManager?.latestPointerType,i)),i()}static radiusForSymbol(a){let t=a!=null&&a.type==="point-3d"&&a.symbolLayers;return t&&t.some(e=>e.type==="icon")?La:70}},Fa="disable-xy-axis-display",S;(function(l){l[l.XY=0]="XY",l[l.XY_AXIS=1]="XY_AXIS",l[l.Z=2]="Z"})(S||(S={}));export{h as a,v as b,$ as c,La as d,Xa as e,Ba as f,qa as g,Va as h,Wa as i,Ja as j,Ka as k,Qa as l,$a as m,at as n,tt as o,et as p,it as q,rt as r,st as s,nt as t,ot as u,lt as v,pt as w,C as x,dt as y,ja as z,S as A};
