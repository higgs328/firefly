import{a as _,b as Ne,c as Fe,d as M,e as x,f as R}from"./chunk-WGX2RQVH.js";import{f as j}from"./chunk-5AFOYCWC.js";import{m as Se}from"./chunk-4DLF223B.js";import{a as ye,b as me}from"./chunk-Z6CDEQPZ.js";import{h as Ie}from"./chunk-H3ZWZZ2B.js";import{a as oe,b as ie,c as ae}from"./chunk-U7BD7DJH.js";import{a as ge}from"./chunk-LBB4AU7W.js";import{a as ce,b as he}from"./chunk-H4IF7PQO.js";import{b as de,c as ue}from"./chunk-4KM76TSJ.js";import{a as ne,b as se}from"./chunk-GNPXNHTO.js";import{a as be}from"./chunk-7P56QMT7.js";import{a as we}from"./chunk-P4JHTV62.js";import{a as q}from"./chunk-H25DKJGS.js";import{a as fe}from"./chunk-CHCKIOZR.js";import{b as Ee,e as xe,h as ve,l as Oe,m as Ce}from"./chunk-PBAMEKFE.js";import{a as F}from"./chunk-KLZGQ7M6.js";import{a as pe}from"./chunk-N36GL6VL.js";import{a as w,b as c}from"./chunk-KQZGMGWR.js";import{a as le}from"./chunk-J2AEVBSH.js";import{a as re}from"./chunk-4YTM754S.js";import{a as te}from"./chunk-PMVHHMQJ.js";import{a as ee}from"./chunk-DO7UF2F2.js";import{a as b}from"./chunk-7B6U3N62.js";import{b as g}from"./chunk-2HYVVLKS.js";import{a as h}from"./chunk-BMYVPMAK.js";import{a as N}from"./chunk-6F25LG6O.js";import{a as C,d as X}from"./chunk-D366LN2H.js";import{a as H}from"./chunk-P5ULBNZS.js";import{c as Y}from"./chunk-S7U4DSGB.js";import{g as U,s as W}from"./chunk-DA3SDKGO.js";import{q as Te,r as Le}from"./chunk-KALOJIUA.js";import{a as I}from"./chunk-E7AX56GD.js";import{h as V}from"./chunk-RNC4P66O.js";import{a as Z}from"./chunk-U4QEPZJ3.js";import{b as $}from"./chunk-2TX472ZB.js";import{a as A,b as z,c as K}from"./chunk-7QNKS2X6.js";import{a as B}from"./chunk-VCCMJ6BV.js";import{a as je}from"./chunk-QK56OQGR.js";import{m as O}from"./chunk-ZQIC5NFT.js";import{c as J}from"./chunk-VIEK2X23.js";import{a as G}from"./chunk-7F5DJLJT.js";import{a as Q}from"./chunk-CX5IFQZJ.js";import{u as v}from"./chunk-NJWTSROP.js";import{a as i}from"./chunk-QGVBCWUY.js";import{h as k}from"./chunk-MYO4NP2N.js";import{e as a}from"./chunk-NFIPKH6V.js";import{l as E}from"./chunk-5QEXLALV.js";import{g as P}from"./chunk-XRGPJ3QY.js";import{b as p}from"./chunk-2LI2GKBQ.js";import{a as f,b as L,c as D,f as m}from"./chunk-VTHXE323.js";var _e=ge(),Me=e=>{let t=class extends e{constructor(){super(...arguments),this.fields=[],this.fieldsIndex=null}};return i([a(_e.fields)],t.prototype,"fields",void 0),i([a(_e.fieldsIndex)],t.prototype,"fieldsIndex",void 0),t=i([E("esri.layers.knowledgeGraph.KnowledgeGraphSublayerBase")],t),t};var Ke={initializeLayersFromClientData:(e,t,o)=>m(void 0,null,function*(){if(t||(t=[...e.layers,...e.tables].map(l=>l.graphTypeName)),t?.length===0)return;let r=new Map;for(let l of t)r.set(l,Re(e,l));let s=yield Se(e.dataManager.knowledgeGraph,Array.from(r.values()),{requestOptions:{signal:o?.signal}});for(let l of[...e.layers,...e.tables]){let d=l.objectType.name;if(d==null)continue;let T=s.get(Re(e,d));if(T){let u=JSON.parse(T);u===null||typeof u!="object"||u.hasOwnProperty("showLabels")||(u.showLabels=!1),l.read(u,{origin:"service"})}}})},Re=(e,t)=>e.type==="knowledge-graph"?`${t}/Map`:`${t}/LinkChart/LinkChartSubLayer`;function pt(e,t,o){return m(this,null,function*(){return Ke.initializeLayersFromClientData(e,t,o)})}var De=["#4a0932","#b31515","#18382e","#a64f1b","#102432","#8c213f","#ed9310","#2c6954","#144d59","#ffc730","#75351e","#454f4b","#78b1c2","#191921","#8f8f82","#9be0c0","#dbb658","#87b051","#11495c","#c43541","#9c5596","#44498b","#ad9d63","#86afb3","#5c98ca","#b0bfa2","#73241f","#b86b53","#d9d78c","#3e756d","#f260a1","#a0d17d","#c27c30","#eb82eb","#ffdf3c","#ffb259","#ab52b3","#3cccb4","#0095ba","#d92b30"],$e="#8f8f82";function Pe(e){return e<0||e>=De.length?new N($e):new N(De[e])}function ke(e){let t=e.toArray();return new te({data:{type:"CIMSymbolReference",symbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",enable:!0,style:"solid",width:.75,color:t},{type:"CIMVectorMarker",enable:!0,size:6,markerPlacement:{type:"CIMMarkerPlacementOnLine",angleToLine:!0,relativeTo:"LineMiddle"},frame:{xmin:-10,ymin:-5,xmax:0,ymax:5},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{rings:[[[-12,-3.47],[-12,3.6],[1.96,-.03],[-12,-3.47]]]},symbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:t}]}}]}]}}})}function Qe(e){let t="ESRI__ID",o=4;for(let r of e)if(r.name){if(r.name.toLowerCase()==="name"){t=r.name;break}r.name.toLowerCase().includes("name")?(t=r.name,o=2):r.fieldType==="esriFieldTypeString"&&o>3&&(t=r.name,o=3)}return t}function Ge(e,t,o){let r={color:[80,80,80],haloColor:[255,255,255],haloSize:.7,font:{size:10,weight:"normal"}},s=new c({labelExpressionInfo:new w({expression:o==="ESRI__ID"?`${t}`:`$feature.${o}`}),labelPlacement:"above-center",symbol:new b(r)}),l=new c({labelExpressionInfo:new w({expression:`'${t}' + IIf($feature.ESRI__AggregationCount>1, ' (' + $feature.ESRI__AggregationCount + ')', '')`}),labelPlacement:"center-along",labelPosition:"parallel",repeatLabel:!1,symbol:new b(L(f({},r),{yoffset:"12px"}))});return e==="entity"?[s]:[l]}function Je(e,t,o){let r={color:[255,255,255],haloColor:[0,0,0],haloSize:.7,font:{size:10,weight:"bold"}},s=o==="ESRI__ID"?`${e}`:`$feature.${o}`;return t==="point"?[new c({labelExpressionInfo:new w({expression:s}),labelPlacement:"above-center",symbol:new b(r)})]:t==="polyline"?[new c({labelExpressionInfo:new w({expression:s}),labelPlacement:"center-along",repeatLabel:!0,symbol:new b(r)})]:t==="polygon"?[new c({labelExpressionInfo:new w({expression:s}),labelPlacement:"always-horizontal",symbol:new b(r)})]:null}function y(e){if(!e.json)return e;e.json.write=qe(e.json.write);let t=e.json.origins;if(!t)return e;let o;for(o in t){let r=t[o];r&&(r.write=qe(r.write))}return e}function qe(e){return typeof e=="object"&&e?(e.enabled!==!1&&(e.overridePolicy=Be(e)),e):e===!0?S():e}function Be(e){let l=e,{target:t,writer:o,overridePolicy:r}=l,s=D(l,["target","writer","overridePolicy"]);return function(d,T){let u=Ae.call(this,d,T);return u.enabled?f(f({},s),u):u}}function S(){return{overridePolicy:Ae}}function Ae(e,t){let o=!!this.geometryType,r={enabled:o};return o&&(r=f(f({},r),ze.call(this,e,t))),r}function ze(e,t){return{ignoreOrigin:this.originIdOf(t)>k.DEFAULTS}}var n=class extends Me(oe(me(se(K(ue(he(B($(q(je)))))))))){constructor(e){super(e),this.blendMode="normal",this.capabilities=X(!1,!1),this.charts=null,this.definitionExpression=null,this.displayField="",this.displayFilterEnabled=!0,this.displayFilterInfo=null,this.effect=null,this.elevationInfo=null,this.featureEffect=null,this.graphType=null,this.labelsVisible=!0,this.layerType=null,this.legendEnabled=!0,this.maxScale=0,this.minScale=0,this.objectIdField=_,this.objectType=null,this.opacity=1,this.orderBy=null,this.parent=null,this.parentCompositeLayer=null,this.persistenceEnabled=!0,this.popupEnabled=!0,this.popupTemplate=null,this.refreshInterval=0,this.source={openPorts:()=>this.load().then(()=>{let t=new MessageChannel;return new Ie(t.port1,{channel:t,client:{queryFeatures:(o,r={})=>{let s=g.fromJSON(o);return this.queryFeaturesJSON(s,r)}}}),[t.port2]})},this.type="knowledge-graph-sublayer",this.useViewTime=!0,this.visible=!0}get defaultPopupTemplate(){return this.createPopupTemplate()}set featureReduction(e){let t=this._normalizeFeatureReduction(e);this._set("featureReduction",t)}get fields(){let e=[];return this.objectType?.properties?.forEach(t=>{let o=t.fieldType==="esriFieldTypeOID"?"esriFieldTypeInteger":t.fieldType;e.push(I.fromJSON({name:t.name,type:o,alias:t.alias,defaultValue:t.defaultValue,editable:t.editable,nullable:t.nullable}))}),e.push(I.fromJSON({name:this.objectIdField,type:"esriFieldTypeString",alias:this.objectIdField,editable:!1}),I.fromJSON({name:x,type:"esriFieldTypeInteger",alias:x,editable:!1}),I.fromJSON({name:R,type:"esriFieldTypeInteger",alias:R,editable:!1})),e}get geometryType(){if(this.parentCompositeLayer?.type==="link-chart")return this.graphType==="relationship"?"polyline":"point";let e=this.parentCompositeLayer?.dataManager.geographicLookup.get(this.objectType?.name),t=e?.geometryType;return t&&t!=="esriGeometryNull"?h.fromJSON(t):null}get geometryFieldName(){return this.parentCompositeLayer?.type==="link-chart"?M:this.parentCompositeLayer?.dataManager.geographicLookup.get(this.objectType?.name)?.name??null}get graphTypeName(){return this.objectType?.name}get hasM(){let e=this.parentCompositeLayer?.dataManager.geographicLookup.get(this.objectType?.name),t=e?.name;return(t?this.objectType?.properties?.[t]:null)?.hasM??!1}get hasZ(){let e=this.parentCompositeLayer?.dataManager.geographicLookup.get(this.objectType?.name),t=e?.name;return(t?this.objectType?.properties?.[t]:null)?.hasZ??!1}set labelingInfo(e){this._set("labelingInfo",e)}get labelingInfo(){if(this._isOverridden("labelingInfo"))return this._get("labelingInfo");let e=this.objectType.properties?Qe(this.objectType.properties):"ESRI__ID";return this.parentCompositeLayer.type==="link-chart"?Ge(this.graphType,this.graphTypeName,e):Je(this.graphTypeName,this.geometryType,e)}set renderer(e){Te(e,this.fieldsIndex),this._set("renderer",e)}get renderer(){if(this._isOverridden("renderer"))return this._get("renderer");let e=this.parentCompositeLayer?.dataManager?.knowledgeGraph?.dataModel,t=[...e?.entityTypes??[],...e?.relationshipTypes??[]].map(s=>s.name).indexOf(this.graphTypeName),o=Pe(t);if(this.parentCompositeLayer?.type==="link-chart"){if(this.graphType==="relationship")return new le({type:"simple",symbol:ke(o)});let s=F(C(h.toJSON("point")).renderer);return j(s.symbol,o),s}let r=F(C(h.toJSON(this.geometryType)).renderer);return j(r.symbol,o),r}get spatialReference(){return this.parentCompositeLayer?.dataManager?.knowledgeGraph?.dataModel?.spatialReference??G.WGS84}set timeInfo(e){this._set("timeInfo",e)}get title(){return this._isOverridden("title")?this._get("title"):this.graphTypeName}set title(e){this._set("title",e)}writeTitle(e,t){t.title=e??"Layer"}createPopupTemplate(e){return we(this,e)}createQuery(){return new g({where:"1=1",outFields:["*"]})}getField(e){return this.fieldsIndex.get(e)}getFieldDomain(e,t){return null}queryFeatures(e,t){return m(this,null,function*(){yield this.load();let{resolvedQuery:o,queryEngine:r}=yield this._setupQueryObjects(e),s=re.fromJSON(yield r.executeQuery(o.toJSON(),t?.signal));return s.features.forEach(l=>{l.sourceLayer=this}),s})}queryFeaturesJSON(e,t){return m(this,null,function*(){yield this.load();let{resolvedQuery:o,queryEngine:r}=yield this._setupQueryObjects(e);return yield r.executeQuery(o.toJSON(),t?.signal)})}queryFeatureCount(e,t){return m(this,null,function*(){yield this.load();let{resolvedQuery:o,queryEngine:r}=yield this._setupQueryObjects(e);return r.executeQueryForCount(o.toJSON(),t?.signal)})}queryExtent(){return m(this,arguments,function*(e={},t){yield this.load();let o=L(f({},e),{returnGeometry:!0}),{resolvedQuery:r,queryEngine:s}=yield this._setupQueryObjects(o),l=yield s.executeQueryForExtent(r.toJSON(),t?.signal),d;return d=l.extent?.xmin!=null&&l.extent?.xmax!=null&&l.extent?.ymin!=null&&l.extent?.ymax!=null?new O(l.extent):new O,{count:l.count,extent:d}})}queryObjectIds(e,t){return m(this,null,function*(){yield this.load();let o=g.from(e),r;if(this.parentCompositeLayer.type==="link-chart"&&this._cachedQueryEngine)r=this._cachedQueryEngine;else{let s=yield this.parentCompositeLayer.dataManager.getData(o,this,t);r=this.loadQueryEngine(s)}return yield r.executeQueryForIds(o.toJSON(),t?.signal)})}loadQueryEngine(e){let t=new H({geometryType:h.toJSON(this.geometryType),hasM:this.hasM,hasZ:this.hasZ}),o=new Y({fieldsIndex:this.fieldsIndex.toJSON(),geometryType:h.toJSON(this.geometryType),hasM:this.hasM,hasZ:this.hasZ,objectIdField:this.objectIdField,spatialReference:this.spatialReference.toJSON(),timeInfo:this.timeInfo?.toJSON(),featureStore:t});return o.featureStore.addMany(e),o}refreshCachedQueryEngine(){return m(this,null,function*(){let e=yield this.parentCompositeLayer.dataManager.getData(new g({where:"1=1",outFields:[_]}),this);this._cachedQueryEngine=this.loadQueryEngine(e)})}load(e){return this.addResolvingPromise(this.parent.load(e).then(()=>Le(this.timeInfo,this.fieldsIndex))),Promise.resolve(this)}_setupQueryObjects(e,t){return m(this,null,function*(){let o=g.from(e),r=o.geometry;if(r&&!r.spatialReference?.isWGS84&&(yield W(r.spatialReference,v),o.geometry=U(r instanceof V||r instanceof Z||r instanceof J?r:r.extent,v)),this.parentCompositeLayer.type==="link-chart"&&this._cachedQueryEngine)return{resolvedQuery:o,queryEngine:this._cachedQueryEngine};let s=yield this.parentCompositeLayer.dataManager.getData(o,this,t);return{resolvedQuery:o,queryEngine:this.loadQueryEngine(s)}})}};i([a(y(p(A)))],n.prototype,"blendMode",void 0),i([a()],n.prototype,"capabilities",void 0),i([a({json:{origins:{"web-scene":{write:!1}},write:S()}})],n.prototype,"charts",void 0),i([a({readOnly:!0})],n.prototype,"defaultPopupTemplate",null),i([a({type:String,json:{origins:{service:{read:!1}},name:"layerDefinition.definitionExpression",write:{ignoreOrigin:!0}}})],n.prototype,"definitionExpression",void 0),i([a()],n.prototype,"displayField",void 0),i([a(y(p(ie)))],n.prototype,"displayFilterEnabled",void 0),i([a(y(p(ae)))],n.prototype,"displayFilterInfo",void 0),i([a(y(p(z)))],n.prototype,"effect",void 0),i([a()],n.prototype,"elevationInfo",void 0),i([a(y(p(ne)))],n.prototype,"featureEffect",void 0),i([a(y(p(ye)))],n.prototype,"featureReduction",null),i([a()],n.prototype,"fields",null),i([a()],n.prototype,"geometryType",null),i([a()],n.prototype,"geometryFieldName",null),i([a({type:["entity","relationship"],nonNullable:!0,json:{write:{isRequired:!0,ignoreOrigin:!0}}})],n.prototype,"graphType",void 0),i([a({type:String,nonNullable:!0,json:{write:{isRequired:!0,ignoreOrigin:!0}}})],n.prototype,"graphTypeName",null),i([a()],n.prototype,"hasM",null),i([a()],n.prototype,"hasZ",null),i([a({type:String,json:{origins:{service:{read:!1},"portal-item":{read:!1}},write:{ignoreOrigin:!0}}})],n.prototype,"id",void 0),i([a({type:Boolean,value:!0,nonNullable:!0,json:{name:"showLabels",default:!1,write:{overridePolicy(){return{enabled:!!this.geometryType,alwaysWriteDefaults:!0,ignoreOrigin:!0}}}}})],n.prototype,"labelsVisible",void 0),i([a({type:[c],json:{name:"layerDefinition.drawingInfo.labelingInfo",read:Ve,write:S()}})],n.prototype,"labelingInfo",null),i([a({readOnly:!0,json:{read:!1,write:{writer(e,t){switch(this.parentCompositeLayer?.type){case"link-chart":t.layerType="LinkChartSubLayer";break;case"knowledge-graph":t.layerType=this.geometryType?"KnowledgeGraphSubLayer":"KnowledgeGraphSubTable"}},isRequired:!0,ignoreOrigin:!0,writerEnsuresNonNull:!0}}})],n.prototype,"layerType",void 0),i([a(y(p(xe)))],n.prototype,"legendEnabled",void 0),i([a(y(p(Ce)))],n.prototype,"maxScale",void 0),i([a(y(p(Oe)))],n.prototype,"minScale",void 0),i([a()],n.prototype,"objectIdField",void 0),i([a()],n.prototype,"objectType",void 0),i([a(y(p(ve)))],n.prototype,"opacity",void 0),i([a(y(p(de)))],n.prototype,"orderBy",void 0),i([a({clonable:!1})],n.prototype,"parent",void 0),i([a()],n.prototype,"parentCompositeLayer",void 0),i([a(y(p(Ee)))],n.prototype,"popupEnabled",void 0),i([a({type:ee,json:{name:"popupInfo",write:{ignoreOrigin:!0}}})],n.prototype,"popupTemplate",void 0),i([a({type:Number,json:{write:{overridePolicy:ze}}})],n.prototype,"refreshInterval",void 0),i([a({types:pe,json:{name:"layerDefinition.drawingInfo.renderer",write:S()}})],n.prototype,"renderer",null),i([a()],n.prototype,"source",void 0),i([a()],n.prototype,"spatialReference",null),i([a({type:fe,json:{name:"layerDefinition.timeInfo",write:!0,origins:{"web-document":{name:"layerDefinition.timeInfo",read:!0,write:!0},"portal-item":{name:"layerDefinition.timeInfo",read:!0,write:!0}}}})],n.prototype,"timeInfo",null),i([a({type:String,json:{write:{isRequired:!0,ignoreOrigin:!0,writerEnsuresNonNull:!0}}})],n.prototype,"title",null),i([Q("title")],n.prototype,"writeTitle",null),i([a({json:{read:!1}})],n.prototype,"type",void 0),i([a(y(p(ce)))],n.prototype,"useViewTime",void 0),i([a({type:Boolean,json:{name:"visibility",write:S()}})],n.prototype,"visible",void 0),n=i([E("esri.layers.knowledgeGraph.KnowledgeGraphSublayer")],n);var sr=n;function Ve(e,t,o){let r=[["ESRI__AGGREGATION_COUNT",x],["ESRI__ORIGIN_ID",Ne],["ESRI__DESTINATION_ID",Fe],["ESRI__LAYOUT_GEOMETRY",M]];try{for(let s of e)for(let[l,d]of r)s.labelExpression=s.labelExpression?.replaceAll(l,d),s.labelExpressionInfo?.expression&&(s.labelExpressionInfo.expression=s.labelExpressionInfo.expression.replaceAll(l,d))}catch(s){P.getLogger(this).warn("Error updating labelingInfo",s)}return be(e,t,o)}export{pt as a,sr as b};
