import{a as _}from"./chunk-FPCHE4I2.js";import{a as b}from"./chunk-ISXQQRNZ.js";import{a as S}from"./chunk-GVABYWYT.js";import{a as x}from"./chunk-EBLTZITF.js";import{a as E}from"./chunk-G4DZJMGT.js";import{b as g}from"./chunk-ACP3S2CH.js";import{a as y}from"./chunk-T7DXJKX7.js";import{a as r}from"./chunk-QGVBCWUY.js";import{e as s}from"./chunk-NFIPKH6V.js";import{l as f}from"./chunk-5QEXLALV.js";import{b as p}from"./chunk-YOFFGXOB.js";import{a as e,f as k}from"./chunk-VTHXE323.js";var O=g.ofType(b),B={width:128,height:128,format:"png"},w={takeScreenshot:!0,captureViewpoint:!0,captureRotation:!0,captureScale:!0,captureTimeExtent:!0},C={time:!0},a=class extends _(y.EventedAccessor){constructor(t){super(t),this.capabilities=e({},C),this.activeBookmark=null,this.view=null}destroy(){this.view=null,this._set("activeBookmark",null)}castCapabilities(t){return e(e({},C),t)}get bookmarks(){return this.view?.map?.bookmarks??new O}set bookmarks(t){this._overrideIfSome("bookmarks",t)}set defaultCreateOptions(t){this._set("defaultCreateOptions",e(e({},w),t))}get defaultCreateOptions(){return w}set defaultEditOptions(t){this._set("defaultEditOptions",e(e({},w),t))}get defaultEditOptions(){return w}get state(){let{view:t}=this;return t&&!t.ready?"loading":"ready"}createBookmark(t){return k(this,null,function*(){let{view:o,defaultCreateOptions:i,capabilities:n}=this;if(!o)throw new p("create-bookmark:invalid-view","Cannot create a bookmark without a view.");let{takeScreenshot:c,screenshotSettings:l,captureViewpoint:h,captureRotation:d,captureScale:v,captureTimeExtent:u}=e(e({},i),t),m=c?yield this._createThumbnail(l):void 0,T=n.time&&u&&o.timeExtent!=null?o.timeExtent.clone():void 0;return new b(e(e(e({},m&&{thumbnail:m}),u&&{timeExtent:T}),h&&{viewpoint:this._createViewpoint({view:o,captureScale:v,captureRotation:d})}))})}editBookmark(t,o){return k(this,null,function*(){if(!t)return t;let{view:i,defaultEditOptions:n}=this;if(!i)throw new p("edit-bookmark:invalid-view","Cannot edit a bookmark without a view.");let{takeScreenshot:c,screenshotSettings:l,captureViewpoint:h,captureRotation:d,captureScale:v,captureTimeExtent:u}=e(e({},n),o),m=c?yield this._createThumbnail(l):void 0;return m&&(t.thumbnail=m),h&&(t.viewpoint=this._createViewpoint({view:i,captureScale:v,captureRotation:d})),u&&i.timeExtent!=null&&(t.timeExtent=i.timeExtent.clone()),this.emit("bookmark-edit",{bookmark:t}),t})}goTo(t){let{capabilities:o,view:i}=this;if(!i)throw new p("go-to:invalid-view","Cannot go to a bookmark without a view");let n=t?.viewpoint;if(!n)throw new p("go-to:invalid-bookmark","Cannot go to a bookmark that does not contain a 'viewpoint'.",{bookmark:t});this._set("activeBookmark",t);let c=this.callGoTo({target:n}),l=t?.timeExtent;return o.time&&l&&(i.timeExtent=l),this.emit("bookmark-select",{bookmark:t}),c.catch(()=>{}).then(()=>this._set("activeBookmark",null)),c}_createThumbnail(t){return k(this,null,function*(){let{view:o}=this;if(!o)throw new p("bookmark:invalid-view","Cannot create slide thumbnail without a view");let i=yield o.takeScreenshot(e(e({},B),t));return new S({url:i.dataUrl})})}_createViewpoint({view:t,captureRotation:o,captureScale:i}){let n=t.viewpoint?.clone();return new x({targetGeometry:t.extent?.clone(),rotation:(o?n?.rotation:null)??0,scale:(i?n?.scale:null)??0})}};r([s()],a.prototype,"capabilities",void 0),r([E("capabilities")],a.prototype,"castCapabilities",null),r([s({readOnly:!0})],a.prototype,"activeBookmark",void 0),r([s({type:O})],a.prototype,"bookmarks",null),r([s()],a.prototype,"defaultCreateOptions",null),r([s()],a.prototype,"defaultEditOptions",null),r([s({readOnly:!0})],a.prototype,"state",null),r([s()],a.prototype,"view",void 0),a=r([f("esri.widgets.Bookmarks.BookmarksViewModel")],a);var J=a;export{J as a};
