import{a as v}from"./chunk-UMRL4FCR.js";import{f as M,p as y}from"./chunk-ZEWUF6OQ.js";import{a as p}from"./chunk-7LVUNMSI.js";import{a as d,j as c}from"./chunk-TG45K3WR.js";import{b as f}from"./chunk-ACP3S2CH.js";import{a as b}from"./chunk-T7DXJKX7.js";import{a as o}from"./chunk-QGVBCWUY.js";import{e as n}from"./chunk-NFIPKH6V.js";import{l as I}from"./chunk-5QEXLALV.js";var r={view:"view",viewLayers:"view-layers",mapLayers:"map-layers",layerViews:"layer-views",layerListMode:"layer-list-mode"},V="hide",g=f.ofType(v),l=class extends b.EventedAccessor{constructor(e){super(e),this.checkPublishStatusEnabled=!1,this.listItemCreatedFunction=null,this.listModeDisabled=!1,this.operationalItems=new g,this.view=null}initialize(){this.addHandles([d(()=>this.view?.ready===!0,()=>this._viewHandles(),c),d(()=>[this.listItemCreatedFunction,this.checkPublishStatusEnabled,this.listModeDisabled],()=>this._recompileList()),d(()=>p(this.view)?this.view.inGeographicLayout:null,()=>this._compileList())],r.view)}destroy(){this._removeAllItems(),this.view=null}get state(){let{view:e}=this;return e?.ready?"ready":e?"loading":"disabled"}get totalItems(){return this.operationalItems.flatten(e=>e.children).length}triggerAction(e,t){e&&!e.disabled&&this.emit("trigger-action",{action:e,item:t})}moveListItem(e,t,i,s){let a=e?.layer;if(!a||a.type==="subtype-sublayer"||a.type==="sublayer")return;let h=this.view?.map?.layers,L=t?y(t):h,m=i?y(i):h;if(!L||!m)return;let{operationalItems:w}=this,H=t?.children||w,u=i?.children||w,_=m.length-s;e.parent=i||null,H.remove(e),L.remove(a),u.includes(e)||u.add(e,_),m.includes(a)||m.add(a,_),this._compileList()}_createLayerViewHandles(e){this.removeHandles(r.layerViews),this._compileList(),e&&this.addHandles(e.on("change",()=>this._compileList()),r.layerViews)}_createMapLayerHandles(e){this.removeHandles(r.mapLayers),this._compileList(),e&&this.addHandles(e.on("change",()=>this._compileList()),r.mapLayers)}_createListItem(e){let{view:t,listItemCreatedFunction:i,checkPublishStatusEnabled:s,listModeDisabled:a}=this;return new v({checkPublishStatusEnabled:s,listModeDisabled:a,layer:e,listItemCreatedFunction:i,view:t})}_removeAllItems(){this.operationalItems.destroyAll()}_getViewableLayers(e){return e?this.listModeDisabled?e:e.filter(t=>M(t)!==V):void 0}_watchLayersListMode(e){this.removeHandles(r.layerListMode),e&&!this.listModeDisabled&&this.addHandles(d(()=>e.filter(t=>"listMode"in t).map(t=>t.listMode).toArray(),()=>this._compileList()),r.layerListMode)}_compileList(){let e=this.view?.map?.layers,t=p(this.view)&&!this.view.inGeographicLayout?e?.filter(({type:s})=>s==="link-chart"):e;this._watchLayersListMode(t);let i=this._getViewableLayers(t);i?.length?(this._createNewItems(i),this._removeItems(i),this._sortItems(i)):this._removeAllItems()}_createNewItems(e){let{operationalItems:t}=this;e.forEach(i=>{t.some(s=>s.layer===i)||t.add(this._createListItem(i))})}_removeItems(e){let{operationalItems:t}=this,i=[];t.forEach(s=>{s&&e&&e.includes(s.layer)||i.push(s)}),t.destroyMany(i)}_sortItems(e){let{operationalItems:t}=this;t.sort((i,s)=>{let a=e.indexOf(i.layer),h=e.indexOf(s.layer);return a>h?-1:a<h?1:0})}_recompileList(){this._removeAllItems(),this._compileList()}_viewHandles(){let{view:e}=this;this.removeHandles([r.mapLayers,r.layerViews,r.viewLayers]),e?.ready?this.addHandles([d(()=>this.view?.map?.allLayers,t=>this._createMapLayerHandles(t),c),d(()=>this.view?.allLayerViews,t=>this._createLayerViewHandles(t),c)],r.viewLayers):this._removeAllItems()}};o([n()],l.prototype,"checkPublishStatusEnabled",void 0),o([n()],l.prototype,"listItemCreatedFunction",void 0),o([n({nonNullable:!0})],l.prototype,"listModeDisabled",void 0),o([n({type:g})],l.prototype,"operationalItems",void 0),o([n({readOnly:!0})],l.prototype,"state",null),o([n()],l.prototype,"totalItems",null),o([n()],l.prototype,"view",void 0),l=o([I("esri.widgets.LayerList.LayerListViewModel")],l);var z=l;export{z as a};
