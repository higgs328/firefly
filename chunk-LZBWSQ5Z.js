import{b as u}from"./chunk-JLPLCY2B.js";import{b as F}from"./chunk-ACP3S2CH.js";import{a as i}from"./chunk-QGVBCWUY.js";import{e as s}from"./chunk-NFIPKH6V.js";import{l as v}from"./chunk-5QEXLALV.js";import{K as $,z as b}from"./chunk-4PTIEWMT.js";import{a as L,d as V}from"./chunk-TG2UTNEO.js";import{g}from"./chunk-XRGPJ3QY.js";import{f as w}from"./chunk-VTHXE323.js";var y=Symbol(),Q=S=>{let r=class extends S{constructor(){super(...arguments),this.layerViews=new F,this._debouncedUpdate=$(()=>w(this,null,function*(){let{layer:t,parent:a}=this,o=a?.footprintLayerView,n=[],d=this._createQuery();if(d&&o){let{features:m}=yield o.queryFeatures(d);this.suspended||(n=m.map(h=>t.acquireLayer(h)))}this.removeHandles(y),this.addHandles(n,y)}))}get creatingLayerViews(){return this.view?.layerViewManager.isCreatingLayerViewsForLayer(this.layer)??!1}isUpdating(){return this.creatingLayerViews||this.layer.updating||this.layerViews.some(t=>t.updating)}enableLayerUpdates(){return V([this._updatingHandles.addWhen(()=>this.parent?.footprintLayerView?.dataUpdating===!1,()=>this.updateLayers()),this._updatingHandles.add(()=>[this.layer.maximumVisibleSublayers,this.layer.parent?.orderBy,this.parent?.footprintLayerView?.filter,this.parent?.footprintLayerView?.timeExtent,this.suspended],()=>this.updateLayers()),L(()=>this.removeHandles(y))])}updateLayers(){this.suspended?this.removeHandles(y):this._updatingHandles.addPromise(b(this._debouncedUpdate()).catch(t=>{g.getLogger(this).error(t)}))}_createQuery(){let t=this.parent?.footprintLayerView,a=this.layer?.parent;if(!t||!a||a.destroyed)return null;let{layer:{maximumVisibleSublayers:o},view:{scale:n}}=this;if(!o)return null;let{itemTypeField:d,itemSourceField:m,itemNameField:h,minScaleField:c,maxScaleField:f,objectIdField:H,orderBy:U}=a,_=u(`${c} IS NULL OR ${n} <= ${c} OR ${c} = 0`,`${f} IS NULL OR ${n} >= ${f}`),p=U?.find(l=>l.field&&!l.valueExpression),e=t.createQuery();if(e.returnGeometry=!1,e.num=o,e.outFields=[H,m,h],e.where=u(e.where,_),this.unsupportedItemTypes!=null){let l=`${d} NOT IN (${this.unsupportedItemTypes.map(x=>`'${x}'`)})`;e.where=u(e.where,l)}return p?.field&&(e.orderByFields=[`${p.field} ${p.order==="descending"?"DESC":"ASC"}`],e.outFields.push(p.field)),e}};return i([s({readOnly:!0})],r.prototype,"creatingLayerViews",null),i([s()],r.prototype,"layer",void 0),i([s()],r.prototype,"layerViews",void 0),i([s({readOnly:!0})],r.prototype,"unsupportedItemTypes",void 0),i([s()],r.prototype,"parent",void 0),i([s({readOnly:!0})],r.prototype,"isUpdating",null),r=i([v("esri.views.layers.CatalogDynamicGroupLayerView")],r),r};export{Q as a};
