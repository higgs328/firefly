import{a as F}from"./chunk-Z7FM23V2.js";import{a as v}from"./chunk-UMRL4FCR.js";import{i as w,l as c}from"./chunk-ZEWUF6OQ.js";import{a as g}from"./chunk-2XCEJBGD.js";import{a as b}from"./chunk-UZ6PRO67.js";import{a as y,j as m}from"./chunk-TG45K3WR.js";import{b as u}from"./chunk-ACP3S2CH.js";import{a as i}from"./chunk-QGVBCWUY.js";import{H as L}from"./chunk-MYO4NP2N.js";import{e as a}from"./chunk-NFIPKH6V.js";import{l as p}from"./chunk-5QEXLALV.js";import{b as S}from"./chunk-YOFFGXOB.js";import{y as h}from"./chunk-QBWJMFH5.js";var d=e=>I(e)||M(e),I=e=>{if(!("type"in e))return!1;switch(e.type){case"feature":case"geojson":case"csv":case"graphics":case"wfs":case"map-notes":case"oriented-imagery":case"scene":case"building-scene":case"subtype-sublayer":return!0;default:return!1}},M=e=>{let t=w(e);if(t!=null&&e.hasOwnProperty(t)&&e[t]!=null){for(let r of e[t])if(d(r))return!0}return!1},V=(e,t)=>t!=null&&e!=null&&(t.test(e.title)?"self":!!e.children.some(r=>V(r,t)!==!1)&&"children");var f,s=f=class extends v{constructor(e){super(e),this.children=new u,this.parent=null}get enabled(){let{children:e}=this;if(e.length===0)return this.featureSource!=null&&this.featureSource.enabled?"enabled":"disabled";let t=!1,r=!1;for(let l of e){if(l.enabled==="indeterminate")return l.enabled;if(l.enabled==="enabled"?t=!0:l.enabled==="disabled"&&(r=!0),r&&t)return"indeterminate"}return r?"disabled":"enabled"}get childLayerIds(){return this.children.toArray().flatMap(e=>[e.layer?.id,...e.childLayerIds])}get featureSource(){let{layer:e,getFeatureSnappingSources:t}=this;return t().find(r=>r.layer===e)}_initializeChildLayers(e){if(!e)return;let t=e.filter(d);super._initializeChildLayers(t)}_createChildItems(e){return e.map(t=>c(t)?new f({layer:t,parent:this,view:this.view,getFeatureSnappingSources:this.getFeatureSnappingSources}):null).filter(h).reverse()}};i([a()],s.prototype,"enabled",null),i([a()],s.prototype,"children",void 0),i([a()],s.prototype,"childLayerIds",null),i([a()],s.prototype,"featureSource",null),i([a({constructOnly:!0})],s.prototype,"getFeatureSnappingSources",void 0),i([a()],s.prototype,"parent",void 0),s=f=i([p("esri.widgets.support.SnappingControls.SnappingListItem")],s);var o=class extends F{constructor(){super(...arguments),this.featureSnappingSources=new u}get operationalItemsFlat(){return this.operationalItems.flatten(e=>e.children)}get selectableItems(){return this.operationalItemsFlat.filter(e=>!e.children?.length)}_compileList(){let e=this.view?.map?.layers;if(!e)return;let t=e.filter(d);this._watchLayersListMode(t);let r=this._getViewableLayers(t);r?.length?(this._createNewItems(r),this._removeItems(r),this._sortItems(r)):this._removeAllItems()}_createListItem(e){return new s({layer:e,view:this.view,getFeatureSnappingSources:()=>this.featureSnappingSources})}};i([a()],o.prototype,"featureSnappingSources",void 0),i([a()],o.prototype,"operationalItems",void 0),i([a()],o.prototype,"operationalItemsFlat",null),i([a()],o.prototype,"selectableItems",null),o=i([p("esri.widgets.support.SnappingControls.SnappingLayerListViewModel")],o);var n=class extends L{constructor(e){super(e),this.layerListViewModel=new o,this.snappingOptions=new g,this.view=null}initialize(){this.addHandles([y(()=>({viewModel:this.layerListViewModel,view:this.view}),({viewModel:e,view:t})=>{e.view=t},m),y(()=>({viewModel:this.layerListViewModel,sources:this.snappingOptions?.featureSources}),({viewModel:e,sources:t})=>{e.featureSnappingSources=t},m)])}get allLayersEnabled(){return(this.layerListViewModel?.selectableItems??[]).every(e=>e.enabled==="enabled")}get allLayersDisabled(){return(this.layerListViewModel?.selectableItems??[]).every(e=>!e.enabled)}get layersEnabledCount(){return this.layerListViewModel?.selectableItems?.filter(e=>e.enabled==="enabled").length??0}get state(){return this.snappingOptions?"ready":"disabled"}toggleSnappingForLayers(e,t){e?.forEach(r=>t?this.enableSnappingForLayer(r):this.disableSnappingForLayer(r))}toggleSnappingForAllLayers(e){this.layerListViewModel.selectableItems.forEach(({layer:t})=>{let r=t?.id;e?this.enableSnappingForLayer(r):this.disableSnappingForLayer(r)})}enableSnappingForLayer(e){let t=this._findSnappingSourceForLayer(e)??this._makeSnappingSourceForLayer(e);t&&(t.enabled=!0)}disableSnappingForLayer(e){let t=this._findSnappingSourceForLayer(e);t&&(t.enabled=!1)}updateEnabledFeatureSources(e){for(let t of this.snappingOptions.featureSources)c(t.layer)&&(t.enabled=e.includes(t.layer.id))}_findSnappingSourceForLayer(e){return this.snappingOptions.featureSources.find(t=>t.layer.id===e)}_makeSnappingSourceForLayer(e){let t=this.layerListViewModel.operationalItemsFlat.find(l=>l.layer?.id===e)?.layer;if(!t)throw new S("snapping-controls:layer-not-found",`cannot enable snapping for layer with id ${e} because no such layer was found in the view`);if(t.type==="group")return;let r=new b({layer:t});return this.snappingOptions.featureSources.add(r),r}};i([a()],n.prototype,"allLayersEnabled",null),i([a()],n.prototype,"allLayersDisabled",null),i([a({constructOnly:!0})],n.prototype,"layerListViewModel",void 0),i([a()],n.prototype,"layersEnabledCount",null),i([a({type:g,nonNullable:!0})],n.prototype,"snappingOptions",void 0),i([a()],n.prototype,"state",null),i([a()],n.prototype,"view",void 0),n=i([p("esri.widgets.support.SnappingControls.SnappingControlsViewModel")],n);var ce=n;export{V as a,ce as b};
