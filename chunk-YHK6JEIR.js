import{a as S}from"./chunk-XBE326RR.js";import{a as m}from"./chunk-BNOCJUWF.js";import{a as o,j as y}from"./chunk-TG45K3WR.js";import{a as r}from"./chunk-QGVBCWUY.js";import{H as g}from"./chunk-MYO4NP2N.js";import{e as n}from"./chunk-NFIPKH6V.js";import{l as h}from"./chunk-5QEXLALV.js";var s=class extends g{constructor(e){super(e),this.layer=null,this.mode="range",this.scaleRanges=S.fromScaleRange({minScale:0,maxScale:0}),this.sliderViewModel=(()=>{let{max:i}=this._getSliderIndexRange(this.scaleRanges.length-1);return new m({precision:10,min:0,max:i,values:[0,i]})})()}initialize(){this.addHandles([o(()=>this.layer,e=>e?.load().catch(()=>{})),o(()=>this.mode,e=>{e==="range"&&this.sliderViewModel.values?.length===1?this.sliderViewModel.values=[this.sliderViewModel.min,this.sliderViewModel.values[0]]:this.sliderViewModel.values?.length===2&&(e==="min-scale-only"?this.sliderViewModel.values=[this.sliderViewModel.values[0]]:e==="max-scale-only"&&(this.sliderViewModel.values=[this.sliderViewModel.values[1]]))}),o(()=>({loaded:this.layer?.loaded,ready:this.view?.ready}),({loaded:e,ready:i})=>{if(!e||!i)return;if(this._hasTiledLayer()){let l=this._getLayerResampling()?void 0:this.mapScaleToSlider(this._getTiledLayerMaxScale()),t=this.mapScaleToSlider(this._getTiledLayerMinScale());this.sliderViewModel.effectiveMax=l,this.sliderViewModel.effectiveMin=t}else{let l=this.layer&&"maxScaleRange"in this.layer?this.layer.maxScaleRange:null,{minScale:t=0,maxScale:c=0}=l??{};this.sliderViewModel.effectiveMax=c===0?void 0:this.mapScaleToSlider(c),this.sliderViewModel.effectiveMin=t===0?void 0:this.mapScaleToSlider(t)}let a=this.layer;a&&"minScale"in a&&"maxScale"in a?(this.minScale=a.minScale,this.maxScale=a.maxScale):(this.minScale=void 0,this.maxScale=void 0)},y)])}get effectiveMaxScale(){return this.maxScale===0?this.maxScaleLimit:this.maxScale}get effectiveMinScale(){return this.minScale===0?this.minScaleLimit:this.minScale}get effectiveMaxScaleLimit(){return this.mapSliderToScale(this.sliderViewModel.effectiveMax??this.sliderViewModel.max)}get effectiveMinScaleLimit(){return this.mapSliderToScale(this.sliderViewModel.effectiveMin??this.sliderViewModel.min)}get maxScale(){return this._getScale("max")}set maxScale(e){this._setMaxScaleOnSlider(e)}get maxScaleLimit(){return this.mapSliderToScale(this.sliderViewModel.max)}set maxScaleLimit(e){this._setSliderRange({maxScale:e,minScale:this.minScaleLimit})}get minScale(){return this._getScale("min")}set minScale(e){this._setMinScaleOnSlider(e)}get minScaleLimit(){return this.mapSliderToScale(this.sliderViewModel.min)}set minScaleLimit(e){this._setSliderRange({maxScale:this.maxScaleLimit,minScale:e})}get state(){let{view:e,layer:i}=this;return!e&&!i||!e&&i?.loaded||!i&&e?.ready||e&&e.ready&&i?.loaded?"ready":"disabled"}set view(e){this._set("view",e)}mapScaleToSlider(e){let i=this.scaleRanges.scaleToRangeIndex(e),a=this.scaleRanges.findScaleRangeByIndex(i),{maxScale:l,minScale:t}=a,{max:c,min:d}=this._getSliderIndexRange(i);return this._mapToRange(e,t,l,d,c)}mapSliderToScale(e){let i=this.scaleRanges.findScaleRangeByIndex(e),{maxScale:a,minScale:l}=i,{max:t,min:c}=this._getSliderIndexRange(e);return this._mapToRange(e,c,t,l,a)}_setSliderRange(e){this.scaleRanges=S.fromScaleRange(e);let{max:i}=this._getSliderIndexRange(this.scaleRanges.length-1);this.sliderViewModel.max=i,this.sliderViewModel.min=0,this.notifyChange("maxScaleLimit"),this.notifyChange("minScaleLimit")}_getSliderIndexRange(e){let i=Math.floor(e);return{min:i,max:i+.99999}}_mapToRange(e,i,a,l,t){return l+(e-i)*(t-l)/(a-i)}_getSliderValue(e){let{min:i,max:a,values:l}=this.sliderViewModel,[t,c]=l;switch(this.mode){case"max-scale-only":return e==="min"?i:t;case"min-scale-only":return e==="min"?t:a;default:return e==="min"?t??i:c??a}}_getScale(e){let i=this.mapSliderToScale(this._getSliderValue(e));return this._normalizeScale(e,i)}_setMaxScaleOnSlider(e){let{scaleRanges:i,sliderViewModel:a}=this;if(e!==void 0){let l=this.mapScaleToSlider(this._constrainMaxScaleToLayer(i.clampMaxScale(e)));switch(this.mode){case"range":a.values=[a.values[0],l];break;case"max-scale-only":a.values=[l]}}}_setMinScaleOnSlider(e){let{scaleRanges:i,sliderViewModel:a}=this;if(e!==void 0){let l=this.mapScaleToSlider(this._constrainMinScaleToLayer(i.clampMinScale(e)));switch(this.mode){case"range":a.values=[l,a.values[1]];break;case"min-scale-only":a.values=[l]}}}_constrainMinScaleToLayer(e){let{scaleRanges:i}=this;if(this._hasTiledLayer()){let{firstRange:a}=i,l=this._getTiledLayerMinScale();e=this._mapToRange(e,a.maxScale,a.minScale,0,1)>.85||e>l?l:e}return e}_constrainMaxScaleToLayer(e){if(this._hasTiledLayer()&&!this._getLayerResampling()){let i=this._getTiledLayerMaxScale();e=e<i?i:e}return e}_normalizeScale(e,i){let a=e==="max"?"maxScale":"minScale",l=this._hasTiledLayer()?e==="min"?this._getTiledLayerMinScale():this._getTiledLayerMaxScale():this.scaleRanges[a],t=this._hasTiledLayer()?e==="min"?this._getTiledLayerRealMinScale():this._getTiledLayerRealMaxScale():l,c=1e-6,d=i===0||t===i||Math.abs(t-i)<=c;return Number((d?0:i).toFixed(6))}_getLayerLODS(){let{layer:e}=this;return!e?.loaded||!("tileInfo"in e)||e.type==="wcs"||e.type==="imagery-tile"&&e.raster?.tileType==="Raster"?null:e.tileInfo?.lods}_getLayerResampling(){return!!this.layer?.loaded&&(!("resampling"in this.layer)||this.layer.resampling)}_getTiledLayerMinScale(){let e=this._getLayerLODS();return this.scaleRanges.clampMinScale(e[0].scale)}_getTiledLayerMaxScale(){let e=this._getLayerLODS();return e[e.length-1].scale}_getTiledLayerRealMinScale(){let e=this._getLayerLODS(),i=this.layer,a=i&&"sourceJSON"in i?i.sourceJSON?.tileInfo?.lods??e:e;return this.scaleRanges.clampMinScale(a[0].scale)}_getTiledLayerRealMaxScale(){let e=this._getLayerLODS(),i=this.layer,a=i&&"sourceJSON"in i?i.sourceJSON?.tileInfo?.lods??e:e;return a[a.length-1].scale}_hasTiledLayer(){return!!this._getLayerLODS()}};r([n({readOnly:!0})],s.prototype,"effectiveMaxScale",null),r([n({readOnly:!0})],s.prototype,"effectiveMinScale",null),r([n()],s.prototype,"effectiveMaxScaleLimit",null),r([n()],s.prototype,"effectiveMinScaleLimit",null),r([n()],s.prototype,"layer",void 0),r([n()],s.prototype,"maxScale",null),r([n()],s.prototype,"maxScaleLimit",null),r([n()],s.prototype,"mode",void 0),r([n()],s.prototype,"minScale",null),r([n()],s.prototype,"minScaleLimit",null),r([n()],s.prototype,"scaleRanges",void 0),r([n({type:m})],s.prototype,"sliderViewModel",void 0),r([n({readOnly:!0})],s.prototype,"state",null),r([n()],s.prototype,"view",null),s=r([h("esri.widgets.ScaleRangeSlider.ScaleRangeSliderViewModel")],s);var w=s;export{w as a};
