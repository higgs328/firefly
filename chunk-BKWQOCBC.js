import{a as y,b as G,c as X,d as z,g as M}from"./chunk-3ZJ4NMBE.js";import{a as Q,b as B}from"./chunk-4S7THJAS.js";import{a as l,d as T,e as W}from"./chunk-AYNBEMCC.js";import{a as j}from"./chunk-QCZ3ZIGQ.js";import{a as J,d as A}from"./chunk-ALWV3RJ2.js";import{a as C,b as p,d as b,n as x,u as H,y as R}from"./chunk-6B5XFA6F.js";import{a as S}from"./chunk-PTZYZULI.js";import{l as U}from"./chunk-NMLYCCKN.js";import{a as I}from"./chunk-ZTOZWLEE.js";import{a as u,m as P}from"./chunk-BOVYXYHK.js";var Y=1e-5,N=class{constructor(t){this.options=new X,this._results=new D,this.transform=new Q,this.tolerance=Y,this.verticalOffset=null,this._ray=l(),this._rayEnd=u(),this._rayBeginTransformed=u(),this._rayEndTransformed=u(),this.viewingMode=t??j.Global}get results(){return this._results}get ray(){return this._ray}get rayBegin(){return this._ray.origin}get rayEnd(){return this._rayEnd}reset(t,r,s){this.resetWithRay(W(t,r,this._ray),s)}resetWithRay(t,r){this.camera=r,t!==this._ray&&T(t,this._ray),this.options.verticalOffset!==0?this.viewingMode===j.Local?this._ray.origin[2]-=this.options.verticalOffset:this.verticalOffset=this.options.verticalOffset:this.verticalOffset=null,b(this._rayEnd,this._ray.origin,this._ray.direction),this._results.init(this._ray)}intersect(t=null,r,s,m,n){this.point=r,this.filterPredicate=m,this.tolerance=s??Y;let f=B(this.verticalOffset);if(t&&t.length>0){let o=n?h=>{n(h)&&this.intersectObject(h)}:h=>{this.intersectObject(h)};for(let h of t){let i=h.getSpatialQueryAccelerator?.();i!=null?(f!=null?i.forEachAlongRayWithVerticalOffset(this._ray.origin,this._ray.direction,o,f):i.forEachAlongRay(this._ray.origin,this._ray.direction,o),this.options.selectionMode&&this.options.hud&&i.forEachDegenerateObject(o)):h.objects.forAll(O=>o(O))}}this.sortResults()}intersectObject(t){let r=t.geometries;if(!r)return;let s=t.effectiveTransformation,m=B(this.verticalOffset);for(let n of r){if(!n.visible)continue;let{material:f,id:o}=n;if(!f.visible)continue;this.transform.setAndInvalidateLazyTransforms(s,n.transformation),R(this._rayBeginTransformed,this.rayBegin,this.transform.inverse),R(this._rayEndTransformed,this.rayEnd,this.transform.inverse);let h=this.transform.transform;m!=null&&(m.objectTransform=this.transform),f.intersect(n,this.transform.transform,this,this._rayBeginTransformed,this._rayEndTransformed,(i,O,V,v,L,k)=>{if(i>=0){if(this.filterPredicate!=null&&!this.filterPredicate(this._ray.origin,this._rayEnd,i))return;let e=v?this._results.hud:this._results,w=v?d=>{let q=new z(t,o,V,k);d.set(y.HUD,q,i,O,A,L)}:d=>d.set(y.OBJECT,{object:t,geometryId:o,triangleNr:V},i,O,h,L);if((e.min.drapedLayerOrder==null||L>=e.min.drapedLayerOrder)&&(e.min.dist==null||i<e.min.dist)&&w(e.min),this.options.store!==G.MIN&&(e.max.drapedLayerOrder==null||L<e.max.drapedLayerOrder)&&(e.max.dist==null||i>e.max.dist)&&w(e.max),this.options.store===G.ALL)if(v){let d=new _(this._ray);w(d),this._results.hud.all.push(d)}else{let d=new c(this._ray);w(d),this._results.all.push(d)}}})}}sortResults(t=this._results.all){t.sort((r,s)=>r.dist!==s.dist?(r.dist??0)-(s.dist??0):r.drapedLayerOrder!==s.drapedLayerOrder?Z(r.drapedLayerOrder,s.drapedLayerOrder):Z(r.drapedLayerGraphicOrder,s.drapedLayerGraphicOrder))}};function Z(a,t){return(t??-Number.MAX_VALUE)-(a??-Number.MAX_VALUE)}function dt(a){return new N(a)}var D=class{constructor(){this.min=new c(l()),this.max=new c(l()),this.hud={min:new _(l()),max:new _(l()),all:new Array},this.ground=new c(l()),this.all=[]}init(t){this.min.init(t),this.max.init(t),this.ground.init(t),this.all.length=0,this.hud.min.init(t),this.hud.max.init(t),this.hud.all.length=0}},c=class{get ray(){return this._ray}get distanceInRenderSpace(){return this.dist!=null?(x(E,this.ray.direction,this.dist),C(E)):null}withinDistance(t){return!!M(this)&&this.distanceInRenderSpace<=t}getIntersectionPoint(t){return!!M(this)&&(x(E,this.ray.direction,this.dist),b(t,this.ray.origin,E),!0)}getTransformedNormal(t){return p(g,this.normal),g[3]=0,U(g,g,this.transformation),p(t,g),H(t,t)}constructor(t){this.intersector=y.OBJECT,this.normal=u(),this.transformation=J(),this._ray=l(),this.init(t)}init(t){this.dist=null,this.target=null,this.drapedLayerOrder=null,this.drapedLayerGraphicOrder=null,this.intersector=y.OBJECT,T(t,this._ray)}set(t,r,s,m,n,f,o){this.intersector=t,this.dist=s,p(this.normal,m??P),I(this.transformation,n??A),this.target=r,this.drapedLayerOrder=f,this.drapedLayerGraphicOrder=o}copy(t){T(t.ray,this._ray),this.intersector=t.intersector,this.dist=t.dist,this.target=t.target,this.drapedLayerOrder=t.drapedLayerOrder,this.drapedLayerGraphicOrder=t.drapedLayerGraphicOrder,p(this.normal,t.normal),I(this.transformation,t.transformation)}},_=class extends c{constructor(){super(...arguments),this.intersector=y.HUD}};function lt(a){return new c(a)}var E=u(),g=S();export{Y as a,dt as b,lt as c};
