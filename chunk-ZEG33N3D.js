import{a as b}from"./chunk-QGNMZHDG.js";import{a as h,c as v,d as f,e as I,g as p,i as M,j as C}from"./chunk-GXG4LM3O.js";import{a as T}from"./chunk-7FBNOJXT.js";import{b as g}from"./chunk-AJQXEZB3.js";import{b as m}from"./chunk-6DALCDDU.js";import{l as y}from"./chunk-XR5FT7TQ.js";import{a as d}from"./chunk-2GJBUR2F.js";import{b as S}from"./chunk-YOFFGXOB.js";import{a as N,f as n}from"./chunk-VTHXE323.js";function ie(e){return n(this,null,function*(){let{portalItem:a}=e;!a||a instanceof d||(a=new d(a));let r=yield G(a);return new r.constructor(N({portalItem:a},r.properties))})}function G(e){return n(this,null,function*(){yield e.load();let a=new h;return K(yield P(e,a))})}function P(e,a){return n(this,null,function*(){switch(e.type){case"3DTiles Service":return e.typeKeywords.includes("3DObject")?U():A();case"CSV":return $();case"Feature Collection":return j(e);case"Feature Service":return O(e,a);case"Feed":return Q();case"GeoJson":return J();case"Group Layer":return X();case"Image Service":return V(e,a);case"KML":return R();case"Knowledge Graph Layer":return E();case"Map Service":return D(e,a);case"Media Layer":return Y();case"Scene Service":return W(e,a);case"Stream Service":return k();case"Vector Tile Service":return x();case"WCS":return q();case"WFS":return z();case"WMS":return B();case"WMTS":return H();default:throw new S("portal:unknown-item-type","Unknown item type '${type}'",{type:e.type})}})}function K(e){return n(this,null,function*(){let a=e.className,r=b[a];return{constructor:yield r(),properties:e.properties}})}function D(e,a){return n(this,null,function*(){return(yield Z(e,a))?{className:"TileLayer"}:{className:"MapImageLayer"}})}function O(e,a){return n(this,null,function*(){let r=yield F(e,a);if(typeof r=="object"){let{sourceJSON:t,className:c}=r,o={sourceJSON:t};return r.id!=null&&(o.layerId=r.id),{className:c||"FeatureLayer",properties:o}}return{className:"GroupLayer"}})}function W(e,a){return n(this,null,function*(){let r=yield F(e,a,()=>n(this,null,function*(){try{if(!e.url)return[];let{serverUrl:t}=yield T(e.url,{sceneLayerItem:e});return(yield a.fetchServiceMetadata(t))?.tables??[]}catch{return[]}}));if(typeof r=="object"){let t={},c;if(r.id!=null?(t.layerId=r.id,c=`${e.url}/layers/${r.id}`):c=e.url,e.typeKeywords?.length){for(let s of Object.keys(y))if(e.typeKeywords.includes(s))return{className:y[s]}}let o=yield a.fetchServiceMetadata(c,{customParameters:yield a.fetchCustomParameters(e,s=>f(s)?.customParameters)});return{className:y[o?.layerType]||"SceneLayer",properties:t}}return r===!1&&(yield a.fetchServiceMetadata(e.url))?.layerType==="Voxel"?{className:"VoxelLayer"}:{className:"GroupLayer"}})}function j(e){return n(this,null,function*(){yield e.load();let a=m(e,"Map Notes"),r=m(e,"Markup");if(a||r)return{className:"MapNotesLayer"};if(m(e,"Route Layer"))return{className:"RouteLayer"};let t=yield e.fetchData();return p(t)===1?{className:"FeatureLayer"}:{className:"GroupLayer"}})}function V(e,a){return n(this,null,function*(){yield e.load();let r=e.typeKeywords?.map(L=>L.toLowerCase())??[];if(r.includes("elevation 3d layer"))return{className:"ElevationLayer"};if(r.includes("tiled imagery"))return{className:"ImageryTileLayer"};let t=yield a.fetchItemData(e),c=t?.layerType;if(c==="ArcGISTiledImageServiceLayer")return{className:"ImageryTileLayer"};if(c==="ArcGISImageServiceLayer")return{className:"ImageryLayer"};let o=yield a.fetchServiceMetadata(e.url,{customParameters:yield a.fetchCustomParameters(e)}),s=o.cacheType?.toLowerCase(),l=o.capabilities?.toLowerCase().includes("tilesonly"),i=o.tileInfo?.format?.toLowerCase()??"",u=s==null&&["jpg","jpeg","png","png8","png24","png32","mixed"].includes(i);return s==="map"||u||l?{className:"ImageryTileLayer"}:{className:"ImageryLayer"}})}function k(){return{className:"StreamLayer"}}function x(){return{className:"VectorTileLayer"}}function J(){return{className:"GeoJSONLayer"}}function A(){return{className:"IntegratedMesh3DTilesLayer"}}function U(){return{className:"UnsupportedLayer"}}function $(){return{className:"CSVLayer"}}function R(){return{className:"KMLLayer"}}function E(){return{className:"KnowledgeGraphLayer"}}function q(){return{className:"WCSLayer"}}function z(){return{className:"WFSLayer"}}function B(){return{className:"WMSLayer"}}function H(){return{className:"WMTSLayer"}}function Q(){return{className:"StreamLayer"}}function X(){return{className:"GroupLayer"}}function Y(){return{className:"MediaLayer"}}function Z(e,a){return n(this,null,function*(){let{tileInfo:r}=yield a.fetchServiceMetadata(e.url,{customParameters:yield a.fetchCustomParameters(e)});return r})}function F(e,a,r){return n(this,null,function*(){let{url:t,type:c}=e,o=c==="Feature Service";if(!t)return{};if(/\/\d+$/.test(t)){if(o){let i=yield a.fetchServiceMetadata(t,{customParameters:yield a.fetchCustomParameters(e,u=>f(u)?.customParameters)});return{id:i.id,className:g(i.type),sourceJSON:i}}return{}}yield e.load();let s=yield a.fetchItemData(e);if(o){let i=yield v(s,t,a),u=w(i);if(typeof u=="object"){let L=I(i,u.id);u.className=M(L?.layerType)}return u}if(c==="Scene Service"&&(s=yield C(e,s,a)),p(s)>0)return w(s);let l=yield a.fetchServiceMetadata(t);return r&&(l.tables=yield r()),w(l)})}function w(e){return p(e)===1&&{id:f(e)?.id}}export{ie as a,P as b};
