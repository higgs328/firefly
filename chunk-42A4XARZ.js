import{a as F}from"./chunk-AXZXNRJJ.js";import{a as U,d as b}from"./chunk-CZMBPC27.js";import{a as O,r as N,v as D}from"./chunk-X7BNFUFQ.js";import{i as T,j as S,l as w}from"./chunk-HM5RIVQC.js";import{g as P}from"./chunk-HX2VGIR2.js";import{ca as H}from"./chunk-NJWTSROP.js";import{a as v}from"./chunk-BAEF3CT6.js";import{b as x}from"./chunk-ACP3S2CH.js";import{g as G}from"./chunk-XRGPJ3QY.js";import{y as M}from"./chunk-QBWJMFH5.js";import{a as E,b as y}from"./chunk-VTHXE323.js";var W,B,K,V,z,X,_,Y,$;(function(t){t[t.FILL=0]="FILL",t[t.LINE=1]="LINE",t[t.MARKER=2]="MARKER",t[t.TEXT=3]="TEXT",t[t.LABEL=4]="LABEL"})(W||(W={})),function(t){t[t.NONE=0]="NONE",t[t.MAP=1]="MAP",t[t.LABEL=2]="LABEL",t[t.LABEL_ALPHA=4]="LABEL_ALPHA",t[t.HITTEST=8]="HITTEST",t[t.HIGHLIGHT=16]="HIGHLIGHT",t[t.CLIP=32]="CLIP",t[t.DEBUG=64]="DEBUG",t[t.NUM_DRAW_PHASES=9]="NUM_DRAW_PHASES"}(B||(B={})),function(t){t[t.SIZE=0]="SIZE",t[t.COLOR=1]="COLOR",t[t.OPACITY=2]="OPACITY",t[t.ROTATION=3]="ROTATION"}(K||(K={})),function(t){t[t.MINMAX_TARGETS_OUTLINE=128]="MINMAX_TARGETS_OUTLINE",t[t.SCALE_TARGETS_OUTLINE=256]="SCALE_TARGETS_OUTLINE",t[t.FIELD_TARGETS_OUTLINE=512]="FIELD_TARGETS_OUTLINE",t[t.UNIT_TARGETS_OUTLINE=1024]="UNIT_TARGETS_OUTLINE"}(V||(V={})),function(t){t[t.SPRITE=0]="SPRITE",t[t.GLYPH=1]="GLYPH"}(z||(z={})),function(t){t[t.DEFAULT=0]="DEFAULT",t[t.SIMPLE=1]="SIMPLE",t[t.DOT_DENSITY=2]="DOT_DENSITY",t[t.OUTLINE_FILL=3]="OUTLINE_FILL",t[t.OUTLINE_FILL_SIMPLE=4]="OUTLINE_FILL_SIMPLE",t[t.HEATMAP=5]="HEATMAP",t[t.PIE_CHART=6]="PIE_CHART"}(X||(X={})),function(t){t[t.All=0]="All",t[t.Highlight=1]="Highlight",t[t.InsideEffect=2]="InsideEffect",t[t.OutsideEffect=3]="OutsideEffect"}(_||(_={})),function(t){t[t.BATCHING=0]="BATCHING",t[t.STRICT_ORDER=1]="STRICT_ORDER",t[t.STRICT_MARKERS_AND_TEXT=2]="STRICT_MARKERS_AND_TEXT"}(Y||(Y={})),function(t){t[t.FILL=0]="FILL",t[t.LINE=1]="LINE",t[t.MARKER=2]="MARKER",t[t.TEXT=3]="TEXT"}($||($={}));var k={color:{write:[!0,!0,!0,!0],blendMode:"composite"},depth:!1,stencil:{write:!1,test:{ref:t=>t.stencilRef,compare:T.EQUAL,mask:255,op:{fail:S.KEEP,zFail:S.KEEP,zPass:S.REPLACE}}}},Q={color:{write:[!0,!0,!0,!0],blendMode:"additive"},depth:!1,stencil:!1},tt=y(E({},k),{color:{write:[!0,!0,!0,!0],blendMode:"delete"}});function et({pixelRatio:t,state:e,displayLevel:o,requiredLevel:i},r){let u=1/2**(o-r.key.level),a=1/2**(i-r.key.level);return{displayMat3:e.displayMat3,displayViewMat3:e.displayViewMat3,displayViewScreenMat3:r.transforms.displayViewScreenMat3,viewMat3:e.viewMat3,tileMat3:r.transforms.tileMat3,displayZoomFactor:u,requiredZoomFactor:a,tileOffset:[r.x,r.y],currentScale:e.scale,currentZoom:o,metersPerSRUnit:H(e.spatialReference),rotation:e.rotation,pixelRatio:t}}function q(t){return t.passOptions?.type==="highlight"}function J(t){return t.passOptions?.type==="hittest"}function it(t){if(!J(t))return null;let{position:e,distance:o,smallSymbolDistance:i,smallSymbolSizeThreshold:r}=t.passOptions;return{position:e,distance:o,smallSymbolDistance:i,smallSymbolSizeThreshold:r}}function ot(t){if(!q(t))return null;let{activeReasons:e,highlightAll:o}=t.passOptions;return{activeReasons:e,highlightAll:o?1:0}}function dt(t,e,o){let i={};for(let r in o)o[r]instanceof Function?i[r]=o[r](t,e):i[r]=o[r];return i}function ft(t,e){let{attributeView:o,context:i}=t;return{storage:o.getUniforms(i),view:et(t,e),hittestRequest:it(t),highlight:ot(t)}}function mt(t){return{inside:t.selection===_.InsideEffect,outside:t.selection===_.OutsideEffect}}function j(t){return J(t)?Q:q(t)&&t.passOptions.stepType==="clear"?tt:k}function Et(t){let{row:e,col:o}=t.key,i=o*512,r=e*512;return{tileOffsetFromLocalOrigin:[i%O,r%O],maxIntsToLocalOrigin:[Math.floor(i/O),Math.floor(r/O)]}}var At=[0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1],Ot=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],L=256;var R=()=>G.getLogger("esri.views.2d.engine.webgl.painter.highlight.HighlightGradient");function nt(t,e){e.fillColor[0]=t.color.r/255,e.fillColor[1]=t.color.g/255,e.fillColor[2]=t.color.b/255,e.fillColor[3]=t.color.a,t.haloColor?(e.outlineColor[0]=t.haloColor.r/255,e.outlineColor[1]=t.haloColor.g/255,e.outlineColor[2]=t.haloColor.b/255,e.outlineColor[3]=t.haloColor.a):(e.outlineColor[0]=e.fillColor[0],e.outlineColor[1]=e.fillColor[1],e.outlineColor[2]=e.fillColor[2],e.outlineColor[3]=e.fillColor[3]),e.fillColor[3]*=t.fillOpacity,e.outlineColor[3]*=t.haloOpacity,e.fillColor[0]*=e.fillColor[3],e.fillColor[1]*=e.fillColor[3],e.fillColor[2]*=e.fillColor[3],e.outlineColor[0]*=e.outlineColor[3],e.outlineColor[1]*=e.outlineColor[3],e.outlineColor[2]*=e.outlineColor[3],e.outlineWidth=(1-t.haloBlur)*t.haloWidth,e.outerHaloWidth=t.haloBlur*t.haloWidth/2,e.innerHaloWidth=t.haloBlur*t.haloWidth/2,e.outlinePosition=0}var lt=[0,0,0,0],A=class{constructor(){this.type="single",this._highlightOptions=new F,this._convertedHighlightOptions={fillColor:[0,0,0,0],outlineColor:[0,0,0,0],outlinePosition:0,outlineWidth:0,innerHaloWidth:0,outerHaloWidth:0},this._optionsShadeTexKey="",this._texelData=new Uint8Array(4*L),this._minMaxDistance=[0,0]}setHighlightOptions(e){this._highlightOptions=e}applyHighlightOptions(e,o){this._updateGradientTexture(e),e.bindTexture(this._shadeTex,N),o.setUniform2fv("u_minMaxDistance",this._minMaxDistance)}destroy(){this._shadeTex?.dispose(),this._shadeTex=null}getReasonsWithGradients(){return[{activeReasons:(1<<D)-1,activeGradient:this}]}_updateGradientTexture(e){let o=st(this._highlightOptions);if(o===this._optionsShadeTexKey)return;this._optionsShadeTexKey=o,nt(this._highlightOptions,this._convertedHighlightOptions);let i=this._convertedHighlightOptions,r=i.outlinePosition-i.outlineWidth/2-i.outerHaloWidth,u=i.outlinePosition-i.outlineWidth/2,a=i.outlinePosition+i.outlineWidth/2,c=i.outlinePosition+i.outlineWidth/2+i.innerHaloWidth,l=Math.sqrt(Math.PI/2)*1,s=Math.abs(r)>l?Math.round(10*(Math.abs(r)-l))/10:0,g=Math.abs(c)>l?Math.round(10*(Math.abs(c)-l))/10:0,p;s&&!g?R().error("The outer rim of the highlight is "+s+"px away from the edge of the feature; consider reducing some width values or shifting the outline position towards positive values (inwards)."):!s&&g?R().error("The inner rim of the highlight is "+g+"px away from the edge of the feature; consider reducing some width values or shifting the outline position towards negative values (outwards)."):s&&g&&R().error("The highlight is "+Math.max(s,g)+"px away from the edge of the feature; consider reducing some width values.");let n=[void 0,void 0,void 0,void 0];function d(h,I,f){n[0]=(1-f)*h[0]+f*I[0],n[1]=(1-f)*h[1]+f*I[1],n[2]=(1-f)*h[2]+f*I[2],n[3]=(1-f)*h[3]+f*I[3]}let{_texelData:m}=this;for(let h=0;h<L;++h)p=r+h/(L-1)*(c-r),p<r?(n[0]=0,n[1]=0,n[2]=0,n[3]=0):p<u?d(lt,i.outlineColor,(p-r)/(u-r)):p<a?[n[0],n[1],n[2],n[3]]=i.outlineColor:p<c?d(i.outlineColor,i.fillColor,(p-a)/(c-a)):[n[0],n[1],n[2],n[3]]=i.fillColor,m[4*h]=255*n[0],m[4*h+1]=255*n[1],m[4*h+2]=255*n[2],m[4*h+3]=255*n[3];if(this._minMaxDistance[0]=r,this._minMaxDistance[1]=c,!this._shadeTex){let h=new U;h.wrapMode=w.CLAMP_TO_EDGE,h.width=L,h.height=1,this._shadeTex=new b(e,h)}this._shadeTex.updateData(0,0,0,L,1,this._texelData)}};function st(t){return`${t.color};${t.haloColor};${t.haloOpacity};${t.fillOpacity};${t.haloWidth};${t.haloBlur}`}var C=class{constructor(){this.type="multi",this.gradients=[]}setHighlightOptions(e){for(let o=0;o<e.length;o++)this.gradients[o]||(this.gradients[o]=new A),this.gradients[o].setHighlightOptions(e[o]);for(let o=e.length+1;o<this.gradients.length;o++)this.gradients[o].destroy();this.gradients.length=e.length}destroy(){for(let e of this.gradients)e.destroy()}getReasonsWithGradients(){let e=1,o=[];for(let i=0;i<this.gradients.length;i++){let r=this.gradients[i];o.push({activeReasons:e,activeGradient:r}),e<<=1}return o}};var at=new v({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryMultiPatch:"multipatch",mesh:"mesh"});function Wt(t){return at.toJSON(t)}function Bt(t,e,o){let i=[],r=[],u=0,a=0;for(let c of t){let l=a,s=c[0][0],g=c[0][1];i[a++]=s,i[a++]=g;let p=0;for(let n=1;n<c.length;++n){let d=s,m=g;s=c[n][0],g=c[n][1],p+=g*d-s*m,i[a++]=s,i[a++]=g}e(p/2),p>0?(l-u>0&&(o(u,l,i,r),u=l),r.length=0):p<0&&l-u>0?r.push(.5*(l-u)):a=l}a-u>0&&o(u,a,i,r)}function Kt(t){let{bandCount:e,attributeTable:o,colormap:i,pixelType:r}=t.raster.rasterInfo;return e===1&&(o!=null||i!=null||r==="u8"||r==="s8")}function Vt(t,e){return e==null?(t?.destroy(),null):(t?.type==="single"&&Array.isArray(e)&&(t.destroy(),t=null),t?.type!=="multi"||Array.isArray(e)||(t.destroy(),t=null),t||(t=Array.isArray(e)?new C:new A),Array.isArray(e)?t.type==="multi"&&t.setHighlightOptions(e):t.type==="single"&&t.setHighlightOptions(e),t)}function zt(t,e,o,i){let{painter:r,highlightGradient:u}=t,{highlight:a}=r.effects;if(!u)return;let c=t.passOptions,l=u.getReasonsWithGradients();for(let s=0;s<l.length;s++){let g=y(E({},t),{passOptions:{type:"highlight",activeGradient:i!=null?l[i].activeGradient:l[s].activeGradient,activeReasons:l[s].activeReasons,stepType:"burn",highlightAll:e}});if(a.bind(g),o(g),s<l.length-1){let n=0;for(let d=s+1;d<l.length;d++)n|=l[d].activeReasons;o(y(E({},t),{passOptions:{type:"highlight",activeGradient:i!=null?l[i].activeGradient:l[s].activeGradient,activeReasons:n,stepType:"clear",highlightAll:e}}))}let p=y(E({},t),{passOptions:{type:"highlight",activeGradient:i!=null?l[i].activeGradient:l[s].activeGradient,activeReasons:l[s].activeReasons,stepType:"draw",highlightAll:e}});r.setPipelineState(j(t)),r.updatePipelineState(t.context),a.draw(p),a.unbind()}t.passOptions=c}function Xt(t){if(!t)return[];let e=P(t)?[t]:x.isCollection(t)?t.toArray():Array.isArray(t)?t:[];return e=e?.filter(M),(e?.length??0)===0?[]:e}export{At as a,Ot as b,B as c,K as d,z as e,_ as f,Y as g,$ as h,et as i,q as j,J as k,dt as l,ft as m,mt as n,j as o,Et as p,Wt as q,Bt as r,Kt as s,Vt as t,zt as u,Xt as v};
