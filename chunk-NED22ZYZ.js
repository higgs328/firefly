import{a as _}from"./chunk-4ITLBBRT.js";import{c as r,d as s}from"./chunk-SJQJMVOJ.js";import{a as l}from"./chunk-KQDXCPD7.js";import{a as p}from"./chunk-2JW3DUYT.js";import{d as i}from"./chunk-4JIR4MZV.js";import{a as o}from"./chunk-63BBKXWS.js";import{c as h}from"./chunk-VIEK2X23.js";import{a}from"./chunk-QGVBCWUY.js";import{l as d}from"./chunk-5QEXLALV.js";var n=class extends l{constructor(e){super(e),this._addVertexOnPointerUp=!1,this._drawTool=null}initialize(){this._addViewHandles(),this.view.type==="3d"&&this._addDrawTool()}destroy(){this._removeDrawTool(),this.emit("destroy")}complete(){this._completeDrawing()}_addViewHandles(){this._addViewHandles2DOnly(),this.addHandles([this.view.on("key-down",e=>{e.key===p.complete&&(this._drawTool?this.complete():(this._abortSnapping(),this._vertexAddHandler(e)))},i.TOOL)])}_addViewHandles2DOnly(){this.view.type==="2d"&&this.addHandles([this.view.on("pointer-down",e=>{this._shouldHandlePointerEvent(e)&&(this._abortSnapping(),this._activePointerId=e.pointerId,this._addVertexOnPointerUp=!0,this._cursorScreenPoint=o(e),e.pointerType==="touch"&&this._updateCursor())},i.TOOL),this.view.on("pointer-move",e=>{this._abortSnapping(),this._cursorScreenPoint=o(e),e.pointerType!=="touch"&&this._updateCursor()},i.TOOL),this.view.on("pointer-drag",e=>{this._shouldHandlePointerEvent(e)&&(this._abortSnapping(),this._addVertexOnPointerUp=!1)},i.TOOL),this.view.on("pointer-up",e=>{if(this._shouldHandlePointerEvent(e))if(this._abortSnapping(),this._activePointerId=null,this._addVertexOnPointerUp)e.stopPropagation(),this._vertexAddHandler(e);else{let t=e.pointerType==="touch";this._updateCursor(t)}},i.TOOL),this.view.on("drag",["Shift"],e=>{e.stopPropagation()},i.TOOL)])}_addDrawTool(){let e=new _({view:this.view,elevationInfo:this.elevationInfo,hasZ:this.hasZ,geometryType:"point",mode:"click"});this._drawTool=e,this.view.addAndActivateTool(e),this.addHandles([e.on("cursor-update",t=>{t.vertices.length===1&&this.emit("cursor-update",new r(this.view,t.vertices[0].vertexIndex,e.getVertexCoords()))}),e.on("complete",t=>{this.emit("draw-complete",new s(e.getVertexCoords())),this._removeDrawTool(),this.removeAllHandles()})])}_removeDrawTool(){this._drawTool&&(this.view.tools.remove(this._drawTool),this._drawTool=null)}_addVertex(e){let t=this._coordinateHelper.arrayToVector(e);this._isDuplicateOfLastVertex(t)||(this._lastVertexUnsnapped=this._stagedVertexUnsnapped,this._popCursorVertex(),this._editGeometryOperations.appendVertex(t),this.notifyChange("vertices"),this._completeDrawing())}_updateCursor(e=!1){if(this._popCursorVertex(),!this._cursorScreenPoint)return;let t=this.getCoordsAndPointFromScreenPoint(this._cursorScreenPoint);t==null||e||this._pushCursorVertex(t.vertex,()=>this.emit("cursor-update",new r(this.view,this._activeComponent.vertices.length,this.vertices,this._stagedVertex!=null?new h(this._stagedVertex):null)))}_completeDrawing(){if(this._drawTool)return void this._drawTool.completeCreateOperation();this._activePointerId=null,this._popCursorVertex(),this._abortSnapping(),this._snappingManager!=null&&this._snappingManager.doneSnapping();let e=new s(this.vertices);this.emit("draw-complete",e),e.defaultPrevented||this.removeAllHandles()}};n=a([d("esri.views.draw.PointDrawAction")],n);var C=n;export{C as a};
