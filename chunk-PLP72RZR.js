import{a as v}from"./chunk-XLLZ5QPN.js";import{a as b}from"./chunk-FHBFWDFD.js";import{a as M}from"./chunk-AXYQJCCX.js";import{a as d}from"./chunk-5XCFNEYX.js";import{a as C}from"./chunk-GQL2MBZT.js";import{f as x}from"./chunk-FB4M3WPV.js";import{a as F}from"./chunk-7P44K2YD.js";import{a as o}from"./chunk-QGVBCWUY.js";import{e as l}from"./chunk-NFIPKH6V.js";import{l as w}from"./chunk-5QEXLALV.js";var L,c="esri-histogram",u={base:c,horizontalLayout:`${c}--horizontal`,verticalLayout:`${c}--vertical`,content:`${c}__content`,svg:`${c}__svg`,bar:`${c}__bar`,bars:`${c}__bars`,label:`${c}__label`,dataLines:`${c}__data-lines`,dataLinesSubgroup:`${c}__data-lines-subgroup`,dataLine:`${c}__data-line`,averageLabel:`${c}__average-label`,averageDataLine:`${c}__average-data-line`,averageSymbol:`${c}__average-symbol`},s=L=class extends C{constructor(e,t){super(e,t),this._bgFillId=`${this.id}-bg-fill`,this._containerNode=null,this._containerDimensions={width:0,height:0},this._defaultBarColor="#d8d8d8",this.barCreatedFunction=null,this.dataLines=null,this.dataLineCreatedFunction=null,this.dataLineUpdatedFunction=null,this.messages=null,this.viewModel=new v}get average(){return this.viewModel.average}set average(e){this.viewModel.average=e}get bins(){return this.viewModel.bins}set bins(e){this.viewModel.bins=e}get icon(){return"graph-histogram"}set icon(e){this._overrideIfSome("icon",e)}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get labelFormatFunction(){return this.viewModel.labelFormatFunction}set labelFormatFunction(e){this.viewModel.labelFormatFunction=e}set layout(e){e!=="vertical"&&(e="horizontal"),this._set("layout",e)}get max(){return this.viewModel.max}set max(e){this.viewModel.max=e}get min(){return this.viewModel.min}set min(e){this.viewModel.min=e}get state(){return this.viewModel.state}static fromHistogramResult(e){let{bins:t,maxValue:i,minValue:a}=e;return new L({bins:t,max:i,min:a})}render(){let{label:e,layout:t,state:i}=this,a=this.classes(u.base,b.widget,t==="horizontal"?u.horizontalLayout:u.verticalLayout,i==="disabled"?b.disabled:null);return d("div",{afterCreate:this._afterContainerNodeCreate,"aria-label":e,bind:this,class:a},i==="ready"?this._renderContent():null)}_renderContent(){if(!this._containerNode)return;let e=this._bgFillId,t=`clip-path: url(#${e})`;return d("div",{class:u.content},d("svg",{class:u.svg,xmlns:"http://www.w3.org/2000/svg"},d("defs",null,this._renderFillDefinition(e)),d("g",{style:t},this._renderBarsGroup()),this._renderLinesGroup()))}_renderBarsGroup(){return d("g",{class:this.classes(u.bars)},this._renderBars())}_renderBars(){let{layout:e,viewModel:{binRange:t,range:i}}=this;if(!t||!i)return;let a=t/i,{width:r,height:n}=this._containerDimensions;if(n===0&&r===0)return;if(n===0&&r!==0)return void this.scheduleRender();let[h,g]=e==="vertical"?[n*a,r]:[n,r*a];return this._getBarDimensions(h,g).map(([p,m],_)=>this._renderBar(_,p,m))}_renderBar(e,t,i){let{bins:a,layout:r,max:n,messages:h,viewModel:{range:g}}=this;if(!a||n==null)return;let{width:p,height:m}=this._containerDimensions,_=a.slice()[e],{count:S,maxValue:f,minValue:$}=_,y=n-f,[B,D]=r==="vertical"?[0,y*(m/g)]:[p-i-y*(p/g),m-t],N=F(h.barLabel,{count:S,maxValue:f,minValue:$});return d("rect",{afterCreate:this._afterBarCreate,"aria-label":N,bind:this,class:u.bar,"data-index":e,fill:this._defaultBarColor,height:t,role:"img","shape-rendering":"crispEdges","stroke-width":"0",width:i,x:B,y:D})}_renderLinesGroup(){return d("g",{class:this.classes(u.dataLines)},this._renderAverageLine(),this._renderCustomLines())}_renderAverageLine(){let{average:e}=this;if(e==null)return;let t=[d("tspan",{class:this.classes(u.averageSymbol)},"x\u0304 "),d("tspan",{class:this.classes(u.averageLabel)},this.labelFormatFunction?this.labelFormatFunction(e,"average"):e)];return d("g",{afterCreate:this._afterLinesSubgroupCreate,afterUpdate:this._afterLinesSubgroupUpdate,bind:this,class:this.classes(u.dataLinesSubgroup)},d("title",{key:"title"},e),this._renderLine(e,this.classes(u.averageDataLine)),this._renderLabel({label:t,value:e}))}_renderCustomLines(){if(this.dataLines?.length)return this.dataLines.map((e,t)=>this._renderLineSubgroup(e,t))}_renderLineSubgroup(e,t){let{value:i}=e;return d("g",{afterCreate:this._afterLinesSubgroupCreate,afterUpdate:this._afterLinesSubgroupUpdate,bind:this,class:this.classes(u.dataLinesSubgroup),"data-index":t},d("title",{key:"title"},i),this._renderLine(i),this._renderLabel(e))}_renderLine(e,t){let[i,a,r,n]=this._getLinePosition(e);return d("line",{class:this.classes(u.dataLine,t),"shape-rendering":"crispEdges",x1:i,x2:a,y1:r,y2:n})}_renderLabel(e,t){let{label:i,value:a}=e,[r,n]=this._getLabelPosition(a);return d("text",{class:this.classes(u.label,t),"text-anchor":"end",transform:this.layout==="horizontal"?"rotate(270)":null,x:r,y:n-2},i??"")}_renderFillDefinition(e){let{width:t,height:i}=this._containerDimensions;return d("clipPath",{id:e},d("rect",{height:i,width:t,x:"0",y:"0"}))}_afterContainerNodeCreate(e){this._containerNode=e,this.addHandles(x(e,t=>{let{width:i,height:a}=t.contentRect;this._containerDimensions={width:i,height:a}}))}_getIndexFromElement(e){let t=e.dataset?.index,i=e.getAttribute("data-index");return t!=null?parseInt(t,10):i!=null?parseInt(i,10):null}_afterBarCreate(e){if(this.barCreatedFunction){let t=this._getIndexFromElement(e)??-1;this.barCreatedFunction(t,e)}}_afterLinesSubgroupCreate(e){if(this.dataLineCreatedFunction){let t=this._getIndexFromElement(e),i=e.childNodes[1],a=e.childNodes[2]?e.childNodes[2]:null;this.dataLineCreatedFunction(i,a,t)}}_afterLinesSubgroupUpdate(e){if(this.dataLineUpdatedFunction){let t=this._getIndexFromElement(e),i=e.childNodes[1],a=e.childNodes[2]?e.childNodes[2]:null;this.dataLineUpdatedFunction(i,a,t)}}_getBarDimensions(e,t){let{bins:i,layout:a}=this,r=i?i.map(h=>h.count):[],n=Math.max.apply(Math,r);return r.map(h=>a==="vertical"?[e/r.length,n!==0?h/n*t:0]:[n!==0?h/n*e:0,t/r.length])}_getLinePosition(e){let{layout:t,min:i,viewModel:{range:a}}=this;if(i==null)return[0,0,0,0];let r=Math.round((e-i)/a*100)/100,{width:n,height:h}=this._containerDimensions,[g,p]=[r*n||1,h-r*h||1];return t==="vertical"?[0,"100%",p,p]:[g,g,"100%",0]}_getLabelPosition(e){let{layout:t,min:i,viewModel:{range:a}}=this;if(i==null)return[0,0];let r=Math.round((e-i)/a*100)/100,{width:n,height:h}=this._containerDimensions;return t==="vertical"?[n,h-r*h]:[0,r*n]}};o([l()],s.prototype,"_bgFillId",void 0),o([l()],s.prototype,"_containerNode",void 0),o([l()],s.prototype,"_containerDimensions",void 0),o([l()],s.prototype,"_defaultBarColor",void 0),o([l()],s.prototype,"average",null),o([l()],s.prototype,"barCreatedFunction",void 0),o([l()],s.prototype,"dataLines",void 0),o([l()],s.prototype,"dataLineCreatedFunction",void 0),o([l()],s.prototype,"dataLineUpdatedFunction",void 0),o([l()],s.prototype,"icon",null),o([l()],s.prototype,"label",null),o([l()],s.prototype,"labelFormatFunction",null),o([l({value:"horizontal"})],s.prototype,"layout",null),o([l()],s.prototype,"max",null),o([l(),M("esri/widgets/Histogram/t9n/Histogram")],s.prototype,"messages",void 0),o([l()],s.prototype,"min",null),o([l({readOnly:!0})],s.prototype,"state",null),o([l({type:v})],s.prototype,"viewModel",void 0),s=L=o([w("esri.widgets.Histogram")],s);var J=s;export{J as a};
