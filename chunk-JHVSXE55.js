import{c as E,q as C}from"./chunk-EB24NRSQ.js";import{a as y}from"./chunk-W3HCXOXG.js";import{b as z}from"./chunk-ZYYN4NWF.js";import{g as b}from"./chunk-QXSQOLB3.js";import{b as g,c as x,d as S,e as v}from"./chunk-D6N4VI5S.js";import{a as u}from"./chunk-342NGUMP.js";import{a as f}from"./chunk-QCZ3ZIGQ.js";import{b as l}from"./chunk-4NUW747S.js";import{m as d}from"./chunk-GJ2QRXGN.js";import{a as s}from"./chunk-RWCIDBNQ.js";import{c}from"./chunk-6B5XFA6F.js";import{c as n}from"./chunk-PTZYZULI.js";import{a as o,m as a}from"./chunk-NMLYCCKN.js";import{a as _}from"./chunk-BOVYXYHK.js";import{b as p}from"./chunk-EQZWYK27.js";var I=class extends y{constructor(e){super(e),this._material=null,this._texture=null,this._geometry=null,this._size=3,this._color=n(1,0,1,1),this._pixelSnappingEnabled=!0,this._primitive="square",this._outlineSize=1,this._outlineColor=n(1,1,1,1),this._elevationInfo=null,this.applyProperties(e)}get geometry(){return this._geometry}set geometry(e){this._geometry=e,this.recreateGeometry()}get size(){return this._size}set size(e){if(e!==this._size){let t=this._preferredTextureSize;this._size=e,t<this._preferredTextureSize?this.recreate():this._updateSizeAttribute()}}get color(){return this._color}set color(e){a(e,this._color)||(o(this._color,e),this._updateMaterial())}get pixelSnappingEnabled(){return this._pixelSnappingEnabled}set pixelSnappingEnabled(e){this._pixelSnappingEnabled!==e&&(this._pixelSnappingEnabled=e,this._updateMaterial())}get primitive(){return this._primitive}set primitive(e){this._primitive!==e&&(this._primitive=e,this.recreate())}get outlineSize(){return this._outlineSize}set outlineSize(e){e!==this._outlineSize&&(this._outlineSize=e,this._updateMaterial())}get outlineColor(){return this._outlineColor}set outlineColor(e){a(e,this._outlineColor)||(o(this._outlineColor,e),this._updateMaterial())}get elevationInfo(){return this._elevationInfo}set elevationInfo(e){this._elevationInfo=e,this.recreateGeometry()}_updateMaterial(){this._material?.setParameters(this._materialParameters)}_updateSizeAttribute(){let e=this.object;if(e==null)return;let t=e.geometries[0];if(t==null)return;let i=t.getMutableAttribute(s.SIZE).data,r=this._geometrySize;i[0]=r,i[1]=r,e.geometryVertexAttributeUpdated(e.geometries[0],s.SIZE)}get _materialParameters(){return{color:this._color,textureIsSignedDistanceField:!0,sampleSignedDistanceFieldTexelCenter:S(this._primitive),distanceFieldBoundingBox:x,occlusionTest:!1,outlineColor:this._outlineColor,outlineSize:this._outlineSize,textureId:this._texture?.id,polygonOffset:!1,shaderPolygonOffset:0,drawAsLabel:!0,depthEnabled:!1,pixelSnappingEnabled:this.pixelSnappingEnabled,isDecoration:this.isDecoration}}get _geometrySize(){return this._size/g}createExternalResources(){this._texture=v(this._primitive,this._preferredTextureSize),this._material=new z(this._materialParameters,this.view.state.viewingMode===f.Global);let e=this.view._stage;this._texture.load(e.renderView.renderingContext),e.add(this._texture)}destroyExternalResources(){this._texture&&(this.view._stage.remove(this._texture),this._texture.dispose(),this._texture=null),this._material=null}createGeometries(e){let t=this._createRenderGeometry();t!=null&&e.addGeometry(t)}forEachExternalMaterial(e){this._material&&e(this._material)}get _preferredTextureSize(){return p(2*this._geometrySize,16,128)}calculateMapBounds(e){let t=this.object?.geometries[0];if(!t)return!1;let i=t.attributes.get(s.POSITION).data;return u(i,this.view.renderCoordsHelper.spatialReference,w,this.view.spatialReference),d(e,w),!0}_createRenderGeometry(){let{geometry:e,_material:t}=this;if(e==null||t==null)return null;let{renderCoordsHelper:i,elevationProvider:r}=this.view,M=E(e,r,C.fromElevationInfo(this.elevationInfo),i),P=c(l.get(),e.x,e.y,M),h=l.get();u(P,e.spatialReference,h,i.spatialReference);let m=this._geometrySize;return b(t,{position:h,size:[m,m],centerOffsetAndDistance:[0,0,0,1]})}},w=_();export{I as a};
