import{f as P}from"./chunk-F5AJITOA.js";import{b as E,k as Y}from"./chunk-3CLJ5OX5.js";import{e as q,f as G}from"./chunk-73K3NWCV.js";import{e as S}from"./chunk-SP2CO3KX.js";import{W,_ as B,da as _}from"./chunk-KALOJIUA.js";import{b as L}from"./chunk-KMMTNF7G.js";import{a as R}from"./chunk-OLOKUDVI.js";import{a as v}from"./chunk-DYTVXYAV.js";import{c as D}from"./chunk-VIEK2X23.js";import{a as C}from"./chunk-7F5DJLJT.js";import{f as U,s as A}from"./chunk-NJWTSROP.js";import{b as y}from"./chunk-YOFFGXOB.js";import{a as V,b as z,f as O}from"./chunk-VTHXE323.js";var $=null,H=/^(?<hh>([0-1][0-9])|([2][0-3])):(?<mm>[0-5][0-9])(:(?<ss>[0-5][0-9]))?([.](?<ms>\d+))?$/;function K(t,e,n){return t.x<0?t.x+=e:t.x>n&&(t.x-=e),t}function me(t,e,n,i){let r=A(n)?U(n):null,l=r?Math.round((r.valid[1]-r.valid[0])/e.scale[0]):null;return t.map(u=>{let f=new D(u.geometry);return S(e,f,f),u.geometry=r?K(f,l??0,i[0]):f,u})}function de(t,e=18,n,i,r){let l=new Float64Array(i*r);e=Math.round(R(e));let u=Number.POSITIVE_INFINITY,f=Number.NEGATIVE_INFINITY,c=G(n);for(let{geometry:m,attributes:d}of t){let{x:s,y:a}=m,h=Math.max(0,s-e),T=Math.max(0,a-e),j=Math.min(r,a+e),w=Math.min(i,s+e),x=+c(d);for(let g=T;g<j;g++)for(let F=h;F<w;F++){let N=g*i+F,I=q(F-s,g-a,e)*x,p=l[N]+=I;u=Math.min(u,p),f=Math.max(f,p)}}return{min:u,max:f}}function Q(t){let e=H.exec(t);if(!e)return null;let{hh:n,mm:i,ss:r,ms:l}=e.groups;return Number(n)*v.hours+Number(i)*v.minutes+Number(r)*v.seconds+Number(l||0)}function pe(t,e,n=!0){return O(this,null,function*(){if(!e)return[];let{field:i,field2:r,field3:l,fieldDelimiter:u,fieldInfos:f,timeZone:c}=t,m=i&&f?.find(p=>p.name.toLowerCase()===i.toLowerCase()),d=!!m&&_(m),s=!!m&&P(m),a=t.valueExpression,h=t.normalizationType,T=t.normalizationField,j=t.normalizationTotal,w=[],x=t.viewInfoParams,g=null,F=null;if(a){if(!$){let{arcadeUtils:p}=yield L();$=p}$.hasGeometryOperations(a)&&(yield $.enableGeometryOperations()),g=$.createFunction(a),F=x?$.getViewInfo({viewingMode:x.viewingMode,scale:x.scale,spatialReference:new C(x.spatialReference)}):null}let N=t.fieldInfos,I=!(e[0]&&"declaredClass"in e[0]&&e[0].declaredClass==="esri.Graphic")&&N?{fields:N}:null;return e.forEach(p=>{let b=p.attributes,o;if(a){let M=I?z(V({},p),{layer:I}):p,k=$.createExecContext(M,F,c);o=$.executeFunction(g,k)}else b&&(o=b[i],r?(o=`${E(o)}${u}${E(b[r])}`,l&&(o=`${o}${u}${E(b[l])}`)):typeof o=="string"&&n&&(s?o=o?new Date(o).getTime():null:d&&(o=o?Q(o):null)));if(h&&typeof o=="number"&&isFinite(o)){let M=b&&parseFloat(b[T]);o=Y(o,h,M,j)}w.push(o)}),w})}function he(t){let e=t.field,n=t.normalizationType,i=t.normalizationField,r;return n==="field"?r="(NOT "+i+" = 0)":n!=="log"&&n!=="natural-log"&&n!=="square-root"||(r=`(${e} > 0)`),r}function ye(t,e,n){let i=e!=null?t+" >= "+e:"",r=n!=null?t+" <= "+n:"",l="";return l=i&&r?Z(i,r):i||r,l?"("+l+")":""}function $e(t,e,n,i){let r;return e?e.name!==t.objectIdField&&i.includes(e.type)||(r=new y(n,"'field' should be one of these types: "+i.join(","))):r=new y(n,"'field' is not defined in the layer schema"),r}function ge(t,e,n){let i;return e?e.name!==t.objectIdField&&B(e)||(i=new y(n,"'field' should be one of these numeric types: "+W.join(","))):i=new y(n,"'field' is not defined in the layer schema"),i}function Z(t,e){let n=t??"";return e!=null&&e&&(n=n?"("+n+") AND ("+e+")":e),n}function Fe(t,e){if(t&&t.spatialRelationship!=="intersects")return new y(e,"Only 'intersects' spatialRelationship is supported for featureFilter")}function xe(t,e,n){let i=J({layer:t,fields:e});if(i.length)return new y(n,"Unknown fields: "+i.join(", ")+". You can only use fields defined in the layer schema");let r=X({layer:t,fields:e});return r.length?new y(n,"Unsupported fields: "+r.join(", ")+". You can only use fields that can be fetched i.e. AdapterFieldUsageInfo.supportsStatistics must be true"):void 0}function J(t){let e=t.layer;return t.fields.filter(n=>!e.getField(n))}function X(t){let e=t.layer;return t.fields.filter(n=>{let i=e.getFieldUsageInfo(n);return!i||!i.supportsStatistics})}function be(t,e,n){let i=[],r=[],l=[],u=[],f=[];t.forEach((d,s)=>{let a=d.field?"field":"expression",h=d.field||d.valueExpression;d.field?(f.push(h),r.push(`var ${a}${s} = Number($feature["${h}"]);`)):(i.push(`function getValueForExpr${s}() {
  ${h} 
}`),r.push(`var ${a}${s} = Number(getValueForExpr${s}());`)),n||l.push(`${a}${s} = IIf(${a}${s} < 0, 0, ${a}${s});`),u.push(`${a}${s}`)});let c=i.length?null:f.reduce((d,s)=>`${d} + ${s}`),m=null;return e||n?e?n||c&&(m=`(( ${c} ) >= 0)`):c&&(m=`(( ${c} ) <> 0)`):c&&(m=`(( ${c} ) > 0)`),{valueExpression:[i.length?i.join(`
`):"",r.join(`
`),l.join(`
`),`var total = ${u.join(" + ")};`,"return total;"].filter(Boolean).join(`

`),sqlExpression:c,sqlWhere:m}}export{me as a,de as b,Q as c,pe as d,he as e,ye as f,$e as g,ge as h,Z as i,Fe as j,xe as k,be as l};
