import{a as b}from"./chunk-DKNG2DCF.js";import{a as m}from"./chunk-QTO4E4UZ.js";import{a as y}from"./chunk-SO3JGF64.js";import{a as p}from"./chunk-KN5AJ2NM.js";import{a as u}from"./chunk-OVX6BGGA.js";import{a as x}from"./chunk-2SXWYVJN.js";import{a as z}from"./chunk-J2AEVBSH.js";import{c as F}from"./chunk-QS3EYJPF.js";import{a as o}from"./chunk-HJJZ2AXH.js";import{a as C}from"./chunk-FXCL7YYQ.js";import{a as V,i as _}from"./chunk-TG45K3WR.js";import{a as d}from"./chunk-QGVBCWUY.js";import{e as v}from"./chunk-NFIPKH6V.js";import{l as w}from"./chunk-5QEXLALV.js";var M={key:"type",base:u,typeMap:{cluster:m,binning:p}},g={types:{key:"type",base:u,typeMap:{selection:y,cluster:m,binning:p}},json:{name:"layerDefinition.featureReduction",write:{allowNull:!0},origins:{"web-map":{types:M},"portal-item":{types:M},"web-scene":{types:{key:"type",base:u,typeMap:{selection:y}},name:"layerDefinition.featureReduction",write:{layerContainerTypes:C}}}}};var Y=k=>{let n=class extends k{constructor(...r){super(...r),this.addHandles(V(()=>this.renderer,()=>{if(this.featureReduction){let e=this._normalizeFeatureReduction(this.featureReduction);this._set("featureReduction",e)}},_))}set featureReduction(r){let e=this._normalizeFeatureReduction(r);this._set("featureReduction",e)}set renderer(r){}_withClusterVariable(r,e,i){let t=r.clone();return"visualVariables"in t&&(t.visualVariables||(t.visualVariables=[]),t.visualVariables.some(l=>l.type==="size")||t.visualVariables.push(new F({field:"cluster_count",stops:[new o({value:1}),new o({useMinValue:!0,size:e}),new o({useMaxValue:!0,size:i})]}))),t}_normalizeFeatureReduction(r){if(r?.type!=="cluster")return r;let e=r.clone(),i=[new x({name:"cluster_count",alias:"cluster_count",isAutoGenerated:!0,statisticType:"count"})],t=(e.fields??[]).filter(s=>!s.isAutoGenerated),l=r.renderer&&!r.renderer.authoringInfo?.isAutoGenerated,{clusterMinSize:c,clusterMaxSize:f}=e;if(l){e.fields=[...i,...t];let s=this._withClusterVariable(e.renderer,c,f);return e.effectiveFeatureRenderer=s,e.effectiveClusterRenderer=s,e}if(r.symbol){if(e.fields=[...i,...t],e.renderer=null,!this.renderer)return e.effectiveFeatureRenderer=null,e.effectiveClusterRenderer=null,e;let s=b(i,this.renderer),a=this._withClusterVariable(s,c,f),A="visualVariables"in a&&a.visualVariables?a.visualVariables:[],G=new z({symbol:r.symbol,visualVariables:A});return e.fields=[...i,...t],e.effectiveFeatureRenderer=a,e.effectiveClusterRenderer=G,e}if(!this.renderer)return r;let R=b(i,this.renderer);e.fields=[...i,...t],e.renderer=R;let h=this._withClusterVariable(R,c,f);return e.effectiveFeatureRenderer=h,e.effectiveClusterRenderer=h,e}};return d([v(g)],n.prototype,"featureReduction",null),n=d([w("esri.layers.mixins.FeatureReductionLayer")],n),n};export{g as a,Y as b};
