import{h as l,s as M}from"./chunk-DA3SDKGO.js";import{a as h}from"./chunk-FYZRIMPP.js";import{e as u,g,h as j}from"./chunk-Q6Y4JG7Q.js";import{d as t,m,t as c}from"./chunk-NJWTSROP.js";import{L as y}from"./chunk-4PTIEWMT.js";import{y as x}from"./chunk-QBWJMFH5.js";import{f as a}from"./chunk-VTHXE323.js";var p=[0,0];function b(r,n){if(!n)return null;if("x"in n){let s={x:0,y:0};return[s.x,s.y]=r(n.x,n.y,p),n.z!=null&&(s.z=n.z),n.m!=null&&(s.m=n.m),s}if("xmin"in n){let s={xmin:0,ymin:0,xmax:0,ymax:0};return[s.xmin,s.ymin]=r(n.xmin,n.ymin,p),[s.xmax,s.ymax]=r(n.xmax,n.ymax,p),n.hasZ&&(s.zmin=n.zmin,s.zmax=n.zmax,s.hasZ=!0),n.hasM&&(s.mmin=n.mmin,s.mmax=n.mmax,s.hasM=!0),s}return"rings"in n?{rings:_(n.rings,r),hasM:n.hasM,hasZ:n.hasZ}:"paths"in n?{paths:_(n.paths,r),hasM:n.hasM,hasZ:n.hasZ}:"points"in n?{points:z(n.points,r),hasM:n.hasM,hasZ:n.hasZ}:null}function _(r,n){let s=[];for(let e of r)s.push(z(e,n));return s}function z(r,n){let s=[];for(let e of r){let i=n(e[0],e[1],[0,0]);s.push(i),e.length>2&&i.push(e[2]),e.length>3&&i.push(e[3])}return s}function k(r,n){return a(this,null,function*(){if(!r||!n)return;let s=Array.isArray(r)?r.map(e=>e.geometry!=null?e.geometry.spatialReference:null).filter(x):[r];yield M(s.map(e=>({source:e,dest:n})))})}var R=b.bind(null,g),Z=b.bind(null,j);function q(r,n,s,e){if(!r)return null;if(s||(s=n,n=r.spatialReference),!c(n)||!c(s)||t(n,s))return r;if(u(n,s)){let i=m(s)?R(r):Z(r);return i.spatialReference=s,i}return l(h,[r],n,s,null,e)[0]}var f=class{constructor(){this._jobs=[],this._timer=null,this._process=this._process.bind(this)}push(n,s,e,i){return a(this,null,function*(){if(!n?.length||!s||!e||t(s,e))return n;let o={geometries:n,inSpatialReference:s,outSpatialReference:e,geographicTransformation:i,resolve:y()};return this._jobs.push(o),this._timer??=setTimeout(this._process,10),o.resolve.promise})}_process(){this._timer=null;let n=this._jobs.shift();if(!n)return;let{geometries:s,inSpatialReference:e,outSpatialReference:i,resolve:o,geographicTransformation:d}=n;u(e,i)?m(i)?o(s.map(R)):o(s.map(Z)):o(l(h,s,e,i,d,null)),this._jobs.length>0&&(this._timer=setTimeout(this._process,10))}},S=new f;function V(r,n,s,e){return S.push(r,n,s,e)}export{k as a,q as b,V as c};
