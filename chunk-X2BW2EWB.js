import{b as Pe,c as A}from"./chunk-4D52NPT3.js";import{a as he}from"./chunk-LPHQQI5O.js";import{a as j,b as $,c as _,d as N,e as ee,f as ie,g as ae,h as be,m as ge,n as P,o as Ce}from"./chunk-MOUPZWB7.js";import{a as U,b as Ge,i as Y,j as q,k as D,l as Z,m as fe,n as ye,o as ve,r as ze,s as Me,t as G,u as we}from"./chunk-TVZYM2NN.js";import{a as ce,b as De}from"./chunk-U445SEXM.js";import{a as pe}from"./chunk-47NA5MWW.js";import{a as qe}from"./chunk-PWCKLYPC.js";import{a as Q,b as ue,c as X,d as de}from"./chunk-7T2VXP7X.js";import{c as I,d as R,e as O,g as F}from"./chunk-GYQWYHEG.js";import{b as C}from"./chunk-JC4DQSN3.js";import{h as me}from"./chunk-B3VPRADQ.js";import{d as oe}from"./chunk-5AFOYCWC.js";import{a as le}from"./chunk-GAVFKWSK.js";import{t as Re}from"./chunk-ZM24RY22.js";import{a as k,b as Fe,c as K}from"./chunk-QS3EYJPF.js";import{a as ke}from"./chunk-TPNSUEHH.js";import{c as J}from"./chunk-UMJIJLDA.js";import{a as H,b as Oe}from"./chunk-4KXJ537H.js";import{f as Be,g as W,h as Ie}from"./chunk-F5AJITOA.js";import{a as te}from"./chunk-KJUZWSCL.js";import{b as re,c as se}from"./chunk-OLOKUDVI.js";import{b as ne}from"./chunk-UST6HCE7.js";import{i as Ee}from"./chunk-P6QFA5MM.js";import{b as p}from"./chunk-YOFFGXOB.js";import{a as T,b as E,c as Ve,f as h}from"./chunk-VTHXE323.js";var ii=.1,Ae=.25,ai=.1,ni=.1;function ri(e){return h(this,null,function*(){let{view:i}=e;if(!(e&&i&&e.layer))throw new p("reference-size:missing-parameters","'view' and 'layer' parameters are required");e.forBinning&&C(e,"reference-size");let o=e,{layer:a}=o,s=Ve(o,["layer"]),n=e.forBinning?R:I,r=F(a,n,e.forBinning);if(!r)throw new p("reference-size:invalid-parameters","'reference-size' must be one of these types: "+O(n).join(", "));let t=E(T({layerAdapter:r},s),{view:i});yield i.when();let l=t.signal!=null?{signal:t.signal}:null;if(yield r.load(l),!e.forBinning&&r.geometryType!=="polygon")throw new p("reference-size:not-supported",`reference-size is not supported for geometryType: ${r.geometryType}`);return t})}function Ue(e){let i=0;for(let a of e)i+=a;return i/e.length}function Le(e,i){let a=i??Ue(e),s=e.reduce((n,r)=>n+(r-a)**2,0);return Math.sqrt(s/e.length)}function si(e,i){return h(this,null,function*(){let a=yield qe({features:e,geometryType:i});if(!(a&&"avgSize"in a&&a.avgSize))throw new p("reference-size:insufficient-info","average polygon size is invalid");let s=a.avgSize,n=[],r=[];for(let d of e){let u=te(d.geometry);if(!u){n.push(0),r.push(0);continue}let c=Math.abs(u.xmax-u.xmin),v=Math.abs(u.ymax-u.ymin);n.push(c/v),r.push(Math.sqrt(c*v))}let t=Number(Ue(n).toFixed(2)),l=Number(Le(n,t).toFixed(2)),o=Le(r),m=Number((o/s).toFixed(2));return{isGrid:l<=ai&&t>=1-Ae&&t<=1+Ae&&m<=ni,avgSize:s}})}function ti(e,i){return h(this,null,function*(){let{view:a}=i;if(i.forBinning){let r=e[Math.floor(e.length/2)].geometry,t=te(r);if(!t)throw new p("reference-size:insufficient-info","Extent is invalid");let l=Math.abs(t.xmax-t.xmin),o=Math.abs(t.ymax-t.ymin),m=Math.min(l,o);return{size:re(m/a.resolution),isGrid:!0}}let{isGrid:s,avgSize:n}=yield si(e,i.layerAdapter.geometryType);return{size:re((s?n*(1-ii):.75*n)/a.resolution),isGrid:s}})}function Se(e){return h(this,null,function*(){let i=yield ri(e),a=-1,s=yield i.layerAdapter.getSampleFeatures(T({sampleSize:a,returnGeometry:!0},i),"json");if(!s?.length)throw new p("reference-size:insufficient-info","No features are available to calculate statistics");return ti(s,i)})}var li=2**53-1;function je(e){return h(this,null,function*(){if(!(e&&e.layer&&(e.field||e.valueExpression||e.sqlExpression)))throw new p("size-visual-variable:missing-parameters","'layer' and 'field', 'valueExpression' or 'sqlExpression' parameters are required");if(e.valueExpression&&!e.sqlExpression&&!e.view)throw new p("size-visual-variable:missing-parameters","View is required when 'valueExpression' is specified");if(e.theme==="reference-size"&&!e.view&&!e.field)throw new p("size-visual-variable:missing-parameters","'view' and 'field' are required when 'theme' is 'reference-size'");if(e.theme==="reference-size"&&e.valueExpression)throw new p("size-visual-variable:missing-parameters","'valueExpression' is not supported when 'theme' is 'reference-size'");e.forBinning&&C(e,"size-visual-variable");let i=T({},e),a=e.forBinning?R:I,s=F(i.layer,a,e.forBinning);if(!s)throw new p("size-visual-variable:invalid-parameters","'layer' must be one of these types: "+O(a).join(", "));i.axis==="height"&&(i.sizeOptimizationEnabled=!1);let n=i.signal!=null?{signal:i.signal}:null;yield s.load(n);let r=s.geometryType;if(r==="mesh")throw new p("size-visual-variable:invalid-parameters","Size visualization is not applicable to layers with 'mesh' geometry type");if(i.worldScale){if(r==="polyline"||r==="polygon")throw new p("size-visual-variable:not-supported","'worldScale' sizing is not supported for polyline and polygon layers");if(!i.view||i.view.type!=="3d")throw new p("size-visual-variable:invalid-parameters","'view' parameter should be an instance of SceneView when 'worldScale' parameter is true")}if(i.theme==="reference-size"&&!e.forBinning&&r!=="polygon")throw new p("size-visual-variable:invalid-parameters","Reference size is only supported for polygon layers");let t=yield W({field:i.field,normalizationField:i.normalizationField,valueExpression:i.valueExpression}),l=Z(s,t,"size-visual-variable:invalid-parameters");if(l)throw l;return yield Ne(i),E(T({},i),{layer:s})})}function $e(e){return h(this,null,function*(){if(!(e&&e.layer&&(e.field||e.valueExpression||e.sqlExpression)))throw new p("size-continuous-renderer:missing-parameters","'layer' and 'field', 'valueExpression' or 'sqlExpression' parameters are required");if(e.valueExpression&&!e.sqlExpression&&!e.view)throw new p("size-continuous-renderer:missing-parameters","View is required when 'valueExpression' is specified");e.forBinning&&C(e,"size-continuous-renderer");let i=T({},e);i.symbolType=i.symbolType||"2d",i.defaultSymbolEnabled??=!0;let a=e.forBinning?R:I,s=F(i.layer,a,e.forBinning);if(!s)throw new p("size-continuous-renderer:invalid-parameters","'layer' must be one of these types: "+O(a).join(", "));let n=i.signal!=null?{signal:i.signal}:null;yield s.load(n);let r=s.geometryType,t=i.symbolType.includes("3d");if(i.outlineOptimizationEnabled=i.theme!=="reference-size"&&r==="polygon"&&i.outlineOptimizationEnabled,r==="mesh")throw new p("size-continuous-renderer:invalid-parameters","Size visualization is not applicable to layers with 'mesh' geometry type");if(t&&(r==="polyline"||r==="polygon"))throw new p("size-continuous-renderer:not-supported","3d symbols are not supported for polyline and polygon layers");if(i.symbolType.includes("3d-volumetric")&&(!i.view||i.view.type!=="3d"))throw new p("size-continuous-renderer:invalid-parameters","'view' parameter should be an instance of SceneView when 'symbolType' parameter is '3d-volumetric' or 3d-volumetric-uniform");if(i.theme==="reference-size"&&!e.forBinning&&r!=="polygon")throw new p("size-continuous-renderer:invalid-parameters","Reference size is only supported for polygon layers");let l=yield W({field:i.field,normalizationField:i.normalizationField,valueExpression:i.valueExpression}),o=Z(s,l,"size-continuous-renderer:invalid-parameters");if(o)throw o;return yield Ne(i),E(T({},i),{layer:s})})}function Ne(e){return h(this,null,function*(){let i=e.layer;if((i.geometryType==="polygon"||e.forBinning)&&e.view&&e.field&&!e.valueExpression&&(!e.theme||e.theme==="reference-size")){try{e.referenceSizeResult=e.referenceSizeResult??(yield Se({layer:i,view:e.view,filter:e.filter,forBinning:e.forBinning,signal:e.signal}))}catch{}!e.theme&&e.referenceSizeResult?.isGrid&&(e.theme="reference-size"),e.referenceSizeOptions?.symbolStyle||(e.referenceSizeOptions?e.referenceSizeOptions.symbolStyle="circle":e.referenceSizeOptions={symbolStyle:"circle"})}})}function oi(e){return h(this,null,function*(){if(!e||!(e.layer&&e.view&&e.sizeStops))throw new p("update-renderer-with-reference-size:missing-parameters","'layer', 'view and 'sizeStops' parameters are required");let{view:i,forBinning:a}=e,s=e.forBinning?R:I,n=F(e.layer,s,e.forBinning);if(!n)throw new p("update-renderer-with-reference-size:invalid-parameters","'layer' must be one of these types: "+O(s).join(", "));let r=n.layer,t=e.renderer;if(!t)if(e.forBinning){if(!("featureReduction"in r&&r.featureReduction&&"renderer"in r.featureReduction&&r.featureReduction.renderer)||r.featureReduction.renderer.type!=="class-breaks"&&r.featureReduction.renderer.type!=="unique-value")throw new p("update-renderer-with-reference-size:invalid-parameters","Feature reduction renderer is not supported");t=r.featureReduction.renderer}else{if(!("renderer"in r)||!r.renderer||r.renderer.type!=="class-breaks"&&r.renderer.type!=="unique-value")throw new p("update-renderer-with-reference-size:invalid-parameters","Renderer is not supported");t=r.renderer}let l=t.authoringInfo;if(!l||!l?.visualVariables?.some(m=>m.theme==="reference-size"))throw new p("update-renderer-with-reference-size:invalid-parameters","'renderer.authoringInfo.visualVariables' should have an authoringInfoVisualVariable with 'theme' set to 'reference-size'");let o=e.isGrid??(yield Se({view:i,layer:r,forBinning:a}))?.isGrid;return E(T({},e),{isGrid:o,renderer:t,layer:n})})}function We(e){return h(this,null,function*(){if(!e||!e.layer||!e.field&&!e.valueExpression)throw new p("size-class-breaks-renderer:missing-parameters","'layer' and 'field' or 'valueExpression' parameters are required");if(e.valueExpression&&!e.view)throw new p("size-class-breaks-renderer:missing-parameters","View is required when 'valueExpression' is specified");e.forBinning&&C(e,"size-class-breaks-renderer");let i=T({},e);i.symbolType=i.symbolType||"2d",i.defaultSymbolEnabled??=!0,i.classificationMethod??="equal-interval",i.normalizationType=Ie(i);let a=e.forBinning?R:I,s=F(i.layer,a,e.forBinning);if(!s)throw new p("size-class-breaks-renderer:invalid-parameters","'layer' must be one of these types: "+O(a).join(", "));if(!(i.minValue!=null&&i.maxValue!=null)&&(i.minValue!=null||i.maxValue!=null))throw new p("size-class-breaks-renderer:missing-parameters","Both 'minValue' and 'maxValue' are required when specifying custom data range");let n=i.signal!=null?{signal:i.signal}:null;yield s.load(n);let r=s.geometryType,t=i.symbolType.includes("3d");if(i.outlineOptimizationEnabled=r==="polygon"&&i.outlineOptimizationEnabled,r==="mesh")throw new p("size-class-breaks-renderer:invalid-parameters","Size visualization is not applicable to layers with 'mesh' geometry type");if(t&&(r==="polyline"||r==="polygon"))throw new p("size-class-breaks-renderer:not-supported","3d symbols are not supported for polyline and polygon layers");if(i.symbolType.includes("3d-volumetric")&&(!i.view||i.view.type!=="3d"))throw new p("size-class-breaks-renderer:invalid-parameters","'view' parameter should be an instance of SceneView when 'symbolType' parameter is '3d-volumetric' or 3d-volumetric-uniform");let l=yield W({field:i.field,normalizationField:i.normalizationField}),o=Z(s,l,"size-class-breaks-renderer:invalid-parameters");if(o)throw o;return E(T({},i),{layer:s})})}function He(e){let i=T({},e);delete i.basemap,delete i.sizeScheme,delete i.legendOptions,delete i.symbolType,delete i.defaultSymbolEnabled;let a=i;return a.analyzeData=!(i.minValue!=null&&i.maxValue!=null),a}function xe(e){let i=T({},e),a=!!i.symbolType?.includes("3d-volumetric"),s=i;return s.worldScale=a,a&&(s.axis=i.symbolType==="3d-volumetric-uniform"?"all":"height"),delete i.symbolType,delete i.defaultSymbolEnabled,s}function Je(e){return h(this,null,function*(){if(!(e&&e.layer&&e.view&&e.startTime&&e.endTime))throw new p("size-age-renderer:missing-parameters","'layer', 'view', 'startTime', 'endTime' parameters are required");let i=T({},e);i.symbolType??="2d",i.defaultSymbolEnabled??=!0;let a=F(i.layer,I);if(!a)throw new p("size-age-renderer:invalid-parameters","'layer' must be one of these types: "+O(I).join(", "));let s=i.signal!=null?{signal:i.signal}:null;yield a.load(s);let n=a.geometryType,r=i.symbolType.includes("3d");if(i.outlineOptimizationEnabled=n==="polygon"&&i.outlineOptimizationEnabled,n==="mesh")throw new p("size-age-renderer:invalid-parameters","Size visualization is not applicable to layers with 'mesh' geometry type");if(r&&(n==="polyline"||n==="polygon"))throw new p("size-age-renderer:not-supported","3d symbols are not supported for polyline and polygon layers");if(i.symbolType.includes("3d-volumetric")&&(!i.view||i.view.type!=="3d"))throw new p("size-age-renderer:invalid-parameters","'view' parameter should be an instance of SceneView when 'symbolType' parameter is '3d-volumetric' or 3d-volumetric-uniform");let t=De(a,i.startTime,i.endTime,"size-age-renderer:invalid-parameters");if(t)throw t;if(i.unit&&!ce.includes(i.unit))throw new p("size-age-renderer:invalid-unit",`Supported units are: ${ce.join(", ")}`);return E(T({},i),{layer:a})})}function mi(e){return h(this,null,function*(){let i="regenerate-size-visual-variables";j(e,i);let a=yield $(e),s=N(a);if(!s||!["size-continuous","univariate-color-size","color-size","relationship-size","type-size"].includes(s))throw new p(`${i}:invalid-parameters`,"Renderer is invalid");let n=_(a,"size");if(!n)throw new p(`${i}:invalid-parameters`,"Renderer does not have a size visual variable authoringInfo");let r=n.theme,t=r==="reference-size",l=a.visualVariables?.find(ge);if(!l&&!t)throw new p(`${i}:invalid-parameters`,"Renderer does not have a size visual variable");let o=n.field,m=n.normalizationField,d=null,u=null;o||(l?.field?(o=l.field,m=l.normalizationField):a.field?(o=a.field,m=a.normalizationField):(d=l?.valueExpression??a.valueExpression,u=l?.valueExpressionTitle??a.valueExpressionTitle));let{layer:c,forBinning:v,filter:y,view:f,signal:w}=e,z=ie(a),b=yield je({layer:c,field:o,valueExpression:d,valueExpressionTitle:u,normalizationField:m,theme:r,sizeOptimizationEnabled:z,forBinning:v,filter:y,view:f,signal:w});return E(T({},e),{creatorParameters:b,renderer:a})})}function ui(e){return h(this,null,function*(){let i="regenerate-size-continuous-renderer";j(e,i);let a=yield $(e),s=N(a);if(!s||!["size-continuous","univariate-color-size"].includes(s))throw new p(`${i}:invalid-parameters`,"Renderer is invalid");let{authoringInfo:n,field:r,normalizationField:t,valueExpression:l,valueExpressionTitle:o}=a,m=n?.visualVariables.find(S=>S.type==="size"),d=m.theme,{layer:u,forBinning:c,filter:v,view:y,signal:f}=e,w=ee(a),z=ie(a),b=yield $e({layer:u,field:r,valueExpression:l,valueExpressionTitle:o,normalizationField:t,theme:d,outlineOptimizationEnabled:w,sizeOptimizationEnabled:z,forBinning:c,filter:v,view:y,signal:f});return E(T({},e),{creatorParameters:b,renderer:a})})}function di(e){return h(this,null,function*(){let i="regenerate-size-class-breaks-renderer";yield j(e,i);let a=yield $(e);if(N(a)!=="size-class-breaks")throw new p(`${i}:invalid-parameters`,"Renderer is invalid");let{authoringInfo:s,field:n,normalizationField:r,normalizationType:t,normalizationTotal:l,valueExpression:o,valueExpressionTitle:m}=a,{classificationMethod:d,standardDeviationInterval:u}=s,c=a.classBreakInfos.length,{layer:v,forBinning:y,filter:f,view:w,signal:z}=e,b=ee(a),S=yield We({layer:v,field:n,valueExpression:o,valueExpressionTitle:m,normalizationType:t,normalizationField:r,normalizationTotal:l,classificationMethod:d,standardDeviationInterval:u,numClasses:c,outlineOptimizationEnabled:b,forBinning:y,filter:f,view:w,signal:z});return E(T({},e),{creatorParameters:S,renderer:a})})}function pi(e){return h(this,null,function*(){let i="regenerate-size-age-renderer";yield j(e,i);let a=yield $(e);if(N(a)!=="size-age")throw new p(`${i}:invalid-parameters`,"Renderer is invalid");let{authoringInfo:s}=a,n=s?.visualVariables.find(w=>w.type==="size"),r=n.startTime,t=n.endTime,l=n.units,o=n.theme,{layer:m,filter:d,view:u,signal:c}=e,v=ee(a),y=ie(a),f=yield Je({layer:m,startTime:r,endTime:t,unit:l,theme:o,outlineOptimizationEnabled:v,sizeOptimizationEnabled:y,filter:d,view:u,signal:c});return E(T({},e),{creatorParameters:f,renderer:a})})}function Ke(e){return h(this,null,function*(){let i=e.sizeScheme,a=null,s=null,n=yield Me(e.basemap,e.view);if(a=n.basemapId!=null?n.basemapId:null,s=n.basemapTheme!=null?n.basemapTheme:null,i)return{scheme:A(i),basemapId:a,basemapTheme:s};let r=Pe({basemapTheme:s,geometryType:e.geometryType,worldScale:e.worldScale,view:e.view});return r&&(i=r.primaryScheme,a=r.basemapId,s=r.basemapTheme),{scheme:i,basemapId:a,basemapTheme:s}})}function Qe(e,i){switch(i){case"point":case"multipoint":{let a=e;return[k(a.minSize),k(a.maxSize)]}case"polyline":{let a=e;return[k(a.minWidth),k(a.maxWidth)]}case"polygon":{let a=e;return[k(a.marker.minSize),k(a.marker.maxSize)]}}}function Xe(e,i){e.transformationType===ke.ClampedLinear&&i==="below"&&e.flipSizes()}function ci(e,i,a,s,n){return h(this,null,function*(){return a==="reference-size"&&i?[1,i.size]:e?[e.minSize,e.maxSize]:Qe(s,n)})}function fi(e,i,a){return a==="reference-size"&&i?[1,i.size]:e?[e.minSize,e.maxSize]:null}function Ye(e,i){if(i.theme==="reference-size"&&e.min!=null&&e.max!=null&&e.avg!=null&&e.stddev!=null){let u=e.avg,c=e.min,v=e.max,y=e.stddev,f=u!==0?y/u:0,w=c>0&&c<1&&v<2*1&&f<.5,z=c>0&&c<100&&v<2*100&&f<.5;return{minDataValue:w||z?0:c,maxDataValue:w?1:z?100:u+2*y,defaultValuesUsed:!1}}let{theme:a,field:s}=i,n=i.layer,r=s&&typeof s!="function"?n.getField(s):null,t=Be(r);return Ge(e,a,t,a==="above"||a==="below")}function yi(e,i,a,s){return h(this,null,function*(){let{theme:n,field:r,normalizationField:t,minValue:l,maxValue:o,axis:m}=e,d=e.layer.geometryType,u=yield Ke({basemap:e.basemap,geometryType:d,sizeScheme:e.sizeScheme,worldScale:e.worldScale,view:e.view}),c=u.scheme;if(!c)throw new p("size-visual-variable:insufficient-info","Unable to find size scheme");let v=yield ci(a,s,n,c,d),{minDataValue:y,maxDataValue:f,defaultValuesUsed:w}=Ye(i,e),z=[],b=m==="height",S=b?m:void 0,g=v[0],x=v[1];if(b&&typeof g=="number"&&typeof x=="number"){let M=ve({minSize:g,maxSize:x},S);z.push(new K({axis:"width-and-depth",minSize:M.minSize})),x=M.maxSize}let V=new K({field:r??void 0,valueExpression:e.valueExpression,valueExpressionTitle:e.valueExpressionTitle,valueUnit:"unknown",normalizationField:t,axis:S,minSize:g,maxSize:x,minDataValue:y,maxDataValue:f,legendOptions:Ee(Fe,e.legendOptions)});Xe(V,n),z.unshift(V);let B=new Oe(n==="reference-size"?{type:"size",field:e.field,normalizationField:e.normalizationField,sizeStops:Q(V).map(({label:M,size:_e,value:ei})=>new H({label:M,size:_e,value:ei})),theme:n,referenceSizeScale:s?.isGrid||e.sizeOptimizationEnabled?e?.view?.scale:void 0,referenceSizeSymbolStyle:e.referenceSizeOptions?.symbolStyle,minSliderValue:l??i.min,maxSliderValue:o??i.max}:{type:"size",theme:n,minSliderValue:l??i.min,maxSliderValue:o??i.max}),L=new J({visualVariables:[B]});return{basemapId:u.basemapId,basemapTheme:u.basemapTheme,visualVariables:z,statistics:i,isGrid:s?.isGrid,defaultValuesUsed:w,sizeScheme:A(c),authoringInfo:L}})}function Ze(e,i,a,s,n){return h(this,null,function*(){let r=yield ne("esri/smartMapping/t9n/smartMapping"),t=n.layer,l=n.field,o=t.geometryType,m=n.defaultSymbolEnabled,d=A(e.sizeScheme),u=o==="polygon",c=u?d.marker:d,v=u?d.background:null,y=u?"point":o,f=i?.opacity,w=e.isGrid,z=n.theme==="reference-size",b=z?[]:e.visualVariables.map(g=>g.clone());i?.visualVariables?.length&&b.push(...i.visualVariables.map(g=>g.clone()));let S=z?ue({view:n.view,field:l,normalizationField:s,sizeStops:Q(e.visualVariables[0]),sizeByScaleEnabled:w||!!n.sizeOptimizationEnabled}):null;return{renderer:new le({backgroundFillSymbol:!w&&v?D(o,{type:n.symbolType,color:v.color,outline:q(v,o,f)}):null,classBreakInfos:[{minValue:-9007199254740991,maxValue:li,symbol:S?X({type:n.referenceSizeOptions?.symbolStyle||"circle",color:c.color,primitiveOverrides:S}):D(y,{type:n.symbolType,color:c.color,size:Y(c,y),outline:q(c,y,f)})}],defaultLabel:m?r.other:null,defaultSymbol:m&&!z?D(y,{type:n.symbolType,color:c.noDataColor,size:Y(c,y,!0),outline:q(c,y,f)}):null,field:l,normalizationField:s,normalizationType:a,valueExpression:n.valueExpression,valueExpressionTitle:n.valueExpressionTitle,visualVariables:b,authoringInfo:e.authoringInfo?.clone()}),visualVariables:e.visualVariables.map(g=>g.clone()),statistics:e.statistics,defaultValuesUsed:e.defaultValuesUsed,isGrid:w,sizeScheme:A(e.sizeScheme),basemapId:e.basemapId,basemapTheme:e.basemapTheme}})}function vi(e,i){let a=se(e.minSize),s=(se(e.maxSize)-a)/(i>=4?i-1:i),n=[];for(let r=0;r<i;r++)n.push(a+s*r);return n}function zi(e,i){return h(this,null,function*(){let a=yield ne("esri/smartMapping/t9n/smartMapping"),s=e.layer,n=e.defaultSymbolEnabled,r=s.geometryType,t=r==="polygon",l=e.symbolType?.includes("3d-volumetric"),o=yield Ke({basemap:e.basemap,geometryType:r,sizeScheme:e.sizeScheme,worldScale:l,view:e.view}),m=o.scheme,{result:d,outlineResult:u}=i,c=d?.classBreakInfos??[],v=e.classificationMethod,y=e.normalizationType,f=t?m.marker:m,w=t?m.background:null,z=t?"point":r,b=Qe(f,z),S=l?ve({minSize:b[0],maxSize:b[1]},"height"):null,g=vi({minSize:b[0],maxSize:S?S.maxSize:b[1]},c.length),x=u?.opacity,V=new le({backgroundFillSymbol:w&&D(r,{type:e.symbolType,color:w.color,outline:q(w,r,x)}),classBreakInfos:c.map((B,L)=>({minValue:B.minValue,maxValue:B.maxValue,symbol:D(z,{type:e.symbolType,color:f.color,size:g[L],widthAndDepth:S?.minSize,outline:q(f,z,x)}),label:B.label})),defaultLabel:n?a.other:null,defaultSymbol:n?D(z,{type:e.symbolType,color:f.noDataColor,size:Y(f,z,!0),widthAndDepth:S?.minSize,outline:q(f,z,x)}):null,field:e.field,valueExpression:e.valueExpression,valueExpressionTitle:e.valueExpressionTitle,normalizationType:y,normalizationField:e.normalizationField,normalizationTotal:y==="percent-of-total"?d?.normalizationTotal:void 0,legendOptions:e.legendOptions,authoringInfo:new J({type:"class-breaks-size",classificationMethod:v,standardDeviationInterval:e.standardDeviationInterval})});return v!=="standard-deviation"&&me({classBreakInfos:V.classBreakInfos,classificationMethod:v,normalizationType:y,round:!0}),u?.visualVariables?.length&&(V.visualVariables=u.visualVariables.map(B=>B.clone())),{renderer:V,sizeScheme:A(m),classBreaksResult:d,defaultValuesUsed:!!i.defaultValuesUsed,basemapId:o.basemapId,basemapTheme:o.basemapTheme}})}function Te(e){return h(this,null,function*(){let i=yield je(e),{view:a,field:s,valueExpression:n,minValue:r,maxValue:t,layer:l,normalizationField:o,signal:m,statistics:d,filter:u}=i,c=o?"field":void 0,[v,y]=yield Promise.all([d??ye({layer:l,field:s,valueExpression:n,sqlExpression:i.sqlExpression,sqlWhere:i.sqlWhere,normalizationType:c,normalizationField:o,filter:u,minValue:r,maxValue:t,view:a,signal:m}),i.sizeOptimizationEnabled?pe({view:a,layer:l,signal:m,filter:u}).catch(G):null]);return yi(i,v,y,i.referenceSizeResult)})}function wi(e){return h(this,null,function*(){let{view:i,filter:a,renderer:s,signal:n,creatorParameters:r}=yield mi(e),{field:t,normalizationField:l,valueExpression:o,theme:m,layer:d,sizeOptimizationEnabled:u,referenceSizeResult:c,valueExpressionTitle:v}=r,y=l?"field":void 0,[f,w]=yield Promise.all([ye({layer:d,field:t,valueExpression:o,normalizationField:l,normalizationType:y,filter:a,view:i,signal:n}),u?pe({view:i,layer:d,signal:n,filter:a}).catch(G):null]),z=fi(w,c,m),{minDataValue:b,maxDataValue:S}=Ye(f,{theme:m,layer:d,field:t}),g=s.visualVariables?.find(ge),x=(g?.stops?null:g)??new K({field:t??void 0,valueExpression:o,valueExpressionTitle:v,valueUnit:"unknown",normalizationField:l});z&&(x.minSize=z[0],x.maxSize=z[1]),x.minDataValue=b,x.maxDataValue=S,Xe(x,m);let V=_(s,"size");return V.minSliderValue=f.min,V.maxSliderValue=f.max,m==="reference-size"&&(V.sizeStops=Q(x).map(({label:B,size:L,value:M})=>new H({label:B,size:L,value:M})),V.referenceSizeScale=c?.isGrid||u?i?.scale:void 0),{visualVariables:m==="reference-size"?[]:[x],isGrid:!!c?.isGrid,authoringInfo:s.authoringInfo?.clone(),statistics:f}})}function ia(e){return h(this,null,function*(){let i=yield $e(e),a={layer:i.layer,view:i.view,filter:i.filter,signal:i.signal},[s,n]=yield Promise.all([Te(xe(i)),i.outlineOptimizationEnabled?U(a).catch(G):null]),r=i.normalizationField;return Ze(s,n,r?"field":void 0,r,i)})}function aa(e){return h(this,null,function*(){let{renderer:i,view:a,signal:s,filter:n,creatorParameters:r,forBinning:t}=yield ui(e),{layer:l,outlineOptimizationEnabled:o,theme:m,referenceSizeResult:d}=r,[u,c]=yield Promise.all([wi(E(T({},e),{referenceSizeResult:d})),o?U({layer:l,view:a,filter:n,signal:s}).catch(G):null]),v=u.isGrid,y=m==="reference-size";P(i,u.visualVariables,be),P(i,c?.visualVariables,ae),Ce(i,u.authoringInfo,"size");let f=u.statistics;return y?{renderer:yield hi({layer:l,renderer:i,view:a,forBinning:t,sizeStops:_(i,"size","reference-size")?.sizeStops,isGrid:v}),isGrid:v,statistics:f}:{renderer:i,statistics:f}})}function hi(e){return h(this,null,function*(){let{layer:i,referenceSizeOptions:a,renderer:s,sizeScheme:n,sizeStops:r,typeScheme:t,view:l,isGrid:o}=yield oi(e),m=s.clone();m.authoringInfo??=new J;let d=m.authoringInfo.visualVariables.find(f=>f.theme==="reference-size"),u=e.field??d?.field,c=e.normalizationField??d?.normalizationField;if(!u)throw new p("update-renderer-with-reference-size:invalid-parameters","'field' parameter or authoring info with 'field' is required.");let v=ue({view:l,field:u,normalizationField:c,sizeStops:r,sizeByScaleEnabled:o||!!e.sizeOptimizationEnabled}),y=a?.symbolStyle||d?.referenceSizeSymbolStyle||"circle";if(m.type==="class-breaks"){let f=("geometryType"in i?i.geometryType:null)==="polygon"&&n&&"marker"in n?n.marker:null;m.classBreakInfos.forEach(w=>{let z=f?.color??oe(w.symbol,1);w.symbol.type==="cim"?de(w.symbol,{type:y,color:z,primitiveOverrides:v}):z&&(w.symbol=X({type:y,color:z,primitiveOverrides:v}))})}else if(m.type==="unique-value"){let f=m.uniqueValueGroups,w=("geometryType"in i?i.geometryType:null)==="polygon"&&t&&"colors"in t?t.colors:null,z=w?Re(w,m.uniqueValueInfos?.length??0):null,b=0;if(f){for(let S of f)for(let g of S.classes??[]){let x=z?z[b]:oe(g.symbol,1);g.symbol?.type==="cim"?de(g.symbol,{type:y,color:x,primitiveOverrides:v}):x&&(g.symbol=X({type:y,color:x,primitiveOverrides:v})),b++}m.uniqueValueGroups=f}}return d&&(d.field=u,d.normalizationField=c,d.sizeStops=r.map(({label:f,size:w,value:z})=>new H({label:f,size:w,value:z})),d.referenceSizeScale=o||e.sizeOptimizationEnabled?l.scale:void 0,d.referenceSizeSymbolStyle=y),m})}function na(e){return h(this,null,function*(){let i=yield We(e);return zi(i,yield fe(He(i),i.outlineOptimizationEnabled))})}function ra(e){return h(this,null,function*(){let{renderer:i,creatorParameters:a}=yield di(e),{outlineOptimizationEnabled:s,normalizationType:n,classificationMethod:r}=a,{result:t,outlineResult:l}=yield fe(He(a),s),o=t.classBreakInfos;if(a.numClasses!==o.length)throw new p("regenerate-class-breaks-renderer:invalid-parameters","The number of class breaks generated does not match the number of class breaks in the renderer.");return i.classBreakInfos.forEach((m,d)=>{m.minValue=o[d].minValue,m.maxValue=o[d].maxValue,m.label=o[d].label}),i.normalizationTotal=n==="percent-of-total"?t.normalizationTotal:void 0,r!=="standard-deviation"&&me({classBreakInfos:i.classBreakInfos,classificationMethod:r,normalizationType:n,round:!0}),P(i,l?.visualVariables,ae),{renderer:i}})}function sa(e){return h(this,null,function*(){let i=yield Je(e),{defaultSymbolEnabled:a,view:s,startTime:n,endTime:r,symbolType:t,minValue:l,maxValue:o,signal:m,filter:d,layer:u}=i,[c,v]=yield Promise.all([i.unit?{unit:i.unit,statistics:null,valueExpression:null}:yield he({view:s,layer:u,startTime:n,endTime:r,minValue:l,maxValue:o,signal:m,filter:d}),i.outlineOptimizationEnabled?U({layer:u,view:s,filter:d,signal:m}).catch(G):null]),{unit:y,statistics:f}=c,{valueExpression:w,title:z}=yield we(i,y),b=yield Te(xe({layer:u,basemap:i.basemap,valueExpression:w,symbolType:t,statistics:f,legendOptions:{title:z},theme:i.theme,sizeScheme:i.sizeScheme,sizeOptimizationEnabled:i.sizeOptimizationEnabled,view:i.view,minValue:l,maxValue:o,filter:d,signal:m})),S={layer:u,valueExpression:w,defaultSymbolEnabled:a,symbolType:t},g=yield Ze(b,v,null,null,S);return g.renderer.authoringInfo?.visualVariables?.forEach(V=>ze(V,n,r,y)),E(T({},g),{unit:y})})}function ta(e){return h(this,null,function*(){let{renderer:i,creatorParameters:a}=yield pi(e),{layer:s,outlineOptimizationEnabled:n,sizeOptimizationEnabled:r,startTime:t,endTime:l,theme:o,view:m,signal:d,filter:u}=a,[c,v]=yield Promise.all([he({view:m,layer:s,startTime:t,endTime:l,signal:d,filter:u}),n?U({layer:s,view:m,filter:u,signal:d}).catch(G):null]),{unit:y,statistics:f}=c,{valueExpression:w,title:z}=yield we(a,y),b=yield Te(xe({layer:s,valueExpression:w,statistics:f,legendOptions:{title:z},sizeOptimizationEnabled:r,theme:o,view:m,filter:u,signal:d}));return P(i,b.visualVariables,be),P(i,v?.visualVariables,ae),i.authoringInfo=b.authoringInfo.clone(),i.authoringInfo?.visualVariables?.forEach(g=>ze(g,t,l,y)),{renderer:i}})}export{Te as a,wi as b,ia as c,aa as d,hi as e,na as f,ra as g,sa as h,ta as i};
