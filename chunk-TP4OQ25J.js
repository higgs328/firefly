import{d as Z,e as M,f as k,g as E}from"./chunk-6B5XFA6F.js";import{c as A}from"./chunk-DYTVXYAV.js";import{c as _,e as W}from"./chunk-BOVYXYHK.js";import{c as w}from"./chunk-VIEK2X23.js";import{a as $}from"./chunk-7F5DJLJT.js";import{d as C}from"./chunk-NJWTSROP.js";import{f as g}from"./chunk-CCJU4DSH.js";import{a as t}from"./chunk-QGVBCWUY.js";import{e as s}from"./chunk-NFIPKH6V.js";import{l as d}from"./chunk-5QEXLALV.js";import{g as L}from"./chunk-XRGPJ3QY.js";function T(i){let e=/^(days?|hours?|minutes?|seconds?|d|h|m|s) since (\d{1,4})-(\d{1,2})-(\d{1,2})[ |T](\d{1,2}):(\d{1,2}):(\d{1,2})(\.[0-9]+)?[\s|Z]?(([+|\-|\s?])(\d{1,2}):(\d{1,2}))?$/i.exec(i);if(e==null)return{didParse:!1};let[,r,o,n,a,f,u,N,ee,ie,U,q,B]=e,b="seconds",V=r.charAt(0).toLowerCase();V==="d"?b="days":V==="h"?b="hours":V==="m"&&(b="minutes");let S=parseInt(o,10);if(Number.isNaN(S))return{didParse:!1};let m=parseInt(n,10);if(Number.isNaN(m)||m<1||m>12)return{didParse:!1};let c=parseInt(a,10);if(Number.isNaN(c)||c<1||c>31)return{didParse:!1};if(m===2){let x=S%4==0&&(S%100!=0||S%400==0);if(x&&c>29||!x&&c>28)return{didParse:!1}}else if((m===4||m===6||m===9||m===11)&&c>30)return{didParse:!1};let R=parseInt(f,10);if(Number.isNaN(R)||R<0||R>23)return{didParse:!1};let j=parseInt(u,10);if(Number.isNaN(j)||j<0||j>59)return{didParse:!1};let I=parseInt(N,10);if(Number.isNaN(I)||I<0||I>59)return{didParse:!1};let D=1,h=0,y=0;if(U&&(D=U==="-"?-1:1),q){if(h=parseInt(q,10),Number.isNaN(h)||h<0)return{didParse:!1};if(h!==0){let x=D*h;if(x<-12||x>14)return{didParse:!1}}}if(B&&(y=parseInt(B,10),Number.isNaN(y)||y<0||y>59))return{didParse:!1};let F=`${S}`.padStart(4,"0"),H=`${m}`.padStart(2,"0"),J=`${c}`.padStart(2,"0"),K=`${R}`.padStart(2,"0"),O=`${j}`.padStart(2,"0"),Q=`${I}`.padStart(2,"0"),v="Z";return h===0&&y===0||(v=D>0?"+":"-",v+=`${h}`.padStart(2,"0"),v+=":",v+=`${y}`.padStart(2,"0")),{didParse:!0,unit:b,reference:new Date(`${F}-${H}-${J}T${K}:${O}:${Q}.000${v}`)}}var P=class extends g{constructor(){super(...arguments),this.values=null}};t([s({type:[Number],json:{write:!0}})],P.prototype,"values",void 0),P=t([d("esri.layers.voxel.VoxelIrregularSpacing")],P);var G=P;var z=class extends g{constructor(){super(...arguments),this.scale=1,this.offset=0}};t([s({type:Number,json:{write:!0}})],z.prototype,"scale",void 0),t([s({type:Number,json:{write:!0}})],z.prototype,"offset",void 0),z=t([d("esri.layers.voxel.VoxelRegularSpacing")],z);var X=z;var p=class extends g{constructor(){super(...arguments),this.irregularSpacing=null,this.isPositiveUp=!0,this.isWrappedDateLine=!1,this.label=null,this.name=null,this.quantity=null,this.regularSpacing=null,this.size=0,this.unit=null}get isRegular(){return(this.irregularSpacing==null||this.irregularSpacing===void 0)&&this.regularSpacing!==null}getRange(){return this.isRegular?[this.regularSpacing.offset,this.regularSpacing.offset+this.regularSpacing.scale*(this.size-1)]:Array.isArray(this.irregularSpacing?.values)&&this.irregularSpacing.values.length>1?[this.irregularSpacing.values[0],this.irregularSpacing.values[this.irregularSpacing.values.length-1]]:[0,0]}};t([s({type:G,json:{write:!0}})],p.prototype,"irregularSpacing",void 0),t([s({type:Boolean,json:{write:!0}})],p.prototype,"isPositiveUp",void 0),t([s({type:Boolean,json:{write:!0}})],p.prototype,"isWrappedDateLine",void 0),t([s({type:String,json:{write:!0}})],p.prototype,"label",void 0),t([s({type:String,json:{write:!0}})],p.prototype,"name",void 0),t([s({type:String,json:{write:!0}})],p.prototype,"quantity",void 0),t([s({type:X,json:{write:!0}})],p.prototype,"regularSpacing",void 0),t([s({type:Number,json:{write:!0}})],p.prototype,"size",void 0),t([s({type:String,json:{write:!0}})],p.prototype,"unit",void 0),t([s({type:Boolean,json:{read:!1}})],p.prototype,"isRegular",null),p=t([d("esri.layers.voxel.VoxelDimension")],p);var Y=p;var l=class extends g{constructor(i){super(i),this.id=0,this.dimensions=null,this.spatialReference=$.WGS84}get zDimension(){if(!this.dimensions||!Array.isArray(this.dimensions)||this.dimensions.length!==4)return-1;for(let i=2;i<4;++i)if(this.dimensions[i].size>0)return i;return-1}get isValid(){return!!this.dimensions&&!!Array.isArray(this.dimensions)&&this.dimensions.length===4&&!(this.dimensions[0].size<1||this.dimensions[1].size<1)&&!(this.zDimension===-1||this.dimensions[this.zDimension].size<1)}get originInLayerSpace3D(){if(!this.isValid||this.volumeType==="xyt")return[0,0,0];let i=this.dimensions[0].getRange(),e=this.dimensions[1].getRange(),r=this.dimensions[2],o=r.isRegular?r.getRange():[0,r.size];return[i[0],e[0],o[0]]}get voxelSizeInLayerSpaceSigned(){if(!this.isValid||this.volumeType==="xyt")return[0,0,0];let i=this.dimensions[0].getRange(),e=this.dimensions[1].getRange(),r=this.dimensions[2],o=r.isRegular?r.getRange():[0,r.size],n=[this.sizeInVoxels[0],this.sizeInVoxels[1],this.sizeInVoxels[2]];for(let a=0;a<3;++a)n[a]<2?n[a]=1:n[a]-=1;return r.isRegular&&!r.isPositiveUp&&(n[2]*=-1),[(i[1]-i[0])/n[0],(e[1]-e[0])/n[1],(o[1]-o[0])/n[2]]}get volumeType(){if(this.isValid){let i=this.dimensions[2].size>0,e=this.dimensions[3].size>0;if(e){let r=this.dimensions[3];e=r.quantity==="time",e&&r.unit!==null&&(e=T(r.unit).didParse)}if(!i&&e)return"xyt";if(i&&e)return"xyzt"}return"xyz"}get sizeInVoxels(){if(!this.isValid)return[0,0,0];let i=this.zDimension;return[this.dimensions[0].size,this.dimensions[1].size,this.dimensions[i].size]}get timeStops(){if(this.volumeType!=="xyzt")return[];let i=this.dimensions[3],e=[],r=T(i.unit);if(r.didParse){if(i.isRegular){let o=i.regularSpacing?.offset??0,n=i.regularSpacing?.scale||1;for(let a=0;a<i.size;++a){let f=o+n*a;e.push(A(r.reference,f,r.unit))}}else if(Array.isArray(i.irregularSpacing?.values)&&i.irregularSpacing.values.length>0)for(let o=0;o<i.irregularSpacing.values.length;++o){let n=i.irregularSpacing.values[o];e.push(A(r.reference,n,r.unit))}}return e}computeVoxelSpaceLocation(i){if(!this.isValid)return[0,0,0];if(this.volumeType==="xyt")return L.getLogger(this).error("computeVoxelSpacePosition cannot be used with XYT volumes."),[0,0,0];if(!C(this.spatialReference,i.spatialReference))return L.getLogger(this).error("pos argument should have the same spatial reference as the VoxelLayer."),[0,0,0];let e=_(i.x,i.y,i.z??0);M(e,e,this.originInLayerSpace3D),E(e,e,this.voxelSizeInLayerSpaceSigned);let r=this.dimensions[this.zDimension];if(!r.isRegular&&Array.isArray(r.irregularSpacing?.values)&&r.irregularSpacing.values.length>1){let o=i.z??0,n=r.irregularSpacing.values,a=r.isPositiveUp?1:-1,f=n.reduce((u,N)=>Math.abs(a*N-o)<Math.abs(a*u-o)?N:u);for(let u=0;u<n.length;++u)if(n[u]===f){e[2]=u;break}}return[e[0],e[1],e[2]]}computeLayerSpaceLocation(i){if(!this.isValid)return new w({x:0,y:0,spatialReference:this.spatialReference});let e=W(i);if(k(e,e,this.voxelSizeInLayerSpaceSigned),Z(e,e,this.originInLayerSpace3D),this.volumeType==="xyt")return new w({x:e[0],y:e[1],spatialReference:this.spatialReference});let r=this.dimensions[this.zDimension];return r.isRegular||Array.isArray(r.irregularSpacing?.values)&&(i[2]<0?e[2]=r.irregularSpacing.values[0]:i[2]<r.irregularSpacing.values.length?e[2]=r.irregularSpacing.values[i[2]]:e[2]=r.irregularSpacing.values[r.irregularSpacing.values.length-1],r.isPositiveUp||(e[2]*=-1)),new w({x:e[0],y:e[1],z:e[2],spatialReference:this.spatialReference})}};t([s({type:Number,json:{write:{enabled:!0,isRequired:!0}}})],l.prototype,"id",void 0),t([s({type:[Y],json:{write:{enabled:!0,isRequired:!0}}})],l.prototype,"dimensions",void 0),t([s({type:$,json:{read:{enabled:!1}}})],l.prototype,"spatialReference",void 0),t([s({type:Number,json:{read:!1}})],l.prototype,"zDimension",null),t([s({type:[Boolean],json:{read:!1}})],l.prototype,"isValid",null),t([s({type:[Number],json:{read:!1}})],l.prototype,"originInLayerSpace3D",null),t([s({type:[Number],json:{read:!1}})],l.prototype,"voxelSizeInLayerSpaceSigned",null),t([s({type:["xyz","xyzt","xyt"],json:{read:{enabled:!1}}})],l.prototype,"volumeType",null),t([s({type:[Number],json:{read:!1}})],l.prototype,"sizeInVoxels",null),t([s({type:[Date],json:{read:!1,write:!1}})],l.prototype,"timeStops",null),l=t([d("esri.layers.voxel.VoxelVolume")],l);var Ye=l;export{Ye as a};
