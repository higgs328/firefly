import{a as u}from"./chunk-UDMXK7SH.js";import{f as c,g as M,i as O,l as P,m as L}from"./chunk-ZEWUF6OQ.js";import{a as S}from"./chunk-ZTR6OS44.js";import{a as _}from"./chunk-VRTKAD2J.js";import{a as w}from"./chunk-DBLKLHK2.js";import{a as g}from"./chunk-K75TK42V.js";import{a as C}from"./chunk-G4DZJMGT.js";import{a as o,j as a}from"./chunk-TG45K3WR.js";import{b as d}from"./chunk-ACP3S2CH.js";import{a as l}from"./chunk-QGVBCWUY.js";import{H as f}from"./chunk-MYO4NP2N.js";import{b as h,e as s}from"./chunk-NFIPKH6V.js";import{l as v}from"./chunk-5QEXLALV.js";import{y as m}from"./chunk-QBWJMFH5.js";var p,D=d.ofType({key:"type",defaultKeyValue:"button",base:w,typeMap:{button:S,toggle:_}}),I=d.ofType(D),b="layer",y="child-list-mode",V="hide",i=p=class extends g.IdentifiableMixin(f){constructor(t){super(t),this.actionsSections=new I,this.actionsOpen=!1,this.checkPublishStatusEnabled=!1,this.children=new(d.ofType(p)),this.childrenSortable=!0,this.hidden=!1,this.layer=null,this.listItemCreatedFunction=null,this.listModeDisabled=!1,this.open=!1,this.panel=null,this.parent=null,this.view=null}initialize(){if(this.addHandles([o(()=>[this.layer,this.layer?.listMode,this.listModeDisabled],()=>this._watchLayerProperties(this.layer),a),o(()=>this.checkPublishStatusEnabled,t=>this._updateChildrenPublishing(t),a),o(()=>this.view,t=>this._updateChildrenView(t),a),o(()=>this.panel,t=>this._setListItemOnPanel(t),a)]),typeof this.listItemCreatedFunction=="function"){let t={item:this};this.listItemCreatedFunction.call(null,t)}}destroy(){this.panel?.destroy(),this.children.destroyAll(),this.view=null}get connectionStatus(){let{layerView:t,publishing:e}=this;if(!e&&t&&"connectionStatus"in t)return t.connectionStatus}get error(){return this.layer?.loadError}get incompatible(){let{layerView:t}=this;return!(!t||!("spatialReferenceSupported"in t))&&!t.spatialReferenceSupported}get layerView(){let{layer:t,view:e}=this;if(!t||!e||t.type==="sublayer")return null;let r=t.type==="subtype-sublayer"?t.parent:t;return e.allLayerViews.find(n=>n.layer===r)??null}castPanel(t){return this.panel?.open&&!t.hasOwnProperty("open")&&(t.open=!0),t?new u(t):null}get sortable(){return this.layer?.type!=="knowledge-graph-sublayer"&&this._get("sortable")}set sortable(t){this._set("sortable",t)}get title(){let t=h(this,"layer.layer");return(!t||t&&h(this,"layer.layer.loaded"))&&h(this,"layer.title")||h(this,"layer.attributes.title")||""}set title(t){this._override("title",t)}get publishing(){let{layer:t,checkPublishStatusEnabled:e}=this;return!!(e&&t&&"publishingInfo"in t&&t.publishingInfo?.status==="publishing")}get updating(){let{layerView:t,connectionStatus:e,layer:r,publishing:n}=this;return!n&&!e&&(t?t.updating:r?.loadStatus==="loading"||!1)}get visible(){return!!this.layer?.visible}set visible(t){let e=this.layer;e&&(e.visible=t)}get visibleAtCurrentScale(){return this.layerView?.visibleAtCurrentScale??!L(this.layer,this.view?.scale)}get visibleAtCurrentTimeExtent(){return this.layerView?.visibleAtCurrentTimeExtent??!0}get visibilityMode(){return M(this.layer)}clone(){return new p({actionsSections:this.actionsSections.clone(),actionsOpen:this.actionsOpen,checkPublishStatusEnabled:this.checkPublishStatusEnabled,children:this.children.clone(),childrenSortable:this.childrenSortable,hidden:this.hidden,layer:this.layer,listItemCreatedFunction:this.listItemCreatedFunction,listModeDisabled:this.listModeDisabled,open:this.open,panel:this.panel,parent:this.parent,sortable:this.sortable,title:this.title,view:this.view,visible:this.visible})}_setListItemOnPanel(t){t&&(t.listItem=this)}_updateChildrenPublishing(t){this.children?.forEach(e=>e.checkPublishStatusEnabled=t)}_updateChildrenView(t){let e=this.children;e&&e.forEach(r=>r.view=t)}_createChildren(t){let{listModeDisabled:e,children:r}=this,n=t.filter(E=>!r.some(A=>A.layer===E));r.addMany(this._createChildItems(n,e))}_destroyChildren(t){let{children:e}=this,r=e.filter(n=>!!n.layer&&!t.includes(n.layer));e.destroyMany(r)}_sortChildren(t){this.children.sort((e,r)=>t.indexOf(r.layer)-t.indexOf(e.layer))}_destroyAllChildren(){this.removeHandles(y),this.children.destroyAll()}_watchChildLayerListMode(t){this.removeHandles(y),this.listModeDisabled||this.addHandles(t.toArray().map(e=>o(()=>e.listMode,()=>this._compileChildren(t))),y)}_compileChildren(t){let e=this.listModeDisabled?t:t?.filter(r=>c(r)!==V);t?.length?(this._createChildren(e),this._destroyChildren(e),this._sortChildren(e),this._watchChildLayerListMode(t)):this._destroyAllChildren()}_watchSublayerChanges(t){t&&this.addHandles(t.on("change",()=>this._compileChildren(t)),b)}_initializeChildLayers(t){this._compileChildren(t),this._watchSublayerChanges(t)}_createChildItems(t,e){return t.reverse().map(r=>e||P(r)?new p({layer:r,checkPublishStatusEnabled:this.checkPublishStatusEnabled,listItemCreatedFunction:this.listItemCreatedFunction,listModeDisabled:this.listModeDisabled,parent:this,view:this.view}):null).filter(m)}_watchLayerProperties(t){if(this.removeHandles(b),this.removeHandles(y),!t)return;if((!this.listModeDisabled&&c(t))==="hide-children")return void this.children.destroyAll();let e=O(t);e&&this.addHandles(o(()=>t[e],r=>{t.hasOwnProperty(e)&&this._initializeChildLayers(r)},a),b)}};l([s({type:I})],i.prototype,"actionsSections",void 0),l([s()],i.prototype,"actionsOpen",void 0),l([s()],i.prototype,"checkPublishStatusEnabled",void 0),l([s({type:d.ofType(i)})],i.prototype,"children",void 0),l([s()],i.prototype,"childrenSortable",void 0),l([s({readOnly:!0})],i.prototype,"connectionStatus",null),l([s({readOnly:!0})],i.prototype,"error",null),l([s()],i.prototype,"hidden",void 0),l([s({readOnly:!0})],i.prototype,"incompatible",null),l([s()],i.prototype,"layer",void 0),l([s({readOnly:!0})],i.prototype,"layerView",null),l([s()],i.prototype,"listItemCreatedFunction",void 0),l([s({nonNullable:!0})],i.prototype,"listModeDisabled",void 0),l([s()],i.prototype,"open",void 0),l([s({type:u})],i.prototype,"panel",void 0),l([C("panel")],i.prototype,"castPanel",null),l([s()],i.prototype,"parent",void 0),l([s({value:!0})],i.prototype,"sortable",null),l([s()],i.prototype,"title",null),l([s({readOnly:!0})],i.prototype,"publishing",null),l([s({readOnly:!0})],i.prototype,"updating",null),l([s()],i.prototype,"view",void 0),l([s()],i.prototype,"visible",null),l([s({readOnly:!0})],i.prototype,"visibleAtCurrentScale",null),l([s({readOnly:!0})],i.prototype,"visibleAtCurrentTimeExtent",null),l([s({readOnly:!0})],i.prototype,"visibilityMode",null),i=p=l([v("esri.widgets.LayerList.ListItem")],i);var W=i;export{W as a};
