import{a as x}from"./chunk-AKKUUEQK.js";import{q as p}from"./chunk-3KUXZU2N.js";var y=class{constructor(s,r){this.sourceTile=r,this.xTile=0,this.yTile=0,this.hash=0,this.priority=1,this.featureIndex=0,this.colliders=[],this.textVertexRanges=[],this.iconVertexRanges=[],this.tile=s}},d=class{constructor(){this.tileSymbols=[],this.parts=[{startTime:0,startOpacity:0,targetOpacity:0,show:!1},{startTime:0,startOpacity:0,targetOpacity:0,show:!1}],this.show=!1}};function B(o,s,r,t,l,i){let a=r-l;if(a>=0)return(s>>a)+(t-(i<<a))*(o>>a);let h=-a;return s-(i-(t<<h))*(o>>h)<<h}var g=class{constructor(s,r,t){this._rows=Math.ceil(r/t),this._columns=Math.ceil(s/t),this._cellSize=t,this.cells=new Array(this._rows);for(let l=0;l<this._rows;l++){this.cells[l]=new Array(this._columns);for(let i=0;i<this._columns;i++)this.cells[l][i]=[]}}getCell(s,r){let t=Math.min(Math.max(Math.floor(r/this._cellSize),0),this._rows-1),l=Math.min(Math.max(Math.floor(s/this._cellSize),0),this._columns-1);return this.cells[t]&&this.cells[t][l]||null}getCellSpan(s,r,t,l){return[Math.min(Math.max(Math.floor(s/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(r/this._cellSize),0),this.rows-1),Math.min(Math.max(Math.floor(t/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(l/this._cellSize),0),this.rows-1)]}get cellSize(){return this._cellSize}get columns(){return this._columns}get rows(){return this._rows}};function v(o,s,r,t,l,i,a){let h=s[t++];for(let c=0;c<h;c++){let e=new y(i,a);e.xTile=s[t++],e.yTile=s[t++],e.hash=s[t++],e.priority=s[t++],e.featureIndex=s[t++];let f=s[t++];for(let m=0;m<f;m++){let S=s[t++],M=s[t++],w=s[t++],O=s[t++],_=!!s[t++],T=s[t++],b=r[t++],z=r[t++],R=s[t++],V=s[t++];e.colliders.push({xTile:S,yTile:M,dxPixels:w,dyPixels:O,hard:_,partIndex:T,width:R,height:V,minLod:b,maxLod:z})}let n=o[t++];for(let m=0;m<n;m++)e.textVertexRanges.push([o[t++],o[t++]]);let u=o[t++];for(let m=0;m<u;m++)e.iconVertexRanges.push([o[t++],o[t++]]);l.push(e)}return t}function A(o,s,r){for(let[t,l]of o.symbols)C(o,s,r,l,t)}function C(o,s,r,t,l){let i=o.layerData.get(l);if(i.type===x.SYMBOL){for(let a of t){let h=a.unique,c;if(a.selectedForRendering){let e=h.parts[0],f=e.startOpacity,n=e.targetOpacity;o.allSymbolsFadingOut=o.allSymbolsFadingOut&&n===0;let u=r?Math.floor(127*f)|n<<7:n?255:0;c=u<<24|u<<16|u<<8|u}else c=0;for(let[e,f]of a.iconVertexRanges)for(let n=e;n<e+f;n+=4)i.iconOpacity[n/4]=c;if(a.selectedForRendering){let e=h.parts[1],f=e.startOpacity,n=e.targetOpacity;o.allSymbolsFadingOut=o.allSymbolsFadingOut&&n===0;let u=r?Math.floor(127*f)|n<<7:n?255:0;c=u<<24|u<<16|u<<8|u}else c=0;for(let[e,f]of a.textVertexRanges)for(let n=e;n<e+f;n+=4)i.textOpacity[n/4]=c}i.lastOpacityUpdate=s,i.opacityChanged=!0}}function P(o,s,r,t){let l=o.colliders,i,a,h,c;for(let e of l)if(o.unique.show&&o.unique.parts[e.partIndex].show&&(i=e.xScreen-t[0]+e.dxScreen,a=e.yScreen-t[1]+e.dyScreen,h=i+e.width,c=a+e.height,p(r,s.x,s.y,i,a,h,c)))return!0;return!1}export{d as a,B as b,g as c,v as d,A as e,P as f};
