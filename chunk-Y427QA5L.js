import{a as P}from"./chunk-6ZXO4WLE.js";import{a as S,c as s,l as V}from"./chunk-4QUJ4QFY.js";import{b as I}from"./chunk-NSUARQNU.js";import{c as R,e as b,o as f}from"./chunk-HD5Z6MAY.js";import{a as T}from"./chunk-LAX5536Z.js";import{a}from"./chunk-QGVBCWUY.js";import{e as n}from"./chunk-NFIPKH6V.js";import{l as F}from"./chunk-5QEXLALV.js";import{b as w}from"./chunk-YOFFGXOB.js";import{f as p}from"./chunk-VTHXE323.js";var W=j=>{let t=class extends j{constructor(){super(...arguments),this.layer=null,this.tileInfo=null}get fullExtent(){try{return this.layer.loaded?this._getFullExtent():null}catch{return null}}get timeExtent(){return P(this.layer,this.view?.timeExtent,this._get("timeExtent"))}get hasTilingEffects(){return!!(this.layer.renderer&&"dynamicRangeAdjustment"in this.layer.renderer&&this.layer.renderer.dynamicRangeAdjustment)}get datumTransformation(){try{return this.layer.loaded?R(this.layer.fullExtent,this.view.spatialReference,!0):null}catch{return null}}supportsSpatialReference(o){try{return!this.layer.loaded||!!f(this.layer.serviceRasterInfo,o)}catch{return!1}}fetchPopupFeaturesAtLocation(o,y){return p(this,null,function*(){let{layer:e}=this;if(!o)throw new w("imageryTileLayerView:fetchPopupFeatures","Nothing to fetch without area",{layer:e});let{popupEnabled:D}=e,L=I(e,y);if(!D||L==null)return[];let d=[],{value:u,magdirValue:h,processedValue:O}=yield e.identify(o,{timeExtent:this.timeExtent,signal:y?.signal}),c="";if(u?.length){c=e.type==="imagery-tile"&&e.hasStandardTime()&&u[0]!=null?u.map(l=>e.getStandardTimeValue(l)).join(", "):u.join(", ");let r={ObjectId:0};r[s.servicePixelValue]=e.type==="imagery-tile"&&e.raster.datasetFormat==="Function"?O?.join(", "):c,r[s.rawServicePixelValue]=c;let g=e.raster?.rasterInfo??e.serviceRasterInfo,x=g?.attributeTable;if(x!=null){let{fields:l,features:A}=x,E=l.find(({name:i})=>i.toLowerCase()==="value"),N=r[s.servicePixelValue],m=E?A.find(i=>String(i.attributes[E.name])===N):null;if(m)for(let i in m.attributes)m.attributes.hasOwnProperty(i)&&(r[S+i]=m.attributes[i])}let v=g?.dataType;if(v!=="vector-magdir"&&v!=="vector-uv"||(r[s.magnitude]=h?.[0],r[s.direction]=h?.[1]),e.type==="imagery-tile"){let{multidimensionalDefinition:l}=this.layer.normalizeRasterFetchOptions({timeExtent:this.timeExtent});V(e.rasterFields,r,l)}let _=new T({geometry:this.fullExtent?.clone(),attributes:r,layer:e,sourceLayer:e});d.push(_)}return d})}getSourceScale(){return p(this,null,function*(){return yield this.layer.load(),b(this.layer.serviceRasterInfo,this.view.spatialReference)})}_getFullExtent(){return f(this.layer.serviceRasterInfo,this.view.spatialReference)}};return a([n()],t.prototype,"fullExtent",null),a([n()],t.prototype,"layer",void 0),a([n({readOnly:!0})],t.prototype,"timeExtent",null),a([n()],t.prototype,"tileInfo",void 0),a([n({readOnly:!0})],t.prototype,"hasTilingEffects",null),a([n()],t.prototype,"datumTransformation",null),t=a([F("esri.views.layers.ImageryTileLayerView")],t),t};export{W as a};
