import{a as c,b as y}from"./chunk-WBPLJNRU.js";import{c as F}from"./chunk-E2J2V7JN.js";import{d as v,i as T}from"./chunk-PHODKV66.js";import{a as m}from"./chunk-JPMGMA4B.js";import{A as h,e as w,n as S,u as R,v as g,w as W}from"./chunk-6B5XFA6F.js";import{a as i}from"./chunk-BCREO4Q5.js";import{a}from"./chunk-BOVYXYHK.js";import{c as o}from"./chunk-VIEK2X23.js";import{y as u}from"./chunk-QBWJMFH5.js";function n(r,e,t=null){return t!=null?[r,e,t]:[r,e]}function C(r,e,t=null){return t!=null?{x:r,y:e,z:t}:{x:r,y:e}}var l=class{constructor(e){this.spatialReference=e}mapToLocalMultiple(e){return e.map(t=>this.mapToLocal(t)).filter(u)}get doUnnormalization(){return!1}},f=class extends l{constructor(e,t,s=null){super(t),this._defaultZ=s,this.transform=c(),this.transformInv=c(),this.transform=y(e),F(this.transformInv,this.transform)}makeMapPoint(e,t){return n(e,t,this._defaultZ)}mapToLocal(e){return C(this.transform[0]*e[0]+this.transform[2]*e[1]+this.transform[4],this.transform[1]*e[0]+this.transform[3]*e[1]+this.transform[5])}localToMap(e){return n(this.transformInv[0]*e.x+this.transformInv[2]*e.y+this.transformInv[4],this.transformInv[1]*e.x+this.transformInv[3]*e.y+this.transformInv[5],this._defaultZ)}},d=class extends l{constructor(e,t){super(e.spatialReference),this.view=e,this.defaultZ=null,this.pWS=a(),this.tangentFrameUpWS=a(),this.tangentFrameRightWS=a(),this.tangentFrameForwardWS=a(),this.localFrameRightWS=a(),this.localFrameUpWS=a(),this.worldToLocalTransform=m(),this.localToWorldTransform=m(),this.scale=1,this.scale=e.resolution,this.referenceMapPoint=t,this.defaultZ=t.hasZ?t.z:null;let s=e.state.camera.viewRight;this.view.renderCoordsHelper.toRenderCoords(this.referenceMapPoint,this.pWS),this.view.renderCoordsHelper.worldBasisAtPosition(this.pWS,i.X,this.tangentFrameRightWS),this.view.renderCoordsHelper.worldBasisAtPosition(this.pWS,i.Y,this.tangentFrameUpWS),this.view.renderCoordsHelper.worldBasisAtPosition(this.pWS,i.Z,this.tangentFrameForwardWS);let p=a();S(p,this.tangentFrameForwardWS,g(s,this.tangentFrameForwardWS)),w(this.localFrameRightWS,s,p),R(this.localFrameRightWS,this.localFrameRightWS),W(this.localFrameUpWS,this.tangentFrameForwardWS,this.localFrameRightWS),T(this.worldToLocalTransform,this.localFrameRightWS,this.tangentFrameRightWS),v(this.localToWorldTransform,this.worldToLocalTransform)}get doUnnormalization(){return this.view.viewingMode==="global"}makeMapPoint(e,t){return n(e,t,this.defaultZ)}mapToLocal(e){let t=a();this.view.renderCoordsHelper.toRenderCoords(new o({x:e[0],y:e[1],spatialReference:this.spatialReference}),t),h(t,t,this.worldToLocalTransform);let s=this.view.renderCoordsHelper.fromRenderCoords(t,new o({spatialReference:this.view.spatialReference}));return s!=null?C(s.x/this.scale,s.y/this.scale):null}localToMap(e){let t=a();this.view.renderCoordsHelper.toRenderCoords(new o({x:e.x*this.scale,y:e.y*this.scale,spatialReference:this.spatialReference}),t),h(t,t,this.localToWorldTransform);let s=this.view.renderCoordsHelper.fromRenderCoords(t,new o({spatialReference:this.view.spatialReference}));return s!=null?n(s.x,s.y,this.defaultZ):null}};function z(r,e){if(r.type==="2d")return new f(r.state.transform,r.spatialReference,e.length>2?e[2]:null);if(r.type==="3d"){let t=e.length>2?new o({x:e[0],y:e[1],z:e[2],spatialReference:r.spatialReference}):new o({x:e[0],y:e[1],spatialReference:r.spatialReference});return new d(r,t)}return null}export{C as a,f as b,z as c};
