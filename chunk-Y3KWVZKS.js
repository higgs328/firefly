import{b as _}from"./chunk-ZWHAEUE3.js";import{a as et}from"./chunk-E56W4PK4.js";import{a as rt}from"./chunk-BAEF3CT6.js";var at,ht;(function(t){t[t.matchAny=0]="matchAny",t[t.matchAll=1]="matchAll"})(at||(at={})),function(t){t[t.bestMatch=0]="bestMatch",t[t.fail=1]="fail"}(ht||(ht={}));var Wt=6;function F(t){return t!=null&&t.declaredClass==="esri.layers.support.PixelBlock"&&t.pixels&&t.pixels.length>0}function Ot(t){if(!t?.length||t.some(n=>!F(n)))return null;if(t.length===1)return t[0]?.clone()??null;let i=t,{width:e,height:o,pixelType:r}=i[0];if(i.some(n=>n.width!==e||n.height!==o))return null;let l=i.map(({mask:n})=>n).filter(n=>n!=null),h=null;l.length&&(h=new Uint8Array(e*o),h.set(l[0]),l.length>1&&mt(l.slice(1),h));let c=[];i.forEach(({pixels:n})=>c.push(...n));let u=i.map(({statistics:n})=>n).filter(n=>n?.length),s=[];return u.forEach(n=>s.push(...n)),new _({pixelType:r,width:e,height:o,mask:h,pixels:c,statistics:s.length?s:null})}function Lt(t){if(!t)return;let i=t.colormap;if(!i||i.length===0)return;let e=i.sort((a,p)=>a[0]-p[0]),o=0;e[0][0]<0&&(o=e[0][0]);let r=Math.max(256,e[e.length-1][0]-o+1),l=new Uint8Array(4*r),h=[],c,u=0,s=0,n=e[0].length===5;if(r>65536)return e.forEach(a=>{h[a[0]-o]=n?a.slice(1):a.slice(1).concat([255])}),{indexed2DColormap:h,offset:o,alphaSpecified:n};if(t.fillUnspecified)for(c=e[s],u=c[0]-o;u<r;u++)l[4*u]=c[1],l[4*u+1]=c[2],l[4*u+2]=c[3],l[4*u+3]=n?c[4]:255,u===c[0]-o&&(c=s===e.length-1?c:e[++s]);else for(u=0;u<e.length;u++)c=e[u],s=4*(c[0]-o),l[s]=c[1],l[s+1]=c[2],l[s+2]=c[3],l[s+3]=n?c[4]:255;return{indexedColormap:l,offset:o,alphaSpecified:n}}function zt(t,i){if(!F(t)||!i||!i.indexedColormap&&!i.indexed2DColormap)return t;let e=t.clone(),o=e.pixels,r=e.mask,l=e.width*e.height;if(o.length!==1)return t;let{indexedColormap:h,indexed2DColormap:c,offset:u,alphaSpecified:s}=i,n=0,a=o[0],p=new Uint8Array(a.length),f=new Uint8Array(a.length),m=new Uint8Array(a.length),d,x=0;if(h){let g=h.length-1;if(r!=null)for(n=0;n<l;n++)r[n]&&(x=4*(a[n]-u),x<u||x>g?r[n]=0:(p[n]=h[x],f[n]=h[x+1],m[n]=h[x+2],r[n]=h[x+3]));else{for(r=new Uint8Array(l),n=0;n<l;n++)x=4*(a[n]-u),x<u||x>g?r[n]=0:(p[n]=h[x],f[n]=h[x+1],m[n]=h[x+2],r[n]=h[x+3]);e.mask=r}}else if(c)if(r!=null)for(n=0;n<l;n++)r[n]&&(d=c[a[n]],p[n]=d[0],f[n]=d[1],m[n]=d[2],r[n]=d[3]);else{for(r=new Uint8Array(l),n=0;n<l;n++)d=c[a[n]],p[n]=d[0],f[n]=d[1],m[n]=d[2],r[n]=d[3];e.mask=r}return e.pixels=[p,f,m],e.statistics=null,e.pixelType="u8",e.maskIsAlpha=s,e}function Jt(t,i){if(!F(t))return null;let{pixels:e,mask:o}=t,r=e.length,l=i.lut,{offset:h}=i;l&&l[0].length===1&&(l=e.map(()=>l));let c=[],u=i.outputPixelType||"u8";for(let n=0;n<r;n++){let a=pt(e[n],o,l[n],h||0,u);c.push(a)}let s=new _({width:t.width,height:t.height,pixels:c,mask:o,pixelType:u});return s.updateStatistics(),s}function pt(t,i,e,o,r){let l=t.length,h=_.createEmptyBand(r,l);if(i)for(let c=0;c<l;c++)i[c]&&(h[c]=e[t[c]-o]);else for(let c=0;c<l;c++)h[c]=e[t[c]-o];return h}function jt(t,i){if(!F(t))return null;let e=t.clone(),{pixels:o}=e,r=e.width*e.height,l=i.length,h=Math.floor(l/2),c=i[Math.floor(h)],u=o[0],s,n,a,p,f,m,d=!1,x=new Uint8Array(r),g=new Uint8Array(r),M=new Uint8Array(r),w=e.mask,b=i[0].mappedColor.length===4;for(w||(w=new Uint8Array(r),w.fill(b?255:1),e.mask=w),f=0;f<r;f++)if(w[f]){for(s=u[f],d=!1,m=h,n=c,a=0,p=l-1;p-a>1;){if(s===n.value){d=!0;break}s>n.value?a=m:p=m,m=Math.floor((a+p)/2),n=i[Math.floor(m)]}d||(s===i[a].value?(n=i[a],d=!0):s===i[p].value?(n=i[p],d=!0):s<i[a].value?(d=!1,n=null):s>i[a].value&&(s<i[p].value?(n=i[a],d=!0):p===l-1?(d=!1,n=null):(n=i[p],d=!0))),d?(x[f]=n.mappedColor[0],g[f]=n.mappedColor[1],M[f]=n.mappedColor[2],w[f]=n.mappedColor[3]):x[f]=g[f]=M[f]=w[f]=0}return e.pixels=[x,g,M],e.mask=w,e.pixelType="u8",e.maskIsAlpha=b,e}function qt(t,i){if(!F(t))return null;let{width:e,height:o}=t,{inputRanges:r,outputValues:l,outputPixelType:h,noDataRanges:c,allowUnmatched:u,isLastInputRangeInclusive:s}=i,n=t.pixels[0],a=_.createEmptyBand(h,n.length),p=t.mask,f=new Uint8Array(e*o);p?f.set(p):f.fill(255);let m=t.pixelType.startsWith("f")?1e-6:0,d=r.map(b=>b-m);d[0]=r[0],d[d.length-1]=r[r.length-1]+(s?1e-6:0);let x=r.length/2,[g,M]=et(h);for(let b=0;b<o;b++)for(let y=0;y<e;y++){let P=b*e+y;if(f[P]){let k=n[P],U=!1;for(let B=x-1;B>=0;B--)if(k===d[2*B]||k>d[2*B]&&k<d[2*B+1]){a[P]=l[B],U=!0;break}U||(u?a[P]=k>M?M:k<g?g:k:f[P]=0)}}let w=c?.length;if(w)for(let b=0;b<o;b++)for(let y=0;y<e;y++){let P=b*e+y;if(!p||p[P]){let k=n[P];for(let U=0;U<w;U+=2)if(k>=c[U]&&k<=c[U+1]){a[P]=0,f[P]=0;break}}}return new _({width:e,height:o,pixelType:h,pixels:[a],mask:f})}function ct(t,i,e,o){let r=e!=null&&e.length>=2?new Set(e):null,l=e?.length===1?e[0]:null,h=!!i?.length;for(let c=0;c<t.length;c++)if(o[c]){let u=t[c];if(h){let s=!1;for(let n=0;n<i.length;n+=2)if(u>=i[n]&&u<=i[n+1]){s=!0;break}s||(o[c]=0)}o[c]&&(u===l||r?.has(u))&&(o[c]=0)}}function ft(t,i){let e=t[0].length;for(let o=0;o<e;o++)if(i[o]){let r=!1;for(let l=0;l<t.length;l++)if(t[l][o]){r=!0;break}r||(i[o]=0)}}function mt(t,i){let e=t[0].length;for(let o=0;o<e;o++)if(i[o]){let r=!1;for(let l=0;l<t.length;l++)if(t[l][o]===0){r=!0;break}r&&(i[o]=0)}}function Kt(t,i){if(!F(t))return null;let{width:e,height:o,pixels:r}=t,l=e*o,h=new Uint8Array(l);t.mask?h.set(t.mask):h.fill(255);let c=r.length,{includedRanges:u,noDataValues:s,outputPixelType:n,matchAll:a,lookups:p}=i;if(p){let f=[];for(let m=0;m<c;m++){let d=p[m],x=pt(r[m],h,d.lut,d.offset||0,"u8");f.push(x)}f.length===1?h.set(f[0]):a?ft(f,h):mt(f,h)}else if(a){let f=[];for(let m=0;m<c;m++){let d=new Uint8Array(l);d.set(h),ct(r[m],u?.slice(2*m,2*m+2),s?.[m],d),f.push(d)}f.length===1?h.set(f[0]):ft(f,h)}else for(let f=0;f<c;f++)ct(r[f],u?.slice(2*f,2*f+2),s?.[f],h);return new _({width:e,height:o,pixelType:n,pixels:r,mask:h})}function Xt(t){let{srcPixelType:i,inputRanges:e,outputValues:o,allowUnmatched:r,noDataRanges:l,isLastInputRangeInclusive:h,outputPixelType:c}=t;if(i!=="u8"&&i!=="s8"&&i!=="u16"&&i!=="s16")return null;let u=i.includes("16")?65536:256,s=i.includes("s")?-u/2:0,n=_.createEmptyBand(c,u),a=new Uint8Array(u);r&&a.fill(255);let[p,f]=et(c);if(e?.length&&o?.length){let d=e.map(x=>x-1e-6);d[0]=e[0],h&&(d[d.length-1]=e[e.length-1]);for(let x=0;x<d.length;x++){let g=o[x]>f?f:o[x]<p?p:o[x],M=Math.ceil(d[2*x]-s),w=Math.floor(d[2*x+1]-s);for(let b=M;b<=w;b++)n[b]=g,a[b]=255}}if(l?.length)for(let m=0;m<l.length;m++){let d=Math.ceil(l[2*m]-s),x=Math.floor(l[2*m+1]-s);for(let g=d;g<=x;g++)a[g]=0}return{lut:n,offset:s,mask:a}}function $t(t,i,e){if(t!=="u8"&&t!=="s8"&&t!=="u16"&&t!=="s16")return null;let o=t.includes("16")?65536:256,r=t.includes("s")?-o/2:0,l=new Uint8Array(o);if(i)for(let h=0;h<i.length;h++){let c=Math.ceil(i[2*h]-r),u=Math.floor(i[2*h+1]-r);for(let s=c;s<=u;s++)l[s]=255}else l.fill(255);if(e)for(let h=0;h<e.length;h++)l[e[h]-r]=0;return{lut:l,offset:r}}function vt(t,i,e,o,r,l,h,c){return{xmin:r<=e*t?0:r<e*t+t?r-e*t:t,ymin:l<=o*i?0:l<o*i+i?l-o*i:i,xmax:r+h<=e*t?0:r+h<e*t+t?r+h-e*t:t,ymax:l+c<=o*i?0:l+c<o*i+i?l+c-o*i:i}}function Gt(t,i){if(!t||t.length===0)return null;let e=t.find(m=>m.pixelBlock);if(e?.pixelBlock==null)return null;let o=(e.extent.xmax-e.extent.xmin)/e.pixelBlock.width,r=(e.extent.ymax-e.extent.ymin)/e.pixelBlock.height,l=.01*Math.min(o,r),h=t.sort((m,d)=>Math.abs(m.extent.ymax-d.extent.ymax)>l?d.extent.ymax-m.extent.ymax:Math.abs(m.extent.xmin-d.extent.xmin)>l?m.extent.xmin-d.extent.xmin:0),c=Math.min.apply(null,h.map(m=>m.extent.xmin)),u=Math.min.apply(null,h.map(m=>m.extent.ymin)),s=Math.max.apply(null,h.map(m=>m.extent.xmax)),n=Math.max.apply(null,h.map(m=>m.extent.ymax)),a={x:Math.round((i.xmin-c)/o),y:Math.round((n-i.ymax)/r)},p={width:Math.round((s-c)/o),height:Math.round((n-u)/r)},f={width:Math.round((i.xmax-i.xmin)/o),height:Math.round((i.ymax-i.ymin)/r)};return Math.round(p.width/e.pixelBlock.width)*Math.round(p.height/e.pixelBlock.height)!==h.length||a.x<0||a.y<0||p.width<f.width||p.height<f.height?null:{extent:i,pixelBlock:Pt(h.map(m=>m.pixelBlock),p,{clipOffset:a,clipSize:f})}}function nt(t,i,e,o,r,l){let{width:h,height:c}=e.block,{x:u,y:s}=e.offset,{width:n,height:a}=e.mosaic,p=vt(h,c,o,r,u,s,n,a),f=0,m=0;if(l){let d=l.hasGCSSShiftTransform?360:l.halfWorldWidth??0,x=h*l.resolutionX,g=l.startX+o*x;g<d&&g+x>d?m=l.rightPadding:g>=d&&(f=l.leftMargin-l.rightPadding,m=0)}if(p.xmax-=m,typeof i!="number")for(let d=p.ymin;d<p.ymax;d++){let x=(r*c+d-s)*n+(o*h-u)+f,g=d*h;for(let M=p.xmin;M<p.xmax;M++)t[x+M]=i[g+M]}else for(let d=p.ymin;d<p.ymax;d++){let x=(r*c+d-s)*n+(o*h-u)+f;for(let g=p.xmin;g<p.xmax;g++)t[x+g]=i}}function Pt(t,i,e={}){let{clipOffset:o,clipSize:r,alignmentInfo:l,blockWidths:h}=e;if(h)return Tt(t,i,{blockWidths:h});let c=t.find(v=>F(v));if(c==null)return null;let u=r?r.width:i.width,s=r?r.height:i.height,n=c.width,a=c.height,p=i.width/n,f=i.height/a,m={offset:o||{x:0,y:0},mosaic:r||i,block:{width:n,height:a}},d=c.pixelType,x=_.getPixelArrayConstructor(d),g=c.pixels.length,M=[],w,b;for(let v=0;v<g;v++){b=new x(u*s);for(let S=0;S<f;S++)for(let A=0;A<p;A++){let T=t[S*p+A];F(T)&&(w=T.pixels[v],nt(b,w,m,A,S,l))}M.push(b)}let y=t.some(v=>v==null||v.mask!=null&&v.mask.length>0),P=t.some(v=>v?.bandMasks&&v.bandMasks.length>1),k=y?new Uint8Array(u*s):void 0,U=P?[]:void 0;if(k){for(let v=0;v<f;v++)for(let S=0;S<p;S++){let A=t[v*p+S],T=A!=null?A.mask:null;nt(k,T??(A?255:0),m,S,v,l)}if(U)for(let v=0;v<g;v++){let S=new Uint8Array(u*s);for(let A=0;A<f;A++)for(let T=0;T<p;T++){let I=t[A*p+T],D=I?.bandMasks?.[v]??I?.mask;nt(S,D??(I?255:0),m,T,A,l)}U.push(S)}}let B=new _({width:u,height:s,pixels:M,pixelType:d,bandMasks:U,mask:k});return B.updateStatistics(),B}function Tt(t,i,e){let o=t.find(x=>x!=null);if(o==null)return null;let r=t.some(x=>x==null||!!x.mask),{width:l,height:h}=i,c=r?new Uint8Array(l*h):null,{blockWidths:u}=e,s=[],n=o.getPlaneCount(),a=_.getPixelArrayConstructor(o.pixelType);if(r)for(let x=0,g=0;x<t.length;g+=u[x],x++){let M=t[x];if(!F(M))continue;let w=M.mask;for(let b=0;b<h;b++)for(let y=0;y<u[x];y++)c[b*l+y+g]=w==null?255:w[b*M.width+y]}let p=t.some(x=>x?.bandMasks&&x.bandMasks.length>1),f=p?[]:void 0,m=l*h;for(let x=0;x<n;x++){let g=new a(m),M=p?new Uint8Array(m):void 0;for(let w=0,b=0;w<t.length;b+=u[w],w++){let y=t[w];if(!F(y))continue;let P=y.pixels[x];if(P!=null){for(let k=0;k<h;k++)for(let U=0;U<u[w];U++)g[k*l+U+b]=P[k*y.width+U];if(M){let k=y.bandMasks?.[x]??y.mask;for(let U=0;U<h;U++)for(let B=0;B<u[w];B++)M[U*l+B+b]=k?k[U*y.width+B]:255}}}s.push(g),f&&M&&f.push(M)}let d=new _({width:l,height:h,mask:c,bandMasks:f,pixels:s,pixelType:o.pixelType});return d.updateStatistics(),d}function Ht(t,i,e){if(!F(t))return null;let{width:o,height:r}=t,l=i.x,h=i.y,c=e.width+l,u=e.height+h;if(l<0||h<0||c>o||u>r||l===0&&h===0&&c===o&&u===r)return t;t.mask||(t.mask=new Uint8Array(o*r));let s=t.mask;for(let n=0;n<r;n++){let a=n*o;for(let p=0;p<o;p++)s[a+p]=n<h||n>=u||p<l||p>=c?0:1}return t.updateStatistics(),t}function St(t){if(!F(t))return null;let i=t.clone(),{width:e,height:o,pixels:r}=t,l=r[0],h=i.pixels[0],c=t.mask;for(let u=2;u<o-1;u++){let s=new Map;for(let a=u-2;a<u+2;a++)for(let p=0;p<4;p++){let f=a*e+p;X(s,l[f],c?c[f]:1)}h[u*e]=ut(s),h[u*e+1]=h[u*e+2]=h[u*e];let n=3;for(;n<e-1;n++){let a=(u-2)*e+n+1;X(s,l[a],c?c[a]:1),a=(u-1)*e+n+1,X(s,l[a],c?c[a]:1),a=u*e+n+1,X(s,l[a],c?c[a]:1),a=(u+1)*e+n+1,X(s,l[a],c?c[a]:1),a=(u-2)*e+n-3,G(s,l[a],c?c[a]:1),a=(u-1)*e+n-3,G(s,l[a],c?c[a]:1),a=u*e+n-3,G(s,l[a],c?c[a]:1),a=(u+1)*e+n-3,G(s,l[a],c?c[a]:1),h[u*e+n]=ut(s)}h[u*e+n+1]=h[u*e+n]}for(let u=0;u<e;u++)h[u]=h[e+u]=h[2*e+u],h[(o-1)*e+u]=h[(o-2)*e+u];return i.updateStatistics(),i}function ut(t){if(t.size===0)return 0;let i=0,e=-1,o=0,r=t.keys(),l=r.next();for(;!l.done;)o=t.get(l.value),o>i&&(e=l.value,i=o),l=r.next();return e}function G(t,i,e){if(e===0)return;let o=t.get(i);o===1?t.delete(i):t.set(i,o-1)}function X(t,i,e){e!==0&&t.set(i,t.has(i)?t.get(i)+1:1)}function dt(t,i,e){let{x:o,y:r}=i,{width:l,height:h}=e;if(o===0&&r===0&&h===t.height&&l===t.width)return t;let{width:c,height:u}=t,s=Math.max(0,r),n=Math.max(0,o),a=Math.min(o+l,c),p=Math.min(r+h,u);if(a<0||p<0||!F(t))return null;o=Math.max(0,-o),r=Math.max(0,-r);let{pixels:f}=t,m=l*h,d=f.length,x=[];for(let b=0;b<d;b++){let y=f[b],P=_.createEmptyBand(t.pixelType,m);for(let k=s;k<p;k++){let U=k*c,B=(k+r-s)*l+o;for(let v=n;v<a;v++)P[B++]=y[U+v]}x.push(P)}let g=new Uint8Array(m),M=t.mask;for(let b=s;b<p;b++){let y=b*c,P=(b+r-s)*l+o;for(let k=n;k<a;k++)g[P++]=M?M[y+k]:1}let w=new _({width:e.width,height:e.height,pixelType:t.pixelType,pixels:x,mask:g});return w.updateStatistics(),w}function xt(t,i=!0){if(!F(t))return null;let{pixels:e,width:o,height:r,mask:l,pixelType:h}=t,c=[],u=Math.round(o/2),s=Math.round(r/2),n=r-1,a=o-1;for(let f=0;f<e.length;f++){let m=e[f],d=_.createEmptyBand(h,u*s),x=0;for(let g=0;g<r;g+=2)for(let M=0;M<o;M+=2){let w=m[g*o+M];if(i){let b=M===a?w:m[g*o+M+1],y=g===n?w:m[g*o+M+o],P=M===a?y:g===n?b:m[g*o+M+o+1];d[x++]=(w+b+y+P)/4}else d[x++]=w}c.push(d)}let p=null;if(l!=null){p=new Uint8Array(u*s);let f=0;for(let m=0;m<r;m+=2)for(let d=0;d<o;d+=2){let x=l[m*o+d];if(i){let g=d===a?x:l[m*o+d+1],M=m===n?x:l[m*o+d+o],w=d===a?M:m===n?g:l[m*o+d+o+1];p[f++]=x*g*M*w?1:0}else p[f++]=x}}return new _({width:u,height:s,pixelType:h,pixels:c,mask:p})}function Qt(t,i,e=0,o=!0){if(!F(t))return null;let{width:r,height:l}=i,{width:h,height:c}=t,u=new Map,s={x:0,y:0},n=1+e,a=t;for(let p=0;p<n;p++){let f=Math.ceil(h/r),m=Math.ceil(c/l);for(let d=0;d<m;d++){s.y=d*l;for(let x=0;x<f;x++){s.x=x*r;let g=dt(a,s,i);u.set(`${p}/${d}/${x}`,g)}}p<n-1&&(a=xt(a,o)),h=Math.round(h/2),c=Math.round(c/2)}return u}function Yt(t){let{pixelBlock:i,tileSize:e,level:o,row:r,col:l,useBilinear:h}=t;if(!F(i))return null;let{width:c,height:u}=e,s=2**o,n=s*c,a=s*u,p=dt(i,{y:r*a,x:l*n},{width:n,height:a});if(!p)return null;for(let f=o;f>0;f--)p=xt(p,h);return p}function gt(t,i,e,o,r=0){let{width:l,height:h}=t,{width:c,height:u}=i,s=o.cols,n=o.rows,a=Math.ceil(c/s-.1/s),p=Math.ceil(u/n-.1/n),f,m,d,x,g,M,w,b=a*s,y=b*p*n,P=new Float32Array(y),k=new Float32Array(y),U=new Uint32Array(y),B=new Uint32Array(y),v,S,A=0;for(let T=0;T<p;T++)for(let I=0;I<a;I++){f=12*(T*a+I),m=e[f],d=e[f+1],x=e[f+2],g=e[f+3],M=e[f+4],w=e[f+5];for(let D=0;D<n;D++){A=(T*n+D)*b+I*s,S=(D+.5)/n;for(let C=0;C<D;C++)v=(C+.5)/s,P[A+C]=(m*v+d*S+x)*l+r,k[A+C]=(g*v+M*S+w)*h+r,U[A+C]=Math.floor(P[A+C]),B[A+C]=Math.floor(k[A+C])}f+=6,m=e[f],d=e[f+1],x=e[f+2],g=e[f+3],M=e[f+4],w=e[f+5];for(let D=0;D<n;D++){A=(T*n+D)*b+I*s,S=(D+.5)/n;for(let C=D;C<s;C++)v=(C+.5)/s,P[A+C]=(m*v+d*S+x)*l+r,k[A+C]=(g*v+M*S+w)*h+r,U[A+C]=Math.floor(P[A+C]),B[A+C]=Math.floor(k[A+C])}}return{offsets_x:P,offsets_y:k,offsets_xi:U,offsets_yi:B,gridWidth:b}}function Zt(t,i){let{coefficients:e,spacing:o}=i,{offsets_x:r,offsets_y:l,gridWidth:h}=gt(t,t,e,{rows:o[0],cols:o[1]}),{width:c,height:u}=t,s=new Float32Array(c*u),n=180/Math.PI;for(let a=0;a<u;a++)for(let p=0;p<c;p++){let f=a*h+p,m=a===0?f:f-h,d=a===u-1?f:f+h,x=r[m]-r[d],g=l[d]-l[m];if(isNaN(x)||isNaN(g))s[a*c+p]=90;else{let M=Math.atan2(g,x)*n;M=(360+M)%360,s[a*c+p]=M}}return s}function te(t,i,e,o,r="nearest"){if(!F(t))return null;r==="majority"&&(t=St(t));let{pixels:l,mask:h,bandMasks:c,pixelType:u}=t,s=t.width,n=t.height,a=_.getPixelArrayConstructor(u),p=l.length,{width:f,height:m}=i,d=!1;for(let A=0;A<e.length;A+=3)e[A]===-1&&e[A+1]===-1&&e[A+2]===-1&&(d=!0);let{offsets_x:x,offsets_y:g,offsets_xi:M,offsets_yi:w,gridWidth:b}=gt({width:s,height:n},i,e,o,r==="majority"?.5:0),y,P=(A,T,I,D)=>{let C=A instanceof Float32Array||A instanceof Float64Array?0:.5;for(let E=0;E<m;E++){y=E*b;for(let N=0;N<f;N++){if(x[y]<0||g[y]<0)A[E*f+N]=0;else if(D)A[E*f+N]=T[M[y]+w[y]*s];else{let W=Math.floor(x[y]),O=Math.floor(g[y]),J=Math.ceil(x[y]),j=Math.ceil(g[y]),R=x[y]-W,q=g[y]-O;if(!I||I[W+O*s]&&I[J+O*s]&&I[W+j*s]&&I[J+j*s]){let $=(1-R)*T[W+O*s]+R*T[J+O*s],K=(1-R)*T[W+j*s]+R*T[J+j*s];A[E*f+N]=(1-q)*$+q*K+C}else A[E*f+N]=T[M[y]+w[y]*s]}y++}}},k=[],U,B=c?.length===p,v=[];for(let A=0;A<p;A++){if(B){let T=new Uint8Array(f*m);P(T,c[A],c[A],!0),v.push(T)}U=new a(f*m),P(U,l[A],B?c[A]:h,r==="nearest"||r==="majority"),k.push(U)}let S=new _({width:f,height:m,pixelType:u,pixels:k,bandMasks:B?v:void 0});if(h!=null)S.mask=new Uint8Array(f*m),P(S.mask,h,h,!0);else if(d){S.mask=new Uint8Array(f*m);for(let A=0;A<f*m;A++)S.mask[A]=x[A]<0||g[A]<0?0:1}return S.updateStatistics(),S}var z=new Map;z.set("meter-per-second",1),z.set("kilometer-per-hour",.277778),z.set("knots",.514444),z.set("feet-per-second",.3048),z.set("mile-per-hour",.44704);var lt=180/Math.PI,ot=5,Q=new rt({esriMetersPerSecond:"meter-per-second",esriKilometersPerHour:"kilometer-per-hour",esriKnots:"knots",esriFeetPerSecond:"feet-per-second",esriMilesPerHour:"mile-per-hour"});function st(t,i){return z.get(t)/z.get(i)||1}function wt(t){return(450-t)%360}function Mt(t,i="geographic"){let[e,o]=t,r=Math.sqrt(e*e+o*o),l=Math.atan2(o,e)*lt;return l=(360+l)%360,i==="geographic"&&(l=wt(l)),[r,l]}function kt(t,i="geographic"){let e=t[1];i==="geographic"&&(e=wt(e)),e%=360;let o=t[0];return[o*Math.cos(e/lt),o*Math.sin(e/lt)]}function oe(t,i,e,o="geographic"){if(!F(t)||e==null)return t;let r=i==="vector-magdir"?t.clone():yt(t,i),l=r.pixels[1];for(let h=0;h<l.length;h++)l[h]=o==="geographic"?(l[h]+e[h]+270)%360:(l[h]+360-e[h])%360;return i==="vector-magdir"?r:yt(r,"vector-magdir")}function yt(t,i,e="geographic",o=1){if(!F(t))return t;let{pixels:r,width:l,height:h}=t,c=l*h,u=r[0],s=r[1],n=t.pixelType.startsWith("f")?t.pixelType:"f32",a=_.createEmptyBand(n,c),p=_.createEmptyBand(n,c),f=0;for(let d=0;d<h;d++)for(let x=0;x<l;x++)i==="vector-uv"?([a[f],p[f]]=Mt([u[f],s[f]],e),a[f]*=o):([a[f],p[f]]=kt([u[f],s[f]],e),a[f]*=o,p[f]*=o),f++;let m=new _({pixelType:n,width:t.width,height:t.height,mask:t.mask,validPixelCount:t.validPixelCount,maskIsAlpha:t.maskIsAlpha,pixels:[a,p]});return m.updateStatistics(),m}function se(t,i,e=1){if(e===1||!F(t))return t;let o=t.clone(),{pixels:r,width:l,height:h}=o,c=r[0],u=r[1],s=0;for(let n=0;n<h;n++)for(let a=0;a<l;a++)i==="vector-uv"?(c[s]*=e,u[s]*=e):c[s]*=e,s++;return o.updateStatistics(),o}function re(t,i,e,o,r){if(r==null||!r.spatialReference.equals(t.spatialReference))return{extent:t,width:Math.round(i/o),height:Math.round(e/o),resolution:t.width/i};let l=r.xmin,h=r.ymax,c=(t.xmax-t.xmin)/i*o,u=(t.ymax-t.ymin)/e*o,s=(c+u)/2;return t.xmin=l+Math.floor((t.xmin-l)/c)*c,t.xmax=l+Math.ceil((t.xmax-l)/c)*c,t.ymin=h+Math.floor((t.ymin-h)/u)*u,t.ymax=h+Math.ceil((t.ymax-h)/u)*u,{extent:t,width:Math.round(t.width/c),height:Math.round(t.height/u),resolution:s}}var Bt=At(0,0,0);function At(t=0,i=0,e=Math.PI,o=!0){o&&(e=(2*Math.PI-e)%(2*Math.PI));let r=o?-1:1,l=13*r,h=-7*r,c=-2*r,u=-16*r,s=21.75,[n,a]=V(0,i+l,e,s),[p,f]=V(t-5.5,i+h,e,s),[m,d]=V(t+5.5,i+h,e,s),[x,g]=V(t-1.5,i+c,e,s),[M,w]=V(t+1.5,i+c,e,s),[b,y]=V(t-1.5,i+u,e,s),[P,k]=V(t+1.5,i+u,e,s);return[n,a,p,f,x,g,M,w,m,d,b,y,P,k]}function Ct(t=0,i=Math.PI,e=!0){e&&(i=(2*Math.PI-i)%(2*Math.PI));let o=10,r=e?-1:1,l=5*r,h=20*r,c=25*r,u=45,s=0,n=0,a=2,p=0,f=a*r,m=e?1:-1,d=o/2*m,[x,g]=[s+d,n-h],[M,w]=[x+a*m,g],[b,y]=[M-p*m,w+f],[P,k]=[s-d,n-c],[U,B]=[P+p*m,k-f],v=Math.ceil(t/ot),S=Math.floor(v/10);v-=8*S;let A=[],T=[];for(let R=0;R<v/2;R++,S--){S<=0&&v%2==1&&R===(v-1)/2&&(P=s,U=P+p*m,k=(k+g)/2,B=k-f);let[q,$]=V(P,k,i,u);if(S>0){let[K,Y]=V(M,k,i,u),[Z,tt]=V(x,g,i,u);A.push(K),A.push(Y),A.push(q),A.push($),A.push(Z),A.push(tt)}else{let[K,Y]=V(M,w,i,u),[Z,tt]=V(b,y,i,u),[bt,Ut]=V(U,B,i,u);T.push(q),T.push($),T.push(bt),T.push(Ut),T.push(Z),T.push(tt),T.push(K),T.push(Y)}k+=l,g+=l,w+=l,y+=l,B+=l}let[I,D]=V(s+d,n+h,i,u),C=(o/2+a)*m,[E,N]=V(s+C,n+h,i,u),[W,O]=V(s+d,n-c,i,u),[J,j]=V(s+C,n-c,i,u);return{pennants:A,barbs:T,shaft:[I,D,E,N,W,O,J,j]}}function V(t,i,e,o=1){let r=Math.sqrt(t*t+i*i)/o,l=(2*Math.PI+Math.atan2(i,t))%(2*Math.PI);return[r,(2*Math.PI+l-e)%(2*Math.PI)]}var H=[0,1,3,6,10,16,21,27,33,40,47,55,63],It=[0,.5,1,1.5,2],_t=[0,.25,.5,1,1.5,2,2.5,3,3.5,4];function L(t,i,e,o){let r=st(o||"knots",e),l;for(l=1;l<i.length;l++)if(l===i.length-1){if(t<i[l]*r)break}else if(t<=i[l]*r)break;return Math.min(l-1,i.length-2)}function Dt(t,i,e,o,r){let l=0;switch(i){case"beaufort_kn":l=L(t,H,"knots",e);break;case"beaufort_km":l=L(t,H,"kilometer-per-hour",e);break;case"beaufort_ft":l=L(t,H,"feet-per-second",e);break;case"beaufort_m":l=L(t,H,"meter-per-second",e);break;case"classified_arrow":l=L(t,r??[],o,e);break;case"ocean_current_m":l=L(t,It,"meter-per-second",e);break;case"ocean_current_kn":l=L(t,_t,"knots",e)}return l}function Ft(t,i){let{style:e,inputUnit:o,outputUnit:r,breakValues:l}=i,h=Q.fromJSON(o),c=Q.fromJSON(r),u=7*6,s=15,n=0,a=0,{width:p,height:f,mask:m}=t,d=t.pixels[0],x=t.pixels[1],g=m!=null?m.filter(y=>y>0).length:p*f,M=new Float32Array(g*u),w=new Uint32Array(s*g),b=i.invertDirection?At(0,0,0,!1):Bt;for(let y=0;y<f;y++)for(let P=0;P<p;P++){let k=y*p+P;if(!m||m[y*p+P]){let U=(x[k]+360)%360/180*Math.PI,B=Dt(d[k],e,h,c,l);for(let S=0;S<b.length;S+=2)M[n++]=(P+.5)/p,M[n++]=(y+.5)/f,M[n++]=b[S],M[n++]=b[S+1]+U,M[n++]=B,M[n++]=d[k];let v=7*(n/u-1);w[a++]=v,w[a++]=v+1,w[a++]=v+2,w[a++]=v+0,w[a++]=v+4,w[a++]=v+3,w[a++]=v+0,w[a++]=v+2,w[a++]=v+3,w[a++]=v+2,w[a++]=v+5,w[a++]=v+3,w[a++]=v+5,w[a++]=v+6,w[a++]=v+3}}return{vertexData:M,indexData:w}}var it=[];function Vt(t,i){if(it.length===0)for(let f=0;f<30;f++)it.push(Ct(5*f,0,!i.invertDirection));let e=st(Q.fromJSON(i.inputUnit),"knots"),{width:o,height:r,mask:l}=t,h=t.pixels[0],c=t.pixels[1],u=6,s=[],n=[],a=0,p=0;for(let f=0;f<r;f++)for(let m=0;m<o;m++){let d=f*o+m,x=h[d]*e;if((!l||l[f*o+m])&&x>=ot){let g=(c[d]+360)%360/180*Math.PI,{pennants:M,barbs:w,shaft:b}=it[Math.min(Math.floor(x/5),29)];if(M.length+w.length===0)continue;let y=s.length/u,P=(m+.5)/o,k=(f+.5)/r;for(let U=0;U<M.length;U+=2)s[a++]=P,s[a++]=k,s[a++]=M[U],s[a++]=M[U+1]+g,s[a++]=0,s[a++]=x;for(let U=0;U<w.length;U+=2)s[a++]=P,s[a++]=k,s[a++]=w[U],s[a++]=w[U+1]+g,s[a++]=0,s[a++]=x;for(let U=0;U<b.length;U+=2)s[a++]=P,s[a++]=k,s[a++]=b[U],s[a++]=b[U+1]+g,s[a++]=0,s[a++]=x;for(let U=0;U<M.length/6;U++)n[p++]=y,n[p++]=y+1,n[p++]=y+2,y+=3;for(let U=0;U<w.length/8;U++)n[p++]=y,n[p++]=y+1,n[p++]=y+2,n[p++]=y+1,n[p++]=y+2,n[p++]=y+3,y+=4;n[p++]=y+0,n[p++]=y+1,n[p++]=y+2,n[p++]=y+1,n[p++]=y+3,n[p++]=y+2,y+=4}}return{vertexData:new Float32Array(s),indexData:new Uint32Array(n)}}function Et(t,i){let o=0,r=0,{width:l,height:h,mask:c}=t,u=t.pixels[0],s=[],n=[],a=st(Q.fromJSON(i.inputUnit),"knots"),p=i.style==="wind_speed"?ot:Number.MAX_VALUE;for(let f=0;f<h;f++)for(let m=0;m<l;m++){let d=u[f*l+m]*a;if((!c||c[f*l+m])&&d<p){for(let g=0;g<4;g++)s[o++]=(m+.5)/l,s[o++]=(f+.5)/h,s[o++]=g<2?-.5:.5,s[o++]=g%2==0?-.5:.5,s[o++]=0,s[o++]=d;let x=4*(o/24-1);n[r++]=x,n[r++]=x+1,n[r++]=x+2,n[r++]=x+1,n[r++]=x+2,n[r++]=x+3}}return{vertexData:new Float32Array(s),indexData:new Uint32Array(n)}}function ae(t,i){return i.style==="simple_scalar"?Et(t,i):i.style==="wind_speed"?Vt(t,i):Ft(t,i)}function he(t,i,e,o=[0,0],r=.5){let{width:l,height:h,mask:c}=t,[u,s]=t.pixels,[n,a]=o,p=Math.round((l-n)/e),f=Math.round((h-a)/e),m=p*f,d=new Float32Array(m),x=new Float32Array(m),g=new Uint8Array(m),M=i==="vector-uv";for(let b=0;b<f;b++)for(let y=0;y<p;y++){let P=0,k=b*p+y,U=Math.max(0,b*e+a),B=Math.max(0,y*e+n),v=Math.min(h,U+e),S=Math.min(l,B+e);for(let A=U;A<v;A++)for(let T=B;T<S;T++){let I=A*l+T;if(!c||c[I]){P++;let D=M?[u[I],s[I]]:[u[I],(360+s[I])%360],[C,E]=M?D:kt(D);d[k]+=C,x[k]+=E}}if(P>=(v-U)*(S-B)*(1-r)){g[k]=1;let[A,T]=Mt([d[k]/P,x[k]/P]);d[k]=A,x[k]=T}else g[k]=0,d[k]=0,x[k]=0}let w=new _({width:p,height:f,pixels:[d,x],mask:g});return w.updateStatistics(),w}export{at as a,ht as b,Wt as c,F as d,Ot as e,Lt as f,zt as g,Jt as h,pt as i,jt as j,qt as k,Kt as l,Xt as m,$t as n,Gt as o,Pt as p,Ht as q,dt as r,Qt as s,Yt as t,Zt as u,te as v,Q as w,st as x,Mt as y,oe as z,yt as A,se as B,re as C,Et as D,ae as E,he as F};
