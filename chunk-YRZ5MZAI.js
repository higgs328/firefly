import{a as I}from"./chunk-IFSMF6DV.js";import{c as D}from"./chunk-SC4TZEOX.js";import{a as O}from"./chunk-WOGTXK7W.js";import{S as j,n as L}from"./chunk-KALOJIUA.js";import"./chunk-KMMTNF7G.js";import{a as x}from"./chunk-E7AX56GD.js";import"./chunk-IDVLLREH.js";import"./chunk-DWLSVYOY.js";import"./chunk-PQGCNP5H.js";import"./chunk-UASS7NJI.js";import"./chunk-WZRAC35O.js";import"./chunk-KUYAWYSS.js";import"./chunk-MIS6QMFE.js";import"./chunk-HX2VGIR2.js";import"./chunk-ERDKAICI.js";import"./chunk-JLPLCY2B.js";import"./chunk-PEW2PLAN.js";import"./chunk-7F5DJLJT.js";import"./chunk-CX5IFQZJ.js";import"./chunk-NJWTSROP.js";import"./chunk-D3R25AF2.js";import"./chunk-ARRCN5K3.js";import"./chunk-VDO6JJ3Y.js";import"./chunk-WFKZLI6F.js";import"./chunk-X2B63YVS.js";import"./chunk-BAEF3CT6.js";import{o as v}from"./chunk-AUAZP44J.js";import"./chunk-PVDFCTA4.js";import"./chunk-KNVXE32P.js";import{k as T}from"./chunk-76ATOSLU.js";import"./chunk-CCJU4DSH.js";import"./chunk-QGVBCWUY.js";import"./chunk-MYO4NP2N.js";import"./chunk-NFIPKH6V.js";import"./chunk-JPU2PQZC.js";import"./chunk-5QEXLALV.js";import"./chunk-P6QFA5MM.js";import"./chunk-DGTD7Y73.js";import"./chunk-LI2SX4T6.js";import"./chunk-BWO7LS2H.js";import"./chunk-HEVQSRJ2.js";import"./chunk-OVHPPCBL.js";import"./chunk-SNFOAZZQ.js";import"./chunk-AML4XSEF.js";import"./chunk-4PTIEWMT.js";import"./chunk-TG2UTNEO.js";import{b as w}from"./chunk-YOFFGXOB.js";import"./chunk-XRGPJ3QY.js";import"./chunk-6MRUJ2UW.js";import"./chunk-2LI2GKBQ.js";import{y as S}from"./chunk-QBWJMFH5.js";import{a as g,f as y,g as u,h,i as b,j as F}from"./chunk-VTHXE323.js";function ne(e){return y(this,arguments,function*(i,r={}){let{customParameters:t,signal:o}=r,l=T(i),n=yield v(l.path,{query:g(g({},l.query),t),responseType:"native",signal:o});if(!n.data.body)throw new w("csv-utils:empty-csv","CSV is empty");let[s]=yield Promise.allSettled([P(n.data.body)]);if(yield n.data.body.cancel(),s.status==="rejected")throw s.reason;return g({url:i,customParameters:t},s.value)})}function P(i){return y(this,null,function*(){let r=i.getReader(),e=V(r),t=(yield e.next()).value?.trim(),o=(yield e.next()).value?.trim();if(r.releaseLock(),!t)throw new w("csv-utils:empty-csv","CSV is empty");let{delimiter:l,locationInfo:n}=M(t,o);if(!l)throw new w("csv-utils:invalid-delimiter","Unable to detect the delimiter from CSV",{firstLine:t,secondLine:o});let{names:s,aliases:a}=A(t,l);return{delimiter:l,fields:(yield G(i,l,s,a,n)).map(p=>x.fromJSON(p)),latitudeField:n?.latitudeFieldName,longitudeField:n?.longitudeFieldName}})}var C=/^\s*"([\S\s]*)"\s*$/,R=/""/g,q=`
`,z=[","," ",";","|","	"];function V(i){return h(this,null,function*(){let r=/\r?\n/gm,e=new TextDecoder,t="";try{for(var o=F(B(i)),l,n,s;l=!(n=yield new u(o.next())).done;l=!1){let a=n.value;let p=`${t}${e.decode(a)}`.split(r).filter(Boolean);t=p.pop()||"",yield*b(p)}}catch{s=[n]}finally{try{l&&(n=o.return)&&(yield new u(n.call(o)))}finally{if(s)throw s[0]}}})}function B(i){return h(this,null,function*(){let r=yield new u(i.read());for(;!r.done;)yield r.value,r=yield new u(i.read());i.releaseLock()})}function M(i,r,e){i=i.trim(),r=r?.trim();let t=[],o=Array.from(new Set([e?.delimiter,...z])).filter(n=>n!=null);for(let n of o){let s=N(i,n).length,a=N(r,n).length??s;s>1&&t.push({weight:Math.min(s,a),delimiter:n})}let l=t.sort(({weight:n},{weight:s})=>s-n).map(({delimiter:n})=>n);for(let n of l){let s=A(i,n).names,a=I(s,e?.longitudeField,e?.latitudeField);if(a.longitudeFieldName&&a.latitudeFieldName)return{delimiter:n,locationInfo:a}}return{delimiter:l[0],locationInfo:null}}function U(i,r,e,t=()=>Object.create(null)){return h(this,null,function*(){let o="",l="",n=0,s=t(),a=0;try{for(var p=F(i),se,ae,ce;se=!(ae=yield new u(p.next())).done;se=!1){let c=ae.value;let f=$(c,e);for(let d of f)if(o+=l+d,l="",n+=E(d),n%2==0){if(n>0){let m=C.exec(o);if(!m)return s=t(),a=0,o="",void(n=0);s[r[a]]=k(m[1]).replaceAll(R,'"'),a++}else s[r[a]]=k(o),a++;o="",n=0}else l=e;n===0?(yield s,s=t(),a=0):l=q}}catch{ce=[ae]}finally{try{se&&(ae=p.return)&&(yield new u(ae.call(p)))}finally{if(ce)throw ce[0]}}})}function $(i,r){return _(i,r)}function*_(i,r){let e=0;for(;e<=i.length;){let t=i.indexOf(r,e),o=i.slice(e,t>-1?t:void 0);e+=o.length+r.length,yield o}}function A(i,r){let e=N(i,r).filter(S),t=e.map(o=>L(o));for(let o=t.length-1;o>=0;o--)t[o]||(t.splice(o,1),e.splice(o,1));return{names:t,aliases:e}}function N(i,r){if(!i?.length)return[];let e=[],t="",o="",l=0,n=$(i,r);for(let s of n)if(t+=o+s,o="",l+=E(s),l%2==0){if(l>0){let a=C.exec(t);a&&e.push(a[1].replaceAll(R,'"'))}else e.push(t);t="",l=0}else o=r;return e}function G(i,r,e,t,o){return y(this,null,function*(){let l=i.getReader(),n=V(l),s=[],a=[];try{for(var p=F(U(n,e,r)),se,ae,ce;se=!(ae=yield p.next()).done;se=!1){let c=ae.value;if(a.length===10)break;a.push(c)}}catch{ce=[ae]}finally{try{se&&(ae=p.return)&&(yield ae.call(p))}finally{if(ce)throw ce[0]}}for(let c=0;c<e.length;c++){let f=e[c],d=t[c];if(f===o?.longitudeFieldName||f===o?.latitudeFieldName)s.push({name:f,type:"esriFieldTypeDouble",alias:d});else{let m=H(a.map(J=>J[f]))??"esriFieldTypeString";s.push({name:f,type:m,alias:d,length:j(m)})}}return l.releaseLock(),s})}function H(i){if(!i.length)return"esriFieldTypeString";let r=/[^+\-.,0-9]/;return i.map(e=>{if(e!==""){if(!r.test(e)){let t=K(e);if(!isNaN(t))return/[.,]/.test(e)||!Number.isInteger(t)||t>214783647||t<-214783648?"esriFieldTypeDouble":"esriFieldTypeInteger";if(e.includes("E")&&(t=Number(e),!Number.isNaN(t)||e.includes(",")&&(e=e.replace(",","."),t=Number(e),!Number.isNaN(t))))return"esriFieldTypeDouble"}return O(e)?"esriFieldTypeDate":"esriFieldTypeString"}}).reduce((e,t)=>e===void 0?t:t===void 0?e:e===t?t:e==="esriFieldTypeString"||t==="esriFieldTypeString"?"esriFieldTypeString":e==="esriFieldTypeDouble"||t==="esriFieldTypeDouble"?"esriFieldTypeDouble":void 0)}var K=function(){let i=D(),r=new RegExp("^"+i.regexp+"$"),e=new RegExp("["+i.group+"\\s\\xa0]","g"),t=i.factor;return o=>{let l=r.exec(o);if(i.factor=t,!l)return NaN;let n=l[1];if(!l[1]){if(!l[2])return NaN;n=l[2],i.factor*=-1}return n=n.replace(e,"").replace(i.decimal,"."),+n*i.factor}}();function k(i){return JSON.parse(JSON.stringify(i))}function E(i){let r=0,e=0;for(e=i.indexOf('"',e);e>=0;)r++,e=i.indexOf('"',e+1);return r}export{ne as getCSVLayerInfo};
