import{a as j}from"./chunk-Y6AUTJNM.js";import{B,l as T,m as H}from"./chunk-PKVI3POI.js";import{a as h,d as W,g as C,h as U,m as V}from"./chunk-NQ53MXMB.js";import{a as N,m as S,n as k}from"./chunk-4RK2B3SZ.js";import{m as O}from"./chunk-Y4PJQPM4.js";import{f as v}from"./chunk-F5AJITOA.js";import{$ as E,M as R,O as A,_ as x,da as b,h as I,i as g,k as M,ma as q}from"./chunk-KALOJIUA.js";import{a as y}from"./chunk-HX2VGIR2.js";import{a as D,i as L}from"./chunk-TG45K3WR.js";import{a as l}from"./chunk-QGVBCWUY.js";import{e as n}from"./chunk-NFIPKH6V.js";import{l as w}from"./chunk-5QEXLALV.js";import{b as F}from"./chunk-YOFFGXOB.js";var i=class extends j{constructor(e){super(e),this._storedValue=null,this.error=null,this.preservesValueWhenHidden=!0,this.field=null,this.group=null,this.requiredExpressionExecutor=null,this.type="field",this._fieldInputWasVisibleDuringLifetime=!1,this.valueExpressionExecutor=null}initialize(){this.addHandles(D(()=>this.feature,()=>this._fieldInputWasVisibleDuringLifetime=!1,L))}get _dateFormRange(){let{element:e,field:t}=this;if(this.dataType!=="date")return{};let a=e?.domain?g(t,e.domain):null;if(!e?.input)return a??{};let r=e.input,{type:s}=r,o={};if(s!=="date-picker"&&s!=="time-picker"&&s!=="datetimeoffset-picker"||(o=M(t,r.max,r.min)),s==="datetime-picker"){let{max:p,min:m}=r;o={max:p!=null&&V(p)?p.getTime():null,min:m!=null&&V(m)?m.getTime():null}}let{max:d,min:u}=o;if(a){let{max:p,min:m}=a,c=y(p)&&(d==null||d!=null&&p<d),f=y(m)&&(u==null||u!=null&&m>u);return{max:c?p:d??null,min:f?m:u??null,rawMax:c?a.rawMax:o?.rawMax??null,rawMin:f?a.rawMin:o?.rawMin??null}}return{min:u,max:d,rawMax:o?.rawMax??null,rawMin:o?.rawMin??null}}get _dateRange(){let{_dateFormRange:e,field:t}=this;if(this.dataType!=="date")return{};let a=g(t);if(!a)return e;let{max:r,min:s,rawMax:o,rawMin:d}=e;if(t.type==="date"){let{max:u,min:p}=a;return{max:y(r)&&(u===null||u!=null&&r<u)?r:u??null,min:y(s)&&(p===null||p!=null&&s>p)?s:p??null}}if(t.type==="date-only"||t.type==="time-only"||t.type==="timestamp-offset"){let{max:u,min:p,rawMax:m,rawMin:c}=a,f=y(r)&&o&&(u==null||r<u),_=y(s)&&d&&(p==null||s>p);return{max:f?r:u,min:_?s:p,rawMax:f?o:m,rawMin:_?d:c}}return{max:null,min:null}}get _configAllowsEdits(){let{element:e,layer:t,name:a}=this;return e!=null?e.editableExpression?!!this.evaluatedEditableExpression:e.editable!==!1:t?.userHasUpdateItemPrivileges?!0:(t&&"popupTemplate"in t?t?.popupTemplate?.fieldInfos?.find(({fieldName:s})=>s===a):null)?.isEditable??!0}get _layerAndFieldAllowEdits(){return this.layerAllowsEdits&&this.field?.editable}get _isVisibleByDefault(){let{field:e,layer:t}=this;return!!e?.visible&&A(e,t)}get _isEditTrackingField(){return R(this.layer).includes(this.name?.toLowerCase())}get _shouldUseValueExpression(){return this._layerAndFieldAllowEdits&&!this._configAllowsEdits&&this.valueExpressionExecutor!=null&&this.valueExpressionExecutor.initialExecutionComplete}get isSubtypeField(){let{layer:e}=this;if(e&&"subtypeField"in e){let{subtypeField:t,fieldsIndex:a}=e;return(a.get(t)?.name??t)===this.name}return!1}get valueIsOutOfDomain(){let{domain:e,value:t,field:a}=this;return!(!e||t==null)&&I(a,t,e)!==null}get dataType(){let{field:e}=this;return x(e)?h.Number:E(e)?h.Text:v(e)||b(e)?h.Date:h.Unsupported}get dateDataType(){if(this.dataType===h.Date)return this.field.type!=="date"?"string":"number"}get domain(){let{layer:e,feature:t,name:a,element:r}=this,s=r?.domain;return s!=null&&this._isDomainCompatible(s)?s:e.getFieldDomain(a,{feature:t})}get editable(){return!!this._layerAndFieldAllowEdits&&(this.evaluatedEditableExpression??this._configAllowsEdits)}get evaluatedRequiredExpression(){let{requiredExpressionExecutor:e}=this;return e!=null?!!e.lastEvaluatedValue:null}get evaluatedValueExpression(){let{valueExpressionExecutor:e}=this;return e!=null?e.lastEvaluatedValue:null}get hint(){return this.element?.hint}get includeDate(){return!(this.dataType!==h.Date||this.field.type==="time-only")}get includeTime(){let{element:e,field:t}=this;if(this.dataType!==h.Date)return!1;if(t.type==="time-only")return!0;if(t.type==="date-only")return!1;let a=e?.input?.type==="datetime-picker"?e.input.includeTime:void 0;return a===void 0||a}get includeTimeOffset(){if(this.field.type!=="timestamp-offset")return!1;let e=this.element?.input;return!e||e.type==="datetimeoffset-picker"&&e.includeTimeOffset}set initialFeature(e){this._set("initialFeature",e),this.notifyChange("valid")}get inputType(){return this.element?.input?.type}get hasInvalidSwitchValue(){let{element:e}=this,t=H(e,"switch")?e.input:null;return!t||B(this.value,t)}get isRelationshipKeyField(){let{field:e,layer:t}=this;return O(t)&&!!t.relationships?.some(a=>a.keyField===e.name)}get label(){let{field:e}=this;return this.getFormattedLabel(this.element?.label)??e.alias??e.name}get maxLength(){return C({dataType:this.dataType,field:this.field,input:this.element?.input})}get minLength(){return U({dataType:this.dataType,field:this.field,input:this.element?.input})}get name(){return this.field?.name}get range(){let{domain:e,element:t,field:a}=this;if(this.dataType==="date")return this._dateRange;let r=g(a,e)||q(a,e),s=r?.max===Number.MAX_VALUE?null:r?.max??null,o=r?.min===-Number.MAX_VALUE?null:r?.min??null;if(!t?.domain||t.domain.type!=="range")return{max:s,min:o};let{max:d,min:u}=g(a)||{};return{max:d!=null&&(s===null||s!=null&&d<s)?d:s,min:u!=null&&(o===null||o!=null&&u>o)?u:o}}get required(){let{editable:e,evaluatedRequiredExpression:t,field:a,visible:r,isSubtypeField:s}=this;return e?a?.nullable===!1||s?!0:!(!r||this.group?.visible===!1||t==null)&&t:!1}set required(e){this._overrideIfSome("required",e)}get showNoValueOptionEnabled(){let{element:e}=this;return!this.required&&(!T(e)||e.input.showNoValueOption)}get showNoValueLabel(){let{element:e}=this;return T(e)?e.input.noValueOptionLabel:null}get submittable(){let{field:e,required:t,valid:a,value:r}=this;return(!t||r!=null)&&(!!a||this.initialFeature.getAttribute(e.name)===r)}get timeResolution(){let e=this.element?.input;if(e&&(e.type==="datetimeoffset-picker"||e.type==="time-picker"))return e.timeResolution??"minutes"}get timeStep(){return this.timeResolution!=null?N.get(this.timeResolution):void 0}get updating(){let{editableExpressionExecutor:e,valueExpressionExecutor:t,visibilityExpressionExecutor:a,preservesValueWhenHidden:r}=this;return t!=null&&t.updating||e!=null&&e.updating||r===!1&&a!=null&&a.updating}get valid(){let e=this.editable?this._validate():null;return this._set("error",e),e===null}get value(){if(this._fieldInputWasVisibleDuringLifetime=this._fieldInputWasVisibleDuringLifetime||this.visible&&this.group?.visible!==!1,this.preservesValueWhenHidden===!1&&this._fieldInputWasVisibleDuringLifetime&&(this.visibilityExpressionExecutor?.lastEvaluatedValue===!1||this.group?.visibilityExpressionExecutor?.lastEvaluatedValue===!1))return this._storedValue!==null&&this.set("_storedValue",null),null;if(this._shouldUseValueExpression){let e=this.evaluatedValueExpression;return this.dataType===h.Date?this._arcadeOutputToDateFieldValue(e):e!=null&&typeof e=="object"?`${e}`:e}return this._storedValue}set value(e){this.notifyChange("evaluatedVisibilityExpression"),this.set("_storedValue",e),this.notifyChange("value"),this.notifyChange("valid")}get visible(){return!this._isEditTrackingField&&(this.evaluatedVisibilityExpression!=null?this.evaluatedVisibilityExpression:this.element!=null&&this.field?.visible!==!1||this._isVisibleByDefault)}_arcadeOutputToDateFieldValue(e){let t=this.field.type;try{if(typeof e=="object"){if(e===null)return null;if(k(e))return S(e,t);if("getTime"in e&&typeof e.getTime=="function"&&t==="date")return parseInt(e.getTime(),10);if(t==="date-only"||t==="time-only"||t==="timestamp-offset")return e.toString()}else{if(typeof e=="string")return t==="date"?parseInt(e,10):e;if(typeof e=="number"&&t==="date")return e}throw new F("feature-form:invalid-date-value")}catch{return t==="date"?NaN:""}}_isDomainCompatible(e){let{field:t}=this;if(e?.type==="coded-value"){let a=typeof e.codedValues[0].code;if(a==="string"&&E(t)||a==="number"&&x(t))return!0}return!!(e?.type==="range"&&x(t)||v(t)||b(t))}_validate(){let{dataType:e,domain:t,field:a,minLength:r,range:s,required:o,value:d,maxLength:u}=this;return W(d,{dataType:e,domain:t,field:a,maxLength:u,minLength:r,range:s,required:o})}};l([n()],i.prototype,"_dateFormRange",null),l([n()],i.prototype,"_dateRange",null),l([n()],i.prototype,"_storedValue",void 0),l([n()],i.prototype,"_configAllowsEdits",null),l([n()],i.prototype,"_layerAndFieldAllowEdits",null),l([n()],i.prototype,"_isVisibleByDefault",null),l([n()],i.prototype,"_isEditTrackingField",null),l([n()],i.prototype,"_shouldUseValueExpression",null),l([n()],i.prototype,"isSubtypeField",null),l([n()],i.prototype,"valueIsOutOfDomain",null),l([n()],i.prototype,"dataType",null),l([n()],i.prototype,"dateDataType",null),l([n()],i.prototype,"domain",null),l([n()],i.prototype,"editable",null),l([n({readOnly:!0})],i.prototype,"error",void 0),l([n({constructOnly:!0})],i.prototype,"preservesValueWhenHidden",void 0),l([n()],i.prototype,"evaluatedRequiredExpression",null),l([n()],i.prototype,"evaluatedValueExpression",null),l([n()],i.prototype,"field",void 0),l([n()],i.prototype,"group",void 0),l([n({readOnly:!0})],i.prototype,"hint",null),l([n()],i.prototype,"includeDate",null),l([n()],i.prototype,"includeTime",null),l([n()],i.prototype,"includeTimeOffset",null),l([n()],i.prototype,"initialFeature",null),l([n({readOnly:!0})],i.prototype,"inputType",null),l([n()],i.prototype,"hasInvalidSwitchValue",null),l([n()],i.prototype,"isRelationshipKeyField",null),l([n()],i.prototype,"label",null),l([n()],i.prototype,"maxLength",null),l([n()],i.prototype,"minLength",null),l([n({readOnly:!0})],i.prototype,"name",null),l([n()],i.prototype,"range",null),l([n()],i.prototype,"required",null),l([n()],i.prototype,"requiredExpressionExecutor",void 0),l([n()],i.prototype,"showNoValueOptionEnabled",null),l([n()],i.prototype,"submittable",null),l([n()],i.prototype,"timeResolution",null),l([n()],i.prototype,"timeStep",null),l([n({readOnly:!0})],i.prototype,"type",void 0),l([n()],i.prototype,"updating",null),l([n()],i.prototype,"valid",null),l([n({value:null})],i.prototype,"value",null),l([n()],i.prototype,"valueExpressionExecutor",void 0),l([n()],i.prototype,"visible",null),i=l([w("esri.widgets.FeatureForm.FieldInput")],i);var se=i;export{se as a};
