import{a as c}from"./chunk-UMRL4FCR.js";import{f as L}from"./chunk-ZEWUF6OQ.js";import{a as d,c as p,j as u}from"./chunk-TG45K3WR.js";import{b as y}from"./chunk-ACP3S2CH.js";import{a as h}from"./chunk-T7DXJKX7.js";import{a as o}from"./chunk-QGVBCWUY.js";import{e as l}from"./chunk-NFIPKH6V.js";import{l as m}from"./chunk-5QEXLALV.js";var g={layerListMode:"layer-list-mode"},v="hide",I=y.ofType(c),i=class extends h.EventedAccessor{constructor(t){super(t),this.catalogItems=new I,this.checkPublishStatusEnabled=!1,this.catalogLayer=null,this.listItemCreatedFunction=null,this.listModeDisabled=!1,this.view=null}initialize(){this.addHandles([d(()=>[this.catalogLayer?.loaded,this.view?.ready],()=>this._compileList(),u),p(()=>this.catalogLayer?.dynamicGroupLayer.layers,"change",()=>this._compileList()),d(()=>[this.listItemCreatedFunction,this.checkPublishStatusEnabled,this.listModeDisabled],()=>this._recompileList())])}destroy(){this.view=null,this.catalogItems.removeAll()}get state(){let{view:t,catalogLayer:e}=this;return t?.ready&&e?.loaded?"ready":t&&e?"loading":"disabled"}get totalItems(){return this.catalogItems.flatten(t=>t.children).length}triggerAction(t,e){t&&!t.disabled&&this.emit("trigger-action",{action:t,item:e})}_createListItem(t){let{view:e,listItemCreatedFunction:s,checkPublishStatusEnabled:a,listModeDisabled:r}=this;return new c({checkPublishStatusEnabled:a,listModeDisabled:r,layer:t,listItemCreatedFunction:s,view:e})}_removeAllItems(){this.catalogItems.removeAll()}_getViewableLayers(t){return t?this.listModeDisabled?t:t.filter(e=>L(e)!==v):void 0}_watchLayersListMode(t){this.removeHandles(g.layerListMode),t&&!this.listModeDisabled&&this.addHandles(d(()=>t.filter(e=>"listMode"in e).map(e=>e.listMode).toArray(),()=>this._compileList()),g.layerListMode)}_compileList(){let{catalogLayer:t}=this;if(!t?.loaded)return;let e=t?.dynamicGroupLayer.layers;this._watchLayersListMode(e);let s=this._getViewableLayers(e);s?.length?(this._createNewItems(s),this._removeItems(s),this._sortItems(s)):this._removeAllItems()}_createNewItems(t){let{catalogItems:e}=this;t.forEach(s=>{e.some(a=>a.layer===s)||e.add(this._createListItem(s))})}_removeItems(t){let{catalogItems:e}=this,s=[];e.forEach(a=>{a&&t?.includes(a.layer)||s.push(a)}),e.removeMany(s)}_sortItems(t){let{catalogItems:e}=this;e.sort((s,a)=>{let r=t.indexOf(s.layer),n=t.indexOf(a.layer);return r>n?-1:r<n?1:0})}_recompileList(){this._removeAllItems(),this._compileList()}};o([l({type:I})],i.prototype,"catalogItems",void 0),o([l()],i.prototype,"checkPublishStatusEnabled",void 0),o([l()],i.prototype,"catalogLayer",void 0),o([l()],i.prototype,"listItemCreatedFunction",void 0),o([l({nonNullable:!0})],i.prototype,"listModeDisabled",void 0),o([l({readOnly:!0})],i.prototype,"state",null),o([l()],i.prototype,"totalItems",null),o([l()],i.prototype,"view",void 0),i=o([m("esri.widgets.CatalogLayerList.CatalogLayerListViewModel")],i);var P=i;export{P as a};
