import{j as L}from"./chunk-JK6BWFR4.js";import{g as F}from"./chunk-XR5FT7TQ.js";import{a as g}from"./chunk-LAX5536Z.js";import{a as w}from"./chunk-MDZTV2VL.js";import{h as I}from"./chunk-RNC4P66O.js";import{a as y}from"./chunk-U4QEPZJ3.js";import{m as x}from"./chunk-ZQIC5NFT.js";import{c as R}from"./chunk-VIEK2X23.js";import{b as m}from"./chunk-SLAWDKDA.js";import{c as b}from"./chunk-P6QFA5MM.js";import{b as Z}from"./chunk-YOFFGXOB.js";import{a as h,b as M}from"./chunk-VTHXE323.js";var j=100;function S(a){return a.type==="point"}function B(a){return a.type==="polygon"}function C(a){return a.type==="polyline"}function v(a){return!!a&&a.type==="radial"}function O(a){let e=null;for(let t of a)if(t.graphic.geometry){let r=t.graphic.geometry,l=S(r)?new x({spatialReference:r.spatialReference,xmin:r.x,xmax:r.x,ymax:r.y,ymin:r.y}):r.extent;e=e==null?l?.clone():e.union(l.extent)}return e}function T(a){let e=new Map;for(let t of a)b(e,t.id,()=>({addFeatures:[],id:t.id,identifierFields:{globalIdField:t.layer.globalIdField,objectIdField:t.layer.objectIdField}})).addFeatures?.push(t.graphic);return[...e.values()]}function V({edits:a,geometry:e,relationships:t,tag:r="",template:l}){if(v(e)){let i=e.geometry.clone();for(let p of i.paths)V({geometry:new y({spatialReference:i.spatialReference,paths:[p],hasZ:i.hasZ,hasM:i.hasM}),template:l,edits:a,relationships:t,tag:r});return}let{definition:n,layer:s}=l;e=G(e,s);let o=new g({attributes:n.defaultValues?h({},n.defaultValues):{},geometry:e,sourceLayer:s});if(D(o,s),s.globalIdField&&(o.attributes[s.globalIdField]=m()),a.push({id:s.layerId,graphic:o,tag:r,layer:s}),n.relationships.length!==0)for(let i of n.relationships||[]){let p=i.template;if(i.relationshipMetadata==null||!L(p))throw new Z("shared-template:missing-relationship-metadata-or-definition","Relationship part must have metadata and a fully loaded template with definition");let{layer:u}=p,c=new g({attributes:h({},n.defaultValues),sourceLayer:u});D(c,u),u.globalIdField&&(c.attributes[u.globalIdField]=m()),a.push({graphic:c,id:u.layerId,tag:"",layer:u}),t.push(M(h({},i.relationshipMetadata),{sourceGraphic:o,destinationGraphic:c}))}}function G(a,e){if(!a)return null;if(a.hasZ===e.hasZ&&a.hasM===e.hasM)return a;switch(a.type){case"point":return new R(h(h({spatialReference:a.spatialReference,x:a.x,y:a.y},e.hasZ?a.hasZ?{z:a.z}:{z:f(e)}:{}),e.hasM?a.hasM?{m:a.m}:{m:d(e)??void 0}:{}));case"polygon":return new I({spatialReference:a.spatialReference,rings:z(a.rings,e.hasZ,e.hasM,f(e),d(e),a.hasM?a.hasZ?3:2:-1,a.hasZ?2:-1),hasZ:e.hasZ,hasM:e.hasM});case"polyline":return new y({spatialReference:a.spatialReference,paths:z(a.paths,e.hasZ,e.hasM,f(e),d(e),a.hasM?a.hasZ?3:2:-1,a.hasZ?2:-1),hasZ:e.hasZ,hasM:e.hasM});case"multipoint":return new w({spatialReference:a.spatialReference,hasZ:e.hasZ,hasM:e.hasM,points:E(a.points,e.hasZ,e.hasM,f(e),d(e),a.hasM?a.hasZ?3:2:-1,a.hasZ?2:-1)});default:return a}}function z(a,e,t,r,l,n,s){let o=[];for(let i of a)o.push(E(i,e,t,r,l,n,s));return o}function E(a,e,t,r,l,n,s){let o=[];for(let i of a){let p=[i[0],i[1]];e&&(p[2]=s>-1?i[2]:r),t&&(p[e?3:2]=n>-1?i[n]:l),o.push(p)}return o}function f(a){return a.capabilities.editing?.zDefault??0}function d(a){return a.capabilities.editing.supportsUpdateWithoutM?void 0:0}function D(a,e){F(e)&&(a.sourceLayer=e.findSublayerForFeature(a))}export{j as a,S as b,B as c,C as d,v as e,O as f,T as g,V as h};
