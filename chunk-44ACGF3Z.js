import{b as w}from"./chunk-7VCEHOOE.js";import{a as f}from"./chunk-PEW2PLAN.js";import{a as g}from"./chunk-CX5IFQZJ.js";import{b as h,d as m}from"./chunk-PVDFCTA4.js";import{f as u}from"./chunk-CCJU4DSH.js";import{a as n}from"./chunk-QGVBCWUY.js";import{e as o}from"./chunk-NFIPKH6V.js";import{l as d}from"./chunk-5QEXLALV.js";import{i as p}from"./chunk-P6QFA5MM.js";var l,c=new WeakMap,L=0,r=l=class extends u{constructor(t){super(t),this.wrap="repeat"}get url(){return this._get("url")||null}set url(t){this._set("url",t),t&&this._set("data",null)}get data(){return this._get("data")||null}set data(t){this._set("data",t),t&&this._set("url",null)}writeData(t,e,a,s){if(t instanceof HTMLImageElement){let i={type:"image-element",src:h(t.src,s),crossOrigin:t.crossOrigin};e[a]=i}else if(t instanceof HTMLCanvasElement){let i={type:"canvas-element",imageData:y(t.getContext("2d").getImageData(0,0,t.width,t.height))};e[a]=i}else if(t instanceof HTMLVideoElement){let i={type:"video-element",src:h(t.src,s),autoplay:t.autoplay,loop:t.loop,muted:t.muted,crossOrigin:t.crossOrigin,preload:t.preload};e[a]=i}else if(t instanceof ImageData){let i={type:"image-data",imageData:y(t)};e[a]=i}}readData(t){switch(t.type){case"image-element":{let e=new Image;return e.src=t.src,e.crossOrigin=t.crossOrigin,e}case"canvas-element":{let e=v(t.imageData),a=document.createElement("canvas");return a.width=e.width,a.height=e.height,a.getContext("2d").putImageData(e,0,0),a}case"image-data":return v(t.imageData);case"video-element":{let e=document.createElement("video");return e.src=t.src,e.crossOrigin=t.crossOrigin,e.autoplay=t.autoplay,e.loop=t.loop,e.muted=t.muted,e.preload=t.preload,e}default:return}}get transparent(){let{data:t,url:e}=this;return t instanceof HTMLCanvasElement?D(t.getContext("2d").getImageData(0,0,t.width,t.height)):t instanceof ImageData?D(t):!(!e?.toLowerCase().endsWith(".png")&&!e?.toLocaleLowerCase().startsWith("data:image/png;"))}set transparent(t){this._overrideIfSome("transparent",t)}get contentHash(){let t=typeof this.wrap=="string"?this.wrap:typeof this.wrap=="object"?`${this.wrap.horizontal}/${this.wrap.vertical}`:"",e=(a="")=>`d:${a},t:${this.transparent},w:${t}`;return this.url!=null?e(this.url):this.data!=null?this.data instanceof HTMLImageElement||this.data instanceof HTMLVideoElement?e(this.data.src):(c.has(this.data)||c.set(this.data,++L),e(c.get(this.data))):e()}get memoryUsage(){let t=0;if(t+=this.url!=null?this.url.length:0,this.data!=null){let e=this.data;"data"in e?t+=e.data.byteLength:e instanceof HTMLImageElement?t+=e.naturalWidth*e.naturalHeight*3:e instanceof HTMLCanvasElement&&(t+=e.width*e.height*3)}return t}clone(){let t={url:this.url,data:this.data,wrap:this._cloneWrap()};return new l(t)}cloneWithDeduplication(t){let e=t.get(this);if(e)return e;let a=this.clone();return t.set(this,a),a}_cloneWrap(){return typeof this.wrap=="string"?this.wrap:{horizontal:this.wrap.horizontal,vertical:this.wrap.vertical}}static from(t){return typeof t=="string"?new l({url:t}):t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof ImageData||t instanceof HTMLVideoElement?new l({data:t}):p(l,t)}};function y(t){let e="";for(let a=0;a<t.data.length;a++)e+=String.fromCharCode(t.data[a]);return{data:btoa(e),width:t.width,height:t.height}}function v(t){let e=atob(t.data),a=new Uint8ClampedArray(e.length);for(let s=0;s<e.length;s++)a[s]=e.charCodeAt(s);return w(a,t.width,t.height)}function D(t){for(let e=3;e<t.data.length;e+=4)if(t.data[e]!==255)return!0;return!1}n([o({type:String,json:{write:m}})],r.prototype,"url",null),n([o({json:{write:{overridePolicy(){return{enabled:!this.url}}}}}),o()],r.prototype,"data",null),n([g("data")],r.prototype,"writeData",null),n([f("data")],r.prototype,"readData",null),n([o({type:Boolean,json:{write:{overridePolicy(){return{enabled:this._isOverridden("transparent")}}}}})],r.prototype,"transparent",null),n([o({json:{write:!0}})],r.prototype,"wrap",void 0),n([o({readOnly:!0})],r.prototype,"contentHash",null),r=l=n([d("esri.geometry.support.MeshTexture")],r);var j=r;export{j as a};
