import{a as O,b as v,e as g}from"./chunk-5TCZJT5C.js";import{a as w}from"./chunk-SCMRG5OB.js";import{a as I}from"./chunk-PAEROXLO.js";import{b as c}from"./chunk-RZU6EEB3.js";import{a as h}from"./chunk-MIS6QMFE.js";import{a as d}from"./chunk-2GJBUR2F.js";import{d as u}from"./chunk-KNVXE32P.js";import{f}from"./chunk-CCJU4DSH.js";import{a}from"./chunk-QGVBCWUY.js";import{e as s}from"./chunk-NFIPKH6V.js";import{l as y}from"./chunk-5QEXLALV.js";import{y as m}from"./chunk-4PTIEWMT.js";import{b as p}from"./chunk-YOFFGXOB.js";import{f as l}from"./chunk-VTHXE323.js";function S(o,r,t){return l(this,null,function*(){if(!o)throw new p("print:invalid-layout-info-task-url","Can't fetch layout template info",{url:o});if((yield g(o))==="async"){let i=yield I(o,r,void 0,t||void 0);return yield i.waitForJobCompletion(),(yield i.fetchResultData("Output_JSON")).value}return(yield w(o,r,null,t)).results[0].value})}var e=class extends f{constructor(o){super(o),this.description=null,this.format=null,this.state="not-loaded",this.label=null,this.layoutInfoTaskUrl=null,this.layout=null,this.layoutItem=null,this.layoutOptions=null,this.layoutTemplateInfo=null,this.type=null}get id(){return this.layoutItem?.id??`${this.layout}-${c(JSON.stringify(this.toJSON()))}`}get mapSurroundInfoOptions(){let o=this.layoutTemplateInfo?.layoutOptions?.mapSurroundInfos;if(!o)return null;let r={northArrow:[],scaleBar:[],legend:[]};for(let t of o)switch(t.type){case"CIMMarkerNorthArrow":r.northArrow.push(t);break;case"CIMScaleLine":r.scaleBar.push(t);break;case"CIMGroupElement":t.elements?.some(i=>i.type==="CIMScaleLine")&&r.scaleBar.push(t);break;case"CIMLegend":r.legend.push(t)}return r}_updateLayoutOptions(o){let r=this.layoutOptions?.legend??o.layoutOptions?.hasLegend,t=this.layoutOptions?.northArrow??(this.mapSurroundInfoOptions?.northArrow.length?this.mapSurroundInfoOptions?.northArrow.some(({visible:n})=>n):void 0),i=this.layoutOptions?.scaleBar??(this.mapSurroundInfoOptions?.scaleBar.length?this.mapSurroundInfoOptions?.scaleBar.some(({visible:n})=>n):void 0);this._set("layoutOptions",{legend:r,northArrow:t,scaleBar:i})}fetchLayoutItemTemplateInfo(o){return l(this,null,function*(){let{layoutItem:r}=this;if(r?.id&&!this.layoutTemplateInfo&&this.state!=="loaded")try{this._set("state","loading");let t=this.layoutInfoTaskUrl;if(!t)throw new p("print:invalid-layout-info-task-url","Can't fetch layout template info",{url:t});r.access!=="public"&&u&&(yield u.getCredential(t));let i={Layout_Item_ID:JSON.stringify({id:r.id})},n=(yield S(t,i,o))[0];this.setLayoutTemplateInfo(n)}catch(t){this._set("state",m(t)?"not-loaded":"error")}})}setLayoutTemplateInfo(o){this._set("layoutTemplateInfo",o),this._updateLayoutOptions(o),this._set("state","loaded")}};a([s({json:{write:!0}})],e.prototype,"description",void 0),a([h(O)],e.prototype,"format",void 0),a([s({readOnly:!0})],e.prototype,"id",null),a([s({readOnly:!0})],e.prototype,"state",void 0),a([s({json:{write:!0}})],e.prototype,"label",void 0),a([s()],e.prototype,"layoutInfoTaskUrl",void 0),a([s({json:{read:v,write:!0}})],e.prototype,"layout",void 0),a([s({type:d,json:{write:!0}})],e.prototype,"layoutItem",void 0),a([s({readOnly:!0,json:{write:!0}})],e.prototype,"layoutOptions",void 0),a([s({readOnly:!0})],e.prototype,"layoutTemplateInfo",void 0),a([s({readOnly:!0})],e.prototype,"mapSurroundInfoOptions",null),a([s()],e.prototype,"type",void 0),e=a([y("esri.widgets.Print.CustomTemplate")],e);var q=e;export{S as a,q as b};
