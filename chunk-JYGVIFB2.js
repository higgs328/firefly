import{a as h,b as $}from"./chunk-5BRKCXYS.js";import{a as oo}from"./chunk-LQEFWCY6.js";import{a as f,c as I}from"./chunk-EM35R6FY.js";import{e as Y}from"./chunk-DJW5LMRG.js";import{a as V,c as Z}from"./chunk-DEH76MSI.js";import{b as S,q as B,t as T}from"./chunk-QXXXCEV5.js";import{a as X}from"./chunk-3JGYBNJA.js";import{i as W}from"./chunk-DA3SDKGO.js";import{h as U}from"./chunk-RNC4P66O.js";import{d as M}from"./chunk-OLOKUDVI.js";import{c as P}from"./chunk-VIEK2X23.js";import{a as Q}from"./chunk-PEW2PLAN.js";import{a as k}from"./chunk-7F5DJLJT.js";import{a as K}from"./chunk-CX5IFQZJ.js";import{f as E}from"./chunk-CCJU4DSH.js";import{a as l}from"./chunk-QGVBCWUY.js";import{e as c}from"./chunk-NFIPKH6V.js";import{l as G}from"./chunk-5QEXLALV.js";import{b as H}from"./chunk-YOFFGXOB.js";import{g as A}from"./chunk-XRGPJ3QY.js";var D=V(),i=f(),J=class extends E{};l([c({type:Number,json:{write:{isRequired:!0}}})],J.prototype,"x",void 0),l([c({type:Number,json:{write:{isRequired:!0}}})],J.prototype,"y",void 0),J=l([G("esri.layers.support.ControlPointsGeoreference.ControlPointJSONType")],J);var L=class extends X{constructor(){super(...arguments),this.sourcePoint=null,this.mapPoint=null}};l([c()],L.prototype,"sourcePoint",void 0),l([c({type:P})],L.prototype,"mapPoint",void 0),L=l([G("esri.layers.support.ControlPointsGeoreference.ControlPoint")],L);var u=class extends E.JSONSupportMixin(oo){constructor(o){super(o),this.controlPoints=null,this.height=0,this.type="control-points",this.width=0}readControlPoints(o,t){let r=k.fromJSON(t.spatialReference),n=Z(...t.coefficients,1);return o.map(e=>(S(i,e.x,e.y),h(i,i,n),{sourcePoint:e,mapPoint:new P({x:i[0],y:i[1],spatialReference:r})}))}writeControlPoints(o,t,r,n){if(this.transform!=null)o!=null&&a(o[0])&&(t.controlPoints=o.map(e=>{let s=e.sourcePoint;return{x:s.x,y:s.y}}),t.spatialReference=o[0].mapPoint.spatialReference.toJSON(),t.coefficients=this.transform.slice(0,8));else{let e=new H("web-document-write:invalid-georeference","Invalid 'controlPoints', 'width', 'height' configuration. Make sure the parent media element is loaded i.e. the ImageElement or VideoElement set as 'MediaLayer.source'.",{layer:n?.layer,georeference:this});n?.messages?n.messages.push(e):A.getLogger(this).error(e.name,e.message)}}get coords(){if(this.controlPoints==null)return null;let o=this._updateTransform(D);if(o==null||!a(this.controlPoints[0]))return null;let t=this.controlPoints[0].mapPoint.spatialReference;return ao(o,this.width,this.height,t)}set coords(o){if(this.controlPoints==null||!a(this.controlPoints[0]))return;let t=this.controlPoints[0].mapPoint.spatialReference;if((o=this.projectOrWarn(o,t))==null)return;let{width:r,height:n}=this,{rings:[[e,s,p,m]]}=o,v={sourcePoint:M(0,n),mapPoint:new P({x:e[0],y:e[1],spatialReference:t})},x={sourcePoint:M(0,0),mapPoint:new P({x:s[0],y:s[1],spatialReference:t})},j={sourcePoint:M(r,0),mapPoint:new P({x:p[0],y:p[1],spatialReference:t})},_={sourcePoint:M(r,n),mapPoint:new P({x:m[0],y:m[1],spatialReference:t})};a(v)&&a(x)&&a(j)&&a(_)&&(to(D,v,x,j,_),this.controlPoints=this.controlPoints.map(({sourcePoint:b})=>(S(i,b.x,b.y),h(i,i,D),{sourcePoint:b,mapPoint:new P({x:i[0],y:i[1],spatialReference:t})})))}get inverseTransform(){return this.transform==null?null:Y(V(),this.transform)}get transform(){return this._updateTransform()}toMap(o){if(o==null||this.transform==null||this.controlPoints==null||!a(this.controlPoints[0]))return null;S(i,o.x,o.y);let t=this.controlPoints[0].mapPoint.spatialReference;return h(i,i,this.transform),new P({x:i[0],y:i[1],spatialReference:t})}toSource(o){if(o==null||this.inverseTransform==null||this.controlPoints==null||!a(this.controlPoints[0]))return null;let t=this.controlPoints[0].mapPoint.spatialReference;return o=o.normalize(),(o=W(o,t).geometry)==null?null:(S(i,o.x,o.y),h(i,i,this.inverseTransform),M(i[0],i[1]))}toSourceNormalized(o){let t=this.toSource(o);return t!=null&&(t.x/=this.width,t.y/=this.height),t}_updateTransform(o){let{controlPoints:t,width:r,height:n}=this;if(!(t!=null&&r>0&&n>0))return null;let[e,s,p,m]=t;if(!a(e))return null;let v=e.mapPoint.spatialReference,x=this._projectControlPoint(s,v),j=this._projectControlPoint(p,v),_=this._projectControlPoint(m,v);if(!x.valid||!j.valid||!_.valid||!a(x.controlPoint))return null;o==null&&(o=V());let b=null;return b=a(j.controlPoint)&&a(_.controlPoint)?to(o,e,x.controlPoint,j.controlPoint,_.controlPoint):a(j.controlPoint)?io(o,e,x.controlPoint,j.controlPoint):no(o,e,x.controlPoint),b.every(ro=>ro===0)?null:b}_projectControlPoint(o,t){if(!a(o))return{valid:!0,controlPoint:o};let{sourcePoint:r,mapPoint:n}=o,{geometry:e,pending:s}=W(n,t);return s?{valid:!1,controlPoint:null}:s||e?{valid:!0,controlPoint:{sourcePoint:r,mapPoint:e}}:(A.getLogger(this).warn("map point could not be projected to the spatial reference",{georeference:this,controlPoint:o,sourceSpatialReference:n.spatialReference,targetSpatialReference:t}),{valid:!1,controlPoint:null})}};function a(o){return o?.sourcePoint!=null&&o.mapPoint!=null}l([c({type:[L],json:{write:{allowNull:!1,isRequired:!0,target:{controlPoints:{type:[J],isRequired:!0},coefficients:{type:[Number],isRequired:!0},spatialReference:{type:k,isRequired:!0}}}}})],u.prototype,"controlPoints",void 0),l([Q("controlPoints")],u.prototype,"readControlPoints",null),l([K("controlPoints")],u.prototype,"writeControlPoints",null),l([c({clonable:!1})],u.prototype,"coords",null),l([c({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}})],u.prototype,"height",void 0),l([c({readOnly:!0})],u.prototype,"inverseTransform",null),l([c({readOnly:!0})],u.prototype,"transform",null),l([c({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}})],u.prototype,"width",void 0),u=l([G("esri.layers.support.ControlPointsGeoreference")],u);var d=f(),y=f(),q=f(),C=f(),g=f(),w=f(),O=f(),N=f(),z=Math.PI/2;function R(o,t,r){S(o,r.sourcePoint.x,r.sourcePoint.y),S(t,r.mapPoint.x,r.mapPoint.y)}function no(o,t,r){return R(d,g,t),R(y,w,r),T(q,y,d,z),T(C,d,y,z),T(O,w,g,-z),T(N,g,w,-z),F(o,d,y,q,C,g,w,O,N)}function io(o,t,r,n){return R(d,g,t),R(y,w,r),R(q,O,n),B(C,d,y,.5),T(C,q,C,Math.PI),B(N,g,w,.5),T(N,O,N,Math.PI),F(o,d,y,q,C,g,w,O,N)}function to(o,t,r,n,e){return R(d,g,t),R(y,w,r),R(q,O,n),R(C,N,e),F(o,d,y,q,C,g,w,O,N)}var so=new Array(8).fill(0),lo=new Array(8).fill(0);function eo(o,t,r,n,e){return o[0]=t[0],o[1]=t[1],o[2]=r[0],o[3]=r[1],o[4]=n[0],o[5]=n[1],o[6]=e[0],o[7]=e[1],o}function F(o,t,r,n,e,s,p,m,v){return $(o,eo(so,t,r,n,e),eo(lo,s,p,m,v))}function ao(o,t,r,n){let e=I(0,r),s=I(0,0),p=I(t,0),m=I(t,r);return h(e,e,o),h(s,s,o),h(p,p,o),h(m,m,o),new U({rings:[[e,s,p,m,e]],spatialReference:n})}var Mo=u;export{Mo as a};
