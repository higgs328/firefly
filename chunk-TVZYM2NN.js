import{a as x}from"./chunk-TI4UXDNK.js";import{a as re}from"./chunk-YYU4WDV7.js";import{c as se}from"./chunk-U445SEXM.js";import{b as le}from"./chunk-TSQO2JBH.js";import{a as ae}from"./chunk-PWCKLYPC.js";import{c as te,d as ne,e as ie,g as oe}from"./chunk-GYQWYHEG.js";import{b as ee}from"./chunk-JC4DQSN3.js";import{c as g}from"./chunk-ES4WUTEM.js";import{b as X}from"./chunk-XOMCYIPA.js";import{c as Q}from"./chunk-QS3EYJPF.js";import{a as K}from"./chunk-HJJZ2AXH.js";import{d as J}from"./chunk-GNEAU6X4.js";import{a as D}from"./chunk-4DBMALZW.js";import{a as S}from"./chunk-CVWWHM2V.js";import{a as T}from"./chunk-T63F7663.js";import{a as H}from"./chunk-O4V2VBSK.js";import{a as q}from"./chunk-45BTW5EG.js";import{b as W}from"./chunk-73NLRHJD.js";import{a as _}from"./chunk-PNFEUBDF.js";import{a as O}from"./chunk-FQFHMHYU.js";import{a as z}from"./chunk-SZMEI3WL.js";import{a as $}from"./chunk-V2IENAEU.js";import{a as G}from"./chunk-QAGQFNF2.js";import{c as Y}from"./chunk-YWLMJ26A.js";import{a as P}from"./chunk-CZ6CGC7I.js";import{a as N}from"./chunk-BPWNCOXC.js";import{a as j}from"./chunk-AVMO6LCR.js";import{a as E}from"./chunk-6F25LG6O.js";import{b,c as C,f as M,k as R,l as Z}from"./chunk-F5AJITOA.js";import{a as I}from"./chunk-7P44K2YD.js";import{b as L}from"./chunk-UST6HCE7.js";import{c as k,d as v}from"./chunk-K5T5FD5C.js";import{e as A,h as U}from"./chunk-MVHHPJM7.js";import{b as d}from"./chunk-ACP3S2CH.js";import{b as c}from"./chunk-YOFFGXOB.js";import{a as f,b as w,c as h,f as p}from"./chunk-VTHXE323.js";var ge=[{size:10,width:0},{size:20,width:.5},{size:80,width:1},{size:250,width:2}];function ye(e){return p(this,null,function*(){let{view:i}=e;if(!(e&&i&&e.layer))throw new c("outline:missing-parameters","'view' and 'layer' parameters are required");e.forBinning&&ee(e,"outline");let l=e,{layer:t}=l,n=h(l,["layer"]),o=e.forBinning?ne:te,a=oe(t,o,e.forBinning);if(!a)throw new c("outline:invalid-parameters","'layer' must be one of these types: "+ie(o).join(", "));let r=w(f({layerAdapter:a},n),{view:i});yield i.when();let s=r.signal!=null?{signal:r.signal}:null;if(yield a.load(s),a.geometryType!=="polygon")throw new c("outline:not-supported",`outline is not supported for geometryType: ${a.geometryType}`);return r})}function he(e,i){let t=e.avgSize,n=J(1,i.spatialReference),o=ge.map(a=>new K({size:a.width,value:Math.round(t/a.size*n)}));return o.sort((a,r)=>a.value-r.value),{visualVariables:[new Q({target:"outline",valueExpression:"$view.scale",stops:o})],opacity:.25}}function ue(e){return p(this,null,function*(){let r=yield ye(e),{layerAdapter:i}=r,t=h(r,["layerAdapter"]),n=-1,o=yield i.getSampleFeatures(f({sampleSize:n,returnGeometry:!0},t),"json");if(!o?.length)throw new c("outline:insufficient-info","No features are available to calculate statistics");let a=yield ae({features:o,geometryType:i.geometryType});if(!(a&&"avgSize"in a&&a.avgSize))throw new c("outline:insufficient-info","average polygon size is invalid");return he(w(f({},a),{avgSize:a.avgSize}),t.view)})}var pe=/^(\d+(\.\d+)?)\s*(%)$/i,me=new E([0,0,0,.4]),ve=new Set(["hours","minutes","seconds"]),be=[...b.light,...b.dark];function ce(e,i,t,n){if(typeof e=="string"){let o=t.getField(e);if(o&&M(o))return o.alias||o.name}else if(typeof e=="number"||e instanceof Date){let o=i!=null&&ve.has(i),a=k(o?"short-date-short-time":"short-date");if(n&&o){let r=t.layer,{timeZone:s}=U("preferredTimeZone"in r?r.preferredTimeZone:null,"datesInUnknownTimezone"in r&&r.datesInUnknownTimezone,n.timeZone,a,"date");return v(e,w(f({},a),{timeZone:s,timeZoneName:A}))}return v(e,a)}return e}function V(e,i,t){return e+i>0&&0>e-i&&t<0?0:e}function ft(e,i,t,n){let{avg:o,stddev:a,min:r,max:s}=e,l=B(e,!!t,n??!0),u=l?l[0]:r,m=l?l[1]:s;return l?{minDataValue:u,maxDataValue:m,defaultValuesUsed:!0}:(i==="above"?u=V(o,a,r):i==="below"&&(m=V(o,a,r)),{minDataValue:u,maxDataValue:m,defaultValuesUsed:!1})}function B(e,i,t){let n,o,a=ze({statistics:e,isDate:i});return a.defaultValuesUsed?(n=a.min,o=a.max):!t||e.avg!=null&&e.stddev||(n=e.min,o=e.max),n!=null&&o!=null?[n,o]:null}function ze(e){let i,t,n=e.statistics;if(n||(n={}),n.min==null)if(e.isDate){let o=fe();i=o[0],t=o[1]}else i=0,t=100;else if(n.min===n.max)if(e.isDate){let o=fe(n.min);i=o[0],t=o[1]}else n.min<0?(i=2*n.min,t=0):n.min>0?(i=0,t=2*n.min):(i=0,t=100);return{min:i??n.min,max:t??n.max,defaultValuesUsed:i!=null||t!=null}}function fe(e){let i=(typeof e=="number"?new Date(e):new Date).getUTCFullYear(),t=Date.UTC(i,0,1,12,0,0,0),n=Date.UTC(i,11,31,12,0,0,0);return typeof e=="number"&&(e<t&&(t=e),e>n&&(n=e)),[t,n]}function dt({minDataValue:e,maxDataValue:i,defaultValuesUsed:t},n,o,a=!0){return t||o==="above"||o==="below"?we(e,i,5):Te(n,a)}function pt(e,i){let{avg:t,stddev:n}=e,o=e.min,a=e.max;if(t==null||n==null){let[m,y]=B(e,i,!0);return we(m,y,5)}let r=V(t,n,o),s=a-r,l=r-o,u=Math.max(s,l);return g([r-u,r-u/2,r,u/2+r,r+u],{strictBounds:!0})}function wt(e,i){let{min:t,max:n}=i,[o,a,r,s,l]=e,u=t!=null&&o<t,m=n!=null&&l>n;if(t==null||n==null||!u&&!m)return e;let y=u?t:o,F=m?n:l;return g([y,u?y+(r-y)/2:a,r,m?r+(F-r)/2:s,F],{strictBounds:!0})}function we(e,i,t){let n=(i-e)/(t-1),o=[e];for(let a=1;a<=t-2;a++)o.push(e+a*n);return o.push(i),g(o,{strictBounds:!0})}function Te({min:e,max:i,avg:t,stddev:n},o=!0){if(e==null||i==null||t==null||n==null)return[];let a=t-n,r=t+n;a<e&&(a=e),r>i&&(r=i),o&&(t=a+(r-a)/2);let s=g([a,r],{strictBounds:!0});return a=s[0],r=s[1],s=[a,a+(t-a)/2,t,t+(r-t)/2,r],g(s,{strictBounds:!0})}function gt(e,i,t){switch(i){case"point":case"multipoint":return t?"noDataSize"in e?e.noDataSize:null:"size"in e?e.size:null;case"polyline":return t?"noDataWidth"in e?e.noDataWidth:null:"width"in e?e.width:null;case"polygon":return"size"in e?e.size:null;default:return}}function yt(e,i,t){switch(i){case"point":case"multipoint":case"polygon":{if(!("outline"in e))return null;let n={color:e.outline.color,width:e.outline.width};if(t!=null&&n.color){let o=n.color.clone();o.a=t,n.color=o}return n}default:return}}function ht(e,i){let{type:t,size:n,color:o,outline:a}=i,r;switch(e){case"point":case"multipoint":if(t==="2d")r=new P({color:o,size:n,outline:{color:a.color,width:a.width}});else if(t==="3d-flat")r=new D({symbolLayers:new d([new Y({size:n,resource:{primitive:"circle"},material:{color:o},outline:{color:a.color,size:a.width}})])});else if(t?.includes("3d-volumetric")){let s=t==="3d-volumetric-uniform",l=new W({height:n,resource:{primitive:s?"sphere":"cylinder"},material:{color:o}});s||(l.width=i.widthAndDepth,l.depth=i.widthAndDepth),r=new D({symbolLayers:new d([l])})}break;case"polyline":t==="2d"?r=new j({color:o,width:n}):t==="3d-flat"?r=new T({symbolLayers:new d([new q({size:n,material:{color:o}})])}):t==="3d-volumetric"&&(r=new T({symbolLayers:new d([new _({width:typeof n=="number"?n:parseFloat(n),height:typeof n=="number"?n:parseFloat(n),material:{color:o}})])}));break;case"polygon":t==="2d"?r=new N({color:o,outline:{color:a.color,width:a.width}}):t==="3d-flat"?r=new S({symbolLayers:new d([new z({material:{color:o},outline:{color:a.color,size:a.width}})])}):t==="3d-volumetric"&&(r=new S({symbolLayers:new d([new O({size:n,material:{color:o}})])}));break;case"mesh":{let s=i.meshInfo?.colorMixMode,l=i.meshInfo?.edgesType;r=new H({symbolLayers:new d([new z({material:{color:o,colorMixMode:s||null},edges:l==="solid"?new G({color:me}):l==="sketch"?new $({color:me}):null})])});break}}return r}function vt(e,i,t){let n=De({layer:e,fields:i});if(n.length)return new c(t,"Unknown fields: "+n.join(", ")+". You can only use fields defined in the layer schema");let o=Se({layer:e,fields:i});return o.length?new c(t,"Unsupported fields: "+o.join(", ")+". You can only use fields that are accessible to the renderer i.e. FieldUsageInfo.supportsRenderer must be true"):void 0}function De(e){let i=e.layer;return e.fields.filter(t=>!i.getField(t))}function Se(e){let i=e.layer;return e.fields.filter(t=>{let n=i.getFieldUsageInfo(t);return!n||!n.supportsRenderer})}function bt(e,i){return p(this,null,function*(){let t={layer:e.layer,view:e.view,filter:e.filter,signal:e.signal},[n,o]=yield Promise.all([x(e).catch(de),i?ue(t).catch(de):null]),a=B({min:n?.minValue,max:n?.maxValue,avg:null,stddev:null},!1,!1);return{result:a?yield x(w(f({},e),{classificationMethod:"equal-interval",numClasses:1,analyzeData:!1,minValue:a[0],maxValue:a[1],normalizationTotal:a[0]+a[1]})):n,defaultValuesUsed:!!a,outlineResult:o}})}function zt(e){return re(f({outStatisticTypes:C},e))}function Tt(e,i){let{minSize:t,maxSize:n}=e;return i==="height"&&(t=((n-t)/2+t)/(2*2.3),n*=2),{minSize:t,maxSize:n}}function Dt(e){return pe.test(e)}function St(e){if(e==null)return;let i=e.match(pe),t=Number(i[1]);return i[3]==="%"?new X({scaleFactor:t/100}):void 0}function xt(e,i,t,n){e.startTime=i instanceof Date?i.getTime():i,e.endTime=t instanceof Date?t.getTime():t,e.units=n,e.field=typeof i=="string"?i:typeof t=="string"?t:null}function Vt(e,i){return p(this,null,function*(){let t=null,n=null;if(!e&&!i)return{basemapId:t,basemapTheme:n};if(i&&(n=yield le(i),e||(e=i.map?.basemap)),e&&(t=Z(e,be,!1),t&&!n)){let o=R(t);o!=null&&(n=o)}return!t&&n&&(t=n==="dark"?"dark-gray":"gray"),{basemapId:t,basemapTheme:n}})}function de(e){let i=e.name?.toLowerCase();if(!i||i?.includes(":insufficient-info")||i?.includes(":insufficient-data"))return null;throw e}function Bt(e,i){return p(this,null,function*(){let{layer:t,startTime:n,endTime:o,view:a}=e,r=se({layer:t,startTime:n,endTime:o,unit:i}).valueExpression,s=yield L("esri/smartMapping/t9n/smartMapping");return{valueExpression:r,title:I(s[`ageInfo_${i}`],{unit:i,startTime:ce(n,i,t,a),endTime:ce(o,i,t,a)})}})}export{ue as a,ft as b,B as c,dt as d,pt as e,wt as f,we as g,Te as h,gt as i,yt as j,ht as k,vt as l,bt as m,zt as n,Tt as o,Dt as p,St as q,xt as r,Vt as s,de as t,Bt as u};
