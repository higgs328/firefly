import{b as x,c as W,d as _}from"./chunk-GY62SD4Z.js";import{a as j}from"./chunk-IAG3AFVL.js";import{a as D}from"./chunk-5REY7VVO.js";import{c as O}from"./chunk-7VCEHOOE.js";import{a as L}from"./chunk-PEW2PLAN.js";import{a as R}from"./chunk-CX5IFQZJ.js";import{a as M}from"./chunk-SLAWDKDA.js";import{o as U}from"./chunk-AUAZP44J.js";import{a as E,b as u,e as H,i as T}from"./chunk-PVDFCTA4.js";import{A as I,C as b,D as w,E as c,K as P}from"./chunk-76ATOSLU.js";import{a as r}from"./chunk-QGVBCWUY.js";import{e as m}from"./chunk-NFIPKH6V.js";import{l as v}from"./chunk-5QEXLALV.js";import{b as y}from"./chunk-YOFFGXOB.js";import{a as g,b as d,f}from"./chunk-VTHXE323.js";var B,i=class extends _{constructor(e){super(e),this.animationOptions=null,this.content=null,this.image=null,this.type="image",this[B]=!0,this.image=null}load(){let e=this.image;if(typeof e=="string"){let t=O(e).then(o=>{this._set("content",o)});this.addResolvingPromise(t)}else if(e instanceof HTMLImageElement){let t=e.decode().then(()=>{this._set("content",e)});this.addResolvingPromise(t)}else e?this._set("content",e):this.addResolvingPromise(Promise.reject(new y("image-element:invalid-image-type","Invalid image type",{image:e})));return Promise.resolve(this)}get contentWidth(){return this.content==null?0:this.content instanceof HTMLImageElement?this.content.naturalWidth:this.content.width}get contentHeight(){return this.content==null?0:this.content instanceof HTMLImageElement?this.content.naturalHeight:this.content.height}readImage(e,t,o){return E(t.url,o)}writeImage(e,t,o,n){if(e==null)return;let s=n?.portalItem,l=n?.resources;if(!s||!l)return void(typeof e=="string"&&(t[o]=u(e,n)));let p=A(e)?e:null;if(p){if(H(p)==null)return void(t[o]=p);let a=u(p,d(g({},n),{verifyItemRelativeUrls:n?.verifyItemRelativeUrls?{writtenUrls:n.verifyItemRelativeUrls.writtenUrls,rootPath:void 0}:void 0}),T.NO);if(s&&a&&!b(a))return l.toKeep.push({resource:s.resourceFromPath(a),compress:!1}),void(t[o]=a)}t[o]="<pending>",l.pendingOperations.push(F(e).then(a=>{let h=K(a,s);t[o]=h.itemRelativeUrl,l.toAdd.push({resource:h,content:{type:"blob",blob:a},compress:!1,finish:C=>{this.image=C.url}})}))}};B=j,r([m()],i.prototype,"animationOptions",void 0),r([m({readOnly:!0})],i.prototype,"content",void 0),r([m({readOnly:!0})],i.prototype,"contentWidth",null),r([m({readOnly:!0})],i.prototype,"contentHeight",null),r([m(x)],i.prototype,"image",void 0),r([L("image",["url"])],i.prototype,"readImage",null),r([R("image")],i.prototype,"writeImage",null),r([m(W)],i.prototype,"type",void 0),i=r([v("esri.layers.support.ImageElement")],i);var se=i;function A(e){return typeof e=="string"&&!c(e)&&!w(e)}function F(e){return f(this,null,function*(){return typeof e=="string"?c(e)?P(e):(yield U(e,{responseType:"blob"})).data:new Promise(t=>$(e).toBlob(t))})}function $(e){if(e instanceof HTMLCanvasElement)return e;let t=e instanceof HTMLImageElement?e.naturalWidth:e.width,o=e instanceof HTMLImageElement?e.naturalHeight:e.height,n=document.createElement("canvas"),s=n.getContext("2d");return n.width=t,n.height=o,e instanceof HTMLImageElement?s.drawImage(e,0,0,e.width,e.height):e instanceof ImageData&&s.putImageData(e,0,0),n}function K(e,t){let o=M(),n=`${I("media",o)}.${D({type:"blob",blob:e})}`;return t.resourceFromPath(n)}export{se as a};
