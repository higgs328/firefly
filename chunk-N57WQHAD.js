import{a as v}from"./chunk-2ARQOMI2.js";import{a as b}from"./chunk-4NWJLPNX.js";import{a as z}from"./chunk-RGY7NTLL.js";import{d as S}from"./chunk-GY62SD4Z.js";import{a as g}from"./chunk-LORHDXEB.js";import{a as H}from"./chunk-4BZWOF3V.js";import{g as V,s as C}from"./chunk-DA3SDKGO.js";import{e as I}from"./chunk-KVM6SHDX.js";import{a as y}from"./chunk-IR6XCBC4.js";import{i as E,m as M}from"./chunk-ZQIC5NFT.js";import{a as R}from"./chunk-7F5DJLJT.js";import{d as w}from"./chunk-NJWTSROP.js";import{a as u}from"./chunk-4N4D2YQX.js";import{a as _}from"./chunk-TG45K3WR.js";import{b as x}from"./chunk-ACP3S2CH.js";import{a as c}from"./chunk-T7DXJKX7.js";import{a}from"./chunk-QGVBCWUY.js";import{e as m}from"./chunk-NFIPKH6V.js";import{l as p}from"./chunk-5QEXLALV.js";import{p as f}from"./chunk-4PTIEWMT.js";import{g as h}from"./chunk-XRGPJ3QY.js";import{f as d}from"./chunk-VTHXE323.js";var F={key:"type",defaultKeyValue:"image",base:S,typeMap:{image:b,video:z}},B=x.ofType(F),o=class extends y.LoadableMixin(u.EsriPromiseMixin(c.EventedAccessor)){constructor(e){super(e),this._index=new H,this._elementViewsMap=new Map,this._elementsIndexes=new Map,this._elementsChangedHandler=n=>{for(let s of n.removed){let t=this._elementViewsMap.get(s);this._elementViewsMap.delete(s),this._index.delete(t),this.removeHandles(t),t.destroy(),this.notifyChange("fullExtent")}let{spatialReference:i}=this;for(let s of n.added){if(this._elementViewsMap.get(s))continue;let t=new v({spatialReference:i,element:s});this._elementViewsMap.set(s,t);let r=_(()=>t.coords,()=>this._updateIndexForElement(t,!1));this._updateIndexForElement(t,!0),this.addHandles(r,t)}this._elementsIndexes.clear(),this.elements.forEach((s,t)=>this._elementsIndexes.set(s,t)),this.emit("refresh")},this.elements=new B}load(e){return d(this,null,function*(){if(f(e),!this.spatialReference){let n=this.elements.find(i=>i.georeference?.coords!=null);this._set("spatialReference",n?n.georeference.coords.spatialReference:R.WGS84)}return this._elementsChangedHandler({added:this.elements.items,removed:[]}),this.addHandles(this.elements.on("change",this._elementsChangedHandler)),this})}destroy(){this._index.clear(),this._elementViewsMap.clear(),this._elementsIndexes.clear()}set elements(e){this._set("elements",g(e,this._get("elements"),B))}get fullExtent(){if(this.loadStatus==="not-loaded")return null;let e=this._index.fullBounds;return e==null?null:new M({xmin:e[0],ymin:e[1],xmax:e[2],ymax:e[3],spatialReference:this.spatialReference})}set spatialReference(e){this.loadStatus==="not-loaded"?this._set("spatialReference",e):h.getLogger(this).error("#spatialReference","spatialReference cannot be changed after the source is loaded.")}queryElements(e,n){return d(this,null,function*(){yield this.load(),yield C(e.spatialReference,this.spatialReference,null,n);let i=w(e.spatialReference,this.spatialReference)?e:V(e,this.spatialReference);if(!i)return[];let s=i.normalize(),t=[];for(let r of s)this._index.forEachInBounds(I(r),({normalizedCoords:l,element:j})=>{l!=null&&E(r,l)&&t.push(j)});return t.sort((r,l)=>this._elementsIndexes.get(r)-this._elementsIndexes.get(l)),t})}hasElement(e){return this.elements.includes(e)}_updateIndexForElement(e,n){let i=e.normalizedBounds,s=this._index.has(e),t=i!=null;this._index.delete(e),t&&this._index.set(e,i),this.notifyChange("fullExtent"),n||(s!==t?this.emit("refresh"):this.emit("change",{element:e.element}))}};a([m()],o.prototype,"elements",null),a([m({readOnly:!0})],o.prototype,"fullExtent",null),a([m()],o.prototype,"spatialReference",null),o=a([p("esri.layers.support.LocalMediaElementSource")],o);var re=o;export{re as a};
