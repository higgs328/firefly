import{a as zt}from"./chunk-YCST6SCG.js";import{a as w}from"./chunk-4JIR4MZV.js";import{c as Zt}from"./chunk-63BBKXWS.js";import{b as q}from"./chunk-THX6XNHV.js";import{a as At}from"./chunk-JQAW4OB5.js";import{n as Ft}from"./chunk-6B5XFA6F.js";import{d as U}from"./chunk-OLOKUDVI.js";import{a as $}from"./chunk-RSDQHAJX.js";import{i as Et}from"./chunk-EQZWYK27.js";import{a as Mt,b as rt}from"./chunk-MGGSCSBE.js";import{b as ct}from"./chunk-CFRDSUTM.js";import{a as I,j as ht}from"./chunk-TG45K3WR.js";import{b as Tt}from"./chunk-ACP3S2CH.js";import{a as l}from"./chunk-QGVBCWUY.js";import{H as kt}from"./chunk-MYO4NP2N.js";import{e as m}from"./chunk-NFIPKH6V.js";import{l as j}from"./chunk-5QEXLALV.js";import{e as H}from"./chunk-HEVQSRJ2.js";import{a as St}from"./chunk-SNFOAZZQ.js";import{b as Dt,d as k,j as z,l as Ct}from"./chunk-4PTIEWMT.js";import{a as G}from"./chunk-TG2UTNEO.js";import{g as bt}from"./chunk-XRGPJ3QY.js";import{a as Z}from"./chunk-QBWJMFH5.js";import{a as xt,b as yt,f as wt}from"./chunk-VTHXE323.js";var D=class extends kt{constructor(){super(...arguments),this.items=new Tt,this._watchUpdatingTracking=new At,this._callbacks=new Map,this._projector=ct(),this._hiddenProjector=ct()}get needsRender(){return this.items.length>0}get updating(){return this._watchUpdatingTracking?.updating??!1}initialize(){let e=document.createElement("div");e.className="esri-overlay-surface",this._set("surface",e),this._hiddenSurface=document.createElement("div"),this._hiddenSurface.setAttribute("style","visibility: hidden;"),e.appendChild(this._hiddenSurface),this._watchUpdatingTracking.addOnCollectionChange(()=>this.items,t=>{for(let i of t.added){let n=()=>i.render();this._callbacks.set(i,n),this._projector.append(this.surface,n)}for(let i of t.removed){let n=this._projector.detach(this._callbacks.get(i));this.surface.removeChild(n.domNode),this._callbacks.delete(i)}})}addItem(e){this.items.add(e)}removeItem(e){this.items.remove(e)}destroy(){this.items.removeAll(),this._callbacks.forEach(e=>this._projector.detach(e)),this._callbacks=null,this._projector=null,this._watchUpdatingTracking.destroy()}render(){this._projector.renderNow()}computeBoundingRect(e){let t=this._hiddenSurface,i=this._hiddenProjector,n,o=()=>(n=e.render(),n);i.append(t,o),i.renderNow();let s={left:0,top:0,right:0,bottom:0};if(n?.domNode){let a=n.domNode.getBoundingClientRect();s.left=a.left,s.top=a.top,s.right=a.right,s.bottom=a.bottom}for(i.detach(o);t.firstChild;)t.removeChild(t.firstChild);return s}overlaps(e,t){let i=this.computeBoundingRect(e),n=this.computeBoundingRect(t);return Math.max(i.left,n.left)<=Math.min(i.right,n.right)&&Math.max(i.top,n.top)<=Math.min(i.bottom,n.bottom)}get hasVisibleItems(){return this.items.some(e=>e.visible)}prepare(){return wt(this,null,function*(){yield document.fonts.load(this._fontString()).catch(()=>{})})}renderCanvas(e,t){let i=!!t?.disableDecorations;if(!this.items.some(o=>o.visible&&!(i&&o.isDecoration)))return;let n=e.getContext("2d");n.save(),n.font=this._fontString(),this.items.forEach(o=>{i&&o.isDecoration||(n.save(),o.renderCanvas(n),n.restore())}),n.restore()}_fontString(){return`10px ${getComputedStyle(this.surface).fontFamily}`}};l([m({readOnly:!0})],D.prototype,"surface",void 0),l([m({readOnly:!0})],D.prototype,"items",void 0),l([m({readOnly:!0})],D.prototype,"needsRender",null),l([m({readOnly:!0})],D.prototype,"_watchUpdatingTracking",void 0),l([m({readOnly:!0})],D.prototype,"updating",null),D=l([j("esri.views.overlay.ViewOverlay")],D);var dt=D;var lt=[0,0];function we(e){let t=(e.ownerDocument||window.document).defaultView,i=e.getBoundingClientRect();return lt[0]=i.left+(t?.pageXOffset??0),lt[1]=i.top+(t?.pageYOffset??0),lt}function It(e){e&&(e.textContent="",e.parentNode&&e.parentNode.removeChild(e))}function be(e){let t=document.createElement("div");return e.appendChild(t),t}var L=16,R=750,De=512,Ce=2,Ti=e=>{let t=class extends e{constructor(...i){super(...i),this._freqInfo={freq:L,time:R},this._overlayRenderTaskHandle=null,this.height=0,this.messagesCommon=null,this.overlay=null,this.position=null,this.resizing=!1,this.root=null,this.surface=null,this.suspended=!0,this.ui=null,this.userContent=null,this.width=0,this.widthBreakpoint=null,this.addHandles([I(()=>this.cursor,n=>{let{surface:o}=this;o&&o.setAttribute("data-cursor",n)}),I(()=>this.navigating,n=>{let{surface:o}=this;o&&o.setAttribute("data-navigating",n.toString())})])}initialize(){this.addHandles([I(()=>this.ui,(i,n)=>this._handleUIChange(i,n),ht),this.on("focus",()=>this.notifyChange("focused")),this.on("blur",()=>this.notifyChange("focused"))])}destroy(){this.destroyed||(this.ui?.destroy(),this.container=null)}get container(){return this._get("container")??null}set container(i){let n=this._get("container"),o=Mt(i);if(o||typeof i!="string"||bt.getLogger(this).error("#container",`element with id '${i}' not found`),n===o)return;if(this._stopMeasuring(),n&&(n.classList.remove("esri-view"),this._overlayRenderTaskHandle&&(this._overlayRenderTaskHandle.remove(),this._overlayRenderTaskHandle=null),this.overlay&&(this.overlay.destroy(),this._set("overlay",null)),this.root&&(It(this.root),this._set("root",null)),this.userContent&&(rt(this.userContent,n),It(this.userContent),this._set("userContent",null))),!o)return this._set("width",0),this._set("height",0),this._set("position",null),this._set("suspended",!0),this._set("surface",null),void this._set("container",null);o.classList.add("esri-view");let s=document.createElement("div");s.className="esri-view-user-storage",rt(o,s),o.appendChild(s),this._set("userContent",s);let a=document.createElement("div");a.className="esri-view-root",o.insertBefore(a,o.firstChild),this._set("root",a);let r=document.createElement("div");r.className="esri-view-surface",r.setAttribute("role","application"),r.tabIndex=0,a.appendChild(r),this._set("surface",r);let h=new dt;a.appendChild(h.surface),this._set("overlay",h),this.addHandles(I(()=>h.needsRender,c=>{c&&!this._overlayRenderTaskHandle?this._overlayRenderTaskHandle=H({render:()=>this.overlay?.render()}):this._overlayRenderTaskHandle=k(this._overlayRenderTaskHandle)})),this.forceDOMReadyCycle(),this._set("container",o),this._startMeasuring()}get focused(){let i=document.activeElement===this.surface;return document.hasFocus()&&i}get size(){return[this.width,this.height]}blur(){this.surface?.blur()}focus(){this.surface?.focus()}pageToContainer(i,n,o){let s=this.position;return i-=s?s[0]:0,n-=s?s[1]:0,o?(o[0]=i,o[1]=n):o=[i,n],o}containerToPage(i,n,o){let s=this.position;return i+=s?s[0]:0,n+=s?s[1]:0,o?(o[0]=i,o[1]=n):o=[i,n],o}_handleUIChange(i,n){this.removeHandles("ui"),n&&n!==i&&n.destroy(),i&&(i.view=this,this.addHandles(I(()=>this.root,o=>{i.container=o?be(o):null},ht),"ui")),this._set("ui",i)}_stopMeasuring(){this.removeHandles("measuring"),this._get("resizing")&&this._set("resizing",!1)}_startMeasuring(){let i=this._freqInfo;i.freq=L,i.time=R;let n=H({prepare:a=>{let r=this._measure(),h=this._freqInfo;if(h.time+=a.deltaTime,r&&(h.freq=L,this._get("resizing")||this._set("resizing",!0)),h.time<h.freq)return;h.time=0;let c=this._position();h.freq=c||r?L:Math.min(R,h.freq*Ce),!r&&h.freq>=De&&(n.pause(),this._get("resizing")&&this._set("resizing",!1))}}),o=new ResizeObserver(a=>{i.freq=L,i.time=R,n.resume()});this.container!=null&&o.observe(this.container);let s=G(()=>o.disconnect());this.addHandles([Ct(window,"resize",()=>{i.freq=L,i.time=R,n.resume()}),s,n],"measuring"),this._measure(),this._position()}_measure(){let i=this.container,n=i?i.clientWidth:0,o=i?i.clientHeight:0;if(n===0||o===0)return this.suspended||this._set("suspended",!0),!1;let s=this.width,a=this.height;return n===s&&o===a?(this.suspended&&this._set("suspended",!1),!1):(this._set("width",n),this._set("height",o),this.suspended&&this._set("suspended",!1),this.emit("resize",{oldWidth:s,oldHeight:a,width:n,height:o}),!0)}_position(){let i=this.container,n=this.position,o=i&&we(i);return!!o&&(!n||o[0]!==n[0]||o[1]!==n[1])&&(this._set("position",[o[0],o[1]]),!0)}forceDOMReadyCycle(){}};return l([m()],t.prototype,"container",null),l([m({readOnly:!0})],t.prototype,"focused",null),l([m({readOnly:!0})],t.prototype,"height",void 0),l([m()],t.prototype,"messagesCommon",void 0),l([m({type:dt})],t.prototype,"overlay",void 0),l([m({readOnly:!0})],t.prototype,"position",void 0),l([m({readOnly:!0})],t.prototype,"resizing",void 0),l([m({readOnly:!0})],t.prototype,"root",void 0),l([m({value:null,readOnly:!0})],t.prototype,"size",null),l([m({readOnly:!0})],t.prototype,"surface",void 0),l([m({readOnly:!0})],t.prototype,"suspended",void 0),l([m({nonNullable:!0})],t.prototype,"ui",void 0),l([m({readOnly:!0})],t.prototype,"userContent",void 0),l([m({readOnly:!0})],t.prototype,"width",void 0),l([m()],t.prototype,"widthBreakpoint",void 0),t=l([j("esri.views.DOMContainer")],t),t};function Se(e,t){switch(t){case"primary":return e.pointerType==="touch"||e.button===0;case"secondary":return e.pointerType!=="touch"&&e.button===2;case"tertiary":return e.pointerType!=="touch"&&e.button===1}}function Ai(e,t){return t.some(i=>Se(e,i))}function Zi(e,t){let{button:i,pointerType:n}=e;return n!=="touch"&&t.some(o=>o==="primary"&&i===0||o==="secondary"&&i===2||o==="tertiary"&&i===1)}function zi(e,{dragPrimary:t,dragSecondary:i,dragTertiary:n}){return[{key:"primary",value:t},{key:"secondary",value:i},{key:"tertiary",value:n}].filter(o=>o.value===e).map(o=>o.key)}function ut(e){let t=e.native;return t?{buttons:t.buttons.map(i=>i.pressed?i.value||1:0),axes:t.axes.map(i=>ke(i,e.axisThreshold))}:{buttons:[],axes:[]}}function Lt(e,t){if(e.axes.length!==t.axes.length||e.buttons.length!==t.buttons.length)return!1;for(let i=0;i<e.axes.length;i++)if(e.axes[i]!==t.axes[i])return!1;for(let i=0;i<e.buttons.length;i++)if(e.buttons[i]!==t.buttons[i])return!1;return!0}function Ot(e){for(let t=0;t<e.axes.length;t++)if(e.axes[t]!==0)return!1;for(let t=0;t<e.buttons.length;t++)if(e.buttons[t]!==0)return!1;return!0}function ke(e,t){let i=Math.abs(e);return i<t?0:Math.sign(e)*(i-t)/(1-t)}var K=class{constructor(t,i){this._element=t,this._input=i,this._hasEventListeners=!1,this._onConnectGamepad=s=>{this._connectGamepad(s.gamepad)},this._onDisconnectGamepad=s=>{let a=s.gamepad,r=a.index,h=this._inputDevices[r];h&&(this._emitGamepadEvent(a,ut(h),!1),this._inputDevices.splice(r,1),this._latestUpdate.splice(r,1),this._input.gamepad.devices.remove(h),this.ensurePollingState())},this._frameTask=null,this._latestUpdate=new Array,this._inputDevices=new Array,this._callback=null;let n="getGamepads"in window.navigator,o=window.isSecureContext;this.supported=n&&o,this.supported&&(Wt(s=>this._connectGamepad(s)),window.addEventListener("gamepadconnected",this._onConnectGamepad),window.addEventListener("gamepaddisconnected",this._onDisconnectGamepad),this.ensurePollingState())}destroy(){this.hasEventListeners=!1,this.supported&&(window.removeEventListener("gamepadconnected",this._onConnectGamepad),window.removeEventListener("gamepaddisconnected",this._onDisconnectGamepad))}set hasEventListeners(t){this._hasEventListeners!==t&&(this._hasEventListeners=t,this.ensurePollingState())}get _eventsEnabled(){return this.supported&&this._inputDevices.length>0&&this._hasEventListeners}set onEvent(t){this._callback=t}_connectGamepad(t){let i=new zt(t);i.deviceType!=="unknown"&&(this._inputDevices[t.index]=i,this._input.gamepad.devices.add(i)),this.ensurePollingState()}ensurePollingState(){this._eventsEnabled?this._startPolling():this._stopPolling()}_startPolling(){this._frameTask==null&&(this._frameTask=H({update:()=>this._readGamepadState()}))}_stopPolling(){this._frameTask!=null&&(this._frameTask.remove(),this._frameTask=null,this._latestUpdate=new Array)}_readGamepadState(){let t=document.hasFocus(),i=this._element.contains(document.activeElement),n=this._input.gamepad.enabledFocusMode==="document"&&!t||this._input.gamepad.enabledFocusMode==="view"&&!i;Wt(o=>{let s=this._inputDevices[o.index];if(!s)return;let a=this._latestUpdate[o.index],r=ut(s),h=n||Ot(r);a&&(a.timestamp===o.timestamp||!a.active&&h||Lt(a.state,r))||this._emitGamepadEvent(o,r,!h)})}_emitGamepadEvent(t,i,n){let o=this._latestUpdate[t.index],s=o&&o.active;if(!s&&!n)return;let a=!s&&n?"start":s&&n?"update":"end";this._latestUpdate[t.index]={timestamp:t.timestamp,state:i,active:n},this._callback&&this._callback({device:this._inputDevices[t.index],state:i,action:a})}};function Me(e){if(!e||!e.connected)return!1;for(let t=0;t<e.axes.length;t++)if(isNaN(e.axes[t]))return!1;return!0}function Wt(e){for(let t of navigator.getGamepads())Me(t)&&e(t)}var Nt=Z("edge"),Te=Z("chrome"),Ee=Z("ff"),Fe=Z("safari"),Ht="esri-view-surface",O={touchNone:`${Ht}--touch-none`,touchPan:`${Ht}--touch-pan`},Bi=(()=>{class e{constructor(i,n){this._active={},this._callback=()=>{},this._activePointerCaptures=new Set,this._keyDownState=new Set,this._eventId=1,this._browserTouchPanningEnabled=!1,this._element=i,i.getAttribute("tabindex")||i.setAttribute("tabindex","0"),this._eventHandlers={"key-down":this._handleKey,"key-up":this._handleKey,"pointer-down":this._handlePointer,"pointer-move":this._handlePointerPreventDefault,"pointer-up":this._handlePointerPreventDefault,"pointer-enter":this._handlePointer,"pointer-leave":this._handlePointer,"pointer-cancel":this._handlePointer,"mouse-wheel":this._handleMouseWheel,"pointer-capture-lost":this._handlePointerCaptureLost},this._updateTouchAction(),this._element.addEventListener("keydown",this._preventAltKeyDefault),this._gamepadSource=new K(i,n),this._gamepadSource.onEvent=o=>this._callback("gamepad",o)}destroy(){this._callback=()=>{},this.activeEvents=null,this._activePointerCaptures.forEach(i=>this._releasePointerCaptureSafe(i)),this._activePointerCaptures.clear(),this._gamepadSource=Dt(this._gamepadSource),this._removeTouchAction(),this._element.removeEventListener("keydown",this._preventAltKeyDefault)}get browserTouchPanningEnabled(){return this._browserTouchPanningEnabled}set browserTouchPanningEnabled(i){this._browserTouchPanningEnabled=i,this._updateTouchAction(),this._updateTouchEventHandling()}set onEventReceived(i){this._callback=i}set activeEvents(i){for(let n in this._active)if(!i||!i.has(n)){let o=this._active[n];this._element.removeEventListener(mt[n],o),delete this._active[n]}i&&i.forEach(n=>{if(!this._active[n]&&mt[n]){let o=(this._eventHandlers[n]||this._handleDefault).bind(this,n);this._element.addEventListener(mt[n],o),this._active[n]=o}}),this._gamepadSource&&(this._gamepadSource.hasEventListeners=i?.has("gamepad")??!1)}setPointerCapture(i,n){n?this._setPointerCaptureSafe(i.pointerId):(this._releasePointerCaptureSafe(i.pointerId),this._activePointerCaptures.delete(i.pointerId))}_updateTouchAction(){this._element.classList.remove(this._browserTouchPanningEnabled?O.touchNone:O.touchPan),this._element.classList.add(this._browserTouchPanningEnabled?O.touchPan:O.touchNone)}_updateTouchEventHandling(){this._browserTouchPanningEnabled?this._element.addEventListener("touchmove",this._preventMultiTouchPanning):this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)}_removeTouchAction(){this._element.classList.remove(O.touchNone),this._element.classList.remove(O.touchPan),this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)}_setPointerCaptureSafe(i){try{this._element.setPointerCapture(i),this._activePointerCaptures.add(i)}catch{}}_releasePointerCaptureSafe(i){try{if(this._element.hasPointerCapture&&!this._element.hasPointerCapture(i))return;this._element.releasePointerCapture(i)}catch{}}_updateNormalizedPointerLikeEvent(i,n){let o=Zt(this._element,i);return e.test.disableSubpixelCoordinates&&(o.x=Math.round(o.x),o.y=Math.round(o.y)),n.x=o.x,n.y=o.y,n}_handleKey(i,n){let{key:o}=n;o&&i==="key-up"&&this._keyDownState.delete(o);let s={native:n,key:o,repeat:!!o&&this._keyDownState.has(o)};o&&i==="key-down"&&this._keyDownState.add(s.key),this._callback(i,s)}_handlePointer(i,n){let o=this._updateNormalizedPointerLikeEvent(n,{native:n,x:0,y:0,pointerType:n.pointerType,button:n.button,buttons:n.buttons,eventId:this._eventId++});this._callback(i,o)}_handlePointerPreventDefault(i,n){let o=this._updateNormalizedPointerLikeEvent(n,{native:n,x:0,y:0,pointerType:n.pointerType,button:n.button,buttons:n.buttons,eventId:this._eventId++});n.preventDefault(),this._callback(i,o)}_getDeltaFromTrackpadOrMouseWheel(i){return i.shiftKey&&Z("mac")&&i.deltaY===0?i.deltaX:i.deltaY}_handleMouseWheel(i,n){let o=this._getDeltaFromTrackpadOrMouseWheel(n);switch(n.deltaMode){case 0:Nt&&(o=o/document.documentElement.clientHeight*600);break;case 1:o*=30;break;case 2:o*=900}Nt?o*=.7:Te||Fe?o*=.6:Ee&&(o*=1.375);let s=100,a=Math.abs(o);a>s&&(o=o/a*200/(1+Math.exp(-.02*(a-s))));let r=this._updateNormalizedPointerLikeEvent(n,{native:n,x:0,y:0,deltaY:o});this._callback(i,r)}_handlePointerCaptureLost(i,n){this._activePointerCaptures.delete(n.pointerId),this._handleDefault(i,n)}_handleDefault(i,n){let o={native:n};n.preventDefault(),this._callback(i,o)}_preventAltKeyDefault(i){i.key==="Alt"&&i.preventDefault()}_preventMultiTouchPanning(i){i.touches.length>1&&i.preventDefault()}}return e.test={disableSubpixelCoordinates:!1},e})(),mt={"key-down":"keydown","key-up":"keyup","pointer-down":"pointerdown","pointer-up":"pointerup","pointer-move":"pointermove","mouse-wheel":"wheel","pointer-capture-got":"gotpointercapture","pointer-capture-lost":"lostpointercapture","context-menu":"contextmenu","pointer-enter":"pointerenter","pointer-leave":"pointerleave","pointer-cancel":"pointercancel",focus:"focus",blur:"blur"};var Ut=class extends w{constructor(){super(!0),this.registerIncoming("context-menu",t=>t.data.native.preventDefault())}};var p={maximumClickDelay:300,movementUntilMouseDrag:1.5,movementUntilPenDrag:6,movementUntilTouchDrag:6,holdDelay:500,maximumDoubleClickDelay:250,maximumDoubleClickDistance:10,maximumDoubleTouchDelay:350,maximumDoubleTouchDistance:35};function Q(e,t){return Math.abs(t.x-e.x)+Math.abs(t.y-e.y)}function qt(e,t){let i=t.x-e.x,n=t.y-e.y;return Math.sqrt(i*i+n*n)}function Rt(e,t){if(t?(t.radius=0,t.center.x=0,t.center.y=0):t={radius:0,center:U()},e.length===0)return t;if(e.length===1)return t.center.x=e[0].x,t.center.y=e[0].y,t;if(e.length===2){let[u,d]=e,[_,y]=[d.x-u.x,d.y-u.y];return t.radius=Math.sqrt(_*_+y*y)/2,t.center.x=(u.x+d.x)/2,t.center.y=(u.y+d.y)/2,t}let i=0,n=0;for(let u=0;u<e.length;u++)i+=e[u].x,n+=e[u].y;i/=e.length,n/=e.length;let o=e.map(u=>u.x-i),s=e.map(u=>u.y-n),a=0,r=0,h=0,c=0,v=0,E=0,P=0;for(let u=0;u<o.length;u++){let d=o[u],_=s[u],y=d*d,A=_*_;a+=y,r+=A,h+=d*_,c+=y*d,v+=A*_,E+=d*A,P+=_*y}let F=.5*(c+E),C=.5*(v+P),b=a*r-h*h,N=(F*r-C*h)/b,S=(a*C-h*F)/b,at=U(N+i,S+n);return{radius:Math.sqrt(N*N+S*S+(a+r)/e.length),center:at}}function M(e){let{native:t}=e,{pointerId:i,button:n,pointerType:o}=t;return o==="mouse"?`${i}:${n}`:`${o}`}var Qt=class extends w{constructor(t){super(!1),this._navigationTouch=t,this._startStateModifiers=new Set,this._activePointerMap=new Map,this._isDragging=!1,this._isCurrentDragSuppressed=!1,this._drag=this.registerOutgoing("drag"),this.registerIncoming("pointer-drag",this._handlePointerDrag.bind(this)),this.registerIncoming("pointer-up",this._handlePointerUpAndPointerLost.bind(this)),this.registerIncoming("pointer-capture-lost",this._handlePointerUpAndPointerLost.bind(this)),this.registerIncoming("pointer-cancel",this._handlePointerUpAndPointerLost.bind(this))}_createPayload(t,i,n,o){return{action:t,pointerType:this._pointerType,button:this._mouseButton,buttons:i.buttons,timestamp:o,pointers:Ae(this._activePointerMap),pointer:i,angle:n.angle,radius:n.radius,center:n.center}}_addPointer(t){let i=t.native.pointerId,n=V(this._activePointerMap).angle,o={event:t,initialAngle:0,lastAngle:0};this._activePointerMap.set(i,o);let s=Y(o,jt(this._activePointerMap));o.initialAngle=s,o.lastAngle=s,this._updatePointerAngles(n)}_updatePointer(t){if(t&&t.x==null&&t.y==null)return;let i=t.native.pointerId,n=this._activePointerMap.get(i);n?n.event=t:this._addPointer(t)}_removePointer(t){let i=V(this._activePointerMap).angle;this._activePointerMap.delete(t),this._updatePointerAngles(i)}_updatePointerAngles(t){let i=V(this._activePointerMap);this._activePointerMap.forEach(n=>{n.initialAngle=Y(n,i)-t,n.lastAngle=Y(n,i)-t})}_emitEvent(t,i,n){let o=V(this._activePointerMap);this._drag.emit(this._createPayload(t,i,o,n),void 0,this._startStateModifiers)}_handlePointerUpAndPointerLost(t){let i=t.data.native.pointerId,n=t.timestamp;this._activePointerMap.get(i)&&(this._activePointerMap.size===1?(this._updatePointer(t.data),!this._isCurrentDragSuppressed&&this._emitEvent("end",t.data,n),this._isDragging=!1,this._isCurrentDragSuppressed=!1,this._removePointer(i)):(this._removePointer(i),this._emitEvent("removed",t.data,t.timestamp)))}_handlePointerDrag(t){let i=t.data,n=i.currentEvent,o=t.timestamp;switch(i.action){case"start":case"update":this._isDragging?this._activePointerMap.has(n.native.pointerId)?(this._updatePointer(n),!this._isCurrentDragSuppressed&&this._emitEvent("update",n,o)):(this._addPointer(n),this._emitEvent("added",n,o),this._isCurrentDragSuppressed=this._isSuppressed):(this._updatePointer(n),this._pointerType=t.data.startEvent.pointerType,this._mouseButton=t.data.startEvent.button,this._startStateModifiers=t.modifiers,this._isDragging=!0,this._isCurrentDragSuppressed=this._isSuppressed,!this._isCurrentDragSuppressed&&this._emitEvent("start",n,o))}}get _isSuppressed(){return!!this._navigationTouch&&!this._navigationTouch.browserTouchPanEnabled&&this._pointerType==="touch"&&this._activePointerMap.size===1}};function jt(e){let t=[];return e.forEach(i=>{t.push(U(i.event.x,i.event.y))}),Rt(t)}function V(e){let t=jt(e),i=0;return e.forEach(n=>{let o=Y(n,t),s=o-n.lastAngle;for(;s>Math.PI;)s-=2*Math.PI;for(;s<-Math.PI;)s+=2*Math.PI;o=n.lastAngle+s,n.lastAngle=o;let a=o-n.initialAngle;i+=a}),i/=e.size||1,{angle:i,radius:t.radius,center:t.center}}function Ae(e){let t=new Map;return e.forEach((i,n)=>t.set(n,i.event)),t}function Y(e,t){let i=e.event,n=i.x-t.center.x,o=i.y-t.center.y;return Math.atan2(o,n)}var Bt;(function(e){e[e.Left=0]="Left",e[e.Middle=1]="Middle",e[e.Right=2]="Right",e[e.Back=3]="Back",e[e.Forward=4]="Forward",e[e.Undefined=-1]="Undefined"})(Bt||(Bt={}));var $t=class extends w{constructor(t=p.maximumDoubleClickDelay,i=p.maximumDoubleClickDistance,n=p.maximumDoubleTouchDelay,o=p.maximumDoubleTouchDistance,s=z){super(!1),this._maximumDoubleClickDelay=t,this._maximumDoubleClickDistance=i,this._maximumDoubleTouchDelay=n,this._maximumDoubleTouchDistance=o,this._clock=s,this._pointerState=new Map,this._immediateDoubleClick=this.registerOutgoing("immediate-double-click"),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this)),this.registerIncoming("pointer-up",this._handlePointerUp.bind(this))}onUninstall(){this._pointerState.forEach(t=>{t.immediateDoubleClick&&t.immediateDoubleClick.timeoutHandle.remove()}),super.onUninstall()}_handlePointerDown(t){let i=t.data,n=M(i);if(!this._pointerState.has(n)){let o={downButton:i.native.button,x:i.x,y:i.y,immediateDoubleClick:null};this._pointerState.set(n,o),this.startCapturingPointer(i.native)}}_handlePointerUp(t){let i=t.data,n=M(i),o=this._pointerState.get(n);if(o&&o.downButton===i.native.button){let s=o.immediateDoubleClick,a=t.data.native.pointerType==="touch"?this._maximumDoubleTouchDistance:this._maximumDoubleClickDistance;s?(s.timeoutHandle.remove(),Q(s,t.data)>a?this._startImmediateDoubleClick(t,o):(this._immediateDoubleClick.emit(t.data,void 0,s.modifiers),this._removeState(i))):Q(o,t.data)>a?this._removeState(i):this._startImmediateDoubleClick(t,o)}}_startImmediateDoubleClick(t,i){let n=t.data.native.pointerType==="touch"?this._maximumDoubleTouchDelay:this._maximumDoubleClickDelay;i.immediateDoubleClick={x:t.data.x,y:t.data.y,modifiers:t.modifiers,timeoutHandle:this._clock.setTimeout(()=>this._removeState(t.data),n)}}_removeState(t){let i=M(t);this._pointerState.delete(i),this.stopCapturingPointer(t.native),this.refreshHasPendingInputs()}};var Kt=class extends w{constructor(t=p.maximumClickDelay,i=p.movementUntilMouseDrag,n=p.movementUntilPenDrag,o=p.movementUntilTouchDrag,s=p.holdDelay,a=z){super(!1),this._maximumClickDelay=t,this._movementUntilMouseDrag=i,this._movementUntilPenDrag=n,this._movementUntilTouchDrag=o,this._holdDelay=s,this._clock=a,this._pointerState=new Map,this._pointerDrag=this.registerOutgoing("pointer-drag"),this._immediateClick=this.registerOutgoing("immediate-click"),this._pointerHold=this.registerOutgoing("hold"),this.registerIncoming("pointer-down",r=>this._handlePointerDown(r)),this.registerIncoming("pointer-up",r=>this._handlePointerLoss(r,"pointer-up")),this.registerIncoming("pointer-capture-lost",r=>this._handlePointerLoss(r,"pointer-capture-lost")),this.registerIncoming("pointer-cancel",r=>this._handlePointerLoss(r,"pointer-cancel")),this._moveHandle=this.registerIncoming("pointer-move",r=>this._handlePointerMove(r)),this._moveHandle.pause()}onUninstall(){this._pointerState.forEach(t=>{t.holdTimeout=k(t.holdTimeout)}),super.onUninstall()}_handlePointerDown(t){let i=t.data,n=i.native.pointerId,o=null;this._pointerState.size===0&&(o=this._clock.setTimeout(()=>{let a=this._pointerState.get(n);if(a){if(!a.isDragging){let r=a.previousEvent;this._pointerHold.emit(r,void 0,t.modifiers),a.holdEmitted=!0}a.holdTimeout=null}},this._holdDelay));let s={startEvent:i,previousEvent:i,startTimestamp:t.timestamp,isDragging:!1,downButton:i.native.button,holdTimeout:o,modifiers:new Set};this._pointerState.set(n,s),this.startCapturingPointer(i.native),this._moveHandle.resume(),this._pointerState.size>1&&this._startDragging(t)}_handlePointerMove(t){let i=t.data,n=i.native.pointerId,o=this._pointerState.get(n);o&&(o.isDragging?this._pointerDrag.emit(X("update",o,i),void 0,o.modifiers):qt(i,o.startEvent)>this._getDragThreshold(i.native.pointerType)&&this._startDragging(t),o.previousEvent=i)}_getDragThreshold(t){switch(t){case"touch":return this._movementUntilTouchDrag;case"pen":return this._movementUntilPenDrag;default:return this._movementUntilMouseDrag}}_startDragging(t){let i=t.data,n=i.native.pointerId;this._pointerState.forEach(o=>{o.holdTimeout!=null&&(o.holdTimeout.remove(),o.holdTimeout=null),o.isDragging||(o.modifiers=t.modifiers,o.isDragging=!0,n===o.startEvent.native.pointerId?this._pointerDrag.emit(X("start",o,i)):this._pointerDrag.emit(X("start",o,o.previousEvent),t.timestamp))})}_handlePointerLoss(t,i){let n=t.data,o=n.native.pointerId,s=this._pointerState.get(o);s&&(s.holdTimeout!=null&&(s.holdTimeout.remove(),s.holdTimeout=null),s.isDragging?this._pointerDrag.emit(X("end",s,i==="pointer-up"?n:s.previousEvent),void 0,s.modifiers):i==="pointer-up"&&s.downButton===n.native.button&&t.timestamp-s.startTimestamp<=this._maximumClickDelay&&!s.holdEmitted&&this._immediateClick.emit(n),this._pointerState.delete(o),this.stopCapturingPointer(n.native),this._pointerState.size===0&&this._moveHandle.pause())}};function X(e,t,i){return{action:e,startEvent:t.startEvent,previousEvent:t.previousEvent,currentEvent:i}}var Vt=class extends w{constructor(t=p.maximumDoubleClickDelay,i=p.maximumDoubleClickDistance,n=p.maximumDoubleTouchDelay,o=p.maximumDoubleTouchDistance,s=z){super(!1),this._maximumDoubleClickDelay=t,this._maximumDoubleClickDistance=i,this._maximumDoubleTouchDelay=n,this._maximumDoubleTouchDistance=o,this._clock=s,this._pointerState=new Map,this._click=this.registerOutgoing("click"),this._doubleClick=this.registerOutgoing("double-click"),this.registerIncoming("immediate-click",a=>this._handleImmediateClick(a)),this.registerIncoming("pointer-down",a=>this._handlePointerDown(a))}onUninstall(){this._pointerState.forEach(t=>t.doubleClickTimer=k(t.doubleClickTimer))}get hasPendingInputs(){for(let t of this._pointerState.values())if(t.doubleClickTimer!=null)return!0;return!1}_clearDoubleClickTimer(t,i){let n=this._pointerState.get(t);n&&(n.doubleClickTimer=k(n.doubleClickTimer),i&&this._click.emit(n.event.data,void 0,n.event.modifiers),this._pointerState.delete(t),this.refreshHasPendingInputs())}_doubleClickTimeoutExceeded(t){let i=this._pointerState.get(t);i.pointerDownCount===1&&this._click.emit(i.event.data,void 0,i.event.modifiers),i.doubleClickTimer=null,this._pointerState.delete(t),this.refreshHasPendingInputs()}_handleImmediateClick(t){let i=t.data,{pointerType:n}=i.native,o=Ze(i);if(!this._pointerState.has(o))return void this._startClick(t);let s=this._pointerState.get(o),{data:a,modifiers:r}=s.event,h=n==="touch"?this._maximumDoubleTouchDistance:this._maximumDoubleClickDistance;Q(a,i)>h?(this._clearDoubleClickTimer(o,!0),this._startClick(t)):(this._clearDoubleClickTimer(o,!1),s.pointerDownCount===2&&this._doubleClick.emit(a,void 0,r))}_handlePointerDown(t){let i=M(t.data),n=this._pointerState.get(i);n&&(n.pointerDownCount+=1)}_startClick(t){let{data:i}=t,{native:{pointerType:n}}=i,o=M(i),s=n==="touch"?this._maximumDoubleTouchDelay:this._maximumDoubleClickDelay,a=this._clock.setTimeout(()=>this._doubleClickTimeoutExceeded(o),s);this._pointerState.set(o,{event:t,doubleClickTimer:a,pointerDownCount:1}),this.refreshHasPendingInputs()}};function Ze(e){let{pointerId:t,pointerType:i,button:n}=e.native;return i==="mouse"?`${t}:${n}`:`${i}`}var ze=e=>e,B=e=>e*e,J=e=>1-B(1-e),Ie=e=>e<.5?B(2*e)/2:(J(2*(e-.5))+1)/2,pt=e=>e*e*e,Yt=e=>1-pt(1-e),Le=e=>e<.5?pt(2*e)/2:(Yt(2*(e-.5))+1)/2,_t=e=>e*e*e*e,Xt=e=>1-_t(1-e),Oe=e=>e<.5?_t(2*e)/2:(Xt(2*(e-.5))+1)/2,ft=e=>e*e*e*e*e,Jt=e=>1-ft(1-e),We=e=>e<.5?ft(2*e)/2:(Jt(2*(e-.5))+1)/2,gt=e=>1-Math.cos(e*Math.PI/2),te=e=>1-gt(1-e),Ne=e=>e<.5?gt(2*e)/2:(te(2*(e-.5))+1)/2,vt=e=>2**(10*(e-1)),tt=e=>1-vt(1-e),He=e=>e<.5?vt(2*e)/2:(tt(2*(e-.5))+1)/2,Pt=e=>-(Math.sqrt(1-e*e)-1),ee=e=>1-Pt(1-e),Ue=e=>e<.5?Pt(2*e)/2:(ee(2*(e-.5))+1)/2;function f(e){let t=2*(e-Math.sqrt((e-1)*e)),i=t/2/e;return n=>n<i?e*n*n:t*n-t+1}function g(e,t){return(i,n)=>i<t?t*e(i/t,n):1-e((1-i)/(1-t),n)*(1-t)}var qe=g(f(1),1),Re=g(f(1),0),et=g(f(1),.5),Qe=g(f(2),1),Be=g(f(2),0),Ge=g(f(2),.5),je=g(f(3),1),$e=g(f(3),0),Ke=g(f(3),.5),Ve=g(f(4),1),Ye=g(f(4),0),Xe=g(f(4),.5),vn={linear:ze,"in-quad":B,"out-quad":J,"in-out-quad":Ie,"in-coast-quad":qe,"out-coast-quad":Re,"in-out-coast-quad":et,"in-cubic":pt,"out-cubic":Yt,"in-out-cubic":Le,"in-coast-cubic":Qe,"out-coast-cubic":Be,"in-out-coast-cubic":Ge,"in-quart":_t,"out-quart":Xt,"in-out-quart":Oe,"in-coast-quart":je,"out-coast-quart":$e,"in-out-coast-quart":Ke,"in-quint":ft,"out-quint":Jt,"in-out-quint":We,"in-coast-quint":Ve,"out-coast-quint":Ye,"in-out-coast-quint":Xe,"in-sine":gt,"out-sine":te,"in-out-sine":Ne,"in-expo":vt,"out-expo":tt,"in-out-expo":He,"in-circ":Pt,"out-circ":ee,"in-out-circ":Ue,ease:e=>q.ease(e),"ease-in":e=>q.easeIn(e),"ease-out":e=>q.easeOut(e),"ease-in-out":e=>q.easeInOut(e)};var T={desiredScreenFlow:2,minDuration:500,maxDuration:8e3},yn=yt(xt({},T),{maxDuration:4e3});var it=class{constructor(){this.pan=0,this.rotate=0,this.fov=0,this.sourceZoom=0,this.targetZoom=0}};var nt=class e{constructor(t){this._createCamera=t,this.compared=new it,this.segmentStart=0,this.segmentEnd=1,this.settings={desiredScreenFlow:T.desiredScreenFlow},this.source=t(),this.target=t()}clone(){let t=new e(this._createCamera);return t.copyFrom(this),t}copyFrom(t){this.update(t.source,t.target,t.settings)}update(t,i,n){this.source!==t&&this.source.copyFrom(t),this.target!==i&&this.target.copyFrom(i),this.source.compareTo(this.target,this.compared),this.settings.desiredScreenFlow=n.desiredScreenFlow??T.desiredScreenFlow,this.desiredPixelFlow=this.settings.desiredScreenFlow*this.target.size,this.halfWindowSize=this.target.size/2}halfWindowPanAtZoom(t){let i=this.target.pixelsPerPanAtZoom(t);return this.halfWindowSize/i}get hasZoom(){return Math.abs(this.compared.sourceZoom-this.compared.targetZoom)>1e-5}get hasPan(){return this.compared.pan>$()}get hasFov(){return Math.abs(this.compared.fov)>$()}get hasRotate(){return this.compared.rotate>$()}};var ot=class{constructor(){this.pan=0,this.rotate=0,this.zoom=0,this.fov=0,this.zoomOffset=0}};var ne=class{constructor(){this.segments=new Array}get time(){return this.segments.reduce((e,t)=>e+t.time,0)}interpolateComponentsAt(e,t){e=Math.min(Math.max(e,0),1),e*=this.time;let i=0,n=0,o=this.definition,s=this.segments.reduce((a,r)=>a||r.definition.hasZoom,!1);for(let a=0;a<this.segments.length;a++){let r=this.segments[a],h=r.definition;if(e<=r.time||a===this.segments.length-1){if(this.segmentInterpolateComponentsAt(r,r.time===0?0:e/r.time,t),o.hasPan&&!isNaN(t.pan)&&isFinite(o.compared.pan)?t.pan=(i+h.compared.pan*t.pan)/o.compared.pan:t.pan=1,o.hasRotate&&!isNaN(t.rotate)&&isFinite(o.compared.rotate)?t.rotate=(n+h.compared.rotate*t.rotate)/o.compared.rotate:t.rotate=1,s&&!isNaN(t.zoom)&&isFinite(h.compared.targetZoom)){let{sourceZoom:c,targetZoom:v}=h.compared,E=t.zoom*(v-c)+c,P=this.segments[0].definition.compared.sourceZoom,F=this.segments[this.segments.length-1].definition.compared.targetZoom,C=Math.abs(v-P)>Math.abs(c-P)?v:c;t.zoomOffset=C-F,t.zoom=(E-P)/(C-P)}else t.zoom=1;return t}e-=r.time,i+=h.compared.pan,n+=h.compared.rotate}}segmentInterpolateComponentsAt(e,t,i){e.interpolateComponentsAt(t,i)}};var W=class{get time(){return this._time}constructor(t){t&&this.update(t)}update(t){t&&(this.definition?this.definition.copyFrom(t):this.definition=t.clone()),this._updatePrecomputedVariables(),this._updatePixelFlow()}_updatePrecomputedVariables(){let t=this.definition,i=t.compared,n=i.sourceZoom,o=i.targetZoom;this._zoomSign=n>o?1:-1,this._panPixelsAtSource=i.pan*t.source.pixelsPerPanAtZoom(n);let s=(t.source.pixelsPerRotate()+t.target.pixelsPerRotate())/2;this._rotatePixels=i.rotate*s}_updatePixelFlow(){let t=this.definition.compared.sourceZoom,i=this.definition.compared.targetZoom,{hasZoom:n,hasPan:o,hasRotate:s}=this.definition,a=0,r=0;n&&(o&&(a=(i/t-1)/(-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2*this._panPixelsAtSource)),s&&(r=this._zoomSign*(Math.log(t/i)/Math.LN2)*this.definition.halfWindowSize/this._rotatePixels)),this._zoomPixelFlow=0,this._panPixelFlow=0,this._rotatePixelFlow=0;let h=this.definition.desiredPixelFlow;if(n&&o&&s){let c=a+r+a*r;this._zoomPixelFlow=a*r/c*h,this._panPixelFlow=r/c*h,this._rotatePixelFlow=a/c*h}else if(n&&o){let c=1+a;this._zoomPixelFlow=a/c*h,this._panPixelFlow=1/c*h}else if(n&&s){let c=1+r;this._zoomPixelFlow=r/c*h,this._rotatePixelFlow=1/c*h}else if(o&&s){let c=this._panPixelsAtSource/this._rotatePixels,v=1+c;this._panPixelFlow=c/v*h,this._rotatePixelFlow=1/v*h}else o?this._panPixelFlow=h:n?this._zoomPixelFlow=h:s&&(this._rotatePixelFlow=h);if(this._time=Math.max(this.rotateTime,this.zoomTime,this.panTime),this.fovTime>this._time){let c=this.fovTime/this._time;this._time=this.fovTime,this._zoomPixelFlow/=c,this._panPixelFlow/=c,this._rotatePixelFlow/=c}}get rotateTime(){return this.definition.hasRotate?this._rotatePixels/this._rotatePixelFlow:0}get zoomTime(){return this.definition.hasZoom?this._zoomSign*(Math.log(this.definition.compared.sourceZoom/this.definition.compared.targetZoom)/Math.LN2)*this.definition.halfWindowSize/this._zoomPixelFlow:0}get fovTime(){return this.definition.hasFov?Math.abs(this.definition.compared.fov)/Je:0}get panTime(){if(!this.definition.hasPan)return 0;if(this.definition.hasZoom){let t=-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2,i=t*this._panPixelsAtSource;return Math.log(i*(this._zoomPixelFlow/this._panPixelFlow)+1)/(t*this._zoomPixelFlow)}return this._panPixelsAtSource/this._panPixelFlow}_interpolateComponentsZoom(t){if(t===0||t===1)return t;if(this.definition.hasZoom){let i=this.definition.compared.sourceZoom,n=this.definition.compared.targetZoom;return(i*(i/n)**-t-i)/(n-i)}return t}_interpolateComponentsFov(t){if(t===0)return this.definition.segmentStart;if(t===1)return this.definition.segmentEnd;if(this.definition.hasFov){let{segmentStart:i,segmentEnd:n}=this.definition;return i+t*(n-i)}return this.definition.segmentStart}_interpolateComponentsPan(t){if(t===0||t===1)return t;if(this.definition.hasPan&&this.definition.hasZoom){let i=-1/(this._zoomSign*this.definition.halfWindowSize)*this._zoomPixelFlow;return 1/this._panPixelsAtSource*(this._panPixelFlow*(2**(i*t*this._time)-1))/(i*Math.LN2)}return t}_interpolateComponentsRotate(t){return t}interpolateComponentsAt(t,i){t=Math.min(Math.max(t,0),1),i.zoom=this._interpolateComponentsZoom(t),i.pan=this._interpolateComponentsPan(t),i.rotate=this._interpolateComponentsRotate(t),i.zoomOffset=0,i.fov=this._interpolateComponentsFov(t)}},Je=Et(45);function oe(e,t,i){let n=t-e.compared.sourceZoom,o=e.halfWindowPanAtZoom(n);return-e.halfWindowSize*(i.ascensionFactor*Math.LN2*e.compared.pan+o)*Math.log(e.compared.sourceZoom/t)/(e.desiredPixelFlow*Math.LN2*o)}function se(e,t,i){let n=1/t,o=Math.log(e.compared.sourceZoom*n),s=1/e.desiredPixelFlow,a=1/Math.LN2,r=t-e.compared.sourceZoom,h=1/r,c=(i.ascensionFactor*Math.LN2*e.compared.pan+e.halfWindowPanAtZoom(r))/e.halfWindowPanAtZoom(1);return e.halfWindowSize*n*s*a*h*c-e.halfWindowSize*o*s*a*h+e.halfWindowSize*o*s*a*c/(r*r)}function ae(e,t,i){let n=t-e.compared.sourceZoom,o=1/n,s=1/t,a=Math.log(e.compared.sourceZoom*s),r=(i.ascensionFactor*Math.LN2*e.compared.pan+e.halfWindowPanAtZoom(n))/e.halfWindowPanAtZoom(1);return e.halfWindowSize*o*(-2*o*s*r+2*o*a+2*s-2*a*r/(n*n)-r/(t*t))/(e.desiredPixelFlow*Math.LN2)}function re(e,t){return-e.halfWindowSize*Math.log(e.compared.sourceZoom/t)/(e.desiredPixelFlow*Math.LN2)}function he(e,t){return e.halfWindowSize/(t*e.desiredPixelFlow*Math.LN2)}function ce(e,t){return-e.halfWindowSize/(t*t*e.desiredPixelFlow*Math.LN2)}function de(e,t,i){return-e.compared.pan*e.halfWindowSize*(i.ascensionFactor+i.descensionFactor-1)/(e.desiredPixelFlow*e.halfWindowPanAtZoom(t))}function le(e,t,i){return e.compared.pan*e.halfWindowSize*(i.ascensionFactor+i.descensionFactor-1)/(e.desiredPixelFlow*e.halfWindowPanAtZoom(t*t))}function ue(e,t,i){return-2*e.compared.pan*e.halfWindowSize*(i.ascensionFactor+i.descensionFactor-1)/(e.desiredPixelFlow*e.halfWindowPanAtZoom(t*t*t))}function me(e,t,i){return e.halfWindowSize*(-e.halfWindowPanAtZoom(t)-i.descensionFactor*Math.LN2*e.compared.pan+e.halfWindowPanAtZoom(e.compared.targetZoom))*Math.log(t/e.compared.targetZoom)/(e.desiredPixelFlow*Math.LN2*e.halfWindowPanAtZoom(-t+e.compared.targetZoom))}function pe(e,t,i){let n=Math.log(t/e.compared.targetZoom),o=1/e.desiredPixelFlow,s=1/Math.LN2,a=-t+e.compared.targetZoom,r=1/a,h=(-e.halfWindowPanAtZoom(t)-i.descensionFactor*Math.LN2*e.compared.pan+e.halfWindowPanAtZoom(e.compared.targetZoom))/e.halfWindowPanAtZoom(1);return-e.halfWindowSize*n*o*s*r+e.halfWindowSize*n*o*s*h/(a*a)+e.halfWindowSize*o*s*r*h/t}function _e(e,t,i){let n=t-e.compared.targetZoom,o=1/n,s=1/t,a=Math.log(t/e.compared.targetZoom),r=(e.halfWindowPanAtZoom(t)+i.descensionFactor*Math.LN2*e.compared.pan-e.halfWindowPanAtZoom(e.compared.targetZoom))/e.halfWindowPanAtZoom(1);return e.halfWindowSize*o*(-2*o*s*r-2*o*a+2*s+2*a*r/(n*n)-r/(t*t))/(e.desiredPixelFlow*Math.LN2)}function fe(e,t){return e.halfWindowSize*Math.log(t/e.compared.targetZoom)/(e.desiredPixelFlow*Math.LN2)}function ge(e,t){return e.halfWindowSize/(t*e.desiredPixelFlow*Math.LN2)}function ve(e,t){return-e.halfWindowSize/(t*t*e.desiredPixelFlow*Math.LN2)}function Pe(e){let t=e.compared.sourceZoom-e.compared.targetZoom;if(t===0)return e.compared.pan*e.halfWindowSize/(e.desiredPixelFlow*e.halfWindowPanAtZoom(e.compared.sourceZoom));let i=Math.LN2*e.compared.pan,n=t,o=e.halfWindowPanAtZoom(n),s=e.halfWindowSize*Math.log(e.compared.sourceZoom/e.compared.targetZoom)/(e.desiredPixelFlow*Math.LN2*o);return e.compared.sourceZoom<=e.compared.targetZoom?s*(i-o):s*(i+o)}function xe(e,t){let i=ti(e,t),n={ascensionFactor:t.ascensionFactor!=null?t.ascensionFactor:.5,descensionFactor:t.descensionFactor!=null?t.descensionFactor:.5},o=n.ascensionFactor===0,s=n.descensionFactor===0,a=o?re:oe,r=o?he:se,h=o?ce:ae,c=s?fe:me,v=s?ge:pe,E=s?ve:_e,P=d=>a(e,d,n)+de(e,d,n)+c(e,d,n),F=d=>r(e,d,n)+le(e,d,n)+v(e,d,n),C=d=>h(e,d,n)+ue(e,d,n)+E(e,d,n),b=P(i),N=Pe(e),S,at=t.maximumIterations||20,u=t.maximumDistance!=null?t.maximumDistance:1/0;for(S=0;S<at;S++){let d=t.desiredSlope??1e-6,_=F(i);Math.abs(_)>d&&(_+=d);let y=_/C(i);if(isNaN(y)||i>=u&&y<0){if(!isFinite(u))return null;i=u,b=P(i);break}if(i-=y,i<e.compared.sourceZoom||i<e.compared.targetZoom)return null;let A=P(i);if(Math.abs(A-b)/b<=.005)break;b=A}return b>N*(1-.3)||i<e.compared.sourceZoom||i<e.compared.targetZoom?null:i}function ti(e,t){let i=Math.max(e.compared.sourceZoom,e.compared.targetZoom),n=e.source.zoomAtPixelsPerPan(e.desiredPixelFlow/e.compared.pan)/2;return n<i?t.maximumDistance!=null?i+(t.maximumDistance-i)/2:1.5*i:t.maximumDistance?Math.min(t.maximumDistance,n):n}var st=class extends ne{constructor(t,i){super(),this._preallocSegments=[new W,new W,new W],this._ascensionSegment=null,this._descensionSegment=null,this.update(t,i)}update(t,i){if(!t)return;this.definition?this.definition.copyFrom(t):this.definition=t.clone();let n=i?.apex?xe(t,i.apex):null;this.segments.length=0,this._ascensionSegment=null,this._descensionSegment=null,n?this._updateWithApex(n,i?.apex):this._updateWithoutApex()}segmentInterpolateComponentsAt(t,i,n){t.interpolateComponentsAt(i,n),t===this._ascensionSegment?n.zoom=J(n.zoom):t===this._descensionSegment&&(n.zoom=B(n.zoom))}_updateWithApex(t,i){let[n,o,s]=this._preallocSegments,a=i?.ascensionFactor??.5,r=Math.min(1-a,i?.ascensionFactor!=null&&i.descensionFactor!=null?i.descensionFactor:.5),h=1-a-r;n.definition?n.definition.copyFrom(this.definition):n.definition=this.definition.clone(),n.definition.compared.targetZoom=t,n.definition.compared.pan=this.definition.compared.pan*a,n.definition.compared.rotate=this.definition.compared.rotate*a,n.definition.segmentEnd=a,n.update(),this._ascensionSegment=n,this.segments.push(n),h>0&&(o.definition?o.definition.copyFrom(this.definition):o.definition=this.definition.clone(),o.definition.copyFrom(this.definition),o.definition.compared.sourceZoom=t,o.definition.compared.targetZoom=t,o.definition.compared.pan=this.definition.compared.pan*h,o.definition.compared.rotate=this.definition.compared.rotate*h,o.definition.segmentStart=n.definition.segmentEnd,o.definition.segmentEnd=n.definition.segmentEnd+h,o.update(),this.segments.push(o)),s.definition?s.definition.copyFrom(this.definition):s.definition=this.definition.clone(),s.definition.compared.sourceZoom=t,s.definition.compared.pan=this.definition.compared.pan*r,s.definition.compared.rotate=this.definition.compared.rotate*r,s.definition.segmentStart=a+h,s.update(),this._descensionSegment=s,this.segments.push(s)}_updateWithoutApex(){let[t]=this._preallocSegments;t.update(this.definition),this.segments.push(t)}};var ei=new ot,Vn=class{get time(){return this._time}get isLinear(){return this.path.segments.length===1}constructor(e){this._time=0,this._easing=et,this.definition=new nt(e),this.path=new st}update(e,t,i){this.definition.update(e,t,i),this.path.update(this.definition,i),this._time=this._applyTimeSettings(St(isFinite(this.path.time)?this.path.time:0),i),this._easing=i.easing??(this._time>=1e3?et:tt)}cameraAt(e,t){e=Math.min(Math.max(0,e),1),e=this._normalizedEasing(e);let i=this.path.interpolateComponentsAt(e,ei);t.interpolate(this.definition.source,this.definition.target,i)}_normalizedEasing(e){let t=this._easing(0,this._time),i=this._easing(1,this._time);return(this._easing(e,this._time)-t)/(i-t)}_applyTimeSettings(e,t){let i=t.speedFactor!=null?t.speedFactor:1,n=t.minDuration??T.minDuration/i,o=t.maxDuration??T.maxDuration/i;return e=t.duration!=null?t.duration:Math.min(Math.max(e/i,n),o)}};var ye=class{constructor(t){this._callbacks=t,this._currentCount=0,this._callbacks.condition||(this._callbacks.condition=()=>!0)}handle(t){let i=t.data,n=i.pointers.size;switch(i.action){case"start":this._currentCount=n,this._emitStart(t);break;case"added":this._emitEnd(this._previousEvent),this._currentCount=n,this._emitStart(t);break;case"update":this._emitUpdate(t);break;case"removed":this._startEvent&&this._emitEnd(this._previousEvent),this._currentCount=n,this._emitStart(t);break;case"end":this._emitEnd(t),this._currentCount=0}this._previousEvent=t}_emitStart(t){this._startEvent=t,this._callbacks.condition?.(this._currentCount,t)&&this._callbacks.start(this._currentCount,t,this._startEvent)}_emitUpdate(t){this._callbacks.condition?.(this._currentCount,t)&&this._callbacks.update(this._currentCount,t,this._startEvent)}_emitEnd(t){this._callbacks.condition?.(this._currentCount,t)&&this._callbacks.end(this._currentCount,t,this._startEvent),this._startEvent=null}};function eo(e){let t=()=>e(document.visibilityState==="visible");return document.addEventListener("visibilitychange",t),G(()=>document.removeEventListener("visibilitychange",t))}function x(e){let t=e*e;return e<0&&(t*=-1),t}function oo(e){return e.translation[0]=0,e.translation[1]=0,e.translation[2]=0,e.heading=0,e.tilt=0,e}function so(e,t,i){let n=i,o=e.state,s=e.device,a=t.tiltDirection==="forward-down"?1:-1,r=1;return s.deviceType==="standard"?(n.translation[0]=x(o.axes[0]),n.translation[1]=x(o.axes[1]),n.translation[2]=x(o.buttons[7])-x(o.buttons[6]),n.heading=x(o.axes[2]),n.tilt=x(o.axes[3])):s.deviceType==="spacemouse"&&(n.translation[0]=1.2*x(o.axes[0]),n.translation[1]=1.2*x(o.axes[1]),n.translation[2]=2*-x(o.axes[2]),n.heading=1.2*x(o.axes[5]),n.tilt=1.2*x(o.axes[3])),n.tilt*=a,Ft(n.translation,n.translation,r),n}function ao(e,t){let i=t;return i.translation[0]=e[1]-e[0],i.translation[1]=e[3]-e[2],i.translation[2]=e[4]-e[5],i.heading=e[7]-e[6],i.tilt=e[8]-e[9],i.zoom=e[10]-e[11],i}function ro(e){return e.translation[0]===0&&e.translation[1]===0&&e.translation[2]===0&&e.heading===0&&e.tilt===0&&e.zoom===0}export{Ti as a,Se as b,Ai as c,Zi as d,zi as e,ye as f,oo as g,so as h,ao as i,ro as j,eo as k,Bi as l,Ut as m,p as n,Q as o,M as p,Qt as q,$t as r,Kt as s,Vt as t,Le as u,tt as v,vn as w,yn as x,Vn as y};
