import{n as q,p as G,q as B}from"./chunk-WQCUIPYO.js";import{a as g,b as $,c as H,d as K,e as F}from"./chunk-APPR4L23.js";import"./chunk-2FGSO4BX.js";import"./chunk-QH76JJOT.js";import{$a as M,B as f,Ba as i,Gb as J,Hb as b,I as h,Ib as V,K as C,Na as z,O as E,Ra as y,Ua as A,Y as P,Ya as l,Z as j,ca as R,g as m,h as O,hb as p,ia as n,jb as k,la as _,m as T,oa as v,pb as Z,qb as U,rb as S,ub as W,ya as s,za as N}from"./chunk-QXXJ4VIA.js";var Q=(()=>{class r{mapService=n(g);zone=n(N);id=i.required();data=A();minzoom=i();maxzoom=i();attribution=i();buffer=i();tolerance=i();cluster=i();clusterRadius=i();clusterMaxZoom=i();clusterMinPoints=i();clusterProperties=i();lineMetrics=i();generateId=i();promoteId=i();filter=i();dynamic=i();updateFeatureData=new T;sub=new O;sourceAdded=!1;featureIdCounter=0;ngOnInit(){this.data()||this.data.set({type:"FeatureCollection",features:[]});let e=this.mapService.mapLoaded$.subscribe(()=>{this.init();let t=h(this.mapService.mapInstance,"styledata").pipe(C(()=>!this.mapService.mapInstance.getSource(this.id()))).subscribe(()=>{this.init()});this.sub.add(t)});this.sub.add(e)}ngOnChanges(e){if(this.sourceAdded&&((e.minzoom&&!e.minzoom.isFirstChange()||e.maxzoom&&!e.maxzoom.isFirstChange()||e.attribution&&!e.attribution.isFirstChange()||e.buffer&&!e.buffer.isFirstChange()||e.tolerance&&!e.tolerance.isFirstChange()||e.cluster&&!e.cluster.isFirstChange()||e.clusterRadius&&!e.clusterRadius.isFirstChange()||e.clusterMaxZoom&&!e.clusterMaxZoom.isFirstChange()||e.clusterMinPoints&&!e.clusterMinPoints.isFirstChange()||e.clusterProperties&&!e.clusterProperties.isFirstChange()||e.lineMetrics&&!e.lineMetrics.isFirstChange()||e.generateId&&!e.generateId.isFirstChange()||e.promoteId&&!e.promoteId.isFirstChange()||e.filter&&!e.filter.isFirstChange()||e.dynamic&&!e.dynamic.isFirstChange())&&(this.ngOnDestroy(),this.ngOnInit()),e.data&&!e.data.isFirstChange())){let t=this.mapService.getSource(this.id());if(t===void 0)return;t.setData(this.data())}}ngOnDestroy(){this.sub.unsubscribe(),this.sourceAdded&&(this.mapService.removeSource(this.id()),this.sourceAdded=!1)}getClusterExpansionZoom(e){return m(this,null,function*(){let t=this.mapService.getSource(this.id());return this.zone.run(()=>m(this,null,function*(){return new Promise((a,u)=>{t.getClusterExpansionZoom(e,(c,d)=>{c?u(c):a(d)})})}))})}getClusterChildren(e){return m(this,null,function*(){let t=this.mapService.getSource(this.id());return this.zone.run(()=>m(this,null,function*(){return new Promise((a,u)=>{t.getClusterChildren(e,(c,d)=>{c?u(c):a(d)})})}))})}getClusterLeaves(e,t,a){return m(this,null,function*(){let u=this.mapService.getSource(this.id());return this.zone.run(()=>m(this,null,function*(){return new Promise((c,d)=>{u.getClusterLeaves(e,t,a,(L,ee)=>{L?d(L):c(ee||[])})})}))})}_addFeature(e){this.data().features.push(e),this.updateFeatureData.next(null)}_removeFeature(e){let t=this.data(),a=t.features.indexOf(e);a>-1&&t.features.splice(a,1),this.updateFeatureData.next(null)}_getNewFeatureId(){return++this.featureIdCounter}init(){let e={type:"geojson",data:this.data(),minzoom:this.minzoom(),maxzoom:this.maxzoom(),attribution:this.attribution(),buffer:this.buffer(),tolerance:this.tolerance(),cluster:this.cluster(),clusterRadius:this.clusterRadius(),clusterMaxZoom:this.clusterMaxZoom(),clusterMinPoints:this.clusterMinPoints(),clusterProperties:this.clusterProperties(),lineMetrics:this.lineMetrics(),generateId:this.generateId(),promoteId:this.promoteId(),filter:this.filter(),dynamic:this.dynamic()};this.mapService.addSource(this.id(),e);let t=this.updateFeatureData.pipe(E(0)).subscribe(()=>{let a=this.mapService.getSource(this.id());a!==void 0&&a.setData(this.data())});this.sub.add(t),this.sourceAdded=!0}static \u0275fac=function(t){return new(t||r)};static \u0275cmp=l({type:r,selectors:[["mgl-geojson-source"]],inputs:{id:[1,"id"],data:[1,"data"],minzoom:[1,"minzoom"],maxzoom:[1,"maxzoom"],attribution:[1,"attribution"],buffer:[1,"buffer"],tolerance:[1,"tolerance"],cluster:[1,"cluster"],clusterRadius:[1,"clusterRadius"],clusterMaxZoom:[1,"clusterMaxZoom"],clusterMinPoints:[1,"clusterMinPoints"],clusterProperties:[1,"clusterProperties"],lineMetrics:[1,"lineMetrics"],generateId:[1,"generateId"],promoteId:[1,"promoteId"],filter:[1,"filter"],dynamic:[1,"dynamic"]},outputs:{data:"dataChange"},features:[v],decls:0,vars:0,template:function(t,a){},encapsulation:2,changeDetection:0})}return r})();var X=(()=>{class r{mapService=n(g);id=i.required();source=i();type=i.required();metadata=i();sourceLayer=i();filter=i();layout=i();paint=i();before=i();minzoom=i();maxzoom=i();layerClick=new s;layerDblClick=new s;layerMouseDown=new s;layerMouseUp=new s;layerMouseEnter=new s;layerMouseLeave=new s;layerMouseMove=new s;layerMouseOver=new s;layerMouseOut=new s;layerContextMenu=new s;layerTouchStart=new s;layerTouchEnd=new s;layerTouchCancel=new s;layerAdded=!1;sub;ngOnInit(){this.sub=this.mapService.mapLoaded$.pipe(j(()=>h(this.mapService.mapInstance,"styledata").pipe(f(()=>!1),C(()=>!this.mapService.mapInstance.getLayer(this.id())),P(!0)))).subscribe(e=>this.init(e))}ngOnChanges(e){this.layerAdded&&(e.paint&&!e.paint.isFirstChange()&&this.mapService.setLayerAllPaintProperty(this.id(),e.paint.currentValue),e.layout&&!e.layout.isFirstChange()&&this.mapService.setLayerAllLayoutProperty(this.id(),e.layout.currentValue),e.filter&&!e.filter.isFirstChange()&&this.mapService.setLayerFilter(this.id(),e.filter.currentValue),e.before&&!e.before.isFirstChange()&&this.mapService.setLayerBefore(this.id(),e.before.currentValue),(e.minzoom&&!e.minzoom.isFirstChange()||e.maxzoom&&!e.maxzoom.isFirstChange())&&this.mapService.setLayerZoomRange(this.id(),this.minzoom(),this.maxzoom()))}ngOnDestroy(){this.layerAdded&&this.mapService.removeLayer(this.id()),this.sub&&this.sub.unsubscribe()}init(e){let t={layerOptions:{id:this.id(),type:this.type(),source:this.source(),metadata:this.metadata(),"source-layer":this.sourceLayer(),minzoom:this.minzoom(),maxzoom:this.maxzoom(),filter:this.filter(),layout:this.layout(),paint:this.paint()},layerEvents:{layerClick:this.layerClick,layerDblClick:this.layerDblClick,layerMouseDown:this.layerMouseDown,layerMouseUp:this.layerMouseUp,layerMouseEnter:this.layerMouseEnter,layerMouseLeave:this.layerMouseLeave,layerMouseMove:this.layerMouseMove,layerMouseOver:this.layerMouseOver,layerMouseOut:this.layerMouseOut,layerContextMenu:this.layerContextMenu,layerTouchStart:this.layerTouchStart,layerTouchEnd:this.layerTouchEnd,layerTouchCancel:this.layerTouchCancel}};this.mapService.addLayer(t,e,this.before()),this.layerAdded=!0}static \u0275fac=function(t){return new(t||r)};static \u0275cmp=l({type:r,selectors:[["mgl-layer"]],inputs:{id:[1,"id"],source:[1,"source"],type:[1,"type"],metadata:[1,"metadata"],sourceLayer:[1,"sourceLayer"],filter:[1,"filter"],layout:[1,"layout"],paint:[1,"paint"],before:[1,"before"],minzoom:[1,"minzoom"],maxzoom:[1,"maxzoom"]},outputs:{layerClick:"layerClick",layerDblClick:"layerDblClick",layerMouseDown:"layerMouseDown",layerMouseUp:"layerMouseUp",layerMouseEnter:"layerMouseEnter",layerMouseLeave:"layerMouseLeave",layerMouseMove:"layerMouseMove",layerMouseOver:"layerMouseOver",layerMouseOut:"layerMouseOut",layerContextMenu:"layerContextMenu",layerTouchStart:"layerTouchStart",layerTouchEnd:"layerTouchEnd",layerTouchCancel:"layerTouchCancel"},features:[v],decls:0,vars:0,template:function(t,a){},encapsulation:2})}return r})();var D=class r{firestore=n(q);trailsRef;trails;constructor(){this.trailsRef=B(this.firestore,"trails"),this.trails=G(this.trailsRef,{idField:"id"}).pipe(f(o=>o.map(e=>JSON.parse(e.geojson))))}static \u0275fac=function(e){return new(e||r)};static \u0275prov=R({token:r,factory:r.\u0275fac,providedIn:"root"})};var x=class{drawService;constructor(o){this.drawService=o}};var re=()=>({"line-color":"#000000","line-width":5}),oe=()=>({"line-join":"round","line-cap":"round"}),ae=()=>["get","display_color"],se=r=>({"line-color":r,"line-width":2}),I=class r extends x{layerId="test";featureCollection;trailService=n(D);constructor(o){super(o)}ngOnInit(){this.trailService.trails.subscribe(o=>{this.featureCollection={features:o,type:"FeatureCollection"}})}static \u0275fac=function(e){return new(e||r)(y(F))};static \u0275cmp=l({type:r,selectors:[["app-trail-layer"]],features:[M],decls:3,vars:11,consts:[["id","trails-source",3,"data"],["id","trails-outline","type","line",3,"source","paint","layout"],["id","trails-line","type","line",3,"source","paint"]],template:function(e,t){e&1&&S(0,"mgl-geojson-source",0)(1,"mgl-layer",1)(2,"mgl-layer",2),e&2&&(p("data",t.featureCollection),z(),p("source","trails-source")("paint",b(6,re))("layout",b(7,oe)),z(),p("source","trails-source")("paint",V(9,se,b(8,ae))))},dependencies:[Q,X],encapsulation:2})};var Y=class r extends K{style=this.styles.wildland;constructor(o,e){super(o,e)}static \u0275fac=function(e){return new(e||r)(y(F),y(_))};static \u0275cmp=l({type:r,selectors:[["app-wildland-scene"]],features:[J([H]),M],decls:2,vars:4,consts:[[1,"map-container",3,"mapCreate","zoom","center"]],template:function(e,t){e&1&&(Z(0,"mgl-map",0),W("mapCreate",function(u){return t.mapCreate(u)}),S(1,"app-trail-layer"),U()),e&2&&(k(t.style),p("zoom",t.zoom)("center",t.center))},dependencies:[$,I],styles:[".map-container[_ngcontent-%COMP%]{height:100vh;width:100%}"]})};export{Y as WildlandSceneComponent};
