import{a as De,b as Fe,d as Se,e as Ge,f as Ae}from"./chunk-LFUL76TI.js";import{a as Oe}from"./chunk-PHNAH3YN.js";import{a as we,b as Ne,d as Ce}from"./chunk-OGV5YNZA.js";import{a as xe,b as Ee}from"./chunk-ZM4MHDZX.js";import{i as Ie,j as R}from"./chunk-5UQ2PNNT.js";import"./chunk-H7J6NXZL.js";import"./chunk-Q7U5SZXR.js";import"./chunk-UZ6X2SIU.js";import"./chunk-KGY4BCEM.js";import"./chunk-322WAKKC.js";import{b as ve}from"./chunk-QGGZPZNN.js";import"./chunk-R22A3CI2.js";import"./chunk-EKHW2ZUO.js";import"./chunk-SNC52ZAM.js";import"./chunk-OLOYQ6KE.js";import"./chunk-MV4MLQFF.js";import"./chunk-CRE2KNHB.js";import"./chunk-3LFQVTDE.js";import"./chunk-OHURIINH.js";import{a as be}from"./chunk-26JWDTE3.js";import{a as ye}from"./chunk-PMIZEMLB.js";import"./chunk-YHYXMWMO.js";import"./chunk-5UAVTNPR.js";import"./chunk-C6XCYNTY.js";import"./chunk-CCSZEQ2U.js";import{a as _e}from"./chunk-IDSQ2YJ4.js";import"./chunk-6ZXO4WLE.js";import{a as fe}from"./chunk-ARY42TOJ.js";import"./chunk-O5NYCH42.js";import"./chunk-GWBB233S.js";import"./chunk-NYVW6BKJ.js";import"./chunk-CSSRRM4C.js";import"./chunk-RVXDLN3U.js";import"./chunk-2DH3L3DZ.js";import"./chunk-GPMOZK2F.js";import"./chunk-PFQXJNFG.js";import"./chunk-EB24NRSQ.js";import"./chunk-ZO3S2OWI.js";import"./chunk-6ZTUPVYX.js";import{a as me}from"./chunk-5DVGZXEZ.js";import"./chunk-2I3LIA7G.js";import"./chunk-FY4QM6AV.js";import"./chunk-WQKVID54.js";import"./chunk-DBCWR6HP.js";import"./chunk-4ZBUTOIE.js";import{c as ge}from"./chunk-NSUARQNU.js";import"./chunk-4Y7EKSO4.js";import"./chunk-KRX2B2DE.js";import"./chunk-BWSUZDSV.js";import"./chunk-MRKUOXYW.js";import{b as pe}from"./chunk-CL7L227X.js";import"./chunk-QXSQOLB3.js";import"./chunk-BKWQOCBC.js";import"./chunk-XACQ2RJ5.js";import"./chunk-LCFWGHLF.js";import{h as ce}from"./chunk-YTAJKLRN.js";import"./chunk-D6N4VI5S.js";import"./chunk-5YS73I3T.js";import"./chunk-3ZJ4NMBE.js";import"./chunk-HH3C3QEN.js";import"./chunk-4S7THJAS.js";import"./chunk-2XTO2IAR.js";import"./chunk-CQVHC5U2.js";import"./chunk-P7MVFIZJ.js";import"./chunk-FSW536RM.js";import"./chunk-VN5FPMRB.js";import"./chunk-N7DSOI7B.js";import"./chunk-F4HA2HQL.js";import"./chunk-DQZHSTUF.js";import"./chunk-CY62WWD7.js";import"./chunk-VDNRZCIE.js";import"./chunk-I2JD5OSI.js";import"./chunk-2MROBW6T.js";import"./chunk-QAHTJVUZ.js";import"./chunk-X4VZU4O3.js";import"./chunk-BWHHYBB5.js";import"./chunk-XWEUR6F7.js";import"./chunk-PSNQ2KG3.js";import"./chunk-2ZB26SH7.js";import"./chunk-ZVSQXQ5X.js";import"./chunk-2IWALBQY.js";import"./chunk-3HEFIJB6.js";import"./chunk-K6RQLPKJ.js";import"./chunk-7V6BRQYE.js";import"./chunk-PORMJXR6.js";import"./chunk-Y7XG5IWW.js";import"./chunk-LSV6EK6V.js";import"./chunk-X5NPIY3C.js";import"./chunk-5252J253.js";import"./chunk-7WCQBAQY.js";import"./chunk-VQSLKKYN.js";import"./chunk-JBAMJB5J.js";import"./chunk-VAOSSSLB.js";import"./chunk-AMISFAT3.js";import"./chunk-CUV3BSEW.js";import"./chunk-3ZJU5D2H.js";import"./chunk-2UHZH5L3.js";import"./chunk-DQINVX66.js";import"./chunk-CSFAHB4Y.js";import"./chunk-T5UBLAP4.js";import"./chunk-PTXLSCMJ.js";import"./chunk-DA3NC6W4.js";import"./chunk-6L543SC5.js";import"./chunk-FRN24G7D.js";import"./chunk-FGABE2LC.js";import"./chunk-CU7FHMWW.js";import"./chunk-CZMBPC27.js";import"./chunk-VANM5A4M.js";import"./chunk-VSD74FMI.js";import"./chunk-KALTBP5D.js";import"./chunk-O2J7LFYY.js";import"./chunk-BIU7ZFAB.js";import"./chunk-6FZTFPIH.js";import"./chunk-J5AEP4US.js";import{a as C}from"./chunk-YHRLMRSO.js";import"./chunk-KPT44MCK.js";import"./chunk-XKFJ6GWH.js";import"./chunk-SFANISLX.js";import"./chunk-UJ7KVQR6.js";import"./chunk-GSXOR3JU.js";import"./chunk-55OTJIMU.js";import"./chunk-EM2AEAFS.js";import"./chunk-YEPHAEAY.js";import"./chunk-TK4PPGQL.js";import"./chunk-ELCBU4NP.js";import"./chunk-GMZFCQJQ.js";import"./chunk-5WDH2LXO.js";import"./chunk-L7NOU4T2.js";import"./chunk-VGAXEXH3.js";import"./chunk-HMNTGQTR.js";import"./chunk-ZLIWNUFM.js";import"./chunk-GVSOJUIP.js";import"./chunk-GWSX6PRO.js";import"./chunk-G2JMPZCN.js";import"./chunk-IRQF7UTO.js";import"./chunk-3KOZOOEP.js";import"./chunk-OL54OOJH.js";import"./chunk-EG2DTURK.js";import"./chunk-NQ3CCFQA.js";import"./chunk-YVCKQBWT.js";import"./chunk-WOZSH7YY.js";import"./chunk-2PJRHNJW.js";import"./chunk-B2RVSTL3.js";import"./chunk-4XEE5PE3.js";import"./chunk-2CKJLDTO.js";import"./chunk-F6TN7E7K.js";import"./chunk-4LDVFWME.js";import"./chunk-HUUJBVXR.js";import"./chunk-7G56KLCZ.js";import"./chunk-L56OBJFS.js";import"./chunk-7HMNN4FJ.js";import"./chunk-UKAGN54W.js";import"./chunk-MLH7GHZI.js";import"./chunk-CTVZOIWY.js";import{a as oe}from"./chunk-ULOK73M2.js";import{b as de,j as le,l as M,p as he,q as ue}from"./chunk-XR2NZIN5.js";import"./chunk-7DIV5AMU.js";import"./chunk-UP67O2XH.js";import"./chunk-ILDJFHIB.js";import"./chunk-7KP7SKLW.js";import"./chunk-456M7HFK.js";import{a as ne}from"./chunk-342NGUMP.js";import{a as ae}from"./chunk-NIYDRLW4.js";import"./chunk-PHMJ7KPL.js";import"./chunk-ESSDCWGF.js";import"./chunk-WVKBXQWE.js";import"./chunk-42SGGFLN.js";import"./chunk-EDOVNTC7.js";import"./chunk-FSWSNKJD.js";import"./chunk-FGEB67EG.js";import"./chunk-YEXMIDOT.js";import"./chunk-T7PUQGWM.js";import"./chunk-GV3ZFCVD.js";import"./chunk-SOEEM7Z7.js";import"./chunk-MVDZB4AK.js";import"./chunk-44A27HB7.js";import"./chunk-47NSYSFY.js";import"./chunk-QXNVQZT7.js";import"./chunk-QSQIQSC6.js";import"./chunk-AYNBEMCC.js";import"./chunk-LNYBTIG7.js";import"./chunk-37H4LYIE.js";import"./chunk-VYZHOYXV.js";import"./chunk-ECA5I2I7.js";import"./chunk-XAHD7XBV.js";import"./chunk-S6VNWKM3.js";import{b as se}from"./chunk-Y7XRSFOZ.js";import{a as ie}from"./chunk-YQNUGDFH.js";import"./chunk-QCZ3ZIGQ.js";import"./chunk-NIRJWS2D.js";import"./chunk-H3ZWZZ2B.js";import"./chunk-7SDNM7YV.js";import"./chunk-4NUW747S.js";import"./chunk-T6WMVIUG.js";import"./chunk-3GP4YRLZ.js";import"./chunk-ONYJLWAD.js";import"./chunk-PHODKV66.js";import"./chunk-JPMGMA4B.js";import"./chunk-Z5EURZKA.js";import"./chunk-YZJDOXQC.js";import"./chunk-ZM24RY22.js";import"./chunk-PE276TWH.js";import"./chunk-BMZ3PE5Y.js";import"./chunk-EHG7JRYJ.js";import"./chunk-FNY6LFKI.js";import"./chunk-5ODXFRPI.js";import"./chunk-E5QCV5LT.js";import"./chunk-QS3EYJPF.js";import"./chunk-HJJZ2AXH.js";import"./chunk-TPNSUEHH.js";import"./chunk-SMVNQSZ4.js";import"./chunk-Z2QGLRDB.js";import"./chunk-7IDFDPA3.js";import"./chunk-VL2YL74P.js";import"./chunk-P2AJD2R2.js";import"./chunk-UMJIJLDA.js";import"./chunk-E5NFS3KN.js";import"./chunk-HQHD6BMN.js";import"./chunk-AIKKGGPG.js";import"./chunk-RDGG4TVD.js";import"./chunk-3IQFPOUU.js";import"./chunk-I4CY6X6S.js";import"./chunk-VQ4QGNRX.js";import{a as re}from"./chunk-J4JQLN5L.js";import"./chunk-4KXJ537H.js";import"./chunk-JIRULGDT.js";import"./chunk-QJGOWIJD.js";import"./chunk-YHWE4TIZ.js";import"./chunk-QML26MQC.js";import"./chunk-RNZY2XUD.js";import"./chunk-JXPUHKCT.js";import"./chunk-XR5FT7TQ.js";import"./chunk-4YTM754S.js";import"./chunk-LAX5536Z.js";import"./chunk-N3HRYLNW.js";import"./chunk-4DBMALZW.js";import"./chunk-CVWWHM2V.js";import"./chunk-6OQYVEQJ.js";import"./chunk-YOXOWGT6.js";import"./chunk-EFZOSMYP.js";import"./chunk-WI7F4ZKJ.js";import"./chunk-MJ7M24NH.js";import"./chunk-GJH4QFRX.js";import"./chunk-T63F7663.js";import"./chunk-O4V2VBSK.js";import"./chunk-5TKRKB5E.js";import"./chunk-XAGMDNNR.js";import"./chunk-OP2TLIUN.js";import"./chunk-T2THIR6K.js";import"./chunk-LORHDXEB.js";import"./chunk-BBBPJI4H.js";import"./chunk-45BTW5EG.js";import"./chunk-TPFBHGDM.js";import"./chunk-73NLRHJD.js";import"./chunk-PNFEUBDF.js";import"./chunk-6RCCEJDL.js";import"./chunk-PQ2TNDUX.js";import"./chunk-6X6MKRQ3.js";import"./chunk-FQFHMHYU.js";import"./chunk-SZMEI3WL.js";import"./chunk-KKVGD67U.js";import"./chunk-MYOJWRDU.js";import"./chunk-L7UKJKHG.js";import"./chunk-V2IENAEU.js";import"./chunk-QAGQFNF2.js";import"./chunk-SY7JS2VW.js";import"./chunk-WK57SDN6.js";import"./chunk-AG4V3ZUO.js";import"./chunk-YWLMJ26A.js";import"./chunk-QAWNU3UJ.js";import"./chunk-HRQT4R6X.js";import"./chunk-44BHLWQ4.js";import"./chunk-5BPM64SU.js";import"./chunk-PMVHHMQJ.js";import"./chunk-NAFOM5UA.js";import"./chunk-DO7UF2F2.js";import"./chunk-ZTR6OS44.js";import"./chunk-VRTKAD2J.js";import"./chunk-DBLKLHK2.js";import"./chunk-UTE3ASAZ.js";import"./chunk-2AFEAPEX.js";import"./chunk-GNGXUEWV.js";import"./chunk-QBI5NDCA.js";import"./chunk-NOHW2DKR.js";import"./chunk-HVJAAM3A.js";import"./chunk-ACPEJEHK.js";import"./chunk-I7B3LWNP.js";import"./chunk-YP2E5N4E.js";import"./chunk-QLMNLSCT.js";import"./chunk-P55G5ATK.js";import"./chunk-JT3K52KQ.js";import"./chunk-SPLEGG4R.js";import"./chunk-Y4TJDUGP.js";import"./chunk-6PAFOJ4W.js";import"./chunk-74SDGE57.js";import"./chunk-FRXWHX3T.js";import"./chunk-DTDQ5X42.js";import"./chunk-RX2HFR4X.js";import"./chunk-AZW7YPTQ.js";import"./chunk-NJLJX4X6.js";import"./chunk-DZHFTD24.js";import"./chunk-K57Z4J34.js";import"./chunk-VWG3KVOU.js";import"./chunk-JOEUVLAN.js";import"./chunk-JZQDGIDQ.js";import"./chunk-CZ6CGC7I.js";import"./chunk-7B6U3N62.js";import"./chunk-46WDO5LS.js";import"./chunk-G5EYK5KM.js";import"./chunk-YJKJQU3F.js";import"./chunk-OK4K3OQT.js";import"./chunk-BPWNCOXC.js";import"./chunk-VNS4CQ27.js";import"./chunk-AVMO6LCR.js";import"./chunk-TEGPMVWT.js";import"./chunk-CLQRQC3Y.js";import"./chunk-KSNU73LO.js";import"./chunk-FACEVGRE.js";import"./chunk-5XTCPT52.js";import"./chunk-JQAW4OB5.js";import"./chunk-F2BQ2GD6.js";import"./chunk-R3XLNYYB.js";import{b as P}from"./chunk-2HYVVLKS.js";import"./chunk-XRTA5GHC.js";import"./chunk-Y6XW36QP.js";import"./chunk-ZXKU6WBY.js";import{j as te}from"./chunk-36M5A2TS.js";import"./chunk-U2ZO6WN5.js";import"./chunk-BMYVPMAK.js";import"./chunk-6F25LG6O.js";import"./chunk-6KRFVLII.js";import"./chunk-ZRSDAYWS.js";import"./chunk-S7U4DSGB.js";import"./chunk-G27DRLGO.js";import"./chunk-ZGHRJMZW.js";import{d as X}from"./chunk-XLL67PCY.js";import"./chunk-MCO7DSFO.js";import"./chunk-IIROCMOY.js";import"./chunk-K3Z3MI77.js";import"./chunk-EDZQZA57.js";import"./chunk-V6AA2XHK.js";import"./chunk-25WBXAEY.js";import"./chunk-7QY3BMVN.js";import"./chunk-Y7GY5YIF.js";import"./chunk-LMGYHZE3.js";import{e as Y}from"./chunk-5LG2P6MT.js";import{a as G,b as K}from"./chunk-GJ2QRXGN.js";import"./chunk-6QXEFK4U.js";import"./chunk-5L2EJ5RT.js";import"./chunk-E2QKN2KY.js";import"./chunk-PDQQY7RQ.js";import"./chunk-RWCIDBNQ.js";import"./chunk-2NH7HOKA.js";import"./chunk-EM35R6FY.js";import"./chunk-HM5RIVQC.js";import"./chunk-HKJZ7WI6.js";import"./chunk-CXOFHVIF.js";import"./chunk-EO2H4LIH.js";import"./chunk-DJW5LMRG.js";import"./chunk-DMO5HQM3.js";import"./chunk-DEH76MSI.js";import"./chunk-ALWV3RJ2.js";import"./chunk-CKJDDSAD.js";import"./chunk-DQOFEB5P.js";import"./chunk-2ZFXOJDB.js";import"./chunk-QXXXCEV5.js";import{c as ee}from"./chunk-6B5XFA6F.js";import"./chunk-PUVSV35R.js";import"./chunk-FCWOKKZM.js";import"./chunk-TJ6P6NLD.js";import"./chunk-NX5B6XBR.js";import"./chunk-2JABY6DU.js";import"./chunk-MPRKSQLC.js";import"./chunk-57TARQ4F.js";import"./chunk-6RBQSBA2.js";import"./chunk-Z42K5ECK.js";import"./chunk-NVTU6MJO.js";import"./chunk-56M6LBCJ.js";import"./chunk-HZK6UIET.js";import"./chunk-T2RV3ABV.js";import"./chunk-CSNRCIB5.js";import"./chunk-6FW4T2SJ.js";import"./chunk-4ZVBFHBA.js";import"./chunk-3JGYBNJA.js";import"./chunk-DA3SDKGO.js";import{a as J}from"./chunk-ZOEPYNM4.js";import{k as A}from"./chunk-57VFBGF3.js";import"./chunk-GWBRHLNH.js";import"./chunk-BJH4F4SM.js";import"./chunk-Z3RBZHAK.js";import"./chunk-IO35PPBL.js";import"./chunk-F5AJITOA.js";import{c as $}from"./chunk-IHATPE6U.js";import"./chunk-PU4AK46X.js";import"./chunk-3CLJ5OX5.js";import"./chunk-E6C7G5SC.js";import"./chunk-73K3NWCV.js";import"./chunk-SP2CO3KX.js";import"./chunk-PTZYZULI.js";import"./chunk-NMLYCCKN.js";import"./chunk-FYZRIMPP.js";import"./chunk-ZC6EBRE4.js";import"./chunk-ZAZJB7CV.js";import"./chunk-KALOJIUA.js";import"./chunk-KMMTNF7G.js";import"./chunk-E7AX56GD.js";import"./chunk-IDVLLREH.js";import"./chunk-DWLSVYOY.js";import"./chunk-PQGCNP5H.js";import"./chunk-UASS7NJI.js";import"./chunk-WZRAC35O.js";import"./chunk-KUYAWYSS.js";import"./chunk-MIS6QMFE.js";import"./chunk-MDZTV2VL.js";import"./chunk-RNC4P66O.js";import"./chunk-7LHOQXZT.js";import"./chunk-BCREO4Q5.js";import"./chunk-U4QEPZJ3.js";import"./chunk-KJUZWSCL.js";import"./chunk-3WO6D7MU.js";import"./chunk-BUZ3SPLE.js";import"./chunk-D3CUKSGS.js";import"./chunk-QK56OQGR.js";import"./chunk-K75TK42V.js";import"./chunk-CELWVZPW.js";import"./chunk-VV5G7VY5.js";import"./chunk-OLOKUDVI.js";import"./chunk-DYTVXYAV.js";import"./chunk-ZTOZWLEE.js";import"./chunk-RJWOVI3M.js";import"./chunk-RSDQHAJX.js";import{a as W,i as Z}from"./chunk-BOVYXYHK.js";import"./chunk-KVM6SHDX.js";import"./chunk-WATIOYLF.js";import"./chunk-POX73EYJ.js";import"./chunk-NKUXRYJG.js";import"./chunk-33RXTDEX.js";import"./chunk-P33JWG3G.js";import"./chunk-HX2VGIR2.js";import"./chunk-ERDKAICI.js";import"./chunk-EQZWYK27.js";import"./chunk-JLPLCY2B.js";import"./chunk-DKGGDYJI.js";import"./chunk-5LA3PVK5.js";import"./chunk-IR6XCBC4.js";import"./chunk-C6JPAW54.js";import"./chunk-WD3OPXCN.js";import"./chunk-FA3WGIU4.js";import"./chunk-WWVPA6PE.js";import{c as z,d as B}from"./chunk-ZQIC5NFT.js";import"./chunk-VIEK2X23.js";import"./chunk-XKIFGPJO.js";import"./chunk-PEW2PLAN.js";import"./chunk-Q6Y4JG7Q.js";import"./chunk-7F5DJLJT.js";import"./chunk-CX5IFQZJ.js";import"./chunk-NJWTSROP.js";import"./chunk-D3R25AF2.js";import"./chunk-ARRCN5K3.js";import"./chunk-O3EGNJTY.js";import"./chunk-WGAOVKGR.js";import"./chunk-SLAWDKDA.js";import"./chunk-4N4D2YQX.js";import"./chunk-G4DZJMGT.js";import"./chunk-WTB3O6DJ.js";import"./chunk-7P44K2YD.js";import"./chunk-32OAXCA4.js";import"./chunk-UST6HCE7.js";import"./chunk-K5T5FD5C.js";import"./chunk-MVHHPJM7.js";import"./chunk-VDO6JJ3Y.js";import"./chunk-WFKZLI6F.js";import"./chunk-X2B63YVS.js";import"./chunk-BAEF3CT6.js";import"./chunk-AUAZP44J.js";import"./chunk-PVDFCTA4.js";import"./chunk-KNVXE32P.js";import"./chunk-76ATOSLU.js";import"./chunk-CCJU4DSH.js";import{a as U,j as N}from"./chunk-TG45K3WR.js";import"./chunk-RAI4DTMT.js";import"./chunk-ACP3S2CH.js";import"./chunk-HVAXZ2NA.js";import{a as k}from"./chunk-T7DXJKX7.js";import"./chunk-TYYVNQUR.js";import{a as c}from"./chunk-QGVBCWUY.js";import{B as S}from"./chunk-MYO4NP2N.js";import{e as g}from"./chunk-NFIPKH6V.js";import"./chunk-JPU2PQZC.js";import{l as T}from"./chunk-5QEXLALV.js";import{a as Q,b as q}from"./chunk-P6QFA5MM.js";import"./chunk-DGTD7Y73.js";import"./chunk-LI2SX4T6.js";import"./chunk-BWO7LS2H.js";import"./chunk-HEVQSRJ2.js";import"./chunk-OVHPPCBL.js";import"./chunk-SNFOAZZQ.js";import"./chunk-AML4XSEF.js";import{b as _}from"./chunk-4PTIEWMT.js";import"./chunk-TG2UTNEO.js";import"./chunk-YOFFGXOB.js";import{g as E}from"./chunk-XRGPJ3QY.js";import"./chunk-6MRUJ2UW.js";import"./chunk-2LI2GKBQ.js";import{o as j}from"./chunk-QBWJMFH5.js";import{f}from"./chunk-VTHXE323.js";var w=class extends oe{constructor(e){super("SceneLayerWorker","dracoDecompressPointCloudData",{dracoDecompressPointCloudData:r=>[r.geometryBuffer]},e,{hasInitialize:!0})}};var O=class extends k{constructor(e,r){super(),this._updateAndCompare=e,this._notifyUpdated=r,this._nodes=new Map,this._graphics=new Map,this._duplicates=new Map}clear(){if(this._graphics.size>0){let e=this.toArray();this._graphics.clear(),this.emit("change",{added:[],removed:e})}this._nodes.clear()}get length(){return this._graphics.size}get(e){return this._graphics.get(e)}getNode(e){return this._nodes.get(e)}hasNode(e){return this._nodes.has(e)}nodes(){return this._nodes.values()}addNode(e,r){this._nodes.set(e,r);let i=r.graphics;if(i.length===0)return;let s=new Set;for(let a=0;a<i.length;a++){let n=i[a],d=n.objectId,p=this._graphics.get(d);if(p){s.add(d),n!==p&&(i[a]=p);let h=this._duplicates.get(d);h?h.push(e):this._duplicates.set(d,[p.nodeIndex,e])}else n.nodeIndex=e,this._graphics.set(d,n)}s.size&&this._updateForeignGraphics(r);let o=s.size>0?i.filter(a=>!s.has(a.objectId)):i;o.length>0&&this.emit("change",{added:o,removed:[]})}removeNode(e){let r=this._nodes.get(e);if(!r)return;this._nodes.delete(e);let i=new Set,s=[];for(let o of r.graphics){let a=o.objectId,n=this._graphics.get(a);if(!n)continue;let d=this._duplicates.get(a);if(d){let p=d.indexOf(e);if(p===-1)continue;if(d.splice(p,1),n.nodeIndex===e){let h=this.getNode(d[0]);for(let l=1;l<d.length;l++){let b=this.getNode(d[l]);(h==null||b!=null&&b.node.level>h.node.level)&&(h=b)}h!=null&&i.add(h)}d.length===1&&this._duplicates.delete(a)}else this._graphics.delete(a),s.push(o)}s.length>0&&this.emit("change",{added:[],removed:s}),i.forEach(o=>this._updateForeignGraphics(o))}_updateForeignGraphics(e){let r=[],i=e.node.index,s=e.node.level,o=0;for(;o<e.graphics.length;){let a=e.graphics[o].nodeIndex;if(a===i){o++;continue}let n=1;for(;o+n<e.graphics.length&&e.graphics[o+n].nodeIndex===a;)n++;let d=this.getNode(a);if(d!=null&&d.node.level>s)o+=n;else{for(let p=o;p<o+n;p++){let h=e.graphics[p];h.nodeIndex=i,this._updateAndCompare(h,e,p)&&r.push(h)}o+=n}}r.length>0&&this._notifyUpdated(r)}toArray(){return Array.from(this._graphics.values())}find(e){return q(this._graphics,e)}some(e){return Q(this._graphics,e)}forEach(e){this._graphics.forEach(r=>e(r))}forEachNode(e){this._nodes.forEach((r,i)=>e(r,i))}get nodeCount(){return this._nodes.size}_checkInvariants(){let e=new Map;this._nodes.forEach((r,i)=>{r.graphics.forEach(s=>{e.set(s.objectId,1+(e.get(s.objectId)??0)),this._duplicates.get(s.objectId)})}),e.forEach((r,i)=>{let s=this._graphics.get(i);if(!s||!this._nodes.get(s.nodeIndex))return;let o=this._duplicates.get(i);o&&o.forEach(a=>{this._nodes.get(a)})})}};var Pe=Ge(),H=class{constructor(e,r,i,s){this.graphics=e,this.featureIds=r,this.attributeInfo=i,this.node=s}get cachedMemory(){return this.graphics.reduce((e,r)=>te(r)+e,Y(this.featureIds)+1024)}},u=class extends Ee(xe(Oe(ye(fe)))){constructor(){super(...arguments),this.type="scene-layer-graphics-3d",this._queryEngine=null,this._memCache=null,this._interactiveEditingSessions=new Map,this._pendingEditsQueue=Promise.resolve(),this.loadedGraphics=new O((t,e,r)=>Ve(t,e,r),t=>this.processor.graphicsCore.recreateGraphics(t)),this.holeFilling="always",this.progressiveLoadFactor=1,this.supportsHeightUnitConversion=!0,this._coordinatesOutsideExtentErrors=0,this._maxCoordinatesOutsideExtentErrors=20}tryRecycleWith(t,e){return t.url===this.layer.url&&this._i3sOverrides.isEmpty?t.load(e).then(()=>{he(this.layer,t,this._i3sOverrides),this.layer=t,this._i3sOverrides.destroy();let r=this.view.resourceController?.memoryController;this._i3sOverrides=new R({view:this.view,layer:t,memoryController:r}),_(this._queryEngine),this._setupQueryEngine(),this.processor.resetObjectStates()}):null}initialize(){this.addResolvingPromise(this.layer.indexInfo);let t=this.view.resourceController?.memoryController;this._i3sOverrides=new R({view:this.view,layer:this.layer,memoryController:t}),ue(this.layer,this.view.spatialReference,this.view.viewingMode),this._fieldsHelper=new Ae({layerView:this}),this._updatingHandles.add(()=>this.layer.rangeInfos,e=>this._rangeInfosChanged(e),N),this._updatingHandles.add(()=>this.layer.renderer,(e,r)=>this._rendererChange(e,r)),this._updatingHandles.add(()=>[this.parsedDefinitionExpression,this._excludeObjectIdsSorted],()=>this._filterChange()),this.addHandles(U(()=>C.I3S_TREE_SHOW_TILES,e=>{if(e&&!this._treeDebugger){let r=this._controller.crsIndex;import("./chunk-FIAGIQCM.js").then(({I3STreeDebugger:i})=>{!this._treeDebugger&&C.I3S_TREE_SHOW_TILES&&(this._treeDebugger=new i({lv:this,view:this.view,nodeSR:r}))})}else e||!this._treeDebugger||C.I3S_TREE_SHOW_TILES||(this._treeDebugger.destroy(),this._treeDebugger=null)},N)),this._set("processor",new Ce({owner:this,preferredUpdatePolicy:me.ASYNC,scaleVisibilityEnabled:!0,filterVisibilityEnabled:!0,timeExtentEnabled:!1,frustumVisibilityEnabled:!1,elevationAlignmentEnabled:!0,elevationFeatureExpressionEnabled:!1,setUidToIdOnAdd:!1,dataExtent:this.layer.fullExtent,updateClippingExtent:e=>this._updateClippingExtent(e)})),this.processor.elevationAlignment?.events.on("invalidate-elevation",({extent:e,spatialReference:r})=>this._controller.updateElevationChanged(e,r)),this.supportsHeightUnitConversion&&(this._verticalScale=J("point",this.layer.spatialReference,this.view.spatialReference)),this.addResolvingPromise(this.processor.when()),this._memCache=this.view.resourceController.memoryController.newCache(`psl-${this.uid}`),this._controller=new Ie({layerView:this}),de(this.layer.geometryDefinitions)&&(this._worker=new w(e=>this.view.resourceController.immediate.schedule(e))),this.addHandles(this.layer.on("apply-edits",e=>this._updatingHandles.addPromise(e.result))),this.addHandles(this.layer.on("edits",e=>{let r=this._pendingEditsQueue.then(()=>this._handleEdits(e)).then();this._pendingEditsQueue=r,this._updatingHandles.addPromise(r)})),this.when(()=>{this._setupQueryEngine(),this._updatingHandles.add(()=>this.maximumNumberOfFeatures,e=>this._controller.featureTarget=e,N),this._updatingHandles.add(()=>this.suspended,e=>{e&&this._removeAllNodeData()})})}destroy(){this._treeDebugger=_(this._treeDebugger),this._i3sOverrides=_(this._i3sOverrides),this._set("processor",_(this.processor)),this._controller=_(this._controller),this._queryEngine=_(this._queryEngine),this._worker=_(this._worker),this._memCache=_(this._memCache),this.loadedGraphics.clear(),this._fieldsHelper=_(this._fieldsHelper)}get i3slayer(){return this.layer}get updatingProgressValue(){return this._controller?.updatingProgress??1}get requiredFields(){return this._fieldsHelper?.requiredFields??[]}get maximumNumberOfFeatures(){return this.processor?.graphicsCore?.displayFeatureLimit?.maximumNumberOfFeatures??0}set maximumNumberOfFeatures(t){t!=null?(this._override("maximumNumberOfFeatures",t),this._controller.fixedFeatureTarget=!0):(this._clearOverride("maximumNumberOfFeatures"),this._controller.fixedFeatureTarget=!1)}get maximumNumberOfFeaturesExceeded(){return!this.suspended&&!!this._controller?.useMaximumNumberOfFeatures&&!this._controller.leavesReached}get _excludeObjectIdsSorted(){let t=this.layer.excludeObjectIds;return t.length?t.toArray().sort((e,r)=>e-r):null}get lodFactor(){return this.layer.semantic==="Labels"?1:this.view.qualitySettings.sceneService.point.lodFactor}get hasM(){return!1}get hasZ(){return!0}get contentVisible(){return!this.suspended&&!!this._controller?.rootNodeVisible}get legendEnabled(){return this.contentVisible&&this.i3slayer?.legendEnabled===!0}whenGraphicAttributes(t,e){return f(this,null,function*(){return le(this.layer,t,this._getObjectIdField(),e,()=>[...this.loadedGraphics.nodes()])})}getHit(t){if(!this.loadedGraphics)return null;let e=pe(this.loadedGraphics.find(i=>i.uid===t),this.layer),r=this._getObjectIdField();return e?.attributes?.[r]?(e.layer=this.layer,e.sourceLayer=this.layer,{type:"graphic",graphic:e,layer:e.layer}):null}whenGraphicBounds(t,e){return this.processor.whenGraphicBounds(t,e)}computeAttachmentOrigin(t,e){return this.processor.computeAttachmentOrigin(t,e)}isUpdating(){return!!(this._controller?.updating||this.processor?.updating||this._fieldsHelper?.updating||this.layerFilterUpdating)}highlight(t,e){return this.processor.highlight(t,this.layer.objectIdField,e?.name??ce)}get updatePolicy(){return this.processor.graphicsCore.effectiveUpdatePolicy}createInteractiveEditSession(t){return De(this._attributeEditingContext,t)}_decompressBinaryPointData(t,e){return f(this,null,function*(){let r={geometryBuffer:t.geometryBuffer};this._worker==null&&(this._worker=new w(s=>this.view.resourceController.immediate.schedule(s)));let i=yield this._worker.invoke(r,e);if(i==null)throw new Error("Failed to decompress Draco point data");return{positionData:i.positions,featureIds:i.featureIds}})}addNode(t,e,r){return f(this,null,function*(){if(!V(e)&&!Re(e))throw new Error;if(this.loadedGraphics.hasNode(t.index))return void E.getLogger(this).error("I3S node "+t.id+" already added");let i=this.layer.fullExtent!=null?Le(this.layer.fullExtent.clone(),.5):null,{featureIds:s,pointPositions:o}=V(e)?yield this._extractBinaryPointPositions(t,e,r):this._extractLegacyPointPositions(e),a=new Array;this._validatePositions(t,s,o,i,a);let n=this._controller.crsVertex,d=this.view.spatialReference;A(o,n,0,o,d,0,s.length);let p=V(e)?t.level:0,h=this._createGraphics(s,o,t.index,p),l=new H(h,s,e.attributeDataInfo,t);if(yield this._i3sOverrides.applyAttributeOverrides(l.featureIds,e.attributeDataInfo,r),t.numFeatures=l.graphics.length,this._updateNodeMemory(t),L(l),a.length>0&&(this._computeObb(t,a,n),this._controller.updateVisibility(t.index)),!this._controller.isGeometryVisible(t))return void this._cacheNodeData(l);if(this._verticalScale!=null)for(let x of l.graphics)this._verticalScale(x.geometry);let b=this.view._stage.renderView.olidRenderHelper;if(b){let x=$(this.view.map,this.layer.uid);for(let m=0;m<l.featureIds.length;m++){let D=l.featureIds[m];b.setUidToObjectAndLayerId(D,l.graphics[m].uid,this.layer.id,this.layer.uid,this.layer.popupEnabled&&!x&&ge(this.layer,this.view.popup?.defaultPopupTemplateEnabled),l.node.resources.attributes,m)}}this.loadedGraphics.addNode(t.index,l),this._controller.updateLoadStatus(t.index,!0),this._filterNode(l),this._treeDebugger&&this._treeDebugger.update()})}_computeObb(t,e,r){let i=this._controller.crsIndex,s=i.isGeographic?this.view.renderSpatialReference:i;A(e,r,0,e,s,0),t.serviceObbInIndexSR=se(new ie(e,3)),i.isGeographic&&(ne(t.serviceObbInIndexSR.center,s,I,i),t.serviceObbInIndexSR.center=I)}isNodeLoaded(t){return this.loadedGraphics.hasNode(t)}isNodeReloading(){return!1}updateNodeState(){}_extractBinaryPointPositions(t,e,r){return f(this,null,function*(){let i=yield this._decompressBinaryPointData(e,r),s=i.positionData,o=3,a=s.length/o,n=G(3*a),d=t.serviceObbInIndexSR!=null?t.serviceObbInIndexSR.center:Z,p=Math.abs(d[2])*2**-20;for(let h=0;h<a;h++){let l=h*o;n[l]=s[l]+d[0],n[l+1]=s[l+1]+d[1],n[l+2]=s[l+2]+d[2],Math.abs(n[l+2])<p&&(n[l+2]=0)}return{featureIds:i.featureIds?K(i.featureIds):[],pointPositions:n}})}_extractLegacyPointPositions(t){let e=t.pointData.length,r=G(3*e),i=new Array;for(let s=0;s<e;s++){let o=t.pointData[s],a=o.featureDataPosition,n=a.length,d=o.geometries?.[0]??He[n],p=o.featureIds[0];if(d.type!=="Embedded"||d.params.type!=="points"||n<2||n>3)continue;let h=d.params.vertexAttributes?.position??[0,0,0],l=3*i.length;r[l]=a[0]+h[0],r[l+1]=a[1]+h[1],r[l+2]=n===3?a[2]+h[2]:NaN,i.push(p)}return{featureIds:i,pointPositions:r}}_validatePositions(t,e,r,i,s){if(i==null&&t.serviceObbInIndexSR)return;let o=e.length,a=3;for(let n=0;n<o;n++){let d=n*a;ee(I,r[d],r[d+1],r[d+2]);let p=!Number.isNaN(r[2]);i==null||(p?B(i,I):z(i,I))||(this._coordinatesOutsideExtentErrors<this._maxCoordinatesOutsideExtentErrors&&E.getLogger(this).error("Service Error: Coordinates outside of layer extent"),this._coordinatesOutsideExtentErrors+1===this._maxCoordinatesOutsideExtentErrors&&E.getLogger(this).error("Maximum number of errors reached. Further errors are ignored."),this._coordinatesOutsideExtentErrors++),t.serviceObbInIndexSR||s.push(I[0],I[1],I[2])}}_createGraphics(t,e,r,i){let s=t.length,o=3,a=this._getObjectIdField(),n=this.processor.graphicsCore,d=new Array,p=this.view.spatialReference;for(let h=0;h<s;h++){let l=t[h],b={};l!=null&&(b[a]=l);let x=l??S(),m=h*o,D=isNaN(e[m+2])?void 0:e[m+2],F=ae(e[m],e[m+1],D,p),v=this.loadedGraphics.get(x);if(v!=null)(v.level==null||v.level<i)&&(y.property="geometry",y.graphic=v,y.oldValue=v.geometry,y.newValue=F,v.geometry=F,v.level=i,n.graphicUpdateHandler(y)),d.push(v);else{let Me=S();d.push({objectId:x,uid:Me,geometry:F,attributes:b,visible:!0,nodeIndex:r,level:i})}}return d}_updateNodeMemory(t){t.memory=4096+(t.numFeatures!=null?t.numFeatures*this.processor.graphicsCore.usedMemoryPerGraphic:0)}_cacheNodeData(t){this._memCache.put(this._getMemCacheKey(t.node),t)}_getMemCacheKey(t){return`${t.index}`}_removeAllNodeData(){this.loadedGraphics.forEachNode((t,e)=>{if(t){let r=t.node;this._updateNodeMemory(r),this._cacheNodeData(t)}this._controller.updateLoadStatus(e,!1)}),this._treeDebugger&&this._treeDebugger.update(),this.loadedGraphics.clear()}removeNode(t){let e=this._removeNodeStageData(t);e&&(this._updateNodeMemory(e.node),this._cacheNodeData(e))}_removeNodeStageData(t){let e=this.loadedGraphics.getNode(t);return e==null?null:(this._controller.updateLoadStatus(t,!1),this.loadedGraphics.removeNode(t),this._treeDebugger&&this._treeDebugger.update(),e)}loadCachedNodeData(t){return f(this,null,function*(){return this._memCache?.pop(this._getMemCacheKey(t))})}addCachedNodeData(t,e,r,i){return f(this,null,function*(){this.loadedGraphics.hasNode(t.index)?E.getLogger(this).error("I3S node "+t.id+" already added"):(yield this._i3sOverrides.applyAttributeOverrides(e.featureIds,r,i),e.attributeInfo=r,this.loadedGraphics.addNode(t.index,e),this._controller.updateLoadStatus(t.index,!0),this._updateNodeMemory(t),L(e),this._filterNode(e),this._treeDebugger&&this._treeDebugger.update())})}getLoadedNodeIds(){let t=[];return this.loadedGraphics.forEachNode(e=>t.push(e.node.id)),t.sort()}getVisibleNodes(){let t=new Array;return this.loadedGraphics.forEachNode(e=>t.push(e.node)),t}getLoadedNodeIndices(t){this.loadedGraphics.forEachNode((e,r)=>t.push(r))}getLoadedAttributes(t){let e=this.loadedGraphics.getNode(t);if(e?.attributeInfo!=null)return e.attributeInfo.loadedAttributes}getAttributeData(t){let e=this.loadedGraphics.getNode(t);if(e?.attributeInfo!=null)return e.attributeInfo.attributeData}_setAttributeData(t,e){let r=this.loadedGraphics.getNode(t);r?.attributeInfo!=null&&(r.attributeInfo.attributeData=e,this._attributeValuesChanged(r))}updateAttributes(t,e,r){return f(this,null,function*(){let i=this.loadedGraphics.getNode(t);i!=null&&(yield this._i3sOverrides.applyAttributeOverrides(i.featureIds,e,r),i.attributeInfo=e,this._attributeValuesChanged(i))})}_attributeValuesChanged(t){L(t),this._filterNode(t);let{processor:e}=this,{graphicsCore:r}=e;if(r.labelsEnabled){let i=t.node.index,s=new Array;t.graphics.forEach(o=>o.nodeIndex===i&&s.push(o.uid)),r.updateLabelingInfo(s)}e.refreshFilter()}_updateClippingExtent(t){return this._controller&&this._controller.updateClippingArea(t),!1}_getObjectIdField(){return this.layer.objectIdField||_e}_getGlobalIdField(){return this.layer.associatedLayer?.globalIdField}_rendererChange(t,e){return f(this,null,function*(){let{layer:{fieldsIndex:r}}=this,i=new Set,s,o;t?(yield t.collectRequiredFields(i,r),s=Array.from(i).sort()):s=[],i.clear(),e?(yield e.collectRequiredFields(i,r),o=Array.from(i).sort()):o=[],s.length===o.length&&s.every((a,n)=>s[n]===o[n])||this._reloadAllNodes()})}_rangeInfosChanged(t){t!=null&&t.length>0&&E.getLogger(this).warn("Unsupported property: rangeInfos are currently only serialized to and from web scenes but do not affect rendering.")}_filterChange(){this.loadedGraphics.forEachNode(t=>this._filterNode(t))}_reloadAllNodes(){this._removeAllNodeData(),this._controller&&this._controller.restartNodeLoading()}_filterNode(t){let e=this.parsedDefinitionExpression,r=this._excludeObjectIdsSorted,i=this._getObjectIdField();for(let s of t.graphics){let o=s.visible,a=!e||this._evaluateClause(e,s),n=r==null||j(r,s.attributes[i])<0;s.visible=a&&n,o!==s.visible&&(y.graphic=s,y.property="visible",y.oldValue=o,y.newValue=s.visible,this.processor.graphicsCore.graphicUpdateHandler(y))}}createQuery(){let t={outFields:["*"],returnGeometry:!0,outSpatialReference:this.view.spatialReference};return this.filter!=null?this.filter.createQuery(t):new P(t)}queryFeatures(t,e){return this._queryEngine.executeQuery(this._ensureQuery(t),e?.signal)}queryObjectIds(t,e){return this._queryEngine.executeQueryForIds(this._ensureQuery(t),e?.signal)}queryFeatureCount(t,e){return this._queryEngine.executeQueryForCount(this._ensureQuery(t),e?.signal)}queryExtent(t,e){return this._queryEngine.executeQueryForExtent(this._ensureQuery(t),e?.signal)}_ensureQuery(t){return this._addDefinitionExpressionToQuery(t==null?this.createQuery():P.from(t))}_setupQueryEngine(){let{layer:t,view:e,hasM:r,hasZ:i}=this,{spatialReference:s,resourceController:o}=e,a=new Ne(s,t,o,()=>this.processor.featureStore,i,r);this._queryEngine=new we({context:a,priority:X.FEATURE_QUERY_ENGINE})}get usedMemory(){return this.processor?.graphicsCore?.usedMemory??0}get unloadedMemory(){return .8*((this._controller?.unloadedMemoryEstimate??0)+(this.processor?.graphicsCore?.unprocessedMemoryEstimate??0))}get ignoresMemoryFactor(){return this._controller&&this._controller.fixedFeatureTarget}_handleEdits(t){return f(this,null,function*(){let e=this._attributeEditingContext,r=yield Fe(e,t);Se(e,r)})}get _attributeEditingContext(){let t=this._getObjectIdField(),e=this._getGlobalIdField();return{sessions:this._interactiveEditingSessions,fieldsIndex:this.layer.fieldsIndex,objectIdField:t,globalIdField:e,forEachNode:r=>this.loadedGraphics.forEachNode(i=>r(i.node,i.featureIds)),attributeStorageInfo:this.i3slayer.attributeStorageInfo??[],i3sOverrides:this._i3sOverrides,getAttributeData:r=>this.getAttributeData(r),setAttributeData:(r,i,s)=>{this._setAttributeData(r,i);let o=this.loadedGraphics.getNode(r);if(s!=null){let a=this.loadedGraphics.get(s.attributes[t]);a!=null&&this.processor.graphicsCore.recreateGraphics([a])}else o!=null&&this.processor.graphicsCore.recreateGraphics(o.graphics)},clearMemCache:()=>{}}}get performanceInfo(){return new be(this.usedMemory,this.loadedGraphics.length,-1,this.maximumNumberOfFeatures,this.loadedGraphics.nodeCount,this.processor.graphicsCore.performanceInfo)}get test(){}};c([g()],u.prototype,"processor",void 0),c([g({type:re})],u.prototype,"filter",void 0),c([g()],u.prototype,"loadedGraphics",void 0),c([g()],u.prototype,"i3slayer",null),c([g()],u.prototype,"_controller",void 0),c([g()],u.prototype,"updating",void 0),c([g()],u.prototype,"suspended",void 0),c([g()],u.prototype,"holeFilling",void 0),c([g(ve)],u.prototype,"updatingProgress",void 0),c([g()],u.prototype,"updatingProgressValue",null),c([g(Pe.requiredFields)],u.prototype,"requiredFields",null),c([g(Pe.availableFields)],u.prototype,"availableFields",void 0),c([g()],u.prototype,"_fieldsHelper",void 0),c([g({type:Number})],u.prototype,"maximumNumberOfFeatures",null),c([g({readOnly:!0})],u.prototype,"maximumNumberOfFeaturesExceeded",null),c([g()],u.prototype,"_excludeObjectIdsSorted",null),c([g({readOnly:!0})],u.prototype,"lodFactor",null),c([g({readOnly:!0})],u.prototype,"hasM",null),c([g({readOnly:!0})],u.prototype,"hasZ",null),c([g()],u.prototype,"contentVisible",null),c([g({readOnly:!0})],u.prototype,"legendEnabled",null),u=c([T("esri.views.3d.layers.SceneLayerGraphicsView3D")],u);var Qt=u;function Re(t){return"pointData"in t}function V(t){return"geometryBuffer"in t&&t.geometryBuffer!==null}function Ve(t,e,r){let i=e.attributeInfo;if(i?.loadedAttributes==null||i.attributeData==null)return!1;let s=!1;for(let{name:o}of i.loadedAttributes)if(i.attributeData[o]){let a=M(i.attributeData[o],r);a!==t.attributes[o]&&(t.attributes[o]=a,s=!0)}return s}function L(t){let e=t.attributeInfo,r=t.node.index;if(e?.loadedAttributes!=null&&e.attributeData!=null)for(let i=0;i<t.graphics.length;i++){let s=t.graphics[i];if(s.nodeIndex===r){s.attributes||(s.attributes={});for(let{name:o}of e.loadedAttributes)e.attributeData[o]&&(s.attributes[o]=M(e.attributeData[o],i))}}}function Le(t,e){return t.xmin-=e,t.ymin-=e,t.xmax+=e,t.ymax+=e,t.zmin!=null&&t.zmax!=null&&(t.zmin-=e,t.zmax+=e),t.mmin!=null&&t.mmax!=null&&(t.mmin-=e,t.mmax+=e),t}var He={2:{type:"Embedded",params:{type:"points",vertexAttributes:{position:[0,0]}}},3:{type:"Embedded",params:{type:"points",vertexAttributes:{position:[0,0,0]}}}},I=W(),y={graphic:null,property:null,oldValue:null,newValue:null};export{Qt as default};
