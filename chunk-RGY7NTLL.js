import{b as T,c as U,d as H}from"./chunk-GY62SD4Z.js";import{b as R}from"./chunk-IAG3AFVL.js";import{b as O}from"./chunk-EQZWYK27.js";import{a as _}from"./chunk-CX5IFQZJ.js";import{o as V}from"./chunk-AUAZP44J.js";import{e as b}from"./chunk-PVDFCTA4.js";import{C as P,D as m,E as w,o as p,q as g,x as f}from"./chunk-76ATOSLU.js";import{e as c}from"./chunk-TG45K3WR.js";import{a as o}from"./chunk-QGVBCWUY.js";import{e as i}from"./chunk-NFIPKH6V.js";import{l as v}from"./chunk-5QEXLALV.js";import{m as y}from"./chunk-4PTIEWMT.js";import{b as l}from"./chunk-YOFFGXOB.js";import{g as h}from"./chunk-XRGPJ3QY.js";import{f as d}from"./chunk-VTHXE323.js";var x,t=class extends H{constructor(e){super(e),this.autoplay=!0,this.content=null,this.controller=null,this.type="video",this[x]=!0}load(){let e=this.video;return typeof e=="string"?this.addResolvingPromise(Promise.all([this._preProcessVideoUrl(e),import("./chunk-AB4X2O6B.js")]).then(r=>d(this,[r],function*([s,{default:n}]){this.controller=new n,this.controller.playerUrl=s,yield c(()=>this.controller?.element),this.controller.loop=!0,this.controller.muted=!0,this.controller.playsInline=!0,this.controller.crossOrigin="anonymous",yield c(()=>this.controller?.state==="can-play"),yield this.controller.play(),this.autoplay||this.controller.pause(),this._set("content",this.controller.element)}))):e instanceof HTMLVideoElement?this.addResolvingPromise(this._loadVideo(e).then(()=>{this._set("content",e)})):this.addResolvingPromise(Promise.reject(new l("video-element:invalid-video-type","Invalid video type",{video:e}))),Promise.resolve(this)}get contentWidth(){return this.content?.videoWidth??0}get contentHeight(){return this.content?.videoHeight??0}get currentTime(){return this.controller?.currentTime}set currentTime(e){if(!this.controller)return;let s=O(e,0,this.controller.duration);this.controller?.setCurrentTime(s)}get duration(){return this.controller?.duration}set video(e){this.loadStatus==="not-loaded"?this._set("video",e):h.getLogger(this).error("#video","video cannot be changed after the element is loaded.")}writeVideo(e,s,n,r){if(!e)return void(r?.messages&&r.messages.push(new l("video-element:unsupported-video","video source is missing")));let a=E(e)?e:null;if(!a)return void(r?.messages&&r.messages.push(new l("video-element:unsupported-video","video source must be an absolute url")));!P(a)&&r?.blockedRelativeUrls&&r.blockedRelativeUrls.push(a);let u=f(a);b(u)?r?.messages&&r.messages.push(new l("video-element:unsupported-video","video source cannot be an item resource")):s[n]=u}_preProcessVideoUrl(e){return d(this,null,function*(){if(g(e))return p(e);try{return yield V(e,{method:"head"}),e}catch{return p(e,!0)}})}_loadVideo(e){return new Promise((s,n)=>{let r=y(e,"canplay",()=>{this.removeHandles("canplay"),this.autoplay?e.play().then(s,n):s()});this.addHandles(r,"canplay"),e.crossOrigin!=="anonymous"&&(e.crossOrigin="anonymous",m(e.src)||(e.src=e.src))})}};x=R,o([i()],t.prototype,"autoplay",void 0),o([i({readOnly:!0})],t.prototype,"content",void 0),o([i({readOnly:!0})],t.prototype,"contentWidth",null),o([i({readOnly:!0})],t.prototype,"contentHeight",null),o([i()],t.prototype,"controller",void 0),o([i({type:Number})],t.prototype,"currentTime",null),o([i({type:Number})],t.prototype,"duration",null),o([i(T)],t.prototype,"video",null),o([_("video")],t.prototype,"writeVideo",null),o([i(U)],t.prototype,"type",void 0),t=o([v("esri.layers.support.VideoElement")],t);var K=t;function E(e){return typeof e=="string"&&!w(e)&&!m(e)}export{K as a};
