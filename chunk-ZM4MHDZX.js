import{a as D}from"./chunk-6ZXO4WLE.js";import{d as x,i as g,l as y}from"./chunk-XR2NZIN5.js";import{a as h}from"./chunk-J4JQLN5L.js";import{h as E}from"./chunk-ZGHRJMZW.js";import{e as c}from"./chunk-33RXTDEX.js";import{a as n}from"./chunk-QGVBCWUY.js";import{e as l}from"./chunk-NFIPKH6V.js";import{l as f}from"./chunk-5QEXLALV.js";import{g as o}from"./chunk-XRGPJ3QY.js";var V=s=>{let t=class extends s{constructor(){super(...arguments),this._definitionExpressionErrors=0,this._maxDefinitionExpressionErrors=20,this.logError=e=>{this._definitionExpressionErrors<this._maxDefinitionExpressionErrors&&o.getLogger(this).error("Error while evaluating definitionExpression: "+e),this._definitionExpressionErrors++,this._definitionExpressionErrors===this._maxDefinitionExpressionErrors&&o.getLogger(this).error("Further errors are ignored")}}get parsedDefinitionExpression(){if(!this.i3slayer?.definitionExpression)return null;try{let e=c.create(this.i3slayer.definitionExpression,{fieldsIndex:this.i3slayer.fieldsIndex});if(!e.isStandardized)return o.getLogger(this).error("definitionExpression is using non standard function"),null;let i=[],r=e.fieldNames;return g(r,this.i3slayer.fields,{missingFields:i}),i.length>0?(o.getLogger(this).error(`definitionExpression references unknown fields: ${i.join(", ")}`),null):(this._definitionExpressionErrors=0,e)}catch(e){return o.getLogger(this).error("Failed to parse definitionExpression: "+e),null}}get definitionExpressionFields(){return this.parsedDefinitionExpression?this.parsedDefinitionExpression.fieldNames:[]}_evaluateClause(e,i){try{return e.testFeature(i)}catch(r){return this.logError(r),!1}}_addDefinitionExpressionToQuery(e){if(!this.parsedDefinitionExpression)return e;let i=this.i3slayer.definitionExpression,r=e.clone();return r.where?r.where=`(${i}) AND (${r.where})`:r.where=i,r}};return n([l({readOnly:!0})],t.prototype,"parsedDefinitionExpression",null),n([l({readOnly:!0})],t.prototype,"definitionExpressionFields",null),t=n([f("esri.views.3d.layers.support.DefinitionExpressionSceneLayerView")],t),t};var K=s=>{let t=class extends s{get timeExtent(){return D(this.i3slayer,this.view?.timeExtent,this._get("timeExtent"))}get mergedFilter(){let{filter:e,timeExtent:i}=this;if(i==null)return e;let r=e?.clone()??new h;return i!=null&&(r.timeExtent=r.timeExtent?.intersection(i)??i),r}getTimeFilterDependencies(){let{timeInfo:e}=this.i3slayer;if(e==null)return[];let{startField:i,endField:r}=e;return[i,r]}addTimeFilter(e,i){if(i==null)return;let{timeInfo:r}=this.i3slayer;if(r==null)return;let{startField:a,endField:u,useTime:p}=r;if(!p||a==null&&u==null)return;let d=r.toJSON(),F=i.toJSON();e.push((w,_)=>b(w,_,d,F))}};return n([l({readOnly:!0})],t.prototype,"timeExtent",null),n([l()],t.prototype,"mergedFilter",null),t=n([f("esri.views.3d.layers.support.TemporalSceneLayerView")],t),t};function b(s,t,e,i){let r=t.attributeInfo?.attributeData;if(r==null)return;let{startTimeField:a,endTimeField:u}=e;if(a!=null&&r[a]==null||u!=null&&r[u]==null)return;let p=E(e,i,new m(r));if(p==null)return;let{featureIds:d}=t;x(s,d,p)}var m=class{constructor(t){this.attributeData=t}getAttribute(t,e){return y(this.attributeData[e],t)}getAttributeAsTimestamp(t,e){let i=this.getAttribute(t,e);return typeof i=="string"?new Date(i).getTime():typeof i=="number"||i==null?i:null}};export{V as a,K as b};
