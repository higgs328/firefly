import{a as G}from"./chunk-WBPLJNRU.js";import{a as T}from"./chunk-EBLTZITF.js";import{c as st,e as O,f as Q,g as k,h as ct,i as ut,j as lt}from"./chunk-E2J2V7JN.js";import{a as l,c as it}from"./chunk-EM35R6FY.js";import{a as et,b as m,c as nt,d as W,g as R,k as q,m as rt,n as L,o as at,p as ot,s as M,y as D}from"./chunk-QXXXCEV5.js";import{c as tt,d as V}from"./chunk-NX5B6XBR.js";import{b as B,f as C,g as E,q as I}from"./chunk-DA3SDKGO.js";import{c as $}from"./chunk-RSDQHAJX.js";import{i as _}from"./chunk-EQZWYK27.js";import{m as N}from"./chunk-ZQIC5NFT.js";import{c as P}from"./chunk-VIEK2X23.js";import{a as F}from"./chunk-XKIFGPJO.js";import{a as Z}from"./chunk-7F5DJLJT.js";import{ca as Y,d as v,f as K,t as z}from"./chunk-NJWTSROP.js";import{b as J}from"./chunk-ACP3S2CH.js";import{f as j}from"./chunk-VTHXE323.js";var mt=96,yt=39.37,Gt=180/Math.PI;function pt(t){return t.wkid?t:t.spatialReference||Z.WGS84}function U(t,e){return e.type?m(t,e.x,e.y):et(t,e)}function gt(t){return Y(t)}function dt(t,e,n=0){let r=t.width,a=t.height;if(n!==0){let s=_(n),u=Math.abs(Math.cos(s)),c=Math.abs(Math.sin(s));r=t.width*u+t.height*c,a=t.width*c+t.height*u}let o=Math.max(1,e[0]),i=Math.max(1,e[1]);return Math.max(r/o,a/i)*jt(t.spatialReference)}function S(t,e,n,r){return j(this,null,function*(){let a,o;if(!t||Array.isArray(t)&&!t.length)return null;if(J.isCollection(t)&&(t=t.toArray()),Array.isArray(t)&&t.length&&typeof t[0]=="object"){let s=t.every(p=>"attributes"in p),u=t.some(p=>!p.geometry),c=t;if(s&&u&&e&&e.allLayerViews){let p=new Map;for(let f of t){let y=f.layer,w=p.get(y)||[],x=f.attributes[y.objectIdField];x!=null&&w.push(x),p.set(y,w)}let d=[];p.forEach((f,y)=>{let w=e.allLayerViews?.find(x=>x.layer.id===y.id);if(w&&"queryFeatures"in w){let x=y.createQuery();x.objectIds=f,x.returnGeometry=!0,d.push(w.queryFeatures(x))}});let b=yield Promise.all(d),g=[];for(let f of b)if(f&&f.features&&f.features.length)for(let y of f.features)y.geometry!=null&&g.push(y.geometry);c=g}for(let p of c)r=yield S(p,e,n,r);return r}if(Array.isArray(t)&&t.length===2&&typeof t[0]=="number"&&typeof t[1]=="number")a=new P(t);else if(t instanceof F)a=t;else if("geometry"in t){if(t.geometry)a=t.geometry;else if(t.layer){let s=t.layer,u=e.allLayerViews?.find(c=>c.layer.id===s.id);if(u&&"queryFeatures"in u){let c=s.createQuery();c.objectIds=[t.attributes[s.objectIdField]],c.returnGeometry=!0,a=(yield u.queryFeatures(c))?.features?.[0]?.geometry}}}if(a==null)return null;switch(a.type){case"point":o=new N({xmin:a.x,ymin:a.y,xmax:a.x,ymax:a.y,spatialReference:a.spatialReference});break;case"extent":case"multipoint":case"polygon":case"polyline":o=tt(a);break;default:o=a.extent}if(!o)return null;B()||I(o.spatialReference,n)||(yield C());let i=E(o,n);if(!i)return null;if(r){let s=i.center,u=s.clone();u.x=V(s.x,r.center.x,n),u.x!==s.x&&i.centerAt(u),r=r.union(i)}else r=i;return r})}function St(t){if(t&&(!Array.isArray(t)||typeof t[0]!="number")&&(typeof t=="object"||Array.isArray(t)&&typeof t[0]=="object")){if("layer"in t&&t.layer?.minScale!=null&&t.layer.maxScale!=null){let e=t.layer;return{min:e.minScale,max:e.maxScale}}if(Array.isArray(t)&&t.length&&t.every(e=>"layer"in e)){let e=0,n=0;for(let r of t){let a=r.layer;a?.minScale&&a.maxScale&&(e=a.minScale<e?a.minScale:e,n=a.maxScale>n?a.maxScale:n)}return e&&n?{min:e,max:n}:null}}}function ft(t,e){let n=pt(t);return v(n,e)||n.imageCoordinateSystem||e.imageCoordinateSystem?t:E(t,e)}function Yt(t,e){return j(this,null,function*(){if(!t||!e)return new T({targetGeometry:new P,scale:0,rotation:0});let n=e.spatialReference,{constraints:r,padding:a,viewpoint:o,size:i}=e,s=[a?i[0]-a.left-a.right:i[0],a?i[1]-a.top-a.bottom:i[1]],u=null;t instanceof T?u=t:t.viewpoint?u=t.viewpoint:t.target&&t.target.declaredClass==="esri.Viewpoint"&&(u=t.target);let c=null;u?.targetGeometry?c=u.targetGeometry:t instanceof N?c=t:t instanceof F?c=yield S(t,e,n):t&&(c=(yield S(t.center,e,n))||(yield S(t.target,e,n))||(yield S(t,e,n))),!c&&o?.targetGeometry?c=o.targetGeometry:!c&&e.extent&&(c=e.extent),n||(n=pt(e.spatialReference||e.extent||c)),B()||v(c.spatialReference,n)||I(c.spatialReference,n)||(yield C());let p=ft(c,n),d="center"in p?p.center:p;e.pickClosestTarget!==!1&&d.type==="point"&&o.targetGeometry?.type==="point"&&(d.x=V(d.x,o.targetGeometry.x,d.spatialReference));let b=0;u?b=u.rotation:t.hasOwnProperty("rotation")?b=t.rotation:o&&(b=o.rotation);let g=0;g=u?.targetGeometry!=null&&u.targetGeometry.type==="point"?u.scale:"scale"in t&&t.scale?t.scale:"zoom"in t&&t.zoom!==-1&&r&&r.effectiveLODs?r.zoomToScale(t.zoom):Array.isArray(c)||c.type==="point"||c.type==="extent"&&c.width===0&&c.height===0?o.scale:dt(ft(c.extent,n),s,b);let f=St(t.target??t);f&&(f.min&&f.min<g?g=f.min:f.max&&f.max>g&&(g=f.max));let y=new T({targetGeometry:d,scale:g,rotation:b});return r&&(y=r.fit(y),r.constrainByGeometry(y),r.rotationEnabled||(y.rotation=o.rotation)),y})}function h(t,e){let n=t.targetGeometry,r=e.targetGeometry;return n.x=r.x,n.y=r.y,n.spatialReference=r.spatialReference,t.scale=e.scale,t.rotation=e.rotation,t}function At(t,e,n){return n?m(t,.5*(e[0]-n.right+n.left),.5*(e[1]-n.bottom+n.top)):R(t,e,.5)}var Zt=function(){let t=l();return function(e,n,r){let a=n.targetGeometry;U(t,a);let o=.5*A(n);return e.xmin=t[0]-o*r[0],e.ymin=t[1]-o*r[1],e.xmax=t[0]+o*r[0],e.ymax=t[1]+o*r[1],e.spatialReference=a.spatialReference,e}}();function _t(t,e,n,r,a){return Ft(t,e,n.center),t.scale=dt(n,r),a?.constraints?.constrain(t),t}function Mt(t,e,n,r){return bt(t,e,n,r),st(t,t)}var xt=function(){let t=l();return function(e,n,r){return D(e,vt(e,n),At(t,n,r))}}(),kt=function(){let t=G(),e=l();return function(n,r,a,o){let i=A(r),s=X(r);return m(e,i,i),ut(t,e),O(t,t,s),k(t,t,xt(e,a,o)),k(t,t,[0,o.top-o.bottom]),m(n,t[4],t[5])}}();function A(t){return t.scale*Tt(t.targetGeometry?.spatialReference)}function Tt(t){return z(t)?1/(gt(t)*yt*mt):1}function X(t){return $(t.rotation)||0}function jt(t){return z(t)?gt(t)*yt*mt:1}function vt(t,e){return R(t,e,.5)}var ht=function(){let t=l(),e=l(),n=l();return function(r,a,o,i,s,u){return rt(t,a),R(e,o,.5*u),m(n,1/i*u,-1/i*u),lt(r,e),s&&O(r,r,s),Q(r,r,n),k(r,r,t),r}}(),bt=function(){let t=l();return function(e,n,r,a){let o=A(n),i=X(n);return U(t,n.targetGeometry),ht(e,t,r,o,i,a)}}(),$t=function(){let t=l();return function(e,n,r,a){let o=A(n);return U(t,n.targetGeometry),ht(e,t,r,o,0,a)}}();function zt(t){let e=K(t);return e?e.valid[1]-e.valid[0]:0}function te(t,e){return Math.round(zt(t)/e)}var ee=function(){let t=l(),e=l(),n=[0,0,0];return function(r,a,o){W(t,r,a),L(t,t),W(e,r,o),L(e,e),ot(n,t,e);let i=Math.acos(at(t,e)/(q(t)*q(e)))*Gt;return n[2]<0&&(i=-i),isNaN(i)&&(i=0),i}}(),ne=function(){let t=l();return function(e,n,r,a){let o=e.targetGeometry;return h(e,n),kt(t,n,r,a),o.x+=t[0],o.y+=t[1],e}}(),Ft=function(t,e,n){h(t,e);let r=t.targetGeometry;return r.x=n.x,r.y=n.y,r.spatialReference=n.spatialReference,t},re=function(){let t=l();return function(e,n,r,a,o){o||(o="center"),D(t,r,a),R(t,t,.5);let i=t[0],s=t[1];switch(o){case"center":m(t,0,0);break;case"left":m(t,-i,0);break;case"top":m(t,0,s);break;case"right":m(t,i,0);break;case"bottom":m(t,0,-s);break;case"top-left":m(t,-i,s);break;case"bottom-left":m(t,-i,-s);break;case"top-right":m(t,i,s);break;case"bottom-right":m(t,i,-s)}return H(e,n,t),e}}();function ae(t,e,n){return h(t,e),t.rotation+=n,t}function oe(t,e,n){return h(t,e),t.rotation=n,t}var Pt=function(){let t=l();return function(e,n,r,a,o){return h(e,n),isNaN(r)||r===0||(wt(t,a,n,o),e.scale=n.scale*r,Rt(t,t,e,o),H(e,e,m(t,t[0]-a[0],a[1]-t[1]))),e}}();function ie(t,e,n){return h(t,e),t.scale=n,t}var Nt=function(){let t=l();return function(e,n,r,a,o,i){return h(e,n),isNaN(r)||r===0||(wt(t,o,n,i),e.scale=n.scale*r,e.rotation+=a,Rt(t,t,e,i),H(e,e,m(t,t[0]-o[0],o[1]-t[1]))),e}}(),se=function(){let t=l(),e=l();return function(n,r,a,o,i,s,u){return xt(e,s,u),nt(t,i,e),o?Nt(n,r,a,o,t,s):Pt(n,r,a,t,s)}}(),wt=function(){let t=G();return function(e,n,r,a){return M(e,n,Mt(t,r,a,1))}}(),Rt=function(){let t=G();return function(e,n,r,a){return M(e,n,bt(t,r,a,1))}}(),H=function(){let t=l(),e=G();return function(n,r,a){h(n,r);let o=A(r),i=n.targetGeometry;return ct(e,X(r)),Q(e,e,it(o,o)),M(t,a,e),i.x+=t[0],i.y+=t[1],n}}();export{dt as a,Yt as b,h as c,At as d,Zt as e,_t as f,xt as g,A as h,Tt as i,jt as j,ht as k,bt as l,$t as m,zt as n,te as o,ee as p,ne as q,Ft as r,re as s,ae as t,oe as u,ie as v,Nt as w,se as x,H as y};
