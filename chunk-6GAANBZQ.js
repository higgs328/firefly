import{a as k,d as I}from"./chunk-4JIR4MZV.js";import{d as y}from"./chunk-OLOKUDVI.js";import{j as f}from"./chunk-EQZWYK27.js";import{a as b}from"./chunk-TG2UTNEO.js";var x=["click","double-click","immediate-click","immediate-double-click","hold","drag","key-down","key-up","pointer-down","pointer-move","pointer-up","pointer-drag","mouse-wheel","pointer-enter","pointer-leave","gamepad","focus","blur"],P={};function _(e){return!!P[e]}function w(e){for(let t of e)if(!_(t))return!1;return!0}x.forEach(e=>{P[e]=!0});var D=class{constructor(t){this._handlers=new Map,this._counter=0,this._handlerCounts=new Map,this.view=t,this.inputManager=null}connect(t){t&&this.disconnect(),this.inputManager=t,this._handlers.forEach(({handler:r,priority:i},a)=>this.inputManager?.installHandlers(a,[r],i))}disconnect(){this.inputManager&&this._handlers.forEach((t,r)=>this.inputManager?.uninstallHandlers(r)),this.inputManager=null}destroy(){this.disconnect(),this._handlers.clear(),this.view=null}on(t,r,i,a){let o=Array.isArray(t)?t:t.split(",");if(!w(o))return o.some(_)&&console.error("Error: registering input events and other events on the view at the same time is not supported."),null;let n,s;Array.isArray(r)?s=r:(n=r,s=[]),typeof i=="function"?n=i:a=i,a=a??I.DEFAULT;let p=this._createUniqueGroupName(),c=new h(this.view,o,s,n);this._handlers.set(p,{handler:c,priority:a});for(let l of o){let u=this._handlerCounts.get(l)||0;this._handlerCounts.set(l,u+1)}return this.inputManager&&this.inputManager.installHandlers(p,[c],a),b(()=>this._removeHandler(p,o))}hasHandler(t){return!!this._handlerCounts.get(t)}_removeHandler(t,r){if(this._handlers.has(t)){this._handlers.delete(t);for(let i of r){let a=this._handlerCounts.get(i);a===void 0||(a===1?this._handlerCounts.delete(i):this._handlerCounts.set(i,a-1))}}this.inputManager&&this.inputManager.uninstallHandlers(t)}_createUniqueGroupName(){return this._counter+=1,`viewEvents_${this._counter}`}},h=class extends k{constructor(t,r,i,a){super(!0),this._latestDragStart=void 0,this.view=t;for(let o of r)switch(o){case"click":this.registerIncoming("click",i,n=>a(M(t,n)));break;case"double-click":this.registerIncoming("double-click",i,n=>a(H(t,n)));break;case"immediate-click":this.registerIncoming("immediate-click",i,n=>a(C(t,n)));break;case"immediate-double-click":this.registerIncoming("immediate-double-click",i,n=>a(S(t,n)));break;case"hold":this.registerIncoming("hold",i,n=>a(A(t,n)));break;case"drag":this.registerIncoming("drag",i,n=>{let s=this._wrapDrag(n);s&&a(s)});break;case"key-down":this.registerIncoming("key-down",i,n=>a(U(n)));break;case"key-up":this.registerIncoming("key-up",i,n=>a(q(n)));break;case"pointer-down":this.registerIncoming("pointer-down",i,n=>a(d(n,"pointer-down")));break;case"pointer-move":this.registerIncoming("pointer-move",i,n=>a(d(n,"pointer-move")));break;case"pointer-up":this.registerIncoming("pointer-up",i,n=>a(d(n,"pointer-up")));break;case"pointer-drag":this.registerIncoming("pointer-drag",i,n=>a(G(n)));break;case"mouse-wheel":this.registerIncoming("mouse-wheel",i,n=>a(N(n)));break;case"pointer-enter":this.registerIncoming("pointer-enter",i,n=>a(d(n,"pointer-enter")));break;case"pointer-leave":this.registerIncoming("pointer-leave",i,n=>a(d(n,"pointer-leave")));break;case"gamepad":this.registerIncoming("gamepad",i,n=>{a(V(n))});break;case"focus":this.registerIncoming("focus",i,n=>{a(T(n))});break;case"blur":this.registerIncoming("blur",i,n=>{a(E(n))})}}_wrapDrag(t){let r=t.data,{x:i,y:a}=r.center,{action:o,pointerType:n,button:s}=r;if(o==="start"&&(this._latestDragStart=r),!this._latestDragStart)return;let p=r.pointer.native,c=r.buttons,{cancelable:l,timestamp:u}=t,m={x:this._latestDragStart.center.x,y:this._latestDragStart.center.y};return o==="end"&&(this._latestDragStart=void 0),{type:"drag",action:o,x:i,y:a,origin:m,pointerType:n,button:s,buttons:c,radius:r.radius,angle:f(r.angle),native:p,timestamp:u,cancelable:l,stopPropagation:()=>t.stopPropagation(),async:v=>t.async(v),preventDefault:()=>t.preventDefault()}}};function T(e){return{type:"focus",timestamp:e.timestamp,native:e.data.native,cancelable:e.cancelable,stopPropagation:()=>e.stopPropagation(),async:t=>e.async(t),preventDefault:()=>e.preventDefault()}}function E(e){return{type:"blur",timestamp:e.timestamp,native:e.data.native,cancelable:e.cancelable,stopPropagation:()=>e.stopPropagation(),async:t=>e.async(t),preventDefault:()=>e.preventDefault()}}function M(e,t){let{pointerType:r,button:i,buttons:a,x:o,y:n,native:s,eventId:p}=t.data,{cancelable:c,timestamp:l}=t;return{type:"click",pointerType:r,button:i,buttons:a,x:o,y:n,native:s,timestamp:l,screenPoint:y(o,n),mapPoint:g(e,o,n),eventId:p,cancelable:c,stopPropagation:()=>t.stopPropagation(),async:u=>t.async(u),preventDefault:()=>t.preventDefault()}}function H(e,t){let{pointerType:r,button:i,buttons:a,x:o,y:n,native:s,eventId:p}=t.data,{cancelable:c,timestamp:l}=t;return{type:"double-click",pointerType:r,button:i,buttons:a,x:o,y:n,native:s,timestamp:l,mapPoint:g(e,o,n),eventId:p,cancelable:c,stopPropagation:()=>t.stopPropagation(),async:u=>t.async(u),preventDefault:()=>t.preventDefault()}}function C(e,t){let{pointerType:r,button:i,buttons:a,x:o,y:n,native:s,eventId:p}=t.data,c=s.pointerId,{cancelable:l,timestamp:u}=t;return{type:"immediate-click",pointerId:c,pointerType:r,button:i,buttons:a,x:o,y:n,native:s,timestamp:u,mapPoint:g(e,o,n),eventId:p,cancelable:l,stopPropagation:()=>t.stopPropagation(),async:m=>t.async(m),preventDefault:()=>t.preventDefault()}}function S(e,t){let{pointerType:r,button:i,buttons:a,x:o,y:n,native:s,eventId:p}=t.data,c=s.pointerId,{cancelable:l,timestamp:u}=t;return{type:"immediate-double-click",pointerId:c,pointerType:r,button:i,buttons:a,x:o,y:n,native:s,timestamp:u,mapPoint:g(e,o,n),eventId:p,cancelable:l,stopPropagation:()=>t.stopPropagation(),async:m=>t.async(m),preventDefault:()=>t.preventDefault()}}function A(e,t){let{pointerType:r,button:i,buttons:a,x:o,y:n,native:s}=t.data,{cancelable:p,timestamp:c}=t;return{type:"hold",pointerType:r,button:i,buttons:a,x:o,y:n,native:s,timestamp:c,mapPoint:g(e,o,n),cancelable:p,stopPropagation:()=>t.stopPropagation(),async:l=>t.async(l),preventDefault:()=>t.preventDefault()}}function g(e,t,r){return e.toMap(y(t,r),{exclude:[]})}function U(e){let{key:t,repeat:r,native:i}=e.data,{cancelable:a,timestamp:o}=e;return{type:"key-down",key:t,repeat:r,native:i,timestamp:o,cancelable:a,stopPropagation:()=>e.stopPropagation(),async:n=>e.async(n),preventDefault:()=>e.preventDefault()}}function q(e){let{key:t,native:r}=e.data,{cancelable:i,timestamp:a}=e;return{type:"key-up",key:t,native:r,timestamp:a,cancelable:i,stopPropagation:()=>e.stopPropagation(),async:o=>e.async(o),preventDefault:()=>e.preventDefault()}}function d(e,t){let{x:r,y:i,button:a,buttons:o,native:n,eventId:s}=e.data,p=n.pointerId,c=n.pointerType,{cancelable:l,timestamp:u}=e;return{type:t,x:r,y:i,pointerId:p,pointerType:c,button:a,buttons:o,native:n,timestamp:u,eventId:s,cancelable:l,stopPropagation:()=>e.stopPropagation(),async:m=>e.async(m),preventDefault:()=>e.preventDefault()}}function G(e){let{x:t,y:r,buttons:i,native:a,eventId:o}=e.data.currentEvent,{button:n}=e.data.startEvent,s=e.data.startEvent.native.pointerId,p=e.data.startEvent.native.pointerType,c=e.data.action,l={x:e.data.startEvent.x,y:e.data.startEvent.y},{cancelable:u,timestamp:m}=e;return{type:"pointer-drag",x:t,y:r,pointerId:s,pointerType:p,button:n,buttons:i,action:c,origin:l,native:a,timestamp:m,eventId:o,cancelable:u,stopPropagation:()=>e.stopPropagation(),async:v=>e.async(v),preventDefault:()=>e.preventDefault()}}function N(e){let{cancelable:t,data:r,timestamp:i}=e,{x:a,y:o,deltaY:n,native:s}=r;return{type:"mouse-wheel",x:a,y:o,deltaY:n,native:s,timestamp:i,cancelable:t,stopPropagation:()=>e.stopPropagation(),async:p=>e.async(p),preventDefault:()=>e.preventDefault()}}function V(e){let{action:t,state:r,device:i}=e.data,{cancelable:a,timestamp:o}=e,{buttons:n,axes:s}=r;return{type:"gamepad",device:i,timestamp:o,action:t,buttons:n,axes:s,cancelable:a,stopPropagation:()=>e.stopPropagation(),async:p=>e.async(p),preventDefault:()=>e.preventDefault()}}export{x as a,D as b};
