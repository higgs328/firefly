import{a as b,b as F,d as S}from"./chunk-3XC7YFMG.js";import{c as P}from"./chunk-BBB7KLHV.js";import{g as R,s as x}from"./chunk-DA3SDKGO.js";import"./chunk-ZOEPYNM4.js";import"./chunk-57VFBGF3.js";import"./chunk-GWBRHLNH.js";import"./chunk-BJH4F4SM.js";import"./chunk-Z3RBZHAK.js";import"./chunk-MDZTV2VL.js";import"./chunk-RNC4P66O.js";import"./chunk-7LHOQXZT.js";import"./chunk-BCREO4Q5.js";import"./chunk-U4QEPZJ3.js";import"./chunk-KJUZWSCL.js";import"./chunk-3WO6D7MU.js";import"./chunk-BUZ3SPLE.js";import"./chunk-BOVYXYHK.js";import"./chunk-KVM6SHDX.js";import"./chunk-EQZWYK27.js";import"./chunk-ZQIC5NFT.js";import{c as k}from"./chunk-VIEK2X23.js";import"./chunk-XKIFGPJO.js";import"./chunk-PEW2PLAN.js";import"./chunk-Q6Y4JG7Q.js";import"./chunk-7F5DJLJT.js";import"./chunk-CX5IFQZJ.js";import{e as w}from"./chunk-NJWTSROP.js";import"./chunk-D3R25AF2.js";import"./chunk-ARRCN5K3.js";import"./chunk-G4DZJMGT.js";import"./chunk-X2B63YVS.js";import"./chunk-BAEF3CT6.js";import"./chunk-AUAZP44J.js";import"./chunk-PVDFCTA4.js";import"./chunk-KNVXE32P.js";import"./chunk-76ATOSLU.js";import"./chunk-CCJU4DSH.js";import{f as _}from"./chunk-RAI4DTMT.js";import"./chunk-TYYVNQUR.js";import{a as i}from"./chunk-QGVBCWUY.js";import{H as T}from"./chunk-MYO4NP2N.js";import{e as l}from"./chunk-NFIPKH6V.js";import"./chunk-JPU2PQZC.js";import{l as v}from"./chunk-5QEXLALV.js";import"./chunk-P6QFA5MM.js";import"./chunk-DGTD7Y73.js";import"./chunk-LI2SX4T6.js";import"./chunk-BWO7LS2H.js";import"./chunk-HEVQSRJ2.js";import"./chunk-OVHPPCBL.js";import"./chunk-SNFOAZZQ.js";import"./chunk-AML4XSEF.js";import{L as y,l as g,p as c}from"./chunk-4PTIEWMT.js";import"./chunk-TG2UTNEO.js";import{b as h}from"./chunk-YOFFGXOB.js";import"./chunk-XRGPJ3QY.js";import"./chunk-6MRUJ2UW.js";import"./chunk-2LI2GKBQ.js";import{a as m}from"./chunk-QBWJMFH5.js";import{f as u}from"./chunk-VTHXE323.js";var n=class extends T{constructor(){super({}),this.files=[],this.progress=0,this._uploadTask=null,this._layer=null}destroy(){this.cancel(),this.files=[],this._layer=null,this._uploadTask=null}get state(){let e=this._uploadTask;return e&&this.files.length!==0?e.finished?e.error?"error":"success":"pending":"default"}get result(){return this._uploadTask?.value??null}get error(){return this._uploadTask?.error??null}uploadTo(e){this.cancel(),this.files=[],this._layer=e,this._uploadTask=_(o=>u(this,null,function*(){let a=yield z(e);c(o),this.progress=0,this.files=a;let r=F(b.upload,d=>{this.progress=d},"Upload.uploadTo");if(a.length===0)return null;c(o);let s=yield e.extractAndFilterFiles(a);c(o),s.length>0&&(this.files=s);let t=yield e.convertMesh(s,{signal:o,onProgress:r.makeOnProgress("createFromFiles")});if(c(o),!t)throw new h("editor:upload","could not upload or convert model");let p=s.reduce((d,j)=>d+j.size,0),E=r.simulate("loadMesh",S(p));try{yield t.load()}finally{E.remove()}if(m("enable-feature:georeferenced-uploads")&&t.metadata.georeferenced){if(yield w(e.spatialReference,t.origin?.spatialReference))return{type:"georeferenced",mesh:t};if((e.spatialReference.isWebMercator||e.spatialReference.isWGS84)&&(yield M(t,e.spatialReference)))return{type:"georeferenced-reprojected",mesh:t}}return t.spatialReference=e.spatialReference,t.vertexSpace.origin=[0,0,0],{type:"non-georeferenced",mesh:t}}))}retry(){this._layer&&this.uploadTo(this._layer)}cancel(){this._uploadTask?.abort()}};i([l()],n.prototype,"files",void 0),i([l()],n.prototype,"progress",void 0),i([l()],n.prototype,"state",null),i([l()],n.prototype,"result",null),i([l()],n.prototype,"error",null),i([l()],n.prototype,"_uploadTask",void 0),i([l()],n.prototype,"_layer",void 0),n=i([v("esri.widgets.Editor.Upload")],n);var f=null;function z(e){return u(this,null,function*(){let{resolve:o,promise:a}=y(),r=document.createElement("input");r.type="file",r.multiple=!1,r.accept=[...P(e.infoFor3D),".zip"].join(","),r.style.display="none",document.body.appendChild(r);let s=g(r,"change",()=>o(r.files?Array.from(r.files):[]));return f?f(r):r.click(),a.finally(()=>{s.remove(),r.remove()})})}function X(e,o){f=a=>{o?.(),Promise.resolve().then(()=>e).then(r=>{if(!f)return;let s=new DataTransfer;r.forEach(t=>s.items.add(t)),a.files=s.files,a.dispatchEvent(new Event("change"))})}}function Y(){f=null}function M(e,o){return u(this,null,function*(){if(yield x(e.spatialReference,o),!e.vertexSpace.origin)return!1;let[a,r,s]=e.vertexSpace.origin,t=new k({x:a,y:r,z:s,spatialReference:e.spatialReference}),p=R(t,o);return!!p&&(e.vertexSpace.origin=[p.x,p.y,p.z??0],e.spatialReference=o,!0)})}export{n as Upload,Y as clearPromptForFilesStub,X as stubFilePickerToSelect};
