import{a as M}from"./chunk-JXEAVWUK.js";import{a as B,b as E}from"./chunk-4D3QHJI2.js";import{d as S,e as F,g as z,h as D}from"./chunk-E2J2V7JN.js";import{a as X}from"./chunk-37H4LYIE.js";import{a as G}from"./chunk-ZOOQQO74.js";import{b as A,s as R}from"./chunk-QXXXCEV5.js";import{g as k}from"./chunk-XRGPJ3QY.js";var J=()=>k.getLogger("esri.views.2d.engine.webgl.alignmentUtils"),y,b;function W(s){if(!s)return y.Center;switch(s){case"Left":case"left":return y.Left;case"Right":case"right":return y.Right;case"Justify":return J().warnOnce("Horizontal alignment 'justify' is not implemented. Falling back to 'center'."),y.Center;case"Center":case"center":return y.Center}}function I(s){if(!s)return b.Center;switch(s){case"Top":case"top":return b.Top;case"Center":case"middle":return b.Center;case"Baseline":case"baseline":return b.Baseline;case"Bottom":case"bottom":return b.Bottom}}function nt(s){switch(s){case"above-left":case"esriServerPointLabelPlacementAboveLeft":return["right","bottom"];case"above-center":case"above-along":case"esriServerPointLabelPlacementAboveCenter":case"esriServerLinePlacementAboveAlong":return["center","bottom"];case"above-right":case"esriServerPointLabelPlacementAboveRight":return["left","bottom"];case"center-left":case"esriServerPointLabelPlacementCenterLeft":return["right","middle"];case"center-center":case"center-along":case"esriServerPointLabelPlacementCenterCenter":case"esriServerLinePlacementCenterAlong":case"always-horizontal":case"esriServerPolygonPlacementAlwaysHorizontal":return["center","middle"];case"center-right":case"esriServerPointLabelPlacementCenterRight":return["left","middle"];case"below-left":case"esriServerPointLabelPlacementBelowLeft":return["right","top"];case"below-center":case"below-along":case"esriServerPointLabelPlacementBelowCenter":case"esriServerLinePlacementBelowAlong":return["center","top"];case"below-right":case"esriServerPointLabelPlacementBelowRight":return["left","top"];default:return console.debug(`Found invalid placement type ${s}`),["center","middle"]}}function ot(s){switch(s){case y.Right:case"right":return-1;case y.Center:case"center":return 0;case y.Left:case"left":return 1;default:return console.debug(`Found invalid horizontal alignment ${s}`),0}}function it(s){switch(s){case b.Top:case"top":return 1;case b.Center:case"middle":return 0;case b.Bottom:case b.Baseline:case"baseline":case"bottom":return-1;default:return console.debug(`Found invalid vertical alignment ${s}`),0}}(function(s){s[s.Left=-1]="Left",s[s.Center=0]="Center",s[s.Right=1]="Right"})(y||(y={})),function(s){s[s.Top=1]="Top",s[s.Center=0]="Center",s[s.Bottom=-1]="Bottom",s[s.Baseline=2]="Baseline"}(b||(b={}));var V=22,Z=4,U=V+Z,q=V-6,$=3,K=Math.PI/180,v=8,N=1.5,O=class{constructor(t,o,e,n){this._rotationT=B(),this._xBounds=0,this._yBounds=0,this.minZoom=0,this.maxZoom=255,this._bounds=null;let i=e.rect,r=new Float32Array(8);t*=n,o*=n;let f=e.code?i.width*n:e.metrics.width,a=e.code?i.height*n:e.metrics.height;this.width=f,this.height=a,r[0]=t,r[1]=o,r[2]=t+f,r[3]=o,r[4]=t,r[5]=o+a,r[6]=t+f,r[7]=o+a,this._data=r,this._setTextureCoords(i),this._scale=n,this._mosaic=e,this.x=t,this.y=o,this.maxOffset=Math.max(t+f,o+a)}get mosaic(){return this._mosaic}set angle(t){this._angle=t,D(this._rotationT,-t),this._setOffsets()}get angle(){return this._angle}get xTopLeft(){return this._data[0]}get yTopLeft(){return this._data[1]}get xBottomRight(){return this._data[6]}get yBottomRight(){return this._data[7]}get texcoords(){return this._texcoords}get textureBinding(){return this._mosaic.textureBinding}get offsets(){return this._offsets||this._setOffsets(),this._offsets}get char(){return String.fromCharCode(this._mosaic.code)}get code(){return this._mosaic.code}get bounds(){if(!this._bounds){let{height:t,width:o}=this._mosaic.metrics,e=o*this._scale,n=Math.abs(t)*this._scale,i=new Float32Array(8);i[0]=this.x,i[1]=this.y,i[2]=this.x+e,i[3]=this.y,i[4]=this.x,i[5]=this.y+n,i[6]=this.x+e,i[7]=this.y+n;let r=S(B(),this._rotationT,this._transform);E(i,i,r);let f=1/0,a=1/0,l=-1/0,m=-1/0;for(let h=0;h<4;h++){let g=i[2*h],x=i[2*h+1];f=Math.min(f,g),a=Math.min(a,x),l=Math.max(l,g),m=Math.max(m,x)}let p=l-f,d=m-a,c=f+p/2,u=a+d/2;this._bounds=new M(c,u,p,d)}return this._bounds}setTransform(t){this._transform=t,this._offsets=null}_setOffsets(){this._offsets||(this._offsets={topLeft:[0,0],topRight:[0,0],bottomLeft:[0,0],bottomRight:[0,0]});let t=S(B(),this._rotationT,this._transform);this._offsets.topLeft[0]=this._data[0],this._offsets.topLeft[1]=this._data[1],this._offsets.topRight[0]=this._data[2],this._offsets.topRight[1]=this._data[3],this._offsets.bottomLeft[0]=this._data[4],this._offsets.bottomLeft[1]=this._data[5],this._offsets.bottomRight[0]=this._data[6],this._offsets.bottomRight[1]=this._data[7],R(this._offsets.topLeft,this._offsets.topLeft,t),R(this._offsets.topRight,this._offsets.topRight,t),R(this._offsets.bottomLeft,this._offsets.bottomLeft,t),R(this._offsets.bottomRight,this._offsets.bottomRight,t)}_setTextureCoords({x:t,y:o,width:e,height:n}){this._texcoords={topLeft:[t,o],topRight:[t+e,o],bottomLeft:[t,o+n],bottomRight:[t+e,o+n]}}},Q=(s,t)=>({code:0,page:0,sdf:!0,rect:new G(0,0,11,8),textureBinding:t,metrics:{advance:0,height:4,width:s,left:0,top:0}});function T(s,t){return s.forEach(o=>R(o,o,t)),{topLeft:s[0],topRight:s[1],bottomLeft:s[2],bottomRight:s[3]}}var Y=class{constructor(t,o,e){this._rotation=0,this._decorate(t,o,e),this.glyphs=t,this.bounds=this._createBounds(t),this.isMultiline=o.length>1,this._hasRotation=e.angle!==0,this._transform=this._createGlyphTransform(this.bounds,e),this._borderLineSizePx=e.borderLineSizePx,(e.borderLineSizePx||e.hasBackground)&&([this.bounds,this.textBox]=this.shapeBackground(this._transform));for(let n of t)n.setTransform(this._transform)}setRotation(t){if(t===0&&this._rotation===0)return;this._rotation=t;let o=this._transform,e=D(B(),t);S(o,e,o);for(let n of this.glyphs)n.setTransform(this._transform)}_decorate(t,o,e){if(!e.decoration||e.decoration==="none"||!t.length)return;let n=e.scale,i=e.decoration==="underline"?U:q,r=t[0].textureBinding;for(let f of o){let a=f.startX*n,l=f.startY*n,m=(f.width+f.glyphWidthEnd)*n;t.push(new O(a,l+i*n,Q(m,r),1))}}shapeBackground(t){let o=this._borderLineSizePx||0,e=(N+o)/2,n=this._borderLineSizePx?e:0,{xmin:i,ymin:r,xmax:f,ymax:a,x:l,y:m,width:p,height:d}=this.bounds,c=[i-v,r-v],u=[f+v,r-v],h=[i-v,a+v],g=[f+v,a+v],x=T([[c[0]-e,c[1]-e],[u[0]+e,u[1]-e],[c[0]+n,c[1]+n],[u[0]-n,u[1]+n]],t),L=T([[h[0]+n,h[1]-n],[g[0]-n,g[1]-n],[h[0]-e,h[1]+e],[g[0]+e,g[1]+e]],t),_=T([[c[0]-e,c[1]-e],[c[0]+n,c[1]+n],[h[0]-e,h[1]+e],[h[0]+n,h[1]-n]],t),w=T([[u[0]-n,u[1]+n],[u[0]+e,u[1]-e],[g[0]-n,g[1]-n],[g[0]+e,g[1]+e]],t),C={main:T([c,u,h,g],t),top:x,bot:L,left:_,right:w};return[new M(l,m,p+2*e,d+2*e),C]}get boundsT(){let t=this.bounds,o=A(X(),t.x,t.y);if(R(o,o,this._transform),this._hasRotation){let e=Math.max(t.width,t.height);return new M(o[0],o[1],e,e)}return new M(o[0],o[1],t.width,t.height)}_createBounds(t){let o=1/0,e=1/0,n=0,i=0;for(let a of t)o=Math.min(o,a.xTopLeft),e=Math.min(e,a.yTopLeft),n=Math.max(n,a.xBottomRight),i=Math.max(i,a.yBottomRight);let r=n-o,f=i-e;return new M(o+r/2,e+f/2,r,f)}_createGlyphTransform(t,o){let e=K*o.angle,n=B(),i=X();return z(n,n,A(i,o.xOffset,-o.yOffset)),o.useCIMAngleBehavior?F(n,n,e):(z(n,n,A(i,t.x,t.y)),F(n,n,e),z(n,n,A(i,-t.x,-t.y))),n}},P=class{constructor(t,o,e,n,i,r){this.glyphWidthEnd=0,this.startX=0,this.startY=0,this.start=Math.max(0,Math.min(o,e)),this.end=Math.max(0,Math.max(o,e)),this.end<t.length&&(this.glyphWidthEnd=t[this.end].metrics.width),this.width=n,this.yMin=i,this.yMax=r}},H=s=>s===10,j=s=>s===32;function tt(s,t,o){let e=new Array,n=1/o.scale,i=o.maxLineWidth*n,r=t?s.length-1:0,f=t?-1:s.length,a=t?-1:1,l=r,m=0,p=0,d=l,c=d,u=0,h=1/0,g=0;for(;l!==f;){let{code:L,metrics:_}=s[l],w=Math.abs(_.top);if(H(L)||j(L)||(h=Math.min(h,w),g=Math.max(g,w+_.height)),H(L))l!==r&&(e.push(new P(s,d,l-a,m,h===1/0?0:h,g)),h=1/0,g=0),m=0,d=l+a,c=l+a,p=0;else if(j(L))c=l+a,p=0,u=_.advance,m+=_.advance;else if(m>i){if(c!==d){let C=c-2*a;m-=u,e.push(new P(s,d,C,m-p,h,g)),h=1/0,g=0,d=c,m=p}else e.push(new P(s,d,l-a,m,h,g)),h=1/0,g=0,d=l,c=l,m=0;m+=_.advance,p+=_.advance}else m+=_.advance,p+=_.advance;l+=a}let x=new P(s,d,l-a,m,h,g);return x.start>=0&&x.end<s.length&&e.push(x),e}function et(s,t){let o=0;for(let i=0;i<s.length;i++){let{width:r}=s[i];o=Math.max(r,o)}let e=t.decoration==="underline"?Z:0,n=s[0].yMin;return{x:0,y:n,height:s[s.length-1].yMax+t.lineHeight*(s.length-1)+e-n,width:o}}function dt(s,t){let o=t.scale,e=new Array,{glyphs:n,isRightToLeft:i}=s,r=tt(n,i,t),f=r.length?et(r,t):{x:0,y:0,height:0,width:0},a=W(t.horizontalAlignment),l=I(t.verticalAlignment),m=l===b.Baseline?1:0,p=m?0:l-1,d=(1-m)*-f.y+p*(f.height/2)+-22*(m?1:0);for(let c=0;c<r.length;c++){let{start:u,end:h,width:g}=r[c],x=-1*(a+1)*(g/2)-$,L=(s.isRightToLeft?r.length-1-c:c)*t.lineHeight+d-$;r[c].startX=x,r[c].startY=L;for(let _=u;_<=h;_++){let w=n[_];if(H(w.code))continue;let C=new O(x+w.metrics.left,L-w.metrics.top,w,o);x+=w.metrics.advance,e.push(C)}}return new Y(e,r,t)}export{W as a,I as b,nt as c,ot as d,it as e,dt as f};
