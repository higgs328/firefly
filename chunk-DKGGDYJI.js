import{a as w}from"./chunk-5LA3PVK5.js";import{a as N}from"./chunk-IR6XCBC4.js";import{a as x}from"./chunk-C6JPAW54.js";import{a as v}from"./chunk-WD3OPXCN.js";import{a as L}from"./chunk-FA3WGIU4.js";import{m as H}from"./chunk-ZQIC5NFT.js";import{a as f}from"./chunk-PEW2PLAN.js";import{a as D}from"./chunk-WFKZLI6F.js";import{l as T,o as E}from"./chunk-AUAZP44J.js";import{d as m}from"./chunk-KNVXE32P.js";import{f as q}from"./chunk-CCJU4DSH.js";import{a as r}from"./chunk-QGVBCWUY.js";import{e as o}from"./chunk-NFIPKH6V.js";import{l as A}from"./chunk-5QEXLALV.js";import{j as U}from"./chunk-P6QFA5MM.js";import{b as O,d as I,o as M,p as _,r as b,s as Q}from"./chunk-4PTIEWMT.js";import{b as S}from"./chunk-YOFFGXOB.js";import{e as g}from"./chunk-6MRUJ2UW.js";import{a as y,b as G,f as c}from"./chunk-VTHXE323.js";var B;function z(t){return B&&!B.destroyed||(B=t()),B}var h,P,J={PortalGroup:()=>Promise.resolve({default:x}),PortalItem:()=>import("./chunk-VBKMN4RI.js"),PortalUser:()=>Promise.resolve({default:w})},e=h=class extends q.JSONSupportMixin(N){constructor(t){super(t),this._esriIdCredentialCreateHandle=null,this.access=null,this.allSSL=!1,this.authMode="auto",this.authorizedCrossOriginDomains=null,this.basemapGalleryGroupQuery=null,this.basemapGalleryGroupQuery3D=null,this.bingKey=null,this.canListApps=!1,this.canListData=!1,this.canListPreProvisionedItems=!1,this.canProvisionDirectPurchase=!1,this.canSearchPublic=!0,this.canShareBingPublic=!1,this.canSharePublic=!1,this.canSignInArcGIS=!1,this.canSignInIDP=!1,this.colorSetsGroupQuery=null,this.commentsEnabled=!1,this.created=null,this.culture=null,this.customBaseUrl=null,this.default3DBasemapQuery=null,this.defaultBasemap=null,this.defaultDevBasemap=null,this.defaultExtent=null,this.defaultVectorBasemap=null,this.description=null,this.devBasemapGalleryGroupQuery=null,this.eueiEnabled=null,this.featuredGroups=null,this.featuredItemsGroupQuery=null,this.galleryTemplatesGroupQuery=null,this.layoutGroupQuery=null,this.livingAtlasGroupQuery=null,this.hasCategorySchema=!1,this.hasClassificationSchema=!1,this.helperServices=null,this.homePageFeaturedContent=null,this.homePageFeaturedContentCount=null,this.httpPort=null,this.httpsPort=null,this.id=null,this.ipCntryCode=null,this.isPortal=!1,this.isReadOnly=!1,this.layerTemplatesGroupQuery=null,this.maxTokenExpirationMinutes=null,this.modified=null,this.name=null,this.portalHostname=null,this.portalMode=null,this.portalProperties=null,this.region=null,this.recycleBinEnabled=!1,this.rotatorPanels=null,this.showHomePageDescription=!1,this.sourceJSON=null,this.supportsHostedServices=!1,this.symbolSetsGroupQuery=null,this.templatesGroupQuery=null,this.units=null,this.url=g.portalUrl,this.urlKey=null,this.user=null,this.use3dBasemaps=!0,this.useDefault3dBasemap=!1,this.useStandardizedQuery=!1,this.useVectorBasemaps=!1,this.vectorBasemapGalleryGroupQuery=null}normalizeCtorArgs(t){return typeof t=="string"?{url:t}:t}destroy(){K.unregister(this),this.defaultBasemap=O(this.defaultBasemap),this.defaultDevBasemap=O(this.defaultDevBasemap),this.defaultVectorBasemap=O(this.defaultVectorBasemap),this._esriIdCredentialCreateHandle=I(this._esriIdCredentialCreateHandle)}readAuthorizedCrossOriginDomains(t){if(t)for(let s of t)g.request.trustedServers.includes(s)||g.request.trustedServers.push(s);return t}readDefaultBasemap(t){return this._readBasemap(t)}readDefaultDevBasemap(t){return this._readBasemap(t)}readDefaultVectorBasemap(t){return this._readBasemap(t)}get extraQuery(){let t=this.user?.orgId,s=!t||this.canSearchPublic;return this.id&&!s?` AND orgid:${this.id}`:null}get hasAPIKey(){return T(this.url)}get isOrganization(){return!!this.access}get itemPageUrl(){return this.url?`${this.url}/home/item.html`:null}get restUrl(){let t=this.url;if(t){let s=t.indexOf("/sharing");t=s>0?t.slice(0,s):this.url.replace(/\/+$/,""),t+="/sharing/rest"}return t}get thumbnailUrl(){let t=this.restUrl,s=this.thumbnail;return t&&s?this._normalizeSSL(t+"/portals/self/resources/"+s):null}readUrlKey(t){return t&&t.toLowerCase()}readUser(t){let s=null;return t&&(s=w.fromJSON(t),s.portal=this),s}load(t){let s=import("./chunk-WCAQ4ILM.js").then(({default:a})=>{_(t),P=a}).then(()=>this.sourceJSON?this.sourceJSON:this.fetchSelf(this.authMode,!1,t)).then(a=>{if(!this.hasAPIKey&&m){let i=m;this.credential=i.findCredential(this.restUrl),this.credential||this.authMode!==h.AUTH_MODE_AUTO&&this.authMode!==h.AUTH_MODE_NO_PROMPT||(this._esriIdCredentialCreateHandle?.remove(),this._esriIdCredentialCreateHandle=i.on("credential-create",R(new WeakRef(this))),K.register(this,this._esriIdCredentialCreateHandle,this))}this.sourceJSON=a,this.read(a)});return this.addResolvingPromise(s),Promise.resolve(this)}createElevationLayers(){return c(this,null,function*(){yield this.load();let t=this._getHelperService("defaultElevationLayers"),s=(yield import("./chunk-75HMZKAA.js")).default;return t?t.map(a=>new s({id:a.id,url:a.url})):[]})}fetchBasemaps(t,s){return c(this,null,function*(){let a=yield this._fetchBasemaps(t,s);if(s?.include3d===!0&&this.use3dBasemaps!==!1){let i=yield this._fetchBasemaps3D(t,s);a.unshift(...i)}return a})}fetchDefault3DBasemap(t){return c(this,null,function*(){if(!this.useDefault3dBasemap||!this.default3DBasemapQuery||this.default3DBasemapQuery==="none")return null;let s=new v;s.query=this.default3DBasemapQuery,s.disableExtraQuery=!0;let a=(yield this.queryItems(s,t)).results.find(i=>i.type==="Web Scene");return a?new P({portalItem:a}):null})}fetchCategorySchema(t){return this.hasCategorySchema?this.request(this.restUrl+"/portals/self/categorySchema",t).then(s=>s.categorySchema):b(t)?Promise.reject(M()):Promise.resolve([])}fetchClassificationSchema(t){return c(this,null,function*(){return this.hasClassificationSchema?this.request(this.restUrl+"/portals/self/classification/classificationSchema",t).then(s=>s.classificationSchema):null})}fetchFeaturedGroups(t){let s=this.featuredGroups,a=new v({num:100,sortField:"title"});if(s?.length){let i=[];for(let l of s)i.push(`(title:"${l.title}" AND owner:${l.owner})`);return a.query=i.join(" OR "),this.queryGroups(a,t).then(l=>l.results)}return b(t)?Promise.reject(M()):Promise.resolve([])}fetchRegions(t){let s=this.user?.culture||this.culture||D();return this.request(this.restUrl+"/portals/regions",G(y({},t),{query:{culture:s}}))}fetchSettings(t){let s=this.user?.culture||this.culture||D();return this.request(this.restUrl+"/portals/self/settings",G(y({},t),{query:{culture:s}}))}static getDefault(){return z(()=>new h)}queryGroups(t,s){return this.queryPortal("/community/groups",t,"PortalGroup",s)}queryItems(t,s){return this.queryPortal("/search",t,"PortalItem",s)}queryUsers(t,s){return t.sortField||(t.sortField="username"),this.queryPortal("/community/users",t,"PortalUser",s)}fetchSelf(t=this.authMode,s=!1,a){let i=this.restUrl+"/portals/self",l=y({authMode:t,query:{culture:D().toLowerCase()},withCredentials:!0},a);return l.authMode==="auto"&&(l.authMode="no-prompt"),s&&(l.query.default=!0),this.request(i,l)}queryPortal(t,s,a,i){let l=U(v,s),u=p=>this.request(this.restUrl+t,y(y({},l.toRequestOptions(this)),i)).then(n=>{let d=l.clone();return d.start=n.nextStart,new L({nextQueryParams:d,queryParams:l,total:n.total,results:h._resultsToTypedArray(p,{portal:this},n,i)})}).then(n=>Promise.all(n.results.map(d=>typeof d.when=="function"?d.when():n)).then(()=>n,d=>(Q(d),n)));return a&&J[a]?J[a]().then(({default:p})=>(_(i),u(p))):u()}signIn(){if(this.hasAPIKey)return this.load().then(()=>{if(!this.user)throw new S("portal:not-authenticated","Unable to authenticate user. Portal.user is missing")});if(this.authMode===h.AUTH_MODE_ANONYMOUS||this.authMode===h.AUTH_MODE_NO_PROMPT&&!m)return Promise.reject(new S("portal:invalid-auth-mode",`Current "authMode"' is "${this.authMode}"`));if(this.loadStatus==="failed")return Promise.reject(this.loadError);let t=s=>Promise.resolve().then(()=>this.loadStatus==="not-loaded"?(s||(this.authMode="immediate"),this.load().then(()=>null)):this.loadStatus==="loading"?this.load().then(()=>this.credential?null:(this.credential=s,this.fetchSelf("immediate"))):this.user&&this.credential===s?null:(this.credential=s,this.fetchSelf("immediate"))).then(a=>{a&&(this.sourceJSON=a,this.read(a))});return m?m.getCredential(this.restUrl,{prompt:this.authMode!==h.AUTH_MODE_NO_PROMPT}).then(s=>t(s)):t(this.credential)}normalizeUrl(t){let s=this.credential?.token;return this._normalizeSSL(s?t+(t.includes("?")?"&":"?")+"token="+s:t)}requestToTypedArray(t,s,a){return this.request(t,s).then(i=>{let l=h._resultsToTypedArray(a,{portal:this},i);return Promise.all(l.map(u=>typeof u.when=="function"?u.when():i)).then(()=>l,()=>l)})}request(t,s={}){let a=y({f:"json"},s.query),{authMode:i=this.authMode===h.AUTH_MODE_ANONYMOUS||this.authMode===h.AUTH_MODE_NO_PROMPT?this.authMode:"auto",body:l=null,cacheBust:u=!1,method:p="auto",responseType:n="json",signal:d}=s,C={authMode:i,body:l,cacheBust:u,method:p,query:a,responseType:n,timeout:0,signal:d};return s.withCredentials&&(C.withCredentials=!0),E(this._normalizeSSL(t),C).then(F=>F.data)}toJSON(){throw new S("internal:not-yet-implemented","Portal.toJSON is not yet implemented")}static fromJSON(t){if(!t)return null;if(t.declaredClass)throw new Error("JSON object is already hydrated");return new h({sourceJSON:t})}_getHelperService(t){let s=this.helperServices&&this.helperServices[t];if(!s)throw new S("portal:service-not-found",`The \`helperServices\` do not include an entry named "${t}"`);return s}_fetchBasemaps(t,s){return c(this,null,function*(){let a=new v;a.query=t||(this.hasAPIKey?this.devBasemapGalleryGroupQuery:this.useVectorBasemaps?this.vectorBasemapGalleryGroupQuery:this.basemapGalleryGroupQuery),a.disableExtraQuery=!0;let i=yield this.queryGroups(a,s);if(!i.total)return[];let l=i.results[0];a.num=100,a.query='type:"Web Map" -type:"Web Application"',a.sortField=l.sortField||"name",a.sortOrder=l.sortOrder||"desc";let u=yield l.queryItems(a,s);return u.total?u.results.filter(p=>p.type==="Web Map").map(p=>new P({portalItem:p})):[]})}_fetchBasemaps3D(t,s){return c(this,null,function*(){let a=t||this.basemapGalleryGroupQuery3D;if(!a)return[];if(this.hasAPIKey)return[];let i=new v({query:a,disableExtraQuery:!0}),l=yield this.queryGroups(i,s);if(!l.total)return[];let u=l.results[0];i.num=100,i.query='type:"Web Scene"',i.sortField=u.sortField||"name",i.sortOrder=u.sortOrder||"desc";let p=yield u.queryItems(i,s);return p.total?p.results.filter(n=>n.type==="Web Scene").map(n=>new P({portalItem:n})):[]})}_normalizeSSL(t){return t.replace(/^http:/i,"https:").replace(":7080",":7443")}_readBasemap(t){if(t){let s=P.fromJSON(t);return s.portalItem={portal:this},s}return null}static _resultsToTypedArray(t,s,a,i){let l;if(a){let u=i!=null?i.signal:null;l=a.listings||a.notifications||a.userInvitations||a.tags||a.items||a.groups||a.comments||a.provisions||a.results||a.relatedItems||a,(t||s)&&(l=l.map(p=>{let n=Object.assign(t?t.fromJSON(p):p,s);return typeof n.load=="function"&&n.load(u),n}))}else l=[];return l}};e.AUTH_MODE_ANONYMOUS="anonymous",e.AUTH_MODE_AUTO="auto",e.AUTH_MODE_IMMEDIATE="immediate",e.AUTH_MODE_NO_PROMPT="no-prompt",r([o()],e.prototype,"access",void 0),r([o()],e.prototype,"allSSL",void 0),r([o()],e.prototype,"authMode",void 0),r([o()],e.prototype,"authorizedCrossOriginDomains",void 0),r([f("authorizedCrossOriginDomains")],e.prototype,"readAuthorizedCrossOriginDomains",null),r([o()],e.prototype,"basemapGalleryGroupQuery",void 0),r([o({json:{name:"3DBasemapGalleryGroupQuery"}})],e.prototype,"basemapGalleryGroupQuery3D",void 0),r([o()],e.prototype,"bingKey",void 0),r([o()],e.prototype,"canListApps",void 0),r([o()],e.prototype,"canListData",void 0),r([o()],e.prototype,"canListPreProvisionedItems",void 0),r([o()],e.prototype,"canProvisionDirectPurchase",void 0),r([o()],e.prototype,"canSearchPublic",void 0),r([o()],e.prototype,"canShareBingPublic",void 0),r([o()],e.prototype,"canSharePublic",void 0),r([o()],e.prototype,"canSignInArcGIS",void 0),r([o()],e.prototype,"canSignInIDP",void 0),r([o()],e.prototype,"colorSetsGroupQuery",void 0),r([o()],e.prototype,"commentsEnabled",void 0),r([o({type:Date})],e.prototype,"created",void 0),r([o()],e.prototype,"credential",void 0),r([o()],e.prototype,"culture",void 0),r([o()],e.prototype,"currentVersion",void 0),r([o()],e.prototype,"customBaseUrl",void 0),r([o()],e.prototype,"default3DBasemapQuery",void 0),r([o()],e.prototype,"defaultBasemap",void 0),r([f("defaultBasemap")],e.prototype,"readDefaultBasemap",null),r([o()],e.prototype,"defaultDevBasemap",void 0),r([f("defaultDevBasemap")],e.prototype,"readDefaultDevBasemap",null),r([o({type:H})],e.prototype,"defaultExtent",void 0),r([o()],e.prototype,"defaultVectorBasemap",void 0),r([f("defaultVectorBasemap")],e.prototype,"readDefaultVectorBasemap",null),r([o()],e.prototype,"description",void 0),r([o()],e.prototype,"devBasemapGalleryGroupQuery",void 0),r([o()],e.prototype,"eueiEnabled",void 0),r([o({readOnly:!0})],e.prototype,"extraQuery",null),r([o()],e.prototype,"featuredGroups",void 0),r([o()],e.prototype,"featuredItemsGroupQuery",void 0),r([o()],e.prototype,"galleryTemplatesGroupQuery",void 0),r([o()],e.prototype,"layoutGroupQuery",void 0),r([o()],e.prototype,"livingAtlasGroupQuery",void 0),r([o({readOnly:!0})],e.prototype,"hasAPIKey",null),r([o()],e.prototype,"hasCategorySchema",void 0),r([o()],e.prototype,"hasClassificationSchema",void 0),r([o()],e.prototype,"helpBase",void 0),r([o()],e.prototype,"helperServices",void 0),r([o()],e.prototype,"helpMap",void 0),r([o()],e.prototype,"homePageFeaturedContent",void 0),r([o()],e.prototype,"homePageFeaturedContentCount",void 0),r([o()],e.prototype,"httpPort",void 0),r([o()],e.prototype,"httpsPort",void 0),r([o()],e.prototype,"id",void 0),r([o()],e.prototype,"ipCntryCode",void 0),r([o({readOnly:!0})],e.prototype,"isOrganization",null),r([o()],e.prototype,"isPortal",void 0),r([o()],e.prototype,"isReadOnly",void 0),r([o({readOnly:!0})],e.prototype,"itemPageUrl",null),r([o()],e.prototype,"layerTemplatesGroupQuery",void 0),r([o()],e.prototype,"maxTokenExpirationMinutes",void 0),r([o({type:Date})],e.prototype,"modified",void 0),r([o()],e.prototype,"name",void 0),r([o()],e.prototype,"portalHostname",void 0),r([o()],e.prototype,"portalMode",void 0),r([o()],e.prototype,"portalProperties",void 0),r([o()],e.prototype,"region",void 0),r([o()],e.prototype,"recycleBinEnabled",void 0),r([o({readOnly:!0})],e.prototype,"restUrl",null),r([o()],e.prototype,"rotatorPanels",void 0),r([o()],e.prototype,"showHomePageDescription",void 0),r([o()],e.prototype,"sourceJSON",void 0),r([o()],e.prototype,"staticImagesUrl",void 0),r([o({json:{name:"2DStylesGroupQuery"}})],e.prototype,"stylesGroupQuery2d",void 0),r([o({json:{name:"stylesGroupQuery"}})],e.prototype,"stylesGroupQuery3d",void 0),r([o()],e.prototype,"supportsHostedServices",void 0),r([o()],e.prototype,"symbolSetsGroupQuery",void 0),r([o()],e.prototype,"templatesGroupQuery",void 0),r([o()],e.prototype,"thumbnail",void 0),r([o({readOnly:!0})],e.prototype,"thumbnailUrl",null),r([o()],e.prototype,"units",void 0),r([o()],e.prototype,"url",void 0),r([o()],e.prototype,"urlKey",void 0),r([f("urlKey")],e.prototype,"readUrlKey",null),r([o()],e.prototype,"user",void 0),r([f("user")],e.prototype,"readUser",null),r([o()],e.prototype,"use3dBasemaps",void 0),r([o()],e.prototype,"useDefault3dBasemap",void 0),r([o()],e.prototype,"useStandardizedQuery",void 0),r([o()],e.prototype,"useVectorBasemaps",void 0),r([o()],e.prototype,"vectorBasemapGalleryGroupQuery",void 0),e=h=r([A("esri.portal.Portal")],e);var ft=e,K=new FinalizationRegistry(t=>{t.remove()});function R(t){let s=m;return()=>{let a=t.deref();a&&s.findCredential(a.restUrl)&&a.signIn().catch(()=>{})}}export{ft as a};
