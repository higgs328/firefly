import{a as l}from"./chunk-VANM5A4M.js";import{a as c}from"./chunk-3KOZOOEP.js";import{w as a,y as o}from"./chunk-HM5RIVQC.js";import{a as n}from"./chunk-P6QFA5MM.js";import{f as i}from"./chunk-4PTIEWMT.js";function u(r){return r?.attachment.type===l.Texture}var s=class{constructor(t,e){this.key=t,this.free=e,this.incarnation=0,this._refCount=1}retain(t=1){this._refCount+=t}release(){return this._refCount===0?(console.log(`Releasing already released FBO attachment "${this.name}" in ${new Error().stack}`),!0):(--this._refCount,this._refCount===0&&(this.free(),!0))}},h;(function(r){r[r.FBO=0]="FBO",r[r.DEPTH=1]="DEPTH",r[r.COLOR=2]="COLOR"})(h||(h={}));var p=class extends s{constructor(t,e,m,d,f,_){super(t,_),this.type=h.FBO,this._colors=new Map,this._name=c.COMPOSITE,this.acquireDepth=null,this.acquireColor=null,this._name=e,this.fbo=m,this.acquireDepth=d,this.acquireColor=f}dispose(){this.fbo?.dispose()}get cachedMemory(){return this.fbo?.usedMemory||0}get numberOfColorAttachments(){return this._colors.size}get name(){return this._name}setName(t){this._name=t}getTexture(t=a.COLOR_ATTACHMENT0){return t===o?this.fbo?.depthStencilTexture:this.fbo?.getColorTexture(t)}getAttachment(t=a.COLOR_ATTACHMENT0){return t===o?this._depth:this._colors.get(t)}hasAttachment(t){return n(this._colors,e=>e.name===t)}attachDepth(t){return t?.retain(),this.detachDepth(),t&&this.fbo?.attachDepthStencil(t.attachment),this._depth=t,this}detachDepth(){this.fbo?.detachDepthStencilTexture(),this.fbo?.detachDepthStencilBuffer(),this._depth=i(this._depth)}obtainDepthTexture(){let t=this._depth;return u(t)?(this.fbo?.detachDepthStencilTexture(),this._depth=null,t):null}attachColor(t,e){return t.retain(),this.detachColor(e),this.fbo?.attachColorTexture(t.attachment,e),this._colors.set(e,t),this}detachColor(t){this.fbo?.detachColorTexture(t);let e=this._colors.get(t);this._colors.delete(t),e?.release()}detachAll(){this._colors.forEach((t,e)=>this.detachColor(e)),this.detachDepth()}};export{s as a,h as b,p as c};
