import{d as Z}from"./chunk-IHATPE6U.js";import{aa as g,ba as w,ca as S}from"./chunk-KALOJIUA.js";import{b as $}from"./chunk-KMMTNF7G.js";import{c as m,d as f,e as D,f as v,g as F}from"./chunk-K5T5FD5C.js";import{c,h}from"./chunk-MVHHPJM7.js";import{a as l,b as d,f as T}from"./chunk-VTHXE323.js";var L=",",k={light:["streets","gray","topo","terrain","oceans","osm","gray-vector","streets-vector","topo-vector","streets-relief-vector","streets-navigation-vector","topo-3d","navigation-3d","streets-3d","osm-3d","gray-3d"],dark:["satellite","hybrid","dark-gray","dark-gray-vector","streets-night-vector","navigation-dark-3d","streets-dark-3d","dark-gray-3d"]},C="percent-of-total",N="field",q={exclude:["median"]},O={years:365,months:30,days:1,hours:1/24,minutes:1/1440,seconds:1/86400,milliseconds:1/864e5},M=new Set(["integer","small-integer"]),p=null,G=["date","date-only","timestamp-offset"];function H(e){return g(e)||w(e)||S(e)}function Q(e){return T(this,null,function*(){let{field:t,field2:n,field3:o,normalizationField:i,valueExpression:s}=e,a=[];if(s){if(!p){let{arcadeUtils:r}=yield $();p=r}a=p.extractFieldNames(s)}return t&&a.push(t),n&&a.push(n),o&&a.push(o),i&&a.push(i),a})}function W(e){let t=e.normalizationType;return t||(e.normalizationField?t=N:e.normalizationTotal!=null&&(t=C)),t??void 0}function u(e){return String(e).padStart(2,"0")}function I(e,t,n){let o;return t==="date"||t==="number"?(t==="number"&&(e=new Date(e)),o=`TIMESTAMP'${n?e.getFullYear():e.getUTCFullYear()}-${u((n?e.getMonth():e.getUTCMonth())+1)}-${u(n?e.getDate():e.getUTCDate())} ${u(n?e.getHours():e.getUTCHours())}:${u(n?e.getMinutes():e.getUTCMinutes())}:${u(n?e.getSeconds():e.getUTCSeconds())}'`):o=e,o}function Y(e,t,n,o){let{hasQueryEngine:i}=e,s=`(${I(n,U(e,n),i)} - ${I(t,U(e,t),i)})`,a=O[o],r="/";return a<1&&(a=1/a,r="*"),{sqlExpression:a===1?s:`(${s} ${r} ${a})`,sqlWhere:null}}function U(e,t){if(t instanceof Date)return"date";if(typeof t=="number")return"number";if(typeof t=="string"){let n=e.getField(t);if(t.toLowerCase()==="<now>")return;if(g(n))return"field"}}function j(e,t=k){for(let n in t)if(t[n].includes(e))return n}function K(e,t,n=!0){let o=null;return e&&(typeof e=="string"?t.includes(e)&&(o=e):o=Z(e)),n?o||"gray":o}function P(e,t){let n=t&&e.getField(t);return!!n&&M.has(n.type)}function V(e){return`cast(${e} as float)`}function J(e,t){let{format:n,timeZoneOptions:o,fieldType:i}=t??{},s,a;if(o&&({timeZone:s,timeZoneName:a}=h(o.layerTimeZone,o.datesInUnknownTimezone,o.viewTimeZone,m(n||"short-date-short-time"),i)),typeof e=="string"&&isNaN(Date.parse(i==="time-only"?`1970-01-01T${e}Z`:e)))return e;switch(i){case"date-only":{let r=m(n||"short-date");return typeof e=="string"?D(e,l({},r)):f(e,d(l({},r),{timeZone:c}))}case"time-only":{let r=m(n||"short-time");return typeof e=="string"?v(e,r):f(e,d(l({},r),{timeZone:c}))}case"timestamp-offset":{if(!s&&typeof e=="string"&&new Date(e).toISOString()!==e)return e;let r=n||o?m(n||"short-date-short-time"):void 0,y=r?d(l({},r),{timeZone:s,timeZoneName:a}):void 0;return typeof e=="string"?F(e,y):f(e,y)}default:{let r=n||o?m(n||"short-date-short-time"):void 0;return f(typeof e=="string"?new Date(e):e,r?d(l({},r),{timeZone:s,timeZoneName:a}):void 0)}}}export{L as a,k as b,q as c,O as d,G as e,H as f,Q as g,W as h,Y as i,U as j,j as k,K as l,P as m,V as n,J as o};
