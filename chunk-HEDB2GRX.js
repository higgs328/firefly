import{a as O}from"./chunk-DYMCH2EU.js";import{a as L}from"./chunk-7P7BNAFN.js";import{a as we,b as F}from"./chunk-U4HXP5OD.js";import{a as be}from"./chunk-2672JUUN.js";import"./chunk-P6M7OD5Q.js";import"./chunk-OPZW6OUW.js";import"./chunk-CY5RTAXH.js";import"./chunk-P4X6P2DH.js";import{a as T}from"./chunk-DXZ6STWE.js";import{a as he}from"./chunk-YWQWDK7Q.js";import"./chunk-3MBKXCQY.js";import"./chunk-ZC4HSGVU.js";import"./chunk-DRTQ5SFX.js";import"./chunk-FSQK4GJN.js";import{a as R}from"./chunk-KXAPDSBF.js";import{a as A}from"./chunk-JA6HTTGU.js";import{a as _}from"./chunk-UJN4N3I3.js";import{a as M}from"./chunk-Z4LAB2EF.js";import"./chunk-BHVWRAIX.js";import{d as de}from"./chunk-I4TW3U2S.js";import"./chunk-V7WSVLSI.js";import"./chunk-J35QCC4O.js";import"./chunk-JIYTUBB7.js";import"./chunk-QUZEX4CN.js";import"./chunk-6KWLTABS.js";import"./chunk-ITDLEL4J.js";import{a as fe}from"./chunk-GGYZRKBV.js";import{a as me}from"./chunk-37PSR6DC.js";import{a as ye}from"./chunk-FQTXYWH5.js";import"./chunk-KLXERNY4.js";import{a as re}from"./chunk-H25DKJGS.js";import{g as ce}from"./chunk-6DALCDDU.js";import"./chunk-PBAMEKFE.js";import"./chunk-XIZ7IH6M.js";import"./chunk-JD66UCS7.js";import"./chunk-FU7RO3AR.js";import"./chunk-4YRY3D3A.js";import"./chunk-ZZ5UYT7M.js";import"./chunk-U4XVPHQU.js";import{b as pe}from"./chunk-KLZGQ7M6.js";import"./chunk-N36GL6VL.js";import"./chunk-UX3QUEDM.js";import"./chunk-YZJDOXQC.js";import"./chunk-6ZY36ZHO.js";import"./chunk-6RHGQ4Z5.js";import"./chunk-G23ELQMS.js";import"./chunk-PZOK2JKH.js";import"./chunk-FJUYECJ6.js";import"./chunk-GAVFKWSK.js";import"./chunk-DK4DGLAO.js";import"./chunk-7Y6S2GNA.js";import"./chunk-VOB6IBIW.js";import"./chunk-63B3IOWG.js";import"./chunk-PE276TWH.js";import"./chunk-BMZ3PE5Y.js";import"./chunk-EHG7JRYJ.js";import"./chunk-FNY6LFKI.js";import"./chunk-J2AEVBSH.js";import"./chunk-5ODXFRPI.js";import"./chunk-E5QCV5LT.js";import"./chunk-QS3EYJPF.js";import"./chunk-HJJZ2AXH.js";import"./chunk-TPNSUEHH.js";import"./chunk-SMVNQSZ4.js";import"./chunk-Z2QGLRDB.js";import"./chunk-7IDFDPA3.js";import"./chunk-VL2YL74P.js";import"./chunk-P2AJD2R2.js";import"./chunk-UMJIJLDA.js";import"./chunk-E5NFS3KN.js";import"./chunk-HQHD6BMN.js";import"./chunk-AIKKGGPG.js";import"./chunk-RDGG4TVD.js";import"./chunk-3IQFPOUU.js";import"./chunk-I4CY6X6S.js";import"./chunk-VQ4QGNRX.js";import"./chunk-4KXJ537H.js";import"./chunk-JIRULGDT.js";import"./chunk-QJGOWIJD.js";import"./chunk-QML26MQC.js";import"./chunk-RNZY2XUD.js";import"./chunk-JXPUHKCT.js";import"./chunk-XR5FT7TQ.js";import"./chunk-4YTM754S.js";import{a as ue}from"./chunk-LAX5536Z.js";import"./chunk-N3HRYLNW.js";import"./chunk-4DBMALZW.js";import"./chunk-CVWWHM2V.js";import"./chunk-6OQYVEQJ.js";import"./chunk-YOXOWGT6.js";import"./chunk-EFZOSMYP.js";import"./chunk-WI7F4ZKJ.js";import"./chunk-MJ7M24NH.js";import"./chunk-GJH4QFRX.js";import"./chunk-T63F7663.js";import"./chunk-O4V2VBSK.js";import"./chunk-5TKRKB5E.js";import"./chunk-XAGMDNNR.js";import"./chunk-OP2TLIUN.js";import"./chunk-T2THIR6K.js";import"./chunk-LORHDXEB.js";import"./chunk-BBBPJI4H.js";import"./chunk-45BTW5EG.js";import"./chunk-TPFBHGDM.js";import"./chunk-73NLRHJD.js";import"./chunk-PNFEUBDF.js";import"./chunk-6RCCEJDL.js";import"./chunk-PQ2TNDUX.js";import"./chunk-6X6MKRQ3.js";import"./chunk-FQFHMHYU.js";import"./chunk-SZMEI3WL.js";import"./chunk-KKVGD67U.js";import"./chunk-MYOJWRDU.js";import"./chunk-L7UKJKHG.js";import"./chunk-V2IENAEU.js";import"./chunk-QAGQFNF2.js";import"./chunk-SY7JS2VW.js";import"./chunk-WK57SDN6.js";import"./chunk-AG4V3ZUO.js";import"./chunk-YWLMJ26A.js";import"./chunk-QAWNU3UJ.js";import"./chunk-HRQT4R6X.js";import"./chunk-44BHLWQ4.js";import"./chunk-5BPM64SU.js";import"./chunk-PMVHHMQJ.js";import"./chunk-NAFOM5UA.js";import{a as le}from"./chunk-DO7UF2F2.js";import"./chunk-ZTR6OS44.js";import"./chunk-VRTKAD2J.js";import"./chunk-DBLKLHK2.js";import"./chunk-UTE3ASAZ.js";import"./chunk-2AFEAPEX.js";import"./chunk-GNGXUEWV.js";import"./chunk-QBI5NDCA.js";import"./chunk-NOHW2DKR.js";import"./chunk-HVJAAM3A.js";import"./chunk-ACPEJEHK.js";import"./chunk-I7B3LWNP.js";import"./chunk-YP2E5N4E.js";import"./chunk-QLMNLSCT.js";import"./chunk-P55G5ATK.js";import"./chunk-JT3K52KQ.js";import"./chunk-SPLEGG4R.js";import"./chunk-Y4TJDUGP.js";import"./chunk-6PAFOJ4W.js";import"./chunk-74SDGE57.js";import"./chunk-FRXWHX3T.js";import"./chunk-DTDQ5X42.js";import"./chunk-RX2HFR4X.js";import"./chunk-AZW7YPTQ.js";import"./chunk-NJLJX4X6.js";import"./chunk-DZHFTD24.js";import"./chunk-K57Z4J34.js";import"./chunk-VWG3KVOU.js";import"./chunk-JOEUVLAN.js";import"./chunk-JZQDGIDQ.js";import"./chunk-CZ6CGC7I.js";import"./chunk-7B6U3N62.js";import"./chunk-46WDO5LS.js";import"./chunk-G5EYK5KM.js";import"./chunk-YJKJQU3F.js";import"./chunk-OK4K3OQT.js";import"./chunk-BPWNCOXC.js";import"./chunk-VNS4CQ27.js";import"./chunk-AVMO6LCR.js";import"./chunk-TEGPMVWT.js";import"./chunk-CLQRQC3Y.js";import"./chunk-KSNU73LO.js";import"./chunk-FACEVGRE.js";import"./chunk-5XTCPT52.js";import"./chunk-TC77DYTW.js";import"./chunk-F2BQ2GD6.js";import"./chunk-R3XLNYYB.js";import"./chunk-BMYVPMAK.js";import"./chunk-6F25LG6O.js";import"./chunk-6KRFVLII.js";import"./chunk-GJ2QRXGN.js";import"./chunk-NX5B6XBR.js";import"./chunk-2JABY6DU.js";import"./chunk-MPRKSQLC.js";import"./chunk-57TARQ4F.js";import"./chunk-6RBQSBA2.js";import"./chunk-3JGYBNJA.js";import{g as ne,s as ae}from"./chunk-DA3SDKGO.js";import"./chunk-ZOEPYNM4.js";import"./chunk-57VFBGF3.js";import"./chunk-GWBRHLNH.js";import"./chunk-BJH4F4SM.js";import"./chunk-Z3RBZHAK.js";import"./chunk-73K3NWCV.js";import"./chunk-PTZYZULI.js";import"./chunk-NMLYCCKN.js";import"./chunk-ZC6EBRE4.js";import"./chunk-ZAZJB7CV.js";import"./chunk-KALOJIUA.js";import"./chunk-KMMTNF7G.js";import"./chunk-E7AX56GD.js";import"./chunk-IDVLLREH.js";import"./chunk-DWLSVYOY.js";import"./chunk-PQGCNP5H.js";import"./chunk-UASS7NJI.js";import"./chunk-WZRAC35O.js";import"./chunk-KUYAWYSS.js";import"./chunk-MIS6QMFE.js";import{a as se}from"./chunk-MDZTV2VL.js";import"./chunk-RNC4P66O.js";import"./chunk-7LHOQXZT.js";import"./chunk-BCREO4Q5.js";import"./chunk-U4QEPZJ3.js";import"./chunk-KJUZWSCL.js";import"./chunk-3WO6D7MU.js";import"./chunk-BUZ3SPLE.js";import{c as oe}from"./chunk-7QNKS2X6.js";import{a as ie}from"./chunk-VCCMJ6BV.js";import{a as ge}from"./chunk-QK56OQGR.js";import"./chunk-FXCL7YYQ.js";import"./chunk-QKO56XO6.js";import"./chunk-JRGT3GTH.js";import"./chunk-K75TK42V.js";import"./chunk-CELWVZPW.js";import"./chunk-VV5G7VY5.js";import"./chunk-OLOKUDVI.js";import"./chunk-DYTVXYAV.js";import"./chunk-ZTOZWLEE.js";import"./chunk-RJWOVI3M.js";import"./chunk-RSDQHAJX.js";import"./chunk-BOVYXYHK.js";import"./chunk-KVM6SHDX.js";import"./chunk-POX73EYJ.js";import"./chunk-NKUXRYJG.js";import"./chunk-HX2VGIR2.js";import"./chunk-ERDKAICI.js";import"./chunk-EQZWYK27.js";import"./chunk-JLPLCY2B.js";import{a as te}from"./chunk-2GJBUR2F.js";import{a as Se}from"./chunk-DKGGDYJI.js";import"./chunk-5LA3PVK5.js";import"./chunk-IR6XCBC4.js";import"./chunk-C6JPAW54.js";import"./chunk-WD3OPXCN.js";import"./chunk-FA3WGIU4.js";import"./chunk-WWVPA6PE.js";import"./chunk-YPMM52MU.js";import"./chunk-BBR7CJCO.js";import{m as ee}from"./chunk-ZQIC5NFT.js";import"./chunk-VIEK2X23.js";import"./chunk-XKIFGPJO.js";import{a as B}from"./chunk-PEW2PLAN.js";import"./chunk-Q6Y4JG7Q.js";import{a as N}from"./chunk-7F5DJLJT.js";import{a as Q}from"./chunk-CX5IFQZJ.js";import{L as $,u as j}from"./chunk-NJWTSROP.js";import"./chunk-D3R25AF2.js";import"./chunk-ARRCN5K3.js";import"./chunk-4N4D2YQX.js";import"./chunk-G4DZJMGT.js";import"./chunk-K5T5FD5C.js";import"./chunk-MVHHPJM7.js";import"./chunk-VDO6JJ3Y.js";import"./chunk-WFKZLI6F.js";import"./chunk-X2B63YVS.js";import"./chunk-BAEF3CT6.js";import{g as X}from"./chunk-AUAZP44J.js";import"./chunk-PVDFCTA4.js";import"./chunk-KNVXE32P.js";import{k as Z}from"./chunk-76ATOSLU.js";import"./chunk-CCJU4DSH.js";import{c as H}from"./chunk-TG45K3WR.js";import"./chunk-RAI4DTMT.js";import{b}from"./chunk-ACP3S2CH.js";import"./chunk-HVAXZ2NA.js";import"./chunk-T7DXJKX7.js";import"./chunk-TYYVNQUR.js";import{a as l}from"./chunk-QGVBCWUY.js";import"./chunk-MYO4NP2N.js";import{e as f}from"./chunk-NFIPKH6V.js";import"./chunk-JPU2PQZC.js";import{l as Y}from"./chunk-5QEXLALV.js";import"./chunk-P6QFA5MM.js";import"./chunk-DGTD7Y73.js";import"./chunk-LI2SX4T6.js";import"./chunk-BWO7LS2H.js";import"./chunk-HEVQSRJ2.js";import"./chunk-OVHPPCBL.js";import"./chunk-SNFOAZZQ.js";import"./chunk-AML4XSEF.js";import{y as K}from"./chunk-4PTIEWMT.js";import"./chunk-TG2UTNEO.js";import{b as v}from"./chunk-YOFFGXOB.js";import{g as z}from"./chunk-XRGPJ3QY.js";import{c as V,e as J}from"./chunk-6MRUJ2UW.js";import"./chunk-2LI2GKBQ.js";import"./chunk-QBWJMFH5.js";import{f as C}from"./chunk-VTHXE323.js";function k(t){if(!t.length)return;let o=t.toArray(),e=o.map(({objectId:i})=>i).filter(i=>i!=null),r=Math.max(...e,0);for(let i of o)i.objectId==null&&(i.objectId=++r)}function x(t,o){return!!t.length&&t.length===o.length&&ve(t)&&ve(o)}function ve(t){return t.every(({objectId:o})=>o!=null)}function E(t){return t.length?t:null}function q(t){switch(t){case"esriGeometryPoint":return{type:"esriSMS",style:"esriSMSCircle",size:12,color:[0,0,0,0],outline:q("esriGeometryPolyline")};case"esriGeometryPolyline":return{type:"esriSLS",style:"esriSLSSolid",width:1,color:[0,0,0,0]};case"esriGeometryPolygon":return{type:"esriSFS",style:"esriSFSNull",outline:q("esriGeometryPolyline")}}}function G(t){return"layers"in t}function Fe(t){return t.declaredClass==="esri.rest.support.FeatureSet"}function ke(t){return t.declaredClass==="esri.rest.support.NetworkFeatureSet"}function xe(t,o,e){let r=o.networkDataset?.networkAttributes,i=r?.filter(({usageType:s})=>s==="cost")??[],p=e.travelMode??o.defaultTravelMode;if(p==null)return void _e().warn("route-layer:missing-travel-mode","The routing service must have a default travel mode or one must be specified in the route parameter.");let{timeAttributeName:u,distanceAttributeName:m}=p,h=i.find(({name:s})=>s===u),g=i.find(({name:s})=>s===m),n=e.travelMode?.impedanceAttributeName??e.impedanceAttribute??o.impedance,c=h?.units,y=g?.units;if(!c||!y)throw new v("routelayer:unknown-impedance-units","the units of either the distance or time impedance are unknown");let P=e.directionsLanguage??o.directionsLanguage,I=e.accumulateAttributes??o.accumulateAttributeNames??[],S=new Set(i.filter(({name:s})=>s===u||s===m||s===n||s!=null&&I.includes(s)).map(({name:s})=>s)),d=s=>{for(let U in s)S.has(U)||delete s[U]};for(let s of t.pointBarriers)s.costs!=null&&(s.addedCost=s.costs[n]??0,d(s.costs));for(let s of t.polygonBarriers)s.costs!=null&&(s.scaleFactor=s.costs[n]??1,d(s.costs));for(let s of t.polylineBarriers)s.costs!=null&&(s.scaleFactor=s.costs[n]??1,d(s.costs));let{routeInfo:w}=t,{findBestSequence:Oe,preserveFirstStop:Le,preserveLastStop:Te,startTimeIsUTC:Re,timeWindowsAreUTC:Ae}=e;w.analysisSettings=new we({accumulateAttributes:I,directionsLanguage:P,findBestSequence:Oe,preserveFirstStop:Le,preserveLastStop:Te,startTimeIsUTC:Re,timeWindowsAreUTC:Ae,travelMode:p}),w.totalDuration=D(w.totalCosts?.[u]??0,c),w.totalDistance=W(w.totalCosts?.[m]??0,y),w.totalLateDuration=D(w.totalViolations?.[u]??0,c),w.totalWaitDuration=D(w.totalWait?.[u]??0,c),w.totalCosts!=null&&d(w.totalCosts),w.totalViolations!=null&&d(w.totalViolations),w.totalWait!=null&&d(w.totalWait);for(let s of t.stops)s.serviceCosts!=null&&(s.serviceDuration=D(s.serviceCosts[u]??0,c),s.serviceDistance=W(s.serviceCosts[m]??0,y),d(s.serviceCosts)),s.cumulativeCosts!=null&&(s.cumulativeDuration=D(s.cumulativeCosts[u]??0,c),s.cumulativeDistance=W(s.cumulativeCosts[m]??0,y),d(s.cumulativeCosts)),s.violations!=null&&(s.lateDuration=D(s.violations[u]??0,c),d(s.violations)),s.wait!=null&&(s.waitDuration=D(s.wait[u]??0,c),d(s.wait))}function Ge(t,o){for(let e of t){let r=o.find(i=>i.objectId===e.objectId);r&&(r.addedCost=e.addedCost,r.barrierType=e.barrierType,r.costs=e.costs,r.curbApproach=e.curbApproach,r.fullEdge=e.fullEdge,r.geometry=e.geometry,r.name=e.name,r.sideOfEdge=e.sideOfEdge,r.sourceId=e.sourceId,r.sourceOid=e.sourceOid,r.status=e.status,r.symbol=e.symbol)}}function Je(t,o){for(let e of t){let r=o.find(i=>i.objectId===e.objectId);r&&(r.barrierType=e.barrierType,r.costs=e.costs,r.geometry=e.geometry,r.name=e.name,r.scaleFactor=e.scaleFactor,r.symbol=e.symbol)}}function je(t,o){for(let e of t){let r=o.find(i=>i.objectId===e.objectId);r&&(r.barrierType=e.barrierType,r.costs=e.costs,r.geometry=e.geometry,r.name=e.name,r.scaleFactor=e.scaleFactor,r.symbol=e.symbol)}}function Me(t,o){for(let e of t){let r=o.find(i=>i.objectId===e.objectId);r&&(r.arriveCurbApproach=e.arriveCurbApproach,r.arriveTime=e.arriveTime,r.arriveTimeOffset=e.arriveTimeOffset,r.cumulativeCosts=e.cumulativeCosts,r.cumulativeDistance=e.cumulativeDistance,r.cumulativeDuration=e.cumulativeDuration,r.curbApproach=e.curbApproach,r.departCurbApproach=e.departCurbApproach,r.departTime=e.departTime,r.departTimeOffset=e.departTimeOffset,r.distanceToNetworkInMeters=e.distanceToNetworkInMeters,r.geometry=e.geometry,r.lateDuration=e.lateDuration,r.name=e.name,r.navLatency=e.navLatency,r.posAlong=e.posAlong,r.routeName=e.routeName,r.serviceCosts=e.serviceCosts,r.serviceDistance=e.serviceDistance,r.serviceDuration=e.serviceDuration,r.sequence=e.sequence,r.sideOfEdge=e.sideOfEdge,r.snapX=e.snapX,r.snapY=e.snapY,r.snapZ=e.snapZ,r.sourceId=e.sourceId,r.sourceOid=e.sourceOid,r.status=e.status,r.symbol=e.symbol,r.timeWindowEnd=e.timeWindowEnd,r.timeWindowStart=e.timeWindowStart,r.violations=e.violations,r.waitDuration=e.waitDuration,r.wait=e.wait)}}function Be(t){return C(this,null,function*(){let o=N.WGS84;return yield ae(t.spatialReference,o),ne(t,o)})}function D(t,o){switch(o){case"seconds":return t/60;case"hours":return 60*t;case"days":return 60*t*24;default:return t}}function W(t,o){return o==="decimal-degrees"||o==="points"||o==="unknown"?t:$(t,o,"meters")}function Ee(t){let{attributes:o,geometry:e,popupTemplate:r,symbol:i}=t.toGraphic().toJSON();return{attributes:o,geometry:e,popupInfo:r,symbol:i}}var We=b.ofType(R),qe=b.ofType(A),Ie=b.ofType(_),Ne=b.ofType(O),Pe=b.ofType(L),De=b.ofType(T),Ce="esri.layers.RouteLayer",_e=()=>z.getLogger(Ce),a=class extends oe(ie(fe(me(re(ge))))){constructor(t){super(t),this._cachedServiceDescription=null,this._featureCollection=null,this._type="Feature Collection",this.checksum=null,this.defaultSymbols=new M,this.directionLines=null,this.directionPoints=null,this.featureCollectionType="route",this.legendEnabled=!1,this.maxScale=0,this.minScale=0,this.pointBarriers=new Ie,this.polygonBarriers=new Ne,this.polylineBarriers=new Pe,this.routeInfo=null,this.spatialReference=N.WGS84,this.stops=new De,this.type="route";let o=()=>{this._setStopSymbol(this.stops)};this.addHandles(H(()=>this.stops,"change",o,{sync:!0,onListenerAdd:o}))}writeFeatureCollectionWebmap(t,o,e,r){let i=[this._writePolygonBarriers(),this._writePolylineBarriers(),this._writePointBarriers(),this._writeRouteInfo(),this._writeDirectionLines(),this._writeDirectionPoints(),this._writeStops()].filter(m=>!!m),p=i.map((m,h)=>h),u=r.origin==="web-map"?"featureCollection.layers":"layers";V(u,i,o),o.opacity=this.opacity,o.visibility=this.visible,o.visibleLayers=p}readDirectionLines(t,o){return this._getNetworkFeatures(o,"DirectionLines",e=>R.fromGraphic(e))}readDirectionPoints(t,o){return this._getNetworkFeatures(o,"DirectionPoints",e=>A.fromGraphic(e))}get fullExtent(){let t=new ee({xmin:-180,ymin:-90,xmax:180,ymax:90,spatialReference:N.WGS84});if(this.routeInfo?.geometry!=null)return this.routeInfo.geometry.extent??t;if(this.stops==null)return t;let o=this.stops.filter(i=>i.geometry!=null);if(o.length<2)return t;let{spatialReference:e}=o.at(0).geometry;if(e==null)return t;let r=o.toArray().map(i=>{let p=i.geometry;return[p.x,p.y]});return new se({points:r,spatialReference:e}).extent}readMaxScale(t,o){return(G(o)?o.layers:o.featureCollection?.layers)?.find(i=>i.layerDefinition.maxScale!=null)?.layerDefinition.maxScale??0}readMinScale(t,o){return(G(o)?o.layers:o.featureCollection?.layers)?.find(i=>i.layerDefinition.minScale!=null)?.layerDefinition.minScale??0}readPointBarriers(t,o){return this._getNetworkFeatures(o,"Barriers",e=>_.fromGraphic(e))}readPolygonBarriers(t,o){return this._getNetworkFeatures(o,"PolygonBarriers",e=>O.fromGraphic(e))}readPolylineBarriers(t,o){return this._getNetworkFeatures(o,"PolylineBarriers",e=>L.fromGraphic(e))}readRouteInfo(t,o){return this._getNetworkFeatures(o,"RouteInfo",e=>F.fromGraphic(e)).at(0)??null}readSpatialReference(t,o){let e=G(o)?o.layers:o.featureCollection?.layers;if(!e?.length)return N.WGS84;let{layerDefinition:r,featureSet:i}=e[0],p=i.features[0],u=p?.geometry?.spatialReference??i.spatialReference??r.spatialReference??r.extent.spatialReference??j;return N.fromJSON(u)}readStops(t,o){return this._getNetworkFeatures(o,"Stops",e=>T.fromGraphic(e),e=>this._setStopSymbol(e))}get title(){return this.routeInfo?.name??"Route"}set title(t){this._overrideIfSome("title",t)}get url(){return J.routeServiceUrl}set url(t){t!=null?this._set("url",X(t,_e())):this._set("url",J.routeServiceUrl)}load(t){return this.addResolvingPromise(this.loadFromPortal({supportedTypes:["Feature Collection"]},t)),Promise.resolve(this)}removeAll(){this.removeResult(),this.pointBarriers.removeAll(),this.polygonBarriers.removeAll(),this.polylineBarriers.removeAll(),this.stops.removeAll()}removeResult(){this.directionLines!=null&&(this.directionLines.removeAll(),this._set("directionLines",null)),this.directionPoints!=null&&(this.directionPoints.removeAll(),this._set("directionPoints",null)),this.routeInfo!=null&&this._set("routeInfo",null)}save(){return C(this,null,function*(){yield this.load();let{fullExtent:t,portalItem:o}=this;if(!o)throw new v("routelayer:portal-item-not-set","save() requires to the layer to have a portal item");if(!o.id)throw new v("routelayer:portal-item-not-saved","Please use saveAs() first to save the routelayer");if(o.type!=="Feature Collection")throw new v("routelayer:portal-item-wrong-type",'Portal item needs to have type "Feature Collection"');if(this.routeInfo==null)throw new v("routelayer:route-unsolved","save() requires a solved route");let{portal:e}=o;yield e.signIn(),e.user||(yield o.reload());let{itemUrl:r,itemControl:i}=o;if(i!=="admin"&&i!=="update")throw new v("routelayer:insufficient-permissions","To save this layer, you need to be the owner or an administrator of your organization");let p={messages:[],origin:"portal-item",portal:e,url:r?Z(r):void 0,writtenProperties:[]},u=this.write(void 0,p);return o.extent=yield Be(t),o.title=this.title,yield o.update({data:u}),o})}saveAs(e){return C(this,arguments,function*(t,o={}){if(yield this.load(),this.routeInfo==null)throw new v("routelayer:route-unsolved","saveAs() requires a solved route");let r=te.from(t).clone();r.extent??=yield Be(this.fullExtent),r.id=null,r.portal??=Se.getDefault(),r.title??=this.title,r.type="Feature Collection",r.typeKeywords=["Data","Feature Collection",ce.MULTI_LAYER,"Route Layer"];let{portal:i}=r,p={messages:[],origin:"portal-item",portal:i,url:null,writtenProperties:[]};yield i.signIn();let u=o?.folder,m=this.write(void 0,p);return yield i.user.addItem({item:r,folder:u,data:m}),this.portalItem=r,ye(p),p.portalItem=r,r})}solve(t,o){return C(this,null,function*(){k(this.stops),k(this.pointBarriers),k(this.polylineBarriers),k(this.polygonBarriers);let e=t?.stops??this.stops,r=t?.pointBarriers??E(this.pointBarriers),i=t?.polylineBarriers??E(this.polylineBarriers),p=t?.polygonBarriers??E(this.polygonBarriers);if(e==null)throw new v("routelayer:undefined-stops","the route layer must have stops defined in the route parameters.");if((Fe(e)||ke(e))&&e.features.length<2||b.isCollection(e)&&e.length<2)throw new v("routelayer:insufficent-stops","the route layer must have two or more stops to solve a route.");if(b.isCollection(e))for(let d of e)d.routeName=null;let u=t?.apiKey,{checksum:m,url:h}=this,g=yield this._getServiceDescription(h,u,o),n=t?.travelMode??g.defaultTravelMode,c=t?.accumulateAttributes??[];n&&(c.push(n.distanceAttributeName),n.timeAttributeName&&c.push(n.timeAttributeName));let y={accumulateAttributes:c,checksum:m,directionsOutputType:"featuresets",ignoreInvalidLocations:!0,pointBarriers:r,polylineBarriers:i,polygonBarriers:p,preserveObjectID:!0,returnBarriers:!!r,returnDirections:!0,returnPolygonBarriers:!!p,returnPolylineBarriers:!!i,returnRoutes:!0,returnStops:!0,stops:e},P=be.from(t??{}),I;P.set(y);try{I=yield he(h,P,o)}catch(d){throw K(d)?d:new v("routelayer:failed-route-request","the routing request failed",{error:d})}let S=this._toRouteLayerSolution(I);return this._isOverridden("title")||(this.title=S.routeInfo.name??"Route"),xe(S,g,P),S})}update(t){let{checksum:o,directionLines:e,directionPoints:r,pointBarriers:i,polygonBarriers:p,polylineBarriers:u,routeInfo:m,stops:h}=t;x(h,this.stops)?Me(h,this.stops):this.set({stops:h}),x(i,this.pointBarriers)?Ge(i,this.pointBarriers):this.set({pointBarriers:i}),x(u,this.polylineBarriers)?Je(u,this.polylineBarriers):this.set({polylineBarriers:u}),x(p,this.polygonBarriers)?je(p,this.polygonBarriers):this.set({polygonBarriers:p}),this.set({checksum:o}),this._set("directionLines",e),this._set("directionPoints",r),this._set("routeInfo",m),m.geometry!=null&&(this.spatialReference=m.geometry.spatialReference)}_getNetworkFeatures(t,o,e,r){let i=G(t)?t.layers:t.featureCollection?.layers,p=i?.find(S=>S.layerDefinition.name===o);if(p==null)return new b;let{layerDefinition:u,popupInfo:m,featureSet:h}=p,g=u.drawingInfo.renderer,{features:n}=h,c=h.spatialReference??u.spatialReference??u.extent.spatialReference??j,y=g&&pe(g),P=N.fromJSON(c),I=n.map(S=>{let d=ue.fromJSON(S);d.geometry!=null&&S.geometry!=null&&S.geometry.spatialReference==null&&(d.geometry.spatialReference=P);let w=e(d);return w.symbol??=y?.getSymbol(d)??this._getNetworkSymbol(o),w.popupTemplate??=m&&le.fromJSON(m),w});return r&&I.some(({symbol:S})=>!S)&&r(I),new b(I)}_getNetworkSymbol(t){switch(t){case"Barriers":return this.defaultSymbols.pointBarriers;case"DirectionPoints":return this.defaultSymbols.directionPoints;case"DirectionLines":return this.defaultSymbols.directionLines;case"PolylineBarriers":return this.defaultSymbols.polylineBarriers;case"PolygonBarriers":return this.defaultSymbols.polygonBarriers;case"RouteInfo":return this.defaultSymbols.routeInfo;case"Stops":return null}}_getServiceDescription(t,o,e){return C(this,null,function*(){if(this._cachedServiceDescription!=null&&this._cachedServiceDescription.url===t)return this._cachedServiceDescription.serviceDescription;let r=yield de(t,o,e);return this._cachedServiceDescription={serviceDescription:r,url:t},r})}_setStopSymbol(t){if(!t||!t.length||!this.defaultSymbols.stops||t.every(({symbol:n})=>!!n))return;let{first:o,last:e,middle:r,unlocated:i,waypoint:p,break:u}=this.defaultSymbols.stops;if(this.routeInfo==null||t.length===1)return void t.forEach((n,c)=>{switch(c){case 0:n.symbol=o;break;case t.length-1:n.symbol=e;break;default:n.symbol=r}});let m=t.map(({sequence:n})=>n).filter(n=>n!=null),h=Math.min(...m),g=Math.max(...m);for(let n of t)n.sequence!==h?n.sequence!==g?n.status==="ok"||n.status==="not-located-on-closest"?n.locationType!=="waypoint"?n.locationType!=="break"?n.symbol=r:n.symbol=u:n.symbol=p:n.symbol=i:n.symbol=e:n.symbol=o}_toRouteLayerSolution(t){let{checksum:o,routeResults:e}=t,r=e[0].stops?.map(c=>T.fromJSON(c.toJSON()));this._setStopSymbol(r);let i=new De(r),p=new Ne(t.polygonBarriers?.map(c=>{let y=O.fromJSON(c.toJSON());return y.symbol=this.defaultSymbols.polygonBarriers,y})),u=new Pe(t.polylineBarriers?.map(c=>{let y=L.fromJSON(c.toJSON());return y.symbol=this.defaultSymbols.polylineBarriers,y})),m=new Ie(t.pointBarriers?.map(c=>{let y=_.fromJSON(c.toJSON());return y.symbol=this.defaultSymbols.pointBarriers,y})),h=e[0].route?.toJSON(),g=F.fromJSON(h);g.symbol=this.defaultSymbols.routeInfo;let n=new qe(e[0].directionPoints?.features.map(c=>{let y=A.fromJSON(c.toJSON());return y.symbol=this.defaultSymbols.directionPoints,y}));return{checksum:o,directionLines:new We(e[0].directionLines?.features.map(c=>{let y=R.fromJSON(c.toJSON());return y.symbol=this.defaultSymbols.directionLines,y})),directionPoints:n,pointBarriers:m,polygonBarriers:p,polylineBarriers:u,routeInfo:g,stops:i}}_writeDirectionLines(){return this._writeNetworkFeatures(this.directionLines,this.defaultSymbols.directionLines,"esriGeometryPolyline",R.fields,"DirectionLines","Direction Lines")}_writeDirectionPoints(){return this._writeNetworkFeatures(this.directionPoints,this.defaultSymbols.directionPoints,"esriGeometryPoint",A.fields,"DirectionPoints","Direction Points")}_writeNetworkFeatures(t,o,e,r,i,p){if(!t?.length)return null;let u=this.spatialReference.toJSON(),{fullExtent:m,maxScale:h,minScale:g}=this;return{featureSet:{features:t.toArray().map(n=>Ee(n)),geometryType:e,spatialReference:u},layerDefinition:{capabilities:"Query,Update,Editing",drawingInfo:{renderer:{type:"simple",symbol:o!=null?o.toJSON():q(e)}},extent:m.toJSON(),fields:r,geometryType:e,hasM:!1,hasZ:!1,maxScale:h,minScale:g,name:i,objectIdField:"ObjectID",spatialReference:u,title:p,type:"Feature Layer",typeIdField:""}}}_writePointBarriers(){return this._writeNetworkFeatures(this.pointBarriers,this.defaultSymbols.pointBarriers,"esriGeometryPoint",_.fields,"Barriers","Point Barriers")}_writePolygonBarriers(){return this._writeNetworkFeatures(this.polygonBarriers,this.defaultSymbols.polygonBarriers,"esriGeometryPolygon",O.fields,"PolygonBarriers","Polygon Barriers")}_writePolylineBarriers(){return this._writeNetworkFeatures(this.polylineBarriers,this.defaultSymbols.polylineBarriers,"esriGeometryPolyline",L.fields,"PolylineBarriers","Line Barriers")}_writeRouteInfo(){return this._writeNetworkFeatures(this.routeInfo!=null?new b([this.routeInfo]):null,this.defaultSymbols.routeInfo,"esriGeometryPolyline",F.fields,"RouteInfo","Route Details")}_writeStops(){let t=this._writeNetworkFeatures(this.stops,null,"esriGeometryPoint",T.fields,"Stops","Stops");if(t==null)return null;let{stops:o}=this.defaultSymbols,e=o?.first?.toJSON(),r=o?.middle?.toJSON(),i=o?.last?.toJSON();return t.layerDefinition.drawingInfo.renderer={type:"uniqueValue",field1:"Sequence",defaultSymbol:r,uniqueValueInfos:[{value:"1",symbol:e,label:"First Stop"},{value:`${this.stops.length}`,symbol:i,label:"Last Stop"}]},t}};l([f({readOnly:!0,json:{read:!1,origins:{"portal-item":{write:{allowNull:!0,ignoreOrigin:!0}},"web-map":{write:{overridePolicy(){return{allowNull:!0,ignoreOrigin:this.portalItem==null}}}}}}})],a.prototype,"_featureCollection",void 0),l([Q(["web-map","portal-item"],"_featureCollection")],a.prototype,"writeFeatureCollectionWebmap",null),l([f({readOnly:!0,json:{read:!1,origins:{"web-map":{write:{target:"type",overridePolicy(){return{ignoreOrigin:this.portalItem!=null}}}}}}})],a.prototype,"_type",void 0),l([f({type:String})],a.prototype,"checksum",void 0),l([f({nonNullable:!0,type:M})],a.prototype,"defaultSymbols",void 0),l([f({readOnly:!0})],a.prototype,"directionLines",void 0),l([B(["web-map","portal-item"],"directionLines",["layers","featureCollection.layers"])],a.prototype,"readDirectionLines",null),l([f({readOnly:!0})],a.prototype,"directionPoints",void 0),l([B(["web-map","portal-item"],"directionPoints",["layers","featureCollection.layers"])],a.prototype,"readDirectionPoints",null),l([f({readOnly:!0,json:{read:!1,origins:{"web-map":{write:{ignoreOrigin:!0}}}}})],a.prototype,"featureCollectionType",void 0),l([f({readOnly:!0})],a.prototype,"fullExtent",null),l([f({json:{origins:{"web-map":{name:"featureCollection.showLegend"}},write:!0}})],a.prototype,"legendEnabled",void 0),l([f({type:["show","hide"]})],a.prototype,"listMode",void 0),l([f({type:Number,nonNullable:!0,json:{write:!1}})],a.prototype,"maxScale",void 0),l([B(["web-map","portal-item"],"maxScale",["layers","featureCollection.layers"])],a.prototype,"readMaxScale",null),l([f({type:Number,nonNullable:!0,json:{write:!1}})],a.prototype,"minScale",void 0),l([B(["web-map","portal-item"],"minScale",["layers","featureCollection.layers"])],a.prototype,"readMinScale",null),l([f({type:["ArcGISFeatureLayer"],value:"ArcGISFeatureLayer"})],a.prototype,"operationalLayerType",void 0),l([f({nonNullable:!0,type:b.ofType(_)})],a.prototype,"pointBarriers",void 0),l([B(["web-map","portal-item"],"pointBarriers",["layers","featureCollection.layers"])],a.prototype,"readPointBarriers",null),l([f({nonNullable:!0,type:b.ofType(O)})],a.prototype,"polygonBarriers",void 0),l([B(["web-map","portal-item"],"polygonBarriers",["layers","featureCollection.layers"])],a.prototype,"readPolygonBarriers",null),l([f({nonNullable:!0,type:b.ofType(L)})],a.prototype,"polylineBarriers",void 0),l([B(["web-map","portal-item"],"polylineBarriers",["layers","featureCollection.layers"])],a.prototype,"readPolylineBarriers",null),l([f({readOnly:!0})],a.prototype,"routeInfo",void 0),l([B(["web-map","portal-item"],"routeInfo",["layers","featureCollection.layers"])],a.prototype,"readRouteInfo",null),l([f({type:N})],a.prototype,"spatialReference",void 0),l([B(["web-map","portal-item"],"spatialReference",["layers","featureCollection.layers"])],a.prototype,"readSpatialReference",null),l([f({nonNullable:!0,type:b.ofType(T)})],a.prototype,"stops",void 0),l([B(["web-map","portal-item"],"stops",["layers","featureCollection.layers"])],a.prototype,"readStops",null),l([f()],a.prototype,"title",null),l([f({readOnly:!0,json:{read:!1}})],a.prototype,"type",void 0),l([f()],a.prototype,"url",null),a=l([Y(Ce)],a);var Gt=a;export{Gt as default};
