import{a as w,b as u}from"./chunk-NSUARQNU.js";import{v as m,va as F}from"./chunk-KALOJIUA.js";import{a as y}from"./chunk-QGVBCWUY.js";import{l as f}from"./chunk-5QEXLALV.js";import{b as l}from"./chunk-YOFFGXOB.js";import{f as c}from"./chunk-VTHXE323.js";var V=g=>{let a=class extends g{_validateFetchPopupFeatures(t){let{layer:s}=this,{popupEnabled:p}=s;if(!p)throw new l("scenelayerview3d:fetchPopupFeatures","Popups are disabled",{layer:s});if(!u(s,t))throw new l("scenelayerview3d:fetchPopupFeatures","Layer does not define a popup template",{layer:s})}prepareFetchPopupFeatures(t){return c(this,null,function*(){})}fetchPopupFeaturesFromGraphics(t,s){return c(this,null,function*(){if(this._validateFetchPopupFeatures(s),t.length===0)return[];let p=this.layer.type==="scene"&&this.layer.associatedLayer!=null?this.layer.associatedLayer:this.layer,i=[];"fieldsIndex"in this.layer&&(i=m(this.layer.fieldsIndex,yield w(p,u(this.layer,s)))),yield this.prepareFetchPopupFeatures(i);let h=new Set,o=[],r=[];for(let e of t)F(i,e,h)?r.push(e):o.push(e);if(r.length===0)return o;let n=new Map;for(let e=0;e<t.length;e++)n.set(t[e].getObjectId()??0,e);let d=yield this.whenGraphicAttributes(r,[...h]).catch(()=>r).then(e=>o.concat(e));return d.sort((e,P)=>{let b=e.getObjectId()??0,v=n.get(b)??0,I=P.getObjectId()??0;return v-(n.get(I)??0)}),d})}};return a=y([f("esri.views.3d.layers.support.PopupSceneLayerView")],a),a};export{V as a};
