import{a as K}from"./chunk-IQYLT45D.js";import{a as A}from"./chunk-TP5DQPDO.js";import"./chunk-KQNC33OC.js";import"./chunk-5UMO4RD6.js";import{a as xe}from"./chunk-WPCH3TCK.js";import{a as we,b as ve}from"./chunk-IV5PWPRQ.js";import{a as Z}from"./chunk-FHIJJJTC.js";import{a as ge}from"./chunk-GGYZRKBV.js";import{a as he}from"./chunk-37PSR6DC.js";import{a as me}from"./chunk-H25DKJGS.js";import"./chunk-6DALCDDU.js";import"./chunk-PBAMEKFE.js";import"./chunk-XIZ7IH6M.js";import"./chunk-JD66UCS7.js";import"./chunk-FU7RO3AR.js";import"./chunk-4YRY3D3A.js";import"./chunk-ZZ5UYT7M.js";import"./chunk-U4XVPHQU.js";import"./chunk-XR5FT7TQ.js";import"./chunk-5BPM64SU.js";import"./chunk-TC77DYTW.js";import"./chunk-F2BQ2GD6.js";import"./chunk-R3XLNYYB.js";import"./chunk-DA3SDKGO.js";import"./chunk-ZOEPYNM4.js";import"./chunk-57VFBGF3.js";import"./chunk-GWBRHLNH.js";import"./chunk-BJH4F4SM.js";import"./chunk-Z3RBZHAK.js";import"./chunk-KALOJIUA.js";import"./chunk-KMMTNF7G.js";import"./chunk-MDZTV2VL.js";import"./chunk-RNC4P66O.js";import"./chunk-7LHOQXZT.js";import"./chunk-BCREO4Q5.js";import"./chunk-U4QEPZJ3.js";import"./chunk-KJUZWSCL.js";import"./chunk-3WO6D7MU.js";import"./chunk-BUZ3SPLE.js";import{b as Y}from"./chunk-MFCSEXHS.js";import{b as de}from"./chunk-2TX472ZB.js";import{c as ue}from"./chunk-7QNKS2X6.js";import{a as fe}from"./chunk-VCCMJ6BV.js";import{a as Te}from"./chunk-QK56OQGR.js";import"./chunk-FXCL7YYQ.js";import"./chunk-QKO56XO6.js";import"./chunk-JRGT3GTH.js";import"./chunk-K75TK42V.js";import"./chunk-CELWVZPW.js";import"./chunk-VV5G7VY5.js";import"./chunk-OLOKUDVI.js";import"./chunk-DYTVXYAV.js";import"./chunk-ZTOZWLEE.js";import"./chunk-RJWOVI3M.js";import"./chunk-RSDQHAJX.js";import"./chunk-BOVYXYHK.js";import{a as D}from"./chunk-DZFUQCB6.js";import"./chunk-V2JYXY4D.js";import"./chunk-KVM6SHDX.js";import{a as ye}from"./chunk-PIHANKUA.js";import"./chunk-HX2VGIR2.js";import"./chunk-ERDKAICI.js";import"./chunk-EQZWYK27.js";import"./chunk-JLPLCY2B.js";import"./chunk-2GJBUR2F.js";import"./chunk-DKGGDYJI.js";import"./chunk-5LA3PVK5.js";import"./chunk-IR6XCBC4.js";import"./chunk-C6JPAW54.js";import"./chunk-WD3OPXCN.js";import"./chunk-FA3WGIU4.js";import"./chunk-WWVPA6PE.js";import"./chunk-YPMM52MU.js";import"./chunk-BBR7CJCO.js";import{m as F}from"./chunk-ZQIC5NFT.js";import{c as pe}from"./chunk-VIEK2X23.js";import"./chunk-XKIFGPJO.js";import{a as E}from"./chunk-PEW2PLAN.js";import"./chunk-Q6Y4JG7Q.js";import"./chunk-7F5DJLJT.js";import{a as ne}from"./chunk-CX5IFQZJ.js";import{C as ce,b as B}from"./chunk-NJWTSROP.js";import"./chunk-D3R25AF2.js";import"./chunk-ARRCN5K3.js";import"./chunk-4N4D2YQX.js";import"./chunk-G4DZJMGT.js";import"./chunk-K5T5FD5C.js";import"./chunk-MVHHPJM7.js";import"./chunk-VDO6JJ3Y.js";import"./chunk-WFKZLI6F.js";import"./chunk-X2B63YVS.js";import"./chunk-BAEF3CT6.js";import{o as k}from"./chunk-AUAZP44J.js";import"./chunk-PVDFCTA4.js";import"./chunk-KNVXE32P.js";import{k as j,m as oe}from"./chunk-76ATOSLU.js";import"./chunk-CCJU4DSH.js";import{a as z,c as Q,i as V}from"./chunk-TG45K3WR.js";import"./chunk-RAI4DTMT.js";import{b as le}from"./chunk-ACP3S2CH.js";import"./chunk-HVAXZ2NA.js";import"./chunk-T7DXJKX7.js";import"./chunk-TYYVNQUR.js";import{a as u}from"./chunk-QGVBCWUY.js";import"./chunk-MYO4NP2N.js";import{e as h}from"./chunk-NFIPKH6V.js";import"./chunk-JPU2PQZC.js";import{l as se}from"./chunk-5QEXLALV.js";import"./chunk-P6QFA5MM.js";import"./chunk-DGTD7Y73.js";import"./chunk-LI2SX4T6.js";import"./chunk-BWO7LS2H.js";import"./chunk-HEVQSRJ2.js";import"./chunk-OVHPPCBL.js";import"./chunk-SNFOAZZQ.js";import"./chunk-AML4XSEF.js";import{s as X}from"./chunk-4PTIEWMT.js";import"./chunk-TG2UTNEO.js";import{b as P}from"./chunk-YOFFGXOB.js";import"./chunk-XRGPJ3QY.js";import{b as ae}from"./chunk-6MRUJ2UW.js";import{b as J}from"./chunk-2LI2GKBQ.js";import{y as W}from"./chunk-QBWJMFH5.js";import{a as b,b as H,f as U}from"./chunk-VTHXE323.js";var Se=90.71428571428571;function ee(t){let e=t.replaceAll(/ows:/gi,"");if(!y("Contents",new DOMParser().parseFromString(e,"text/xml").documentElement))throw new P("wmtslayer:wmts-capabilities-xml-is-not-valid","the wmts get capabilities response is not compliant",{text:t})}function Ie(t,e){t=t.replaceAll(/ows:/gi,"");let r=new DOMParser().parseFromString(t,"text/xml").documentElement,i=new Map,a=new Map,o=y("Contents",r);if(!o)throw new P("wmtslayer:wmts-capabilities-xml-is-not-valid");let s=y("OperationsMetadata",r),l=s?.querySelector("[name='GetTile']"),n=l?.getElementsByTagName("Get"),p=n&&Array.prototype.slice.call(n),d=e.url?.indexOf("https"),c=d!==void 0&&d>-1,g,M,v=e.serviceMode,w=e?.url;p?.length&&p.some(I=>{let S=y("Constraint",I);return!S||O("AllowedValues","Value",v,S)?(w=I.attributes[0].nodeValue,!0):(!S||O("AllowedValues","Value","RESTful",S)||O("AllowedValues","Value","REST",S)?M=I.attributes[0].nodeValue:S&&!O("AllowedValues","Value","KVP",S)||(g=I.attributes[0].nodeValue),!1)}),!w&&(M?(w=M,v="RESTful"):g?(w=g,v="KVP"):w=y("ServiceMetadataURL",r)?.getAttribute("xlink:href"));let L=w.indexOf("1.0.0/");L===-1&&v==="RESTful"?w+="/":L>-1&&(w=w.slice(0,L)),v==="KVP"&&(w+=L>-1?"":"?"),c&&(w=w.replace(/^http:/i,"https:"));let x=f("ServiceIdentification>ServiceTypeVersion",r),T=f("ServiceIdentification>AccessConstraints",r),C=T&&/^none$/i.test(T)?null:T,$=R("Layer",o),G=R("TileMatrixSet",o),q=$.map(I=>{let S=f("Identifier",I);return i.set(S,I),Ue(S,I,G,c,x)});return{copyright:C,dimensionMap:a,layerMap:i,layers:q,serviceMode:v,tileUrl:w}}function Le(t){return t.layers.forEach(e=>{e.tileMatrixSets?.forEach(r=>{let i=r.tileInfo;i&&i.dpi!==96&&(i.lods?.forEach(a=>{a.scale=96*a.scale/i.dpi,a.resolution=Ee(i.spatialReference?.wkid,a.scale*Se/96,r.id)}),i.dpi=96)})}),t}function te(t){return t.nodeType===Node.ELEMENT_NODE}function y(t,e){for(let r=0;r<e.childNodes.length;r++){let i=e.childNodes[r];if(te(i)&&i.nodeName===t)return i}return null}function R(t,e){let r=[];for(let i=0;i<e.childNodes.length;i++){let a=e.childNodes[i];te(a)&&a.nodeName===t&&r.push(a)}return r}function N(t,e){let r=[];for(let i=0;i<e.childNodes.length;i++){let a=e.childNodes[i];te(a)&&a.nodeName===t&&r.push(a)}return r.map(i=>i.textContent).filter(W)}function f(t,e){return t.split(">").forEach(r=>{e&&(e=y(r,e))}),e&&e.textContent}function O(t,e,r,i){let a;return Array.prototype.slice.call(i.childNodes).some(o=>{if(o.nodeName.includes(t)){let s=y(e,o),l=s?.textContent;if(l===r||r.split(":")&&r.split(":")[1]===l)return a=o,!0}return!1}),a}function Ue(t,e,r,i,a){let o=f("Abstract",e),s=N("Format",e);return{id:t,fullExtent:Fe(e),fullExtents:Oe(e),description:o,formats:s,styles:_e(e,i),title:f("Title",e),tileMatrixSets:Ne(a,e,r)}}function Ce(t,e){let r=[],i=t.layerMap?.get(e);if(!i)return null;let a=R("ResourceURL",i),o=R("Dimension",i),s,l,n,p;return o.length&&(s=f("Identifier",o[0]),l=N("Default",o[0])),o.length>1&&(n=f("Identifier",o[1]),p=N("Default",o[1])),t.dimensionMap.set(e,{dimensions:l,dimensions2:p}),a.forEach(d=>{let c=d.getAttribute("template");if(d.getAttribute("resourceType")==="tile"){if(s&&l.length)if(c.includes("{"+s+"}"))c=c.replace("{"+s+"}","{dimensionValue}");else{let g=c.toLowerCase().indexOf("{"+s.toLowerCase()+"}");g>-1&&(c=c.slice(0,g)+"{dimensionValue}"+c.slice(g+s.length+2))}if(n&&p.length)if(c.includes("{"+n+"}"))c=c.replace("{"+n+"}","{dimensionValue2}");else{let g=c.toLowerCase().indexOf("{"+n.toLowerCase()+"}");g>-1&&(c=c.slice(0,g)+"{dimensionValue2}"+c.slice(g+n.length+2))}r.push({template:c,format:d.getAttribute("format"),resourceType:"tile"})}}),r}function be(t,e,r,i,a,o,s,l){let n=Ve(t,e,i);if(!(n?.length>0))return"";let{dimensionMap:p}=t,d=p.get(e).dimensions?.[0],c=p.get(e).dimensions2?.[0];return n[s%n.length].template.replaceAll(/\{Style\}/gi,a??"").replaceAll(/\{TileMatrixSet\}/gi,r??"").replaceAll(/\{TileMatrix\}/gi,o).replaceAll(/\{TileRow\}/gi,""+s).replaceAll(/\{TileCol\}/gi,""+l).replaceAll(/\{dimensionValue\}/gi,d).replaceAll(/\{dimensionValue2\}/gi,c)}function Ve(t,e,r){let i=Ce(t,e),a=i?.filter(o=>o.format===r);return(a?.length?a:i)??[]}function Re(t,e,r,i){let{dimensionMap:a}=t,o=Ce(t,e),s="";if(o&&o.length>0){let l=a.get(e).dimensions?.[0],n=a.get(e).dimensions2?.[0];s=o[0].template,s.endsWith(".xxx")&&(s=s.slice(0,-4)),s=s.replaceAll(/\{Style\}/gi,i),s=s.replaceAll(/\{TileMatrixSet\}/gi,r),s=s.replaceAll(/\{TileMatrix\}/gi,"{level}"),s=s.replaceAll(/\{TileRow\}/gi,"{row}"),s=s.replaceAll(/\{TileCol\}/gi,"{col}"),s=s.replaceAll(/\{dimensionValue\}/gi,l),s=s.replaceAll(/\{dimensionValue2\}/gi,n)}return s}function Fe(t){let e=y("WGS84BoundingBox",t),r=e?f("LowerCorner",e).split(" "):["-180","-90"],i=e?f("UpperCorner",e).split(" "):["180","90"];return{xmin:parseFloat(r[0]),ymin:parseFloat(r[1]),xmax:parseFloat(i[0]),ymax:parseFloat(i[1]),spatialReference:{wkid:4326}}}function Oe(t){let e=[];return Z(t,{BoundingBox:r=>{if(!r.getAttribute("crs"))return;let i=r.getAttribute("crs").toLowerCase(),a=re(i),o=i.includes("epsg")&&K(a.wkid),s,l,n,p;Z(r,{LowerCorner:d=>{[s,l]=d.textContent.split(" ").map(c=>Number.parseFloat(c)),o&&([s,l]=[l,s])},UpperCorner:d=>{[n,p]=d.textContent.split(" ").map(c=>Number.parseFloat(c)),o&&([n,p]=[p,n])}}),e.push({xmin:s,ymin:l,xmax:n,ymax:p,spatialReference:a})}}),e}function _e(t,e){return R("Style",t).map(r=>{let i=y("LegendURL",r),a=y("Keywords",r),o=a?N("Keyword",a):[],s=i?.getAttribute("xlink:href");return e&&(s=s?.replace(/^http:/i,"https:")),{abstract:f("Abstract",r),id:f("Identifier",r),isDefault:r.getAttribute("isDefault")==="true",keywords:o,legendUrl:s,title:f("Title",r)}})}function Ne(t,e,r){return R("TileMatrixSetLink",e).map(i=>We(t,i,r))}function We(t,e,r){let i=y("TileMatrixSet",e).textContent,a=N("TileMatrix",e),o=r.find(x=>{let T=y("Identifier",x),C=T?.textContent;return!!(C===i||i.split(":")&&i.split(":")[1]===C)}),s=y("TileMatrixSetLimits",e),l=s&&R("TileMatrixLimits",s),n=new Map;if(l?.length)for(let x of l){let T=y("TileMatrix",x).textContent,C=+y("MinTileRow",x).textContent,$=+y("MaxTileRow",x).textContent,G=+y("MinTileCol",x).textContent,q=+y("MaxTileCol",x).textContent;n.set(T,{minCol:G,maxCol:q,minRow:C,maxRow:$})}let p=f("SupportedCRS",o).toLowerCase(),d=je(o,p),c=d.spatialReference,g=y("TileMatrix",o),M=[parseInt(f("TileWidth",g),10),parseInt(f("TileHeight",g),10)],v=[];a.length?a.forEach((x,T)=>{let C=O("TileMatrix","Identifier",x,o);v.push(Me(C,p,T,i,n))}):R("TileMatrix",o).forEach((x,T)=>{v.push(Me(x,p,T,i,n))});let w=ke(t,o,d,M,v[0]).toJSON(),L=new D({dpi:96,spatialReference:c,size:M,origin:d,lods:v}).toJSON();return{id:i,fullExtent:w,tileInfo:L}}function re(t){t=t.toLowerCase();let e=parseInt(t.split(":").pop(),10);e!==900913&&e!==3857||(e=102100);let r=De(t);return r!=null&&(e=r),{wkid:e}}function je(t,e){return Pe(y("TileMatrix",t),e)}function Pe(t,e){let r=re(e),[i,a]=f("TopLeftCorner",t).split(" ").map(s=>parseFloat(s)),o=e.includes("epsg")&&K(r.wkid);return new pe(o?{x:a,y:i,spatialReference:r}:{x:i,y:a,spatialReference:r})}function ke(t,e,r,i,a){let o=y("BoundingBox",e),s,l,n,p,d,c;if(o&&(s=f("LowerCorner",o).split(" "),l=f("UpperCorner",o).split(" ")),s&&s.length>1&&l&&l.length>1)n=parseFloat(s[0]),d=parseFloat(s[1]),p=parseFloat(l[0]),c=parseFloat(l[1]);else{let g=y("TileMatrix",e),M=parseInt(f("MatrixWidth",g),10),v=parseInt(f("MatrixHeight",g),10);n=r.x,c=r.y,p=n+M*i[0]*a.resolution,d=c-v*i[1]*a.resolution}return Be(t,r.spatialReference,r)?new F(d,n,c,p,r.spatialReference):new F(n,d,p,c,r.spatialReference)}function Be(t,e,r){return t==="1.0.0"&&K(e.wkid)&&!(r.spatialReference.isGeographic&&r.x<-90&&r.y>=-90)}var _;function De(t){return t.includes("crs84")||t.includes("crs:84")?_.CRS84:t.includes("crs83")||t.includes("crs:83")?_.CRS83:t.includes("crs27")||t.includes("crs:27")?_.CRS27:null}function Me(t,e,r,i,a){let o=re(e),s=f("Identifier",t),l=parseFloat(f("ScaleDenominator",t)),n=Ee(o.wkid,l,i);l*=96/Se;let p=+f("MatrixWidth",t),d=+f("MatrixHeight",t),{maxCol:c=p-1,maxRow:g=d-1,minCol:M=0,minRow:v=0}=a.get(s)??{},{x:w,y:L}=Pe(t,e);return new ye({cols:[M,c],level:r,levelValue:s,origin:[w,L],scale:l,resolution:n,rows:[v,g]})}function Ee(t,e,r){let i;return i=B.hasOwnProperty(""+t)?B.values[B[t]]:r==="default028mm"?6370997*Math.PI/180:ce(t).metersPerDegree,7*e/25e3/i}(function(t){t[t.CRS84=4326]="CRS84",t[t.CRS83=4269]="CRS83",t[t.CRS27=4267]="CRS27"})(_||(_={}));var ie,Ae={"image/png":".png","image/png8":".png","image/png24":".png","image/png32":".png","image/jpg":".jpg","image/jpeg":".jpeg","image/gif":".gif","image/bmp":".bmp","image/tiff":".tif","image/jpgpng":"","image/jpegpng":"","image/unknown":""},Ke=new Set(["version","service","request","layer","style","format","tilematrixset","tilematrix","tilerow","tilecol"]),m=ie=class extends ue(de(fe(ge(he(me(Te)))))){constructor(...t){super(...t),this.activeLayer=null,this.copyright="",this.customParameters=null,this.customLayerParameters=null,this.fullExtent=null,this.operationalLayerType="WebTiledLayer",this.resourceInfo=null,this.serviceMode="RESTful",this.sublayers=null,this.type="wmts",this.version="1.0.0",this.addHandles([z(()=>this.activeLayer,(e,r)=>{r&&!this.sublayers?.includes(r)&&(r.layer=null,r.parent=null),e&&(e.layer=this,e.parent=this)},V),Q(()=>this.sublayers,"after-add",({item:e})=>{e.layer=this,e.parent=this},V),Q(()=>this.sublayers,"after-remove",({item:e})=>{e.layer=null,e.parent=null},V),z(()=>this.sublayers,(e,r)=>{if(r)for(let i of r)i.layer=null,i.parent=null;if(e)for(let i of e)i.layer=this,i.parent=this},V)])}normalizeCtorArgs(t,e){return typeof t=="string"?b({url:t},e):t}load(t){return this.addResolvingPromise(this.loadFromPortal({supportedTypes:["WMTS"]},t).catch(X).then(()=>this._fetchService(t)).catch(e=>{throw X(e),new P("wmtslayer:unsupported-service-data","Invalid response from the WMTS service.",{error:e})})),Promise.resolve(this)}readActiveLayerFromService(t,e,r){this.activeLayer||(this.activeLayer=new A);let i=e.layers.find(a=>a.id===this.activeLayer.id);return i||(i=e.layers[0]),this.activeLayer.read(i,r),this.activeLayer}readActiveLayerFromItemOrWebDoc(t,e){let{templateUrl:r,wmtsInfo:i}=e,a=r?this._getLowerCasedUrlParams(r):null,o=i?.layerIdentifier,s=null,l=i?.tileMatrixSet;l&&(Array.isArray(l)?l.length&&(s=l[0]):s=l);let n=a?.format,p=a?.style;return new A({id:o,imageFormat:n,styleId:p,tileMatrixSetId:s})}writeActiveLayer(t,e,r,i){let a=this.activeLayer;e.templateUrl=this.getUrlTemplate(a.id,a.tileMatrixSetId,a.imageFormat,a.styleId);let o=ae("tileMatrixSet.tileInfo",a);e.tileInfo=o?o.toJSON(i):null,e.wmtsInfo=H(b({},e.wmtsInfo),{layerIdentifier:a.id,tileMatrixSet:a.tileMatrixSetId})}readCustomParameters(t,e){let r=e.wmtsInfo;return r?this._mergeParams(r.customParameters,r.url):null}get fullExtents(){return this.activeLayer.fullExtents}readServiceMode(t,e){return e.templateUrl.includes("?")?"KVP":"RESTful"}readSublayersFromService(t,e,r){return $e(e.layers,r)}get supportedSpatialReferences(){return this.activeLayer.tileMatrixSets?.map(t=>t.tileInfo?.spatialReference).toArray().filter(W)??[]}get tilemapCache(){let t=this.activeLayer?.tileMatrixSet?.tileInfo;return t?new xe(t):void 0}get title(){return this.activeLayer?.title??"Layer"}set title(t){this._overrideIfSome("title",t)}get url(){return this._get("url")}set url(t){t&&t.endsWith("/")?this._set("url",t.slice(0,-1)):this._set("url",t)}createWebTileLayer(t){let e=this.getUrlTemplate(this.activeLayer.id,this.activeLayer.tileMatrixSetId,this.activeLayer.imageFormat,this.activeLayer.styleId),r=this._getTileMatrixSetById(t.tileMatrixSetId),i=r?.tileInfo,a=t.fullExtent,o=new we({layerIdentifier:t.id,tileMatrixSet:t.tileMatrixSetId,url:this.url});return this.customLayerParameters&&(o.customLayerParameters=this.customLayerParameters),this.customParameters&&(o.customParameters=this.customParameters),new ve({fullExtent:a,urlTemplate:e,tileInfo:i,wmtsInfo:o})}fetchTile(a,o,s){return U(this,arguments,function*(t,e,r,i={}){let{signal:l}=i,n=this.getTileUrl(t,e,r),{data:p}=yield k(n,{responseType:"image",signal:l});return p})}fetchImageBitmapTile(a,o,s){return U(this,arguments,function*(t,e,r,i={}){let{signal:l}=i;if(this.fetchTile!==ie.prototype.fetchTile){let d=yield this.fetchTile(t,e,r,i);return Y(d,t,e,r,l)}let n=this.getTileUrl(t,e,r),{data:p}=yield k(n,{responseType:"blob",signal:l});return Y(p,t,e,r,l)})}findSublayerById(t){return this.sublayers?.find(e=>e.id===t)}getTileUrl(t,e,r){let i=this._getTileMatrixSetById(this.activeLayer.tileMatrixSetId),a=i?.tileInfo?.lods[t],o=a?a.levelValue||`${a.level}`:`${t}`,s=this.resourceInfo?"":be({dimensionMap:this.dimensionMap,layerMap:this.layerMap},this.activeLayer.id,this.activeLayer.tileMatrixSetId,this.activeLayer.imageFormat,this.activeLayer.styleId,o,e,r);return s||(s=this.getUrlTemplate(this.activeLayer.id,this.activeLayer.tileMatrixSetId,this.activeLayer.imageFormat,this.activeLayer.styleId).replaceAll(/\{level\}/gi,o).replaceAll(/\{row\}/gi,`${e}`).replaceAll(/\{col\}/gi,`${r}`)),s=this._appendCustomLayerParameters(s),s}getUrlTemplate(t,e,r,i){if(!this.resourceInfo){let a=Re({dimensionMap:this.dimensionMap,layerMap:this.layerMap},t,e,i);if(a)return a}if(this.serviceMode==="KVP")return this.url+"?SERVICE=WMTS&VERSION="+this.version+"&REQUEST=GetTile&LAYER="+t+"&STYLE="+i+"&FORMAT="+r+"&TILEMATRIXSET="+e+"&TILEMATRIX={level}&TILEROW={row}&TILECOL={col}";if(this.serviceMode==="RESTful"){let a="";return Ae[r.toLowerCase()]&&(a=Ae[r.toLowerCase()]),this.url+t+"/"+i+"/"+e+"/{level}/{row}/{col}"+a}return""}_fetchService(t){return U(this,null,function*(){let e;if(this.resourceInfo)this.resourceInfo.serviceMode==="KVP"&&(this.url+=this.url.includes("?")?"":"?"),e={ssl:!1,data:this.resourceInfo};else try{e=yield this._getCapabilities(this.serviceMode,t),ee(e.data)}catch{let r=this.serviceMode==="KVP"?"RESTful":"KVP";try{e=yield this._getCapabilities(r,t),ee(e.data),this.serviceMode=r}catch(i){throw new P("wmtslayer:unsupported-service-data","Services does not support RESTful or KVP service modes.",{error:i})}}this.resourceInfo?e.data=Le(e.data):e.data=Ie(e.data,{serviceMode:this.serviceMode,url:this.url}),e.data&&this.read(e.data,{origin:"service"})})}_getCapabilities(t,e){return U(this,null,function*(){let r=this._getCapabilitiesUrl(t);return yield k(r,H(b({},e),{responseType:"text"}))})}_getTileMatrixSetById(t){return this.findSublayerById(this.activeLayer.id)?.tileMatrixSets?.find(i=>i.id===t)}_appendCustomParameters(t){return this._appendParameters(t,this.customParameters)}_appendCustomLayerParameters(t){return this._appendParameters(t,b(b({},J(this.customParameters)),this.customLayerParameters))}_appendParameters(t,e){let r=j(t),i=b(b({},r.query),e),a=oe(i);return a===""?r.path:`${r.path}?${a}`}_getCapabilitiesUrl(t){this.url=j(this.url).path;let e=this.url;switch(t){case"KVP":e+=`?request=GetCapabilities&service=WMTS&version=${this.version}`;break;case"RESTful":{let r=`/${this.version}/WMTSCapabilities.xml`,i=new RegExp(r,"i");e=e.replace(i,""),e+=r;break}}return this._appendCustomParameters(e)}_getLowerCasedUrlParams(t){if(!t)return null;let e=j(t).query;if(!e)return null;let r={};return Object.keys(e).forEach(i=>{r[i.toLowerCase()]=e[i]}),r}_mergeParams(t,e){let r=this._getLowerCasedUrlParams(e);if(r){let i=Object.keys(r);i.length&&(t=t?J(t):{},i.forEach(a=>{t.hasOwnProperty(a)||Ke.has(a)||(t[a]=r[a])}))}return t}};function $e(t,e){return t.map(r=>{let i=new A;return i.read(r,e),i})}u([h()],m.prototype,"dimensionMap",void 0),u([h()],m.prototype,"layerMap",void 0),u([h({type:A,json:{origins:{"web-document":{write:{ignoreOrigin:!0}}}}})],m.prototype,"activeLayer",void 0),u([E("service","activeLayer",["layers"])],m.prototype,"readActiveLayerFromService",null),u([E(["web-document","portal-item"],"activeLayer",["wmtsInfo"])],m.prototype,"readActiveLayerFromItemOrWebDoc",null),u([ne(["web-document","portal-item"],"activeLayer",{templateUrl:{type:String},tileInfo:{type:D},"wmtsInfo.layerIdentifier":{type:String},"wmtsInfo.tileMatrixSet":{type:String}})],m.prototype,"writeActiveLayer",null),u([h({type:String,value:"",json:{write:!0}})],m.prototype,"copyright",void 0),u([h({type:["show","hide"]})],m.prototype,"listMode",void 0),u([h({json:{read:!0,write:!0}})],m.prototype,"blendMode",void 0),u([h({json:{origins:{"web-document":{read:{source:["wmtsInfo.customParameters","wmtsInfo.url"]},write:{target:"wmtsInfo.customParameters"}},"portal-item":{read:{source:["wmtsInfo.customParameters","wmtsInfo.url"]},write:{target:"wmtsInfo.customParameters"}}}}})],m.prototype,"customParameters",void 0),u([E(["portal-item","web-document"],"customParameters")],m.prototype,"readCustomParameters",null),u([h({json:{origins:{"web-document":{read:{source:"wmtsInfo.customLayerParameters"},write:{target:"wmtsInfo.customLayerParameters"}},"portal-item":{read:{source:"wmtsInfo.customLayerParameters"},write:{target:"wmtsInfo.customLayerParameters"}}}}})],m.prototype,"customLayerParameters",void 0),u([h({type:F,json:{write:{ignoreOrigin:!0},origins:{"web-document":{read:{source:"fullExtent"}},"portal-item":{read:{source:"fullExtent"}}}}})],m.prototype,"fullExtent",void 0),u([h({readOnly:!0})],m.prototype,"fullExtents",null),u([h({type:["WebTiledLayer"]})],m.prototype,"operationalLayerType",void 0),u([h()],m.prototype,"resourceInfo",void 0),u([h()],m.prototype,"serviceMode",void 0),u([E(["portal-item","web-document"],"serviceMode",["templateUrl"])],m.prototype,"readServiceMode",null),u([h({type:le.ofType(A)})],m.prototype,"sublayers",void 0),u([E("service","sublayers",["layers"])],m.prototype,"readSublayersFromService",null),u([h({readOnly:!0})],m.prototype,"supportedSpatialReferences",null),u([h({readOnly:!0})],m.prototype,"tilemapCache",null),u([h({json:{read:{source:"title"}}})],m.prototype,"title",null),u([h({json:{read:!1},readOnly:!0,value:"wmts"})],m.prototype,"type",void 0),u([h({json:{origins:{service:{read:{source:"tileUrl"}},"web-document":{read:{source:"wmtsInfo.url"},write:{target:"wmtsInfo.url"}},"portal-item":{read:{source:"wmtsInfo.url"},write:{target:"wmtsInfo.url"}}}}})],m.prototype,"url",null),u([h()],m.prototype,"version",void 0),m=ie=u([se("esri.layers.WMTSLayer")],m);var Vt=m;export{Vt as default};
