import{a as Q}from"./chunk-7DY57VYE.js";import{b as _}from"./chunk-N2JUYKXN.js";import{a as O,b as R}from"./chunk-TR2R7ZXX.js";import{b as V}from"./chunk-7U52UAO2.js";import{k as w}from"./chunk-BBB7KLHV.js";import{a as g}from"./chunk-4YTM754S.js";import{b as D}from"./chunk-2HYVVLKS.js";import{b as f}from"./chunk-ZXKU6WBY.js";import{b}from"./chunk-6RBQSBA2.js";import{d as x}from"./chunk-NJWTSROP.js";import{k as F}from"./chunk-76ATOSLU.js";import{a}from"./chunk-QGVBCWUY.js";import{H as S}from"./chunk-MYO4NP2N.js";import{e as n}from"./chunk-NFIPKH6V.js";import{l as h}from"./chunk-5QEXLALV.js";import{w as u}from"./chunk-4PTIEWMT.js";import{b as d}from"./chunk-YOFFGXOB.js";import{a as y}from"./chunk-QBWJMFH5.js";import{f as o}from"./chunk-VTHXE323.js";var i=class extends S{constructor(e){super(e),this.dynamicDataSource=null,this.fieldsIndex=null,this.gdbVersion=null,this.infoFor3D=null,this.pbfSupported=!1,this.queryAttachmentsSupported=!1,this.sourceSpatialReference=null,this.url=null}get parsedUrl(){return F(this.url)}execute(e,t){return o(this,null,function*(){let r=yield this.executeJSON(e,t);return this.featureSetFromJSON(e,r,t)})}executeJSON(e,t){return o(this,null,function*(){let r=this._normalizeQuery(e),s=e.outStatistics?.[0]!=null,l=y("featurelayer-pbf-statistics"),c=(!s||l)&&e.returnTrueCurves!==!0,p;if(this.pbfSupported&&c)try{p=yield _(this.url,r,t)}catch(m){if(m.name!=="query:parsing-pbf")throw m;this.pbfSupported=!1}return this.pbfSupported&&c||(p=yield V(this.url,r,t)),this._normalizeFields(p.fields),p})}featureSetFromJSON(e,t,r){return o(this,null,function*(){if(!this._queryIs3DObjectFormat(e)||this.infoFor3D==null||!t.features)return g.fromJSON(t);let{meshFeatureSetFromJSON:s}=yield u(import("./chunk-3T4TTPRT.js"),r);return s(e,this.infoFor3D,t)})}executeForCount(e,t){return O(this.url,this._normalizeQuery(e),t)}executeForExtent(e,t){return Q(this.url,this._normalizeQuery(e),t)}executeForIds(e,t){return R(this.url,this._normalizeQuery(e),t)}executeRelationshipQuery(e,t){return o(this,null,function*(){let[{default:r},{executeRelationshipQuery:s}]=yield u(Promise.all([import("./chunk-CK36KIDV.js"),import("./chunk-7QD4SXVQ.js")]),t);return e=r.from(e),(this.gdbVersion||this.dynamicDataSource)&&((e=e.clone()).gdbVersion=e.gdbVersion||this.gdbVersion,e.dynamicDataSource=e.dynamicDataSource||this.dynamicDataSource),s(this.url,e,t)})}executeRelationshipQueryForCount(e,t){return o(this,null,function*(){let[{default:r},{executeRelationshipQueryForCount:s}]=yield u(Promise.all([import("./chunk-CK36KIDV.js"),import("./chunk-7QD4SXVQ.js")]),t);return e=r.from(e),(this.gdbVersion||this.dynamicDataSource)&&((e=e.clone()).gdbVersion=e.gdbVersion||this.gdbVersion,e.dynamicDataSource=e.dynamicDataSource||this.dynamicDataSource),s(this.url,e,t)})}executeAttachmentQuery(e,t){return o(this,null,function*(){let{executeAttachmentQuery:r,fetchAttachments:s,processAttachmentQueryResult:l}=yield u(import("./chunk-Q36JS53N.js"),t),c=b(this.url);return l(c,yield this.queryAttachmentsSupported?r(c,e,t):s(c,e,t))})}executeAttributeBinsQuery(e,t){return o(this,null,function*(){let{executeAttributeBinsQuery:r}=yield u(import("./chunk-Z7BTOR6Y.js"),t);return r(this.parsedUrl,e,t)})}executeTopFeaturesQuery(e,t){return o(this,null,function*(){let{executeTopFeaturesQuery:r}=yield u(import("./chunk-TAZBG2HD.js"),t);return r(this.parsedUrl,e,this.sourceSpatialReference,t)})}executeForTopIds(e,t){return o(this,null,function*(){let{executeForTopIds:r}=yield u(import("./chunk-NMOZ7T4W.js"),t);return r(this.parsedUrl,e,t)})}executeForTopExtents(e,t){return o(this,null,function*(){let{executeForTopExtents:r}=yield u(import("./chunk-GRTNTJDL.js"),t);return r(this.parsedUrl,e,t)})}executeForTopCount(e,t){return o(this,null,function*(){let{executeForTopCount:r}=yield u(import("./chunk-WV65KOGI.js"),t);return r(this.parsedUrl,e,t)})}_normalizeQuery(e){let t=D.from(e);t.sourceSpatialReference=t.sourceSpatialReference||this.sourceSpatialReference,(this.gdbVersion||this.dynamicDataSource)&&(t=t===e?t.clone():t,t.gdbVersion=e.gdbVersion||this.gdbVersion,t.dynamicDataSource=e.dynamicDataSource?f.from(e.dynamicDataSource):this.dynamicDataSource);let{infoFor3D:r}=this;if(r!=null&&this._queryIs3DObjectFormat(e)){if(t=t===e?t.clone():t,t.formatOf3DObjects=w(r),!t.formatOf3DObjects)throw new d("query:unsupported-3d-query-formats","Could not find any supported 3D object query format. Only supported formats are 3D_glb and 3D_gltf");if(t.outSpatialReference&&!x(t.outSpatialReference,this.sourceSpatialReference))throw new d("query:unsupported-out-spatial-reference","3D object feature services do not support projection of geometries");if(t.outFields==null||!t.outFields.includes("*")){t=t===e?t.clone():t,t.outFields==null&&(t.outFields=[]);let{originX:s,originY:l,originZ:c,translationX:p,translationY:m,translationZ:q,scaleX:I,scaleY:T,scaleZ:j,rotationX:v,rotationY:A,rotationZ:C,rotationDeg:J}=r.transformFieldRoles;t.outFields.push(s,l,c,p,m,q,I,T,j,v,A,C,J)}}return t}_normalizeFields(e){if(this.fieldsIndex!=null&&e!=null)for(let t of e){let r=this.fieldsIndex.get(t.name);r&&Object.assign(t,r.toJSON())}}_queryIs3DObjectFormat(e){return this.infoFor3D!=null&&e.returnGeometry===!0&&e.multipatchOption!=="xyFootprint"&&!e.outStatistics}};a([n({type:f})],i.prototype,"dynamicDataSource",void 0),a([n()],i.prototype,"fieldsIndex",void 0),a([n()],i.prototype,"gdbVersion",void 0),a([n()],i.prototype,"infoFor3D",void 0),a([n({readOnly:!0})],i.prototype,"parsedUrl",null),a([n()],i.prototype,"pbfSupported",void 0),a([n()],i.prototype,"queryAttachmentsSupported",void 0),a([n()],i.prototype,"sourceSpatialReference",void 0),a([n({type:String})],i.prototype,"url",void 0),i=a([h("esri.layers.graphics.sources.support.QueryTask")],i);var it=i;export{it as a};
