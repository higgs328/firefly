import{a as P,b as $}from"./chunk-2CC7WNFC.js";import{a as z}from"./chunk-4YTM754S.js";import{a as J,b as k,c as C}from"./chunk-6RBQSBA2.js";import{m as v}from"./chunk-ZQIC5NFT.js";import{c as x}from"./chunk-VIEK2X23.js";import{a as N}from"./chunk-7F5DJLJT.js";import{o as s}from"./chunk-AUAZP44J.js";import{a as w,b as M,f as O}from"./chunk-VTHXE323.js";function F(a,i,o){return O(this,null,function*(){let b=k(a),{rasterFunction:m,sourceJSON:H}=i||{},L=m?JSON.stringify(m.rasterFunctionDefinition||m):null,A=C(M(w({},b.query),{renderingRule:L,f:"json"})),r=J(A,o);a=b.path;let e=H||(yield s(a,r).then(t=>t.data)),E=e.hasRasterAttributeTable?s(`${a}/rasterAttributeTable`,r):null,j=e.hasColormap?s(`${a}/colormap`,r):null,q=e.hasHistograms?s(`${a}/histograms`,r):null,B=e.currentVersion>=10.3?s(`${a}/keyProperties`,r):null,W=e.hasMultidimensions?s(`${a}/multidimensionalInfo`,r):null,l=yield Promise.allSettled([E,j,q,B,W]),c=null;if(e.minValues&&e.minValues.length===e.bandCount){c=[];for(let t=0;t<e.minValues.length;t++)c.push({min:e.minValues[t],max:e.maxValues[t],avg:e.meanValues[t],stddev:e.stdvValues[t]})}let y=v.fromJSON(e.extent),S=Math.ceil(y.width/e.pixelSizeX-.1),V=Math.ceil(y.height/e.pixelSizeY-.1),f=N.fromJSON(e.spatialReference||e.extent.spatialReference),D=l[0].status==="fulfilled"?l[0].value?.data:null,X=D?.features?.length?z.fromJSON(D):null,I=l[1].status==="fulfilled"?l[1].value?.data.colormap:null,Y=I?.length?I:null,T=l[2].status==="fulfilled"?l[2].value?.data.histograms:null,U=T?.[0]?.counts?.length?T:null,u=l[3].status==="fulfilled"?l[3].value?.data??{}:{},R=l[4].status==="fulfilled"?l[4].value?.data.multidimensionalInfo:null,p=R?.variables?.length?R:null;p&&p.variables.forEach(t=>{t.statistics?.length&&t.statistics.forEach(n=>{n.avg=n.mean,n.stddev=n.standardDeviation}),t.dimensions?.forEach(n=>{n.name!=="StdTime"||n.recurring||n.unit||(n.unit="ISO8601")})});let{defaultVariable:d,serviceDataType:h}=e;d&&d!==u.DefaultVariable&&(u.DefaultVariable=d),h?.includes("esriImageServiceDataTypeVector")&&!h.includes(u.DataType)&&(u.DataType=h.replace("esriImageServiceDataType",""));let g=e.noDataValue;e.noDataValues?.length&&e.noDataValues.some(t=>t!==g)&&(g=e.noDataValues);let G=e.transposeInfo?new P({blockWidth:256,blockHeight:256,pyramidBlockWidth:256,pyramidBlockHeight:256,pyramidScalingFactor:2,compression:"lerc",origin:new x({x:e.extent.xmin,y:e.extent.ymax,spatialReference:f}),firstPyramidLevel:1,maximumPyramidLevel:Math.max(0,Math.round(Math.log(Math.max(S,V))/Math.LN2-8)),transposeInfo:e.transposeInfo}):void 0;return new $({width:S,height:V,bandCount:e.bandCount,extent:v.fromJSON(e.extent),spatialReference:f,pixelSize:new x({x:e.pixelSizeX,y:e.pixelSizeY,spatialReference:f}),pixelType:e.pixelType.toLowerCase(),statistics:c,attributeTable:X,colormap:Y,histograms:U,keyProperties:u,noDataValue:g,multidimensionalInfo:p,storageInfo:G})})}function le(a,i,o){return F(a,{sourceJSON:i},o)}function ne(a,i,o){return F(a,{rasterFunction:i},o)}function se(a,i){a.attributeTable||(i.hasRasterAttributeTable=!1),a.histograms||(i.hasHistograms=!1),a.colormap||(i.hasColormap=!1),a.multidimensionalInfo||(i.hasMultidimensions=!1)}export{le as a,ne as b,se as c};
