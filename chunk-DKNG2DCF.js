import{b as m}from"./chunk-RZU6EEB3.js";import{a as u}from"./chunk-2SXWYVJN.js";import{a as d}from"./chunk-ELUASJOG.js";import{a as g}from"./chunk-J2AEVBSH.js";import{c as b}from"./chunk-UMJIJLDA.js";import{a as v}from"./chunk-CZ6CGC7I.js";import{b as c}from"./chunk-YOFFGXOB.js";import{g as f}from"./chunk-XRGPJ3QY.js";import{a as p}from"./chunk-QBWJMFH5.js";var x=()=>f.getLogger("esri.views.2d.layers.support.clusterUtils");p.add("esri-cluster-arcade-enabled",!0);var E=p("esri-cluster-arcade-enabled"),_=new Set(["simple-line","simple-fill","picture-fill"]);function S(s,r){let e=r.clone();if(!w(e))return e;if(r.symbols.some(n=>_.has(n.type))&&(e=new g({symbol:new v})),e.authoringInfo||(e.authoringInfo=new b),e.authoringInfo.isAutoGenerated=!0,"visualVariables"in e){let n=(e.visualVariables||[]).filter(i=>i.valueExpression!=="$view.scale");n.forEach(i=>{i.type==="rotation"?i.field?i.field=t(s,i.field,"avg_angle","number"):i.valueExpression&&(i.field=o(s,i.valueExpression,"avg_angle","number"),i.valueExpression=null):i.normalizationField?(i.field=t(s,i.field,"avg_norm","number",i.normalizationField),i.normalizationField=null):i.field?i.field=t(s,i.field,"avg","number"):i.valueExpression&&(i.field=o(s,i.valueExpression,"avg","number"),i.valueExpression=null)}),e.visualVariables=n}switch(e.type){case"simple":break;case"pie-chart":for(let n of e.attributes)n.field?n.field=t(s,n.field,"sum","number"):n.valueExpression&&(n.field=o(s,n.valueExpression,"sum","number"),n.valueExpression=null);break;case"unique-value":e.field?e.field=t(s,e.field,"mode","string"):e.valueExpression&&(e.field=o(s,e.valueExpression,"mode","string"),e.valueExpression=null);break;case"class-breaks":e.normalizationField?(e.field=t(s,e.field,"avg_norm","number",e.normalizationField),e.normalizationField=null):e.field?e.field=t(s,e.field,"avg","number"):e.valueExpression&&(e.field=o(s,e.valueExpression,"avg","number"),e.valueExpression=null)}return e}var w=s=>{let r=e=>x().error(new c("Unsupported-renderer",e,{renderer:s}));if(!s)return!1;switch(s.type){case"unique-value":if(s.field2||s.field3)return r("FeatureReductionCluster does not support multi-field UniqueValueRenderers"),!1;break;case"class-breaks":if(s.normalizationField){let e=s.normalizationType;if(e!=="field")return r(`FeatureReductionCluster does not support a normalizationType of ${e}`),!1}break;case"simple":case"pie-chart":break;default:return r(`FeatureReductionCluster does not support renderers of type ${s.type}`),!1}if(!E){if("valueExpression"in s&&s.valueExpression)return r("FeatureReductionCluster does not currently support renderer.valueExpression. Support will be added in a future release"),!1;if(("visualVariables"in s&&s.visualVariables||[]).some(e=>!(!("valueExpression"in e)||!e.valueExpression)))return r("FeatureReductionCluster does not currently support visualVariables with a valueExpression. Support will be added in a future release"),!1}return!0};function y(s,r,e){switch(s){case"sum":return`cluster_sum_${r}`;case"avg":case"avg_angle":return`cluster_avg_${r}`;case"mode":return`cluster_type_${r}`;case"avg_norm":{let n=e,i="field",a=r.toLowerCase()+",norm:"+i+","+n.toLowerCase();return"cluster_avg_"+m(a)}}}function o(s,r,e,n){let i=m(r),a=e==="mode"?`cluster_type_${i}`:e==="sum"?`cluster_sum_${i}`:`cluster_avg_${i}`;return s.some(l=>l.name===a)||s.push(new u({name:a,isAutoGenerated:!0,onStatisticExpression:new d({expression:r,returnType:n}),statisticType:e})),a}function t(s,r,e,n,i){if(r==="cluster_count"||s.some(l=>l.name===r))return r;let a=y(e,r,i);return s.some(l=>l.name===a)||(e==="avg_norm"?s.push(new u({name:a,isAutoGenerated:!0,onStatisticExpression:new d({expression:`$feature.${r} / $feature.${i}`,returnType:n}),statisticType:"avg"})):s.push(new u({name:a,isAutoGenerated:!0,onStatisticField:r,statisticType:e}))),a}export{S as a,w as b};
