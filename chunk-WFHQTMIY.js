import{a as d}from"./chunk-XAZOVQGA.js";import{$ as Dt,Ea as V,G as T,Na as It,Oa as X,Ra as Q,Ta as Tt,a as c,aa as P,ab as J,b as C,g as bt,h as Et,la as Ct,ma as k,o as v,oa as B,r as w,s as Nt,t as Z,u as I,ub as A,v as H,xa as mt,za as lt}from"./chunk-V3KEO7AJ.js";var Rt=[0,0,Number.NaN,0,0,0,0,0,-1,-1,0,0,0,0],kt=[2,1,1,1,3,1,2,3,2,4,1,1,2,1],Vt=[1,1,1,0,2,1,1,1,0,0,0,0,0,1],Mt=[1,1,1,2,0,0,0,0,2,2,4,2,2,1],Ot=[4,8,4,8,1],zt=25;function _t(){return V(zt,Number.NaN)}var j=class M{getAttributeCount(){return this.m_attributeCount}getSemantics(t){return this.m_indexToSemantics[t]}getSemanticsBitArray(){return this.m_semanticsBitArray}getAttributeIndex(t){return this.m_semanticsToIndexMap[t]}static getInterpolation(t){return Vt[t]}static getPersistence(t){return Mt[t]}static getPersistenceSize(t){return Ot[t]}static getPersistenceSizeFromSemantics(t){return M.getPersistenceSize(M.getPersistence(t))*M.getComponentCount(t)}static getComponentCount(t){return kt[t]}static maxComponentCount(){return 4}static isInteger(t){return t===2||t===3||t===4}static isIntegerSemantics(t){return M.isInteger(M.getPersistence(t))}static isTexture(t){return t===5||t===6||t===7}hasAttribute(t){return!!(this.m_semanticsBitArray&1<<t)}hasAttributesFrom(t){return(this.m_semanticsBitArray&t.m_semanticsBitArray)===t.m_semanticsBitArray}hasZ(){return this.hasAttribute(1)}hasM(){return this.hasAttribute(2)}hasID(){return this.hasAttribute(3)}getTotalComponentCount(){return this.m_totalComponentCount}static getDefaultValue(t){return Rt[t]}static isDefaultValue(t,e){return It(Rt[t],e)}equals(t){return this===t}getDefaultPointAttributes(){return this.m_defaultPointAttributes}getPointAttributeOffset(t){return this.m_pointAttributeOffsets[t]}constructor(t){this.m_semanticsBitArray=t,this.m_attributeCount=0,this.m_totalComponentCount=0,this.m_semanticsToIndexMap=new Int32Array(14),this.m_indexToSemantics=new Int32Array(14),this.m_pointAttributeOffsets=new Int32Array(14),this.m_defaultPointAttributes=V(zt,Number.NaN),this.m_semanticsToIndexMap.fill(-1),this.m_indexToSemantics.fill(-1);let e=0,s=1,i=14;for(;e<i;e++)t&s&&(this.m_semanticsToIndexMap[e]=this.m_attributeCount,this.m_indexToSemantics[this.m_attributeCount]=e,this.m_attributeCount++,this.m_totalComponentCount+=M.getComponentCount(e)),s<<=1;let n=0;for(e=0,i=this.getAttributeCount();e<i;e++){let o=this.getSemantics(e),h=M.getComponentCount(o),a=M.getDefaultValue(o);this.m_pointAttributeOffsets[e]=n;for(let m=0;m<h;m++)this.m_defaultPointAttributes[n]=a,n++}}},ut=j;function Bt(){return V(14,0)}var G=class r{static getInstance(){return r.s_thisInstance}constructor(){this.m_map=new Map,this.m_vd2D=new ut(1),this.m_map.set(1,this.m_vd2D),this.m_vd3D=new ut(3),this.m_map.set(3,this.m_vd2D)}GetVD2D(){return this.m_vd2D}GetVD3D(){return this.m_vd3D}FindOrAdd(t){if(t===1)return this.GetVD2D();if(t===3)return this.GetVD3D();let e=this.m_map.get(t);if(e)return e;let s=new ut(t);return this.m_map.set(t,s),s}};function vt(r){return G.getInstance().FindOrAdd(r)}function St(r,t){if(!r||!t)return t||r;let e=r.getSemanticsBitArray()|t.getSemanticsBitArray();return(e&r.getSemanticsBitArray())===e?r:(e&t.getSemanticsBitArray())===e?t:vt(e)}function Lt(r,t){let e=r.getSemanticsBitArray()|1<<t;return(e&r.getSemanticsBitArray())===e?r:vt(e)}function Pt(r,t){let e=(r.getSemanticsBitArray()|1<<t)-(1<<t);return e===r.getSemanticsBitArray()?r:vt(e)}function O(){return G.getInstance().GetVD2D()}function Yt(){return G.getInstance().GetVD3D()}function Ft(r,t,e){if(e.fill(-1),r!==null&&t!==null)for(let s=0,i=r.getAttributeCount();s<i;s++)e[s]=t.getAttributeIndex(r.getSemantics(s))}G.s_thisInstance=new G;var wt=(()=>{class r{static construct(e,s,i){return new r(e,s,i)}constructor(e,s,i){e!==void 0?(this.x=e,this.y=s,this.z=i):this.x=this.y=this.z=Number.NaN}get 0(){return this.x}get 1(){return this.y}get 2(){return this.z}set 0(e){this.x=e}set 1(e){this.y=e}set 2(e){this.z=e}clone(){return new r(this.x,this.y,this.z)}assign(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}setCoords(e,s,i){return this.x=e,this.y=s,this.z=i,this}setCoordsPoint2DZ(e,s){return this.setCoords(e.x,e.y,s)}setCoordsPoint3D(e){this.x=e.x,this.y=e.y,this.z=e.z}setZero(){this.x=0,this.y=0,this.z=0}setNormalized(e){this.assign(e),this.normalizeThis()}normalizeThis(){let e=this.length();return e?(this.x/=e,this.y/=e,this.z/=e):(this.x=1,this.y=0,this.z=0),this}getUnitVector(){let e=new r;return e.setNormalized(this),e}sqrLength(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}lengthXY(){return c(0),0}static sqrDistance(e,s){return P(e.x-s.x)+P(e.y-s.y)+P(e.z-s.z)}static sqrDistanceCoords(e,s,i,n,o,h){return P(e-n)+P(s-o)+P(i-h)}static distance(e,s){return Math.sqrt(r.sqrDistance(e,s))}isEqual(e,s){return s===void 0&&(s=0),Math.abs(this.x-e.x)<=s&&Math.abs(this.y-e.y)<=s&&X(this.z,e.z,s)}static compareByLength(e,s,i,n){return c(0),0}isEqualCoords(e,s,i,n){return c(0),this.x===e&&this.y===s&&this.z===i}isEqualsTols(e,s,i){return c(0),!1}isEqualCoordsTols(e,s,i,n,o){return c(0),!1}static st_isEqual(e,s,i,n){return c(0),!1}equals(e,s){return this.isEqual(e,s)}equalsTols(e,s,i){return c(0),!1}divThis(e){return this.x/=e,this.y/=e,this.z/=e,this}subThis(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}setSub(e,s){return this.x=e.x-s.x,this.y=e.y-s.y,this.z=e.z-s.z,this}sub(e){return r.construct(this.x-e.x,this.y-e.y,this.z-e.z)}addThis(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}add(e){return this.clone().addThis(e)}setAdd(e,s){return this.x=e.x+s.x,this.y=e.y+s.y,this.z=e.z+s.z,this}mul(e){return r.construct(this.x*e,this.y*e,this.z*e)}dotProduct(e){return this.x*e.x+this.y*e.y+this.z*e.z}crossProductVector(e){let s=this.y*e.z-e.y*this.z,i=e.x*this.z-this.x*e.z,n=this.x*e.y-e.x*this.y;return new r(s,i,n)}setCrossProductVector(e,s){let i=e.y*s.z-s.y*e.z,n=s.x*e.z-e.x*s.z,o=e.x*s.y-s.x*e.y;return this.x=i,this.y=n,this.z=o,this}setScaled(e,s){return this.x=e*s.x,this.y=e*s.y,this.z=e*s.z,this}scaleThis(e){return this.x*=e,this.y*=e,this.z*=e,this}scaleZThis(e){return this.z*=e,this}setNAN(){return c(0),this}isNAN(){return Number.isNaN(this.x)||Number.isNaN(this.y)||Number.isNaN(this.z)}static getNAN(){return r.construct(Number.NaN,Number.NaN,Number.NaN)}isFinite(){return c(0),!1}isZero(){return this.x===0&&this.y===0&&this.z===0}norm(e){return c(0),0}sqrDistanceFromCenterToSpheroidSurface(e,s){return c(0),0}distanceFromCenterToSpheroidSurface(e,s){return Math.sqrt(this.sqrDistanceFromCenterToSpheroidSurface(e,s))}static getClosestCoordinate(e,s,i,n=!1){return c(0),0}compare(e){return this.y<e.y?-1:this.y>e.y?1:this.x<e.x?-1:this.x>e.x?1:this.z<e.z?-1:this.z>e.z?1:0}compareXYZ(e){return c(0),0}negateThis(){this.x=-this.x,this.y=-this.y,this.z=-this.z}static averageFast(e,s){return c(0),{}}static average(e,s){return c(0),{}}static size(){return r.dimensions}static lerp(e,s,i){let n=new r;return Dt(e,s,i,n),n}static slerp(e,s,i){return c(0),{}}static compareVectors(e,s){return c(0),0}static selectRightHandedBasisFromNormal(e,s,i){let n=e.getUnitVector(),o=n.createAPerpendicular(),h=new r;h.setCrossProductVector(n,o),h.normalizeThis(),s.setCoordsPoint3D(o),i.setCoordsPoint3D(h)}createAPerpendicular(){let e=[this.crossProductVector(new r(0,0,1)),this.crossProductVector(new r(1,0,0)),this.crossProductVector(new r(0,1,0))],s=[e[0].sqrLength(),e[1].sqrLength(),e[2].sqrLength()],i=e[s.reduce((n,o,h)=>s[n]>s[h]?n:h,0)];return i.normalizeThis(),i}calculateAngle(e){return c(0),0}static crossDotSign(e,s,i){return c(0),0}static isBisectorRobust(e,s,i){return c(0),0}static compareZOrder(e,s){return c(0),!1}}return r.dimensions=3,r})(),dt=class r{static constructEmpty(){return new r(Number.NaN,Number.NaN,Number.NaN,Number.NaN,Number.NaN,Number.NaN)}constructor(t,e,s,i,n,o){this.m_EnvelopeType=3,this.xmin=t,this.ymin=e,this.zmin=s,this.xmax=i,this.ymax=n,this.zmax=o,this.normalize()}inflate(t){this.inflateCoords(t,t,t)}inflateCoords(t,e,s){c(0)}getEnvelope2D(){return new d(this.xmin,this.ymin,this.xmax,this.ymax)}getEnvelopeZs(){return new T(this.zmin,this.zmax)}setEmptyZ(){this.zmin=Number.NaN,this.zmax=Number.NaN}normalize(){let t=!1;this.xmin<=this.xmax||(this.xmax=B(this.xmin,this.xmin=this.xmax),t=!0),this.ymin<=this.ymax||(this.ymax=B(this.ymin,this.ymin=this.ymax),t=!0),!t||this.xmin<=this.xmax&&this.ymin<=this.ymax?this.zmin<=this.zmax||(this.zmax=B(this.zmin,this.zmin=this.zmax),this.zmin<=this.zmax||this.setEmptyZ()):this.setEmpty()}isEmpty(){return Number.isNaN(this.xmin)||Number.isNaN(this.ymin)||Number.isNaN(this.xmax)||Number.isNaN(this.ymax)}isEmptyZ(){return Number.isNaN(this.zmin)||Number.isNaN(this.zmax)}setEmpty(){this.xmin=Number.NaN,this.ymin=Number.NaN,this.zmin=Number.NaN,this.xmax=Number.NaN,this.ymax=Number.NaN,this.zmax=Number.NaN}mergeEnv3D(t){t.isEmpty()||(this.mergeCoords(t.xmin,t.ymin,t.zmin),this.mergeCoords(t.xmax,t.ymax,t.zmax))}mergeNe(t){this.mergeNeCoords(t.x,t.y,t.z)}mergeNeCoords(t,e,s){this.xmin>t?this.xmin=t:this.xmax<t&&(this.xmax=t),this.ymin>e?this.ymin=e:this.ymax<e&&(this.ymax=e),this.zmin>s?this.zmin=s:this.zmax<s&&(this.zmax=s)}mergeCoords(t,e,s){this.isEmpty()?(this.xmin=t,this.xmax=t,this.ymin=e,this.ymax=e,this.zmin=s,this.zmax=s):(this.isEmptyZ()&&(this.zmin=s,this.zmax=s),this.mergeNeCoords(t,e,s))}setCoords(t,e,s,i,n,o){this.xmin=t,this.ymin=e,this.zmin=s,this.xmax=i,this.ymax=n,this.zmax=o,this.normalize()}sqrDistanceEnvelope3DAndPoints(t,e,s,i=1){return c(0),0}sqrMaxDistance(t,e=1){return c(0),0}},ie=-559038737,Y=j;function Ht(r,t,e){switch(r){case 0:return new ct(t,e);case 1:return new tt(t,e);case 2:return new L(t,e);case 3:throw new Error("64 bit int attribute stream not implemented");case 4:return new $(t,e);default:v("")}}function ne(r,t){let e=Y.getComponentCount(r);return Ht(Y.getPersistence(r),t*e,Y.getDefaultValue(r))}function re(r,t){let e=Y.getComponentCount(r);return Ht(Y.getPersistence(r),t*e)}function oe(r,t){return new L(r,t)}function he(r,t){return new $(r,t)}function ae(r,t){return new tt(r,t)}var U=class r{size(){return this.m_size}checkResize(t,e){t>this.m_size&&this.resize(t,e)}resize(t,e){if((t=Math.trunc(t))===this.m_size)return;let s=!!e||Number.isNaN(e);if(t<this.m_a.length)this.m_a.length>r.s_resizeMin&&1.25*t<this.m_a.length&&(this.m_a=this.m_a.slice(0,t)),s&&t>this.m_size&&this.m_a.fill(e,this.m_size,t);else if(t>=this.m_a.length){let i=1.25*t,n=new this.m_a.constructor(i);n.set(this.m_a),this.m_a=n,s&&this.m_a.fill(e,this.m_size,t)}this.m_size=t}resizeRounded(t,e){return this.resize(t,e)}reserve(t){}read(t){return this.m_a[t]}readAsDbl(t){return this.read(t)}write(t,e){this.m_a[t]=e}writeAsDbl(t,e){this.write(t,e)}setRange(t,e,s){(e<0||s<0||s+e>this.size())&&v(),this.m_a.fill(t,e,e+s)}add(t){this.resize(this.m_size+1),this.m_a[this.m_size-1]=t}addArray(t,e){let s=this.m_size;e===void 0?(this.resize(this.m_size+t.length),this.m_a.set(t,s)):(this.resize(this.m_size+e),this.m_a.set(t.slice(0,e),s))}equals(t,e,s,i){return this.getPersistence()!==t.getPersistence()?!1:Ut(this,t,e,s,i)}insertRange(t,e,s,i){let n=this.m_size;this.checkResize(Math.max(0,i)+s),this.m_a.copyWithin(t+s,t,i>=0?i:n),this.m_a.fill(e,t,t+s)}readRange(t,e){return this.m_a.slice(t,t+e)}insertRangeFromStream(t,e,s,i,n,o,h){c(this.getPersistence()===e.getPersistence());let a=e,m=this.m_size;i&&this.checkResize(Math.max(0,h)+i),this.m_a.copyWithin(t+i,t,h>=0?h:m),this.m_a.set(a.readRange(s,i),t),n||this.reverseRange(t,i,o)}writeRange(t,e,s,i,n,o){c(this.getPersistence()===s.getPersistence());let h=s;if((t<0||e<0||i<0)&&v(),h.size()<i+e&&v(),e===0)return;this.size()<e+t&&this.resize(e+t);let a=h.m_a.subarray(i,i+e);Gt(this.m_a,t,e,a)}insertAttributes(t,e,s,i){let n=Y.getComponentCount(s);this.m_a.copyWithin(t+n,t,i>=0?i:this.m_size);for(let o=0;o<n;o++)this.m_a[t+o]=e.getAttributeAsDbl(s,o)}insertAttributesFromPoints(t,e,s,i,n){c(Y.getPersistence(i)===this.getPersistence());let o=Y.getComponentCount(i),h=this.m_size;if(this.checkResize(Math.max(0,n)+o*s),this.m_a.copyWithin(t+o*s,t,n>=0?n:h),i===0){let a=new A;for(let m=t,l=0;l<s;l++,m+=2)e[l].queryXY(a),this.m_a[m]=a.x,this.m_a[m+1]=a.y}else if(o===1)for(let a=t,m=0;m<s;m++,a++)this.m_a[a]=e[m].getAttributeAsDbl(i,0);else for(let a=t,m=0;m<s;m++,a+=o)for(let l=0;l<o;l++)this.m_a[a+l]=e[m].getAttributeAsDbl(i,l)}eraseRange(t,e,s){this.m_size<t+e&&v(),this.m_a.copyWithin(t,t+e),this.m_size-=e}reverseRange(t,e,s){if((s<1||e%s!=0)&&v(),this.m_a.subarray(t,t+e).reverse(),s>1)for(let i=t,n=t+e;i<n;i+=s){let o=i,h=i+s-1;for(;o<h;){let a=this.m_a[o];this.m_a[o]=this.m_a[h],this.m_a[h]=a,o++,h--}}}rotate(t,e,s){(e<t||e>s||t>s)&&I("rotate"),e!==t&&e!==s&&(this.reverseRange(t,e-t,1),this.reverseRange(e,s-e,1),this.reverseRange(t,s-t,1))}sort(t,e,s){this.m_a.subarray(t,e).sort(s)}constructor(t){if(t.move)this.m_a=t.move.m_a,this.m_size=t.move.m_size,t.move.m_a=t.move.m_a.slice(0,0),t.move.m_size=0;else if(t.copy)this.m_size=t.copy.m_size,t.maxSize&&(this.m_size=Math.min(t.maxSize,this.m_size)),this.m_a=t.copy.m_a.slice(0,this.m_size);else{let e=Math.max(t.size,r.s_constructMin);this.m_a=new t.ctor(e),(t.defaultValue||Number.isNaN(t.defaultValue))&&this.m_a.fill(t.defaultValue),this.m_size=t.size}}};U.s_constructMin=2,U.s_resizeMin=30;var $=class r extends U{setBits(t,e){this.m_a[t]|=e}clearBits(t,e){this.m_a[t]&=~e}getPersistence(){return 4}clone(){return new r({ctor:Int8Array,copy:this})}restrictedClone(t){return new r({ctor:Int8Array,copy:this,maxSize:t})}constructor(t,e){super(typeof t=="number"?{ctor:Int8Array,size:t,defaultValue:e}:t)}},L=class r extends U{getPersistence(){return 2}clone(){return new r({ctor:Int32Array,copy:this})}restrictedClone(t){return new r({ctor:Int32Array,copy:this,maxSize:t})}write(t,e){c(e<=Tt()),super.write(t,e)}constructor(t,e){super(typeof t=="number"?{ctor:Int32Array,size:t,defaultValue:e}:t)}},ct=class r extends U{getPersistence(){return 0}clone(){return new r({ctor:Float32Array,copy:this})}restrictedClone(t){return new r({ctor:Float32Array,copy:this,maxSize:t})}constructor(t,e){super(typeof t=="number"?{ctor:Float32Array,size:t,defaultValue:e}:t)}},tt=class r extends U{getPersistence(){return 1}getArray(){return this.m_a}applyTransformation(t,e,s){(1&e||e+2*s>this.size())&&v();let i=e===0?this.m_a:this.m_a.subarray(e);t.transformInterleavedPoints(i,s,i)}readPoint2D(t){let e=this.m_a[t],s=this.m_a[t+1];return new A(e,s)}queryPoint2D(t,e){return e.x=this.m_a[t],e.y=this.m_a[t+1],e}writePoint2D(t,e){this.write(t,e.x),this.write(t+1,e.y)}insert(t,e,s){this.checkResize(s+2),this.m_a.copyWithin(t+2,t,s),this.m_a[t]=e.x,this.m_a[t+1]=e.y}insertRangeFromPoints(t,e,s,i,n,o){let h=this.m_size;if(this.checkResize(Math.max(o,0)+2*i),this.m_a.copyWithin(t+2*i,t,o>=0?o:h),n)for(let a=s,m=t,l=0;l<i;++l,++a){let _=e[a];this.m_a[m++]=_.x,this.m_a[m++]=_.y}else for(let a=s+i-1,m=t,l=0;l<i;++l,--a){let _=e[a];this.m_a[m++]=_.x,this.m_a[m++]=_.y}}queryRange(t,e,s,i,n){if((t<0||e<0)&&v(),!i&&(n<=0||e%n!=0)&&v(),e===0)return;if(e===1)return void(s[0]=this.m_a[t]);let o=this.m_a.subarray(t,t+e);s.set(o)}writeRangeFromArray(t,e,s,i,n){if((t<0||e<0)&&v(),e===0)return;if(e===1)return void(this.m_a[t]=s[0]);let o=s;e<s.length&&(o=s.subarray(0,e)),this.m_a.set(o,t)}clone(){return new r({ctor:Float64Array,copy:this})}restrictedClone(t){return new r({ctor:Float64Array,copy:this,maxSize:t})}constructor(t,e){super(typeof t=="number"?{ctor:Float64Array,size:t,defaultValue:e}:t)}};function Ut(r,t,e,s,i){if(r.getPersistence()!==t.getPersistence())return!1;let n=r.getPersistence()<=1,o=r.size(),h=t.size();if(s>o||s>h)return!1;if(i)if(n){for(let a=e;a<s;a++)if(!X(r.read(a),t.read(a),i))return!1}else for(let a=e;a<s;a++){let m=r.read(a)-t.read(a);if(m<0&&(m=-m),m>i)return!1}else for(let a=e;a<s;a++){let m=r.read(a),l=t.read(a);if(m!==l){if(n&&Number.isNaN(m)&&Number.isNaN(l))continue;return!1}}return!0}function Gt(r,t,e,s,i,n){if((t<0||e<0)&&v(),e===0)return;if(e===1)return void(r[t]=s[0]);let o=s;e<s.length&&(o=s.subarray(0,e)),r.set(o,t)}var yt=(()=>{class r{constructor(){this.m_minValue=-1,this.m_maxValue=-1,this.m_dy=Number.NaN,this.m_buckets=new L(0),this.m_bucketedIndices=new L(0)}static sortEx(e,s,i,n,o=32){if(i-s<=o)return void n.userSort(s,i,e);new r().sort(e,s,i,n,o)}sort(e,s,i,n,o=32){if(i-s<=o)return void n.userSort(s,i,e);let h=!0,a=Number.POSITIVE_INFINITY,m=Number.NEGATIVE_INFINITY;for(let _=s;_<i;_++){let u=n.getValue(e.read(_));u<a&&(a=u),u>m&&(m=u)}if(this.reset(i-s,a,m,i-s)){for(let u=s;u<i;u++){let p=e.read(u),x=n.getValue(p),g=this.getBucket(x);this.m_buckets.write(g,this.m_buckets.read(g)+1),this.m_bucketedIndices.write(u-s,p)}let _=this.m_buckets.read(0);this.m_buckets.write(0,0);for(let u=1,p=this.m_buckets.size();u<p;u++){let x=this.m_buckets.read(u);this.m_buckets.write(u,_),_+=x}for(let u=s;u<i;u++){let p=this.m_bucketedIndices.read(u-s),x=n.getValue(p),g=this.getBucket(x),y=this.m_buckets.read(g);e.write(y+s,p),this.m_buckets.write(g,y+1)}h=!1}if(h)return void n.userSort(s,i,e);let l=0;for(let _=0,u=this.m_buckets.size();_<u;_++){let p=l;l=this.m_buckets.read(_),l>p&&n.userSort(s+p,s+l,e)}this.m_buckets.size()>100&&(this.m_buckets.resize(0),this.m_bucketedIndices.resize(0))}reset(e,s,i,n){if(e<2||i===s)return!1;let o=Math.min(r.c_maxBuckets,e);return this.m_buckets.resize(o),this.m_buckets.setRange(0,0,this.m_buckets.size()),this.m_minValue=s,this.m_maxValue=i,this.m_bucketedIndices.resize(n),this.m_dy=(i-s)/(o-1),!0}getBucket(e){return Math.trunc((e-this.m_minValue)/this.m_dy)}getBucketCount(){return this.m_buckets.size()}}return r.c_maxBuckets=65536,r})(),E=class r{constructor(t){this.m_buffer=null,this.m_firstFree=-1,this.m_last=0,this.m_size=0,this.m_capacity=0,this.m_bufferSize=0,this.m_stride=0,this.m_stride=t,this.m_realStride=t,this.m_blockSize=Math.trunc(r.st_realBlockSize/this.m_realStride)}dbgdelete_(t){return this.m_buffer[t>>r.st_blockPower][1+(t&r.st_blockMask)]=r.st_deadVertex,!0}deleteElement(t){(t>>r.st_blockPower)*this.m_blockSize*this.m_realStride+(t&r.st_blockMask)<this.m_last*this.m_realStride?(this.m_buffer[t>>r.st_blockPower][t&r.st_blockMask]=this.m_firstFree,this.m_firstFree=t):this.m_last--,this.m_size--}getField(t,e){return this.m_buffer[t>>r.st_blockPower][(t&r.st_blockMask)+e]}setField(t,e,s){this.m_buffer[t>>r.st_blockPower][(t&r.st_blockMask)+e]=s}getStride(){return this.m_stride}newElement(){let t=this.m_firstFree;if(t===-1){if(this.m_last===this.m_capacity){let i=this.m_capacity!==0?Math.trunc(2*(this.m_capacity+1)):1;this.grow(i)}t=(this.m_last/this.m_blockSize<<r.st_blockPower)+this.m_last%this.m_blockSize*this.m_realStride,this.m_last++}else this.m_firstFree=this.m_buffer[t>>r.st_blockPower][t&r.st_blockMask];this.m_size++;let e=this.m_buffer[t>>r.st_blockPower],s=t&r.st_blockMask;for(let i=0;i<this.m_stride;i++)e[s+i]=-1;return t}elementToIndex(t){return(t>>r.st_blockPower)*this.m_blockSize+(t&r.st_blockMask)/this.m_realStride}deleteAll(t){this.m_firstFree=-1,this.m_last=0,this.m_size=0,t&&(this.m_buffer=null,this.m_capacity=0)}size(){return this.m_size}setCapacity(t){t>this.m_capacity&&this.grow(t)}capacity(){return this.m_capacity}swap(t,e){let s=this.m_buffer[t>>r.st_blockPower],i=this.m_buffer[e>>r.st_blockPower],n=t&r.st_blockMask,o=e&r.st_blockMask;for(let h=0;h<this.m_stride;h++){let a=s[n+h];s[n+h]=i[o+h],i[o+h]=a}}swapField(t,e,s){let i=this.m_buffer[t>>r.st_blockPower],n=this.m_buffer[e>>r.st_blockPower],o=(t&r.st_blockMask)+s,h=(e&r.st_blockMask)+s,a=i[o];i[o]=n[h],n[h]=a}static impossibleIndex2(){return-2}static impossibleIndex3(){return-3}static isValidElement(t){return t>=0}ensureBufferBlocksCapacity(t){if(this.m_buffer.length<t){let e=new Array(t);for(let s=0;s<this.m_buffer.length;s++)e[s]=this.m_buffer[s];this.m_buffer=e}}grow(t){this.m_buffer===null&&(this.m_bufferSize=0,this.m_buffer=new Array(8));let e=Math.trunc((t+this.m_blockSize-1)/this.m_blockSize);if(this.ensureBufferBlocksCapacity(e),e===1){let s=0,i=t*this.m_realStride;for(;i>r.st_sizes[s];)s++;let n=new Int32Array(r.st_sizes[s]);this.m_bufferSize===1?(n.set(this.m_buffer[0]),this.m_buffer[0]=n):(this.m_buffer[this.m_bufferSize]=n,this.m_bufferSize++),this.m_capacity=Math.trunc(n.length/this.m_realStride)}else{if(this.m_bufferSize===1&&this.m_buffer[0].length<r.st_realBlockSize){let s=new Int32Array(r.st_realBlockSize);s.set(this.m_buffer[0]),this.m_buffer[0]=s,this.m_capacity=this.m_blockSize}for(;this.m_bufferSize<e;)this.m_buffer[this.m_bufferSize++]=new Int32Array(r.st_realBlockSize),this.m_capacity+=this.m_blockSize}}};function Zt(r,t){return{element:r,box:t.clone()}}E.st_realBlockSize=16384,E.st_blockMask=16383,E.st_blockPower=14,E.st_sizes=[16,32,64,128,256,512,1024,2048,4096,8192,16384],E.st_deadVertex=-2125315821;var F=class r{constructor(t,e,s){this.m_extent=new d,this.m_dataExtent=new d,this.m_childExtents=[new d,new d,new d,new d],this.m_elementNodes=new E(4),this.m_data=[],this.m_freeData=[],this.m_root=-1,this.m_height=8,s===void 0&&(s=!1),this.m_quadTreeNodes=new E(s?11:10),this.m_bStoreDuplicates=s,this.reset_(t,e)}reset(t,e){this.m_quadTreeNodes.deleteAll(!1),this.m_elementNodes.deleteAll(!1),this.m_data.length=0,this.m_freeData.length=0,this.reset_(t,e)}insert(t,e){if(this.m_root===-1&&this.createRoot_(),this.m_bStoreDuplicates){let i=this.insertDuplicates_(t,e,0,this.m_extent,this.m_root,!1,-1);return i!==-1&&(this.m_dataExtent.isEmpty()?this.m_dataExtent.setCoords({env2D:e}):this.m_dataExtent.mergeEnvelope2D(e)),i}let s=this.insert_(t,e,0,this.m_extent,this.m_root,!1,-1);return s!==-1&&(this.m_dataExtent.isEmpty()?this.m_dataExtent.setCoords({env2D:e}):this.m_dataExtent.mergeEnvelope2D(e)),s}insertEx(t,e,s){if(this.m_root===-1&&this.createRoot_(),this.m_bStoreDuplicates){let a=this.insertDuplicates_(t,e,0,this.m_extent,this.m_root,!1,-1);return a!==-1&&(this.m_dataExtent.isEmpty()?this.m_dataExtent.setCoords({env2D:e}):this.m_dataExtent.mergeEnvelope2D(e)),a}let i;i=s===-1?this.m_root:this.getQuad_(s);let n=this.getHeight(i),o=this.getExtent(i),h=this.insert_(t,e,n,o,i,!1,-1);return h!==-1&&(this.m_dataExtent.isEmpty()?this.m_dataExtent.setCoords({env2D:e}):this.m_dataExtent.mergeEnvelope2D(e)),h}removeElement(t){c(0)}getElement(t){return this.getElementValue_(this.getData_(t))}getElementAtIndex(t){return c(0),0}getElementExtent(t){let e=this.getData_(t);return this.getBoundingBoxValue_(e).clone()}getElementExtentAtIndex(t){return c(0),{}}getDataExtent(){return this.m_dataExtent.clone()}getQuadTreeExtent(){return c(0),{}}getHeight(t){return this.m_quadTreeNodes.getField(t,6)>>r.m_heightBitShift}getMaxHeight(){return this.m_height}getExtent(t){let e=new d;if(e.setCoords({env2D:this.m_extent}),t===this.m_root)return e;let s=[],i=t;do s.push(this.getQuadrant_(i)),i=this.getParent_(i);while(i!==this.m_root);let n=s.length;for(let o=0;o<n;o++){let h=s.at(-1);s.pop(),h===0?(e.xmin=.5*(e.xmin+e.xmax),e.ymin=.5*(e.ymin+e.ymax)):h===1?(e.xmax=.5*(e.xmin+e.xmax),e.ymin=.5*(e.ymin+e.ymax)):h===2?(e.xmax=.5*(e.xmin+e.xmax),e.ymax=.5*(e.ymin+e.ymax)):(e.xmin=.5*(e.xmin+e.xmax),e.ymax=.5*(e.ymin+e.ymax))}return e}getQuad(t){return this.getQuad_(t)}getElementCount(){return this.m_root===-1?0:this.getSubTreeElementCount_(this.m_root)}getSubTreeElementCount(t){return this.getSubTreeElementCount_(t)}getContainedSubTreeElementCount(t){return this.m_bStoreDuplicates?this.getContainedSubTreeElementCount_(t):this.getSubTreeElementCount_(t)}getIntersectionCount(t,e,s){if(this.m_root===-1)return 0;let i=new d;i.setCoords({env2D:t}),i.inflateCoords(e,e);let n=[],o=[];n.push(this.m_root),o.push(this.m_extent.clone());let h=lt(d,4),a=0;for(;n.length>0;){let m=!1,l=n.at(-1),_=o.at(-1);if(n.pop(),o.pop(),i.containsEnvelope(_)){if(a+=this.getSubTreeElementCount(l),s>0&&a>=s)return s}else if(i.isIntersecting(_)){for(let u=this.getFirstElement_(l);u!==-1;u=this.getNextElement_(u)){let p=this.getData_(u);if(this.getBoundingBoxValue_(p).isIntersecting(i)&&(a++,s>0&&a>=s))return s}m=this.getHeight(l)+1<=this.m_height}if(m){r.setChildExtents_(_,h);for(let u=0;u<4;u++){let p=this.getChild_(l,u);p!==-1&&this.getSubTreeElementCount_(p)>0&&i.isIntersecting(h[u])&&(n.push(p),o.push(h[u].clone()))}}}return a}hasData(t,e){return this.getIntersectionCount(t,e,1)>=1}getIterator(t,e){return new et(this,t,e)}getIteratorForQT(){return new et(this)}getSortedIterator(t,e){return new st(this.getIterator(t,e))}getSortedIteratorForQT(){return new st(this.getIteratorForQT())}visitLeavesNearest(t,e,s,i){c(0)}reset_(t,e){(e<0||e>127)&&v("invalid height"),this.m_height=e,this.m_extent.setCoords({env2D:t}),this.m_dataExtent.setEmpty(),this.m_root=-1}insert_(t,e,s,i,n,o,h){if(!i.containsEnvelope(e))return s===0?-1:this.insert_(t,e,0,this.m_extent,this.m_root,o,h);if(!o)for(let _=n;_!==-1;_=this.getParent_(_))this.setSubTreeElementCount_(_,this.getSubTreeElementCount_(_)+1);let a=new d;a.setCoords({env2D:i});let m,l=n;for(m=s;m<this.m_height&&this.canPushDown_(l);m++){r.setChildExtents_(a,this.m_childExtents);let _=!1;for(let u=0;u<4;u++)if(this.m_childExtents[u].containsEnvelope(e)){_=!0;let p=this.getChild_(l,u);p===-1&&(p=this.createChild_(l,u)),this.setSubTreeElementCount_(p,this.getSubTreeElementCount_(p)+1),l=p,a.setCoords({env2D:this.m_childExtents[u]});break}if(!_)break}return this.insertAtQuad_(t,e,m,a,l,o,n,h,-1)}insertDuplicates_(t,e,s,i,n,o,h){if(!o){if(!i.containsEnvelope(e))return-1;this.setSubTreeElementCount_(n,this.getSubTreeElementCount_(n)+1),this.setContainedSubTreeElementCount_(n,this.getContainedSubTreeElementCount_(n)+1)}let a=Math.max(e.width(),e.height()),m=-1,l=[],_=[],u=[];l.push(n),_.push(i.clone()),u.push(s);let p=lt(d,4);for(;l.length>0;){let x=!1,g=l.at(-1),y=_.at(-1),b=u.at(-1);if(l.pop(),_.pop(),u.pop(),b+1<this.m_height&&this.canPushDown_(g)&&a<=Math.max(y.width(),y.height())/2&&(x=!0),x){r.setChildExtents_(y,p);let D=!1;for(let N=0;N<4;N++)if(D=p[N].containsEnvelope(e),D){let f=this.getChild_(g,N);f===-1&&(f=this.createChild_(g,N)),l.push(f),_.push(p[N].clone()),u.push(b+1),this.setSubTreeElementCount_(f,this.getSubTreeElementCount_(f)+1),this.setContainedSubTreeElementCount_(f,this.getContainedSubTreeElementCount_(f)+1);break}if(!D){for(let N=0;N<4;N++)if(p[N].isIntersecting(e)){let f=this.getChild_(g,N);f===-1&&(f=this.createChild_(g,N)),l.push(f),_.push(p[N].clone()),u.push(b+1),this.setSubTreeElementCount_(f,this.getSubTreeElementCount_(f)+1)}}}else m=this.insertAtQuad_(t,e,b,y,g,o,n,h,m),o=!1}return 0}insertAtQuad_(t,e,s,i,n,o,h,a,m){this.getFirstElement_(n);let l=this.getLastElement_(n),_=-1;if(o){if(n===h)return a;this.disconnectElementHandle_(a),_=a}else m===-1?(_=this.createElement_(),this.setDataValues_(this.getData_(_),t,e)):_=this.createElementFromDuplicate_(m);return this.setQuad_(_,n),l!==-1?(this.setPrevElement_(_,l),this.setNextElement_(l,_)):this.setFirstElement_(n,_),this.setLastElement_(n,_),this.setLocalElementCount_(n,this.getLocalElementCount_(n)+1),this.canFlush_(n)&&this.flush_(s,i,n),_}static setChildExtents_(t,e){let s=.5*(t.xmin+t.xmax),i=.5*(t.ymin+t.ymax);e[0].setCoords({xmin:s,ymin:i,xmax:t.xmax,ymax:t.ymax}),e[1].setCoords({xmin:t.xmin,ymin:i,xmax:s,ymax:t.ymax}),e[2].setCoords({xmin:t.xmin,ymin:t.ymin,xmax:s,ymax:i}),e[3].setCoords({xmin:s,ymin:t.ymin,xmax:t.xmax,ymax:i})}disconnectElementHandle_(t){let e=this.getQuad_(t),s=this.getFirstElement_(e),i=this.getLastElement_(e),n=this.getPrevElement_(t),o=this.getNextElement_(t);s===t?(o!==-1?this.setPrevElement_(o,-1):this.setLastElement_(e,-1),this.setFirstElement_(e,o)):i===t?(this.setNextElement_(n,-1),this.setLastElement_(e,n)):(this.setPrevElement_(o,n),this.setNextElement_(n,o)),this.setPrevElement_(t,-1),this.setNextElement_(t,-1),this.setLocalElementCount_(e,this.getLocalElementCount_(e)-1)}canFlush_(t){return this.getLocalElementCount_(t)===r.m_flushingCount&&!this.hasChildren_(t)}flush_(t,e,s){let i,n=new d,o=this.getFirstElement_(s),h=-1,a=-1;do a=this.getData_(o),i=this.getElementValue_(a),n.setCoords({env2D:this.getBoundingBoxValue_(a)}),h=this.getNextElement_(o),this.m_bStoreDuplicates?this.insertDuplicates_(i,n,t,e,s,!0,o):this.insert_(i,n,t,e,s,!0,o),o=h;while(o!==-1)}canPushDown_(t){return this.getLocalElementCount_(t)>=r.m_flushingCount||this.hasChildren_(t)}hasChildren_(t){return this.getChild_(t,0)!==-1||this.getChild_(t,1)!==-1||this.getChild_(t,2)!==-1||this.getChild_(t,3)!==-1}createChild_(t,e){let s=this.m_quadTreeNodes.newElement();return this.setChild_(t,e,s),this.setSubTreeElementCount_(s,0),this.setLocalElementCount_(s,0),this.setParent_(s,t),this.setHeightAndQuadrant_(s,this.getHeight_(t)+1,e),this.m_bStoreDuplicates&&this.setContainedSubTreeElementCount_(s,0),s}createRoot_(){this.m_root=this.m_quadTreeNodes.newElement(),this.setSubTreeElementCount_(this.m_root,0),this.setLocalElementCount_(this.m_root,0),this.setHeightAndQuadrant_(this.m_root,0,0),this.m_bStoreDuplicates&&this.setContainedSubTreeElementCount_(this.m_root,0)}createElement_(){let t=this.m_elementNodes.newElement(),e;return this.m_freeData.length>0?(e=this.m_freeData.at(-1),this.m_freeData.pop()):(e=this.m_data.length,this.m_data.length=e+1),this.setData_(t,e),t}createElementFromDuplicate_(t){let e=this.m_elementNodes.newElement(),s=this.getData_(t);return this.setData_(e,s),e}freeElementAndBoxNode_(t){c(0)}getChild_(t,e){return this.m_quadTreeNodes.getField(t,e)}setChild_(t,e,s){this.m_quadTreeNodes.setField(t,e,s)}getFirstElement_(t){return this.m_quadTreeNodes.getField(t,4)}setFirstElement_(t,e){this.m_quadTreeNodes.setField(t,4,e)}getLastElement_(t){return this.m_quadTreeNodes.getField(t,5)}setLastElement_(t,e){this.m_quadTreeNodes.setField(t,5,e)}getQuadrant_(t){return this.m_quadTreeNodes.getField(t,6)&r.m_quadrantMask}getHeight_(t){return this.m_quadTreeNodes.getField(t,6)>>r.m_heightBitShift}setHeightAndQuadrant_(t,e,s){let i=e<<r.m_heightBitShift|s;this.m_quadTreeNodes.setField(t,6,i)}getLocalElementCount_(t){return this.m_quadTreeNodes.getField(t,7)}setLocalElementCount_(t,e){this.m_quadTreeNodes.setField(t,7,e)}getSubTreeElementCount_(t){return this.m_quadTreeNodes.getField(t,8)}setSubTreeElementCount_(t,e){this.m_quadTreeNodes.setField(t,8,e)}getParent_(t){return this.m_quadTreeNodes.getField(t,9)}setParent_(t,e){this.m_quadTreeNodes.setField(t,9,e)}getContainedSubTreeElementCount_(t){return this.m_quadTreeNodes.getField(t,10)}setContainedSubTreeElementCount_(t,e){this.m_quadTreeNodes.setField(t,10,e)}getData_(t){return this.m_elementNodes.getField(t,0)}setData_(t,e){this.m_elementNodes.setField(t,0,e)}getPrevElement_(t){return this.m_elementNodes.getField(t,1)}getNextElement_(t){return this.m_elementNodes.getField(t,2)}setPrevElement_(t,e){this.m_elementNodes.setField(t,1,e)}setNextElement_(t,e){this.m_elementNodes.setField(t,2,e)}getQuad_(t){return this.m_elementNodes.getField(t,3)}setQuad_(t,e){this.m_elementNodes.setField(t,3,e)}getElementValue_(t){return this.m_data[t].element}getBoundingBoxValue_(t){return this.m_data[t].box}setDataValues_(t,e,s){this.m_data[t]=Zt(e,s)}};F.m_quadrantMask=3,F.m_heightBitShift=2,F.m_flushingCount=5;var et=class{constructor(t,e,s){this.m_bLinear=!1,this.m_queryStart=new A,this.m_queryEnd=new A,this.m_queryBox=new d,this.m_tolerance=0,this.m_currentElementHandle=-1,this.m_nextElementHandle=-1,this.m_quadsStack=[],this.m_extentsStack=[],this.m_childExtents=[new d,new d,new d,new d],this.m_quadTree=t,e&&this.resetIterator(e,s)}resetIterator(t,e){if(e===void 0&&(e=0),t instanceof d)return this.m_quadsStack.length=0,this.m_extentsStack.length=0,this.m_currentElementHandle=-1,this.m_queryBox.setCoords({env2D:t}),this.m_queryBox.inflateCoords(e,e),this.m_tolerance=Number.NaN,void(this.m_quadTree.m_root!==-1&&this.m_queryBox.isIntersecting(this.m_quadTree.m_extent)?(this.m_quadsStack.push(this.m_quadTree.m_root),this.m_extentsStack.push(this.m_quadTree.m_extent.clone()),this.m_nextElementHandle=this.m_quadTree.getFirstElement_(this.m_quadTree.m_root),this.m_bLinear=!1):this.m_nextElementHandle=-1);if(this.m_quadsStack.length=0,this.m_extentsStack.length=0,this.m_currentElementHandle=-1,t.queryLooseEnvelope(this.m_queryBox),this.m_queryBox.inflateCoords(e,e),this.m_quadTree.m_root!==-1&&this.m_queryBox.isIntersecting(this.m_quadTree.m_extent)){let s=t.getGeometryType();if(this.m_bLinear=s===C.enumLine,this.m_bLinear){let i=t;this.m_queryStart.assign(i.getStartXY()),this.m_queryEnd.assign(i.getEndXY()),this.m_tolerance=e}else this.m_tolerance=Number.NaN;this.m_quadsStack.push(this.m_quadTree.m_root),this.m_extentsStack.push(this.m_quadTree.m_extent.clone()),this.m_nextElementHandle=this.m_quadTree.getFirstElement_(this.m_quadTree.m_root)}else this.m_nextElementHandle=-1}next(){if(this.m_quadsStack.length===0)return-1;this.m_currentElementHandle=this.m_nextElementHandle;let t=new A,e=new A,s=new d,i=!1;for(;!i;){for(;this.m_currentElementHandle!==-1;){let n=this.m_quadTree.getData_(this.m_currentElementHandle);if(s.setCoords({env2D:this.m_quadTree.getBoundingBoxValue_(n)}),s.isIntersecting(this.m_queryBox)){if(!this.m_bLinear){i=!0;break}if(t.setCoordsPoint2D(this.m_queryStart),e.setCoordsPoint2D(this.m_queryEnd),s.inflateCoords(this.m_tolerance,this.m_tolerance),s.clipLine(t,e)>0){i=!0;break}}this.m_currentElementHandle=this.m_quadTree.getNextElement_(this.m_currentElementHandle)}if(this.m_currentElementHandle===-1){let n=this.m_quadsStack.at(-1),o=this.m_extentsStack.at(-1);F.setChildExtents_(o,this.m_childExtents),this.m_quadsStack.pop(),this.m_extentsStack.pop();for(let h=0;h<4;h++){let a=this.m_quadTree.getChild_(n,h);if(a!==-1&&this.m_quadTree.getSubTreeElementCount(a)>0&&this.m_childExtents[h].isIntersecting(this.m_queryBox))if(this.m_bLinear){t.setCoordsPoint2D(this.m_queryStart),e.setCoordsPoint2D(this.m_queryEnd);let m=new d;m.setCoords({env2D:this.m_childExtents[h]}),m.inflateCoords(this.m_tolerance,this.m_tolerance),m.clipLine(t,e)>0&&(this.m_quadsStack.push(a),this.m_extentsStack.push(this.m_childExtents[h].clone()))}else this.m_quadsStack.push(a),this.m_extentsStack.push(this.m_childExtents[h].clone())}if(this.m_quadsStack.length===0)return-1;this.m_currentElementHandle=this.m_quadTree.getFirstElement_(this.m_quadsStack.at(-1))}}return this.m_nextElementHandle=this.m_quadTree.getNextElement_(this.m_currentElementHandle),this.m_currentElementHandle}clone(){return c(0),{}}},st=class{constructor(t){this.m_bucketSort=new yt,this.m_sortedHandles=new L(0),this.m_index=-1,this.m_quadTreeIteratorImpl=t}resetIterator(t,e){this.m_quadTreeIteratorImpl.resetIterator(t,e),this.m_sortedHandles.resize(0),this.m_index=-1}next(){if(this.m_index===-1){let t=-1;for(;(t=this.m_quadTreeIteratorImpl.next())!==-1;)this.m_sortedHandles.add(t);let e=this,s={userSort(i,n,o){o.sort(i,n,(h,a)=>e.m_quadTreeIteratorImpl.m_quadTree.getElement(h)-e.m_quadTreeIteratorImpl.m_quadTree.getElement(a))},getValue:i=>e.m_quadTreeIteratorImpl.m_quadTree.getElement(i)};this.m_bucketSort.sort(this.m_sortedHandles,0,this.m_sortedHandles.size(),s)}return this.m_index===this.m_sortedHandles.size()-1?-1:(this.m_index++,this.m_sortedHandles.read(this.m_index))}clone(){return c(0),{}}},pt=class{constructor(t=!1){this.m_bNotifyOnActions=t}onDelete(t){}onSet(t){}onEndSearch(t){}onAddUniqueElementFailed(t){}onDeleteImpl(t,e){this.m_bNotifyOnActions&&this.onDelete(t.getElement(e))}onSetImpl(t,e){this.m_bNotifyOnActions&&this.onSet(t.getElement(e))}onAddUniqueElementFailedImpl(t){this.m_bNotifyOnActions&&this.onAddUniqueElementFailed(t)}onEndSearchImpl(t){this.m_bNotifyOnActions&&this.onEndSearch(t)}},gt=class r{static st_nullNode(){return-1}constructor(){this.m_defaultTreap=-1,this.m_random=124234251,this.m_comparator=null,this.m_treapData=new E(7),this.m_treapCount=0,this.m_maxDepthEver=0,this.m_bBalancing=!0}setComparator(t){this.m_comparator=t}getComparator(){return this.m_comparator}disableBalancing(){this.m_bBalancing=!1}enableBalancing(){this.m_bBalancing||(c(this.m_treapCount<=1),this.rebalance(-1),this.m_bBalancing=!0)}isAutoBalancing(){return this.m_bBalancing}rebalance(t){if(this.m_bBalancing||(t===-1&&(t=this.m_defaultTreap),this.size(t)===0))return;let e=[];for(let s=this.getFirst(t);s!==-1;s=this.getNext(s))e.push(s),this.setParent_(s,-1),this.setRight_(s,-1),this.setLeft_(s,-1);this.setRoot_(-1,t),this.setFirst_(-1,t),this.setLast_(-1,t),this.setSize_(0,t),this.m_bBalancing=!0;for(let s of e)this.addBiggestElement_(s,t);this.m_bBalancing=!1}setCapacity(t){this.m_treapData.setCapacity(t)}createTreap(t){let e=this.m_treapData.newElement();return this.setSize_(0,e),this.setTreapData_(t,e),this.m_treapCount++,e}deleteTreap(t){this.m_treapData.deleteElement(t),this.m_treapCount--}addElement(t,e=-1){return e===-1&&(this.m_defaultTreap===r.st_nullNode()&&(this.m_defaultTreap=this.createTreap(-1)),e=this.m_defaultTreap),this.addElement_(t,0,e)}addUniqueElement(t,e=-1){return e===-1&&(this.m_defaultTreap===r.st_nullNode()&&(this.m_defaultTreap=this.createTreap(-1)),e=this.m_defaultTreap),this.addElement_(t,1,e)}addBiggestElement(t,e=-1){e===-1&&(this.m_defaultTreap===r.st_nullNode()&&(this.m_defaultTreap=this.createTreap(-1)),e=this.m_defaultTreap);let s=this.newNode_(t);return this.addBiggestElement_(s,e),s}addElementAtPosition(t,e,s,i,n,o=-1){if(o===-1&&(this.m_defaultTreap===r.st_nullNode()&&(this.m_defaultTreap=this.createTreap(-1)),o=this.m_defaultTreap),this.getRoot_(o)===r.st_nullNode()){let g=this.newNode_(s);return this.setRoot_(g,o),this.addToList_(-1,g,o),g}let h,a,m,l,_;if(n?(h=e!==r.st_nullNode()?this.m_comparator.compare(this,s,e):-1,a=t!==r.st_nullNode()?this.m_comparator.compare(this,s,t):1):(h=-1,a=1),i&&(h===0||a===0)){this.m_comparator.onAddUniqueElementFailedImpl(s);let g=h===0?e:t;return this.setDuplicateElement_(g,o),-1}_=e!==r.st_nullNode()&&t!==r.st_nullNode()?this.m_random>J(this.m_random)>>1:e!==r.st_nullNode(),_?(l=h,m=e):(l=a,m=t);let u=-1,p=-1,x=!0;for(;;){if(l<0){let g=this.getLeft(m);if(g===r.st_nullNode()){p=m,u=this.newNode_(s),this.setLeft_(m,u),this.setParent_(u,m);break}m=g}else{let g=this.getRight(m);if(g===r.st_nullNode()){p=this.getNext(m),u=this.newNode_(s),this.setRight_(m,u),this.setParent_(u,m);break}m=g}x&&(l*=-1,x=!1)}return this.bubbleUp_(u),this.getParent(u)===r.st_nullNode()&&this.setRoot_(u,o),this.addToList_(p,u,o),u}replaceElementAtPosition(t,e,s,i,n=-1){if(i){let o=this.getNext(t),h=-1;o!==r.st_nullNode()&&(h=this.m_comparator.compare(this,e,o));let a=this.getPrev(t),m=-1;if(a!==r.st_nullNode()&&(m=this.m_comparator.compare(this,e,a)),s&&(h===0||m===0)){this.m_comparator.onAddUniqueElementFailedImpl(e);let l=h===0?o:a;return n===r.st_nullNode()&&(this.m_defaultTreap===r.st_nullNode()&&(this.m_defaultTreap=this.createTreap(-1)),n=this.m_defaultTreap),this.setDuplicateElement_(l,n),-1}}return this.setElement_(t,e),t}getDuplicateElement(t=-1){return t===-1?this.getDuplicateElement_(this.m_defaultTreap):this.getDuplicateElement_(t)}deleteNode(t,e=-1){this.m_comparator&&this.m_comparator.onDeleteImpl(this,t),e===-1&&(e=this.m_defaultTreap),this.m_bBalancing?this.deleteNode_(t,e):this.unbalancedDelete_(t,e)}search(t,e=-1){let s=this.getRoot(e);for(;s!==r.st_nullNode();){let i=this.m_comparator.compare(this,t,s);if(!i)return s;s=i<0?this.getLeft(s):this.getRight(s)}return this.m_comparator.onEndSearchImpl(t),r.st_nullNode()}searchLowerBound(t,e=-1){let s=this.getRoot(e),i=-1;for(;s!==r.st_nullNode();){let n=t.compare(this,s);if(!n)return s;n<0?s=this.getLeft(s):(i=s,s=this.getRight(s))}return i}searchUpperBound(t,e=-1){let s=this.getRoot(e),i=-1;for(;s!==r.st_nullNode();){let n=t.compare(this,s);if(!n)return s;n<0?(i=s,s=this.getLeft(s)):s=this.getRight(s)}return i}getElement(t){return this.m_treapData.getField(t,3)}getLeft(t){return this.m_treapData.getField(t,0)}getRight(t){return this.m_treapData.getField(t,1)}getParent(t){return this.m_treapData.getField(t,2)}getNext(t){return this.m_treapData.getField(t,6)}getPrev(t){return this.m_treapData.getField(t,5)}getFirst(t=-1){return t===-1?this.getFirst_(this.m_defaultTreap):this.getFirst_(t)}getLast(t=-1){return t===-1?this.getLast_(this.m_defaultTreap):this.getLast_(t)}getTreapData(t=-1){return t===-1?this.getTreapData_(this.m_defaultTreap):this.getTreapData_(t)}setElement(t,e){this.m_comparator!==null&&this.m_comparator.onSetImpl(this,t),this.setElement_(t,e)}getRoot(t=-1){return t===-1?this.getRoot_(this.m_defaultTreap):this.getRoot_(t)}clear(){this.m_treapData.deleteAll(!1),this.m_defaultTreap=r.st_nullNode(),this.m_treapCount=0,this.m_maxDepthEver=0}addToList_(t,e,s){let i;t!==-1?(i=this.getPrev(t),this.setPrev_(t,e)):i=this.getLast_(s),this.setPrev_(e,i),i!==-1&&this.setNext_(i,e),this.setNext_(e,t),t===this.getFirst_(s)&&this.setFirst_(e,s),t===-1&&this.setLast_(e,s),this.setSize_(this.getSize_(s)+1,s)}size(t=-1){return t===-1?this.getSize_(this.m_defaultTreap):this.getSize_(t)}getMaxDepth(t=-1){return this.getMaxDepthHelper_(this.getRoot(t))}getMaxDepthEver(){return this.m_maxDepthEver}static st_isValidNode(t){return E.isValidElement(t)}dbgCheck_(t){}getPriority_(t){return this.m_treapData.getField(t,4)}bubbleDown_(t){let e=this.getLeft(t),s=this.getRight(t),i=this.getPriority_(t);for(;e!==r.st_nullNode()||s!==r.st_nullNode();){let n=e!==r.st_nullNode()?this.getPriority_(e):Q(),o=s!==r.st_nullNode()?this.getPriority_(s):Q();if(i<=Math.min(n,o))return;n<=o?this.rotateRight_(e):this.rotateLeft_(t),e=this.getLeft(t),s=this.getRight(t)}}bubbleUp_(t){if(!this.m_bBalancing)return;let e=this.getPriority_(t),s=this.getParent(t);for(;s!==r.st_nullNode()&&this.getPriority_(s)>e;)this.getLeft(s)===t?this.rotateRight_(t):this.rotateLeft_(s),s=this.getParent(t)}rotateLeft_(t){let e=t,s=this.getRight(t),i;this.setParent_(s,this.getParent(e)),this.setParent_(e,s),i=this.getLeft(s),this.setRight_(e,i),i!==r.st_nullNode()&&this.setParent_(i,e),this.setLeft_(s,e),i=this.getParent(s),i!==r.st_nullNode()&&(this.getLeft(i)===e?this.setLeft_(i,s):this.setRight_(i,s))}rotateRight_(t){let e=this.getParent(t),s=t,i;this.setParent_(s,this.getParent(e)),this.setParent_(e,s),i=this.getRight(s),this.setLeft_(e,i),i!==r.st_nullNode()&&this.setParent_(i,e),this.setRight_(s,e),i=this.getParent(s),i!==r.st_nullNode()&&(this.getLeft(i)===e?this.setLeft_(i,s):this.setRight_(i,s))}setParent_(t,e){this.m_treapData.setField(t,2,e)}setLeft_(t,e){this.m_treapData.setField(t,0,e)}setRight_(t,e){this.m_treapData.setField(t,1,e)}setPriority_(t,e){this.m_treapData.setField(t,4,e)}setPrev_(t,e){this.m_treapData.setField(t,5,e)}setNext_(t,e){this.m_treapData.setField(t,6,e)}setRoot_(t,e){this.m_treapData.setField(e,0,t)}setFirst_(t,e){this.m_treapData.setField(e,1,t)}setLast_(t,e){this.m_treapData.setField(e,2,t)}setDuplicateElement_(t,e){this.m_treapData.setField(e,3,t)}setSize_(t,e){this.m_treapData.setField(e,4,t)}setTreapData_(t,e){this.m_treapData.setField(e,5,t)}getRoot_(t){return t===-1?r.st_nullNode():this.m_treapData.getField(t,0)}getFirst_(t){return t===-1?r.st_nullNode():this.m_treapData.getField(t,1)}getLast_(t){return t===-1?r.st_nullNode():this.m_treapData.getField(t,2)}getDuplicateElement_(t){return t===-1?r.st_nullNode():this.m_treapData.getField(t,3)}getSize_(t){return t===-1?0:this.m_treapData.getField(t,4)}getTreapData_(t){return this.m_treapData.getField(t,5)}newNode_(t){let e=this.m_treapData.newElement();return this.setPriority_(e,this.generatePriority_()),this.setElement_(e,t),e}freeNode_(t,e){t!==r.st_nullNode()&&this.m_treapData.deleteElement(t)}generatePriority_(){return this.m_random=J(this.m_random),this.m_random&Q()>>1}maxPriority(){return c(0),0}getMaxDepthHelper_(t){return t===r.st_nullNode()?0:1+Math.max(this.getMaxDepthHelper_(this.getLeft(t)),this.getMaxDepthHelper_(this.getRight(t)))}addElement_(t,e,s){if(this.getRoot(s)===r.st_nullNode()){let a=this.newNode_(t);return this.setRoot_(a,s),this.addToList_(-1,a,s),this.m_maxDepthEver=Math.max(this.m_maxDepthEver,1),a}let i=this.getRoot_(s),n=-1,o=-1,h=1;for(;;){let a=e===-1?1:this.m_comparator.compare(this,t,i);if(a<0){let m=this.getLeft(i);if(m===r.st_nullNode()){o=i,n=this.newNode_(t),this.setLeft_(i,n),this.setParent_(n,i);break}i=m}else{if(e===1&&a===0)return this.m_comparator.onAddUniqueElementFailedImpl(t),this.setDuplicateElement_(i,s),-1;let m=this.getRight(i);if(m===r.st_nullNode()){o=this.getNext(i),n=this.newNode_(t),this.setRight_(i,n),this.setParent_(n,i);break}i=m}h++}return this.bubbleUp_(n),this.getParent(n)===r.st_nullNode()&&this.setRoot_(n,s),this.addToList_(o,n,s),this.m_maxDepthEver=Math.max(h,this.m_maxDepthEver),n}removeFromList_(t,e){let s=this.getPrev(t),i=this.getNext(t);s!==-1?this.setNext_(s,i):this.setFirst_(i,e),i!==-1?this.setPrev_(i,s):this.setLast_(s,e),this.setSize_(this.getSize_(e)-1,e)}unbalancedDelete_(t,e){this.removeFromList_(t,e);let s=this.getLeft(t),i=this.getRight(t),n=this.getParent(t),o=t;if(s!==-1&&i!==-1){let a;this.m_random=J(this.m_random),a=this.m_random>Q()>>1?this.getNext(t):this.getPrev(t);let m=this.getParent(a)===t;this.m_treapData.swapField(t,a,0),this.m_treapData.swapField(t,a,1),this.m_treapData.swapField(t,a,2),n!==-1?this.getLeft(n)===t?this.setLeft_(n,a):this.setRight_(n,a):this.setRoot_(a,e),m?(s===a?(this.setLeft_(a,t),this.setParent_(i,a)):i===a&&(this.setRight_(a,t),this.setParent_(s,a)),this.setParent_(t,a),n=a):(this.setParent_(s,a),this.setParent_(i,a),n=this.getParent(t),o=a),s=this.getLeft(t),i=this.getRight(t),s!==-1&&this.setParent_(s,t),i!==-1&&this.setParent_(i,t)}let h=s!==-1?s:i;n===-1?this.setRoot_(h,e):this.getLeft(n)===o?this.setLeft_(n,h):this.setRight_(n,h),h!==-1&&this.setParent_(h,n),this.freeNode_(t,e)}deleteNode_(t,e){this.setPriority_(t,Q());let s=r.st_nullNode(),i=r.st_nullNode(),n=this.getRoot_(e),o=n===t;if(o&&(s=this.getLeft(n),i=this.getRight(n),s===r.st_nullNode()&&i===r.st_nullNode()))return this.removeFromList_(n,e),this.freeNode_(n,e),void this.setRoot_(r.st_nullNode(),e);this.bubbleDown_(t);let h=this.getParent(t);h!==r.st_nullNode()&&(this.getLeft(h)===t?this.setLeft_(h,r.st_nullNode()):this.setRight_(h,r.st_nullNode())),this.removeFromList_(t,e),this.freeNode_(t,e),o&&this.setRoot_(s===r.st_nullNode()||this.getParent(s)!==r.st_nullNode()?i:s,e)}setElement_(t,e){this.m_treapData.setField(t,3,e)}addBiggestElement_(t,e){if(this.getRoot_(e)===r.st_nullNode())return this.setRoot_(t,e),void this.addToList_(-1,t,e);let s=this.getLast_(e);this.setRight_(s,t),this.setParent_(t,s),this.bubbleUp_(t),this.getParent(t)===r.st_nullNode()&&this.setRoot_(t,e),this.addToList_(-1,t,e)}},it=class r{constructor(t){this.m_lists=new E(6),this.m_listOfLists=r.st_nullNode(),t===void 0?(this.m_listNodes=new E(3),this.m_bStoreListIndexWithNode=!1):(this.m_listNodes=new E(t?4:3),this.m_bStoreListIndexWithNode=t)}freeNode_(t){this.m_listNodes.deleteElement(t)}newNode_(){return this.m_listNodes.newElement()}freeList_(t){c(0)}newList_(){return this.m_lists.newElement()}setPrev_(t,e){this.m_listNodes.setField(t,1,e)}setNext_(t,e){this.m_listNodes.setField(t,2,e)}setData_(t,e){c(0)}setList_(t,e){return this.m_listNodes.setField(t,3,e)}setListSize_(t,e){this.m_lists.setField(t,4,e)}setNextList_(t,e){c(0)}setPrevList_(t,e){this.m_lists.setField(t,2,e)}createList(t){let e=this.newList_();return this.m_lists.setField(e,3,this.m_listOfLists),this.m_lists.setField(e,4,0),this.m_lists.setField(e,5,t),this.m_listOfLists!==r.st_nullNode()&&this.setPrevList_(this.m_listOfLists,e),this.m_listOfLists=e,e}deleteList(t){this.clear(t);let e=this.m_lists.getField(t,2),s=this.m_lists.getField(t,3);return e!==r.st_nullNode()?this.setNextList_(e,s):this.m_listOfLists=s,s!==r.st_nullNode()&&this.setPrevList_(s,e),this.freeList_(t),s}reserveLists(t){c(0)}getListData(t){return this.m_lists.getField(t,5)}getList(t){return c(0),0}setListData(t,e){this.m_lists.setField(t,5,e)}addElement(t,e){return this.insertElement(t,-1,e)}insertElement(t,e,s){let i=this.newNode_(),n=-1;if(e!==r.st_nullNode()&&(n=this.getPrev(e),this.setPrev_(e,i)),this.setNext_(i,e),n!==r.st_nullNode()&&this.setNext_(n,i),e===this.m_lists.getField(t,0)&&this.m_lists.setField(t,0,i),e===r.st_nullNode()){let o=this.m_lists.getField(t,1);this.setPrev_(i,o),o!==-1&&this.setNext_(o,i),this.m_lists.setField(t,1,i)}return this.setData(i,s),this.setListSize_(t,this.getListSize(t)+1),this.m_bStoreListIndexWithNode&&this.setList_(i,t),i}deleteElement(t,e){let s=this.getPrev(e),i=this.getNext(e);return s!==r.st_nullNode()?this.setNext_(s,i):this.m_lists.setField(t,0,i),i!==r.st_nullNode()?this.setPrev_(i,s):this.m_lists.setField(t,1,s),this.freeNode_(e),this.setListSize_(t,this.getListSize(t)-1),i}reserveNodes(t){this.m_listNodes.setCapacity(t)}getData(t){return this.m_listNodes.getField(t,0)}getElement(t){return this.getData(t)}setData(t,e){this.m_listNodes.setField(t,0,e)}getNext(t){return this.m_listNodes.getField(t,2)}getPrev(t){return this.m_listNodes.getField(t,1)}getFirst(t){return this.m_lists.getField(t,0)}getLast(t){return this.m_lists.getField(t,1)}static st_nullNode(){return-1}clear(t){if(t!==void 0){let e=this.getLast(t);for(;e!==r.st_nullNode();){let s=e;e=this.getPrev(s),this.freeNode_(s)}return this.m_lists.setField(t,0,-1),this.m_lists.setField(t,1,-1),void this.setListSize_(t,0)}for(let e=this.getFirstList();e!==-1;)e=this.deleteList(e)}isEmpty(t){return c(0),!1}getNodeCount(){return this.m_listNodes.size()}getListCount(){return this.m_lists.size()}getListSize(t){return this.m_lists.getField(t,4)}getFirstList(){return this.m_listOfLists}getNextList(t){return this.m_lists.getField(t,3)}},ft=class extends pt{constructor(t){super(),this.m_intervalTree=t}compare(t,e,s){let i=t.getElement(s),n=this.m_intervalTree.getValue_(e),o=this.m_intervalTree.getValue_(i);return n<o?-1:n===o?R.isLeft_(e)&&R.isRight_(i)?-1:R.isLeft_(i)&&R.isRight_(e)?1:0:1}},R=class r{constructor(t){this.m_bEnvelopesRef=!1,this.m_intervals=[],this.m_envelopesRef=null,this.m_intervalNodes=new E(3),this.m_intervalHandles=[],this.m_endIndicesUnique=[],this.m_cCount=-1,this.m_root=-1,this.m_bSortIntervals=!1,this.m_bConstructing=!1,this.m_bConstructionEnded=!1,this.m_bOfflineDynamic=t,this.m_tertiaryNodes=new E(this.m_bOfflineDynamic?5:4),this.m_secondaryTreaps=new gt,this.m_secondaryTreaps.setComparator(new ft(this)),this.m_secondaryLists=new it}addEnvelopesRef(t){this.reset_(!0,!0),this.m_bEnvelopesRef=!0,this.m_envelopesRef=t,this.m_bConstructing=!1,this.m_bConstructionEnded=!0,this.m_bOfflineDynamic||(this.insertIntervalsStatic_(),this.m_cCount=this.m_envelopesRef.length)}startConstruction(){this.reset_(!0,!1)}addInterval(t){this.m_bConstructing||w(""),this.m_intervals.push(t.clone())}addIntervalCoords(t,e){c(0)}endConstruction(){this.m_bConstructing||w(""),this.m_bConstructing=!1,this.m_bConstructionEnded=!0,this.m_bOfflineDynamic||(this.insertIntervalsStatic_(),this.m_cCount=this.m_intervals.length)}insert(t){if(this.m_bOfflineDynamic&&this.m_bConstructionEnded||w(""),this.m_root===-1){let n=this.m_bEnvelopesRef?this.m_envelopesRef.length:this.m_intervals.length;if(this.m_bSortIntervals){let o=new L(0);this.querySortedEndPointIndices_(o),this.m_endIndicesUnique.length=0,this.querySortedDuplicatesRemoved_(o),this.m_intervalHandles.length=n,this.m_intervalHandles.fill(-1),this.m_bSortIntervals=!1}else this.m_intervalHandles.fill(-1,0,n);this.m_root=this.createRoot_()}let e=this.insertIntervalEnd_(t<<1,this.m_root),s=this.getSecondaryFromInterval_(e),i=this.m_secondaryTreaps.addElement(1+(t<<1),s);this.setRightEnd_(e,i),this.m_intervalHandles[t]=e,this.m_cCount++}remove(t){this.m_bOfflineDynamic&&this.m_bConstructionEnded||w("");let e=this.m_intervalHandles[t],s;e===-1&&v("the interval does not exist in the interval tree"),this.m_intervalHandles[t]=-1,this.m_cCount--;let i=this.getSecondaryFromInterval_(e),n=-1;n=this.m_secondaryTreaps.getTreapData(i),this.m_secondaryTreaps.deleteNode(this.getLeftEnd_(e),i),this.m_secondaryTreaps.deleteNode(this.getRightEnd_(e),i),s=this.m_secondaryTreaps.size(i),s===0&&(this.m_secondaryTreaps.deleteTreap(i),this.setSecondaryToTertiary_(n,-1)),this.m_intervalNodes.deleteElement(e);let o=this.getPptr_(n),h=this.getLptr_(n),a=this.getRptr_(n);for(;!(s>0||n===this.m_root||h!==-1&&a!==-1);)n===this.getLptr_(o)?h!==-1?(this.setLptr_(o,h),this.setPptr_(h,o),this.setLptr_(n,-1),this.setPptr_(n,-1)):a!==-1?(this.setLptr_(o,a),this.setPptr_(a,o),this.setRptr_(n,-1),this.setPptr_(n,-1)):(this.setLptr_(o,-1),this.setPptr_(n,-1)):h!==-1?(this.setRptr_(o,h),this.setPptr_(h,o),this.setLptr_(n,-1),this.setPptr_(n,-1)):a!==-1?(this.setRptr_(o,a),this.setPptr_(a,o),this.setRptr_(n,-1),this.setPptr_(n,-1)):(this.setRptr_(o,-1),this.setPptr_(n,-1)),this.m_tertiaryNodes.deleteElement(n),n=o,i=this.getSecondaryFromTertiary_(n),s=i!==-1?this.m_secondaryTreaps.size(i):0,h=this.getLptr_(n),a=this.getRptr_(n),o=this.getPptr_(n)}size(){return this.m_cCount}getIteratorQuery(t,e){return t instanceof T?new nt(this,t,e):(c(0),{})}getIterator(){return new nt(this)}querySortedEndPointIndices_(t){let e=this.m_bEnvelopesRef?this.m_envelopesRef.length:this.m_intervals.length;for(let s=0;s<2*e;s++)t.add(s);this.sortEndIndices_(t,0,2*e)}querySortedDuplicatesRemoved_(t){let e=Number.NaN;for(let s=0;s<t.size();s++){let i=t.read(s),n=this.getValue_(i);n!==e&&(this.m_endIndicesUnique.push(i),e=n)}}insertIntervalsStatic_(){let t=this.m_bEnvelopesRef?this.m_envelopesRef.length:this.m_intervals.length,e=new L(0);this.querySortedEndPointIndices_(e),this.m_endIndicesUnique.length=0,this.querySortedDuplicatesRemoved_(e),this.m_intervalNodes.setCapacity(t),this.m_secondaryLists.reserveNodes(2*t);let s=V(t,-1);this.m_root=this.createRoot_();for(let i=0;i<e.size();i++){let n=e.read(i),o=s[n>>1];if(o!==-1){let h=this.getSecondaryFromInterval_(o);this.setRightEnd_(o,this.m_secondaryLists.addElement(h,n))}else o=this.insertIntervalEnd_(n,this.m_root),s[n>>1]=o}}createRoot_(){let t=this.calculateDiscriminantIndex1_(0,this.m_endIndicesUnique.length-1);return this.createTertiaryNode_(t)}insertIntervalEnd_(t,e){let s=-1,i=e,n=-1,o=-1,h=0,a=this.m_endIndicesUnique.length-1,m=0,l=t>>1,_=Number.NaN,u=Number.NaN,p=!0,x=this.getMin_(l),g=this.getMax_(l),y=-1;for(;p;){m=h+(a-h>>1),y=this.calculateDiscriminantIndex1_(h,a);let b=this.getDiscriminantFromIndex1_(y);if(g<b){if(i!==-1){if(y===this.getDiscriminantIndex1_(i))s=i,_=b,i=this.getLptr_(i),u=i!==-1?this.getDiscriminant_(i):Number.NaN;else if(u>b){let f=this.createTertiaryNode_(y);b<_?this.setLptr_(s,f):this.setRptr_(s,f),this.setRptr_(f,i),this.m_bOfflineDynamic&&(this.setPptr_(f,s),this.setPptr_(i,f)),s=f,_=b,i=-1,u=Number.NaN}}a=m;continue}if(x>b){if(i!==-1){if(y===this.getDiscriminantIndex1_(i))s=i,_=b,i=this.getRptr_(i),u=i!==-1?this.getDiscriminant_(i):Number.NaN;else if(u<b){let f=this.createTertiaryNode_(y);b<_?this.setLptr_(s,f):this.setRptr_(s,f),this.setLptr_(f,i),this.m_bOfflineDynamic&&(this.setPptr_(f,s),this.setPptr_(i,f)),s=f,_=b,i=-1,u=Number.NaN}}h=m+1;continue}let D=-1;D=i===-1||y!==this.getDiscriminantIndex1_(i)?this.createTertiaryNode_(y):i,n=this.getSecondaryFromTertiary_(D),n===-1&&(n=this.createSecondary_(D),this.setSecondaryToTertiary_(D,n));let N=this.addEndIndex_(n,t);o=this.createIntervalNode_(),this.setSecondaryToInterval_(o,n),this.setLeftEnd_(o,N),i!==-1&&y===this.getDiscriminantIndex1_(i)||(b<_?this.setLptr_(s,D):this.setRptr_(s,D),this.m_bOfflineDynamic&&this.setPptr_(D,s),i!==-1&&(u<b?this.setLptr_(D,i):this.setRptr_(D,i),this.m_bOfflineDynamic&&this.setPptr_(i,D))),p=!1;break}return o}createTertiaryNode_(t){let e=this.m_tertiaryNodes.newElement();return this.setDiscriminantIndex1_(e,t),e}createSecondary_(t){return this.m_bOfflineDynamic?this.m_secondaryTreaps.createTreap(t):this.m_secondaryLists.createList(t)}createIntervalNode_(){return this.m_intervalNodes.newElement()}reset(){this.m_bOfflineDynamic&&this.m_bConstructionEnded||w(""),this.reset_(!1,this.m_bEnvelopesRef)}reset_(t,e){t?(this.m_bEnvelopesRef=!1,this.m_envelopesRef=null,this.m_bSortIntervals=!0,this.m_bConstructing=!0,this.m_bConstructionEnded=!1,this.m_endIndicesUnique.length=0,e?(this.m_intervals.length=0,this.m_bEnvelopesRef=!0):this.m_intervals.length=0):this.m_bSortIntervals=!1,this.m_bOfflineDynamic?this.m_secondaryTreaps.clear():this.m_secondaryLists.clear(),this.m_intervalNodes.deleteAll(!1),this.m_tertiaryNodes.deleteAll(!1),this.m_root=-1,this.m_cCount=0}getDiscriminant_(t){let e=this.getDiscriminantIndex1_(t);return this.getDiscriminantFromIndex1_(e)}getDiscriminantFromIndex1_(t){if(t===-1)return Number.NaN;if(t>0){let i=t-2,n=this.m_endIndicesUnique[i],o=this.m_endIndicesUnique[i+1];return .5*(this.getValue_(n)+this.getValue_(o))}let e=-t-2,s=this.m_endIndicesUnique[e];return this.getValue_(s)}calculateDiscriminantIndex1_(t,e){let s;return t<e?s=t+(e-t>>1)+2:s=-(t+2),s}setDiscriminantIndex1_(t,e){this.m_tertiaryNodes.setField(t,0,e)}setSecondaryToTertiary_(t,e){this.m_tertiaryNodes.setField(t,1,e)}setLptr_(t,e){this.m_tertiaryNodes.setField(t,2,e)}setRptr_(t,e){this.m_tertiaryNodes.setField(t,3,e)}setPptr_(t,e){this.m_tertiaryNodes.setField(t,4,e)}setSecondaryToInterval_(t,e){this.m_intervalNodes.setField(t,0,e)}addEndIndex_(t,e){let s=-1;return s=this.m_bOfflineDynamic?this.m_secondaryTreaps.addElement(e,t):this.m_secondaryLists.addElement(t,e),s}setLeftEnd_(t,e){this.m_intervalNodes.setField(t,1,e)}setRightEnd_(t,e){this.m_intervalNodes.setField(t,2,e)}getFirst_(t){return this.m_bOfflineDynamic?this.m_secondaryTreaps.getFirst(t):this.m_secondaryLists.getFirst(t)}getLast_(t){return this.m_bOfflineDynamic?this.m_secondaryTreaps.getLast(t):this.m_secondaryLists.getLast(t)}static isLeft_(t){return!(1&t)}static isRight_(t){return!(1&~t)}getDiscriminantIndex1_(t){return this.m_tertiaryNodes.getField(t,0)}getSecondaryFromTertiary_(t){return this.m_tertiaryNodes.getField(t,1)}getLptr_(t){return this.m_tertiaryNodes.getField(t,2)}getRptr_(t){return this.m_tertiaryNodes.getField(t,3)}getPptr_(t){return this.m_tertiaryNodes.getField(t,4)}getSecondaryFromInterval_(t){return this.m_intervalNodes.getField(t,0)}getLeftEnd_(t){return this.m_intervalNodes.getField(t,1)}getRightEnd_(t){return this.m_intervalNodes.getField(t,2)}getMin_(t){return this.m_bEnvelopesRef?this.m_envelopesRef[t].xmin:this.m_intervals[t].vmin}getMax_(t){return this.m_bEnvelopesRef?this.m_envelopesRef[t].xmax:this.m_intervals[t].vmax}sortEndIndices_(t,e,s){let i=this,n={userSort(o,h,a){i.sortEndIndicesHelper_(a,o,h)},getValue:o=>i.getValue_(o)};new yt().sort(t,e,s,n)}sortEndIndicesHelper_(t,e,s){t.sort(e,s,(i,n)=>{let o=this.getValue_(i),h=this.getValue_(n);return o<h||o===h&&r.isLeft_(i)&&r.isRight_(n)?-1:1})}getValue_(t){if(!this.m_bEnvelopesRef){let s=this.m_intervals[t>>1];return r.isLeft_(t)?s.vmin:s.vmax}let e=this.m_envelopesRef[t>>1];return r.isLeft_(t)?e.xmin:e.xmax}},nt=class{constructor(t,e,s){this.m_query=T.constructEmpty(),this.m_tertiaryHandle=-1,this.m_nextTertiaryHandle=-1,this.m_forkedHandle=-1,this.m_currentEndHandle=-1,this.m_nextEndHandle=-1,this.m_tertiaryStack=[],this.m_functionIndex=0,this.m_intervalTree=t,this.m_functionStack=new Array(2),this.m_functionStack[0]=this.nullFunc_,this.m_functionStack[1]=this.nullFunc_,e!==void 0&&this.resetIterator(e,s)}nullFunc_(){return H("should not be called"),!1}resetIterator(t,e){if(typeof t=="number"){let s=new T;s.setCoords(t,t),this.resetIterator(s,e)}else e===void 0&&(e=0),this.m_query.vmin=t.vmin-e,this.m_query.vmax=t.vmax+e,this.m_tertiaryStack.length=0,this.m_functionIndex=0,this.m_functionStack[0]=this.initialize_}next(){if(this.m_intervalTree.m_bConstructionEnded||w(""),this.m_functionIndex<0)return-1;for(;this.m_fi=this.m_functionStack[this.m_functionIndex],this.m_fi(););return this.m_currentEndHandle!==-1?this.getCurrentEndIndex_()>>1:-1}initialize_(){return this.m_tertiaryHandle=-1,this.m_nextTertiaryHandle=-1,this.m_forkedHandle=-1,this.m_currentEndHandle=-1,this.m_intervalTree.m_tertiaryNodes.size()>0?(this.m_functionStack[0]=this.pIn_,this.m_nextTertiaryHandle=this.m_intervalTree.m_root,!0):(this.m_functionIndex=-1,!1)}pIn_(){if(this.m_tertiaryHandle=this.m_nextTertiaryHandle,this.m_tertiaryHandle===-1)return this.m_functionIndex=-1,this.m_currentEndHandle=-1,!1;let t=this.m_intervalTree.getDiscriminant_(this.m_tertiaryHandle);if(this.m_query.vmax<t){let s=this.m_intervalTree.getSecondaryFromTertiary_(this.m_tertiaryHandle);return this.m_nextTertiaryHandle=this.m_intervalTree.getLptr_(this.m_tertiaryHandle),s!==-1&&(this.m_nextEndHandle=this.m_intervalTree.getFirst_(s),this.m_functionStack[++this.m_functionIndex]=this.left_),!0}if(t<this.m_query.vmin){let s=this.m_intervalTree.getSecondaryFromTertiary_(this.m_tertiaryHandle);return this.m_nextTertiaryHandle=this.m_intervalTree.getRptr_(this.m_tertiaryHandle),s!==-1&&(this.m_nextEndHandle=this.m_intervalTree.getLast_(s),this.m_functionStack[++this.m_functionIndex]=this.right_),!0}this.m_functionStack[this.m_functionIndex]=this.pL_,this.m_forkedHandle=this.m_tertiaryHandle;let e=this.m_intervalTree.getSecondaryFromTertiary_(this.m_tertiaryHandle);return this.m_nextTertiaryHandle=this.m_intervalTree.getLptr_(this.m_tertiaryHandle),e!==-1&&(this.m_nextEndHandle=this.m_intervalTree.getFirst_(e),this.m_functionStack[++this.m_functionIndex]=this.all_),!0}pL_(){if(this.m_tertiaryHandle=this.m_nextTertiaryHandle,this.m_tertiaryHandle===-1)return this.m_functionStack[this.m_functionIndex]=this.pR_,this.m_nextTertiaryHandle=this.m_intervalTree.getRptr_(this.m_forkedHandle),!0;if(this.m_intervalTree.getDiscriminant_(this.m_tertiaryHandle)<this.m_query.vmin){let s=this.m_intervalTree.getSecondaryFromTertiary_(this.m_tertiaryHandle);return this.m_nextTertiaryHandle=this.m_intervalTree.getRptr_(this.m_tertiaryHandle),s!==-1&&(this.m_nextEndHandle=this.m_intervalTree.getLast_(s),this.m_functionStack[++this.m_functionIndex]=this.right_),!0}let t=this.m_intervalTree.getSecondaryFromTertiary_(this.m_tertiaryHandle);this.m_nextTertiaryHandle=this.m_intervalTree.getLptr_(this.m_tertiaryHandle),t!==-1&&(this.m_nextEndHandle=this.m_intervalTree.getFirst_(t),this.m_functionStack[++this.m_functionIndex]=this.all_);let e=this.m_intervalTree.getRptr_(this.m_tertiaryHandle);return e!==-1&&this.m_tertiaryStack.push(e),!0}pR_(){if(this.m_tertiaryHandle=this.m_nextTertiaryHandle,this.m_tertiaryHandle===-1)return this.m_functionStack[this.m_functionIndex]=this.pT_,!0;let t=this.m_intervalTree.getDiscriminant_(this.m_tertiaryHandle);if(this.m_query.vmax<t){let i=this.m_intervalTree.getSecondaryFromTertiary_(this.m_tertiaryHandle);return this.m_nextTertiaryHandle=this.m_intervalTree.getLptr_(this.m_tertiaryHandle),i!==-1&&(this.m_nextEndHandle=this.m_intervalTree.getFirst_(i),this.m_functionStack[++this.m_functionIndex]=this.left_),!0}let e=this.m_intervalTree.getSecondaryFromTertiary_(this.m_tertiaryHandle);this.m_nextTertiaryHandle=this.m_intervalTree.getRptr_(this.m_tertiaryHandle),e!==-1&&(this.m_nextEndHandle=this.m_intervalTree.getFirst_(e),this.m_functionStack[++this.m_functionIndex]=this.all_);let s=this.m_intervalTree.getLptr_(this.m_tertiaryHandle);return s!==-1&&this.m_tertiaryStack.push(s),!0}pT_(){if(this.m_tertiaryStack.length===0)return this.m_functionIndex=-1,this.m_currentEndHandle=-1,!1;this.m_tertiaryHandle=this.m_tertiaryStack.at(-1),this.m_tertiaryStack.pop();let t=this.m_intervalTree.getSecondaryFromTertiary_(this.m_tertiaryHandle);return t!==-1&&(this.m_nextEndHandle=this.m_intervalTree.getFirst_(t),this.m_functionStack[++this.m_functionIndex]=this.all_),this.m_intervalTree.getLptr_(this.m_tertiaryHandle)!==-1&&this.m_tertiaryStack.push(this.m_intervalTree.getLptr_(this.m_tertiaryHandle)),this.m_intervalTree.getRptr_(this.m_tertiaryHandle)!==-1&&this.m_tertiaryStack.push(this.m_intervalTree.getRptr_(this.m_tertiaryHandle)),!0}left_(){return this.m_currentEndHandle=this.m_nextEndHandle,this.m_currentEndHandle!==-1&&R.isLeft_(this.getCurrentEndIndex_())&&this.m_intervalTree.getValue_(this.getCurrentEndIndex_())<=this.m_query.vmax?(this.m_nextEndHandle=this.getNext_(),!1):(this.m_functionIndex--,!0)}right_(){return this.m_currentEndHandle=this.m_nextEndHandle,this.m_currentEndHandle!==-1&&R.isRight_(this.getCurrentEndIndex_())&&this.m_intervalTree.getValue_(this.getCurrentEndIndex_())>=this.m_query.vmin?(this.m_nextEndHandle=this.getPrev_(),!1):(this.m_functionIndex--,!0)}all_(){return this.m_currentEndHandle=this.m_nextEndHandle,this.m_currentEndHandle!==-1&&R.isLeft_(this.getCurrentEndIndex_())?(this.m_nextEndHandle=this.getNext_(),!1):(this.m_functionIndex--,!0)}getNext_(){return this.m_intervalTree.m_bOfflineDynamic?this.m_intervalTree.m_secondaryTreaps.getNext(this.m_currentEndHandle):this.m_intervalTree.m_secondaryLists.getNext(this.m_currentEndHandle)}getPrev_(){return this.m_intervalTree.m_bOfflineDynamic?this.m_intervalTree.m_secondaryTreaps.getPrev(this.m_currentEndHandle):this.m_intervalTree.m_secondaryLists.getPrev(this.m_currentEndHandle)}getCurrentEndIndex_(){return this.m_intervalTree.m_bOfflineDynamic?this.m_intervalTree.m_secondaryTreaps.getElement(this.m_currentEndHandle):this.m_intervalTree.m_secondaryLists.getData(this.m_currentEndHandle)}},W=class{constructor(){this.m_tolerance=0,this.m_sweepIndexRed=-1,this.m_sweepIndexBlue=-1,this.m_envelopeHandleA=-1,this.m_envelopeHandleB=-1,this.m_intervalTreeRed=null,this.m_intervalTreeBlue=null,this.m_iteratorRed=null,this.m_iteratorBlue=null,this.m_envelopesRed=[],this.m_envelopesBlue=[],this.m_elementsRed=[],this.m_elementsBlue=[],this.m_sortedEndIndicesRed=new L(0),this.m_sortedEndIndicesBlue=new L(0),this.m_queuedListRed=-1,this.m_queuedListBlue=-1,this.m_queuedEnvelopes=new it,this.m_queuedIndicesRed=[],this.m_queuedIndicesBlue=[],this.m_bAddRed=!1,this.m_bAddBlue=!1,this.m_bAddRedRed=!1,this.m_bDone=!0,this.m_function=this.nullFunc_,this.reset_()}startConstruction(){this.reset_(),this.m_bAddRedRed=!0,this.m_elementsRed.length=0,this.m_envelopesRed.length=0}addEnvelope(t,e){this.m_bAddRedRed||w(""),this.m_elementsRed.push(t),this.m_envelopesRed.push(new d(e))}endConstruction(){this.m_bAddRedRed||w(""),this.m_bAddRedRed=!1,this.m_envelopesRed.length>0&&(this.m_function=this.initialize_,this.m_bDone=!1)}startRedConstruction(){this.reset_(),this.m_bAddRed=!0,this.m_elementsRed.length=0,this.m_envelopesRed.length=0}addRedEnvelope(t,e){this.m_bAddRed||w(""),this.m_elementsRed.push(t),this.m_envelopesRed.push(e.clone())}endRedConstruction(){this.m_bAddRed||w(""),this.m_bAddRed=!1,this.m_envelopesRed.length>0&&this.m_envelopesBlue.length>0&&(this.m_function===this.nullFunc_||this.m_function===this.initializeBlue_?this.m_function=this.initializeRedBlue_:this.m_function!==this.initializeRedBlue_&&(this.m_function=this.initializeRed_),this.m_bDone=!1)}startBlueConstruction(){this.reset_(),this.m_bAddBlue=!0,this.m_elementsBlue.length=0,this.m_envelopesBlue.length=0}addBlueEnvelope(t,e){this.m_bAddBlue||w(""),this.m_elementsBlue.push(t),this.m_envelopesBlue.push(e.clone())}endBlueConstruction(){this.m_bAddBlue||w(""),this.m_bAddBlue=!1,this.m_envelopesRed.length>0&&this.m_envelopesBlue.length>0&&(this.m_function===this.nullFunc_||this.m_function===this.initializeRed_?this.m_function=this.initializeRedBlue_:this.m_function!==this.initializeRedBlue_&&(this.m_function=this.initializeBlue_),this.m_bDone=!1)}next(){if(this.m_bDone)return!1;for(;this.m_function(););return!this.m_bDone}getHandleA(){return this.m_envelopeHandleA}getHandleB(){return this.m_envelopeHandleB}setTolerance(t){this.m_tolerance=t}getElement(t){return this.m_elementsRed[t]}getRedEnvelope(t){return this.m_envelopesRed[t]}getBlueEnvelope(t){return this.m_envelopesBlue[t]}getRedElement(t){return this.m_elementsRed[t]}getBlueElement(t){return this.m_elementsBlue[t]}isTop_(t){return!(1&~t)}isBottom_(t){return!(1&t)}reset_(){this.m_bAddRed=!1,this.m_bAddBlue=!1,this.m_bAddRedRed=!1,this.m_sweepIndexRed=-1,this.m_sweepIndexBlue=-1,this.m_queuedListRed=-1,this.m_queuedListBlue=-1,this.m_bDone=!0}initialize_(){if(this.m_envelopeHandleA=-1,this.m_envelopeHandleB=-1,this.m_envelopesRed.length<10)return this.m_sweepIndexRed=this.m_envelopesRed.length,this.m_function=this.sweepBruteForce_,!0;this.m_intervalTreeRed||(this.m_intervalTreeRed=new R(!0)),this.m_intervalTreeRed.addEnvelopesRef(this.m_envelopesRed),this.m_iteratorRed===null&&(this.m_iteratorRed=this.m_intervalTreeRed.getIterator()),this.m_sortedEndIndicesRed.resize(0);for(let t=0;t<2*this.m_envelopesRed.length;t++)this.m_sortedEndIndicesRed.add(t);return this.sortYEndIndices_(this.m_sortedEndIndicesRed,0,2*this.m_envelopesRed.length,!0),this.m_sweepIndexRed=2*this.m_envelopesRed.length,this.m_function=this.sweep_,!0}initializeRed_(){if(this.m_envelopeHandleA=-1,this.m_envelopeHandleB=-1,this.m_envelopesRed.length<10||this.m_envelopesBlue.length<10)return this.m_sweepIndexRed=this.m_envelopesRed.length,this.m_function=this.sweepRedBlueBruteForce_,!0;this.m_intervalTreeRed||(this.m_intervalTreeRed=new R(!0)),this.m_intervalTreeRed.addEnvelopesRef(this.m_envelopesRed),this.m_iteratorRed===null&&(this.m_iteratorRed=this.m_intervalTreeRed.getIterator()),this.m_sortedEndIndicesRed.resize(0);for(let t=0;t<2*this.m_envelopesRed.length;t++)this.m_sortedEndIndicesRed.add(t);return this.sortYEndIndices_(this.m_sortedEndIndicesRed,0,this.m_sortedEndIndicesRed.size(),!0),this.m_sweepIndexRed=this.m_sortedEndIndicesRed.size(),this.m_queuedListRed!==-1&&(this.m_queuedEnvelopes.deleteList(this.m_queuedListRed),this.m_queuedIndicesRed.length=0,this.m_queuedListRed=-1),this.m_function=this.sweepRedBlue_,this.resetBlue_()}initializeBlue_(){if(this.m_envelopeHandleA=-1,this.m_envelopeHandleB=-1,this.m_envelopesRed.length<10||this.m_envelopesBlue.length<10)return this.m_sweepIndexRed=this.m_envelopesRed.length,this.m_function=this.sweepRedBlueBruteForce_,!0;this.m_intervalTreeBlue||(this.m_intervalTreeBlue=new R(!0)),this.m_intervalTreeBlue.addEnvelopesRef(this.m_envelopesBlue),this.m_iteratorBlue==null&&(this.m_iteratorBlue=this.m_intervalTreeBlue.getIterator()),this.m_sortedEndIndicesBlue.resize(0);for(let t=0;t<2*this.m_envelopesBlue.length;t++)this.m_sortedEndIndicesBlue.add(t);return this.sortYEndIndices_(this.m_sortedEndIndicesBlue,0,this.m_sortedEndIndicesBlue.size(),!1),this.m_sweepIndexBlue=this.m_sortedEndIndicesBlue.size(),this.m_queuedListBlue!==-1&&(this.m_queuedEnvelopes.deleteList(this.m_queuedListBlue),this.m_queuedIndicesBlue.length=0,this.m_queuedListBlue=-1),this.m_function=this.sweepRedBlue_,this.resetRed_()}initializeRedBlue_(){if(this.m_envelopeHandleA=-1,this.m_envelopeHandleB=-1,this.m_envelopesRed.length<10||this.m_envelopesBlue.length<10)return this.m_sweepIndexRed=this.m_envelopesRed.length,this.m_function=this.sweepRedBlueBruteForce_,!0;this.m_intervalTreeRed||(this.m_intervalTreeRed=new R(!0)),this.m_intervalTreeBlue||(this.m_intervalTreeBlue=new R(!0)),this.m_intervalTreeRed.addEnvelopesRef(this.m_envelopesRed),this.m_intervalTreeBlue.addEnvelopesRef(this.m_envelopesBlue),this.m_iteratorRed===null&&(this.m_iteratorRed=this.m_intervalTreeRed.getIterator()),this.m_iteratorBlue===null&&(this.m_iteratorBlue=this.m_intervalTreeBlue.getIterator()),this.m_sortedEndIndicesRed.resize(0),this.m_sortedEndIndicesBlue.resize(0);for(let t=0;t<2*this.m_envelopesRed.length;t++)this.m_sortedEndIndicesRed.add(t);for(let t=0;t<2*this.m_envelopesBlue.length;t++)this.m_sortedEndIndicesBlue.add(t);return this.sortYEndIndices_(this.m_sortedEndIndicesRed,0,this.m_sortedEndIndicesRed.size(),!0),this.sortYEndIndices_(this.m_sortedEndIndicesBlue,0,this.m_sortedEndIndicesBlue.size(),!1),this.m_sweepIndexRed=this.m_sortedEndIndicesRed.size(),this.m_sweepIndexBlue=this.m_sortedEndIndicesBlue.size(),this.m_queuedListRed!==-1&&(this.m_queuedEnvelopes.deleteList(this.m_queuedListRed),this.m_queuedIndicesRed.length=0,this.m_queuedListRed=-1),this.m_queuedListBlue!==-1&&(this.m_queuedEnvelopes.deleteList(this.m_queuedListBlue),this.m_queuedIndicesBlue.length=0,this.m_queuedListBlue=-1),this.m_function=this.sweepRedBlue_,!0}sweep_(){let t=this.m_sortedEndIndicesRed.read(--this.m_sweepIndexRed),e=t>>1;if(this.isBottom_(t))return this.m_intervalTreeRed.remove(e),this.m_sweepIndexRed!==0||(this.m_envelopeHandleA=-1,this.m_envelopeHandleB=-1,this.m_bDone=!0,!1);let s=T.construct(this.m_envelopesRed[e].xmin,this.m_envelopesRed[e].xmax);return this.m_iteratorRed.resetIterator(s,this.m_tolerance),this.m_envelopeHandleA=e,this.m_function=this.iterate_,!0}sweepBruteForce_(){return--this.m_sweepIndexRed==-1?(this.m_envelopeHandleA=-1,this.m_envelopeHandleB=-1,this.m_bDone=!0,!1):(this.m_envelopeHandleA=this.m_sweepIndexRed,this.m_sweepIndexBlue=this.m_sweepIndexRed,this.m_function=this.iterateBruteForce_,!0)}sweepRedBlueBruteForce_(){return--this.m_sweepIndexRed==-1?(this.m_envelopeHandleA=-1,this.m_envelopeHandleB=-1,this.m_bDone=!0,!1):(this.m_envelopeHandleA=this.m_sweepIndexRed,this.m_sweepIndexBlue=this.m_envelopesBlue.length,this.m_function=this.iterateRedBlueBruteForce_,!0)}sweepRedBlue_(){let t=this.m_sortedEndIndicesRed.read(this.m_sweepIndexRed-1),e=this.m_sortedEndIndicesBlue.read(this.m_sweepIndexBlue-1),s=this.getAdjustedValue_(t,!0),i=this.getAdjustedValue_(e,!1);return s>i?this.sweepRed_():s<i?this.sweepBlue_():this.isTop_(t)?this.sweepRed_():this.isTop_(e)?this.sweepBlue_():this.sweepRed_()}sweepRed_(){let t=this.m_sortedEndIndicesRed.read(--this.m_sweepIndexRed),e=t>>1;if(this.isBottom_(t))return this.m_queuedListRed!==-1&&this.m_queuedIndicesRed[e]!==-1?(this.m_queuedEnvelopes.deleteElement(this.m_queuedListRed,this.m_queuedIndicesRed[e]),this.m_queuedIndicesRed[e]=-1):this.m_intervalTreeRed.remove(e),this.m_sweepIndexRed!==0||(this.m_envelopeHandleA=-1,this.m_envelopeHandleB=-1,this.m_bDone=!0,!1);if(this.m_queuedListBlue!==-1&&this.m_queuedEnvelopes.getListSize(this.m_queuedListBlue)>0){let s=this.m_queuedEnvelopes.getFirst(this.m_queuedListBlue);for(;s!==-1;){let i=this.m_queuedEnvelopes.getData(s);this.m_intervalTreeBlue.insert(i),this.m_queuedIndicesBlue[i]=-1;let n=this.m_queuedEnvelopes.getNext(s);this.m_queuedEnvelopes.deleteElement(this.m_queuedListBlue,s),s=n}}if(this.m_intervalTreeBlue.size()>0){let s=T.construct(this.m_envelopesRed[e].xmin,this.m_envelopesRed[e].xmax);this.m_iteratorBlue.resetIterator(s,this.m_tolerance),this.m_envelopeHandleA=e,this.m_function=this.iterateBlue_}else this.m_queuedListRed===-1&&(mt(this.m_queuedIndicesRed,this.m_envelopesRed.length,-1),this.m_queuedListRed=this.m_queuedEnvelopes.createList(1)),this.m_queuedIndicesRed[e]=this.m_queuedEnvelopes.addElement(this.m_queuedListRed,e),this.m_function=this.sweepRedBlue_;return!0}sweepBlue_(){let t=this.m_sortedEndIndicesBlue.read(--this.m_sweepIndexBlue),e=t>>1;if(this.isBottom_(t))return this.m_queuedListBlue!==-1&&this.m_queuedIndicesBlue[e]!==-1?(this.m_queuedEnvelopes.deleteElement(this.m_queuedListBlue,this.m_queuedIndicesBlue[e]),this.m_queuedIndicesBlue[e]=-1):this.m_intervalTreeBlue.remove(e),this.m_sweepIndexBlue!==0||(this.m_envelopeHandleA=-1,this.m_envelopeHandleB=-1,this.m_bDone=!0,!1);if(this.m_queuedListRed!==-1&&this.m_queuedEnvelopes.getListSize(this.m_queuedListRed)>0){let s=this.m_queuedEnvelopes.getFirst(this.m_queuedListRed);for(;s!==-1;){let i=this.m_queuedEnvelopes.getData(s);this.m_intervalTreeRed.insert(i),this.m_queuedIndicesRed[i]=-1;let n=this.m_queuedEnvelopes.getNext(s);this.m_queuedEnvelopes.deleteElement(this.m_queuedListRed,s),s=n}}if(this.m_intervalTreeRed.size()>0){let s=T.construct(this.m_envelopesBlue[e].xmin,this.m_envelopesBlue[e].xmax);this.m_iteratorRed.resetIterator(s,this.m_tolerance),this.m_envelopeHandleB=e,this.m_function=this.iterateRed_}else this.m_queuedListBlue===-1&&(mt(this.m_queuedIndicesBlue,this.m_envelopesBlue.length,-1),this.m_queuedListBlue=this.m_queuedEnvelopes.createList(0)),this.m_queuedIndicesBlue[e]=this.m_queuedEnvelopes.addElement(this.m_queuedListBlue,e),this.m_function=this.sweepRedBlue_;return!0}iterate_(){if(this.m_envelopeHandleB=this.m_iteratorRed.next(),this.m_envelopeHandleB!==-1)return!1;let t=this.m_sortedEndIndicesRed.read(this.m_sweepIndexRed)>>1;return this.m_intervalTreeRed.insert(t),this.m_function=this.sweep_,!0}iterateRed_(){if(this.m_envelopeHandleA=this.m_iteratorRed.next(),this.m_envelopeHandleA!==-1)return!1;this.m_envelopeHandleA=-1,this.m_envelopeHandleB=-1;let t=this.m_sortedEndIndicesBlue.read(this.m_sweepIndexBlue)>>1;return this.m_intervalTreeBlue.insert(t),this.m_function=this.sweepRedBlue_,!0}iterateBlue_(){if(this.m_envelopeHandleB=this.m_iteratorBlue.next(),this.m_envelopeHandleB!==-1)return!1;let t=this.m_sortedEndIndicesRed.read(this.m_sweepIndexRed)>>1;return this.m_intervalTreeRed.insert(t),this.m_function=this.sweepRedBlue_,!0}iterateBruteForce_(){if(--this.m_sweepIndexBlue==-1)return this.m_function=this.sweepBruteForce_,!0;let t=this.m_envelopesRed[this.m_sweepIndexRed].clone(),e=this.m_envelopesRed[this.m_sweepIndexBlue];return t.inflateCoords(this.m_tolerance,this.m_tolerance),!t.isIntersecting(e)||(this.m_envelopeHandleB=this.m_sweepIndexBlue,!1)}iterateRedBlueBruteForce_(){if(--this.m_sweepIndexBlue==-1)return this.m_function=this.sweepRedBlueBruteForce_,!0;let t=this.m_envelopesRed[this.m_sweepIndexRed].clone(),e=this.m_envelopesBlue[this.m_sweepIndexBlue];return t.inflateCoords(this.m_tolerance,this.m_tolerance),!t.isIntersecting(e)||(this.m_envelopeHandleB=this.m_sweepIndexBlue,!1)}resetRed_(){return this.m_sweepIndexRed=this.m_sortedEndIndicesRed.size(),this.m_intervalTreeRed.size()>0&&this.m_intervalTreeRed.reset(),this.m_queuedListRed!==-1&&(this.m_queuedEnvelopes.deleteList(this.m_queuedListRed),this.m_queuedIndicesRed.length=0,this.m_queuedListRed=-1),this.m_bDone=!1,!0}resetBlue_(){return this.m_sweepIndexBlue=this.m_sortedEndIndicesBlue.size(),this.m_intervalTreeBlue.size()>0&&this.m_intervalTreeBlue.reset(),this.m_queuedListBlue!==-1&&(this.m_queuedEnvelopes.deleteList(this.m_queuedListBlue),this.m_queuedIndicesBlue.length=0,this.m_queuedListBlue=-1),this.m_bDone=!1,!0}nullFunc_(){return H("should not be called"),!1}sortYEndIndices_(t,e,s,i){let n=this,o={userSort(h,a,m){n.sortYEndIndicesHelper_(m,h,a,i)},getValue:h=>n.getAdjustedValue_(h,i)};new yt().sort(t,e,s,o)}sortYEndIndicesHelper_(t,e,s,i){t.sort(e,s,(n,o)=>{let h=this.getAdjustedValue_(n,i),a=this.getAdjustedValue_(o,i);return h<a||h===a&&this.isBottom_(n)&&this.isTop_(o)?-1:1})}getAdjustedValue_(t,e){let s=.5*this.m_tolerance;if(e){let n=this.m_envelopesRed[t>>1];return this.isBottom_(t)?n.ymin-s:n.ymax+s}let i=this.m_envelopesBlue[t>>1];return this.isBottom_(t)?i.ymin-s:i.ymax+s}},At=j,rt=class r{constructor(t,e){this.tolerance=t!==void 0?t:Number.NaN,this.resolution=e!==void 0?e:Number.NaN}add(t){return new r(this.tolerance+t,this.resolution)}scale(t){return new r(this.tolerance*t,this.resolution*t)}total(){return this.tolerance+this.resolution}};function me(r,t,e,s,i){let n=s*s,o=r.sub(t),h=e.sub(t),a=o.sqrLength(),m=h.sqrLength();if(a<=n||m<=n)return!0;let l=P(o.crossProduct(h));return l<=n*a||l<=n*m?o.dotProduct(h)>=0:!1}function Xt(r,t,e){return s=>e===0?(s+r)*t:1*(s-r*t)/t}function le(r,t){let e=new d;return r.queryLooseEnvelope(e),e.mergeEnvelope2D(t),e}function _e(r,t){let e=d.constructEmpty();r.queryLooseEnvelope(e);let s=d.constructEmpty();return t.queryLooseEnvelope(s),e.mergeEnvelope2D(s),e}function ue(r,t){return(Number.isFinite(r)||Number.isNaN(r))&&(Number.isFinite(t)||Number.isNaN(t))}function de(r,t){return Number.isFinite(r)&&Number.isFinite(t)}function ce(r,t,e){let s=d.constructEmpty();return s.setFromPoints(r,t),at(0,null,s.calculateToleranceFromEnvelope(),e,!1)}function Qt(r,t,e){return at(0,r,t.calculateToleranceFromEnvelope(),e,!1)}function Wt(r,t,e){return at(1,r,t.calculateToleranceFromEnvelope(),e,!1)}function pe(r,t,e){return Wt(r,t.queryInterval(1,0),e)}function ge(r,t,e){let s=d.constructEmpty();return t.queryEnvelope(s),Qt(r,s,e)}function jt(r,t,e=!1){return at(0,r,t.calculateToleranceFromEnvelope(),e,!0).total()}function fe(r,t,e){let s=d.constructEmpty();return t.queryEnvelope(s),jt(r,s,e)}function at(r,t,e,s,i){let n=new rt(0,0);if(t!==null&&(n.tolerance=t.getTolerance(r),(!i||s)&&t!==null)){let o=t.getResolution(r);n.resolution=o,s&&(n.resolution*=2)}return s&&(e*=4,n.tolerance*=1.01,n.resolution*=1.01),n.total()<e?new rt(e,0):n}function ve(r){return Math.sqrt(2)*(2*r.tolerance+r.resolution)}function ye(r){return Math.sqrt(2)*(r.tolerance+r.resolution)}function Jt(r){return r>=3}function xe(r,t){let e=[0];return r.getImpl().getIsSimple(t,e)>=3}function be(r,t){r.getImpl().setIsSimple(3,t)}function Ee(r,t,e,s){if(P(t.x-r.x)+P(t.y-r.y)<=e*e){let i=r.z,n=t.z;return X(i,n,s)}return!1}function Ne(r){return r>=4}function De(r,t){return r===C.enumPolygon?Jt(t):t>=1}function Ce(r,t,e){let s=d.constructEmpty(),i=d.constructEmpty();r.queryLooseEnvelope(s),t.queryLooseEnvelope(i),s.inflateCoords(e,e),i.inflateCoords(e,e);let n=d.constructEmpty();n.setCoords({env2D:s}),n.intersect(i);let o=r.querySegmentIterator(),h=t.querySegmentIterator(),a=d.constructEmpty(),m=d.constructEmpty(),l=new W;l.setTolerance(e);let _=!1;for(l.startRedConstruction();o.nextPath();)for(;o.hasNextSegment();)o.nextSegment().queryLooseEnvelope(a),a.isIntersecting(n)&&(_=!0,l.addRedEnvelope(o.getStartPointIndex(),a));if(l.endRedConstruction(),!_)return null;let u=!1;for(l.startBlueConstruction();h.nextPath();)for(;h.hasNextSegment();)h.nextSegment().queryLooseEnvelope(m),m.isIntersecting(n)&&(u=!0,l.addBlueEnvelope(h.getStartPointIndex(),m));return l.endBlueConstruction(),u?l:null}function Ie(r,t,e,s,i){r.getGeometryType(),t.getGeometryType();let n=d.constructEmpty(),o=d.constructEmpty();r.queryLooseEnvelope(n),t.queryLooseEnvelope(o),n.inflateCoords(e,e),o.inflateCoords(e,e);let h=d.constructEmpty();h.setCoords({env2D:n}),h.intersect(o);let a=new W;a.setTolerance(e);let m=!1;a.startRedConstruction();for(let _=0,u=r.getPathCount();_<u;_++)r.queryLoosePathEnvelope(_,n),n.isIntersecting(h)&&(m=!0,a.addRedEnvelope(_,n));if(a.endRedConstruction(),!m)return null;let l=!1;a.startBlueConstruction();for(let _=0,u=t.getPathCount();_<u;_++)t.queryLoosePathEnvelope(_,o),o.isIntersecting(h)&&(l=!0,a.addBlueEnvelope(_,o));return a.endBlueConstruction(),l?a:null}function Te(r,t,e){let s=d.constructEmpty(),i=d.constructEmpty();r.queryLooseEnvelope(s),t.queryEnvelope(i),s.inflateCoords(e,e),i.inflateCoords(e,e);let n=d.constructEmpty();n.setCoords({env2D:s}),n.intersect(i);let o=r.querySegmentIterator(),h=new W;h.setTolerance(e);let a=!1;for(h.startRedConstruction();o.nextPath();)for(;o.hasNextSegment();)o.nextSegment().queryLooseEnvelope(s),s.isIntersecting(n)&&(a=!0,h.addRedEnvelope(o.getStartPointIndex(),s));if(h.endRedConstruction(),!a)return null;let m=!1;h.startBlueConstruction();for(let l=0,_=t.getPointCount();l<_;l++){let u=t.getXY(l);n.contains(u)&&(m=!0,h.addBlueEnvelope(l,d.construct(u.x,u.y,u.x,u.y)))}return h.endBlueConstruction(),m?h:null}function Re(r,t,e){let s=d.constructEmpty(),i=d.constructEmpty();r.queryEnvelope(s),t.queryEnvelope(i),s.inflateCoords(e,e),i.inflateCoords(e,e);let n=d.constructEmpty();n.setCoords({env2D:s}),n.intersect(i);let o=new W;o.setTolerance(e);let h=!1;o.startRedConstruction();let a=new A;for(let _=0,u=r.getPointCount();_<u;_++)r.queryXY(_,a),n.contains(a)&&(h=!0,o.addRedEnvelope(_,d.construct(a.x,a.y,a.x,a.y)));if(o.endRedConstruction(),!h)return null;let m=!1;o.startBlueConstruction();let l=new A;for(let _=0,u=t.getPointCount();_<u;_++)t.queryXY(_,l),n.contains(l)&&(m=!0,o.addBlueEnvelope(_,d.construct(l.x,l.y,l.x,l.y)));return o.endBlueConstruction(),m?o:null}function we(r){let t=new d;return r.queryLooseEnvelope(t),t.inflateCoords(1,1),Kt(r,t)}function Kt(r,t,e){let s=new d;if(r.queryLooseEnvelope(s),s.isEmpty())return null;r.getGeometryType();let i=new F(s,8),n=-1,o=new d,h=!1;do for(let a=0,m=r.getPathCount();a<m;a++)if(r.queryLoosePathEnvelope(a,o),o.isIntersecting(t)){if(n=i.insertEx(a,o,n),n===-1){h&&H("build_quad_tree_for_paths"),s.assign(r.calculateEnvelope2D(!1)),h=!0,i.reset(s,8);break}h=!1}while(h);return i}function Ae(r,t){if(!t){let a=new d;r.queryLooseEnvelope(a);let m=new F(a,8),l=-1,_=new d,u=r.querySegmentIterator(),p=!1;for(;u.nextPath();)for(;u.hasNextSegment();){let x=u.nextSegment(),g=u.getStartPointIndex();if(x.queryLooseEnvelope(_),l=m.insertEx(g,_,l),l===-1){p&&H(""),a.assign(r.calculateEnvelope2D(!1)),p=!0,m.reset(a,8),u.resetToFirstPath();break}}return m}let e=new d;r.queryLooseEnvelope(e);let s=new F(e,8),i=-1,n=new d,o=r.querySegmentIterator(),h=!1;for(;o.nextPath();)for(;o.hasNextSegment();){let a=o.nextSegment(),m=o.getStartPointIndex();if(a.queryLooseEnvelope(n),n.isIntersecting(t)&&(i=s.insertEx(m,n,i),i===-1)){h&&H(""),e.assign(r.calculateEnvelope2D(!1)),h=!0,s.reset(e,8),o.resetToFirstPath();break}}return s}function qe(r,t){if(t){let e=new F(t,8),s=new A,i=new d,n=!1;for(let o=0;o<r.getPointCount();o++)s.setCoordsPoint2D(r.getXY(o)),t.contains(s)&&(i.setCoords({pt:s}),e.insert(o,i)!==-1||(n&&H(""),n=!0,e.reset(r.calculateEnvelope2D(),8),o=-1));return e}return Z("no-extent version not yet impl"),null}function qt(r,t,e,s,i){let n=!1,o=i.vmin,h=i.vmax;for(let a=e;a<t;a+=s){let m=r.read(a);m<o?(n=!0,r.write(a,o)):m>h&&(n=!0,r.write(a,h))}return n}function $t(r,t,e,s){if(!r.hasAttribute(e))return!1;let i=r.getGeometryType();if(i===C.enumGeometryCollection){let n=r,o=n.getGeometryCount(),h=0;for(let a=0;a<o;++a)h|=$t(n.getGeometry(a),t,e,s)?1:0;return!!h}if(Et(i)){let n=r,o=At.getPersistence(e),h=At.getComponentCount(e),a=n.getPointCount();if(o===1){let m=qt(n.getAttributeStreamRef(e),a*h,s,h,t);return m&&n.notifyModified(),m}if(o===2){let m=qt(n.getAttributeStreamRef(e),a*h,s,h,t);return m&&n.notifyModified(),m}H("snap_coordinate not implemented")}if(i===C.enumEnvelope){let n=r,o=n.queryInterval(e,s),h=!1;return o.vmin<t.vmin&&(h=!0,o.vmin=t.vmin),o.vmax>t.vmax&&(h=!0,o.vmax=t.vmax),h&&n.setIntervalEnvelope(e,s,o),h}if(i===C.enumPoint){let n=r,o=n.getAttributeAsDbl(e,s),h=!1;return o<t.vmin&&(h=!0,o=t.vmin),o>t.vmax&&(h=!0,o=t.vmax),h&&n.setAttributeBasic(e,s,o),h}if(bt(i)){let n=r,o=n.getStartAttributeAsDbl(e,s),h=!1;return o<t.vmin&&(h=!0,o=t.vmin),o>t.vmax&&(h=!0,o=t.vmax),h&&n.setStartAttribute(e,s,o),o=n.getEndAttributeAsDbl(e,s),o<t.vmin&&(h=!0,o=t.vmin),o>t.vmax&&(h=!0,o=t.vmax),h&&n.setEndAttribute(e,s,o),h}H("snap_coordinate not implemented")}var z=j,ot=class r{constructor(t){if(this.m_description=null,this.x=Number.NaN,this.y=Number.NaN,this.m_attribs=null,t){if(!t.copy)return t.move?(this.m_description=t.move.m_description,t.move.m_description=null,this.m_attribs=t.move.m_attribs,t.move.m_attribs=null,this.x=t.move.x,void(this.y=t.move.y)):t.vd?(this.m_description=t.vd,void(t.attribBuffer?(this.m_attribs=t.attribBuffer,t.initDefaultValues&&this.setDefaultAttributeValues()):this.ensureAttributes())):t.pt?(this.m_description=O(),void this.setXY(t.pt)):void("x"in t&&("z"in t?(this.m_description=Yt(),this.ensureAttributes(),this.setXYZ(new wt(t.x,t.y,t.z))):(this.m_description=O(),this.setXYCoords(t.x,t.y))));t.copy.copyTo(this)}else this.m_description=O()}assignCopy(t){return this.m_attribs=null,t.copyTo(this),this}assignMove(t){return this.m_attribs=null,t.copyTo(this),t.setEmpty(),this}getXY(){return new A(this.x,this.y)}queryXY(t){t.x=this.x,t.y=this.y}setXY(t){this.x=t.x,this.y=t.y}setXYCoords(t,e){this.x=t,this.y=e}getXYZ(){let t=new wt;return t.x=this.x,t.y=this.y,t.z=this.getZ(),t}setXYZ(t){this.addAttribute(1),this.x=t.x,this.y=t.y,this.m_attribs[0]=t.z}getX(){return this.x}setX(t){this.x=t}getY(){return this.y}setY(t){this.y=t}getZ(){return this.m_description.hasZ()?this.m_attribs[0]:z.getDefaultValue(1)}setZ(t){this.addAttribute(1),this.m_attribs[0]=t}getM(){return this.getAttributeAsDbl(2,0)}setM(t){this.addAttribute(2),this.m_description.hasZ()?this.m_attribs[1]=t:this.m_attribs[0]=t}getID(){return this.getAttributeAsInt(3,0)}setID(t){this.setAttributeBasic(3,0,t)}isEqualXY(t,e){return e===void 0&&(e=0),Math.abs(t.x-this.x)<=e&&Math.abs(t.y-this.y)<=e}isEqualXYCoords(t,e,s){return s===void 0&&(s=0),Math.abs(t-this.x)<=s&&Math.abs(e-this.y)<=s}getAttributeAsDbl(t,e){if(t===0){if(e===0)return this.x;if(e===1)return this.y;I("")}let s=z.getComponentCount(t);(e<0||e>=s)&&I("");let i=this.m_description.getAttributeIndex(t);return i>=0?this.m_attribs[this.m_description.getPointAttributeOffset(i)-2+e]:z.getDefaultValue(t)}getAttributeAsInt(t,e){return Math.trunc(this.getAttributeAsDbl(t,e))}setAttributeBasic(t,e,s){if(t===0)return void(e===0?this.x=s:e===1?this.y=s:I(""));let i=z.getComponentCount(t);(e<0||e>=i)&&I("");let n=this.m_description.getAttributeIndex(t);n<0&&(this.addAttribute(t),n=this.m_description.getAttributeIndex(t)),this.m_attribs[this.m_description.getPointAttributeOffset(n)-2+e]=s}copyAttributesFrom(t,e){if(this===t)return;let s=t.getDescription();for(let i=e&&s.hasZ()?2:1,n=s.getAttributeCount();i<n;++i){let o=s.getSemantics(i),h=z.getComponentCount(o);for(let a=0;a<h;++a){let m=t.getAttributeAsDbl(o,a);this.setAttributeBasic(o,a,m)}}}getAttributeArray(){return this.m_attribs}getDescription(){return this.m_description}assignVertexDescription(t){this.m_description!==t&&this.assignVertexDescriptionImpl(t)}mergeVertexDescription(t){this.m_description!==t&&(this.m_description.hasAttributesFrom(t)||this.mergeVertexDescriptionImpl(t))}hasAttribute(t){return this.m_description.hasAttribute(t)}addAttribute(t){if(this.m_description.hasAttribute(t))return;let e=Lt(this.m_description,t);this.assignVertexDescription(e)}dropAttribute(t){if(!this.m_description.hasAttribute(t))return;let e=Pt(this.m_description,t);this.assignVertexDescription(e)}dropAllAttributes(){let t=O();t!==this.m_description&&this.assignVertexDescription(t)}getGeometryType(){return C.enumPoint}getDimension(){return 0}queryEnvelope(t){if(t instanceof xt)return t.setEmpty(),t.assignVertexDescription(this.m_description),void t.merge(this);if(t instanceof dt){if(this.isEmpty())return void t.setEmpty();let e=this.getXYZ();return t.xmin=e.x,t.ymin=e.y,t.zmin=e.z,t.xmax=e.x,t.ymax=e.y,void(t.zmax=e.z)}this.isEmpty()?t.setEmpty():(t.xmin=this.x,t.ymin=this.y,t.xmax=this.x,t.ymax=this.y)}queryLooseEnvelope(t){this.queryEnvelope(t)}queryInterval(t,e){let s=new T;if(this.isEmpty())return s.setEmpty(),s;let i=this.getAttributeAsDbl(t,e);return s.vmin=i,s.vmax=i,s}applyTransformation(t){if(!this.isEmpty()){if(t.m_TransformationType===1){let e=this.getXY();return t.transformInPlace(e),void this.setXY(e)}Z("3d not impl")}}transformAttribute(t,e,s,i,n){if(this.isEmpty())return;this.addAttribute(t);let o=this.getAttributeAsDbl(t,e),h=Xt(s,i,n);this.setAttributeBasic(t,e,h(o))}createInstance(){return new r({vd:this.m_description})}copyTo(t){if(this===t)return;t.getGeometryType()!==C.enumPoint&&v();let e=t;e.x=this.x,e.y=this.y,this.m_attribs?(e.assignVertexDescription(this.m_description),e.m_attribs=this.m_attribs.slice()):(e.releaseAttributes(),e.assignVertexDescription(this.m_description))}isEmpty(){return Number.isNaN(this.x)||Number.isNaN(this.y)}setEmpty(){this.m_description||(this.m_description=O(),this.releaseAttributes()),this.x=Number.NaN,this.y=Number.NaN,this.m_attribs&&k(this.m_attribs,this.m_description.getDefaultPointAttributes(),0,2,this.m_description.getTotalComponentCount()-2)}calculateArea2D(){return 0}calculateLength2D(){return 0}calculateLength3D(t){return 0}equals(t,e){if(t===this)return!0;if(t.getGeometryType()!==C.enumPoint)return!1;let s=t;if(this.m_description!==s.m_description||this.isEmpty()!==s.isEmpty())return!1;if(this.isEmpty())return!0;if(e===void 0&&(e=0),Math.abs(this.x-s.x)>e||Math.abs(this.y-s.y)>e)return!1;for(let i=0,n=this.m_description.getTotalComponentCount()-2;i<n;i++)if(!X(this.m_attribs[i],s.m_attribs[i],e))return!1;return!0}getBoundary(){return null}clone(){let t=new r({vd:this.m_description});return this.copyTo(t),t}swap(t){if(this===t)return;t.getGeometryType()!==C.enumPoint&&v("wrong geometry type");let e=t;e.m_description=B(this.m_description,this.m_description=e.m_description),e.x=B(this.x,this.x=e.x),e.y=B(this.y,this.y=e.y),e.m_attribs=B(this.m_attribs,this.m_attribs=e.m_attribs)}replaceNaNs(t,e){if(this.addAttribute(t),this.isEmpty())return;let s=z.getComponentCount(t);for(let i=0;i<s;i++){let n=this.getAttributeAsDbl(t,i);Number.isNaN(n)&&this.setAttributeBasic(t,i,e)}}lerp(t,e,s){if(t.getDescription()!==e.getDescription()&&v("Point.lerp"),this.assignVertexDescription(t.getDescription()),t.isEmpty()||e.isEmpty())return this.setEmpty(),this;this.ensureAttributes();let i=_t();t.queryValues(i,i.length);let n=_t();e.queryValues(n,n.length);let o=_t(),h=i,a=n,m=o,l=0;for(let _=0,u=this.m_description.getAttributeCount();_<u;_++){let p=this.m_description.getSemantics(_),x=z.getInterpolation(p),g=z.getComponentCount(p),y=z.getDefaultValue(p);Ct(x,h,a,m,l,g,s,y),h=h.slice(g),a=a.slice(g),l+=g}return this.setValues(o,l),this}setDefaultAttributeValues(){let t=this.m_description.getTotalComponentCount()-2;t>0&&(this.m_attribs?k(this.m_attribs,this.m_description.getDefaultPointAttributes(),0,2,t):this.m_attribs=this.m_description.getDefaultPointAttributes().slice(2))}static sqrDistance2D(t,e){return A.sqrDistanceCoords(t.x,t.y,e.x,e.y)}getImpl(){return this}mergeVertexDescriptionImpl(t){let e=St(this.getDescription(),t);this.assignVertexDescription(e)}releaseAttributes(){this.m_attribs=null}assignVertexDescriptionImpl(t){this.m_description||(this.m_description=O());let e=Bt();Ft(t,this.m_description,e);let s=null;t.getTotalComponentCount()-2>0&&(s=t.getDefaultPointAttributes().slice(2));for(let i=1,n=t.getAttributeCount();i<n;i++){let o=e[i];if(o!==-1){let h=this.m_description.getPointAttributeOffset(o)-2,a=t.getPointAttributeOffset(i)-2,m=z.getComponentCount(t.getSemantics(i));for(let l=0;l<m;l++)s[a+l]=this.m_attribs[h+l]}}this.m_attribs=s,this.m_description=t}ensureAttributes(){this.m_description.getTotalComponentCount()-2>0&&this.m_attribs===null&&(this.m_attribs=this.m_description.getDefaultPointAttributes().slice(2))}queryValues(t,e){let s=this.m_description.getTotalComponentCount();c(s<=e),t[0]=this.x,t[1]=this.y,k(t,this.m_attribs,2,0,s-2)}copyCommonAttributesTo(t){t.x=this.x,t.y=this.y;let e=t.getDescription();if(e===this.m_description)this.m_attribs&&k(t.m_attribs,this.m_attribs,0,0,this.m_description.getTotalComponentCount()-2);else{let s=0;for(let i=1,n=e.getAttributeCount();i<n;i++){let o=e.getSemantics(i),h=z.getComponentCount(o);if(this.m_description.hasAttribute(o)){let a=this.m_description.getPointAttributeOffset(this.m_description.getAttributeIndex(o))-2;for(;h!==0;)t.m_attribs[s++]=this.m_attribs[a++],h--}else{let a=z.getDefaultValue(o);for(;h!==0;)t.m_attribs[s++]=a,h--}}}}setValues(t,e){let s=this.m_description.getTotalComponentCount();c(s<=e),this.x=t[0],this.y=t[1],k(this.m_attribs,t,0,2,s-2)}dbgDefaultAttribs(){}};ot.type=C.enumPoint;var q=j;function ht(r,t){return t*(r.getTotalComponentCount()-2)}var S=class{constructor(t){if(this.m_attributes=null,t)if(t.xmin!==void 0)this.m_envelope2D=new d(t.xmin,t.ymin,t.xmax,t.ymax);else if(t.env2D!==void 0)this.m_envelope2D=new d(t.env2D);else if(t.move)this.m_envelope2D=new d(t.move.m_envelope2D),this.m_attributes=t.move.m_attributes,t.move.m_attributes=null;else{if(!t.moveEnv)throw new Error("unrecognized EnvelopeData constructor options");{let e=t.moveEnv.accessEnvelopeData();this.m_envelope2D=new d(e.m_envelope2D),this.m_attributes=e.m_attributes,e.m_attributes=null}}else this.m_envelope2D=d.constructEmpty()}ensureAttributes(t){let e=t.getTotalComponentCount()-2;!this.m_attributes&&e&&(this.m_attributes=V(2*e,Number.NaN),this.m_attributes.fill(Number.NaN))}copyTo(t,e){let s=e,i=t.getTotalComponentCount()-2;if(s.m_description!==t&&(s.releaseAttributes_(),s.m_description=t,i&&(s.m_data.m_attributes=V(2*i,Number.NaN))),i){c(this.m_attributes&&s.m_data.m_attributes);let n=2*i;k(s.m_data.m_attributes,this.m_attributes,0,0,n)}s.m_data.m_envelope2D=new d(this.m_envelope2D)}copyToIfNotNull(t,e){e.m_envelope2D=new d(this.m_envelope2D),e.releaseAttributes(),t.getTotalComponentCount()-2&&this.m_attributes&&(e.m_attributes=this.m_attributes.slice())}releaseAttributes(){this.m_attributes=null}isEmpty(){return this.m_envelope2D.isEmpty()}transformAttribute(t,e,s,i,n){c(0)}queryInterval(t,e,s,i){if(this.isEmpty())return void i.setEmpty();if(e===0)return void(s===0?this.m_envelope2D.queryIntervalX(i):s===1?this.m_envelope2D.queryIntervalY(i):I(""));let n=q.getComponentCount(e);(s<0||s>=n)&&I("");let o=t.getAttributeIndex(e);if(o>=0)return i.vmin=this.m_attributes[ht(t,0)+t.getPointAttributeOffset(o)-2+s],void(i.vmax=this.m_attributes[ht(t,1)+t.getPointAttributeOffset(o)-2+s]);{let h=q.getDefaultValue(e);return void i.setCoords(h,h)}}queryEnvelope3D(t,e){let s=new T;this.queryInterval(t,1,0,s),e.setCoords(this.m_envelope2D.xmin,this.m_envelope2D.ymin,s.vmin,this.m_envelope2D.xmax,this.m_envelope2D.ymax,s.vmax)}setEmpty(t){this.m_envelope2D.setEmpty();let e=t.getTotalComponentCount()-2;e&&(this.m_attributes?this.dbgAssertSize(e):this.m_attributes=V(2*e,Number.NaN),this.m_attributes.fill(Number.NaN))}dbgAssertSize(t){}},xt=class K{constructor(t){if(this.m_EnvelopeType=4,this.m_description=O(),t===void 0)this.m_data=new S;else if(t.vd!==void 0)this.m_description=t.vd,this.m_data=new S,this.ensureAttributes_();else if(t?.env2D)this.m_data=new S({env2D:t.env2D});else if(t.xmin!==void 0)this.m_data=new S({xmin:t.xmin,ymin:t.ymin,xmax:t.xmax,ymax:t.ymax});else if(t.copy)this.m_data=new S,t.copy.copyTo(this);else if(t.move)this.m_description=t.move.m_description,t.move.m_description=null,this.m_data=new S({move:t.move.m_data});else{if(!t.centerPoint)throw new Error("unrecognized Envelope constructor options");this.m_description=t.centerPoint.getDescription(),this.m_data=new S,this.ensureAttributes_(),this.setFromPoint(t.centerPoint,t.width,t.height)}}accessEnvelopeData(){return this.m_description=null,this.m_data}assignMove(t){return this===t||(this.m_description=t.m_description,t.m_description=null,this.m_data=new S({move:t.m_data})),this}assignCopy(t){return this===t||t.copyTo(this),this}transformAttribute(t,e,s,i,n){c(0)}setAttributeBasic(t,e,s){if(this.addAttribute(t),this.m_data.isEmpty())return;let i=this.queryInterval(t,e);i.vmin=s,i.vmax=s,this.setIntervalEnvelope(t,e,i)}mergeVertexDescriptionImpl(t){let e=St(this.getDescription(),t);this.assignVertexDescription(e)}asEnvelope2D(){return new d(this.m_data.m_envelope2D)}assignVertexDescription(t){this.m_description!==t&&this.assignVertexDescriptionImpl(t)}getGeometryType(){return C.enumEnvelope}getDimension(){return 2}getXMin(){return this.m_data.m_envelope2D.xmin}getYMin(){return this.m_data.m_envelope2D.ymin}getXMax(){return this.m_data.m_envelope2D.xmax}getYMax(){return this.m_data.m_envelope2D.ymax}width(){return this.m_data.isEmpty()?Number.NaN:this.m_data.m_envelope2D.width()}height(){return this.m_data.isEmpty()?Number.NaN:this.m_data.m_envelope2D.height()}getCenterXY(){return this.m_data.isEmpty()?new A:this.m_data.m_envelope2D.getCenter()}getCenter(t){if(t.assignVertexDescription(this.m_description),this.m_data.isEmpty())return void t.setEmpty();let e=this.m_description.getAttributeCount();for(let s=1;s<e;s++){let i=this.m_description.getSemantics(s),n=q.getComponentCount(i);for(let o=0;o<n;o++){let h=.5*(this.getAttributeAsDblImpl(0,i,o)+this.getAttributeAsDblImpl(1,i,o));t.setAttributeBasic(i,o,h)}}t.setXY(this.m_data.m_envelope2D.getCenter())}setCoords(t,e,s,i){this.m_data.m_envelope2D.setCoords({xmin:t,ymin:e,xmax:s,ymax:i})}setEnvelope(t){if(t instanceof d)this.m_data.m_envelope2D=new d(t),this.m_data.m_envelope2D.normalize();else{this.addAttribute(1),this.m_data.m_envelope2D=t.getEnvelope2D(),this.m_data.m_envelope2D.normalize();let e=T.constructEmpty();e.setCoords(t.zmin,t.zmax),this.setInterval(1,0,e.vmin,e.vmax)}}merge(t){if(t instanceof d)return t.isValid()||v(""),void this.m_data.m_envelope2D.mergeEnvelope2D(t);if(t instanceof K){if(t.m_data.isEmpty())return;let e=t.getDescription();this.mergeVertexDescription(e),this.m_data.m_envelope2D.mergeEnvelope2D(t.m_data.m_envelope2D);for(let s=1,i=e.getAttributeCount();s<i;s++){let n=e.getSemantics(s),o=q.getComponentCount(n);for(let h=0;h<o;h++){let a=t.queryInterval(n,h),m=this.queryInterval(n,h);m.merge(a),this.setIntervalEnvelope(n,h,m)}}}else if(t instanceof ot){let e=t;if(e.isEmpty())return;let s=e.getDescription();if(this.mergeVertexDescription(s),this.m_data.isEmpty())return void this.setFromPoint(e);this.m_data.m_envelope2D.merge(e.getXY());for(let i=1,n=s.getAttributeCount();i<n;i++){let o=s.getSemantics(i),h=q.getComponentCount(o);for(let a=0;a<h;a++){let m=e.getAttributeAsDbl(o,a),l=this.queryInterval(o,a);l.mergeCoordinate(m),this.setIntervalEnvelope(o,a,l)}}}else Z("unrecognized type for envelope.merge")}intersect(t){if(!this.m_data.m_envelope2D.intersect(t.m_data.m_envelope2D))return this.setEmpty(),!1;let e=t.getDescription();this.mergeVertexDescription(e);for(let s=1,i=this.m_description.getAttributeCount();s<i;s++){let n=this.m_description.getSemantics(s),o=q.getComponentCount(n);for(let h=0;h<o;h++){let a=t.queryInterval(n,h),m=this.queryInterval(n,h);m.intersect(a),this.setIntervalEnvelope(n,h,m)}}return!0}intersectCommonAttributes(t){if(!this.m_data.m_envelope2D.intersect(t.m_data.m_envelope2D))return this.setEmpty(),!1;let e=t.getDescription();for(let s=1,i=this.m_description.getAttributeCount();s<i;s++){let n=this.m_description.getSemantics(s);if(!e.hasAttribute(n))continue;let o=q.getComponentCount(n);for(let h=0;h<o;h++){let a=t.queryInterval(n,h),m=this.queryInterval(n,h);m.intersect(a),this.setIntervalEnvelope(n,h,m)}}return!0}move(t,e){this.m_data.m_envelope2D.move(t,e)}centerAt(t,e){this.m_data.m_envelope2D.centerAtCoords(t,e)}centerAtPoint(t){this.m_data.m_envelope2D.centerAt(t)}reaspect(t,e){this.m_data.m_envelope2D.reaspect(t,e)}inflateCoords(t,e){this.m_data.m_envelope2D.inflateCoords(t,e)}containsCoords(t,e){return this.m_data.m_envelope2D.containsCoords(t,e)}contains(t){return this.m_data.m_envelope2D.contains(t)}containsPoint(t){return!t.isEmpty()&&this.m_data.m_envelope2D.contains(t.getXY())}containsEnvelope(t){return this.m_data.m_envelope2D.containsEnvelope(t.m_data.m_envelope2D)}setIntervalEnvelope(t,e,s){if(this.addAttribute(t),this.m_data.isEmpty())return;let i=new T(s);if(i.normalize(),t===0){if(i.isEmpty())return void this.setEmpty();e===0?(this.m_data.m_envelope2D.xmin=i.vmin,this.m_data.m_envelope2D.xmax=i.vmax):e===1?(this.m_data.m_envelope2D.ymin=i.vmin,this.m_data.m_envelope2D.ymax=i.vmax):I("")}else this.setAttributeAsDblImpl(0,t,e,i.vmin),this.setAttributeAsDblImpl(1,t,e,i.vmax)}setInterval(t,e,s,i){this.setIntervalEnvelope(t,e,new T(s,i))}queryInterval(t,e){let s=new T;return this.m_data.queryInterval(this.m_description,t,e,s),s}queryEnvelope(t){t.m_EnvelopeType!==2?t.m_EnvelopeType!==3?t.m_EnvelopeType!==4?Z("unrecognized type for queryEnveloper"):this.copyTo(t):this.m_data.queryEnvelope3D(this.m_description,t):t.setCoords({env2D:this.m_data.m_envelope2D})}applyTransformation(t){t.m_TransformationType!==1?c(0):t.transformEnvInPlace(this.m_data.m_envelope2D)}createInstance(){return new K({vd:this.m_description})}copyTo(t){t!==this&&this.m_data.copyTo(this.m_description,t)}isEmpty(){return this.m_data.isEmpty()}setEmpty(){this.m_description||(this.m_description=O()),this.m_data.setEmpty(this.m_description)}calculateArea2D(){return this.m_data.m_envelope2D.getArea()}calculateLength2D(){return this.m_data.m_envelope2D.getLength()}calculateLength3D(t){return c(0),0}equals(t,e){if(t===this)return!0;let s=t;if(this.m_description!==s.m_description||this.m_data.isEmpty()!==s.m_data.isEmpty())return!1;if(this.m_data.isEmpty())return!0;if(e===void 0&&(e=0),Math.abs(this.m_data.m_envelope2D.xmin-s.m_data.m_envelope2D.xmin)>e||Math.abs(this.m_data.m_envelope2D.ymin-s.m_data.m_envelope2D.ymin)>e||Math.abs(this.m_data.m_envelope2D.xmax-s.m_data.m_envelope2D.xmax)>e||Math.abs(this.m_data.m_envelope2D.ymax-s.m_data.m_envelope2D.ymax)>e)return!1;for(let i=0,n=2*(this.m_description.getTotalComponentCount()-2);i<n;i++)if(!X(this.m_data.m_attributes[i],s.m_data.m_attributes[i],e))return!1;return!0}getBoundary(){return Z("getBoundary not available in this context. Use the boundary operator with an envelope parameter"),null}clone(){return new K({copy:this})}swap(t){if(this===t)return;t.getGeometryType()!==C.enumEnvelope&&v("wrong geometry type");let e=t;e.m_description=B(this.m_description,this.m_description=e.m_description),e.m_data.m_envelope2D=B(this.m_data.m_envelope2D,this.m_data.m_envelope2D=e.m_data.m_envelope2D),e.m_data.m_attributes=B(this.m_data.m_attributes,this.m_data.m_attributes=e.m_data.m_attributes)}queryCoordinates(t){this.m_data.isEmpty()&&v(""),this.m_data.m_envelope2D.queryCorners(t)}queryCornerByVal(t,e){(t<0||t>3)&&I(""),e.assignVertexDescription(this.m_description);let s=this.getDescription().getAttributeCount();for(let i=1;i<s;i++){let n=this.m_description.getSemantics(i),o=q.getComponentCount(n);for(let h=0;h<o;h++)e.setAttributeBasic(n,h,this.getAttributeAsDblImpl(t%2,n,h))}e.setXY(this.m_data.m_envelope2D.queryCorner(t))}queryCorner(t,e){e.assign(this.m_data.m_envelope2D.queryCorner(t))}getDescription(){return this.m_description}mergeVertexDescription(t){this.m_description!==t&&(this.m_description&&this.m_description.hasAttributesFrom(t)||this.mergeVertexDescriptionImpl(t))}hasAttribute(t){return this.m_description.hasAttribute(t)}addAttribute(t){if(this.m_description.hasAttribute(t))return;let e=Lt(this.m_description,t);this.assignVertexDescription(e)}dropAttribute(t){if(!this.m_description.hasAttribute(t))return;let e=Pt(this.m_description,t);this.assignVertexDescription(e)}dropAllAttributes(){let t=O();t!==this.m_description&&this.assignVertexDescription(t)}queryLooseEnvelope(t){this.queryEnvelope(t)}replaceNaNs(t,e){if(this.addAttribute(t),this.m_data.isEmpty())return;let s=q.getComponentCount(t);for(let i=0;i<s;i++){let n=this.queryInterval(t,i);n.isEmpty()&&(n.vmin=e,n.vmax=e,this.setIntervalEnvelope(t,i,n))}}getImpl(){return this}setFromPoint(t,e,s){this.m_data.m_envelope2D.setCoords({center:t.getXY(),width:e??0,height:s??0});let i=t.getDescription();for(let n=1,o=i.getAttributeCount();n<o;n++){let h=i.getSemantics(n),a=q.getComponentCount(h);for(let m=0;m<a;m++){let l=t.getAttributeAsDbl(h,m);this.setInterval(h,m,l,l)}}}assignVertexDescriptionImpl(t){let e=Bt();Ft(t,this.m_description,e);let s=null,i=t.getTotalComponentCount()-2,n=this.m_description?this.m_description.getTotalComponentCount()-2:0;i>0&&(s=V(2*i,Number.NaN));for(let o=1;o<t.getAttributeCount();o++){let h=e[o];if(h!==-1){let a=t.getPointAttributeOffset(o)-2,m=q.getComponentCount(t.getSemantics(o)),l=this.m_description.getPointAttributeOffset(h)-2;k(s,this.m_data.m_attributes,a,l,m),k(s,this.m_data.m_attributes,i+a,n+l,m)}}this.releaseAttributes_(),this.m_data.m_attributes=s,this.m_description=t}getAttributeAsDblImpl(t,e,s){if(this.m_data.isEmpty()&&Nt(""),e===0)return t?s?this.m_data.m_envelope2D.ymax:this.m_data.m_envelope2D.xmax:s?this.m_data.m_envelope2D.ymin:this.m_data.m_envelope2D.xmin;s>=q.getComponentCount(e)&&I("");let i=this.m_description.getAttributeIndex(e);return i>=0?this.m_data.m_attributes[ht(this.m_description,t)+this.m_description.getPointAttributeOffset(i)-2+s]:j.getDefaultValue(e)}setAttributeAsDblImpl(t,e,s,i){e===0&&(t?s===1?this.m_data.m_envelope2D.ymax=i:s===0?this.m_data.m_envelope2D.xmax=i:I(""):s===1?this.m_data.m_envelope2D.ymin=i:s===0?this.m_data.m_envelope2D.xmin=i:I(""));let n=q.getComponentCount(e);(s<0||s>=n)&&I(""),this.addAttribute(e);let o=this.m_description.getAttributeIndex(e);this.m_data.m_attributes[ht(this.m_description,t)+this.m_description.getPointAttributeOffset(o)-2+s]=i}releaseAttributes_(){this.m_data.releaseAttributes()}ensureAttributes_(){this.m_data.ensureAttributes(this.m_description)}};xt.type=C.enumEnvelope;var ze=Object.freeze(Object.defineProperty({__proto__:null,Envelope:xt,EnvelopeData:S},Symbol.toStringTag,{value:"Module"}));export{zt as a,_t as b,j as c,Bt as d,St as e,Lt as f,Pt as g,O as h,Yt as i,Ft as j,wt as k,dt as l,ie as m,Ht as n,ne as o,re as p,oe as q,he as r,ae as s,$ as t,L as u,tt as v,yt as w,E as x,pt as y,gt as z,it as A,W as B,rt as C,me as D,Xt as E,le as F,_e as G,ue as H,de as I,ce as J,Qt as K,Wt as L,pe as M,ge as N,jt as O,fe as P,ve as Q,ye as R,Jt as S,xe as T,be as U,Ee as V,Ne as W,De as X,Ce as Y,Ie as Z,Te as _,Re as $,we as aa,Ae as ba,qe as ca,$t as da,ot as ea,S as fa,xt as ga,ze as ha};
