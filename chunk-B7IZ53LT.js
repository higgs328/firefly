import{a as ne,b as ft,c as ae,d as gt,e as le,f as vt,g as pe}from"./chunk-EOMINWGE.js";import{a as E}from"./chunk-EG4FJL5O.js";import{a as K,b as ye,c as Q,e as fe,g as ge,h as ve,i as x,j as wt}from"./chunk-QFVNHBLZ.js";import{a as de,b as he,e as ue,g as me,h as f}from"./chunk-LSWJMH3S.js";import{a as we,b as j}from"./chunk-GPTDVBAY.js";import{a as Ot}from"./chunk-EFTNLZSK.js";import{a as ce}from"./chunk-IMQ5CCH6.js";import{c as se}from"./chunk-SU2NZAJW.js";import{c as re}from"./chunk-7A3ZNBEY.js";import{a as ie}from"./chunk-IKNLDVQM.js";import{d as oe}from"./chunk-QCN4VUQF.js";import{b as ee}from"./chunk-KVIHP5QH.js";import{g as Xt,h as Jt}from"./chunk-NPMJUDJ7.js";import{b as qt,f as Wt,j as U,k as V,m as Bt}from"./chunk-67GIWMYL.js";import{e as Kt,g as Qt,j as $t,k as te}from"./chunk-2BJHWKO6.js";import{a as jt}from"./chunk-7XYYDAZO.js";import{o as Zt,w as Yt}from"./chunk-Z7TBAZRW.js";import{b as Nt,e as Y}from"./chunk-G2JMPZCN.js";import{a as F}from"./chunk-4NUW747S.js";import{a as Lt}from"./chunk-LAX5536Z.js";import{a as zt}from"./chunk-JQAW4OB5.js";import{a as Ht}from"./chunk-U2ZO6WN5.js";import{b as G,c as Pt,d as At,e as Gt,f as Ft,g as dt,o as ht,x as ut}from"./chunk-QXXXCEV5.js";import{B as yt,c as Dt,d as J,n as mt}from"./chunk-6B5XFA6F.js";import{c as Mt,i as ct}from"./chunk-BOVYXYHK.js";import{aa as pt}from"./chunk-NJWTSROP.js";import{a as Ct,e as lt,i as St,k as Et}from"./chunk-TG45K3WR.js";import{f as Rt}from"./chunk-RAI4DTMT.js";import{b as at}from"./chunk-ACP3S2CH.js";import{a as Vt}from"./chunk-T7DXJKX7.js";import{a as i}from"./chunk-QGVBCWUY.js";import{D as nt,H as X}from"./chunk-MYO4NP2N.js";import{e as s}from"./chunk-NFIPKH6V.js";import{l as m}from"./chunk-5QEXLALV.js";import{b as B}from"./chunk-4PTIEWMT.js";import{a as Z}from"./chunk-TG2UTNEO.js";import{a as st,b as Ut,f as g}from"./chunk-VTHXE323.js";var y;(function(t){t[t.NeverApplied=0]="NeverApplied",t[t.Applied=1]="Applied",t[t.Undone=2]="Undone"})(y||(y={}));var I;(function(t){t.UndoRedoUpdating="UndoRedoUpdating",t.UndoInvalidError="UndoInvalidError",t.RedoInvalidError="RedoInvalidError",t.ApplyInvalidError="ApplyInvalidError"})(I||(I={}));var tt={[I.UndoRedoUpdating]:"Cannot perform operation whilst undo redo is updating",[I.UndoInvalidError]:"There are no items to Undo",[I.RedoInvalidError]:"There are no items to Redo",[I.ApplyInvalidError]:"Cannot apply an item that is already applied"},R=class extends Error{constructor(){super(tt[I.UndoRedoUpdating]),this.type="undo-redo-updating-error"}},M=class extends Error{constructor(){super(tt[I.UndoInvalidError]),this.type="undo-redo-undo-error"}},q=class extends Error{constructor(){super(tt[I.RedoInvalidError]),this.type="undo-redo-redo-error"}},$=class extends Error{constructor(){super(tt[I.ApplyInvalidError]),this.type="undo-redo-apply-error"}};var T;(function(t){t[t.Apply=0]="Apply",t[t.Undo=1]="Undo",t[t.Redo=2]="Redo"})(T||(T={}));var et=class extends X{constructor(){super(...arguments),this.name="",this.tag=Symbol(),this.status=y.NeverApplied}get canUndo(){return this.status===y.Applied}get canRedo(){return this.status===y.Undone}executeUndoRedoOperation(t){return g(this,null,function*(){switch(t){case T.Apply:if(this.status!==y.NeverApplied)throw new $;return yield this.apply(),void(this.status=y.Applied);case T.Undo:if(this.status!==y.Applied)throw new M;return yield this.undo(),void(this.status=y.Undone);case T.Redo:if(this.status!==y.Undone)throw new M;return yield this.redo(),void(this.status=y.Applied)}})}};i([s()],et.prototype,"name",void 0),i([s()],et.prototype,"tag",void 0),et=i([m("esri.undoredo.UndoableOperation")],et);var O=class extends X{constructor(){super(...arguments),this._stack=new at,this._stackPosition=-1,this._updatingHandles=new zt}get updating(){return this._updatingHandles.updating}get canUndo(){return this.hasUndo&&!this.updating}get hasUndo(){return this._stackPosition>=0}get canRedo(){return this.hasRedo&&!this.updating}get hasRedo(){return this._stackPosition<this._stack.length-1}_truncateForwardStack(){this._stack.splice(this._stackPosition+1,this._stack.length-this._stackPosition).forEach(t=>t.destroy())}_drainStack(){this._stack.drain(t=>t.destroy()),this._stackPosition=-1}undo(){return g(this,null,function*(){if(!this.hasUndo)throw new M;if(this.updating)throw new R;let t=this._stack.getItemAt(this._stackPosition);t&&(yield this._updatingHandles.addPromise(g(this,null,function*(){yield t.executeUndoRedoOperation(T.Undo),--this._stackPosition,t.canRedo||this._truncateForwardStack()})))})}redo(){return g(this,null,function*(){if(!this.hasRedo)throw new q;if(this.updating)throw new R;let t=this._stack.getItemAt(this._stackPosition+1);if(!t)throw new q;yield this._updatingHandles.addPromise(g(this,null,function*(){yield t.executeUndoRedoOperation(T.Redo),++this._stackPosition}))})}peekUndo(){if(this.canUndo)return this._stack.getItemAt(this._stackPosition)}peekRedo(){if(this.canRedo)return this._stack.getItemAt(this._stackPosition+1)}inject(t){return g(this,null,function*(){if(this.updating)throw new R;yield this._updatingHandles.addPromise(g(this,null,function*(){t.status===y.NeverApplied&&(yield t.executeUndoRedoOperation(T.Apply)),t.canUndo?(this._stack.splice(this._stackPosition+1,0,t),this._stackPosition++):this._stackPosition>-1&&(this._stack.splice(0,this._stackPosition+1).forEach(e=>e.destroy()),this._stackPosition=-1)}))})}add(t){return g(this,null,function*(){if(this.updating)throw new R;yield this._updatingHandles.addPromise(g(this,null,function*(){t.status===y.NeverApplied&&(yield t.executeUndoRedoOperation(T.Apply)),this._stackPosition>=-1&&this._truncateForwardStack(),t.canUndo?(this._stack.push(t),this._stackPosition=this._stack.length-1):this._drainStack()}))})}removeTagged(t,e=!1){return g(this,null,function*(){if(this.updating&&!e)return;yield lt(()=>!this.updating);let o=new at;for(let r=0;r<this._stack.length;r++){let n=this._stack.getItemAt(r);n&&(n.tag===t?(n.destroy(),r===this._stackPosition&&(this._stackPosition=o.length-1)):o.push(n))}this._stack=o,this._stackPosition>o.length-1&&(this._stackPosition=o.length-1)})}clear(t=!1){return g(this,null,function*(){if(this.updating&&!t)throw new R;yield lt(()=>!this.updating),this._drainStack()})}};i([s()],O.prototype,"_stack",void 0),i([s()],O.prototype,"_stackPosition",void 0),i([s()],O.prototype,"updating",null),i([s({readOnly:!0})],O.prototype,"canUndo",null),i([s({readOnly:!0})],O.prototype,"hasUndo",null),i([s({readOnly:!0})],O.prototype,"canRedo",null),i([s({readOnly:!0})],O.prototype,"hasRedo",null),O=i([m("esri.UndoRedo")],O);var ot=class{constructor(){this.committedVertices=null,this.cursorVertex=null,this.full=null,this.outline=null,this.cursorEdge=null,this.circle=null,this.rectangle=null}};var k=class extends f{constructor(t){super(t),this.type="draw-circle",this.radius=null,this.xSize=null,this.ySize=null,this.area=V}get allFields(){return[]}};i([s()],k.prototype,"type",void 0),i([s()],k.prototype,"radius",void 0),i([s()],k.prototype,"xSize",void 0),i([s()],k.prototype,"ySize",void 0),i([s()],k.prototype,"area",void 0),i([s()],k.prototype,"helpMessage",void 0),i([s()],k.prototype,"allFields",null),k=i([m("esri.views.interactive.tooltip.infos.DrawCircleTooltipInfo")],k);var D=class extends x(f){constructor(t){super(t),this.type="draw-mesh",this.orientation=fe({lockable:!1}),this.scale=ge({lockable:!1})}get allFields(){return[this.longitude,this.latitude,this.x,this.y,this.elevation,this.orientation,this.scale]}};i([s()],D.prototype,"helpMessage",void 0),i([s()],D.prototype,"allFields",null),D=i([m("esri.views.interactive.tooltip.infos.DrawMeshTooltipInfo")],D);var z=class extends x(f){constructor(t){super(t),this.type="draw-multipoint"}get allFields(){return[this.longitude,this.latitude,this.x,this.y,this.elevation]}};i([s()],z.prototype,"helpMessage",void 0),i([s()],z.prototype,"allFields",null),z=i([m("esri.views.interactive.tooltip.infos.DrawMultipointTooltipInfo")],z);var H=class extends x(f){constructor(t){super(t),this.type="draw-point"}get allFields(){return[this.longitude,this.latitude,this.x,this.y,this.elevation]}};i([s()],H.prototype,"helpMessage",void 0),i([s()],H.prototype,"allFields",null),H=i([m("esri.views.interactive.tooltip.infos.DrawPointTooltipInfo")],H);var P=class extends x(f){constructor(t){super(t),this.type="draw-polygon",this.direction=K(),this.distance=Q(),this.area=ve(),this.xyMode="direction-distance"}get allFields(){return[this.direction,this.distance,this.longitude,this.latitude,this.x,this.y,this.elevation,this.area]}};i([s()],P.prototype,"xyMode",void 0),i([s()],P.prototype,"helpMessage",void 0),i([s()],P.prototype,"allFields",null),P=i([m("esri.views.interactive.tooltip.infos.DrawPolygonTooltipInfo")],P);var A=class extends x(f){constructor(t){super(t),this.type="draw-polyline",this.direction=K(),this.distance=Q(),this.totalLength=ye(),this.xyMode="direction-distance"}get allFields(){return[this.direction,this.distance,this.longitude,this.latitude,this.x,this.y,this.elevation,this.totalLength]}};i([s()],A.prototype,"helpMessage",void 0),i([s()],A.prototype,"xyMode",void 0),i([s()],A.prototype,"allFields",null),A=i([m("esri.views.interactive.tooltip.infos.DrawPolylineTooltipInfo")],A);var b=class extends f{constructor(t){super(t),this.type="draw-rectangle",this.xSize=U,this.ySize=U,this.area=V}get allFields(){return[]}};i([s()],b.prototype,"type",void 0),i([s()],b.prototype,"xSize",void 0),i([s()],b.prototype,"ySize",void 0),i([s()],b.prototype,"area",void 0),i([s()],b.prototype,"helpMessage",void 0),i([s()],b.prototype,"allFields",null),b=i([m("esri.views.interactive.tooltip.infos.DrawRectangleTooltipInfo")],b);function Oe(t,e){return{point:new H({sketchOptions:e,viewType:t}),multipoint:new z({sketchOptions:e,viewType:t}),polyline:new A({sketchOptions:e,viewType:t}),polygon:new P({sketchOptions:e,viewType:t}),mesh:new D({sketchOptions:e,viewType:t}),rectangle:new b({sketchOptions:e}),circle:new k({sketchOptions:e})}}function kt(t){let{directionOptions:e,geometryType:o,sketchOptions:r,tooltipInfos:n}=t,d=h=>{let l=rt(t).mode,u=n[h].elevation;l==="relative-to-ground"||l==="relative-to-scene"||l==="on-the-ground"?u.lock(It(t)):u.unlock()},a=h=>{if(e){let l=n[h].direction;l.committed=e.angle,l.unlockOnVertexPlacement=!1,r.values.directionMode=e.mode}};switch(o){case"polygon":case"polyline":d(o),a(o);break;case"point":case"mesh":d(o)}}function ke(t,e){let{drawOperation:o,view:r}=e,n=it(e),d=rt(e);if(r.type==="2d"||!t||d.mode!=="absolute-height"||o?.numCommittedVertices!==1||!n||n.type!=="draw-polyline"&&n.type!=="draw-polygon"||n.elevation.locked)return;let[a,h,l]=t,u=Le(a,h,l,d,e);u!=null&&n.elevation.lock(u)}function _t(t){it(t)?.allFields.forEach(e=>{e.unlockOnVertexPlacement&&e.unlock()})}function it({geometryType:t,graphic:e,tooltipInfos:o}){return e?.geometry?.type!==Se[t]?t==="circle"||t==="rectangle"?o[t]:null:o[t]}var Se={point:"point",multipoint:"multipoint",mesh:"mesh",polyline:"polyline",polygon:"polygon",circle:"polygon",rectangle:"polygon",freehandPolygon:"polygon",freehandPolyline:"polyline"};function _e(t,e){switch(t?.type){case"draw-point":Ee(t,e);break;case"draw-multipoint":Me(t,e);break;case"draw-polyline":Ae(t,e);break;case"draw-polygon":Ge(t,e);break;case"draw-rectangle":De(t,e);break;case"draw-circle":ze(t,e);break;case"draw-mesh":Pe(t,e)}}function Ee(t,e){let o=e.graphic?.geometry;o?.type==="point"&&(xt(t,o,e),t.helpMessage=E("point",o,e.drawOperation.drawingMode))}function Me(t,e){let o=e.graphic?.geometry;o?.type==="multipoint"&&(xt(t,o,e),t.helpMessage=E("multipoint",o,e.drawOperation.drawingMode))}function Pe(t,e){let{graphic:o,view:r}=e,n=o?.geometry;r.type!=="3d"||n&&n.type!=="mesh"||(xt(t,n?.origin,e),n&&he(t,n),t.helpMessage=ce(o,r))}function xt(t,e,o){let{drawOperation:r,view:n,sketchOptions:d}=o,{cursorVertex:a}=r;t.sketchOptions=d,t.viewType=n.type;let h=e?.type==="multipoint"?e.getPoint(e.points.length-1):e;if(t.setLocationFromPoint(h,L(o)),Ie(t.elevation,o),!a)return void(r.constraints=void 0);let l=a;r.constraints={context:Re(l,o),x:t.x.committed,y:t.y.committed,longitude:t.longitude.committed,latitude:t.latitude.committed,elevation:t.elevation.committed,distance:null,direction:null}}function Ae(t,e){let{createOperationGeometry:o,drawOperation:r}=e,n=o!=null?o.full:null;n&&n.type!=="polyline"||(xe(t,e),t.totalLength.actual=r.lastVertex?(n?we(n):null)??U:null,t.helpMessage=E("polyline",n,e.drawOperation.drawingMode))}function Ge(t,e){let{createOperationGeometry:o,drawOperation:r}=e,n=o!=null?o.full:null;n&&n.type!=="polygon"||(xe(t,e),t.area.actual=r.lastVertex?(n?wt(n):null)??V:null,t.helpMessage=E("polygon",n,e.drawOperation.drawingMode))}function xe(t,e){let{drawOperation:o,sketchOptions:r,view:n}=e,{cursorVertex:d,lastVertex:a,secondToLastVertex:h}=o,l=r.values.effectiveDirectionMode;t.sketchOptions=r,t.viewType=n.type;let u=a&&d?j(a,d)??U:null;if(t.distance.actual=u,t.distance.readOnly=a==null,t.direction.actual=null,t.direction.readOnly=!0,a&&d&&(l==="absolute"||h)){let C=oe(h,a,d,l);t.direction.actual=C??Bt,t.direction.readOnly=!1}t.setLocationFromPoint(d,L(e)),Ie(t.elevation,e);let v=Fe(a,e);t.xyMode=v,t.direction.visible=v==="direction-distance",t.distance.visible=v==="direction-distance",t.effectiveX.visible=v==="coordinates",t.effectiveY.visible=v==="coordinates";let _=d??a;o.constraints=_?{context:Re(_,e),x:t.x.committed,y:t.y.committed,longitude:t.longitude.committed,latitude:t.latitude.committed,elevation:t.elevation.committed,distance:t.distance.committed,direction:t.direction.committed}:void 0}function Fe(t,{sketchOptions:e}){let o=e.tooltips.xyMode;return o==="auto"?t?"direction-distance":"coordinates":o}function De(t,e){t.sketchOptions=e.sketchOptions,t.xSize=be(e),t.ySize=Ue(e),t.area=Te(e),t.helpMessage=E("rectangle",e.graphic?.geometry,e.drawOperation.drawingMode)}function ze(t,e){let{forceUniformSize:o,sketchOptions:r}=e;t.sketchOptions=r,t.radius=o?He(e):null,t.xSize=o?null:be(e),t.ySize=o?null:Ue(e),t.area=Te(e),t.helpMessage=E("circle",e.graphic?.geometry,e.drawOperation.drawingMode)}function Ie(t,e){let{drawOperation:o}=e,r=o?.cursorVertex??o?.lastVertex;t.actual=Xt(r)??It(e),t.visible=o.hasZ,t.readOnly=!1,t.showAsZ=!0}function Te(t){let e=t.createOperationGeometry?.full;return e?.type!=="polygon"?V:wt(e)??V}function be(t){let e=t.createOperationGeometry?.rectangle?.midpoints;return(e!=null?j(e.left,e.right):null)??U}function Ue(t){let e=t.createOperationGeometry?.rectangle?.midpoints;return(e!=null?j(e.top,e.bottom):null)??U}function He({createOperationGeometry:t}){return(t?.circle?.center!=null&&t.circle.edge!=null?j(t.circle.center,t.circle.edge):null)??U}function Ve(t){let{geometryType:e,tooltipInfos:o}=t;switch(e){case"point":case"multipoint":case"mesh":case"polyline":case"polygon":{let r=o[e].elevation.committed;return r?Wt(r,"meters")/pt(L(t)):void 0}default:return}}function Le(t,e,o,r,n){let{view:d,drawOperation:a}=n;if(d.type!=="3d"||!a)return;o??=0;let h=L(n),l=rt(n),u=Zt(d,t,e,o,h,l,r);return Jt(u,h)??It(n)}function rt(t){return t.drawOperation.elevationInfo??Yt}function L(t){return t.drawOperation.coordinateHelper.spatialReference}function It(t){let e=pt(L(t));return qt(t.defaultZ*e,"meters")}function Re(t,e){return ie(t,e.view,L(e),rt(e),e.drawOperation.coordinateHelper.hasZ(),e.sketchOptions.values.effectiveDirectionMode)}var p=class extends Vt.EventedMixin(ee){constructor(t){super(t),this._graphic=null,this._coordinateFormatterLoadTask=null,this._createOperationGeometry=null,this.defaultZ=0,this.directionOptions=null,this.elevationLockOnVertexAddDisabled=!1,this.geometryType=null,this.hasZ=!0,this.geometryToPlace=null,this.snappingManager=null,this.snapToScene=!1,this.sketchOptions=new Ot}initialize(){let{view:t}=this;this.internalGraphicsLayer=new jt({listMode:"hide",internal:!0}),this.view.map.layers.add(this.internalGraphicsLayer);let e=this.drawOperation=this.makeDrawOperation();this.tooltipInfos=Oe(t.type,this.sketchOptions);let o=de(()=>({view:t,options:this.sketchOptions.tooltips}));this.tooltip=o,kt(this._tooltipsContext),this._coordinateFormatterLoadTask=Rt(()=>se()),this.addHandles([e.on("vertex-add",r=>this.onVertexAdd(r)),e.on("vertex-remove",r=>this.onVertexRemove(r)),e.on("vertex-update",r=>this.onVertexUpdate(r)),e.on("cursor-update",r=>this.onCursorUpdate(r)),e.on("cursor-remove",()=>this._updateGraphic()),e.on("complete",r=>this.onComplete(r)),this._coordinateFormatterLoadTask,o.on("paste",r=>me(r,this.activeTooltipInfo)),Ct(()=>this.cursor,r=>{e.cursor=r},Et),nt(()=>{let{activeTooltipInfo:r,sketchOptions:n}=this;_e(r,this._tooltipsContext),o.info=n.tooltips.effectiveEnabled?r:null}),nt(()=>{e.constraintZ=Ve(this._tooltipsContext)},St)]),this.finishToolCreation()}destroy(){this.drawOperation=B(this.drawOperation),this.tooltip=B(this.tooltip),this._destroyAllVisualizations(),this.view.map.remove(this.internalGraphicsLayer),this.internalGraphicsLayer=B(this.internalGraphicsLayer),this._set("view",null)}get _drawSpatialReference(){return this.drawOperation.coordinateHelper.spatialReference}get _tooltipsContext(){return{createOperationGeometry:this._createOperationGeometry,defaultZ:this.defaultZ,directionOptions:this.directionOptions,drawOperation:this.drawOperation,forceUniformSize:this.forceUniformSize,geometryType:this.geometryType,graphic:this.graphic,sketchOptions:this.sketchOptions,tooltipInfos:this.tooltipInfos,view:this.view}}get canRedo(){return this.drawOperation.canRedo}get canUndo(){return this.drawOperation.canUndo}set centered(t){this._set("centered",t),this._updateGraphic()}get cursor(){return this._get("cursor")}set cursor(t){this._set("cursor",t)}set enabled(t){this.drawOperation.interactive=t,this._set("enabled",t)}set forceUniformSize(t){this._set("forceUniformSize",t),this._updateGraphic()}get graphic(){return this._graphic}set graphicSymbol(t){this._set("graphicSymbol",t),this._graphic!=null&&(this._graphic.symbol=t)}set mode(t){let e=this.drawOperation;e&&(e.drawingMode=t),this._set("mode",t)}get updating(){return this.drawOperation?.updating??!1}get undoRedo(){let{view:{type:t,map:e}}=this;return t==="2d"&&e&&"undoRedo"in e&&e.undoRedo instanceof O?e.undoRedo:null}set undoRedo(t){this._override("undoRedo",t)}completeCreateOperation(){this.drawOperation.complete()}onInputEvent(t){this.destroyed||ue(t,this.tooltip)||this.drawOperation.onInputEvent(t)}redo(){this.drawOperation.redo()}reset(){}undo(){this.drawOperation.undo(),this.drawOperation.numCommittedVertices===0&&kt(this._tooltipsContext)}_destroyAllVisualizations(){this.removeHandles(w.outline),this.removeHandles(w.regularVertices),this.removeHandles(w.activeVertex),this.removeHandles(w.activeEdge),this.removeHandles(Tt)}_createOrUpdateGraphic(t){if(this._graphic!=null)return this.updateGraphicGeometry(t),this._graphic;let e=new Lt(Ut(st({},this.graphicProperties),{symbol:this.graphicSymbol}));return this._graphic=e,this.updateGraphicGeometry(t),this.internalGraphicsLayer.add(e),this.addHandles(this.initializeGraphic(e)),this.notifyChange("graphic"),this.addHandles(Z(()=>{this.internalGraphicsLayer.remove(e),this._graphic===e&&(this._graphic=null)}),Tt),e}updateGraphicGeometry(t){this._graphic.geometry=t}_getCreateOperationGeometry(t={operationComplete:!1}){if(this.drawOperation==null)return;let{coordinateHelper:e,view:o,visualizationCursorVertex:r,lastVertex:n,committedVertices:d,geometryIncludingUncommittedVertices:a,numCommittedVertices:h}=this.drawOperation;if(!(h>0||r!=null))return;let l=t.operationComplete?d:a,u=l.length,v=r!=null?e.pointToArray(r):null,_=this._drawSpatialReference,C=o.type==="3d"&&o.viewingMode==="global",c=new ot;c.committedVertices=d,c.cursorVertex=v;let{geometryType:N}=this;switch(N){case"point":case"mesh":c.full=e.arrayToPoint(l[0]);break;case"multipoint":c.full=u>0?ne(l,_):null;break;case"polyline":case"polygon":u>0&&(c.full=N==="polygon"?ae([l],_,C,!0):ft([l],_,C),c.cursorEdge=v!=null&&n&&!Ht(r,n)?ft([[v,e.pointToArray(n)]],_,C):null,c.outline=u>1?c.full:null);break;case"circle":case"rectangle":{if(c.committedVertices=c.cursorVertex=null,!u)break;let S=re(o,l[0]),W=l[0],bt=S.makeMapPoint(W[0]+Ne*o.resolution,W[1]);N==="circle"?u===1&&t.operationComplete?c.circle=vt([W,bt],S,!0):u===2&&(this.forceUniformSize?c.circle=vt(l,S,this.centered):c.rectangle=pe(l,S,this.centered)):u===1&&t.operationComplete?c.rectangle=gt([W,bt],S,!0):u===2&&(c.rectangle=this.forceUniformSize?gt(l,S,this.centered):le(l,S,this.centered)),c.full=c.circle!=null?c.circle.geometry:c.rectangle?.geometry,c.outline=c.full?.type==="polygon"?c.full:null;break}default:return null}return c}initializeGraphic(t){return Z()}onComplete(t){if(!this.drawOperation)return;this._updateGraphic();let e=null;if(this.drawOperation.isCompleted){let o=this._getCreateOperationGeometry({operationComplete:!0});o!=null&&(e=this._createOrUpdateGraphic(o.full))}this._createOperationGeometry=null,this.emit("complete",st({graphic:e},t))}onCursorUpdate(t){this._updateGraphic(),this.emit("cursor-update",t)}onDeactivate(){let{drawOperation:t}=this;t&&(t.isCompleted||t.cancel())}onOutlineChanged(t){return Z()}onCursorEdgeChanged(t){return Z()}onVertexAdd(t){_t(this._tooltipsContext),this._updateGraphic(),this.elevationLockOnVertexAddDisabled||ke(t.vertices.at(0)?.coordinates,this._tooltipsContext),this.emit("vertex-add",t)}onVertexRemove(t){_t(this._tooltipsContext),this._updateGraphic(),this.emit("vertex-remove",t)}onVertexUpdate(t){this._updateGraphic(),this.emit("vertex-update",t)}_updateGraphic(){let t=this._getCreateOperationGeometry();this._createOperationGeometry=t,t!=null?(t.cursorEdge!=null?this.addHandles(this.onCursorEdgeChanged(t.cursorEdge),w.activeEdge):this.removeHandles(w.activeEdge),t.outline!=null?this.addHandles(this.onOutlineChanged(t.outline),w.outline):this.removeHandles(w.outline),t.committedVertices!=null?this.addHandles(this.onRegularVerticesChanged(t.committedVertices),w.regularVertices):this.removeHandles(w.regularVertices),t.cursorVertex!=null?this.addHandles(this.onActiveVertexChanged(t.cursorVertex),w.activeVertex):this.removeHandles(w.activeVertex),t.full!=null?this._createOrUpdateGraphic(t.full):this.removeHandles(Tt)):this._destroyAllVisualizations()}get activeTooltipInfo(){return this._coordinateFormatterLoadTask?.finished?it(this._tooltipsContext):null}};i([s()],p.prototype,"_coordinateFormatterLoadTask",void 0),i([s()],p.prototype,"_createOperationGeometry",void 0),i([s()],p.prototype,"_tooltipsContext",null),i([s({value:!0})],p.prototype,"centered",null),i([s()],p.prototype,"cursor",null),i([s({nonNullable:!0})],p.prototype,"defaultZ",void 0),i([s({constructOnly:!0})],p.prototype,"directionOptions",void 0),i([s()],p.prototype,"drawOperation",void 0),i([s()],p.prototype,"elevationLockOnVertexAddDisabled",void 0),i([s({value:!0})],p.prototype,"enabled",null),i([s({value:!0})],p.prototype,"forceUniformSize",null),i([s({constructOnly:!0})],p.prototype,"geometryType",void 0),i([s()],p.prototype,"graphic",null),i([s({constructOnly:!0})],p.prototype,"graphicProperties",void 0),i([s()],p.prototype,"graphicSymbol",null),i([s({constructOnly:!0})],p.prototype,"hasZ",void 0),i([s({constructOnly:!0})],p.prototype,"geometryToPlace",void 0),i([s()],p.prototype,"mode",null),i([s()],p.prototype,"snappingManager",void 0),i([s()],p.prototype,"snapToScene",void 0),i([s()],p.prototype,"tooltip",void 0),i([s()],p.prototype,"tooltipInfos",void 0),i([s({constructOnly:!0,type:Ot})],p.prototype,"sketchOptions",void 0),i([s()],p.prototype,"updating",null),i([s({constructOnly:!0,nonNullable:!0})],p.prototype,"view",void 0),i([s({constructOnly:!0})],p.prototype,"undoRedo",null),i([s()],p.prototype,"activeTooltipInfo",null),p=i([m("esri.views.draw.DrawGraphicTool")],p);var Tt=Symbol("create-operation-graphic"),w={outline:Symbol("outline-visual"),regularVertices:Symbol("regular-vertices-visual"),activeVertex:Symbol("active-vertex-visual"),activeEdge:Symbol("active-edge-visual")};function Er(t){switch(t){case"point":case"polyline":case"polygon":case"multipoint":return t;case"circle":case"rectangle":return"segment";case"mesh":return"point"}}var Ne=48;function jr(t,e){return Ce(t,e,!1)}function qr(t,e){return Ce(t,e,!0)}function Ce(t,e,o){if(t instanceof Kt){if(t.operation instanceof Qt)return Ze(t.operation,e,o),!0;if(t.operation instanceof $t)return Ye(t.operation,e,o),!0;if(t.operation instanceof te)return je(t.operation,e,o),!0}return!1}function Ze(t,e,o=!1){let r=o?-1:1,n=Mt(r*t.dx,r*t.dy,r*t.dz);J(e.origin,e.origin,n),Y(e)}function Ye(t,e,o=!1){let r=o?-t.angle:t.angle;yt(e.basis1,e.basis1,ct,r),yt(e.basis2,e.basis2,ct,r),Y(e)}function je(t,e,o=!1){let r=o?1/t.factor1:t.factor1,n=o?1/t.factor2:t.factor2;mt(e.basis1,e.basis1,r),mt(e.basis2,e.basis2,n),ut(e.origin,e.origin,t.origin,t.axis1,r),ut(e.origin,e.origin,t.origin,t.axis2,n),Y(e)}function Wr(t,e,o,r,n=!1){r||(r=Nt());let d=G(F.get(),t[1],-t[0]),a=G(F.get(),Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),h=G(F.get(),Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY),l=F.get(),u=e.allVertices;u.forEach(({pos:c})=>{G(l,ht(t,c),ht(d,c)),Gt(a,a,l),Ft(h,h,l)});let v=1e-6,_=G(F.get(),h[0]-a[0]<v?o/2:0,h[1]-a[1]<v?o/2:0);At(a,a,_),Pt(h,h,_);let C=n?u.reduce((c,N)=>c+(N.pos[2]??0),0)/u.length:0;return dt(r.basis1,t,(h[0]-a[0])/2),dt(r.basis2,d,(h[1]-a[1])/2),Dt(r.origin,a[0]*t[0]+a[1]*d[0],a[0]*t[1]+a[1]*d[1],C),J(r.origin,r.origin,r.basis1),J(r.origin,r.origin,r.basis2),Y(r),r}export{p as a,Er as b,jr as c,qr as d,Wr as e};
