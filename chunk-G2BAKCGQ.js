import{b as Ae}from"./chunk-PVFH4TIQ.js";import{c as x}from"./chunk-WQKVID54.js";import{a as d,b as de,c as fe}from"./chunk-DBCWR6HP.js";import{a as c}from"./chunk-FSW536RM.js";import{b as ie,c as ae,g as se,h as ne}from"./chunk-N7DSOI7B.js";import{a as oe,b,c as W,d as le,g as ce,h as B,i as pe,j as he}from"./chunk-F4HA2HQL.js";import{a as ee,b as te}from"./chunk-T5UBLAP4.js";import{g as w,l as C,m as O}from"./chunk-DA3NC6W4.js";import{e as Te}from"./chunk-FGABE2LC.js";import{h as ue}from"./chunk-6FZTFPIH.js";import{i as re,j as _}from"./chunk-J5AEP4US.js";import{a as me}from"./chunk-VGAXEXH3.js";import{a as f,g as I,h as A,k,o as $}from"./chunk-YEXMIDOT.js";import{b as K}from"./chunk-E2QKN2KY.js";import{a as r}from"./chunk-RWCIDBNQ.js";import{x as X}from"./chunk-HM5RIVQC.js";import{E as J,c as N,y as U}from"./chunk-6B5XFA6F.js";import{a as D}from"./chunk-BOVYXYHK.js";var L=class extends te{constructor(t,e){super(t,e,new ee(Ae,()=>import("./chunk-TDFIWHUF.js")),y)}_makePipelineState(t,e){let{output:n,oitPass:P,space:M,hasOccludees:S}=t;return O({blending:A(n)?ie(P):null,depthTest:M===d.Draped?null:{func:se(P)},depthWrite:ae(t),drawBuffers:n===f.Depth?{buffers:[X.NONE]}:ne(P,n),colorWrite:C,stencilWrite:S?W:null,stencilTest:S?e?B:ce:null,polygonOffset:{factor:0,units:-10}})}initializePipeline(t){return t.occluder?(this._occluderPipelineTransparent=O({blending:w,depthTest:b,depthWrite:null,colorWrite:C,stencilWrite:null,stencilTest:he}),this._occluderPipelineOpaque=O({blending:w,depthTest:b,depthWrite:null,colorWrite:C,stencilWrite:le,stencilTest:pe}),this._occluderPipelineMaskWrite=O({blending:null,depthTest:oe,depthWrite:null,colorWrite:null,stencilWrite:W,stencilTest:B})):this._occluderPipelineTransparent=this._occluderPipelineOpaque=this._occluderPipelineMaskWrite=null,this._occludeePipelineState=this._makePipelineState(t,!0),this._makePipelineState(t,!1)}getPipeline(t,e){return t?this._occludeePipelineState:e===c.TRANSPARENT_OCCLUDER_MATERIAL?this._occluderPipelineTransparent??super.getPipeline():e===c.OCCLUDER_MATERIAL?this._occluderPipelineOpaque??super.getPipeline():this._occluderPipelineMaskWrite??super.getPipeline()}},y=new Map([[r.POSITION,0],[r.PREVPOSITION,1],[r.UV0,2],[r.NORMAL,3],[r.COLOR,4],[r.COLORFEATUREATTRIBUTE,4],[r.SIZE,5],[r.SIZEFEATUREATTRIBUTE,5],[r.OPACITYFEATUREATTRIBUTE,6]]);var Oe=class extends re{constructor(t){super(t,q),this._configuration=new fe,this.vertexAttributeLocations=y,this.produces=new Map([[c.OPAQUE_MATERIAL,e=>e===f.Highlight||I(e)&&this.parameters.renderOccluded===_.OccludeAndTransparentStencil],[c.OPAQUE_MATERIAL_WITHOUT_NORMALS,e=>$(e)],[c.OCCLUDER_MATERIAL,e=>k(e)&&this.parameters.renderOccluded===_.OccludeAndTransparentStencil],[c.TRANSPARENT_OCCLUDER_MATERIAL,e=>k(e)&&this.parameters.renderOccluded===_.OccludeAndTransparentStencil],[c.TRANSPARENT_MATERIAL,e=>I(e)&&this.parameters.writeDepth],[c.TRANSPARENT_MATERIAL_WITHOUT_DEPTH,e=>I(e)&&!this.parameters.writeDepth],[c.DRAPED_MATERIAL,e=>A(e)||e===f.Highlight]]),this._layout=this.createLayout()}getConfiguration(t,e){return this._configuration.output=t,this._configuration.space=e.slot===c.DRAPED_MATERIAL?d.Draped:this.parameters.worldSpace?d.World:d.Screen,this._configuration.hideOnShortSegments=this.parameters.hideOnShortSegments,this._configuration.hasCap=this.parameters.cap!==x.BUTT,this._configuration.anchor=this.parameters.anchor,this._configuration.hasTip=this.parameters.hasTip,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasOccludees=e.hasOccludees,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.vvOpacity=!!this.parameters.vvOpacity,this._configuration.occluder=this.parameters.renderOccluded===_.OccludeAndTransparentStencil,this._configuration.oitPass=e.oitPass,this._configuration.terrainDepthTest=e.terrainDepthTest&&A(t),this._configuration.cullAboveTerrain=e.cullAboveTerrain,this._configuration}get visible(){return this.parameters.color[3]>=me}intersect(){}createLayout(){let t=K().vec3f(r.POSITION).vec3f(r.PREVPOSITION).vec2f(r.UV0);return this.parameters.worldSpace&&t.vec3f(r.NORMAL),this.parameters.vvSize?t.f32(r.SIZEFEATUREATTRIBUTE):t.f32(r.SIZE),this.parameters.vvColor?t.f32(r.COLORFEATUREATTRIBUTE):t.vec4f(r.COLOR),this.parameters.vvOpacity&&t.f32(r.OPACITYFEATUREATTRIBUTE),t}createBufferWriter(){return new G(this._layout,this.parameters)}createGLMaterial(t){return new F(t)}},F=class extends Te{constructor(){super(...arguments),this._markerPrimitive=null}dispose(){super.dispose(),this._markerTextures.release(this._markerPrimitive),this._markerPrimitive=null}beginSlot(t){let e=this._material.parameters.markerPrimitive;return e!==this._markerPrimitive&&(this._material.setParameters({markerTexture:this._markerTextures.swap(e,this._markerPrimitive)}),this._markerPrimitive=e),this._material.setParameters(this.textureBindParameters),this.getTechnique(L,t)}},q=class extends ue{constructor(){super(...arguments),this.width=0,this.color=[1,1,1,1],this.markerPrimitive="arrow",this.placement="end",this.cap=x.BUTT,this.anchor=de.Center,this.hasTip=!1,this.worldSpace=!1,this.hideOnShortSegments=!1,this.writeDepth=!0,this.hasSlicePlane=!1,this.vvFastUpdate=!1,this.markerTexture=null}},G=class{constructor(t,e){this.vertexBufferLayout=t,this._parameters=e}elementCount(){return this._parameters.placement==="begin-end"?12:6}write(t,e,n,P,M,S){let h=n.get(r.POSITION).data,V=h.length/3,g=[1,0,0],Z=n.get(r.NORMAL);this._parameters.worldSpace&&Z!=null&&(g=Z.data);let z=1,H=0;this._parameters.vvSize?H=n.get(r.SIZEFEATUREATTRIBUTE).data[0]:n.has(r.SIZE)&&(z=n.get(r.SIZE).data[0]);let u=[1,1,1,1],Y=0;this._parameters.vvColor?Y=n.get(r.COLORFEATUREATTRIBUTE).data[0]:n.has(r.COLOR)&&(u=n.get(r.COLOR).data);let Q=0;this._parameters.vvOpacity&&(Q=n.get(r.OPACITYFEATUREATTRIBUTE).data[0]);let i=new Float32Array(M.buffer),a=S*(this.vertexBufferLayout.stride/4),m=(s,T,o,l)=>{if(i[a++]=s[0],i[a++]=s[1],i[a++]=s[2],i[a++]=T[0],i[a++]=T[1],i[a++]=T[2],i[a++]=o[0],i[a++]=o[1],this._parameters.worldSpace&&(i[a++]=g[0],i[a++]=g[1],i[a++]=g[2]),this._parameters.vvSize?i[a++]=H:i[a++]=z,this._parameters.vvColor)i[a++]=Y;else{let p=Math.min(4*l,u.length-4);i[a++]=u[p],i[a++]=u[p+1],i[a++]=u[p+2],i[a++]=u[p+3]}this._parameters.vvOpacity&&(i[a++]=Q)},R;(function(s){s[s.ASCENDING=1]="ASCENDING",s[s.DESCENDING=-1]="DESCENDING"})(R||(R={}));let j=(s,T)=>{let o=N(_e,h[3*s],h[3*s+1],h[3*s+2]),l=Ee,p=s+T;do N(l,h[3*p],h[3*p+1],h[3*p+2]),p+=T;while(J(o,l)&&p>=0&&p<V);t&&(U(o,o,t),U(l,l,t)),m(o,l,[-1,-1],s),m(o,l,[1,-1],s),m(o,l,[1,1],s),m(o,l,[-1,-1],s),m(o,l,[1,1],s),m(o,l,[-1,1],s)},v=this._parameters.placement;v!=="begin"&&v!=="begin-end"||j(0,R.ASCENDING),v!=="end"&&v!=="begin-end"||j(V-1,R.DESCENDING)}},_e=D(),Ee=D();export{Oe as a};
