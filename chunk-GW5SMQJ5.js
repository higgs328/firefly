import{a as Y}from"./chunk-JLICILEC.js";import{a as P}from"./chunk-IQYLT45D.js";import{a as B}from"./chunk-4XXYLTAP.js";import{a as Pe}from"./chunk-TUUOR3MF.js";import{b as Me}from"./chunk-H4IF7PQO.js";import{a as _e}from"./chunk-GGYZRKBV.js";import{a as Oe}from"./chunk-37PSR6DC.js";import{a as Se}from"./chunk-H25DKJGS.js";import"./chunk-6DALCDDU.js";import"./chunk-CHCKIOZR.js";import"./chunk-TUF2Y2FX.js";import{d as Te,e as Ce}from"./chunk-PBAMEKFE.js";import"./chunk-XIZ7IH6M.js";import"./chunk-JD66UCS7.js";import"./chunk-FU7RO3AR.js";import"./chunk-4YRY3D3A.js";import"./chunk-ZZ5UYT7M.js";import"./chunk-U4XVPHQU.js";import{a as K}from"./chunk-GNEAU6X4.js";import"./chunk-XR5FT7TQ.js";import{a as Ae}from"./chunk-LAX5536Z.js";import"./chunk-N3HRYLNW.js";import"./chunk-4DBMALZW.js";import"./chunk-CVWWHM2V.js";import"./chunk-6OQYVEQJ.js";import"./chunk-YOXOWGT6.js";import"./chunk-EFZOSMYP.js";import"./chunk-WI7F4ZKJ.js";import"./chunk-MJ7M24NH.js";import"./chunk-GJH4QFRX.js";import"./chunk-T63F7663.js";import"./chunk-O4V2VBSK.js";import"./chunk-5TKRKB5E.js";import"./chunk-XAGMDNNR.js";import"./chunk-OP2TLIUN.js";import"./chunk-T2THIR6K.js";import"./chunk-LORHDXEB.js";import"./chunk-BBBPJI4H.js";import"./chunk-45BTW5EG.js";import"./chunk-TPFBHGDM.js";import"./chunk-73NLRHJD.js";import"./chunk-PNFEUBDF.js";import"./chunk-6RCCEJDL.js";import"./chunk-PQ2TNDUX.js";import"./chunk-6X6MKRQ3.js";import"./chunk-FQFHMHYU.js";import"./chunk-SZMEI3WL.js";import"./chunk-KKVGD67U.js";import"./chunk-MYOJWRDU.js";import"./chunk-L7UKJKHG.js";import"./chunk-V2IENAEU.js";import"./chunk-QAGQFNF2.js";import"./chunk-SY7JS2VW.js";import"./chunk-WK57SDN6.js";import"./chunk-AG4V3ZUO.js";import"./chunk-YWLMJ26A.js";import"./chunk-QAWNU3UJ.js";import"./chunk-HRQT4R6X.js";import"./chunk-44BHLWQ4.js";import"./chunk-5BPM64SU.js";import"./chunk-PMVHHMQJ.js";import"./chunk-NAFOM5UA.js";import{a as Re}from"./chunk-DO7UF2F2.js";import"./chunk-ZTR6OS44.js";import"./chunk-VRTKAD2J.js";import"./chunk-DBLKLHK2.js";import"./chunk-UTE3ASAZ.js";import"./chunk-2AFEAPEX.js";import"./chunk-GNGXUEWV.js";import"./chunk-QBI5NDCA.js";import"./chunk-NOHW2DKR.js";import"./chunk-HVJAAM3A.js";import"./chunk-ACPEJEHK.js";import"./chunk-I7B3LWNP.js";import"./chunk-YP2E5N4E.js";import"./chunk-QLMNLSCT.js";import"./chunk-P55G5ATK.js";import"./chunk-JT3K52KQ.js";import"./chunk-SPLEGG4R.js";import"./chunk-Y4TJDUGP.js";import"./chunk-6PAFOJ4W.js";import"./chunk-74SDGE57.js";import"./chunk-FRXWHX3T.js";import"./chunk-DTDQ5X42.js";import"./chunk-RX2HFR4X.js";import"./chunk-AZW7YPTQ.js";import"./chunk-NJLJX4X6.js";import"./chunk-DZHFTD24.js";import"./chunk-K57Z4J34.js";import"./chunk-VWG3KVOU.js";import"./chunk-JOEUVLAN.js";import"./chunk-JZQDGIDQ.js";import"./chunk-CZ6CGC7I.js";import"./chunk-7B6U3N62.js";import"./chunk-46WDO5LS.js";import"./chunk-G5EYK5KM.js";import"./chunk-YJKJQU3F.js";import"./chunk-OK4K3OQT.js";import"./chunk-BPWNCOXC.js";import"./chunk-VNS4CQ27.js";import"./chunk-AVMO6LCR.js";import"./chunk-TEGPMVWT.js";import"./chunk-CLQRQC3Y.js";import"./chunk-KSNU73LO.js";import"./chunk-FACEVGRE.js";import"./chunk-5XTCPT52.js";import"./chunk-TC77DYTW.js";import"./chunk-F2BQ2GD6.js";import"./chunk-R3XLNYYB.js";import"./chunk-BMYVPMAK.js";import"./chunk-6F25LG6O.js";import"./chunk-GJ2QRXGN.js";import"./chunk-3JGYBNJA.js";import"./chunk-DA3SDKGO.js";import"./chunk-ZOEPYNM4.js";import"./chunk-57VFBGF3.js";import"./chunk-GWBRHLNH.js";import"./chunk-BJH4F4SM.js";import"./chunk-Z3RBZHAK.js";import"./chunk-ZC6EBRE4.js";import"./chunk-KALOJIUA.js";import"./chunk-KMMTNF7G.js";import"./chunk-MIS6QMFE.js";import"./chunk-MDZTV2VL.js";import"./chunk-RNC4P66O.js";import"./chunk-7LHOQXZT.js";import"./chunk-BCREO4Q5.js";import"./chunk-U4QEPZJ3.js";import"./chunk-KJUZWSCL.js";import"./chunk-3WO6D7MU.js";import"./chunk-BUZ3SPLE.js";import{a as Le}from"./chunk-MFCSEXHS.js";import{b as Ne}from"./chunk-2TX472ZB.js";import{c as Fe}from"./chunk-7QNKS2X6.js";import{a as Ee}from"./chunk-VCCMJ6BV.js";import{a as Ue}from"./chunk-QK56OQGR.js";import"./chunk-FXCL7YYQ.js";import"./chunk-QKO56XO6.js";import"./chunk-JRGT3GTH.js";import"./chunk-K75TK42V.js";import"./chunk-CELWVZPW.js";import"./chunk-VV5G7VY5.js";import"./chunk-OLOKUDVI.js";import"./chunk-DYTVXYAV.js";import"./chunk-ZTOZWLEE.js";import"./chunk-RJWOVI3M.js";import"./chunk-RSDQHAJX.js";import"./chunk-BOVYXYHK.js";import"./chunk-KVM6SHDX.js";import"./chunk-HX2VGIR2.js";import"./chunk-ERDKAICI.js";import"./chunk-EQZWYK27.js";import"./chunk-JLPLCY2B.js";import"./chunk-2GJBUR2F.js";import"./chunk-DKGGDYJI.js";import"./chunk-5LA3PVK5.js";import"./chunk-IR6XCBC4.js";import"./chunk-C6JPAW54.js";import"./chunk-WD3OPXCN.js";import"./chunk-FA3WGIU4.js";import"./chunk-WWVPA6PE.js";import"./chunk-YPMM52MU.js";import"./chunk-BBR7CJCO.js";import{m as R}from"./chunk-ZQIC5NFT.js";import"./chunk-VIEK2X23.js";import"./chunk-XKIFGPJO.js";import{a as L}from"./chunk-PEW2PLAN.js";import"./chunk-Q6Y4JG7Q.js";import{a as S}from"./chunk-7F5DJLJT.js";import{a as k}from"./chunk-CX5IFQZJ.js";import{d as Ie}from"./chunk-NJWTSROP.js";import"./chunk-D3R25AF2.js";import"./chunk-ARRCN5K3.js";import"./chunk-4N4D2YQX.js";import"./chunk-G4DZJMGT.js";import"./chunk-K5T5FD5C.js";import"./chunk-MVHHPJM7.js";import{c as xe,e as we}from"./chunk-VDO6JJ3Y.js";import"./chunk-WFKZLI6F.js";import"./chunk-X2B63YVS.js";import{a as be}from"./chunk-BAEF3CT6.js";import{j as ge,o as D}from"./chunk-AUAZP44J.js";import"./chunk-PVDFCTA4.js";import"./chunk-KNVXE32P.js";import{$ as z,f as ye,k as q,o as he}from"./chunk-76ATOSLU.js";import{d as de}from"./chunk-CCJU4DSH.js";import{a as ve,c as Z,i as V}from"./chunk-TG45K3WR.js";import"./chunk-RAI4DTMT.js";import{b as Q}from"./chunk-ACP3S2CH.js";import"./chunk-HVAXZ2NA.js";import"./chunk-T7DXJKX7.js";import"./chunk-TYYVNQUR.js";import{a as m}from"./chunk-QGVBCWUY.js";import"./chunk-MYO4NP2N.js";import{e as c}from"./chunk-NFIPKH6V.js";import"./chunk-JPU2PQZC.js";import{l as fe}from"./chunk-5QEXLALV.js";import{r as ce}from"./chunk-P6QFA5MM.js";import"./chunk-DGTD7Y73.js";import"./chunk-LI2SX4T6.js";import"./chunk-BWO7LS2H.js";import"./chunk-HEVQSRJ2.js";import"./chunk-OVHPPCBL.js";import"./chunk-SNFOAZZQ.js";import"./chunk-AML4XSEF.js";import{s as pe}from"./chunk-4PTIEWMT.js";import"./chunk-TG2UTNEO.js";import{b as W}from"./chunk-YOFFGXOB.js";import"./chunk-XRGPJ3QY.js";import{e as me}from"./chunk-6MRUJ2UW.js";import{b as ue}from"./chunk-2LI2GKBQ.js";import{y as E}from"./chunk-QBWJMFH5.js";import{a as x,b as J,f as j}from"./chunk-VTHXE323.js";var je={84:4326,83:4269,27:4267};function Ge(e){if(!e)return null;let t={idCounter:-1};typeof e=="string"&&(e=new DOMParser().parseFromString(e,"text/xml"));let r=e.documentElement;if(r.nodeName==="ServiceExceptionReport"){let w=Array.prototype.slice.call(r.childNodes).map(M=>M.textContent).join(`\r
`);throw new W("wmslayer:wms-capabilities-xml-is-not-valid","The server returned errors when the WMS capabilities were requested.",w)}let n=b("Capability",r),i=b("Service",r),s=n&&b("Request",n);if(!n||!i||!s)return null;let a=b("Layer",n);if(!a)return null;let o=r.nodeName==="WMS_Capabilities"||r.nodeName==="WMT_MS_Capabilities"?r.getAttribute("version"):"1.3.0",p=I("Title",i,"")||I("Name",i,""),h=I("AccessConstraints",i,""),l=/^none$/i.test(h)?"":h,d=I("Abstract",i,""),y=parseInt(I("MaxWidth",i,"5000"),10),f=parseInt(I("MaxHeight",i,"5000"),10),v=qe(s,"GetMap"),F=We(s,"GetMap"),g=C(a,o,t);if(!g)return null;let N,O=0,tt=Array.prototype.slice.call(n.childNodes),rt=g.sublayers??[],X=w=>{w!=null&&rt.push(w)};tt.forEach(w=>{w.nodeName==="Layer"&&(O===0?N=w:(O===1&&g.name&&(g.name="",X(C(N,o,t))),X(C(w,o,t))),O++)});let _=g.sublayers??[],nt=g.fullExtents??[];_.length===0&&_.push(g),g.extent??=_[0].extent;let it=g.spatialReferences.length>0?g.spatialReferences:He(g),ie=We(s,"GetFeatureInfo"),st=ie?qe(s,"GetFeatureInfo"):null,se=Je(_),at=g.minScale||0,ot=g.maxScale||0,ae=g.dimensions??[],lt=se.reduce((w,M)=>w.concat(M.dimensions??[]),[]),oe=ae.concat(lt).filter(Qe),le=null;if(oe.length){let w=oe.map(M=>{let{extent:H}=M;return mt(H)?H.map(U=>U.getTime()):H?.map(U=>[U.min.getTime(),U.max.getTime()])}).flat(2).filter(E);le={startTimeField:null,endTimeField:null,trackIdField:void 0,timeExtent:[Math.min(...w),Math.max(...w)]}}return{copyright:l,description:d,dimensions:ae,extent:g.extent,fullExtents:nt,featureInfoFormats:st,featureInfoUrl:ie,mapUrl:F,maxWidth:y,maxHeight:f,maxScale:ot,minScale:at,layers:se,spatialReferences:it,supportedImageFormatTypes:v,timeInfo:le,title:p,version:o}}function Xe(e){let t=e.filter(r=>r.popupEnabled&&r.name&&r.queryable);return t.length?t.map(({name:r})=>r).join():null}function He(e){if(e.spatialReferences.length>0)return e.spatialReferences;if(e.sublayers)for(let t of e.sublayers){let r=He(t);if(r.length>0)return r}return[]}function Je(e){let t=[];for(let r of e)t.push(r),r.sublayers?.length&&(t=t.concat(Je(r.sublayers)),delete r.sublayers);return t}function $(e,t,r){return t.getAttribute(e)??r}function ut(e,t,r,n){let i=b(e,r);return i?$(t,i,n):n}function b(e,t){for(let r=0;r<t.childNodes.length;r++){let n=t.childNodes[r];if(ze(n)&&n.nodeName===e)return n}return null}function G(e,t){if(t==null)return[];let r=[];for(let n=0;n<t.childNodes.length;n++){let i=t.childNodes[n];ze(i)&&i.nodeName===e&&r.push(i)}return r}function I(e,t,r){return b(e,t)?.textContent??r}function T(e,t,r){if(!e)return null;let n=parseFloat(e.getAttribute("minx")),i=parseFloat(e.getAttribute("miny")),s=parseFloat(e.getAttribute("maxx")),a=parseFloat(e.getAttribute("maxy")),o,p,h,l;return r?(o=isNaN(i)?-Number.MAX_VALUE:i,p=isNaN(n)?-Number.MAX_VALUE:n,h=isNaN(a)?Number.MAX_VALUE:a,l=isNaN(s)?Number.MAX_VALUE:s):(o=isNaN(n)?-Number.MAX_VALUE:n,p=isNaN(i)?-Number.MAX_VALUE:i,h=isNaN(s)?Number.MAX_VALUE:s,l=isNaN(a)?Number.MAX_VALUE:a),{xmin:o,ymin:p,xmax:h,ymax:l,spatialReference:{wkid:t}}}function We(e,t){let r=b(t,e);if(r){let n=b("DCPType",r);if(n){let i=b("HTTP",n);if(i){let s=b("Get",i);if(s){let a=ut("OnlineResource","xlink:href",s,null);if(a){let o=a.indexOf("&");return o!==-1&&o===a.length-1&&(a=a.slice(0,-1)),ct(a,["service","request"])}}}}}return null}function qe(e,t){let r=G("Operation",e);if(!r.length)return G("Format",b(t,e)).map(({textContent:i})=>i).filter(E);let n=[];for(let i of r)if(i.getAttribute("name")===t){let s=G("Format",i);for(let{textContent:a}of s)a!=null&&n.push(a)}return n}function De(e,t,r){let n=b(t,e);if(!n)return r;let{textContent:i}=n;if(i==null||i==="")return r;let s=Number(i);return isNaN(s)?r:s}function C(e,t,r){if(!e)return null;let n=e.getAttribute("queryable")?.toLowerCase(),i=n==="1"||n==="true",s={id:r.idCounter++,fullExtents:[],parentLayerId:null,queryable:i,spatialReferences:[],sublayers:null},a=b("LatLonBoundingBox",e),o=b("EX_GeographicBoundingBox",e),p=null;a&&(p=T(a,4326)),o&&(p=new R(0,0,0,0,new S({wkid:4326})),p.xmin=parseFloat(I("westBoundLongitude",o,"0")),p.ymin=parseFloat(I("southBoundLatitude",o,"0")),p.xmax=parseFloat(I("eastBoundLongitude",o,"0")),p.ymax=parseFloat(I("northBoundLatitude",o,"0"))),a||o||(p=new R(-180,-90,180,90,new S({wkid:4326}))),s.minScale=De(e,"MaxScaleDenominator",0),s.maxScale=De(e,"MinScaleDenominator",0);let h=["1.0.0","1.1.0","1.1.1"].includes(t)?"SRS":"CRS";return Array.prototype.slice.call(e.childNodes).forEach(l=>{if(l.nodeName==="Name")s.name=l.textContent||"";else if(l.nodeName==="Title")s.title=l.textContent||"";else if(l.nodeName==="Abstract")s.description=l.textContent||"";else if(l.nodeName==="BoundingBox"){let d=l.getAttribute(h);if(d&&d.indexOf("EPSG:")===0){let f=parseInt(d.slice(5),10);f===0||isNaN(f)||p||(p=t==="1.3.0"?T(l,f,P(f)):T(l,f))}let y=d?.indexOf(":");if(y&&y>-1){let f=parseInt(d.slice(y+1),10);f===0||isNaN(f)||(f=je[f]??f);let v=t==="1.3.0"?T(l,f,P(f)):T(l,f);v&&s.fullExtents&&s.fullExtents.push(v)}}else if(l.nodeName===h)(l.textContent?.split(" ")??[]).forEach(d=>{let y=NaN;if(d.includes(":")){let[f,v]=d.toUpperCase().split(":");f!=="CRS"&&f!=="EPSG"||(y=parseInt(v,10))}else y=parseInt(d,10);if(y!==0&&!isNaN(y)){let f=je[y]??y;s.spatialReferences.includes(f)||s.spatialReferences.push(f)}});else if(l.nodeName!=="Style"||s.legendUrl){if(l.nodeName==="Layer"){let d=C(l,t,r);d&&(d.parentLayerId=s.id,s.sublayers||(s.sublayers=[]),s.sublayers.push(d))}}else{let d=b("LegendURL",l);if(d){let y=b("OnlineResource",d);y&&(s.legendUrl=y.getAttribute("xlink:href"))}}}),s.extent=p,s.dimensions=G("Dimension",e).filter(l=>l.getAttribute("name")&&l.getAttribute("units")&&l.textContent).map(l=>{let d=l.getAttribute("name"),y=l.getAttribute("units"),f=l.textContent,v=l.getAttribute("unitSymbol")??void 0,F=l.getAttribute("default")??void 0,g=$("default",l,"0")!=="0",N=$("nearestValue",l,"0")!=="0",O=$("current",l,"0")!=="0";return Qe({name:d,units:y})?{name:"time",units:"ISO8601",extent:Be(f),default:Be(F),multipleValues:g,nearestValue:N,current:O}:pt({name:d,units:y})?{name:"elevation",units:y,extent:Ve(f),unitSymbol:v,default:Ve(F),multipleValues:g,nearestValue:N}:{name:d,units:y,extent:ke(f),unitSymbol:v,default:ke(F),multipleValues:g,nearestValue:N}}),s}function mt(e){return Array.isArray(e)&&e.length>0&&e[0]instanceof Date}function ze(e){return e.nodeType===Node.ELEMENT_NODE}function pt(e){return/^elevation$/i.test(e.name)&&/^(epsg|crs):\d+$/i.test(e.units)}function Qe(e){return/^time$/i.test(e.name)&&/^iso8601$/i.test(e.units)}function ct(e,t){let r=[],n=q(e);for(let i in n.query)n.query.hasOwnProperty(i)&&(t.includes(i.toLowerCase())||r.push(i+"="+n.query[i]));return n.path+(r.length?"?"+r.join("&"):"")}function Ve(e){if(!e)return;let t=e.includes("/"),r=e.split(",");return t?r.map(n=>{let i=n.split("/");return i.length<2?null:{min:parseFloat(i[0]),max:parseFloat(i[1]),resolution:i.length>=3&&i[2]!=="0"?parseFloat(i[2]):void 0}}).filter(E):r.map(n=>parseFloat(n))}function ke(e){if(!e)return;let t=e.includes("/"),r=e.split(",");return t?r.map(n=>{let i=n.split("/");return i.length<2?null:{min:i[0],max:i[1],resolution:i.length>=3&&i[2]!=="0"?i[2]:void 0}}).filter(E):r}function Be(e){if(!e)return;let t=e.includes("/"),r=e.split(",");return t?r.map(n=>{let i=n.split("/");return i.length<2?null:{min:ee(i[0]),max:ee(i[1]),resolution:i.length>=3&&i[2]!=="0"?ft(i[2]):void 0}}).filter(E):r.map(n=>ee(n))}function ee(e){return we.fromISO(e,{zone:xe.utcInstance}).toJSDate()}function ft(e){let t=/(?:p(\d+y|\d+(?:\.|,)\d+y)?(\d+m|\d+(?:\.|,)\d+m)?(\d+d|\d+(?:\.|,)\d+d)?)?(?:t(\d+h|\d+(?:\.|,)\d+h)?(\d+m|\d+(?:\.|,)\d+m)?(\d+s|\d+(?:\.|,)\d+s)?)?/i,r=e.match(t);return r?{years:A(r[1]),months:A(r[2]),days:A(r[3]),hours:A(r[4]),minutes:A(r[5]),seconds:A(r[6])}:null}function A(e){if(!e)return 0;let t=/(?:\d+(?:\.|,)\d+|\d+)/,r=e.match(t);if(!r)return 0;let n=r[0].replace(",",".");return Number(n)}function te(e){return e.toISOString().replace(/\.[0-9]{3}/,"")}var dt="0000-01-01T00:00:00Z",yt="9999-12-31T23:59:59Z";function re(e){if(!e||e.isAllTime||e.isEmpty)return;let{start:t,end:r}=e;return t&&r&&t.getTime()===r.getTime()?`${te(t)}`:`${t?te(t):dt}/${r?te(r):yt}`}var $e=new Set([102100,3857,102113,900913]),ht=new Set([3395,54004]);function Ze(e,t){let r=e.wkid;return t==null?r:(r!=null&&t.includes(r)||!e.latestWkid||(r=e.latestWkid),r!=null&&$e.has(r)?t.find(n=>$e.has(n))||t.find(n=>ht.has(n))||102100:r)}var ne=new be({bmp:"image/bmp",gif:"image/gif",jpg:"image/jpeg",png:"image/png",svg:"image/svg+xml"},{ignoreUnknown:!1});function Ke(e){return e==="text/html"}function Ye(e){return e==="text/plain"}var u=class extends Fe(Me(Ne(Ee(_e(Oe(Se(Ue))))))){constructor(...e){super(...e),this.allSublayers=new Pe({getCollections:()=>[this.sublayers],getChildrenFunction:t=>t.sublayers}),this.customParameters=null,this.customLayerParameters=null,this.copyright=null,this.description=null,this.dimensions=null,this.fullExtent=null,this.fullExtents=null,this.featureInfoFormats=null,this.featureInfoUrl=null,this.fetchFeatureInfoFunction=null,this.imageFormat=null,this.imageMaxHeight=2048,this.imageMaxWidth=2048,this.imageTransparency=!0,this.legendEnabled=!0,this.mapUrl=null,this.isReference=null,this.operationalLayerType="WMS",this.spatialReference=null,this.spatialReferences=null,this.sublayers=null,this.type="wms",this.version=null,this.addHandles([Z(()=>this.sublayers,"after-add",({item:t})=>{t.parent=t.layer=this},V),Z(()=>this.sublayers,"after-remove",({item:t})=>{t.layer=t.parent=null},V),ve(()=>this.sublayers,(t,r)=>{if(r)for(let n of r)n.layer=n.parent=null;if(t)for(let n of t)n.parent=n.layer=this},V)])}normalizeCtorArgs(e,t){return typeof e=="string"?x({url:e},t):e}destroy(){this.allSublayers.destroy()}load(e){let t=e!=null?e.signal:null;return this.addResolvingPromise(this.loadFromPortal({supportedTypes:["WMS"]},e).catch(pe).then(()=>this._fetchService(t)).then(()=>this._checkLayerValidity())),Promise.resolve(this)}readFullExtentFromItemOrMap(e,t){let r=t.extent;return r?new R({xmin:r[0][0],ymin:r[0][1],xmax:r[1][0],ymax:r[1][1]}):null}writeFullExtent(e,t){t.extent=[[e.xmin,e.ymin],[e.xmax,e.ymax]]}get featureInfoFormat(){return this.featureInfoFormats==null?null:this.featureInfoFormats.find(Ke)??this.featureInfoFormats.find(Ye)??null}set featureInfoFormat(e){e==null?(this.revert("featureInfoFormat","service"),this._clearOverride("featureInfoFormat")):(Ke(e)||Ye(e))&&this._override("featureInfoFormat",e)}readImageFormat(e,t){let r=t.supportedImageFormatTypes;return r&&r.includes("image/png")?"image/png":r&&r[0]}readSpatialReferenceFromItemOrDocument(e,t){return new S(t.spatialReferences[0])}writeSpatialReferences(e,t){let r=this.spatialReference?.wkid;e&&r?(t.spatialReferences=e.filter(n=>n!==r),t.spatialReferences.unshift(r)):t.spatialReferences=e}readSublayersFromItemOrMap(e,t,r){return et(t.layers,r,t.visibleLayers)}readSublayers(e,t,r){return et(t.layers,r)}writeSublayers(e,t,r,n){t.layers=[];let i=new Map,s=e.flatten(({sublayers:a})=>a??[]);for(let a of s)if(typeof a.parent?.id=="number"){let o=i.get(a.parent.id);o!=null?o.push(a.id):i.set(a.parent.id,[a.id])}for(let a of s){let o=x({sublayer:a},n),p=a.write({parentLayerId:typeof a.parent?.id=="number"?a.parent.id:-1},o);if(i.has(a.id)&&(p.sublayerIds=i.get(a.id)),!a.sublayers&&a.name){let h=a.write({},o);delete h.id,t.layers.push(h)}}t.visibleLayers=s.filter(({visible:a,sublayers:o})=>a&&!o).map(({name:a})=>a).toArray()}set url(e){if(!e)return void this._set("url",e);let{path:t,query:r}=q(e);for(let i in r)/^(request|service)$/i.test(i)&&delete r[i];let n=z(t,r??{});this._set("url",n)}createExportImageParameters(e,t,r,n){let i=n?.pixelRatio??1,s=K({extent:e,width:t})*i,a=new Y({layer:this,scale:s}),{xmin:o,ymin:p,xmax:h,ymax:l,spatialReference:d}=e,y=Ze(d,this.spatialReferences),f=this.version==="1.3.0"&&P(y)?`${p},${o},${l},${h}`:`${o},${p},${h},${l}`,v=a.toJSON(),F=this.version==="1.3.0"?"crs":"srs";return x({bbox:f,[F]:y==null||isNaN(y)?void 0:"EPSG:"+y},v)}fetchImage(e,t,r,n){return j(this,null,function*(){let i=this.mapUrl,s=this.createExportImageParameters(e,t,r,n);if(!s.layers){let p=document.createElement("canvas");return p.width=t,p.height=r,p}let a=re(n?.timeExtent),o={responseType:"image",query:this._mixCustomParameters(x(J(x({width:t,height:r},s),{time:a}),this.refreshParameters)),signal:n?.signal};return D(i??"",o).then(p=>p.data)})}fetchImageBitmap(e,t,r,n){return j(this,null,function*(){let i=this.mapUrl??"",s=this.createExportImageParameters(e,t,r,n);if(!s.layers){let h=document.createElement("canvas");return h.width=t,h.height=r,h}let a=re(n?.timeExtent),o={responseType:"blob",query:this._mixCustomParameters(x(J(x({width:t,height:r},s),{time:a}),this.refreshParameters)),signal:n?.signal},{data:p}=yield D(i,o);return Le(p,i,n?.signal)})}fetchFeatureInfo(e,t,r,n,i){let s=K({extent:e,width:t}),a=new Y({layer:this,scale:s}),o=Xe(a.visibleSublayers);if(this.featureInfoUrl==null||o==null)return Promise.resolve([]);if(this.fetchFeatureInfoFunction==null&&this.featureInfoFormat==null)return Promise.resolve([]);let p=this.version==="1.3.0"?{I:n,J:i}:{x:n,y:i},h=x({query_layers:o,request:"GetFeatureInfo",info_format:this.featureInfoFormat,feature_count:25,width:t,height:r},p),l=x(x({},this.createExportImageParameters(e,t,r)),h),d=this._mixCustomParameters(l);return this.fetchFeatureInfoFunction!=null?this.fetchFeatureInfoFunction(d):this._defaultFetchFeatureInfoFunction(z(this.featureInfoUrl,d))}findSublayerById(e){return this.allSublayers.find(t=>t.id===e)}findSublayerByName(e){return this.allSublayers.find(t=>t.name===e)}serviceSupportsSpatialReference(e){return ge(this.url)||this.spatialReferences!=null&&this.spatialReferences.some(t=>{let r=t===900913?S.WebMercator:new S({wkid:t});return Ie(r,e)})}_defaultFetchFeatureInfoFunction(e){let t=document.createElement("iframe");t.src=he(e),t.style.border="none",t.style.margin="0",t.style.width="100%",t.setAttribute("sandbox","");let r=new Re({title:this.title,content:t}),n=new Ae({sourceLayer:this,popupTemplate:r});return Promise.resolve([n])}_fetchService(e){return j(this,null,function*(){if(!this.resourceInfo&&this.parsedUrl?.path){let{path:t,query:r}=this.parsedUrl,{data:n}=yield D(t,{query:x(x({SERVICE:"WMS",REQUEST:"GetCapabilities"},r),this.customParameters),responseType:"xml",signal:e});this.resourceInfo=Ge(n)}if(this.parsedUrl){let t=new ye(this.parsedUrl.path),{httpsDomains:r}=me.request;t.scheme!=="https"||t.port&&t.port!=="443"||!t.host||r.includes(t.host)||r.push(t.host)}this.read(this.resourceInfo,{origin:"service"})})}_checkLayerValidity(){if(!this.allSublayers.length)throw new W("wmslayer:empty-layer","The layer doesn't have any sublayer")}_mixCustomParameters(e){if(!this.customLayerParameters&&!this.customParameters)return e;let t=x(x({},this.customParameters),this.customLayerParameters);for(let r in t)e[r.toLowerCase()]=t[r];return e}};function gt(e,t){return e.some(r=>{for(let n in r)if(de(r,n,null,t))return!0;return!1})}function et(e,t,r){e=e??[];let n=new Map;e.every(s=>s.id==null)&&(e=ue(e)).forEach((s,a)=>s.id=a);for(let s of e){let a=new B;a.read(s,t),r&&!r.includes(a.name)&&(a.visible=!1),n.set(a.id,a)}let i=[];for(let s of e){let a=s.id!=null?n.get(s.id):null;if(a)if(s.parentLayerId!=null&&s.parentLayerId>=0){let o=n.get(s.parentLayerId);if(!o)continue;o.sublayers||(o.sublayers=new Q),o.sublayers.push(a)}else i.push(a)}return i}m([c({readOnly:!0})],u.prototype,"allSublayers",void 0),m([c({json:{type:Object,write:!0}})],u.prototype,"customParameters",void 0),m([c({json:{type:Object,write:!0}})],u.prototype,"customLayerParameters",void 0),m([c({type:String,json:{write:!0}})],u.prototype,"copyright",void 0),m([c()],u.prototype,"description",void 0),m([c({readOnly:!0})],u.prototype,"dimensions",void 0),m([c({json:{type:[[Number]],read:{source:"extent"},write:{target:"extent"},origins:{"web-document":{write:{ignoreOrigin:!0}},"portal-item":{write:{ignoreOrigin:!0}}}}})],u.prototype,"fullExtent",void 0),m([L(["web-document","portal-item"],"fullExtent",["extent"])],u.prototype,"readFullExtentFromItemOrMap",null),m([k(["web-document","portal-item"],"fullExtent",{extent:{type:[[Number]]}})],u.prototype,"writeFullExtent",null),m([c({type:[R]})],u.prototype,"fullExtents",void 0),m([c({type:String,json:{write:{ignoreOrigin:!0}}})],u.prototype,"featureInfoFormat",null),m([c({type:[String],readOnly:!0})],u.prototype,"featureInfoFormats",void 0),m([c({type:String,json:{write:{ignoreOrigin:!0}}})],u.prototype,"featureInfoUrl",void 0),m([c()],u.prototype,"fetchFeatureInfoFunction",void 0),m([c({type:String,json:{origins:{"web-document":{default:"image/png",type:ne.jsonValues,read:{reader:ne.read,source:"format"},write:{writer:ne.write,target:"format"}}}}})],u.prototype,"imageFormat",void 0),m([L("imageFormat",["supportedImageFormatTypes"])],u.prototype,"readImageFormat",null),m([c({type:Number,json:{read:{source:"maxHeight"},write:{target:"maxHeight"}}})],u.prototype,"imageMaxHeight",void 0),m([c({type:Number,json:{read:{source:"maxWidth"},write:{target:"maxWidth"}}})],u.prototype,"imageMaxWidth",void 0),m([c()],u.prototype,"imageTransparency",void 0),m([c(Ce)],u.prototype,"legendEnabled",void 0),m([c({type:["show","hide","hide-children"]})],u.prototype,"listMode",void 0),m([c({type:String,json:{write:{ignoreOrigin:!0}}})],u.prototype,"mapUrl",void 0),m([c({type:Boolean,json:{read:!1,write:{enabled:!0,overridePolicy:()=>({enabled:!1})}}})],u.prototype,"isReference",void 0),m([c({type:["WMS"]})],u.prototype,"operationalLayerType",void 0),m([c()],u.prototype,"resourceInfo",void 0),m([c({type:S,json:{origins:{service:{read:{source:"extent.spatialReference"}}},write:!1}})],u.prototype,"spatialReference",void 0),m([L(["web-document","portal-item"],"spatialReference",["spatialReferences"])],u.prototype,"readSpatialReferenceFromItemOrDocument",null),m([c({type:[ce],json:{read:!1,origins:{service:{read:!0},"web-document":{read:!1,write:{ignoreOrigin:!0}},"portal-item":{read:!1,write:{ignoreOrigin:!0}}}}})],u.prototype,"spatialReferences",void 0),m([k(["web-document","portal-item"],"spatialReferences")],u.prototype,"writeSpatialReferences",null),m([c({type:Q.ofType(B),json:{write:{target:"layers",overridePolicy(e,t,r){if(gt(this.allSublayers,r))return{ignoreOrigin:!0}}}}})],u.prototype,"sublayers",void 0),m([L(["web-document","portal-item"],"sublayers",["layers","visibleLayers"])],u.prototype,"readSublayersFromItemOrMap",null),m([L("service","sublayers",["layers"])],u.prototype,"readSublayers",null),m([k("sublayers",{layers:{type:[B]},visibleLayers:{type:[String]}})],u.prototype,"writeSublayers",null),m([c({json:{read:!1},readOnly:!0,value:"wms"})],u.prototype,"type",void 0),m([c(Te)],u.prototype,"url",null),m([c({type:String,json:{write:{ignoreOrigin:!0}}})],u.prototype,"version",void 0),u=m([fe("esri.layers.WMSLayer")],u);var mr=u;export{mr as default};
