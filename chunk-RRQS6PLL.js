import{a as N,aa as Z,ma as B,o as j,oa as G,ob as k,p as L,ub as I,za as H}from"./chunk-V3KEO7AJ.js";var W=class R{constructor(t,s,i){if(t instanceof R)return this.data=t.data,this.N=t.N,this.M=t.M,t.data=null,t.N=0,void(t.M=0);this.data=t,this.N=s,this.M=i}assignCopy(t){return this===t||(N(this.N*this.M==t.N*t.M),this.data.set(t.data),this.N=t.N,this.M=t.M),this}setZero(){return this.data?.fill(0),this}setIdentity(){for(let i=0;i<this.N;i++)for(let o=0;o<this.M;o++)this.setRowCol(i,o,i===o?1:0);return this}rows(){return this.N}cols(){return this.M}row(t){return N(0),{}}set(t,s){return this.data[t]=s,this}setRowCol(t,s,i){return this.data[t*this.M+s]=i,this}at(t){return this.data[t]}atRowCol(t,s){return this.data[t*this.M+s]}mulScalar(t,s){N(0)}mul(t,s){if(N(this.M===t.rows()),N(this.N===s.rows()),N(t.cols()===s.cols()),s===this){let o=new Float64Array(this.N*this.M),e=new R(o,this.N,this.M);return this.mul(t,e),void s.assignCopy(e)}if(s===t){let o=new Float64Array(t.N*t.M),e=new R(o,t.N,t.M);return this.mul(t,e),void s.assignCopy(e)}let i=t.cols();for(let o=0;o<this.N;o++)for(let e=0;e<i;e++){let a=0;for(let l=0;l<this.M;l++)a+=this.atRowCol(o,l)*t.atRowCol(l,e);s.setRowCol(o,e,a)}}mulTranspose(t,s){if(N(this.M===t.cols()),N(this.N===s.rows()),N(t.rows()===s.cols()),s===this){let o=new Float64Array(this.N*this.M),e=new R(o,this.N,this.M);return this.mulTranspose(t,e),void s.assignCopy(e)}if(s===t){let o=new Float64Array(t.N*t.M),e=new R(o,t.N,t.M);return this.mulTranspose(t,e),void s.assignCopy(e)}let i=t.rows();for(let o=0;o<this.N;o++)for(let e=0;e<i;e++){let a=0;for(let l=0;l<this.M;l++)a+=this.atRowCol(o,l)*t.atRowCol(e,l);s.setRowCol(o,e,a)}}mulLeft(t,s){N(0)}mulLeftTranspose(t,s){N(0)}mulDiag(t,s){if(N(this.M===t.N*t.M),N(this.N===s.rows()),N(this.M===s.cols()),s===this){let o=new Float64Array(this.N*this.M),e=new R(o,this.N,this.M);return this.mulDiag(t,e),void s.assignCopy(e)}let i=this.M;for(let o=0;o<this.N;o++)for(let e=0;e<i;e++)s.setRowCol(o,e,this.atRowCol(o,e)*t.at(e))}transposeInPlace(){if(this.N===this.M){for(let i=0;i<this.N;i++)for(let o=i+1;o<this.M;o++){let e=this.atRowCol(i,o);this.setRowCol(i,o,this.atRowCol(o,i)),this.setRowCol(o,i,e)}return this}let t=new Float64Array(this.N*this.M),s=new R(t,this.N,this.M);return s.assignCopy(this),this.M=G(this.N,this.N=this.M),s.transpose(this),this}transpose(t){if(this!==t){R.checkDims(t,this.M,this.N);for(let s=0;s<this.N;s++)for(let i=0;i<this.M;i++)t.setRowCol(i,s,this.atRowCol(s,i))}else t.transposeInPlace()}add(t,s){}svd(t,s,i,o=!1){if(R.checkDims(t,this.N,this.M),R.checkDims(s,this.M,1),R.checkDims(i,this.M,this.M),o){if(N(this.N===this.M),!this.symmetricEigen(s,i))return!1;for(let h=0;h<this.M;++h)s.at(h)<0&&s.set(h,0);return t.assignCopy(i),!0}let e,a,l,n,d,m,w,x=0,p=0,M=0,u=0,c=0,C=this.M,b=this.N;t.assignCopy(this);let v=new Float64Array(C),T=new R(v,C,1),D=(h,f)=>f>=0?Math.abs(h):-Math.abs(h),F=(h,f)=>{if((h=Math.abs(h))>(f=Math.abs(f))){let r=f/h;return h*Math.sqrt(r*r+1)}if(f>0){let r=h/f;return f*Math.sqrt(r*r+1)}return 0};for(let h=0;h<C;h++){if(x=h+1,T.set(h,u*M),M=n=u=0,h<b){for(let r=h;r<b;r++)u+=Math.abs(t.atRowCol(r,h));if(u){for(let r=h;r<b;r++)t.setRowCol(r,h,t.atRowCol(r,h)/u),n+=t.atRowCol(r,h)*t.atRowCol(r,h);a=t.atRowCol(h,h),M=-D(Math.sqrt(n),a),l=a*M-n,t.setRowCol(h,h,a-M);for(let r=x;r<C;r++){n=0;for(let y=h;y<b;y++)n+=t.atRowCol(y,h)*t.atRowCol(y,r);a=n/l;for(let y=h;y<b;y++)t.setRowCol(y,r,t.atRowCol(y,r)+a*t.atRowCol(y,h))}for(let r=h;r<b;r++)t.setRowCol(r,h,t.atRowCol(r,h)*u)}}if(s.set(h,u*M),M=n=u=0,h<b&&h!==C-1){for(let r=x;r<C;r++)u+=Math.abs(t.atRowCol(h,r));if(u){for(let r=x;r<C;r++)t.setRowCol(h,r,t.atRowCol(h,r)/u),n+=t.atRowCol(h,r)*t.atRowCol(h,r);a=t.atRowCol(h,x),M=-D(Math.sqrt(n),a),l=a*M-n,t.setRowCol(h,x,a-M);for(let r=x;r<C;r++)T.set(r,t.atRowCol(h,r)/l);for(let r=x;r<b;r++){n=0;for(let y=x;y<C;y++)n+=t.atRowCol(r,y)*t.atRowCol(h,y);for(let y=x;y<C;y++)t.setRowCol(r,y,t.atRowCol(r,y)+n*T.at(y))}for(let r=x;r<C;r++)t.setRowCol(h,r,t.atRowCol(h,r)*u)}}let f=Math.abs(s.at(h))+Math.abs(T.at(h));c=f>c?f:c}for(let h=C-1;h>=0;h--){if(h<C-1){if(M){for(let f=x;f<C;f++)i.setRowCol(f,h,t.atRowCol(h,f)/t.atRowCol(h,x)/M);for(let f=x;f<C;f++){n=0;for(let r=x;r<C;r++)n+=t.atRowCol(h,r)*i.atRowCol(r,f);for(let r=x;r<C;r++)i.setRowCol(r,f,i.atRowCol(r,f)+n*i.atRowCol(r,h))}}for(let f=x;f<C;f++)i.setRowCol(h,f,0),i.setRowCol(f,h,0)}i.setRowCol(h,h,1),M=T.at(h),x=h}for(let h=(b<C?b:C)-1;h>=0;h--){x=h+1,M=s.at(h);for(let f=x;f<C;f++)t.setRowCol(h,f,0);if(M){M=1/M;for(let f=x;f<C;f++){n=0;for(let r=x;r<b;r++)n+=t.atRowCol(r,h)*t.atRowCol(r,f);a=n/t.atRowCol(h,h)*M;for(let r=h;r<b;r++)t.setRowCol(r,f,t.atRowCol(r,f)+a*t.atRowCol(r,h))}for(let f=h;f<b;f++)t.setRowCol(f,h,t.atRowCol(f,h)*M)}else for(let f=h;f<b;f++)t.setRowCol(f,h,0);t.setRowCol(h,h,t.atRowCol(h,h)+1)}for(let h=C-1;h>=0;h--)for(let f=1;;f++){let r=1;for(x=h;x>=0;x--){if(p=x-1,Math.abs(T.at(x))+c===c){r=0;break}if(Math.abs(s.at(p))+c===c)break}if(r){e=0,n=1;for(let y=x;y<=h&&(a=n*T.at(y),T.set(y,T.at(y)*e),Math.abs(a)+c!==c);y++){M=s.at(y),l=F(a,M),s.set(y,l),l=1/l,e=M*l,n=-a*l;for(let P=0;P<b;P++)m=t.atRowCol(P,p),w=t.atRowCol(P,y),t.setRowCol(P,p,m*e+w*n),t.setRowCol(P,y,w*e-m*n)}}if(w=s.at(h),x===h){if(w<0){s.set(h,-w);for(let y=0;y<C;y++)i.setRowCol(y,h,-i.atRowCol(y,h))}break}if(f===100)return!1;d=s.at(x),p=h-1,m=s.at(p),M=T.at(p),l=T.at(h),a=((m-w)*(m+w)+(M-l)*(M+l))/(2*l*m),M=F(a,1),a=((d-w)*(d+w)+l*(m/(a+D(M,a))-l))/d,e=n=1;for(let y=x;y<=p;y++){let P=y+1;M=T.at(P),m=s.at(P),l=n*M,M*=e,w=F(a,l),T.set(y,w),e=a/w,n=l/w,a=d*e+M*n,M=M*e-d*n,l=m*n,m*=e;for(let S=0;S<C;S++)d=i.atRowCol(S,y),w=i.atRowCol(S,P),i.setRowCol(S,y,d*e+w*n),i.setRowCol(S,P,w*e-d*n);w=F(a,l),s.set(y,w),w&&(w=1/w,e=a*w,n=l*w),a=e*M+n*m,d=e*m-n*M;for(let S=0;S<b;S++)m=t.atRowCol(S,y),w=t.atRowCol(S,P),t.setRowCol(S,y,m*e+w*n),t.setRowCol(S,P,w*e-m*n)}T.set(x,0),T.set(h,a),s.set(h,d)}let g=new Float64Array(this.N),E=new Float64Array(this.M),X=new R(g,this.N,1),Y=new R(E,this.M,1),A=1;do A*=3,A++;while(A<=this.M);do{A/=3,A=Math.trunc(A);for(let h=A;h<this.M;h++){let f=s.at(h);for(let y=0;y<this.N;y++)X.set(y,t.atRowCol(y,h));for(let y=0;y<this.M;y++)Y.set(y,i.atRowCol(y,h));let r=h;for(;s.at(r-A)<f;){s.set(r,s.at(r-A));for(let y=0;y<this.N;y++)t.setRowCol(y,r,t.atRowCol(y,r-A));for(let y=0;y<this.M;y++)i.setRowCol(y,r,i.atRowCol(y,r-A));if(r-=A,r<A)break}s.set(r,f);for(let y=0;y<this.N;y++)t.setRowCol(y,r,X.at(y));for(let y=0;y<this.M;y++)i.setRowCol(y,r,Y.at(y))}}while(A>1);for(let h=0;h<this.M;h++){let f=0;for(let r=0;r<this.N;r++)t.atRowCol(r,h)<0&&f++;for(let r=0;r<this.M;r++)i.atRowCol(r,h)<0&&f++;if(f>Math.trunc((this.N+this.M)/2)){for(let r=0;r<this.N;r++)t.setRowCol(r,h,-t.atRowCol(r,h));for(let r=0;r<this.M;r++)i.setRowCol(r,h,-i.atRowCol(r,h))}}return!0}isSymmetric(){if(this.N!==this.M)return!1;for(let t=0;t<this.N;t++)for(let s=t+1;s<this.M;s++)if(this.atRowCol(t,s)!==this.atRowCol(s,t))return!1;return!0}isZero(){return N(0),!1}isIdentity(){return N(0),!1}equals(t,s){if(s!==void 0&&N(0),this.N!==t.N||this.M!==t.M)return!1;for(let i=0;i<this.N*this.M;i++)if(this.data[i]!==t.data[i])return!1;return!0}maxElement(){return N(0),0}minElement(){return N(0),0}determinant(){if(N(this.N===this.M),this.N===1)return this.data[0];if(this.N===2)return this.data[0]*this.data[3]-this.data[1]*this.data[2];if(this.N===3){let e=this;return e.atRowCol(0,0)*(e.atRowCol(1,1)*e.atRowCol(2,2)-e.atRowCol(1,2)*e.atRowCol(2,1))-e.atRowCol(0,1)*(e.atRowCol(1,0)*e.atRowCol(2,2)-e.atRowCol(2,0)*e.atRowCol(1,2))+e.atRowCol(0,2)*(e.atRowCol(1,0)*e.atRowCol(2,1)-e.atRowCol(1,1)*e.atRowCol(2,0))}let t=new Float64Array(this.N*this.N),s=new R(t,this.N,this.N),i=new Float64Array(this.N);if(!this.luDecomposition(s,i))return 0;let o=1;for(let e=0;e<this.N;e++)o*=s.atRowCol(e,e),i[e]!==e&&(o=-o);return o}submatrix(t,s,i){N(0)}inverse(t){N(0)}pseudoInverse(t,s=!1,i=2220446049250313e-31){if(t.setZero(),this.N===1&&this.M===1)return this.atRowCol(0,0)!==0?t.setRowCol(0,0,1/this.atRowCol(0,0)):t.setRowCol(0,0,0),!0;if(this.N===2&&this.M===2){let x=this.atRowCol(0,0)*this.atRowCol(1,1)-this.atRowCol(0,1)*this.atRowCol(1,0),p=1e-5*(Math.abs(this.atRowCol(0,0)*this.atRowCol(1,1))+Math.abs(this.atRowCol(0,1)*this.atRowCol(1,0)));if(Math.abs(x)>p)return t.setRowCol(0,0,this.atRowCol(1,1)/x),t.setRowCol(0,1,-this.atRowCol(0,1)/x),t.setRowCol(1,0,-this.atRowCol(1,0)/x),t.setRowCol(1,1,this.atRowCol(0,0)/x),!0}let o=new Float64Array(this.N*this.M),e=new R(o,this.N,this.M),a=new Float64Array(this.M),l=new R(a,this.M,1),n=new Float64Array(this.M*this.M),d=new R(n,this.M,this.M);if(!this.svd(e,l,d,s))return!1;let m=Math.max(this.N,this.M),w=i*Math.abs(l.at(0))*m;for(let x=0;x<this.M;x++)l.at(x)>w?l.set(x,1/l.at(x)):l.set(x,0);return d.mulDiag(l,t),t.mulTranspose(e,t),!0}luDecomposition(t,s){return N(0),!1}symmetricEigen(t,s){N(this.rows()===this.cols()),N(this.rows()===t.rows()),N(s.rows()===s.cols()&&s.rows()===this.rows()),N(this.isSymmetric());let i=new Float64Array(this.N*this.M),o=new R(i,this.N,this.M);o.assignCopy(this);let e=100/Number.EPSILON,a=this.rows(),l=new Float64Array(a),n=new Float64Array(a),d=new R(l,a,1),m=new R(n,a,1);for(let x=0;x<a;x++)d.set(x,o.atRowCol(x,x)),t.set(x,o.atRowCol(x,x)),m.set(x,0);s.setIdentity();let w=()=>{let x=d;s.transposeInPlace();let p=1;do p*=3,p++;while(p<=a);do{p/=3,p=Math.trunc(p);for(let M=p;M<a;M++){let u=t.at(M),c=Math.abs(u);for(let b=0;b<this.M;b++)x.set(b,s.atRowCol(b,M));let C=M;for(;Math.abs(t.at(C-p))<c;){t.set(C,t.at(C-p));for(let b=0;b<this.M;b++)s.setRowCol(b,C,s.atRowCol(b,C-p));if(C-=p,C<p)break}if(C!==M){t.set(C,u);for(let b=0;b<this.M;b++)s.setRowCol(b,C,x.at(b))}}}while(p>1)};for(let x=1;;x++){let p=0;for(let u=1;u<a;u++)for(let c=0;c<u;c++)p+=Math.abs(o.atRowCol(u,c));if(p===0)return w(),!0;let M=x<4?.2*p/(a*a):0;for(let u=0;u<a;u++)for(let c=u+1;c<a;c++){let C=e*Math.abs(o.atRowCol(c,u));if(x>4&&C<=Math.abs(t.at(u))&&C<=Math.abs(t.at(c)))o.setRowCol(c,u,0);else if(Math.abs(o.atRowCol(c,u))>M){let b,v=t.at(c)-t.at(u);if(C<Math.abs(v))b=o.atRowCol(c,u)/v;else{let E=.5*v/o.atRowCol(c,u);b=1/(Math.abs(E)+Math.sqrt(1+E*E)),E<0&&(b=-b)}let T=1/Math.sqrt(1+b*b),D=b*T,F=D/(1+T);v=b*o.atRowCol(c,u),m.set(u,m.at(u)-v),m.set(c,m.at(c)+v),t.set(u,t.at(u)-v),t.set(c,t.at(c)+v),o.setRowCol(c,u,0);let g=0;for(;g<u;g++)C=o.atRowCol(u,g),v=o.atRowCol(c,g),o.setRowCol(u,g,C-D*(v+C*F)),o.setRowCol(c,g,v+D*(C-v*F));for(g++;g<c;g++)C=o.atRowCol(g,u),v=o.atRowCol(c,g),o.setRowCol(g,u,C-D*(v+C*F)),o.setRowCol(c,g,v+D*(C-v*F));for(g++;g<a;g++)C=o.atRowCol(g,u),v=o.atRowCol(g,c),o.setRowCol(g,u,C-D*(v+C*F)),o.setRowCol(g,c,v+D*(C-v*F));for(g=0;g<a;g++)C=s.atRowCol(u,g),v=s.atRowCol(c,g),s.setRowCol(u,g,C-D*(v+C*F)),s.setRowCol(c,g,v+D*(C-v*F))}}for(let u=0;u<a;u++)d.set(u,d.at(u)+m.at(u)),t.set(u,d.at(u)),m.set(u,0)}}static checkDims(t,s,i){N(t.rows()===s&&t.cols()===i)}},q=class extends W{constructor(t){if(t.copy){let i=new Float64Array(t.copy.N*t.copy.M);return super(i,t.copy.N,t.copy.M),this.buffer=i,void this.assignCopy(t.copy)}let s=new Float64Array(t.NN*t.MM);super(s,t.NN,t.MM),this.buffer=s,t.initializerList&&B(this.buffer,t.initializerList,0,0,t.initializerList.length)}assignCopy(t){return this===t||super.assignCopy(t),this}},O=class R{constructor(t){this.m_TransformationType=1,t===void 0?this.setIdentity():t instanceof R?this.set(t):this.setScale(t)}set(t){return this.xx=t.xx,this.xy=t.xy,this.xd=t.xd,this.yx=t.yx,this.yy=t.yy,this.yd=t.yd,this}clone(){return new R().set(this)}setZero(){this.xx=0,this.yy=0,this.xy=0,this.yx=0,this.xd=0,this.yd=0}isEqual(t){return this===t||this.xx===t.xx&&this.xy===t.xy&&this.xd===t.xd&&this.yx===t.yx&&this.yy===t.yy&&this.yd===t.yd}transformInPlace(t){let s=this.xx*t.x+this.xy*t.y+this.xd,i=this.yx*t.x+this.yy*t.y+this.yd;t.x=s,t.y=i}transform(t){let s=t.clone();return this.transformInPlace(s),s}queryTransform(t,s){let i=this.xx*t.x+this.xy*t.y+this.xd,o=this.yx*t.x+this.yy*t.y+this.yd;s.setCoords(i,o)}transformEnvInPlace(t){if(t.isEmpty())return;let s=H(I,4);t.queryCorners(s),this.transformPoints2D(s,4,s),t.setFromPoints(s,4)}queryTransformEnv(t,s){N(0)}transformPoints2D(t,s,i){for(let o=0;o<s;++o)this.queryTransform(t[o],i[o])}transformInterleavedPoints(t,s,i){s*=2;let o=I.getNAN();for(let e=0;e<s;e+=2)o.x=t[e],o.y=t[e+1],this.transformInPlace(o),i[e]=o.x,i[e+1]=o.y}multiply(t){return R.st_multiply(this,t,this),this}mulLeft(t){return N(0),this}static st_multiply(t,s,i){let o=t.xx*s.xx+t.yx*s.xy,e=t.xy*s.xx+t.yy*s.xy,a=t.xd*s.xx+t.yd*s.xy+s.xd,l=t.xx*s.yx+t.yx*s.yy,n=t.xy*s.yx+t.yy*s.yy,d=t.xd*s.yx+t.yd*s.yy+s.yd;i.xx=o,i.xy=e,i.xd=a,i.yx=l,i.yy=n,i.yd=d}getCoefficients(t){N(t.length>=6),t[0]=this.xx,t[1]=this.xy,t[2]=this.xd,t[3]=this.yx,t[4]=this.yy,t[5]=this.yd}setCoefficients(t){N(t.length>=6),this.xx=t[0],this.xy=t[1],this.xd=t[2],this.yx=t[3],this.yy=t[4],this.yd=t[5]}copyTo(t){N(0)}initializeFromRect(t,s){t.isEmpty()||s.isEmpty()||!t.width()||!t.height()?this.setZero():(this.xy=this.yx=0,this.xx=s.width()/t.width(),this.yy=s.height()/t.height(),this.xd=s.xmin-t.xmin*this.xx,this.yd=s.ymin-t.ymin*this.yy)}initializeFromRectIsotropic(t,s){if(t.isEmpty()||!t.width()||!t.height()||s.isEmpty())this.setZero();else{this.yx=0,this.xy=0,this.xx=s.width()/t.width(),this.yy=s.height()/t.height(),this.xx>this.yy?this.xx=this.yy:this.yy=this.xx;let i=s.getCenter(),o=t.getCenter();this.xd=i.x-o.x*this.xx,this.yd=i.y-o.y*this.yy}}initializeFromTwoPointsArray(t,s){if(t[0].equals(s[0])&&t[1].equals(s[1]))return void this.setIdentity();if(t[0].equals(t[1])){if(s[0].equals(s[1]))return void this.setShift(s[0].sub(t[0]));j("")}if(!t[0].equals(t[1])&&s[0].equals(s[1]))return this.setZero(),void this.shift(s[0]);this.setShiftCoords(-t[0].x,-t[0].y);let i=I.distance(t[0],t[1]),o=I.distance(s[0],s[1]),e=o/i;this.scale(e,e);let a=t[1].sub(t[0]);a.divThis(i);let l=s[1].sub(s[0]);l.divThis(o);let n=a.crossProduct(l),d=a.dotProduct(l);this.rotate(d,n),this.shiftCoords(s[0].x,s[0].y)}initializeFromTwoPoints(t,s,i,o){let e=[t,s],a=[i,o];this.initializeFromTwoPointsArray(e,a)}transformSizeInPlace(t){N(0)}transformSize(t,s){N(0)}transformTol(t){return N(0),0}transformWithoutTranslateArray(t,s,i){for(let o=0;o<s;++o)this.transformWithoutTranslate(t[o],i[o])}transformWithoutTranslateInPlace(t){let s=this.xx*t.x+this.xy*t.y,i=this.yx*t.x+this.yy*t.y;t.setCoords(s,i)}transformWithoutTranslate(t,s){let i=this.xx*t.x+this.xy*t.y,o=this.yx*t.x+this.yy*t.y;s.setCoords(i,o)}setIdentity(){this.xx=1,this.xy=0,this.xd=0,this.yx=0,this.yy=1,this.yd=0}isIdentity(){return!(this.xx!==1||this.yy!==1||this.xy||this.xd||this.yx||this.yd)}isIdentityTol(t){let s=t*t;return!(Z(this.xd)+Z(this.yd)>s)&&!(Z(this.xy+this.xd)+Z(this.yy+this.yd-1)>s)&&!(Z(this.xx+this.xd-1)+Z(this.yx+this.yd)>s)}isReflective(){return this.xx*this.yy-this.yx*this.xy<0}isUniform(t){let s=this.xx*this.xx+this.yx*this.yx,i=this.xy*this.xy+this.yy*this.yy,o=(s+i)*t;return Math.abs(s-i)<=o&&Math.abs(this.xx*this.xy+this.yx*this.yy)<=o}isUniformNoRotation(){return this.xx!==0&&Math.abs(this.xx)===Math.abs(this.yy)&&this.xy===0&&this.yx===0}isTranslate(){return this.xx===1&&this.yy===1&&!this.xy&&!this.yx}isTranslateTol(t){let s=new I;return s.setCoords(0,1),this.transformWithoutTranslateInPlace(s),s.y-=1,!(s.sqrLength()>t*t)&&(s.setCoords(1,0),this.transformWithoutTranslateInPlace(s),s.x-=1,s.sqrLength()<=t*t)}isOrthonormal(t){let s=new R;return s.xx=this.xx*this.xx+this.xy*this.xy,s.xy=this.xx*this.yx+this.xy*this.yy,s.yx=this.yx*this.xx+this.yy*this.xy,s.yy=this.yx*this.yx+this.yy*this.yy,s.xd=0,s.yd=0,s.isIdentityTol(t)}isDegenerate(t){return Math.abs(this.xx*this.yy-this.yx*this.xy)<=2*t*(Math.abs(this.xx*this.yy)+Math.abs(this.yx*this.xy))}isZero(){return this.xx===0&&this.yy===0&&this.xy===0&&this.yx===0&&this.xd===0&&this.yd===0}isScaleAndTranslateTol(t){return this.xy*this.xy+this.yx*this.yx<=(this.xx*this.xx+this.yy*this.yy)*t}setTranslate(t,s){return this.xx=1,this.xy=0,this.xd=t,this.yx=0,this.yy=1,this.yd=s,this}setShiftCoords(t,s){return this.xx=1,this.xy=0,this.xd=t,this.yx=0,this.yy=1,this.yd=s,this}setShift(t){return this.xx=1,this.xy=0,this.xd=t.x,this.yx=0,this.yy=1,this.yd=t.y,this}setScaleCoords(t,s){return this.xx=t,this.xy=0,this.xd=0,this.yx=0,this.yy=s,this.yd=0,this}setScale(t){return this.setScaleCoords(t,t),this}setFlipX(t,s){return this.xx=-1,this.xy=0,this.xd=t+s,this.yx=0,this.yy=1,this.yd=0,this}setFlipY(t,s){return this.xx=1,this.xy=0,this.xd=0,this.yx=0,this.yy=-1,this.yd=t+s,this}setShear(t,s){return this.xx=1,this.xy=t,this.xd=0,this.yx=s,this.yy=1,this.yd=0,this}scale(t,s){return this.xx*=t,this.xy*=t,this.xd*=t,this.yx*=s,this.yy*=s,this.yd*=s,this}setRotateAngle(t){return this.setRotate(Math.cos(t),Math.sin(t))}setRotate(t,s){return this.xx=t,this.xy=-s,this.xd=0,this.yx=s,this.yy=t,this.yd=0,this}setRotateAngleAbout(t,s){return this.setRotateAbout(Math.cos(t),Math.sin(t),s)}setRotateAbout(t,s,i){return this.setTranslate(-i.x,-i.y),this.rotate(t,s),this.translate(i.x,i.y)}setSwapCoordinates(){return this.xx=0,this.xy=1,this.xd=0,this.yx=1,this.yy=0,this.yd=0,this}setRotateCw90(){return this.xx=0,this.xy=1,this.xd=0,this.yx=-1,this.yy=0,this.yd=0,this}setRotateCcw90(){return this.xx=0,this.xy=-1,this.xd=0,this.yx=1,this.yy=0,this.yd=0,this}shiftCoords(t,s){return this.xd+=t,this.yd+=s,this}shift(t){return this.xd+=t.x,this.yd+=t.y,this}translate(t,s){return this.xd+=t,this.yd+=s,this}flipX(t,s){return this.xx=-this.xx,this.xy=-this.xy,this.xd=t+s-this.xd,this}flipY(t,s){return this.yx=-this.yx,this.yy=-this.yy,this.yd=t+s-this.yd,this}shear(t,s){let i=new R;return i.setShear(t,s),this.multiply(i)}rotateAngle(t){let s=new R;return s.setRotateAngle(t),this.multiply(s)}rotate(t,s){let i=new R;return i.setRotate(t,s),this.multiply(i)}rotateAbout(t,s,i){return this.translate(-i.x,-i.y),this.rotate(t,s),this.translate(i.x,i.y)}rotateAngleAbout(t,s){return this.rotateAbout(Math.cos(t),Math.sin(t),s)}setInvert(t){return this.set(t),this.invertThis()}invertThis(){let t=this.xx*this.yy-this.xy*this.yx;if(t===0)return this.setZero(),this;t=1/t;let s=(this.xy*this.yd-this.xd*this.yy)*t,i=(this.xd*this.yx-this.xx*this.yd)*t,o=this.yy*t,e=-this.xy*t,a=-this.yx*t,l=this.xx*t;return this.xd=s,this.yd=i,this.xx=o,this.yy=l,this.xy=e,this.yx=a,this}invertPrecise(t){return this.set(t),this.invertPreciseThis()}invertPreciseThis(){let t=k.constructDouble(this.xy),s=k.constructDouble(this.xx),i=s.mulDouble(this.yy).sub(t.mulDouble(this.yx));if(i.isZero())return this.setZero(),this;let o=i.clone();o.invertThis();let e=k.constructDouble(this.xd),a=t.mulDouble(this.yd).sub(e.mulDouble(this.yy)).mul(o).toDouble(),l=e.mulDouble(this.yx).sub(s.mulDouble(this.yd)).mul(o).toDouble(),n=o.mulDouble(this.yy).toDouble(),d=o.mulDouble(-this.xy).toDouble(),m=o.mulDouble(-this.yx).toDouble(),w=o.mulDouble(this.xx).toDouble();return this.xd=a,this.yd=l,this.xx=n,this.yy=w,this.xy=d,this.yx=m,this}extractScaleTransform(t,s){let i=Math.sqrt(this.xx*this.xx+this.xy*this.xy),o=Math.sqrt(this.yx*this.yx+this.yy*this.yy);s.setScaleCoords(1/i,1/o),s.multiply(this),t.setScaleCoords(i,o)}setFromTwoTriangles(t,s){let i=!0;for(let m=0;m<3;++m)i=i&&t[m].equals(s[m]);if(i)return this.setIdentity(),!0;let o=new I;o.setSub(t[0],t[1]);let e=new I;e.setSub(t[0],t[2]);let a=new I;a.setSub(s[0],s[1]);let l=new I;l.setSub(s[0],s[2]);let n=4*Number.EPSILON*(Math.abs(o.x*e.y)+Math.abs(e.x*o.y)),d=o.x*e.y-o.y*e.x;return Math.abs(d)>n?(d=1/d,this.xx=(a.x*e.y-o.y*l.x)*d,this.xy=(o.x*l.x-a.x*e.x)*d,this.yx=(a.y*e.y-o.y*l.y)*d,this.yy=(o.x*l.y-a.y*e.x)*d,this.xd=s[0].x-(this.xx*t[0].x+this.xy*t[0].y),this.yd=s[0].y-(this.yx*t[0].x+this.yy*t[0].y),!0):(this.setZero(),!1)}initializeFromControlPoints(t,s,i,o,e=null){return s===0?(this.setIdentity(),void(e&&e.setIdentity())):s===1?(this.setShift(o[0].sub(i[0])),void(e&&e.setShift(i[0].sub(o[0])))):(s<3&&(t=1),void(t===4&&s>2?J(this,s,i,o,e):K(t,this,s,i,o,e)))}calculateErrors(t,s,i,o){N(t>0&&s!==null&&i!==null);let e=0;for(let a=0;a<t;++a){let l=this.transform(s[a]),n=I.sqrDistance(i[a],l);e+=n,o&&(o[a]=Math.sqrt(n))}return Math.sqrt(e/t)}},z=[43,11,41,9,61];function U(R,t){N(!(t.rows()!==2&&t.rows()!==3||t.cols()!==2&&t.rows()!==3)),R.xx=t.atRowCol(0,0),R.xy=t.atRowCol(0,1),R.yx=t.atRowCol(1,0),R.yy=t.atRowCol(1,1),t.cols()===3?(R.xd=t.atRowCol(0,2),R.yd=t.atRowCol(1,2)):(R.xd=0,R.yd=0)}function J(R,t,s,i,o){let e=I.average(s,t),a=I.average(i,t),l=new q({NN:2,MM:2});l.setZero();let n=new q({NN:2,MM:2});n.setZero();for(let w=0;w<t;++w)l.setRowCol(0,0,l.atRowCol(0,0)+(s[w].x-e.x)*(s[w].x-e.x)),l.setRowCol(0,1,l.atRowCol(0,1)+(s[w].x-e.x)*(s[w].y-e.y)),l.setRowCol(1,1,l.atRowCol(1,1)+(s[w].y-e.y)*(s[w].y-e.y)),n.setRowCol(0,0,n.atRowCol(0,0)+(i[w].x-a.x)*(s[w].x-e.x)),n.setRowCol(0,1,n.atRowCol(0,1)+(i[w].x-a.x)*(s[w].y-e.y)),n.setRowCol(1,0,n.atRowCol(1,0)+(i[w].y-a.y)*(s[w].x-e.x)),n.setRowCol(1,1,n.atRowCol(1,1)+(i[w].y-a.y)*(s[w].y-e.y));l.setRowCol(1,0,l.atRowCol(0,1));let d=new q({NN:2,MM:2});l.pseudoInverse(d,!0)||L("Failed to compute pseudo inverse"),n.mul(d,n),U(R,n);let m=e.clone();R.transformInPlace(m),R.xd=a.x-m.x,R.yd=a.y-m.y,o&&(n.pseudoInverse(d,!1)||L("Failed to compute pseudo inverse"),U(o,d),o.transformInPlace(a),o.xd=e.x-a.x,o.yd=e.y-a.y)}function K(R,t,s,i,o,e){N(R===1||R===0||R===2||R===3),t.setIdentity();let a=I.average(i,s),l=I.average(o,s);if(N(R<z.length&&R>0),8&z[R]){let d=new q({NN:2,MM:2});d.setZero();for(let c=0;c<s;++c)d.setRowCol(0,0,d.atRowCol(0,0)+(o[c].x-l.x)*(i[c].x-a.x)),d.setRowCol(1,0,d.atRowCol(1,0)+(o[c].x-l.x)*(i[c].y-a.y)),d.setRowCol(0,1,d.atRowCol(0,1)+(o[c].y-l.y)*(i[c].x-a.x)),d.setRowCol(1,1,d.atRowCol(1,1)+(o[c].y-l.y)*(i[c].y-a.y));let m=new q({NN:2,MM:2}),w=new q({NN:2,MM:1}),x=new q({NN:2,MM:2});d.svd(m,w,x)||L("Failed to compute svd");let p=new q({NN:2,MM:2});m.transpose(p);let M=new q({NN:2,MM:2});x.mul(p,M),!(32&z[R])&&M.determinant()<0&&(p.setRowCol(1,0,-p.atRowCol(1,0)),p.setRowCol(1,1,-p.atRowCol(1,1)),x.mul(p,M));let u=new O;U(u,M),t.set(u)}if(2&z[R]){let d=0,m=0;for(let w=0;w<s;++w){let x=i[w].sub(a);d+=x.sqrLength(),t.transformInPlace(x),m+=x.dotProduct(o[w].sub(l))}if(d===0)m===0?t.setIdentity():t.setZero();else{let w=m/d;t.scale(w,w)}}else N(!(4&z[R]));let n=a.clone();t.transformInPlace(n),t.xd=l.x-n.x,t.yd=l.y-n.y,e&&(e.set(t),e.invertThis(),e.isZero()&&(e.xd=a.x,e.yd=a.y))}export{O as a};
