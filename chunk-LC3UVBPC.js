import{a as Y}from"./chunk-FPCHE4I2.js";import{d as E}from"./chunk-4RK2B3SZ.js";import{b as X}from"./chunk-6OWZRPJO.js";import{b as Q,e as c}from"./chunk-67GIWMYL.js";import{a as O}from"./chunk-2672JUUN.js";import{a as S}from"./chunk-DXZ6STWE.js";import{d as B}from"./chunk-I4TW3U2S.js";import{a as P}from"./chunk-V7WSVLSI.js";import{b as G,c as j}from"./chunk-KALOJIUA.js";import{b as $}from"./chunk-32OAXCA4.js";import{c as M,g as J,h as D}from"./chunk-K5T5FD5C.js";import{a as b,e as H}from"./chunk-MVHHPJM7.js";import{b as A,c as I,e as g}from"./chunk-VDO6JJ3Y.js";import{a as Z,d as k}from"./chunk-WFKZLI6F.js";import{a as L,b as W,c as q,k as N}from"./chunk-TG45K3WR.js";import{b as K}from"./chunk-ACP3S2CH.js";import{a as x}from"./chunk-T7DXJKX7.js";import{a}from"./chunk-QGVBCWUY.js";import{e as s}from"./chunk-NFIPKH6V.js";import{l as z}from"./chunk-5QEXLALV.js";import{K as U,y as _}from"./chunk-4PTIEWMT.js";import{b as p}from"./chunk-YOFFGXOB.js";import{g as V}from"./chunk-XRGPJ3QY.js";import{a as T,b as R,f as h}from"./chunk-VTHXE323.js";var ee=new Map([["arrive","route-to"],["bear-left","bear-left"],["bear-right","bear-right"],["boundary-crossing","blank"],["central-fork","fork-middle"],["clockwise-roundabout","round-about-right"],["counter-clockwise-roundabout","round-about"],["depart","route-from"],["door","walk-through-door"],["down-elevator","elevator-down"],["down-escalator","escalator-down"],["down-stairs","stairs-down"],["elevator","elevator"],["escalator","escalator"],["general-event","information"],["header","blank"],["landmark","map-pin"],["lane","blank"],["left-fork","fork-left"],["left-handed-u-turn","u-turn"],["left-ramp","ramp-left"],["left-turn","left"],["left-turn-and-immediate-left-turn","left-left"],["left-turn-and-immediate-right-turn","left-right"],["off-ferry","disembark"],["on-ferry","embark"],["pedestrian-ramp","take-pedestrian-ramp"],["restriction-violation","exclamation-mark-triangle"],["right-fork","fork-right"],["right-handed-u-turn","u-turn-right"],["right-ramp","ramp-right"],["right-turn","right"],["right-turn-and-immediate-left-turn","right-left"],["right-turn-and-immediate-right-turn","right-right"],["roundabout","round-about"],["scaled-cost-barrier-event","blank"],["sharp-left","sharp-left"],["sharp-right","sharp-right"],["stairs","stairs"],["straight","straight"],["time-zone-change","clock"],["traffic-event","exclamation-mark-triangle"],["u-turn","u-turn"],["up-elevator","elevator-up"],["up-escalator","escalator-up"],["up-stairs","stairs-up"]]),f;function y(e,t){return $(e,{style:"unit",unit:t,unitDisplay:"short"})}function de(e,t,r){if(t===0)return"";let i,l,d=0,n=Q(t,"meters");switch(r){case"metric":n.value<.01?{value:i,unit:l}=c(n,"millimeters"):n.value<1?{value:i,unit:l}=c(n,"centimeters"):n.value<1e3?{value:i,unit:l}=c(n,"meters"):n.value<1e5?({value:i,unit:l}=c(n,"kilometers"),d=1):{value:i,unit:l}=c(n,"kilometers");break;case"imperial":n.value<.254?{value:i,unit:l}=c(n,"inches"):n.value<160.9344?{value:i,unit:l}=c(n,"feet"):n.value<160934.4?({value:i,unit:l}=c(n,"miles"),d=1):{value:i,unit:l}=c(n,"miles");break;default:({value:i,unit:l}=c(n,r)),d=2}return X(e,i,l,d)}function he(e){if(e===0)return"";if(e<1)return y(Math.floor(60*e),"second");if(e<60)return y(Math.floor(e),"minute");let t=Math.floor(e/60);if(e<1440){let r=Math.floor(e%60);return r===0?`${y(t,"hour")}`:`${y(t,"hour")} ${y(r,"minute")}`}return y(t,"hour")}function ce(e){return e!=null&&ee.has(e)?ee.get(e):"blank"}(function(e){e.NOW="now",e.DEPART_AT="depart-at",e.UNSPECIFIED="unspecified"})(f||(f={}));function ie(e){return e.map(t=>({locale:t,parts:k(t)})).filter(({parts:t})=>!!t)}function oe(e,t){return e.find(({parts:r})=>re(r.language,t.language)&&r.region===t.region)?.locale??e.find(({parts:r})=>re(r.language,t.language))?.locale}function ae(e){return e?.declaredClass==="esri.Graphic"}function te(e){return e==="no"||e==="nb"}function re(e,t){return e===t||te(e)&&te(t)}function se(e){return e?.declaredClass==="esri.rest.support.Stop"}var u;(function(e){e[e.Active=0]="Active",e[e.Complete=1]="Complete",e[e.Failed=2]="Failed",e[e.Idle=3]="Idle",e[e.Suspended=4]="Suspended"})(u||(u={}));var o=class extends Y(x.EventedAccessor){constructor(e){super(e),this._debouncedSolveHandler=U(t=>h(this,null,function*(){switch(t.type){case"create":if(t.state!=="complete")return;break;case"delete":break;case"update":switch(t.state){case"start":return void(this._networkFeatureUpdated=!1);case"active":return void(this._networkFeatureUpdated=!0);case"complete":if(!this._networkFeatureUpdated)return}}if(!((this.layer?.stops.filter(({geometry:r})=>!!r).length??0)<2)&&this.autoSolve)try{yield this.getDirections({zoomToSolvedRoute:!1})}catch(r){V.getLogger(this).error(r)}})),this._highlight=null,this._loadController=null,this._loadPromise=null,this._networkFeatureUpdated=!1,this._layerView=null,this._routeController=null,this._serviceDescriptionStatus=u.Idle,this.apiKey=void 0,this.autoSolve=!0,this.defaultTravelMode=null,this.departureIsoDate=void 0,this.departureIsoTime=void 0,this.departureOption=f.NOW,this.departureTime="now",this.lastError=null,this.lastRoute=null,this.layer=null,this.maxStops=50,this.routeParameters=new O({directionsLengthUnits:"kilometers",findBestSequence:!1,preserveFirstStop:!0,preserveLastStop:!0,returnZ:!0,useTimeWindows:!1}),this.serviceDescription=null,this.view=null}initialize(){this.addHandles([L(()=>this.layer,r=>{if(r!=null){for(;r.stops.length<2;)r.stops.add(new S);this._set("defaultTravelMode",null),this.addHandles(W(()=>this.serviceDescription?r.routeInfo?.analysisSettings?.travelMode:null,i=>{this.defaultTravelMode=this._resolveDefaultTravelMode(i)},{once:!0}))}},N),L(()=>[this.layer,this.view],()=>h(this,null,function*(){this._layerView=yield this._getRouteLayerView()}),N),q(()=>this._layerView,["create","delete","update"],r=>{this._debouncedSolveHandler(r).catch(i=>{if(!_(i))throw i})})]);let e=D(this.view?.timeZone??b),t=g.fromMillis(Date.now());this.departureIsoDate=t.toFormat(G,E(e)),this.departureIsoTime=t.toFormat(j,E(e))}get _directionsLanguage(){let e=this.serviceDescription?.directionsSupportedLanguages;if(!e)return;let t=this.routeParameters.directionsLanguage??Z(),r=k(t),i=r?.language,l=r?.region;if(i)return oe(ie(e),{language:i,region:l})}get formattedEta(){let e=this.layer?.routeInfo?.endTime,t=this.layer?.routeInfo?.endTimeOffset;if(this.departureOption===f.UNSPECIFIED||!e||!t)return null;let r=g.fromJSDate(e,{zone:I.instance(t)}),i=g.fromJSDate(e,{zone:A.create(D(this.view?.timeZone??b))}),l=g.fromJSDate(new Date,{zone:A.create(D(this.view?.timeZone??b))}),d=l.year===i.year&&l.month===i.month&&l.day===i.day,n=i.offset===t?void 0:H,v=d?void 0:M("short-date"),C=M("short-time");return J(r.toISO(),R(T(T({},v),C),{timeZoneName:n}))}get impedanceAttribute(){let e=this.routeParameters.travelMode?.impedanceAttributeName??this.routeParameters.impedanceAttribute??this.serviceDescription?.impedance??null;return this.getCostAttribute(e)}get selectedNetworkFeatures(){return this._layerView?.selectedNetworkFeatures??null}get selectedTravelMode(){return this.serviceDescription?this.defaultTravelMode??this.serviceDescription.defaultTravelMode??this.serviceDescription.supportedTravelModes?.[0]??null:null}set selectedTravelMode(e){this._override("selectedTravelMode",e)}get state(){if(this._routeController)return"routing";if(this.lastError)return"error";switch(this._serviceDescriptionStatus){case u.Suspended:return"unauthenticated";case u.Idle:return"disabled";case u.Active:return"initializing";case u.Failed:return"error";default:return"ready"}}get timeAttribute(){let e=this.routeParameters.travelMode?.timeAttributeName??this.routeParameters.directionsTimeAttribute??this.serviceDescription?.directionsTimeAttribute??null;return this.getCostAttribute(e)}get travelModes(){let e=this.serviceDescription?.supportedTravelModes?.slice()??[];return this.defaultTravelMode==null||e.includes(this.defaultTravelMode)||e.unshift(this.defaultTravelMode),e}load(){return h(this,null,function*(){if(this._loadPromise)return this._loadPromise;this._loadPromise=this._load(),yield this._loadPromise,this._loadPromise=null})}highlight(e){return h(this,null,function*(){if(this.clearHighlights(),!this.view||!this.layer)return;let t=yield this.view.whenLayerView(this.layer);this._highlight=t.highlight(e)})}clearHighlights(){this._highlight!=null&&(this._highlight.remove(),this._highlight=null)}centerAt(e){if(!this.view)return;let t=se(e)||ae(e)?e.geometry:e;t&&this.callGoTo({target:t})}clearResults(){this._set("lastRoute",null),this.layer?.removeResult()}create(e){return h(this,null,function*(){yield this._layerView?.create(e)})}getDirections(){return h(this,arguments,function*(e={zoomToSolvedRoute:!0}){let{apiKey:t,layer:r,state:i}=this;if(!r)throw new p("directions-view-model:missing-route-layer","A route layer must be associated with the view model.");if(i==="unauthenticated"||i==="initializing"||i==="disabled"||this._serviceDescriptionStatus===u.Failed)throw new p("directions-view-model:not-loaded","Cannot get directions until view model loads.");this._routeController!=null&&(this._routeController.abort(),this._routeController=null);let{startTime:l,startTimeIsUTC:d}=this._getStartTimeParameters(),n=this.view?.spatialReference??null,v=this.routeParameters.clone();if(v.set({apiKey:t,directionsLanguage:this._directionsLanguage,outSpatialReference:n,startTime:l,startTimeIsUTC:d}),this.selectedTravelMode&&(v.travelMode=this.selectedTravelMode),r.stops.filter(({geometry:m})=>m!=null).length<2){let m=new p("directions-view-model:not-enough-stops","Not enough stops for routing");throw this._set("lastError",m),m}this._routeController=new AbortController;let{signal:C}=this._routeController,w=null;try{w=yield r.solve(v,{signal:C})}catch(m){if(!_(m)){let F=new p("directions-view-model:unable-to-route","Unable to route to these addresses",{error:m});throw this._set("lastError",F),this.clearResults(),F}}finally{this._routeController=null}this._set("lastError",null);for(let m of w.stops)m.geometry==null&&(m.name=null);return r.update(w),this._set("lastRoute",w),e.zoomToSolvedRoute&&this.zoomToRoute(),w})}getCostAttribute(e){return(this.serviceDescription?.networkDataset?.networkAttributes??[]).find(({name:t,usageType:r})=>t===e&&r==="cost")??null}remove(e){this._layerView?.remove(e)}reset(){this.clearHighlights(),this.clearResults(),this.layer!=null&&(this.layer.removeAll(),this.layer.stops=new K([new S,new S]))}save(){if(!this.layer)throw new p("directions-view-model:missing-layer","save() requires a layer");return this.layer.save()}saveAs(e,t={}){if(!this.layer)throw new p("directions-view-model:missing-layer","saveAs() requires a layer");return this.layer.saveAs(e,t)}startEditing(){return h(this,null,function*(){this._layerView&&(this._layerView.interactive=!0)})}stopEditing(){return h(this,null,function*(){this._layerView&&(this._layerView.interactive=!1)})}updateDepartureTime(){if(this.departureIsoDate&&this.departureIsoTime)switch(this.departureOption){case f.NOW:this.departureTime="now";break;case f.DEPART_AT:{let e=g.fromISO(`${this.departureIsoDate}T${this.departureIsoTime}`,{zone:I.instance(0)});this.departureTime=e.toJSDate();break}case f.UNSPECIFIED:this.departureTime=null}}zoomToRoute(){let{view:e,layer:t}=this,r=t?.routeInfo?.geometry?.extent;if(!e||!r)return;let i=r.width>r.height,l=r.clone().expand(i?2:1);this.callGoTo({target:l})}_getRouteLayerView(){return h(this,null,function*(){return this.view&&this.layer?this.view.whenLayerView(this.layer):null})}_getStartTimeParameters(){return this.departureTime==="now"?{startTime:this.serviceDescription?.capabilities.supportsNow??!1?"now":new Date,startTimeIsUTC:!0}:this.departureTime==null?{startTime:void 0,startTimeIsUTC:void 0}:{startTime:this.departureTime,startTimeIsUTC:!1}}_load(){return h(this,null,function*(){if(this.layer==null)return;this._loadController!=null&&(this._loadController.abort(),this._loadController=null),this._loadController=new AbortController;let{signal:e}=this._loadController;try{this._serviceDescriptionStatus=u.Active;let t=yield B(this.layer.url,this.apiKey,{signal:e});this._set("serviceDescription",t),this._serviceDescriptionStatus=u.Complete}catch(t){if(_(t))return void(this._serviceDescriptionStatus=u.Idle);if(t.name==="identity-manager:user-aborted")return void(this._serviceDescriptionStatus=u.Suspended);let r=new p("directions-view-model:service-metadata-unavailable","Cannot load route service metadata",{error:t});throw this._serviceDescriptionStatus=u.Failed,this._set("lastError",r),r}finally{this._loadController=null}})}_resolveDefaultTravelMode(e){if(this.serviceDescription==null)return null;let{defaultTravelMode:t,supportedTravelModes:r}=this.serviceDescription,i=/^<(?<name>.*)>$/i.exec(e.name)?.groups?.name;if(i){let d=r?.find(({name:v})=>v.toLocaleLowerCase()===i.trim().toLocaleLowerCase()),n=d??t;return P.fromJSON(T(T({},n?.toJSON()),e.toJSON()))}return r?.find(({name:d})=>d.toLocaleLowerCase()===e.name.toLocaleLowerCase())??t}};a([s()],o.prototype,"_directionsLanguage",null),a([s()],o.prototype,"_layerView",void 0),a([s()],o.prototype,"_routeController",void 0),a([s()],o.prototype,"_serviceDescriptionStatus",void 0),a([s()],o.prototype,"apiKey",void 0),a([s()],o.prototype,"autoSolve",void 0),a([s()],o.prototype,"defaultTravelMode",void 0),a([s()],o.prototype,"departureTime",void 0),a([s()],o.prototype,"formattedEta",null),a([s({readOnly:!0})],o.prototype,"impedanceAttribute",null),a([s()],o.prototype,"lastError",void 0),a([s({readOnly:!0})],o.prototype,"lastRoute",void 0),a([s()],o.prototype,"layer",void 0),a([s({type:Number,range:{min:2,max:50},nonNullable:!0})],o.prototype,"maxStops",void 0),a([s({type:O,nonNullable:!0})],o.prototype,"routeParameters",void 0),a([s({readOnly:!0})],o.prototype,"selectedNetworkFeatures",null),a([s({type:P})],o.prototype,"selectedTravelMode",null),a([s({readOnly:!0})],o.prototype,"serviceDescription",void 0),a([s({readOnly:!0})],o.prototype,"state",null),a([s({readOnly:!0})],o.prototype,"timeAttribute",null),a([s()],o.prototype,"travelModes",null),a([s()],o.prototype,"view",void 0),a([s()],o.prototype,"zoomToRoute",null),o=a([z("esri.widgets.Directions.DirectionsViewModel")],o);var Ue=o;export{f as a,de as b,he as c,ce as d,Ue as e};
