import{b as q,i as G,l as O,o as k,q as B}from"./chunk-EB24NRSQ.js";import{d as z}from"./chunk-Z7TBAZRW.js";import{a as F}from"./chunk-NIYDRLW4.js";import{b as D}from"./chunk-HKJZ7WI6.js";import{b as j}from"./chunk-KMMTNF7G.js";import{a as C}from"./chunk-BOVYXYHK.js";import{a as P}from"./chunk-7F5DJLJT.js";import{p as S}from"./chunk-4PTIEWMT.js";import{f}from"./chunk-VTHXE323.js";function Z(n,c,p,w,a){return f(this,null,function*(){let{elevationProvider:l,renderCoordsHelper:i}=n,{elevationInfo:d}=c,{pointsInFeatures:x,spatialReference:m}=w,u=P.fromJSON(m),g=k(d,!0),h=yield O(g,u,a);S(a);let s=[],e=new Set,r=new Set,o=new B,t=F(0,0,0,P.WGS84),y=new G,I=C();t.spatialReference=u;let v=n.elevationProvider.spatialReference??n.spatialReference;for(let{objectId:E,points:A}of x){let b=p(E);if(b==null){for(let R of A)s.push(R.z??0);e.add(E);continue}b.isDraped&&r.add(E);let J=b.graphic.geometry;o.setFromElevationInfo(z(J,d)),o.updateFeatureExpressionInfoContext(h,b.graphic,c);for(let{x:R,y:N,z:T}of A)t.x=R,t.y=N,t.z=T??0,yield D(t,I,v,0,{signal:a}),q(I,l,o,i,y),s.push(y.z)}return{elevations:s,drapedObjectIds:r,failedObjectIds:e}})}function oe(n,c,p){return f(this,null,function*(){if(n==null||c.candidates.length===0)return H;let w=n.graphics3DGraphicsByObjectID??n.graphics3DGraphics,a=[],l=[],{renderer:i}=n,d=i!=null&&"arcadeRequired"in i&&i.arcadeRequired?j():null,x=(t,y)=>f(this,[t,y],function*(e,{graphic:r,graphics3DSymbol:o}){let I=yield d,v=yield n.getRenderingInfoAsync(r,i,I,{signal:p});return v==null?[]:o.queryForSnapping(e,u,v,p)}),{candidates:m,spatialReference:u}=c;for(let e=0;e<m.length;++e){let r=m[e],{objectId:o}=r,t=typeof o=="number"?w?.get(o):void 0;if(t==null)continue;let{graphics3DSymbol:y}=t;y.symbologySnappingSupported&&(a.push(x(r,t)),l.push(e))}if(a.length===0)return H;let g=yield Promise.all(a);S(p);let h=[],s=[];for(let e=0;e<g.length;++e){let r=g[e],o=l[e];for(let t of r)h.push(t),s.push(o)}return{candidates:h,sourceCandidateIndices:s}})}var H={candidates:[],sourceCandidateIndices:[]};export{Z as a,oe as b};
