import{a as Z}from"./chunk-76M36XUU.js";import"./chunk-Z5Q443PI.js";import{a as C,b as $,c as A,d as ee,e as L}from"./chunk-LC3UVBPC.js";import"./chunk-LS3HEJD5.js";import"./chunk-22XPHE6T.js";import"./chunk-XLBN5ML4.js";import{c as X,d as Y}from"./chunk-VGJUP3IY.js";import"./chunk-5HIFMC5M.js";import"./chunk-BRJ4IROM.js";import"./chunk-VP2YX4L2.js";import"./chunk-FPCHE4I2.js";import"./chunk-4RK2B3SZ.js";import"./chunk-EPKVBNFW.js";import"./chunk-TGSXSDDB.js";import{a as E}from"./chunk-FHBFWDFD.js";import{b as Q}from"./chunk-KVIHP5QH.js";import"./chunk-62UTK67Z.js";import{a as J}from"./chunk-5KMJDB5T.js";import"./chunk-UF3HHTD3.js";import"./chunk-6OWZRPJO.js";import"./chunk-67GIWMYL.js";import"./chunk-FPLMR2RR.js";import"./chunk-2672JUUN.js";import"./chunk-P6M7OD5Q.js";import"./chunk-OPZW6OUW.js";import"./chunk-CY5RTAXH.js";import"./chunk-P4X6P2DH.js";import{a as T}from"./chunk-DXZ6STWE.js";import"./chunk-I4TW3U2S.js";import"./chunk-V7WSVLSI.js";import"./chunk-QUZEX4CN.js";import"./chunk-H2NTHPNN.js";import"./chunk-PPBOBNTL.js";import"./chunk-ITDLEL4J.js";import"./chunk-JAM5M2OZ.js";import"./chunk-456M7HFK.js";import"./chunk-GNEAU6X4.js";import"./chunk-4YTM754S.js";import"./chunk-LAX5536Z.js";import"./chunk-N3HRYLNW.js";import"./chunk-4DBMALZW.js";import"./chunk-CVWWHM2V.js";import"./chunk-6OQYVEQJ.js";import"./chunk-YOXOWGT6.js";import"./chunk-EFZOSMYP.js";import"./chunk-WI7F4ZKJ.js";import"./chunk-MJ7M24NH.js";import"./chunk-GJH4QFRX.js";import"./chunk-T63F7663.js";import"./chunk-O4V2VBSK.js";import"./chunk-5TKRKB5E.js";import"./chunk-XAGMDNNR.js";import"./chunk-OP2TLIUN.js";import"./chunk-T2THIR6K.js";import"./chunk-LORHDXEB.js";import"./chunk-BBBPJI4H.js";import"./chunk-45BTW5EG.js";import"./chunk-TPFBHGDM.js";import"./chunk-73NLRHJD.js";import"./chunk-PNFEUBDF.js";import"./chunk-6RCCEJDL.js";import"./chunk-PQ2TNDUX.js";import"./chunk-6X6MKRQ3.js";import"./chunk-FQFHMHYU.js";import"./chunk-SZMEI3WL.js";import"./chunk-KKVGD67U.js";import"./chunk-MYOJWRDU.js";import"./chunk-L7UKJKHG.js";import"./chunk-V2IENAEU.js";import"./chunk-QAGQFNF2.js";import"./chunk-SY7JS2VW.js";import"./chunk-WK57SDN6.js";import"./chunk-AG4V3ZUO.js";import"./chunk-YWLMJ26A.js";import"./chunk-QAWNU3UJ.js";import"./chunk-HRQT4R6X.js";import"./chunk-44BHLWQ4.js";import"./chunk-5BPM64SU.js";import"./chunk-PMVHHMQJ.js";import"./chunk-NAFOM5UA.js";import"./chunk-DO7UF2F2.js";import"./chunk-ZTR6OS44.js";import"./chunk-VRTKAD2J.js";import"./chunk-DBLKLHK2.js";import"./chunk-UTE3ASAZ.js";import"./chunk-2AFEAPEX.js";import"./chunk-GNGXUEWV.js";import"./chunk-QBI5NDCA.js";import"./chunk-NOHW2DKR.js";import"./chunk-HVJAAM3A.js";import"./chunk-ACPEJEHK.js";import"./chunk-I7B3LWNP.js";import"./chunk-YP2E5N4E.js";import"./chunk-QLMNLSCT.js";import"./chunk-P55G5ATK.js";import"./chunk-JT3K52KQ.js";import"./chunk-SPLEGG4R.js";import"./chunk-Y4TJDUGP.js";import"./chunk-6PAFOJ4W.js";import"./chunk-74SDGE57.js";import"./chunk-FRXWHX3T.js";import"./chunk-DTDQ5X42.js";import"./chunk-RX2HFR4X.js";import"./chunk-AZW7YPTQ.js";import"./chunk-NJLJX4X6.js";import"./chunk-DZHFTD24.js";import"./chunk-K57Z4J34.js";import"./chunk-VWG3KVOU.js";import"./chunk-JOEUVLAN.js";import"./chunk-JZQDGIDQ.js";import{a as V}from"./chunk-CZ6CGC7I.js";import"./chunk-7B6U3N62.js";import"./chunk-46WDO5LS.js";import"./chunk-G5EYK5KM.js";import"./chunk-YJKJQU3F.js";import"./chunk-OK4K3OQT.js";import"./chunk-BPWNCOXC.js";import"./chunk-VNS4CQ27.js";import"./chunk-AVMO6LCR.js";import"./chunk-TEGPMVWT.js";import"./chunk-CLQRQC3Y.js";import"./chunk-KSNU73LO.js";import"./chunk-FACEVGRE.js";import"./chunk-5XTCPT52.js";import"./chunk-YW3L7OMP.js";import"./chunk-XRTA5GHC.js";import"./chunk-BMYVPMAK.js";import"./chunk-6F25LG6O.js";import"./chunk-GJ2QRXGN.js";import"./chunk-57TARQ4F.js";import"./chunk-6RBQSBA2.js";import"./chunk-3JGYBNJA.js";import"./chunk-ZC6EBRE4.js";import"./chunk-KALOJIUA.js";import"./chunk-KMMTNF7G.js";import"./chunk-E7AX56GD.js";import"./chunk-IDVLLREH.js";import"./chunk-DWLSVYOY.js";import"./chunk-PQGCNP5H.js";import"./chunk-UASS7NJI.js";import"./chunk-WZRAC35O.js";import"./chunk-KUYAWYSS.js";import"./chunk-MIS6QMFE.js";import"./chunk-MDZTV2VL.js";import"./chunk-RNC4P66O.js";import"./chunk-7LHOQXZT.js";import"./chunk-BCREO4Q5.js";import"./chunk-U4QEPZJ3.js";import"./chunk-KJUZWSCL.js";import"./chunk-3WO6D7MU.js";import"./chunk-BUZ3SPLE.js";import"./chunk-K75TK42V.js";import"./chunk-OLOKUDVI.js";import"./chunk-RJWOVI3M.js";import"./chunk-BOVYXYHK.js";import"./chunk-KVM6SHDX.js";import"./chunk-HX2VGIR2.js";import"./chunk-ERDKAICI.js";import"./chunk-EQZWYK27.js";import"./chunk-JLPLCY2B.js";import{a as W}from"./chunk-DKGGDYJI.js";import"./chunk-5LA3PVK5.js";import"./chunk-IR6XCBC4.js";import"./chunk-C6JPAW54.js";import"./chunk-WD3OPXCN.js";import"./chunk-FA3WGIU4.js";import"./chunk-WWVPA6PE.js";import"./chunk-ZQIC5NFT.js";import"./chunk-VIEK2X23.js";import"./chunk-XKIFGPJO.js";import"./chunk-PEW2PLAN.js";import"./chunk-Q6Y4JG7Q.js";import"./chunk-7F5DJLJT.js";import"./chunk-CX5IFQZJ.js";import"./chunk-NJWTSROP.js";import"./chunk-D3R25AF2.js";import"./chunk-ARRCN5K3.js";import{a as D}from"./chunk-AXYQJCCX.js";import{a as t}from"./chunk-5XCFNEYX.js";import{a as G}from"./chunk-GQL2MBZT.js";import{b as j}from"./chunk-EBIFNV2H.js";import"./chunk-MGGSCSBE.js";import"./chunk-Z6BYFM7E.js";import"./chunk-CFRDSUTM.js";import"./chunk-FB4M3WPV.js";import"./chunk-SLAWDKDA.js";import"./chunk-4N4D2YQX.js";import"./chunk-G4DZJMGT.js";import"./chunk-3VRDAJCX.js";import"./chunk-WTB3O6DJ.js";import"./chunk-7P44K2YD.js";import"./chunk-32OAXCA4.js";import"./chunk-UST6HCE7.js";import"./chunk-K5T5FD5C.js";import"./chunk-MVHHPJM7.js";import"./chunk-VDO6JJ3Y.js";import"./chunk-WFKZLI6F.js";import"./chunk-X2B63YVS.js";import"./chunk-BAEF3CT6.js";import"./chunk-AUAZP44J.js";import"./chunk-PVDFCTA4.js";import"./chunk-KNVXE32P.js";import"./chunk-76ATOSLU.js";import"./chunk-CCJU4DSH.js";import{a as I,c as K,j as x}from"./chunk-TG45K3WR.js";import"./chunk-RAI4DTMT.js";import{b as q}from"./chunk-ACP3S2CH.js";import"./chunk-HVAXZ2NA.js";import{a as H}from"./chunk-T7DXJKX7.js";import"./chunk-TYYVNQUR.js";import{a as l}from"./chunk-QGVBCWUY.js";import{H as U}from"./chunk-MYO4NP2N.js";import{e as c}from"./chunk-NFIPKH6V.js";import"./chunk-JPU2PQZC.js";import{l as y}from"./chunk-5QEXLALV.js";import"./chunk-P6QFA5MM.js";import"./chunk-DGTD7Y73.js";import"./chunk-LI2SX4T6.js";import"./chunk-BWO7LS2H.js";import"./chunk-HEVQSRJ2.js";import"./chunk-OVHPPCBL.js";import"./chunk-SNFOAZZQ.js";import"./chunk-AML4XSEF.js";import{K as z,y as O}from"./chunk-4PTIEWMT.js";import{a as B}from"./chunk-TG2UTNEO.js";import"./chunk-YOFFGXOB.js";import{b as P}from"./chunk-XRGPJ3QY.js";import"./chunk-6MRUJ2UW.js";import"./chunk-2LI2GKBQ.js";import{y as N}from"./chunk-QBWJMFH5.js";import{a as w,b as k,f as F}from"./chunk-VTHXE323.js";var f=class extends H.EventedMixin(Q){constructor(e){super(e)}get cursor(){return"crosshair"}onInputEvent(e){e.type==="click"&&this._handleClick(e)}_handleClick(e){this.emit("click",e)}};l([c({readOnly:!0})],f.prototype,"cursor",null),l([c({constructOnly:!0})],f.prototype,"stop",void 0),f=l([y("esri.widgets.Directions.DirectionsSearchTool")],f);var b=class extends U{constructor(){super(...arguments),this.layerDetails=!0,this.saveAsButton=!0,this.saveButton=!0}};l([c({type:Boolean,nonNullable:!0})],b.prototype,"layerDetails",void 0),l([c({type:Boolean,nonNullable:!0})],b.prototype,"saveAsButton",void 0),l([c({type:Boolean,nonNullable:!0})],b.prototype,"saveButton",void 0),b=l([y("esri.widgets.Directions.DirectionsVisibleElements")],b);var R=b;function te(e){let{branchName:i,displayText:r,exitName:o,intersectingName:n,name:p,towardName:h}=e;if(r==null)return null;let m=[i,o,n,p,h].filter(N).sort((g,M)=>M.length-g.length).map(g=>P(g));if(!m.length)return r;let u=new RegExp(m.join("|"),"g"),v=r.matchAll(u),_=0,S=[];for(let{0:g,index:M}of v)S.push(r.slice(_,M),t("span",{class:s.labelEmphasize,key:`maneuver-${M}`},g)),_=M+g.length;return S.push(r.slice(_)),t("span",null,S)}var a="esri-directions",s={base:a,accordion:`${a}__accordion`,actionContainer:`${a}__action-container`,addStopButton:`${a}__add-stop-button`,departureTime:`${a}__departure-time`,departureTimeOptions:`${a}__departure-time-options`,directionsHeader:`${a}__directions-header`,directionsHeaderStopName:`${a}__directions-header-stop-name`,editFooter:`${a}__edit-footer`,editToolbar:`${a}__edit-toolbar`,editToolbarContainer:`${a}__edit-toolbar-container`,flexColumn:`${a}__flex-column`,flexRow:`${a}__flex-row`,headerStops:`${a}__header-stops`,labelEmphasize:`${a}__label-emphasize`,labelNoBottomMargin:`${a}__label-no-bottom-margin`,marginInlineMedium:`${a}__margin-inline-medium`,optimizeSection:`${a}__optimize-section`,optimizeSwitches:`${a}__optimize-switches`,paddingMedium:`${a}__padding-medium`,primaryFlowItem:`${a}__primary-flow-item`,primaryFooter:`${a}__primary-footer`,primaryFooterCentered:`${a}__primary-footer-centered`,primaryFooterLoader:`${a}__primary-footer-loader`,routeItem:`${a}__route-item`,routeItemButton:`${a}__route-item-button`,routeItemButtonContent:`${a}__route-item-button-content`,routeItemLabel:`${a}__route-item-label`,routeItemDescription:`${a}__route-item-description`,saveError:`${a}__save-error`,saveErrorIcon:`${a}__save-error-icon`,saveErrorLabel:`${a}__save-error-label`,saveProcessLoader:`${a}__save-process-loader`,selectedFeatureContainer:`${a}__selected-feature-container`,separator:`${a}__separator`,solveRoute:`${a}__solve-route`,stopContainer:`${a}__stop-container`,stopList:`${a}__stop-list`,stopItem:`${a}__stop-item`},d=class extends G{constructor(e,i){super(e,i),this._activeManeuver=null,this._placeholderStops=new q([new T,new T]),this._portalFolderCombobox=null,this._portalFolders=null,this._portalItemNameInput=null,this._portalUserName=null,this._sections=null,this._stopsToSearches=new Map,this._currentFlowItem="primary",this._parentFlowItem="primary",this._saveState="initialized",this._searchTool=null,this.headingLevel=2,this.messages=null,this.messagesUnits=null,this.searchProperties=null,this.viewModel=new L,this.visibleElements=new R,this._solveRouteDebounced=z(()=>this._solveRoute())}initialize(){this.addHandles([I(()=>this.viewModel.layer,()=>{try{this.viewModel.load()}catch{}},x),I(()=>this.viewModel.layer?.routeInfo,()=>{this._sections=this._getStopSections()},x),I(()=>this.viewModel.layer?.stops.toArray(),e=>{e&&this.view?.activeTool&&this._searchTool&&this.view.activeTool===this._searchTool&&!e.includes(this._searchTool.stop)&&(this.view.tools.remove(this._searchTool),this._searchTool=null)})])}loadDependencies(){return j({accordion:()=>import("./chunk-RXJP33NW.js"),"accordion-item":()=>import("./chunk-VBK5XNI6.js"),action:()=>import("./chunk-X23M5IZ6.js"),"block-section":()=>import("./chunk-VJ6UDM3T.js"),button:()=>import("./chunk-K3RCADAN.js"),combobox:()=>import("./chunk-UQBNFKHV.js"),"combobox-item":()=>import("./chunk-L2XDWQVU.js"),dropdown:()=>import("./chunk-F6T2J7EG.js"),flow:()=>import("./chunk-5V3M627Q.js"),"flow-item":()=>import("./chunk-OQ4LXJHQ.js"),icon:()=>import("./chunk-7Z2RNQA3.js"),input:()=>import("./chunk-SS6GQCI6.js"),"input-date-picker":()=>import("./chunk-GYG7SVRX.js"),"input-time-picker":()=>import("./chunk-AJSVLQF4.js"),label:()=>import("./chunk-S24JESVO.js"),list:()=>import("./chunk-4MPCQ5DO.js"),"list-item":()=>import("./chunk-MRM6JRFU.js"),loader:()=>import("./chunk-4Z3TWS6O.js"),notice:()=>import("./chunk-PEKK3NZO.js"),panel:()=>import("./chunk-GS5FRZ5P.js"),switch:()=>import("./chunk-IIWK5IA5.js")})}get apiKey(){return this.viewModel.apiKey}set apiKey(e){this.viewModel.apiKey=e}get goToOverride(){return this.viewModel.goToOverride}set goToOverride(e){this.viewModel.goToOverride=e}get icon(){return"right"}set icon(e){this._overrideIfSome("icon",e)}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get lastRoute(){return this.viewModel.lastRoute}get layer(){return this.viewModel.layer}set layer(e){this.viewModel.layer=e}get maxStops(){return this.viewModel.maxStops}set maxStops(e){this.viewModel.maxStops=e}get unit(){return this.defaultUnit}set unit(e){this._overrideIfSome("unit",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}acquireSearch(e){let{view:i}=this.viewModel;if(this._stopsToSearches.has(e)){let o=this._stopsToSearches.get(e);return o.view=i,this._overrideDefaultSources(o),o}let r=new Z(w({icon:!1,popupEnabled:!1,resultGraphicEnabled:!1,view:i},this.searchProperties));return this._normalizeSearchSources(r),this.addHandles([K(()=>r.allSources,"change",()=>this._normalizeSearchSources(r)),r.on("search-clear",()=>{e.geometry=null,e.name=null,this.viewModel.layer?.removeResult()}),r.on("select-result",()=>{let o=r.selectedResult;e.geometry=o?.feature.geometry,e.name=o?.name,this._solveRouteDebounced()}),I(()=>r.searchTerm,o=>{e.name=o})],r),this._stopsToSearches.set(e,r),r}getDirections(){return this.viewModel.getDirections()}render(){return t("div",{class:this.classes(s.base,E.widget,E.panel)},t("calcite-flow",null,this._renderPrimaryFlowItem(),this._renderDirectionsFlowItem(),this._renderEditFlowItem(),this._renderSaveFlowItem()))}save(){return this.viewModel.save()}saveAs(e,i={}){return this.viewModel.saveAs(e,i)}zoomToRoute(){return this.viewModel.zoomToRoute()}_applyLocatorSourceOverrides({allSources:e}){for(let i of e)"url"in i&&i.url&&(i.locationType??="street",X(i.url)&&this.apiKey&&i.apiKey==null&&(i.apiKey=this.apiKey,i.url=Y))}_disposeSearch(e){if(!e||!this._stopsToSearches.has(e))return;let i=this._stopsToSearches.get(e);this.removeHandles(i),i.destroy(),this._stopsToSearches.delete(e)}_getEffectiveStops(){return this.viewModel.layer?.stops??this._placeholderStops}_getErrorDescription(){switch(this.viewModel.lastError?.name){case"directions-view-model:unable-to-route":return this.messages.errors.unableToRoute;case"directions-view-model:service-metadata-unavailable":return this.messages.errors.unableToLoadServiceMetadata;default:return this.messages.errors.unknownError}}_getNetworkFeatureName(e){switch(e.type){case"stop":switch(e.locationType){case"stop":default:return this.messages.networkFeatures.stops.stop;case"waypoint":return this.messages.networkFeatures.stops.waypoint;case"break":return this.messages.networkFeatures.stops.break}case"point-barrier":return this.messages.networkFeatures.pointBarrier;case"polyline-barrier":return this.messages.networkFeatures.polylineBarrier;case"polygon-barrier":return this.messages.networkFeatures.polygonBarrier}}_getRouteCostSummary(){let e=this.viewModel.layer?.routeInfo;if(!e)return null;let i=e.totalDistance??0,r=e.totalDuration??0,{messagesUnits:o,unit:n}=this;return{distance:$(o,i,n),duration:A(r)}}_getStopSections(){if(!this.viewModel.layer)return null;let{directionPoints:e,directionLines:i,stops:r}=this.viewModel.layer;if(!e||!i)return null;let o=[],n=null;for(let p of e){let{objectId:h,stopId:m}=p;if(m!=null){let v=r.find(({objectId:_})=>_===m);n&&n.stop===v||(n={stop:v,directions:[]},o.push(n));continue}if(n==null)continue;let u=i.find(({directionPointId:v})=>v===h);u!=null&&n.directions.push({directionPoint:p,directionLine:u})}return o}_handleLocateStopAction(e){let{view:i}=this;if(!i)return;let r="directions-search-tool";this.removeHandles(r),this._searchTool=new f({stop:e,view:i}),this.addHandles([this._searchTool.on("click",o=>F(this,null,function*(){if(o.mapPoint&&this._stopsToSearches.has(e)){let n=this._stopsToSearches.get(e),p=yield n.search(o.mapPoint),h=p?.results?.[0].results?.[0];if(h){let{feature:m,name:u}=h;n.searchTerm=u,e.geometry=m.geometry}}this.removeHandles(r)})),B(()=>{this._searchTool&&(this.view?.tools.remove(this._searchTool),this._searchTool=null)})],r),i.addAndActivateTool(this._searchTool)}_handleEditingDoneClick(){this.viewModel.stopEditing(),this._currentFlowItem="primary"}_handleSaveLayerAsAction(){return F(this,null,function*(){let e=W.getDefault();try{yield e.signIn()}catch(i){return O(i)||i.name==="identity-manager:user-aborted"?void 0:(this._parentFlowItem=this._currentFlowItem,this._currentFlowItem="save",void(this._saveState="connect-to-portal-error"))}this._saveState="fetch-portal-information",this._parentFlowItem=this._currentFlowItem,this._currentFlowItem="save",this._portalUserName=e.user?.username;try{this._portalFolders=yield e.user?.fetchFolders()}catch{return void(this._saveState="fetch-portal-information-error")}this._saveState="save-layer"})}_normalizeSearchSources(e){this._overrideDefaultSources(e),this._applyLocatorSourceOverrides(e)}_overrideDefaultSources(e){for(let i of e.viewModel.defaultSources)i.autoNavigate=!1}_renderClearRouteAction(e){return t("calcite-action",k(w({icon:"trash",key:"clear-route",onclick:()=>{this._currentFlowItem="primary",this.viewModel.reset()}},e),{text:this.messages.common.clear,textEnabled:!0}))}_renderDeleteStopAction(e){let i=this._getEffectiveStops();return t("calcite-action",{icon:"trash",onclick:()=>{i.remove(e),this._disposeSearch(e),this._solveRouteDebounced()},scale:"s",slot:"actions-end",text:this.messages.deleteStop,title:this.messages.deleteStop})}_renderDepartureTime(){let{DEPART_AT:e,NOW:i,UNSPECIFIED:r}=C;return t("calcite-label",{class:s.departureTime,key:"departure-time"},this.messages.departureTime,t("calcite-combobox",{clearDisabled:!0,label:this.messages.departureTime,overlayPositioning:"fixed",selectionMode:"single",onCalciteComboboxChange:({currentTarget:o})=>{let{selectedItems:n}=o;n.length&&(this.viewModel.departureOption=n[0].value,this._solveRouteDebounced())}},t("calcite-combobox-item",{heading:this.messages.leaveNow,key:i,label:this.messages.leaveNow,selected:this.viewModel.departureOption===i,value:i}),t("calcite-combobox-item",{heading:this.messages.departAt,key:e,label:this.messages.departAt,selected:this.viewModel.departureOption===e,value:e}),t("calcite-combobox-item",{heading:this.messages.timeUnspecified,key:r,label:this.messages.timeUnspecified,selected:this.viewModel.departureOption===r,value:r})))}_renderDepartureTimeOptions(){return this.viewModel.departureOption!==C.DEPART_AT?null:t("div",{class:s.departureTimeOptions},t("calcite-input-date-picker",{scale:"s",value:this.viewModel.departureIsoDate,onCalciteInputDatePickerChange:({currentTarget:{value:e}})=>{Array.isArray(e)||(this.viewModel.departureIsoDate=e,this._solveRouteDebounced())}}),t("calcite-input-time-picker",{scale:"s",value:this.viewModel.departureIsoTime,onCalciteInputTimePickerClose:({currentTarget:{value:e}})=>{this.viewModel.departureIsoTime=e,this._solveRouteDebounced()}}))}_renderDirectionsFlowItem(){if(this._currentFlowItem!=="directions")return null;let e=this._getRouteCostSummary();if(!this._sections||!e)return null;let{distance:i,duration:r}=e,{formattedEta:o}=this.viewModel,n=this._sections.at(0)?.stop.name??"",p=this._sections.at(-1)?.stop.name??"";return t("calcite-flow-item",{key:"directions-flow-item",overlayPositioning:"fixed",selected:this._currentFlowItem==="directions",onCalciteFlowItemBack:h=>{h.stopPropagation(),this._currentFlowItem="primary"}},t("div",{class:s.directionsHeader,slot:"header-content"},t("div",{class:s.headerStops},t("span",null,this.messages.from)," ",t("span",{class:s.directionsHeaderStopName},n),t("span",null,this.messages.to)," ",t("span",{class:s.directionsHeaderStopName},p)),t("div",{class:s.flexColumn},t("span",null,`${r} (${i})`),o?t("span",null,o):null)),this._renderRouteLayerActions({slot:"header-menu-actions"}),t("calcite-accordion",{class:s.accordion,iconPosition:"start",selectionMode:"single"},this._sections.map((h,m)=>{let{stop:u,directions:v}=h,{name:_}=u;return t("calcite-accordion-item",{expanded:m===0,heading:_??"",key:`stop-${m}`},t("calcite-action",{icon:"zoom-to-object",onclick:()=>{this.viewModel.centerAt(u)},slot:"actions-end",text:this.messages.panToStop}),this._renderDirectionTurns(v))})))}_renderDirectionTurns(e){return t("calcite-list",{label:this.messages.drivingDirections,selectionMode:"none"},e.map((i,r)=>{let{directionPoint:o,directionLine:n}=i,{distance:p,duration:h}=n,m=$(this.messagesUnits,p??0,this.unit),u=A(h??0),v=m&&u?`${m} | ${u}`:`${m||u}`,_=te(o),S=ee(o.directionPointType);return t("calcite-list-item",{class:s.labelNoBottomMargin,key:`driving-direction-${r}`,onpointerenter:()=>{this.viewModel.highlight(n)},onpointerleave:()=>{this.viewModel.clearHighlights()},onCalciteListItemSelect:()=>{this._activeManeuver===n?this.zoomToRoute():(this._activeManeuver=n,this.viewModel.centerAt(n.geometry))}},t("calcite-icon",{icon:S,slot:"content-start"}),t("div",{slot:"content"},t("calcite-label",{layout:"inline",scale:"s"},_),t("calcite-label",{layout:"inline",scale:"s"},v)))}))}_renderEditFlowItem(){return this._currentFlowItem!=="edit"?null:t("calcite-flow-item",{heading:this.messages.editRoute,headingLevel:this.headingLevel,key:"edit-flow-item",loading:this.viewModel.state==="routing",selected:this._currentFlowItem==="edit",onCalciteFlowItemBack:e=>{e.stopPropagation(),this.viewModel.stopEditing(),this._currentFlowItem="primary"}},t("div",{class:s.flexColumn,key:"edit-container"},t("div",{class:s.editToolbarContainer},t("calcite-label",{layout:"inline",scale:"s"},this.messages.automaticallySolve,t("calcite-switch",{checked:this.viewModel.autoSolve,scale:"s",onCalciteSwitchChange:e=>{this.viewModel.autoSolve=e.target.checked}})),t("div",{class:s.editToolbar},t("calcite-action",{icon:"flag",onclick:()=>{this.viewModel.create("stop")},scale:"s",text:this.messages.networkFeatures.stops.stop,textEnabled:!0}),t("calcite-action",{icon:"line",onclick:()=>{this.viewModel.create("polyline-barrier")},scale:"s",text:this.messages.barrier,textEnabled:!0}),t("calcite-action",{class:s.solveRoute,disabled:this.viewModel.autoSolve,icon:"refresh",onclick:()=>{this._solveRouteDebounced()},scale:"s",text:this.messages.solve,textEnabled:!0}))),t("div",{class:s.selectedFeatureContainer},t("calcite-list",{label:this.messages.selectedNetworkFeatures,scale:"s",selectionMode:"none"},this.viewModel.selectedNetworkFeatures?.toArray().map((e,i)=>t("calcite-list-item",{description:this._getNetworkFeatureName(e),key:`network-feature-${i}`,label:e.name??e.objectId?.toString()??this.messages.unnamed},t("calcite-action",{icon:"trash",onclick:()=>{this.viewModel.remove(e)},scale:"s",slot:"actions-end",text:this.messages.common.delete}))))),t("div",{class:s.editFooter},this._renderEditFooterContent())))}_renderEditFooterContent(){return this.viewModel.lastError?this._renderErrorNotice():t("calcite-button",{appearance:"outline-fill",bind:this,onclick:this._handleEditingDoneClick,width:"full"},this.messages.common.done)}_renderErrorNotice(){return t("calcite-notice",{icon:"exclamation-mark-circle",kind:"danger",open:!0},t("calcite-label",{class:s.labelNoBottomMargin,slot:"message"},this._getErrorDescription()))}_renderFooter(){if(!this.viewModel.layer)return t("div",{class:s.primaryFooter,key:"footer-missing-layer"},t("calcite-notice",{icon:"information",open:!0},t("calcite-label",{class:s.labelNoBottomMargin,slot:"message"},this.messages.missingLayer)));if(this.viewModel.state==="unauthenticated")return t("div",{class:s.primaryFooterCentered,key:"footer-sign-in"},t("calcite-label",null,this.messages.signInRequired),t("calcite-button",{onclick:()=>{this.viewModel.load().catch(()=>{})}},this.messages.common.auth.signIn));if(this.viewModel.state==="routing")return t("div",{class:this.classes(s.primaryFooter,s.primaryFooterLoader),key:"footer-routing"},t("calcite-loader",{label:this.messages.solve,scale:"s"}));if(this.viewModel.state==="error")return t("div",{class:s.primaryFooter,key:"footer-service-error"},this._renderErrorNotice());if(!this.viewModel.layer?.routeInfo)return t("div",{class:s.primaryFooter,key:"footer-unsolved-route"},t("calcite-notice",{icon:"information",open:!0},t("calcite-label",{class:s.labelNoBottomMargin,slot:"message"},this.messages.directionsPlaceholder)));let e=this._getRouteCostSummary();if(!e||!this.viewModel.layer?.directionPoints)return t("div",{class:s.primaryFooter,key:"footer-invalid-route"},t("calcite-notice",{icon:"exclamation-mark-triangle",kind:"danger",open:!0},t("calcite-label",{class:s.labelNoBottomMargin,slot:"message"},this.messages.invalidRoute)));let{distance:i,duration:r}=e,{formattedEta:o}=this.viewModel;return t("div",{class:s.routeItem,key:"footer-directions-summary"},t("button",{"aria-busy":"false","aria-label":this.messages.viewDrivingDirections,"aria-live":"polite",class:s.routeItemButton,onclick:()=>{this._currentFlowItem="directions"},type:"button"},t("div",{class:s.routeItemButtonContent},t("span",{class:s.routeItemLabel},`${r} (${i})`),t("span",{class:s.routeItemDescription},o)),t("calcite-icon",{flipRtl:!0,icon:"chevron-right",scale:"s"})),t("calcite-dropdown",null,t("calcite-action",{icon:"ellipsis",slot:"trigger",text:"Route actions"}),this._renderRouteLayerActions()))}_renderInteractiveRouteActions(){return t("div",{class:s.actionContainer,key:"interactive-route-action-container"},t("calcite-button",{appearance:"outline",class:s.addStopButton,disabled:this._getEffectiveStops().length>=this.maxStops,iconStart:"plus",kind:"neutral",label:this.messages.addStop,onclick:()=>{let e=new V;this.viewModel.layer?.stops.add(new T({symbol:e}))},width:"half"},this.messages.addStop),t("calcite-button",{appearance:"outline",disabled:this.viewModel.view?.type!=="2d",iconStart:"pencil",kind:"neutral",label:this.messages.editRoute,onclick:()=>{this._currentFlowItem="edit",this.viewModel.startEditing()},width:"half"},this.messages.editRoute))}_renderLocateStopAction(e){if(e.name!=null||e.geometry!=null)return null;let i=this._getEffectiveStops().indexOf(e),r=!!this.view?.activeTool&&this.view.activeTool===this._searchTool&&this._searchTool.stop===e;return t("calcite-action",{active:r,icon:"crosshair",key:`stop-location-action-${i}`,onclick:()=>this._handleLocateStopAction(e),scale:"s",slot:"actions-end",text:this.messages.pickALocationOnTheMap,title:this.messages.pickALocationOnTheMap})}_renderOptimizeStopOrder(){let{routeParameters:e}=this.viewModel,{findBestSequence:i,preserveFirstStop:r,preserveLastStop:o}=e;return t("calcite-block-section",{class:s.optimizeSection,text:this.messages.optimizeOrder,toggleDisplay:"switch",onCalciteBlockSectionToggle:({target:n})=>{e.findBestSequence=n.open,n.open||this._resetStopSequence(),this._solveRouteDebounced()}},i?[t("calcite-label",{class:s.optimizeSwitches,key:"preserve-first-stop",layout:"inline-space-between"},this.messages.preserveFirstStop,t("calcite-switch",{checked:r,scale:"s",onCalciteSwitchChange:({target:{checked:n}})=>{e.preserveFirstStop=n,this._resetStopSequence(),this._solveRouteDebounced()}})),t("calcite-label",{class:s.optimizeSwitches,key:"preserve-last-stop",layout:"inline-space-between"},this.messages.preserveLastStop,t("calcite-switch",{checked:o,scale:"s",onCalciteSwitchChange:({target:{checked:n}})=>{e.preserveLastStop=n,this._resetStopSequence(),this._solveRouteDebounced()}}))]:null)}_renderPrimaryFlowItem(){return t("calcite-flow-item",{key:"primary-flow-item",loading:this.viewModel.state==="initializing",selected:this._currentFlowItem==="primary"},t("calcite-panel",{class:s.primaryFlowItem,disabled:!this.viewModel.layer||this.viewModel.state==="unauthenticated"||this.viewModel.state==="error"&&!this.viewModel.serviceDescription},this._renderStops(),this._renderInteractiveRouteActions(),this._renderSeparator(),this._renderRouteSolveOptions()),this._renderFooter())}_renderRouteLayerActions(e){return[this._renderClearRouteAction(e),this._renderSaveLayerAction(e),this._renderSaveLayerAsAction(e),this._renderViewItemDetailsAction(e)]}_renderRouteSolveOptions(){return t("div",{class:s.marginInlineMedium,key:"route-solve-options"},this._renderTravelModes(),this._renderDepartureTime(),this._renderDepartureTimeOptions(),this._renderOptimizeStopOrder())}_renderSaveContent(){switch(this._saveState){case"initialized":return this._renderSaveInitialized();case"connect-to-portal":return this._renderSaveProcessing(this.messages.identity.lblSigning);case"connect-to-portal-error":return this._renderSaveError(this.messages.errors.authenticating);case"fetch-portal-information":return this._renderSaveProcessing(this.messages.processing.fetching);case"fetch-portal-information-error":return this._renderSaveError(this.messages.errors.fetching);case"save-layer":return this._renderSaveLayerSettings();case"saving":return this._renderSaveProcessing(this.messages.processing.saving);case"saving-error":return this._renderSaveError(this.messages.errors.saving)}}_renderSaveError(e){return t("calcite-panel",{class:s.paddingMedium,key:"save-layer-error"},t("div",{class:s.saveError},t("calcite-icon",{class:s.saveErrorIcon,icon:"exclamation-mark-triangle",scale:"l",textLabel:this.messages.common.errorMessage}),t("calcite-label",{class:s.saveErrorLabel},e)),t("calcite-button",{appearance:"outline",onclick:()=>{this._currentFlowItem=this._parentFlowItem},slot:"footer-actions",width:"full"},this.messages.common.close))}_renderSaveInitialized(){return t("calcite-panel",{class:s.paddingMedium,key:"save-layer-initialized"})}_renderSaveFlowItem(){return this._currentFlowItem!=="save"?null:t("calcite-flow-item",{heading:this.messages.saveLayer,headingLevel:this.headingLevel,key:"save-layer-flow-item",selected:this._currentFlowItem==="save",onCalciteFlowItemBack:e=>{e.stopPropagation(),this._currentFlowItem=this._parentFlowItem}},this._renderSaveContent())}_renderSaveLayerAction(e){if(!this.visibleElements.saveButton)return null;let i=this.viewModel.layer,r=i?.routeInfo,o=i?.portalItem?.itemControl;return t("calcite-action",k(w({disabled:!(r&&(o==="admin"||o==="update")),icon:"save",key:"save-route",onclick:()=>{this.viewModel.layer?.save()}},e),{text:this.messages.common.save,textEnabled:!0}))}_renderSaveLayerAsAction(e){if(!this.visibleElements.saveAsButton)return null;let i=!this.viewModel.layer?.routeInfo;return t("calcite-action",k(w({disabled:i,icon:"save-as",key:"save-as-route",onclick:()=>{this._handleSaveLayerAsAction()}},e),{text:this.messages.common.saveAs,textEnabled:!0}))}_renderSaveLayerSettings(){if(this.layer==null||this._portalFolders==null||this._portalUserName==null)return this._renderSaveInitialized();let{stops:e}=this.layer,i=`${e.at(0).name} - ${e.at(-1).name}`,r=[t("calcite-combobox-item",{heading:`${this._portalUserName} (${this.messages.common.home})`,key:`${a}-folder-home`,selected:!0,value:`${a}-folder-home`}),...this._portalFolders.map(o=>t("calcite-combobox-item",{heading:o.title??"",key:`${a}-folder-${o.id}`,value:o.id}))];return t("calcite-panel",{key:"save-layer-panel"},t("div",{class:s.paddingMedium},t("calcite-label",null,this.messages.laverName,t("calcite-input",{afterCreate:o=>{this._portalItemNameInput=o},label:this.messages.laverName,value:i})),t("calcite-label",null,this.messages.saveInFolder,t("calcite-combobox",{afterCreate:o=>{this._portalFolderCombobox=o},clearDisabled:!0,label:this.messages.saveInFolder,overlayPositioning:"fixed",selectionMode:"single"},r))),t("calcite-button",{onclick:()=>{if(this._saveState="saving",this.layer==null||this._portalFolders==null)return;let o=this._portalItemNameInput?.value,n=this._portalFolderCombobox?.value,p=this._portalFolders.find(({id:h})=>h===n);this.layer.saveAs({title:o},{folder:p}).then(()=>{this._currentFlowItem=this._parentFlowItem}).catch(()=>{this._saveState="saving-error"})},slot:"footer-actions",width:"full"},this.messages.common.save),t("calcite-button",{appearance:"outline",onclick:()=>{this._currentFlowItem=this._parentFlowItem},slot:"footer-actions",width:"full"},this.messages.common.cancel))}_renderSaveProcessing(e){return t("calcite-panel",{class:s.marginInlineMedium,key:"save-layer-processing"},t("calcite-loader",{class:s.saveProcessLoader,label:e,text:e}))}_renderSeparator(){return t("div",{class:s.separator})}_renderStop(e){let i=this.acquireSearch(e);e.name!=null&&(i.searchTerm=e.name);let r=this._getEffectiveStops(),o=this._renderLocateStopAction(e),n=r.length>2&&this._renderDeleteStopAction(e);return t("calcite-list-item",{key:e,value:e},o,n,t("div",{class:s.stopItem,slot:"content"},i.render()))}_renderStops(){let e=this._getEffectiveStops();for(let i of this._stopsToSearches.keys())e.includes(i)||this._disposeSearch(i);return t("div",{class:s.stopContainer,key:s.stopContainer},t("calcite-list",{class:s.stopList,dragEnabled:!0,label:this.messages.widgetLabel,scale:"s",onCalciteListOrderChange:({detail:i})=>{e.reorder(i.dragEl.value,i.newIndex),this._resetStopSequence(),this._solveRouteDebounced()}},e.toArray().map(i=>this._renderStop(i))),e.length===2&&t("calcite-action",{icon:"arrow-up-down",onclick:()=>{e.reverse(),this._resetStopSequence(),this._solveRouteDebounced()},scale:"s",text:this.messages.reverseStops}))}_renderTravelModes(){return this.viewModel.travelModes.length?t("calcite-label",{key:"travel-modes"},this.messages.mode,t("calcite-combobox",{clearDisabled:!0,label:this.messages.mode,overlayPositioning:"fixed",selectionMode:"single",onCalciteComboboxChange:({currentTarget:e})=>{let{selectedItems:i}=e;i.length&&(this.viewModel.selectedTravelMode=i[0].value,this._solveRouteDebounced())}},this.viewModel.travelModes.map(e=>t("calcite-combobox-item",{heading:e.name,key:e.id,label:e.name,selected:this.viewModel.selectedTravelMode?.id===e.id,value:e})))):null}_renderViewItemDetailsAction(e){if(!this.visibleElements.layerDetails)return null;let i=this.viewModel.layer?.portalItem;return t("calcite-action",k(w({disabled:!i,icon:"launch",key:"open-route-details-link",onclick:()=>{i&&window.open(`${i.portal.url}/home/item.html?id=${i.id}`,"_blank")}},e),{text:this.messages.viewLayerDetails,textEnabled:!0}))}_resetStopSequence(){this.viewModel.layer?.stops.forEach(e=>{e.sequence=null})}_solveRoute(){return F(this,null,function*(){if(this.viewModel.updateDepartureTime(),!((this.viewModel.layer?.stops.filter(({geometry:e})=>!!e).length??0)<2))try{yield this.viewModel.getDirections()}catch{}})}};l([c()],d.prototype,"_currentFlowItem",void 0),l([c()],d.prototype,"_saveState",void 0),l([c()],d.prototype,"_searchTool",void 0),l([c()],d.prototype,"apiKey",null),l([c(J)],d.prototype,"defaultUnit",void 0),l([c()],d.prototype,"goToOverride",null),l([c()],d.prototype,"headingLevel",void 0),l([c()],d.prototype,"icon",null),l([c()],d.prototype,"label",null),l([c({readOnly:!0})],d.prototype,"lastRoute",null),l([c()],d.prototype,"layer",null),l([c()],d.prototype,"maxStops",null),l([c(),D("esri/widgets/Directions/t9n/Directions")],d.prototype,"messages",void 0),l([c(),D("esri/core/t9n/Units")],d.prototype,"messagesUnits",void 0),l([c()],d.prototype,"searchProperties",void 0),l([c()],d.prototype,"unit",null),l([c()],d.prototype,"view",null),l([c({type:L})],d.prototype,"viewModel",void 0),l([c({type:R,nonNullable:!0})],d.prototype,"visibleElements",void 0),d=l([y("esri.widgets.Directions")],d);var We=d;export{We as default};
