import{a as k}from"./chunk-DVZ4Z4F3.js";import{q as b,r as f,s as g,t as R,u as S}from"./chunk-PKVI3POI.js";import{a as x}from"./chunk-NYVW6BKJ.js";import{a as E}from"./chunk-JQAW4OB5.js";import{za as I}from"./chunk-KALOJIUA.js";import{a as F}from"./chunk-GHKL3NOH.js";import{m as U}from"./chunk-FB4M3WPV.js";import{b as h}from"./chunk-ACP3S2CH.js";import{a as o}from"./chunk-QGVBCWUY.js";import{B as P}from"./chunk-MYO4NP2N.js";import{e as a}from"./chunk-NFIPKH6V.js";import{l as T}from"./chunk-5QEXLALV.js";import{a as w,f as c}from"./chunk-VTHXE323.js";function M(e){let t=/{[^{]+?}/g,l=[...e.matchAll(t)],p=0,s=[],r=[];for(let n of l){let d=n[0];s.push(e.slice(p,n.index)),r.push(d),p=n.index+d.length}return s.push(e.slice(p)),{literals:s,templates:r}}function $(e,t){return t.reduce((l,p,s)=>l.concat(e.at(s),p),"").concat(e.at(-1))}var _,v=["blockquote","html","hr","checkbox","table","tablerow","tablecell","image"];function z(e){return c(this,null,function*(){return _||(yield H()),_.parse(e)})}function H(){return c(this,null,function*(){let{Marked:e}=yield import("./chunk-DDACBEKH.js"),t=function({text:r}){return`<span style="text-decoration:line-through;">${r}</span>`},l=function({href:r,text:n,title:d}){return`<a${r!=null?` href="${r}"`:""}${d!=null?` title="${d}"`:""} target="_blank">${n??""}</a>`},p=()=>"",s={};for(let r of v)s[r]=p;_=new e({renderer:w({del:t,link:l},s)})})}var i=class extends k{constructor(e){super(e),this.group=null,this.id=`TextElementInput-${P()}`,this.type="text",this._expressionReferences=new F,this._expressionsUsed=new x,this._fieldsUsed=new x,this._literalParts=new h,this._templateParts=new h,this._updatingHandles=new E}initialize(){let{rawText:e}=this;e?this.textFormat==="markdown"?this._updatingHandles.addPromise(z(e).then(t=>this._initializeTextParts(t))):this._initializeTextParts(e):this._literalParts.push("")}get expressionsUsed(){return Array.from(this._expressionsUsed)}get fieldsIndex(){return this.layer.fieldsIndex}set fieldsIndex(e){this._overrideIfSome("fieldsIndex",e)}get fieldsUsed(){return Array.from(this._fieldsUsed)}get rawText(){return this.element.text}get text(){let e=this._templateParts.map(t=>`${this._expressionReferences.get(t)?.lastEvaluatedValue??""}`);return U.sanitize($(this._literalParts,e))}get textFormat(){return this.element.textFormat}get updating(){return this._updatingHandles.updating||Array.from(this._expressionReferences.values()).some(e=>e?.updating)}setExpressionExecutor(e,t){this._expressionReferences.set(f(e),t)}setFieldExecutor(e,t){this._expressionReferences.set(g(e),t)}_initializeTextParts(e){let{fieldsIndex:t}=this,{literals:l,templates:p}=M(e),s=[],r=[];for(let n=0;n<p.length;n++){let d=l[n],m=I(p[n])[0];if(R(m))this._expressionsUsed.add(b(m)),this._expressionReferences.set(m,null),s.push(d),r.push(m);else if(S(m)){this._expressionsUsed.add(m);let u=f(m);this._expressionReferences.set(u,null),s.push(d),r.push(u)}else if(t?.has(m)){let u=t.normalizeFieldName(m);this._fieldsUsed.add(u);let y=g(u);this._expressionReferences.set(y,null),s.push(d),r.push(y)}else l[n+1]=d.concat(m,l[n+1])}s.push(l.at(-1)),this._literalParts.addMany(s),this._templateParts.addMany(r)}};o([a()],i.prototype,"expressionsUsed",null),o([a()],i.prototype,"fieldsIndex",null),o([a()],i.prototype,"fieldsUsed",null),o([a()],i.prototype,"group",void 0),o([a()],i.prototype,"id",void 0),o([a()],i.prototype,"rawText",null),o([a()],i.prototype,"text",null),o([a()],i.prototype,"textFormat",null),o([a()],i.prototype,"type",void 0),o([a()],i.prototype,"updating",null),i=o([T("esri.widgets.FeatureForm.TextElementInput")],i);var se=i;export{se as a};
