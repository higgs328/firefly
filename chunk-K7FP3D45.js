import{a as I}from"./chunk-X7RYWL2M.js";import{a as H}from"./chunk-YEGIAUQF.js";import{c as P}from"./chunk-IAG3AFVL.js";import{b as L}from"./chunk-5BRKCXYS.js";import{a as O,d as v}from"./chunk-CZMBPC27.js";import{h as x}from"./chunk-63B3IOWG.js";import{a as k}from"./chunk-EM35R6FY.js";import{l as D}from"./chunk-HM5RIVQC.js";import{a as E}from"./chunk-DEH76MSI.js";import{b as W}from"./chunk-QXXXCEV5.js";import{a as y,b as F,j as m}from"./chunk-TG45K3WR.js";import{d as S}from"./chunk-BWO7LS2H.js";import{c as q,l}from"./chunk-4PTIEWMT.js";import{b as C}from"./chunk-YOFFGXOB.js";import{g as A}from"./chunk-XRGPJ3QY.js";import{a as T,b}from"./chunk-VTHXE323.js";var j=[1,1],p=E(),N={none:x.None,loop:x.Loop,oscillate:x.Oscillate};function U(n){return n?b(T({type:"CIMAnimatedSymbolProperties"},n),{playAnimation:n.playing,repeatType:n.repeatType?N[n.repeatType]:void 0}):{type:"CIMAnimatedSymbolProperties"}}var z=class extends H{constructor(r){super(),this.elementView=r,this.isWrapAround=!1,this.wrapAroundShift=0,this.perspectiveTransform=k(),this._handles=new S,this._vertices=new Float32Array(8),this._indices=new Uint16Array([0,0,0,1,1,0,1,1,1,1,0,0,0,0,0,1,1,0,1,1]),this._handles.add([y(()=>this.elementView.element.opacity,t=>this.opacity=t,m),y(()=>[this.elementView.coords],()=>{this.requestRender()},m),y(()=>["animationOptions"in this.elementView.element&&this.elementView.element.animationOptions],()=>{this._handles.remove("play"),this.texture=q(this.texture),this.requestRender()},m),F(()=>this.elementView.element.loaded,()=>{let t=this.elementView.element;this.ready(),P(t)&&t.content!=null&&(this._handles.add([l(t.content,"play",()=>this.requestRender()),l(t.content,"loadeddata",()=>this.requestRender()),l(t.content,"loaded",()=>this.requestRender())]),"requestVideoFrameCallback"in t.content?t.content.requestVideoFrameCallback(()=>this.requestRender()):this._handles.add([l(t.content,"seeked",()=>this.requestRender())]),this.requestRender())},m)]),r.element.load().catch(t=>{A.getLogger("esri.views.2d.layers.MediaLayerView2D").error(new C("element-load-error","Element cannot be displayed",{element:r,error:t}))})}getMesh(r){throw new Error("Method not implemented.")}destroy(){this._handles.destroy(),this.texture=q(this.texture)}get textureSize(){return j}get dvsMat3(){return this.parent.dvsMat3}beforeRender(r){let{context:t}=r,e=this.elementView.element.content;if(e!=null){let o=e instanceof HTMLImageElement,s=e instanceof HTMLVideoElement,a=o?e.naturalWidth:s?e.videoWidth:e.width,d=o?e.naturalHeight:s?e.videoHeight:e.height;if(this._updatePerspectiveTransform(a,d),this.texture)s&&(this.texture.setData(e),this.texture.generateMipmap(),"requestVideoFrameCallback"in e?e.requestVideoFrameCallback(()=>this.requestRender()):e.paused||this.requestRender());else{let i=new O;if(i.wrapMode=D.CLAMP_TO_EDGE,i.preMultiplyAlpha=!0,i.width=a,i.height=d,"getFrame"in e){let u=h=>{this.texture?this.texture.setData(h):this.texture=new v(t,i,h),this.requestRender()};"animationOptions"in this.elementView.element&&this._handles.add(I(e,U(this.elementView.element.animationOptions),null,u),"play")}else this.texture=new v(t,i,e);this.texture.generateMipmap(),s&&("requestVideoFrameCallback"in e?e.requestVideoFrameCallback(()=>this.requestRender()):e.paused||this.requestRender())}}super.beforeRender(r)}_createTransforms(){return null}draw(r,t){this.isReady&&this.texture!=null?t.render(r,{transform:{dvs:this.dvsMat3},config:{perspective:this.perspectiveTransform,texSize:j,wrapAroundShift:this.wrapAroundShift,isWrapAround:this.isWrapAround,opacity:this.opacity,texture:{texture:this.texture,unit:0}},position:this._vertices,tex:this._indices}):this.requestRender()}updateDrawCoords(r,t,e,o){let{coords:s,bounds:a}=this.elementView;if(s==null||a==null)return;let[d,i,u,h]=s.rings[0],B=this._vertices,{x:c,y:f}=r;B.set([i[0]-c,i[1]-f,d[0]-c,d[1]-f,u[0]-c,u[1]-f,h[0]-c,h[1]-f]);let w=t;if(o){let[g,,V]=a,{worldWidth:R,xBounds:G}=o,[_,M]=G;g<_&&V>_?w=R:V>M&&g<M&&(w=-R)}this.wrapAroundShift=w,this.isWrapAround=w!==0}_updatePerspectiveTransform(r,t){let e=this._vertices;L(p,[0,0,r,0,0,t,r,t],[e[0],e[1],e[4],e[5],e[2],e[3],e[6],e[7]]),W(this.perspectiveTransform,p[6]/p[8]*r,p[7]/p[8]*t)}};export{z as a};
