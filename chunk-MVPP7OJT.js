import{a as L}from"./chunk-ILCIL5AS.js";import"./chunk-FPCHE4I2.js";import{a as y,b as x}from"./chunk-PT2T74VZ.js";import"./chunk-VEL25CVB.js";import{a as d}from"./chunk-OBYF3P4E.js";import{a as h}from"./chunk-FHBFWDFD.js";import"./chunk-M3OAU7W5.js";import"./chunk-CSSRRM4C.js";import"./chunk-RVXDLN3U.js";import"./chunk-TUF2Y2FX.js";import"./chunk-YZJDOXQC.js";import"./chunk-3JGYBNJA.js";import"./chunk-MIS6QMFE.js";import"./chunk-CELWVZPW.js";import"./chunk-DYTVXYAV.js";import"./chunk-EQZWYK27.js";import"./chunk-PEW2PLAN.js";import"./chunk-CX5IFQZJ.js";import{a as T}from"./chunk-AXYQJCCX.js";import{a as l}from"./chunk-5XCFNEYX.js";import{a as F}from"./chunk-GQL2MBZT.js";import"./chunk-EBIFNV2H.js";import"./chunk-MGGSCSBE.js";import"./chunk-Z6BYFM7E.js";import"./chunk-CFRDSUTM.js";import{g as w,j as b}from"./chunk-FB4M3WPV.js";import"./chunk-SLAWDKDA.js";import"./chunk-4N4D2YQX.js";import"./chunk-G4DZJMGT.js";import"./chunk-3VRDAJCX.js";import"./chunk-WTB3O6DJ.js";import{a as I}from"./chunk-7P44K2YD.js";import"./chunk-32OAXCA4.js";import"./chunk-UST6HCE7.js";import"./chunk-K5T5FD5C.js";import"./chunk-MVHHPJM7.js";import"./chunk-VDO6JJ3Y.js";import"./chunk-WFKZLI6F.js";import"./chunk-X2B63YVS.js";import"./chunk-BAEF3CT6.js";import"./chunk-AUAZP44J.js";import"./chunk-PVDFCTA4.js";import"./chunk-KNVXE32P.js";import"./chunk-76ATOSLU.js";import"./chunk-CCJU4DSH.js";import{a as N}from"./chunk-TG45K3WR.js";import"./chunk-RAI4DTMT.js";import"./chunk-ACP3S2CH.js";import"./chunk-HVAXZ2NA.js";import"./chunk-T7DXJKX7.js";import"./chunk-TYYVNQUR.js";import{a as m}from"./chunk-QGVBCWUY.js";import"./chunk-MYO4NP2N.js";import{e as f}from"./chunk-NFIPKH6V.js";import"./chunk-JPU2PQZC.js";import{l as B}from"./chunk-5QEXLALV.js";import"./chunk-P6QFA5MM.js";import"./chunk-DGTD7Y73.js";import"./chunk-LI2SX4T6.js";import"./chunk-BWO7LS2H.js";import"./chunk-HEVQSRJ2.js";import"./chunk-OVHPPCBL.js";import"./chunk-SNFOAZZQ.js";import"./chunk-AML4XSEF.js";import"./chunk-4PTIEWMT.js";import"./chunk-TG2UTNEO.js";import"./chunk-YOFFGXOB.js";import"./chunk-XRGPJ3QY.js";import"./chunk-6MRUJ2UW.js";import"./chunk-2LI2GKBQ.js";import"./chunk-QBWJMFH5.js";import"./chunk-VTHXE323.js";var u="esri-floor-filter",M=`${u}__filter-menu`,n={floorFilter:u,floorFilterLayout:`${u}__layout--`,floorFilterPosition:`${u}__position--`,buttonContainer:`${u}__button-container`,buttonContainerLevels:`${u}__button-container--levels`,buttonInfo:`${u}__button-info`,buttonLabel:`${u}__button-label`,browseButton:`${u}__browse-button`,closeLevelsButton:`${u}__close-levels-button`,zoomButton:`${u}__zoom-button`,zoomButtonLevels:`${u}__zoom-button--levels`,minimizeToggleButton:`${u}__minimize-toggle-button`,levelsContainer:`${u}__levels-container`,levelButton:`${u}__level-button`,levelButtonActive:`${u}__level-button--active`,iconFlip:"esri-collapse__icon-flip",separator:`${u}__separator`,filterMenu:M,filterMenuHeader:`${M}-header`,filterMenuHeaderTextGroup:`${M}-header-text-group`,filterMenuHeaderText:`${M}-header-text`,filterMenuHeaderSubtext:`${M}-header-subtext`,filterMenuHeaderBack:`${M}-header-back`,filterMenuSearch:`${M}-search`,filterMenuSearchInput:`${M}-search-input`,filterMenuItems:`${M}-items`,filterMenuItemName:`${M}-item-name`,filterMenuSelectedItem:`${M}-item-name--selected`,filterMenuSite:`${M}-site`,filterMenuFacility:`${M}-facility`,selectedItemCircle:`${u}__selected-item-circle`};var C=new Set(["ArrowUp","ArrowDown","End","Home"]),v=class extends F{constructor(e,t){super(e,t),this._activeMenu=null,this._activeMenuIndex={levels:-1,menuItems:-1},this._baseNode=null,this._facilitiesListNode=null,this._levelsListNode=null,this._sitesListNode=null,this._searchInput=null,this.viewModel=new L,this.messages=null,this.messagesCommon=null,this.headingLevel=2,this._resizeObserver=new ResizeObserver(()=>this.scheduleRender()),this.addHandles(N(()=>this._searchInput,()=>this._focusSearch()))}destroy(){this._resizeObserver?.disconnect()}get enabled(){return this.viewModel.enabled}set enabled(e){this.viewModel.enabled=e}get longNames(){return this.viewModel.longNames}set longNames(e){this.viewModel.longNames=e}get minimized(){return this.viewModel.minimized}set minimized(e){this.viewModel.minimized=e}get pinnedLevels(){return this.viewModel.pinnedLevels}set pinnedLevels(e){this.viewModel.pinnedLevels=e}get site(){return this.viewModel.site}set site(e){this.viewModel.site=e}get facility(){return this.viewModel.facility}set facility(e){this.viewModel.facility=e}get level(){return this.viewModel.level}set level(e){this.viewModel.level=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}get goToOverride(){return this.viewModel.goToOverride}set goToOverride(e){this.viewModel.goToOverride=e}get icon(){return"floor-plan"}set icon(e){this._overrideIfSome("icon",e)}updateWebDocument(e){return this.viewModel.updateWebDocument(e)}render(){let{longNames:e}=this,t=e&&this.viewModel.isNormalMode?"expanded":"collapsed",i=this._renderButtons(),o=this._renderFilterMenu(),s=l("div",{class:this.classes(n.separator)}),a=this._getComponentPosition(),r=this._getPosition(a),c=a==="top-right"||a==="bottom-right",_=a==="top-left"||a==="bottom-left",g=w(this.container),p=g&&_||!g&&c?o:i,k=g&&_||!g&&c?i:o;return l("div",{afterCreate:this._afterBaseNodeCreate,class:this.classes(n.floorFilter,h.widget,`${n.floorFilterLayout}${t}`,`${n.floorFilterPosition}${r}`),key:"floor-filter-menu"},p,this.viewModel?.filterMenuOpen?s:null,k)}_renderButtons(){let e=this._getComponentPosition(),t=[];return this._getPosition(e)==="top"?(t.push(this._renderBrowseButton()),t.push(this._renderLevelButtons()),t.push(this._renderCloseLevelsButton()),t.push(this._renderZoomButton()),t.push(this._renderCollapseToggleButton())):(t.push(this._renderCollapseToggleButton()),t.push(this._renderZoomButton()),t.push(this._renderCloseLevelsButton()),t.push(this._renderLevelButtons()),t.push(this._renderBrowseButton())),l("div",{class:this.classes(h.widget,n.buttonContainer),key:"button-container"},t)}_renderBrowseButton(){let{longNames:e,messages:t}=this;return l("button",{"aria-expanded":this.viewModel.filterMenuOpen.toString(),"aria-label":t.buttons.browse,bind:this,class:this.classes(h.widget,h.widgetButton,h.interactive,(this.viewModel.state==="loading"||this.viewModel.state==="disabled")&&h.buttonDisabled,n.browseButton,this.viewModel?.filterMenuOpen&&h.widgetButtonActive),key:"browse-button",onclick:this._toggleFilterMenu,title:t.buttons.browse,type:"button"},l("div",{class:this.classes(n.buttonInfo)},l("span",{class:this.classes(d.icon,d.urbanModel)}),l("span",{class:this.classes(n.buttonLabel)},e&&this.viewModel.isNormalMode?t.buttons.browse:null)))}_renderLevelButtons(){if(!this.viewModel?.filterFeatures?.levels?.levelsInfo||!this.facility)return null;let{facility:e,messagesCommon:t,messages:i}=this,o=this.viewModel?.getFacility(e),s=this.viewModel?.getFacilityLevels(e),a=s.map(c=>this._renderLevelButton(c));if(!a.length)return null;let r=o&&I(i.selector.levelsLabel,{name:`"${o.name}"`});if(this._isWebScene(this.view?.map)&&a?.length>1){let c={id:`all--${e}`,facilityId:e,shortName:t.all,longName:t.all,levelNumber:null,verticalOrder:null},_=this._renderLevelButton(c);a.push(_)}return l("ul",{afterCreate:b,"aria-label":r,bind:this,class:this.classes(n.levelsContainer),"data-id":"levels","data-node-ref":"_levelsListNode",key:"levels-button-container",onkeydown:this._handleListKeydown},a)}_renderLevelButton(e){let{longNames:t}=this,{shortName:i,longName:o,id:s}=e,a=`levels--${s}`,r=this.level===s,c=t&&this.viewModel.isNormalMode?o:i;return this.viewModel.isNormalMode||r||this.viewModel.levelsExpanded?l("li",{key:a},l("button",{bind:this,class:this.classes(h.widgetButton,r?h.widgetButtonActive:null,h.interactive,n.levelButton),"data-id":s,"data-list-id":"levels",onclick:this._levelSelected,onfocus:this._onItemFocus,type:"button"},c)):null}_renderCloseLevelsButton(){if(!this.level||this.viewModel.isNormalMode||!this.viewModel.levelsExpanded)return null;let{messagesCommon:e}=this;return l("button",{"aria-label":e.close,bind:this,class:this.classes(h.widget,h.widgetButton,h.interactive,n.closeLevelsButton),key:"close-levels-button",onclick:this._closeLevels,title:e.close,type:"button"},l("div",{class:this.classes(n.buttonInfo)},l("span",{class:this.classes(d.icon,d.close)})))}_renderZoomButton(){let{longNames:e,messages:t,facility:i,site:o}=this,s=this.viewModel?.filterMenuType,a=this.viewModel?.filterMenuOpen,r=this.viewModel?.getSite(o),c=this.viewModel?.getFacility(i),_=s==="site"&&a?!r:!c;return l("button",{"aria-label":t.buttons.zoomTo,bind:this,class:this.classes(h.widget,h.widgetButton,_&&h.buttonDisabled,h.interactive,this.viewModel?.getFacilityLevels(i).length>0?n.zoomButtonLevels:n.zoomButton),key:"zoom-button",onclick:this._zoomToClicked,title:t.buttons.zoomTo,type:"button"},l("div",{class:this.classes(n.buttonInfo)},l("span",{class:this.classes(d.icon,d.zoomToObject)}),l("span",{class:this.classes(n.buttonLabel)},e&&this.viewModel.isNormalMode?t.buttons.zoomTo:null)))}_renderCollapseToggleButton(){let{longNames:e,messagesCommon:t}=this,i=e?d.collapse:d.expand,o=this.classes(d.icon,i,n.iconFlip),s=e?t.collapse:t.expand;return l("button",{"aria-label":s,bind:this,class:this.classes(h.widget,h.widgetButton,h.interactive,n.minimizeToggleButton),key:"minimize-toggle-button",onclick:this._toggleCollapsed,title:s,type:"button"},l("div",{class:this.classes(n.buttonInfo)},l("span",{class:o}),l("span",{class:this.classes(n.buttonLabel)},e&&this.viewModel.isNormalMode?t.collapse:null)))}_renderFilterMenu(){return this.viewModel?.filterMenuOpen?this.viewModel?.filterMenuType==="site"?this._renderSiteFilterMenu():this.viewModel?.filterMenuType==="facility"?this._renderFacilityFilterMenu():null:null}_renderSiteFilterMenu(){let{messages:e,messagesCommon:t}=this,i=this.site?this.viewModel?.getSite(this.site)?.name:e.selector.selectSite,o=l("div",{class:this.classes(`${n.filterMenuHeader}`),key:"filter-menu-site-header"},l("div",{class:this.classes(n.filterMenuHeaderTextGroup)},l(y,{class:this.classes(n.filterMenuHeaderText),level:this.headingLevel},i)),l("button",{bind:this,class:this.classes(d.icon,d.close),onclick:this._closeClicked,title:t.close,type:"button"})),s=this._renderSearchInput(),a=this._renderSiteItems();return l("div",{class:this.classes(n.filterMenu),key:"filter-menu-site"},o,s,a)}_renderFacilityFilterMenu(){let{messages:e,messagesCommon:t,site:i}=this,o=this.viewModel?.getSite(i)?.name,s=this.facility&&this.viewModel?.getFacility(this.facility)?.name||e.selector.selectFacility,a=this.viewModel.hasMultipleSites?l("button",{bind:this,class:this.classes(n.filterMenuHeaderBack),onclick:this._backClicked,title:t.back,type:"button"},l("span",{class:this.classes(w(this.container)?d.right:d.left)})):null,r=this.viewModel.hasMultipleSites?l(y,{class:this.classes(n.filterMenuHeaderSubtext),level:x(this.headingLevel)},o):null,c=l("div",{class:this.classes(n.filterMenuHeader),key:"filter-menu-site-header"},a,l("div",{class:this.classes(n.filterMenuHeaderTextGroup)},l(y,{class:this.classes(n.filterMenuHeaderText),level:this.headingLevel},s),r),l("button",{bind:this,class:this.classes(d.icon,d.close),onclick:this._closeClicked,title:t.close,type:"button"})),_=this._renderSearchInput(),g=this._renderFacilityItems();return l("div",{class:this.classes(n.filterMenu),key:"filter-menu-facility"},c,_,g)}_renderSearchInput(){let{messagesCommon:e}=this,t=!!(this.viewModel.searchTerm&&this.viewModel.searchTerm?.length>0);return l("div",{class:this.classes(n.filterMenuSearch),key:"filter-menu-search"},l("span",{class:this.classes(d.icon,d.search),key:"filter-menu-search-icon"}),l("input",{afterCreate:b,bind:this,class:this.classes(n.filterMenuSearchInput),"data-node-ref":"_searchInput",oninput:this._onSearchChange,onpaste:this._onSearchChange,placeholder:e.search,value:this.viewModel.searchTerm??void 0}),t?l("span",{bind:this,class:this.classes(d.icon,d.close),key:"filter-menu-search-clear",onclick:this._onSearchClear,title:e.clear}):null)}_renderBlueCircle(){return l("span",{class:this.classes(n.selectedItemCircle),key:"floor-filter__selected-item-circle"})}_renderSiteItems(){if(!this.viewModel?.filterFeatures?.sites?.sitesInfo)return null;let{messages:e}=this,t=this.viewModel.filterFeatures.sites.sitesInfo,i=this.viewModel.filterSites(t).map(s=>this._renderSiteItem(s)),o=i.length===0&&this.viewModel?.searchTerm&&l("div",{class:this.classes(h.empty)},e.noResults);return l("ul",{afterCreate:b,"aria-label":e.selector.sitesLabel,bind:this,class:this.classes(n.filterMenuItems),"data-id":"sites","data-node-ref":"_sitesListNode",key:"filter-menu-items--sites",onkeydown:this._handleListKeydown,tabIndex:-1},i,o)}_renderSiteItem(e){let{name:t,id:i}=e,o=`filter-menu-site--${i}`,s=this.site===i;return l("li",{key:o},l("button",{bind:this,class:this.classes(n.filterMenuSite),"data-id":i,"data-list-id":"sites",onclick:this._siteSelected,onfocus:this._onItemFocus,type:"button"},s?this._renderBlueCircle():null,l("span",{class:this.classes(s?n.filterMenuSelectedItem:n.filterMenuItemName)},t),l("span",{class:this.classes(w(this.container)?d.left:d.right)})))}_renderFacilityItems(){if(!this.viewModel?.filterFeatures?.facilities?.facilitiesInfo)return null;let{messages:e,site:t}=this,i=this.viewModel.getSite(t),o=this.viewModel.filterFeatures.facilities.facilitiesInfo,s=this.viewModel.filterFacilities(o).map(c=>this._renderFacilityItem(c)),a=s.length===0&&this.viewModel?.searchTerm&&l("div",{class:this.classes(h.empty)},e.noResults),r=i?I(e.selector.siteFacilitiesLabel,{name:`"${i.name}"`}):e.selector.facilitiesLabel;return l("ul",{afterCreate:b,"aria-label":r,bind:this,class:this.classes(n.filterMenuItems),"data-id":"facilities","data-node-ref":"_facilitiesListNode",key:"filter-menu-items--facilities",onkeydown:this._handleListKeydown,tabIndex:-1},s,a)}_renderFacilityItem(e){let{name:t,id:i}=e,o=`filter-menu-facility--${i}`,s=this.facility===i;return l("li",{key:o},l("button",{bind:this,class:this.classes(n.filterMenuFacility),"data-id":i,"data-list-id":"facilities",onclick:this._facilitySelected,onfocus:this._onItemFocus,type:"button"},s?this._renderBlueCircle():null,l("span",{class:this.classes(s?n.filterMenuSelectedItem:n.filterMenuItemName)},t)))}_afterBaseNodeCreate(e){this._baseNode&&this._resizeObserver?.unobserve(this._baseNode),this._baseNode=e,this._resizeObserver?.observe(this._baseNode)}_toggleCollapsed(){this.longNames=!this.longNames}_toggleFilterMenu(){let e=this.viewModel?.filterMenuOpen??!1;this.viewModel.filterMenuOpen=!e}_setFilterMenuType(e){this.viewModel.filterMenuType=e}_zoomToClicked(){if(this.site&&this.viewModel?.filterMenuType==="site"&&this.viewModel?.filterMenuOpen){let e=this.viewModel?.getSite(this.site);this.viewModel.goTo(e)}else if(this.facility){let e=this.viewModel?.getFacility(this.facility);this.viewModel.goTo(e)}else if(this.site){let e=this.viewModel?.getSite(this.site);this.viewModel.goTo(e)}}_onSearchChange(e){let t=e.target;t.value===""?this.viewModel.searchTerm=null:t.value&&this.viewModel?.searchTerm!==t.value&&(this.viewModel.searchTerm=t.value)}_onSearchClear(){this.viewModel.searchTerm=null}_closeClicked(){this.viewModel.searchTerm=null,this.viewModel.filterMenuOpen=!1}_backClicked(){this._setFilterMenuType("site"),this.viewModel.searchTerm=null}_siteSelected(e){let t=e.currentTarget.getAttribute("data-id"),i=this.viewModel.getSite(t),o=!1;this.site!==t&&(this.facility=null,this.level=null,o=!0,this.viewModel.levelsExpanded=!1),this.site=t,this.viewModel.searchTerm=null,this._setFilterMenuType("facility"),this.viewModel.goTo(i),o&&this.viewModel.setFloors(null)}_facilitySelected(e){let t=e.currentTarget.getAttribute("data-id"),i=this.viewModel.getFacility(t),o=!1;if(this.facility!==t){if(this.viewModel.filterMode==="base-floors"){let s=this.viewModel?.getBaseLevel(i);this.level=s?s.id:null}else this.level=null;o=!0,this.viewModel.levelsExpanded=!1}if(this.facility=t,this.viewModel.goTo(i),o){let s=this.viewModel.getLevel(this.level);this.viewModel.setFloors(s)}this.viewModel.isNormalMode||this.viewModel.getFacilityLevels(t)?.length>1&&(this.viewModel.levelsExpanded=!0),setTimeout(()=>this._focusActiveLevel(),50)}_levelSelected(e){let t=e.currentTarget.getAttribute("data-id");this.level=t}_closeLevels(){this.viewModel.levelsExpanded=!1}_isWebScene(e){return e?.declaredClass==="esri.WebScene"}_getComponentPosition(){return this.container!=null?this.view?.ui?.getPosition(this.container):null}_getPosition(e){switch(e){case"bottom-right":case"bottom-left":return"bottom";default:return"top"}}_handleListKeydown(e){let t=e.currentTarget.getAttribute("data-id"),i=null;t==="sites"||t==="facilities"?(this._activeMenu!==t&&(this._activeMenuIndex.menuItems=-1),this._activeMenu=t,i="menuItems"):t==="levels"&&(i="levels");let o=t==="sites"?this._sitesListNode:t==="facilities"?this._facilitiesListNode:t==="levels"?this._levelsListNode:null,{key:s}=e,a=s==="Tab",r=C.has(s);r&&e.preventDefault();let c=o?.getElementsByTagName("li");c&&c.length!==0&&(r||a)&&this._handleItemNavigation(s,e.shiftKey,c,a,i)}_handleItemNavigation(e,t,i,o,s){if(!s)return;this._activeMenuIndex[s]===i.length&&this._activeMenuIndex[s]--,this._activeMenuIndex[s]===-1&&this._activeMenuIndex[s]++;let a=this._activeMenuIndex[s];switch(e){case"Home":this._activeMenuIndex[s]=0;break;case"End":this._activeMenuIndex[s]=i.length-1;break;case"ArrowUp":this._activeMenuIndex[s]=this._activeMenuIndex[s]<=0?i.length-1:this._activeMenuIndex[s]-1;break;case"ArrowDown":this._activeMenuIndex[s]=this._activeMenuIndex[s]===i.length-1?0:this._activeMenuIndex[s]+1}if(e==="Tab"&&t&&this._activeMenuIndex[s]>=0&&this._activeMenuIndex[s]--,e==="Tab"&&!t&&this._activeMenuIndex[s]<i.length&&this._activeMenuIndex[s]++,a!==this._activeMenuIndex[s]&&this._activeMenuIndex[s]>-1&&this._activeMenuIndex[s]<i.length&&!o){let r=i[this._activeMenuIndex[s]].getElementsByTagName("button");(r?.length===1?r[0]:null)?.focus()}}_focusSearch(){this._searchInput?.focus()}_focusActiveLevel(){let{level:e}=this,t=this._levelsListNode,i=t?.getElementsByTagName("li");if(!e||!t||!i)return;let o=this._facilitiesListNode?.getElementsByTagName("li");this._activeMenuIndex.menuItems=o?o.length-1:-1;let s=[];for(let a=0;a<i.length;a++){let r=i[a].getElementsByTagName("button");r?.length===1&&s.push(r[0])}s.forEach((a,r)=>{a.getAttribute("data-id")===e&&(a.focus(),this._activeMenuIndex.levels=r)})}_onItemFocus(e){let t=e.currentTarget,i=t.getAttribute("data-list-id"),o=t.getAttribute("data-id"),s=i==="sites"?this._sitesListNode:i==="facilities"?this._facilitiesListNode:i==="levels"?this._levelsListNode:null;if(!s)return;let a=s?.getElementsByTagName("li");if(!a)return;let r=[];Array.from(a).forEach(g=>{let p=g.getElementsByTagName("button");p?.length===1&&r.push(p[0])});let c=null;switch(i){case"sites":case"facilities":c="menuItems";break;case"levels":c="levels"}if(!c)return;let _=c;r.forEach((g,p)=>{g.getAttribute("data-id")===o&&this._activeMenuIndex[_]!==p&&(this._activeMenuIndex[_]=p)})}};m([f()],v.prototype,"_searchInput",void 0),m([f()],v.prototype,"enabled",null),m([f()],v.prototype,"longNames",null),m([f()],v.prototype,"minimized",null),m([f()],v.prototype,"pinnedLevels",null),m([f()],v.prototype,"site",null),m([f()],v.prototype,"facility",null),m([f()],v.prototype,"level",null),m([f()],v.prototype,"view",null),m([f({type:L})],v.prototype,"viewModel",void 0),m([f(),T("esri/widgets/FloorFilter/t9n/FloorFilter")],v.prototype,"messages",void 0),m([f(),T("esri/t9n/common")],v.prototype,"messagesCommon",void 0),m([f()],v.prototype,"goToOverride",null),m([f()],v.prototype,"headingLevel",void 0),m([f()],v.prototype,"icon",null),v=m([B("esri.widgets.FloorFilter")],v);var V=v;export{V as default};
