import{a as qe}from"./chunk-BL36WTGF.js";import{a as Ge}from"./chunk-AKDISSFR.js";import{b as Oe}from"./chunk-C3PNPKWJ.js";import{a as N}from"./chunk-2XCEJBGD.js";import{a as xe}from"./chunk-O6VBCDES.js";import{a as Ae}from"./chunk-AMX6AASB.js";import{t as Se}from"./chunk-DT6D5YZT.js";import{a as Me}from"./chunk-VCLDFV7F.js";import{a as be}from"./chunk-CESHMSBL.js";import{a as _e,c as we,d as Le}from"./chunk-XGBN53IG.js";import{b as ye}from"./chunk-KVIHP5QH.js";import{a as ue}from"./chunk-5KMJDB5T.js";import{b as B,d as de,h as ge,l as fe,m as ve}from"./chunk-6OWZRPJO.js";import{a as ce,c as he,l as j}from"./chunk-2BJHWKO6.js";import{a as T,b as W,c as P,d as _}from"./chunk-CISTQZ5X.js";import{a as k}from"./chunk-7XYYDAZO.js";import{F as q,G as oe,H as le,I as me,J as pe,o as L}from"./chunk-3WNFY6Z5.js";import{a as z}from"./chunk-QCZ3ZIGQ.js";import{h as ae,i as ne,k as G}from"./chunk-ZM24RY22.js";import{a as w}from"./chunk-LAX5536Z.js";import{a as V}from"./chunk-CZ6CGC7I.js";import{a as se}from"./chunk-7B6U3N62.js";import{e as te}from"./chunk-OK4K3OQT.js";import{a as ie}from"./chunk-BPWNCOXC.js";import{a as re}from"./chunk-AVMO6LCR.js";import{a as ee}from"./chunk-JQAW4OB5.js";import{b as Z,f as $,g as y}from"./chunk-DA3SDKGO.js";import{h as Y}from"./chunk-RNC4P66O.js";import{a as I}from"./chunk-U4QEPZJ3.js";import{c as O}from"./chunk-VIEK2X23.js";import{a as E}from"./chunk-7F5DJLJT.js";import{H as x,L as H}from"./chunk-NJWTSROP.js";import{b as R}from"./chunk-UST6HCE7.js";import{f as K}from"./chunk-WFKZLI6F.js";import{a as v,e as Q,j as S,k as X}from"./chunk-TG45K3WR.js";import{a as l}from"./chunk-QGVBCWUY.js";import{e as m}from"./chunk-NFIPKH6V.js";import{l as A}from"./chunk-5QEXLALV.js";import{b as g}from"./chunk-4PTIEWMT.js";import{a as D,b as U,f as b}from"./chunk-VTHXE323.js";var f=1e5,h=class extends ye{constructor(e){super(e),this._measurementLayer=new k({internal:!0,listMode:"hide",visible:!1}),this._manipulatorLayer=new k({internal:!0,listMode:"hide",visible:!1}),this._snappingLayer=new k({internal:!0,listMode:"hide",visible:!1}),this._updatingHandles=new ee,this._vertices=[],this._drawActive=!1,this.measurement=null,this.measurementLabel=null}initialize(){R("esri/core/t9n/Units").then(t=>{this.messages=t});let e=this.view;this._draw=new xe({view:e}),e.map.addMany([this._measurementLayer,this._manipulatorLayer,this._snappingLayer]),e.focus(),this.addHandles([K(()=>b(this,null,function*(){this.messages=yield R("esri/core/t9n/Units")})),v(()=>[this.unit,this.messages],()=>{this._updateGraphics()},S),v(()=>[this.view.effectiveTheme.accentColor,this.view.effectiveTheme.textColor],()=>{if(!this._vertices.length)return;let t=this._vertices.map(({coord:r})=>r);for(let{handle:r}of this._vertices)r.remove();this._vertices=[],this._measurementLayer.removeAll(),this._manipulatorLayer.removeAll(),this._snappingLayer.removeAll(),this.manipulators.removeAll(),this._updateSketch(t)})]),Se(this)}destroy(){let{map:e}=this.view;this._draw.view=null,this._draw=g(this._draw),e.removeMany([this._measurementLayer,this._manipulatorLayer,this._snappingLayer]),this._measurementLayer.removeAll(),this._manipulatorLayer.removeAll(),this._snappingLayer.removeAll(),this._set("measurement",null),this._set("measurementLabel",null),this._measurementLayer=g(this._measurementLayer),this._manipulatorLayer=g(this._manipulatorLayer),this._snappingLayer=g(this._snappingLayer),this._updatingHandles=g(this._updatingHandles),this._resetVertices()}get cursor(){return this._drawActive?"crosshair":null}set editable(e){this._set("editable",e),e||this._draw.reset()}get snappingOptions(){return this.snappingManager.options}get updating(){return this._updatingHandles.updating||this.snappingManager.updating}onActivate(){this._drawActive||this._vertices.length!==0||this._startSketch()}onShow(){this._measurementLayer.visible=!0,this._manipulatorLayer.visible=!0,this._snappingLayer.visible=!0}onHide(){this._measurementLayer.visible=!1,this._manipulatorLayer.visible=!1,this._snappingLayer.visible=!1}reset(){this.manipulators.removeAll(),this._resetVertices(),this._measurementLayer.removeAll(),this._manipulatorLayer.removeAll(),this._set("measurement",null),this._set("measurementLabel",null),this._draw.reset(),this._drawActive=!1}_getSnappingContext(e){return new be({elevationInfo:{mode:"on-the-ground",offset:0},pointer:e,editGeometryOperations:new j(new he("point",ce(!1,!1,this.view.spatialReference)),z.Local),visualizer:new Me(this._snappingLayer)})}_resetVertices(){for(let{handle:e}of this._vertices)e.remove();this._vertices=[]}_startSketch(){this._drawActive=!0;let{snappingManager:e}=this,t=this._draw.create("polyline",{mode:"click",snappingManager:e});t.on(["vertex-add","vertex-update","vertex-remove","cursor-update","undo","redo"],r=>this._updateSketch(r.vertices)),t.on("draw-complete",()=>this._stopSketch())}_stopSketch(){if(this._vertices.length<3)return this.reset(),void this._startSketch();this.manipulators.forEach(({manipulator:e})=>{e.interactive=!0}),this._drawActive=!1,this.finishToolCreation()}_updateSketch(e){let t=this.view.spatialReference;if(t&&(!F(t)||Z())){for(;this._vertices.length>e.length;){let{handle:r,manipulator:s}=this._vertices.pop();r.remove(),this.manipulators.remove(s)}for(let r=this._vertices.length;r<e.length;r++){let[s,o]=e[r],n=new O({x:s,y:o,spatialReference:t}),a=He(n,this.view,this._manipulatorLayer);this.manipulators.add(a);let i=j.fromGeometry(n,z.Local);i.on("vertex-update",u=>{let c=u.vertices.at(0);c&&(this._vertices[r].coord=[c.pos[0],c.pos[1]],this._updateGraphics())});let p=_e(a,(u,c,M,Te)=>{let Ce=this._getSnappingContext(Te),{snappingManager:De}=this,Ue=this._updatingHandles,{snappingStep:Re}=Ae({snappingContext:Ce,snappingManager:De,updatingHandles:Ue});c.next(Le(this.view)).next(C=>{if(C.action==="start"){let J=new O(C.mapStart);u.graphic.geometry=J,i.trySetGeometry(J)}return C}).next(...Re).next(we({operations:i})).next(()=>{u.graphic.geometry=i.data.geometry})});this._vertices.push({manipulator:a,coord:[s,o],handle:p})}if(this._vertices.length){let r=this._vertices.length-1,s=this._vertices[r],[o,n]=e[r];s.coord[0]===o&&s.coord[1]===n||(s.coord=[o,n],s.manipulator.graphic.geometry=new O({x:o,y:n,spatialReference:t}));let a=this._drawActive?this._vertices[r].manipulator:null;this.manipulators.forEach(({manipulator:i})=>{i.interactive=a==null||i!==a})}this._updateGraphics()}}_updateGraphics(){if(this._vertices.length<2)return void this._measurementLayer.removeAll();let e=Ee(this._vertices.map(({coord:M})=>M),this.view.spatialReference);if(!e)return;let{measurement:t,fillGeometry:r,outlineGeometry:s}=e;this._set("measurement",t);let o=t?Ie(this.messages,t,this.unit):null;if(this._set("measurementLabel",o),!r&&!s)return;let n,a,i,{graphics:p}=this._measurementLayer,u=p.length===3,{effectiveTheme:c}=this.view;u?(n=p.at(0),a=p.at(1),i=p.at(2)):(n=new w({symbol:new ie({color:G(c.accentColor,.3),outline:null})}),a=new w({symbol:new re({color:c.accentColor,width:2})}),i=new w({symbol:new se({color:c.textColor,font:new te({size:14,family:"sans-serif"}),haloColor:G(ne(c.textColor,ae.Low),.5),haloSize:2})}),p.removeAll(),p.addMany([n,a,i])),n.geometry=r,a.geometry=s,i.geometry=r?.centroid,i.symbol.text=o?.area??""}};function He(e,t,r){let o={style:"circle",color:G(t.effectiveTheme.accentColor,.5),outline:{type:"simple-line",width:0}},n=new V(U(D({},o),{size:8})),a=new V(U(D({},o),{size:1.5*8})),i=new w({geometry:e,symbol:n});return new Oe({view:t,layer:r,graphic:i,focusedSymbol:a})}function Ee(e,t){if(e.length===2){let p=new I({paths:[e],spatialReference:t}),u;if(t.isGeographic)if(T(t))u=_(p,f);else{let c=y(p,E.WGS84),M=_(c,f);u=y(M,t)}else u=t.isWebMercator?q(p,f,"meters"):p;return{measurement:null,fillGeometry:null,outlineGeometry:u}}e.push(e[0]);let r=new I({paths:[e],spatialReference:t}),s=new Y({rings:[e],spatialReference:t}),o,n,a=null,i=null;if(t.isGeographic)if(T(t)){if(a=_(r,f),i=_(s,f),i=L(i),!i)return null;o=P([r],"meters")[0],n=W([i],"square-meters")[0]}else{let p=E.WGS84,u=y(r,p),c=y(s,p);if(a=_(u,f),i=_(c,f),i=L(i),!i)return null;o=P([u],"meters")[0],n=W([i],"square-meters")[0],a=y(a,t),i=y(i,t)}else if(t.isWebMercator){if(a=q(r,f,"meters"),i=q(s,f,"meters"),i=L(i),!i)return null;o=pe(r,"meters"),n=me(i,"square-meters")}else{if(a=r,i=L(s),!i)return null;o=le(r,"meters"),n=oe(i,"square-meters")}return{measurement:{geometry:i,area:n,perimeter:o},fillGeometry:i,outlineGeometry:a}}function ke(e){return e!=null}function F(e){if(!e)return!1;let{isGeographic:t,isWebMercator:r,isWGS84:s}=e;return t&&!s&&!T(e)||!t&&!r}function Ie(e,t,r){if(!t||!e)return null;let s={area:null,perimeter:null},{area:o,perimeter:n}=t;switch(r){case"metric":s.area=fe(e,o,"square-meters");break;case"imperial":s.area=ve(e,o,"square-meters");break;default:{let i=H(o,"square-meters",r);s.area=B(e,i,r);break}}let a=Ve(r);if(a)switch(a){case"metric":s.perimeter=de(e,n,"meters");break;case"imperial":s.perimeter=ge(e,n,"meters");break;default:{let i=H(n,"meters",a);s.perimeter=B(e,i,a);break}}else s.perimeter="";return s}function Ve(e){switch(e){case"metric":case"ares":case"hectares":return"metric";case"imperial":case"acres":return"imperial";case"square-inches":return"inches";case"square-feet":return"feet";case"square-yards":return"yards";case"square-miles":return"miles";case"square-nautical-miles":return"nautical-miles";case"square-us-feet":return"us-feet";case"square-meters":return"meters";case"square-kilometers":return"kilometers";case"square-millimeters":return"millimeters";case"square-centimeters":return"centimeters";case"square-decimeters":return"decimeters";default:return null}}l([m()],h.prototype,"_drawActive",void 0),l([m({readOnly:!0})],h.prototype,"cursor",null),l([m({value:!0})],h.prototype,"editable",null),l([m({readOnly:!0})],h.prototype,"measurement",void 0),l([m({readOnly:!0})],h.prototype,"measurementLabel",void 0),l([m()],h.prototype,"messages",void 0),l([m({constructOnly:!0})],h.prototype,"snappingManager",void 0),l([m()],h.prototype,"unit",void 0),l([m()],h.prototype,"updating",null),l([m({constructOnly:!0})],h.prototype,"view",void 0),h=l([A("esri.widgets.AreaMeasurement2D.AreaMeasurement2DTool")],h);var d=class extends qe{constructor(e){super(e),this.supportedViewType="2d",this.unsupportedErrorMessage="AreaMeasurement2DViewModel is only supported in 2D views.",this._snappingManager=null,this.snappingOptions=new N}initialize(){this.addHandles([v(()=>this.view?.spatialReference,()=>this.clear()),v(()=>this.unit,e=>{this.tool!=null&&(this.tool.unit=e)},S),v(()=>this.view,e=>{this._snappingManager=g(this._snappingManager),e&&(this._snappingManager=new Ge({view:e,options:this.snappingOptions}))},X),v(()=>this.snappingOptions,e=>{this._snappingManager&&e&&(this._snappingManager.options=e)})])}destroy(){this._snappingManager=g(this._snappingManager)}get measurement(){return this.tool?.measurement??null}get measurementLabel(){return this.tool?.measurementLabel??null}get state(){return this.disabled||this.view==null||!ke(this.view.spatialReference)?"disabled":this.tool?.measurement?this.tool.active?"measuring":"measured":"ready"}get unit(){return this._validateUnit(this.defaultUnit)}set unit(e){this._overrideIfSome("unit",this._validateUnit(e))}get unitOptions(){return x}set unitOptions(e){this._overrideIfSome("unitOptions",this._validateUnits(e))}start(){return b(this,null,function*(){let e=this.view;e!=null&&(yield Q(()=>e.ready),F(e.spatialReference)&&(yield $())),this.createTool({interactive:!0})})}clear(){this.removeTool()}constructTool(){return new h({snappingManager:this._snappingManager,unit:this.unit,view:this.view,visible:this.visible})}_validateUnit(e){let{unitOptions:t,defaultUnit:r}=this;return e!=null&&t.includes(e)?e:t.includes(r)?r:t.length>0?t[0]:r}_validateUnits(e){if(e==null)return[];let t=e.filter(r=>x.includes(r));return t.length===0?x.slice():t}};l([m()],d.prototype,"_snappingManager",void 0),l([m(ue)],d.prototype,"defaultUnit",void 0),l([m({readOnly:!0})],d.prototype,"measurement",null),l([m({readOnly:!0})],d.prototype,"measurementLabel",null),l([m({type:N,nonNullable:!0})],d.prototype,"snappingOptions",void 0),l([m({readOnly:!0})],d.prototype,"state",null),l([m({type:String})],d.prototype,"unit",null),l([m({type:[String]})],d.prototype,"unitOptions",null),d=l([A("esri.widgets.AreaMeasurement2D.AreaMeasurement2DViewModel")],d);var Nt=d;export{Nt as a};
