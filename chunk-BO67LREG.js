import{a as H}from"./chunk-W3TWKYGN.js";import{a as L}from"./chunk-72TNJFVF.js";import"./chunk-OC2XJJQU.js";import{a as _,c as A}from"./chunk-AKLLBN64.js";import{m as T}from"./chunk-DT6D5YZT.js";import"./chunk-CSSRRM4C.js";import"./chunk-RVXDLN3U.js";import"./chunk-NWJCHWGR.js";import"./chunk-FM2MN524.js";import{a as c,b as I}from"./chunk-XEJVICTW.js";import"./chunk-2JW3DUYT.js";import"./chunk-4JIR4MZV.js";import"./chunk-ZO3S2OWI.js";import"./chunk-Q5KIWWVU.js";import"./chunk-CISTQZ5X.js";import"./chunk-Z7TBAZRW.js";import"./chunk-NIYDRLW4.js";import"./chunk-QSQIQSC6.js";import"./chunk-AYNBEMCC.js";import"./chunk-LNYBTIG7.js";import"./chunk-7SDNM7YV.js";import"./chunk-4NUW747S.js";import"./chunk-T6WMVIUG.js";import"./chunk-JPMGMA4B.js";import"./chunk-YZJDOXQC.js";import{b as Y}from"./chunk-GNEAU6X4.js";import"./chunk-F2BQ2GD6.js";import"./chunk-R3XLNYYB.js";import"./chunk-2HYVVLKS.js";import"./chunk-XRTA5GHC.js";import"./chunk-Y6XW36QP.js";import"./chunk-ZXKU6WBY.js";import"./chunk-BMYVPMAK.js";import"./chunk-EM35R6FY.js";import"./chunk-DJW5LMRG.js";import"./chunk-DEH76MSI.js";import"./chunk-ALWV3RJ2.js";import"./chunk-QXXXCEV5.js";import{B as U}from"./chunk-6B5XFA6F.js";import"./chunk-TJ6P6NLD.js";import{d as V}from"./chunk-NX5B6XBR.js";import"./chunk-2JABY6DU.js";import"./chunk-MPRKSQLC.js";import"./chunk-57TARQ4F.js";import"./chunk-6RBQSBA2.js";import"./chunk-3JGYBNJA.js";import{d as b,g as F}from"./chunk-DA3SDKGO.js";import"./chunk-ZOEPYNM4.js";import"./chunk-57VFBGF3.js";import"./chunk-GWBRHLNH.js";import"./chunk-BJH4F4SM.js";import"./chunk-Z3RBZHAK.js";import"./chunk-PTZYZULI.js";import"./chunk-NMLYCCKN.js";import"./chunk-ZC6EBRE4.js";import"./chunk-E7AX56GD.js";import"./chunk-IDVLLREH.js";import"./chunk-DWLSVYOY.js";import"./chunk-PQGCNP5H.js";import"./chunk-UASS7NJI.js";import"./chunk-WZRAC35O.js";import"./chunk-KUYAWYSS.js";import"./chunk-MIS6QMFE.js";import"./chunk-MDZTV2VL.js";import"./chunk-RNC4P66O.js";import"./chunk-7LHOQXZT.js";import"./chunk-BCREO4Q5.js";import"./chunk-U4QEPZJ3.js";import"./chunk-KJUZWSCL.js";import"./chunk-3WO6D7MU.js";import"./chunk-BUZ3SPLE.js";import"./chunk-CELWVZPW.js";import"./chunk-DYTVXYAV.js";import"./chunk-ZTOZWLEE.js";import"./chunk-RSDQHAJX.js";import"./chunk-BOVYXYHK.js";import"./chunk-KVM6SHDX.js";import{i as C}from"./chunk-EQZWYK27.js";import"./chunk-JLPLCY2B.js";import"./chunk-ZQIC5NFT.js";import"./chunk-VIEK2X23.js";import"./chunk-XKIFGPJO.js";import"./chunk-PEW2PLAN.js";import"./chunk-Q6Y4JG7Q.js";import"./chunk-7F5DJLJT.js";import"./chunk-CX5IFQZJ.js";import{L as X}from"./chunk-NJWTSROP.js";import"./chunk-D3R25AF2.js";import"./chunk-ARRCN5K3.js";import"./chunk-O3EGNJTY.js";import"./chunk-WGAOVKGR.js";import"./chunk-G4DZJMGT.js";import"./chunk-K5T5FD5C.js";import"./chunk-MVHHPJM7.js";import"./chunk-VDO6JJ3Y.js";import"./chunk-WFKZLI6F.js";import"./chunk-X2B63YVS.js";import"./chunk-BAEF3CT6.js";import"./chunk-AUAZP44J.js";import"./chunk-PVDFCTA4.js";import"./chunk-KNVXE32P.js";import"./chunk-76ATOSLU.js";import"./chunk-CCJU4DSH.js";import"./chunk-TG45K3WR.js";import"./chunk-RAI4DTMT.js";import"./chunk-ACP3S2CH.js";import"./chunk-HVAXZ2NA.js";import"./chunk-T7DXJKX7.js";import"./chunk-TYYVNQUR.js";import{a as o}from"./chunk-QGVBCWUY.js";import{H as W}from"./chunk-MYO4NP2N.js";import{e as a}from"./chunk-NFIPKH6V.js";import"./chunk-JPU2PQZC.js";import{l as O}from"./chunk-5QEXLALV.js";import"./chunk-P6QFA5MM.js";import"./chunk-DGTD7Y73.js";import"./chunk-LI2SX4T6.js";import"./chunk-BWO7LS2H.js";import"./chunk-HEVQSRJ2.js";import"./chunk-OVHPPCBL.js";import"./chunk-SNFOAZZQ.js";import"./chunk-AML4XSEF.js";import"./chunk-4PTIEWMT.js";import"./chunk-TG2UTNEO.js";import"./chunk-YOFFGXOB.js";import{g as D}from"./chunk-XRGPJ3QY.js";import"./chunk-6MRUJ2UW.js";import"./chunk-2LI2GKBQ.js";import"./chunk-QBWJMFH5.js";import{f as z}from"./chunk-VTHXE323.js";var s=class extends W{constructor(e){super(e),this.options=null}destroy(){this._set("options",null)}get grid(){return this.view.grid}get effectiveViewRotation(){return this.grid?.rotateWithMap?0:C(this.view.rotation??0)}get gridRotation(){return C(this.grid?.rotation??0)}get gridCenter(){let{spatialReference:e,grid:r}=this;if(!r||!e||!b(r.center.spatialReference,e))return null;try{let t=F(r.center,e),i=e.isWrappable&&this.view?.center!=null?V(t.x,this.view.center.x,e):t.x;return c(i,t.y,t.z)}catch(t){return D.getLogger(this).errorOnce("Grid Snapping - Failed to project grid center.",t),null}}get offsetScaleFactor(){let{pixelsPerStride:e,grid:r}=this;if(!r||!e)return 1;let{majorLineInterval:t,dynamicScaling:i}=r;return t<1?null:_(t,e,i)}get spatialReference(){return this.view.spatialReference}get gridMetersPerStride(){let{grid:e}=this;return e?X(e.spacing,e.units,"meters"):null}get viewMetersPerPixel(){let{viewMetersPerSRUnit:e}=this;return e==null?null:e*Y(this.view.scale,this.view.spatialReference)}get viewMetersPerSRUnit(){let{spatialReference:e}=this.view;return this.gridCenter?A(this.gridCenter[0],this.gridCenter[1],e):null}get pixelsPerStride(){let{gridMetersPerStride:e,viewMetersPerPixel:r}=this;return r&&e?e/r:null}get updating(){return this.grid!=null&&this.spatialReference!=null&&this.viewMetersPerSRUnit==null}fetchCandidates(e,r,t){return z(this,null,function*(){let{options:i,view:n}=this;if(!i?.effectiveGridEnabled||!n.grid||t.feature?.attributes&&T in t.feature.attributes)return[];let l=t.coordinateHelper.arrayToPoint(e),p=i.distance*(t.pointer==="touch"?i.touchSensitivityMultiplier:1);return this.fetchCandidatesSync(l,p)})}fetchCandidatesSync(e,r){let t=[],{grid:i,effectiveViewRotation:n,gridRotation:l,gridCenter:p,viewMetersPerPixel:m,viewMetersPerSRUnit:f,offsetScaleFactor:S,spatialReference:g,gridMetersPerStride:E,pixelsPerStride:G}=this;if(!(i&&m&&f&&p&&g&&S&&E&&G)||!i.dynamicScaling&&G<5||!b(e.spatialReference,g))return t;let P=F(e,g),q=c(P.x,P.y,P.z),u=h(q,-l,p,-n),w=E/f*S,d=K(u,w,p),{shouldSnapX:v,shouldSnapY:y}=N(d,u,r,m,f);if(!v&&!y)return[];let B=c((v?d:u)[0],(y?d:u)[1]),R=h(B,l,p,n),j=h(d,l,p,n);if(y){let M=k(d,u,w,"y"),x=h(M,l,p,n);t.push(new L({lineStart:j,lineEnd:x,targetPoint:R,isDraped:!1}))}if(v){let M=k(d,u,w,"x"),x=h(M,l,p,n);t.push(new L({lineStart:j,lineEnd:x,targetPoint:R,isDraped:!1}))}return v&&y&&t.push(new H(R,t[0],t[1],!1)),t}};o([a({constructOnly:!0})],s.prototype,"view",void 0),o([a()],s.prototype,"options",void 0),o([a()],s.prototype,"grid",null),o([a()],s.prototype,"effectiveViewRotation",null),o([a()],s.prototype,"gridRotation",null),o([a()],s.prototype,"gridCenter",null),o([a()],s.prototype,"offsetScaleFactor",null),o([a()],s.prototype,"spatialReference",null),o([a()],s.prototype,"gridMetersPerStride",null),o([a()],s.prototype,"viewMetersPerPixel",null),o([a()],s.prototype,"viewMetersPerSRUnit",null),o([a()],s.prototype,"pixelsPerStride",null),o([a()],s.prototype,"updating",null),s=o([O("esri.views.interactive.snapping.GridSnappingEngine")],s);var h=(e,r,t,i)=>{let n=I(e[0],e[1],e[2]);return U(n,U(n,n,t,r),t,i)},K=(e,r,t)=>{let i=(e[0]-t[0])/r,n=(e[1]-t[1])/r,l=Math.trunc(i),p=Math.trunc(n),m=Math.round(i%1),f=Math.round(n%1),S=t[0]+(l+m)*r,g=t[1]+(p+f)*r;return c(S,g)},N=(e,r,t,i,n)=>{if(i<=0)return{shouldSnapX:!1,shouldSnapY:!1};let l=(e[0]-r[0])/i,p=(e[1]-r[1])/i;return{shouldSnapX:Math.abs(l*n)<t,shouldSnapY:Math.abs(p*n)<t}},k=(e,r,t,i)=>{if(i==="y"){let l=r[0]>e[0]?1:-1;return c(e[0]+t*l,e[1])}let n=r[1]>e[1]?1:-1;return c(e[0],e[1]+t*n)};export{s as GridSnappingEngine};
