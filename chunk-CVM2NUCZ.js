import{a as y,b as C}from"./chunk-KUE5X75D.js";import{a as A,c as v}from"./chunk-JJ3DE5DS.js";import{a as g}from"./chunk-GHKL3NOH.js";import{m as E}from"./chunk-FB4M3WPV.js";import{a}from"./chunk-QGVBCWUY.js";import{e as i}from"./chunk-NFIPKH6V.js";import{l as f}from"./chunk-5QEXLALV.js";var S="esri-attachments-column",x={contentContainer:`${S}__content`,showAttachmentsButton:`${S}__button`},o=class extends C{constructor(e){super(e),this._buttonElements=new g,this._thumbnailElements=new g,this.attachmentsViewEnabled=!0,this.cellValueFormatFunction=({root:s,rowData:t})=>{let{_showAttachmentsViewEnabled:n,formatFunction:l}=this,r=this.getCellValue(t);if(l&&t){let{index:c,item:{attachments:p,feature:I,relatedRecords:V}}=t;return l({attachments:p,column:this,feature:I,index:c,relatedRecords:V,value:r,virtualIndex:this.getVirtualRowIndex(s)})}if(!t)return r;let{index:_,item:{attachments:w,objectId:b}}=t,d=`(${r})`;if(!this.thumbnailsEnabled&&!n)return r;let h=document.createElement("span");h.textContent=h.title=d;let m=null;if(this.thumbnailsEnabled&&(m=this._createOrSyncThumbnails(b,w??[])),this._showAttachmentsViewEnabled){let c=document.createElement("div");m&&c.appendChild(m),c.appendChild(h);let p=this._createOrSyncShowAttachmentsButton(b,_);return p.appendChild(c),p}let u=document.createElement("div");return u.classList.add(x.contentContainer),m&&u.appendChild(m),u.appendChild(h),u},this.icon="attachment",this.layer=null,this.onShowAttachments=null,this.sortable=!1,this.store=null,this.textAlign="center",this.thumbnailAppearance="image",this.thumbnailCount=8,this.thumbnailIconScale="m",this.thumbnailsEnabled=!0}get _showAttachmentsViewEnabled(){return!(!this.attachmentsViewEnabled||!this.onShowAttachments)}get _supportsResize(){return!!this.store?.supportsResizeAttachments}get effectiveLabel(){return E.sanitize(this.label??(this.messages?.attachments||this.fieldName))}getCellValue(e){return e?.item?.attachments?.length??0}_createOrSyncThumbnails(e,s){let t=document.createElement("div"),n=this._thumbnailElements.get(e);return n?.length&&n.length===s.length?n.forEach(l=>t.appendChild(l)):this._thumbnailElements.set(e,this._createThumbnailElements(s,t)),t}_createOrSyncShowAttachmentsButton(e,s){let t=this._buttonElements.get(e);if(t)return t.textContent="",t.onclick=l=>this._onShowAttachmentsClick({index:s,objectId:e,event:l}),t;let n=this.createCalciteButton({alignment:"icon-end-space-between",className:`${x.showAttachmentsButton} ${y.contentFull}`,iconEnd:"chevron-right",iconFlipRtl:"both",scale:this.thumbnailIconScale,textContent:"",title:this.messages?.viewAttachments,width:"full",onclick:l=>this._onShowAttachmentsClick({index:s,objectId:e,event:l})});return this._buttonElements.set(e,n),n}_createThumbnailAnchor({name:e,url:s},t){let n=document.createElement("a");return n.href=`${s}`,n.download=e,n.rel="noreferrer",n.target="_blank",n.appendChild(t),n}_createThumbnailElements(e,s){let{thumbnailAppearance:t,thumbnailCount:n,thumbnailIconScale:l}=this,r=[],_=Math.min(n,e.length),w=!this.onShowAttachments,b=t==="image"&&!!this.store?.supportsResizeAttachments;for(let d=0;d<_;d++){let h=e[d],{name:m,contentType:u}=h,c=A(u)&&b?this._createThumbnailImage(h):this.createCalciteIcon({icon:v(u),scale:l,textLabel:m}),p=w?this._createThumbnailAnchor(h,c):c;s&&s.appendChild(p),r.push(p)}return r}_createThumbnailImage(e){let{name:s,size:t,url:n}=e,l=document.createElement("img"),r=`${n}${n?.includes("?")?"&":"?"}${this._supportsResize?"w=24":""}&fs=${t}`;return l.alt=this.messages?.attachmentThumbnail??s,l.src=r,l.title=s,l}_onShowAttachmentsClick({index:e,objectId:s,event:t}){t.preventDefault(),t.stopPropagation(),this.onShowAttachments?.({index:e,objectId:s})}};a([i()],o.prototype,"_showAttachmentsViewEnabled",null),a([i()],o.prototype,"_buttonElements",void 0),a([i()],o.prototype,"_supportsResize",null),a([i()],o.prototype,"_thumbnailElements",void 0),a([i()],o.prototype,"attachmentsViewEnabled",void 0),a([i()],o.prototype,"cellValueFormatFunction",void 0),a([i()],o.prototype,"effectiveLabel",null),a([i()],o.prototype,"icon",void 0),a([i()],o.prototype,"layer",void 0),a([i()],o.prototype,"onShowAttachments",void 0),a([i({readOnly:!0})],o.prototype,"sortable",void 0),a([i()],o.prototype,"store",void 0),a([i()],o.prototype,"textAlign",void 0),a([i()],o.prototype,"thumbnailAppearance",void 0),a([i()],o.prototype,"thumbnailCount",void 0),a([i()],o.prototype,"thumbnailIconScale",void 0),a([i()],o.prototype,"thumbnailsEnabled",void 0),o=a([f("esri.widgets.FeatureTable.AttachmentsColumn")],o);var N=o;export{N as a};
