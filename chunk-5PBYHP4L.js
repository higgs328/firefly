import{b as ue}from"./chunk-EZUSHT3W.js";import{a as ie,c as le,d as de}from"./chunk-Q6EKUW7R.js";import{a as ce}from"./chunk-DNO4WN4I.js";import{a as fe}from"./chunk-DJ6DR6TJ.js";import{a as ae}from"./chunk-GOGHKRCQ.js";import"./chunk-ZNPIBNGZ.js";import{a as se}from"./chunk-LS4UDBP4.js";import"./chunk-VJZDN6ZB.js";import{a as oe}from"./chunk-44ACGF3Z.js";import"./chunk-7VCEHOOE.js";import{a as ne}from"./chunk-AMXA7NR2.js";import{a as pe}from"./chunk-EN7WD3AV.js";import{b as me}from"./chunk-3GP4YRLZ.js";import"./chunk-ONYJLWAD.js";import"./chunk-PHODKV66.js";import"./chunk-JPMGMA4B.js";import"./chunk-YZJDOXQC.js";import{a as $}from"./chunk-6F25LG6O.js";import"./chunk-5L2EJ5RT.js";import{a as W}from"./chunk-2NH7HOKA.js";import{l as w}from"./chunk-HM5RIVQC.js";import{o as re}from"./chunk-QNXZMK4V.js";import{a as ee,c as te,d as O}from"./chunk-3YLFGUFH.js";import{a as X,c as Y,e as E,h as Z}from"./chunk-XIZXEWWA.js";import"./chunk-HKJZ7WI6.js";import"./chunk-CXOFHVIF.js";import"./chunk-EO2H4LIH.js";import{a as H,q as J}from"./chunk-DJW5LMRG.js";import{e as A}from"./chunk-DMO5HQM3.js";import{a as _}from"./chunk-DEH76MSI.js";import"./chunk-ALWV3RJ2.js";import{b as N,c as V,d as M,k,o as C,p as R,s as K,t as Q}from"./chunk-2ZFXOJDB.js";import"./chunk-QXXXCEV5.js";import"./chunk-6B5XFA6F.js";import"./chunk-PUVSV35R.js";import"./chunk-FCWOKKZM.js";import"./chunk-3JGYBNJA.js";import"./chunk-DA3SDKGO.js";import"./chunk-ZOEPYNM4.js";import"./chunk-57VFBGF3.js";import"./chunk-GWBRHLNH.js";import"./chunk-BJH4F4SM.js";import"./chunk-Z3RBZHAK.js";import{c as q}from"./chunk-PTZYZULI.js";import"./chunk-NMLYCCKN.js";import"./chunk-MIS6QMFE.js";import"./chunk-MDZTV2VL.js";import"./chunk-RNC4P66O.js";import"./chunk-7LHOQXZT.js";import"./chunk-BCREO4Q5.js";import"./chunk-U4QEPZJ3.js";import"./chunk-KJUZWSCL.js";import"./chunk-3WO6D7MU.js";import"./chunk-BUZ3SPLE.js";import"./chunk-ZTOZWLEE.js";import{f as G}from"./chunk-RJWOVI3M.js";import"./chunk-RSDQHAJX.js";import{c as U}from"./chunk-BOVYXYHK.js";import"./chunk-KVM6SHDX.js";import{j as D,v as S}from"./chunk-EQZWYK27.js";import"./chunk-ZQIC5NFT.js";import"./chunk-VIEK2X23.js";import"./chunk-XKIFGPJO.js";import"./chunk-PEW2PLAN.js";import"./chunk-Q6Y4JG7Q.js";import"./chunk-7F5DJLJT.js";import"./chunk-CX5IFQZJ.js";import"./chunk-NJWTSROP.js";import"./chunk-D3R25AF2.js";import"./chunk-ARRCN5K3.js";import"./chunk-G4DZJMGT.js";import"./chunk-X2B63YVS.js";import"./chunk-BAEF3CT6.js";import{o as L}from"./chunk-AUAZP44J.js";import"./chunk-PVDFCTA4.js";import"./chunk-KNVXE32P.js";import"./chunk-76ATOSLU.js";import"./chunk-CCJU4DSH.js";import"./chunk-RAI4DTMT.js";import"./chunk-TYYVNQUR.js";import"./chunk-QGVBCWUY.js";import"./chunk-MYO4NP2N.js";import"./chunk-NFIPKH6V.js";import"./chunk-JPU2PQZC.js";import"./chunk-5QEXLALV.js";import{c as b}from"./chunk-P6QFA5MM.js";import"./chunk-DGTD7Y73.js";import"./chunk-LI2SX4T6.js";import"./chunk-BWO7LS2H.js";import"./chunk-HEVQSRJ2.js";import"./chunk-OVHPPCBL.js";import"./chunk-SNFOAZZQ.js";import"./chunk-AML4XSEF.js";import"./chunk-4PTIEWMT.js";import"./chunk-TG2UTNEO.js";import{b as z}from"./chunk-YOFFGXOB.js";import"./chunk-XRGPJ3QY.js";import"./chunk-6MRUJ2UW.js";import"./chunk-2LI2GKBQ.js";import"./chunk-QBWJMFH5.js";import{a as j,b as P,f as h}from"./chunk-VTHXE323.js";function ye(e,t,r){let a=e.typedBuffer,f=e.typedBufferStride,i=t.typedBuffer,l=t.typedBufferStride,o=r?r.count:t.count,n=(r?.dstIndex??0)*f,c=(r?.srcIndex??0)*l;for(let u=0;u<o;++u){for(let s=0;s<9;++s)a[n+s]=i[c+s];n+=f,c+=l}}var Te=Object.freeze(Object.defineProperty({__proto__:null,copy:ye},Symbol.toStringTag,{value:"Module"}));function ve(e,t,r){let a=e.typedBuffer,f=e.typedBufferStride,i=t.typedBuffer,l=t.typedBufferStride,o=r?r.count:t.count,n=(r?.dstIndex??0)*f,c=(r?.srcIndex??0)*l;for(let u=0;u<o;++u){for(let s=0;s<16;++s)a[n+s]=i[c+s];n+=f,c+=l}}var we=Object.freeze(Object.defineProperty({__proto__:null,copy:ve},Symbol.toStringTag,{value:"Module"}));function Be(e,t){xe(e.typedBuffer,t,e.typedBufferStride)}function xe(e,t,r=4){let a=t.typedBuffer,f=t.typedBufferStride,i=t.count,l=0,o=0;for(let n=0;n<i;++n)e[l]=a[o],e[l+1]=a[o+1],e[l+2]=a[o+2],e[l+3]=a[o+3],l+=r,o+=f}function T(e,t,r,a,f,i){let l=e.typedBuffer,o=e.typedBufferStride,n=i?.count??e.count,c=(i?.dstIndex??0)*o;for(let u=0;u<n;++u)l[c]=t,l[c+1]=r,l[c+2]=a,l[c+3]=f,c+=o}var he=Object.freeze(Object.defineProperty({__proto__:null,copy:xe,copyView:Be,fill:T},Symbol.toStringTag,{value:"Module"}));function x(e,t){return new e(new ArrayBuffer(t*e.ElementCount*W(e.ElementType)))}function bt(e,t,r){return h(this,null,function*(){let a=new ce(be(r)),f=(yield pe(a,t,r,!0)).model,i=f.lods.shift(),l=new Map,o=new Map;f.textures.forEach((y,B)=>l.set(B,Me(y))),f.materials.forEach((y,B)=>o.set(B,Ce(y,l)));let n=Ve(i);for(let y of n.parts)Re(n,y,o);let{position:c,normal:u,tangent:s,color:m,texCoord0:p}=n.vertexAttributes,d=A(e,r),F=e.spatialReference.isGeographic?A(e):d,I=re({vertexAttributes:{position:c.typedBuffer,normal:u?.typedBuffer,tangent:s?.typedBuffer},vertexSpace:F,spatialReference:e.spatialReference},d,{allowBufferReuse:!0,sourceUnit:r?.unitConversionDisabled?void 0:"meters"});if(!I)throw new z("load-gltf-mesh:vertex-space-projection",`Failed to load mesh from glTF because we could not convert the vertex space from ${F.type} to ${d.type}`);return{transform:null,vertexSpace:d,components:n.components,spatialReference:e.spatialReference,vertexAttributes:new fe(P(j({},I),{color:m?.typedBuffer,uv:p?.typedBuffer}))}})}function be(e){let t=e?.resolveFile;return t?{busy:!1,request:(r,a,f)=>h(this,null,function*(){let i=t?.(r)??r;return(yield L(i,{responseType:a==="image"?"image":a==="binary"||a==="image+type"?"array-buffer":"json",signal:f?.signal,timeout:0})).data})}:null}function v(e,t){if(e==null)return"-";let r=e.typedBuffer;return`${b(t,r.buffer,()=>t.size)}/${r.byteOffset}/${r.byteLength}`}function Se(e){return e!=null?e.toString():"-"}function Ve(e){let t=0,r={color:!1,tangent:!1,normal:!1,texCoord0:!1},a=new Map,f=new Map,i=[];for(let l of e.parts){let{position:o,normal:n,color:c,tangent:u,texCoord0:s}=l.attributes,m=`
      ${v(o,a)}/
      ${v(n,a)}/
      ${v(c,a)}/
      ${v(u,a)}/
      ${v(s,a)}/
      ${Se(l.transform)}
    `,p=!1,d=b(f,m,()=>(p=!0,{start:t,length:o.count}));p&&(t+=o.count),n&&(r.normal=!0),c&&(r.color=!0),u&&(r.tangent=!0),s&&(r.texCoord0=!0),i.push({gltf:l,writeVertices:p,region:d})}return{vertexAttributes:{position:x(k,t),normal:r.normal?x(V,t):null,tangent:r.tangent?x(M,t):null,color:r.color?x(R,t):null,texCoord0:r.texCoord0?x(N,t):null},parts:i,components:[]}}function Me(e){return new oe({data:(me(e.data),e.data),wrap:Ee(e.parameters.wrap)})}function Ce(e,t){let r=new $(Oe(e.color,e.opacity)),a=e.emissiveFactor?new $($e(e.emissiveFactor)):null,f=i=>i?new ne({scale:i.scale?[i.scale[0],i.scale[1]]:[1,1],rotation:D(i.rotation??0),offset:i.offset?[i.offset[0],i.offset[1]]:[0,0]}):null;return new se({color:r,colorTexture:t.get(e.colorTexture),normalTexture:t.get(e.normalTexture),emissiveColor:a,emissiveTexture:t.get(e.emissiveTexture),occlusionTexture:t.get(e.occlusionTexture),alphaMode:Ae(e.alphaMode),alphaCutoff:e.alphaCutoff,doubleSided:e.doubleSided,metallic:e.metallicFactor,roughness:e.roughnessFactor,metallicRoughnessTexture:t.get(e.metallicRoughnessTexture),colorTextureTransform:f(e.colorTextureTransform),normalTextureTransform:f(e.normalTextureTransform),occlusionTextureTransform:f(e.occlusionTextureTransform),emissiveTextureTransform:f(e.emissiveTextureTransform),metallicRoughnessTextureTransform:f(e.metallicRoughnessTextureTransform)})}function Re(e,t,r){t.writeVertices&&_e(e,t);let{indices:a,attributes:f,primitiveType:i,material:l}=t.gltf,o=de(a||f.position.count,i),n=t.region.start;if(n){let c=new Uint32Array(o);for(let u=0;u<o.length;u++)c[u]+=n;o=c}e.components.push(new ae({name:t.gltf.name,faces:o,material:r.get(l),shading:f.normal?"source":"flat",trustSourceNormals:!0}))}function _e(e,t){let{position:r,normal:a,tangent:f,color:i,texCoord0:l}=e.vertexAttributes,o=t.region.start,{attributes:n,transform:c}=t.gltf,u=n.position.count;if(X(r.slice(o,u),n.position,c),n.normal!=null&&a!=null){let s=J(_(),c),m=a.slice(o,u);Y(m,n.normal,s),S(s)&&Z(m,m)}else a!=null&&ue(a,0,0,1,{dstIndex:o,count:u});if(n.tangent!=null&&f!=null){let s=H(_(),c),m=f.slice(o,u);ee(m,n.tangent,s),S(s)&&te(m,m)}else f!=null&&T(f,0,0,1,1,{dstIndex:o,count:u});if(n.texCoord0!=null&&l!=null?ie(l.slice(o,u),n.texCoord0):l!=null&&le(l,0,0,{dstIndex:o,count:u}),n.color!=null&&i!=null){let s=n.color,m=i.slice(o,u);if(s.elementCount===4)s instanceof M?O(m,s,1,255):(s instanceof R||s instanceof Q)&&O(m,s,1/255,255);else{T(m,255,255,255,255);let p=C.fromTypedArray(m.typedBuffer,m.typedBufferStride);s instanceof V?E(p,s,1,255):(s instanceof C||s instanceof K)&&E(p,s,1/255,255)}}else i!=null&&T(i.slice(o,u),255,255,255,255)}function Ae(e){switch(e){case"OPAQUE":return"opaque";case"MASK":return"mask";case"BLEND":return"blend"}}function Ee(e){return{horizontal:ge(e.s),vertical:ge(e.t)}}function ge(e){switch(e){case w.CLAMP_TO_EDGE:return"clamp";case w.MIRRORED_REPEAT:return"mirror";case w.REPEAT:return"repeat"}}function g(e){return e**(1/G)*255}function Oe(e,t){return q(g(e[0]),g(e[1]),g(e[2]),t)}function $e(e){return U(g(e[0]),g(e[1]),g(e[2]))}export{bt as loadGLTFMesh};
