import{a as Y}from"./chunk-MKARC3VG.js";import{a as X}from"./chunk-33OCBGJO.js";import{a as J,b as K,c as Q}from"./chunk-AKLLBN64.js";import{a as q}from"./chunk-2XCEJBGD.js";import{m as M}from"./chunk-DT6D5YZT.js";import{a as z}from"./chunk-5KMJDB5T.js";import{b as B}from"./chunk-BNJVBYV4.js";import{a as R}from"./chunk-NIYDRLW4.js";import{b as N}from"./chunk-GNEAU6X4.js";import{a as H}from"./chunk-CZ6CGC7I.js";import{a as T}from"./chunk-AVMO6LCR.js";import{a as p}from"./chunk-6F25LG6O.js";import{d as W,g as F}from"./chunk-DA3SDKGO.js";import{a as $}from"./chunk-MIS6QMFE.js";import{j,w as G}from"./chunk-EQZWYK27.js";import{c as _}from"./chunk-VIEK2X23.js";import{L as C}from"./chunk-NJWTSROP.js";import{a as x}from"./chunk-5XCFNEYX.js";import{f as A}from"./chunk-CCJU4DSH.js";import{a as b,b as U}from"./chunk-TG45K3WR.js";import{a as D}from"./chunk-T7DXJKX7.js";import{a as i}from"./chunk-QGVBCWUY.js";import{H as V}from"./chunk-MYO4NP2N.js";import{e as o}from"./chunk-NFIPKH6V.js";import{l as v}from"./chunk-5QEXLALV.js";import{b as S}from"./chunk-4PTIEWMT.js";import{g as E}from"./chunk-XRGPJ3QY.js";import{f as k}from"./chunk-VTHXE323.js";var c=class extends A{constructor(t){super(t),this.center=new _,this.dynamicScaling=!0,this.majorLineColor=p.fromArray([115,115,115,1]),this.majorLineInterval=10,this.minorLineColor=p.fromArray([165,165,165,1]),this.rotateWithMap=!1,this.rotation=0,this.spacing=1,this.type="measured",this.units="miles"}};i([o()],c.prototype,"center",void 0),i([o()],c.prototype,"dynamicScaling",void 0),i([o()],c.prototype,"majorLineColor",void 0),i([o()],c.prototype,"majorLineInterval",void 0),i([o()],c.prototype,"minorLineColor",void 0),i([o()],c.prototype,"rotateWithMap",void 0),i([o()],c.prototype,"rotation",void 0),i([o()],c.prototype,"spacing",void 0),i([$({measured:"measured"})],c.prototype,"type",void 0),i([o()],c.prototype,"units",void 0),c=i([v("esri.grids.MeasuredGrid")],c);var h=class extends V{constructor(t){super(t),this.color=new p([255,127,0,1]),this.isDecoration=!0,this.length=34,this.rotation=0,this.thickness=2,this.visible=!0}get _strokeStyle(){return this.color.toCss(!0)}render(){let{x:t,y:e,length:r,thickness:s,rotation:n}=this,l=r/2,d=`0 0 ${r} ${r}`,m=`M${l} 0 V${r} M0 ${l} H${r}`;return x("div",{classes:{"esri-box-overlay-item":!0},dir:"ltr",styles:{left:`${(t??0)-l}px`,top:`${(e??0)-l}px`,width:`${r}px`,height:`${r}px`,transform:`rotate(${n}deg)`,visibility:this.visible?"visible":"hidden"}},x("svg",{styles:{overflow:"visible"},viewbox:d},x("path",{d:m,stroke:this._strokeStyle,"stroke-width":s})))}renderCanvas(){}};i([o()],h.prototype,"color",void 0),i([o()],h.prototype,"isDecoration",void 0),i([o()],h.prototype,"length",void 0),i([o()],h.prototype,"rotation",void 0),i([o()],h.prototype,"thickness",void 0),i([o()],h.prototype,"visible",void 0),i([o()],h.prototype,"x",void 0),i([o()],h.prototype,"y",void 0),i([o({readOnly:!0})],h.prototype,"_strokeStyle",null),h=i([v("esri.views.overlay.CrosshairOverlayItem")],h);var Z=h;var tt=t=>{if(t==null||isNaN(t))return 0;let e=t+180;return Math.trunc(G(e,360))},Vt=t=>{let e=t;return e==null?0:(typeof e=="string"&&(e=parseInt(e,10)),isNaN(e)?0:G(Math.trunc(e),360)-180)},L=(t,e)=>{if(!t||e.length<3)return;let[r,s,n,l]=e,[d,m]=l===void 0?[1,.25]:[l,.25*l];t.majorLineColor=p.fromArray([r,s,n,d]),t.minorLineColor=p.fromArray([r,s,n,m])};var et=Symbol("grid-interactivity"),a=class extends D.EventedAccessor{constructor(t){super(t),this._drawGraphicTool=null,this._crosshairLabel=null,this._crosshairItem=null,this.snappingManager=null,this.snappingOptions=null,this.view=null,this.placementDisabled=!1,this._mostRecentlyShownGrid=null,this._sketchedVertexCount=0}initialize(){this.addHandles([U(()=>!this.displayEnabled,()=>{this.interactivePlacementState=null}),b(()=>this.view?.viewpoint,()=>{this._renderOverlays()}),b(()=>this.snappingOptions?.gridEnabled,t=>{t!=null&&this.trySetDisplayEnabled(t)}),b(()=>this.view?.grid,(t,e)=>{this._mostRecentlyShownGrid=!t&&e?e:null})])}destroy(){this._resetGridPlacementState(),this._crosshairItem&&(this.view?.overlay?.removeItem(this._crosshairItem),this._crosshairItem=S(this._crosshairItem)),this._crosshairLabel&&(this.view?.overlay?.removeItem(this._crosshairLabel),this._crosshairLabel=S(this._crosshairLabel))}get displayEnabled(){return!!this.view?.grid}get dynamicScaling(){return this.grid?.dynamicScaling??!1}set dynamicScaling(t){this.grid&&(this.grid.dynamicScaling=t)}get grid(){return this.view?.grid??this._mostRecentlyShownGrid}set gridColor(t){this._set("gridColor",t);let[e,r,s,n]=t.toArray();L(this.grid,[e,r,s,n/255])}get gridControlsEnabled(){return this.displayEnabled&&!this.interactivePlacementState}set interactivePlacementState(t){this._set("interactivePlacementState",t),this._resetGridPlacementState(),t&&this._startGridManipulation(t)}get majorLineInterval(){return this.grid?.majorLineInterval??10}set majorLineInterval(t){this.grid&&(this.grid.majorLineInterval=t<1?1:t>15?15:t)}get rotateWithMap(){return this.grid?.rotateWithMap??!1}set rotateWithMap(t){this.grid&&(this.grid.rotateWithMap=t)}get rotation(){return this.grid?.rotation??-180}set rotation(t){this.grid&&(this.grid.rotation=t)}get snappingEnabled(){return(this.grid&&this.snappingOptions?.gridEnabled)??!1}set snappingEnabled(t){let{snappingOptions:e}=this;e&&(e.gridEnabled=t)}get spacing(){return this.grid?.spacing??1}set spacing(t){this.grid&&t>0&&(this.grid.spacing=t)}get unit(){return this.grid?.units}set unit(t){this.grid&&(this.grid.units=t)}get gridOutOfScale(){return!this.dynamicScaling&&this._pixelsPerStride!=null&&this._pixelsPerStride<5}get effectiveSpacingAfterDynamicScaling(){return this.majorLineInterval<1||!this.dynamicScaling||!this.view||this._pixelsPerStride==null||!this.grid?.spacing?null:this.grid.spacing*J(this.majorLineInterval,this._pixelsPerStride,this.dynamicScaling)}get numericSpacingInputShouldBeVisible(){return!!this.view?.spatialReference&&K(this.view.spatialReference)}get _metersPerSRUnit(){if(!(this.view&&this.displayEnabled&&this.grid&&W(this.grid.center.spatialReference,this.view.spatialReference)))return null;let t=F(this.grid.center,this.view.spatialReference);return Q(t)}get _pixelsPerStride(){if(!this.view?.scale||!this.displayEnabled||!this.grid||this._metersPerSRUnit==null)return null;let t=this.grid,{scale:e,spatialReference:r}=this.view;return C(t.spacing,t.units,"meters")/(this._metersPerSRUnit*N(e,r))}get _isPlacing(){if(!this._drawGraphicTool)return!1;let t=this.interactivePlacementState;return t==="place"||t==="interactive"&&this._sketchedVertexCount===0}get _isRotating(){if(!this._drawGraphicTool)return!1;let t=this.interactivePlacementState;return t==="rotate"||t==="interactive"&&this._sketchedVertexCount===1}get _isScaling(){return this._drawGraphicTool?this.interactivePlacementState==="interactive"&&this._sketchedVertexCount===1:!1}togglePlacementState(t){this.interactivePlacementState=this.interactivePlacementState===t?null:t}trySetDisplayEnabled(t){let{view:e}=this;if(e?.ready)if(!e.grid&&t)if(this._mostRecentlyShownGrid)e.grid=this._mostRecentlyShownGrid;else{let r=this.defaultUnit==="imperial"?"feet":"meters";e.grid=new c({units:r,center:e.center??new _,rotateWithMap:!0}),L(this.grid,[115,115,115])}else t||(e.grid=null);else E.getLogger(this).warn("Attempting to enable grid display while view is not ready")}startPlacement(t){let{view:e,snappingManager:r}=this;if(!e)return;this._set("interactivePlacementState",t),this._sketchedVertexCount=0;let s=new X({view:e,graphicProperties:{attributes:{[M]:M}},sketchOptions:{tooltips:{enabled:!0,visibleElements:{direction:!1,rotation:!1,totalLength:!1,elevation:!1,distance:!1,area:!1}}},geometryType:"polyline",mode:"click",snapToScene:!1,snappingManager:r,forceUniformSize:!0,centered:!1,cursor:this.interactivePlacementState==="interactive"||this.interactivePlacementState==="place"?"none":null,regularVerticesSymbol:void 0,activeVertexSymbol:lt,activeLineSymbol:it,graphicSymbol:it});this._drawGraphicTool=s,e.addAndActivateTool(s),this._renderOverlays(),this.addHandles([s.on("cursor-update",n=>this._onCursorUpdate(n)),s.on("complete",()=>this._onDrawComplete()),s.on("vertex-add",n=>this._onVertexAdd(n,t))],et)}_startGridManipulation(t){return k(this,null,function*(){let{view:e}=this;if(!e)return void(this.interactivePlacementState=null);let r=new CustomEvent("before-placement",{cancelable:!0});this.emit("before-placement",r),r.defaultPrevented||this.startPlacement(t)})}_onCursorUpdate(t){try{if(this._isPlacing){let e=t.vertices[0].coordinates;return void this._handlePlace(e)}if(this._drawGraphicTool.cursor=null,this._isRotating&&this._handleRotate(t.vertices[0].coordinates),this._isScaling){let e=this._drawGraphicTool?.drawOperation.cursorVertex;this._handleScale(e)}}finally{this._renderOverlays()}}_onDrawComplete(){this._drawGraphicTool.cursor=null,this.interactivePlacementState=null}_onVertexAdd(t,e){let r=t.vertices[0].coordinates;this._isPlacing&&this._handlePlace(r),this._isRotating&&this._sketchedVertexCount>0&&this._handleRotate(r),this._isScaling&&this._sketchedVertexCount>0&&this._handleScale(R(r[0],r[1],void 0,this.view.spatialReference)),this._sketchedVertexCount++,this._drawGraphicTool.cursor=null,this._sketchedVertexCount!==2&&e==="interactive"||(this.interactivePlacementState=null),this._renderOverlays()}_handlePlace(t){let{grid:e,view:r}=this;e&&r&&(e.center=new _({x:t[0],y:t[1],spatialReference:r.spatialReference}))}_handleRotate(t){let{grid:e,view:r}=this;if(!e||!r)return;this._drawGraphicTool?.sketchOptions.tooltips.set("enabled",!1);let{x:s,y:n}=e.center,[l,d]=t,m=r.toScreen(e.center,{pickClosestTarget:!0}),g=m&&r.toMap(m),y=r.toScreen(R(l,d,void 0,r.spatialReference),{pickClosestTarget:!0}),u=y&&r.toMap(y),f=g?g.x:s,P=g?g.y:n,w=f-(u?u.x:l),O=P-(u?u.y:d);if(w===0&&O===0)return;let rt=Math.atan2(O,w),I=j(rt),ot=e.rotateWithMap,st=r.viewpoint.rotation??0,at=ot?I:I-st;e.rotation=Math.fround(at)%360}_handleScale(t){let{view:e,grid:r,_drawGraphicTool:s,interactivePlacementState:n,_metersPerSRUnit:l}=this;if(!(t&&e&&r&&s&&l))return;s.sketchOptions.tooltips.enabled=!1;let d=n==="interactive"?r.center:s.drawOperation.firstVertex;if(!d||!t)return;let m=e?.toScreen(d),g=m&&e.toMap(m),y=e?.toScreen(t),u=g??d,f=(y&&e.toMap(y))??t,P=Math.sqrt((u.x-f.x)**2+(u.y-f.y)**2),w=C(P*l,"meters",r.units);this.spacing=w}_renderOverlays(){this._renderCrosshairOverlay(),this._renderTextOverlay()}_renderTextOverlay(){let{grid:t,view:e,_drawGraphicTool:r}=this,s=this._getCrosshairLabel();if(!(t&&e?.overlay&&r&&s))return;let n=e.toScreen(t.center,{pickClosestTarget:!0});n&&(s.position=[n.x+12,n.y+12]),this._isRotating?(s.text=`${tt(t.rotation)}${Y}`,s.visible=!0):s.visible=!1}_renderCrosshairOverlay(){let{grid:t,view:e,_drawGraphicTool:r}=this;if(!t||!e?.overlay||!r)return;let s=this._getCrosshair();if(!s)return;let n=e.toScreen(t.center);n&&(s.x=n.x,s.y=n.y,s.rotation=t.rotateWithMap?e.viewpoint.rotation-t.rotation:-t.rotation,s.visible=!!r)}_getCrosshairLabel(){if(this._crosshairLabel)return this._crosshairLabel;let{grid:t,view:e,_drawGraphicTool:r}=this;if(!t||!e?.overlay||!r)return null;let s=new B({anchor:"top-left",fontSize:10,textColor:new p([21,21,21]),backgroundColor:new p([248,248,248]),padding:8,borderRadius:20});return e.overlay.addItem(s),this._crosshairLabel=s,s}_getCrosshair(){let{_crosshairItem:t,view:e}=this;return e?.overlay?t&&e.overlay.items.includes(t)?t:(this._crosshairItem=new Z({color:e.effectiveTheme.accentColor,thickness:4,length:36,visible:!0}),e.overlay?.addItem(this._crosshairItem),this._crosshairItem):null}_resetGridPlacementState(){this.removeHandles(et),this._crosshairItem&&(this._crosshairItem.visible=!1),this._crosshairLabel&&(this._crosshairLabel.visible=!1),this._drawGraphicTool&&(this.view?.activeTool===this._drawGraphicTool&&(this.view.activeTool=null),this.view?.tools.remove(this._drawGraphicTool)),this._drawGraphicTool=S(this._drawGraphicTool)}};i([o(z)],a.prototype,"defaultUnit",void 0),i([o({readOnly:!0})],a.prototype,"displayEnabled",null),i([o()],a.prototype,"dynamicScaling",null),i([o()],a.prototype,"grid",null),i([o({type:p})],a.prototype,"gridColor",null),i([o({readOnly:!0})],a.prototype,"gridControlsEnabled",null),i([o()],a.prototype,"interactivePlacementState",null),i([o()],a.prototype,"majorLineInterval",null),i([o()],a.prototype,"rotateWithMap",null),i([o()],a.prototype,"rotation",null),i([o()],a.prototype,"snappingEnabled",null),i([o()],a.prototype,"snappingManager",void 0),i([o({type:q})],a.prototype,"snappingOptions",void 0),i([o()],a.prototype,"spacing",null),i([o()],a.prototype,"unit",null),i([o()],a.prototype,"view",void 0),i([o({readOnly:!0})],a.prototype,"gridOutOfScale",null),i([o({readOnly:!0})],a.prototype,"effectiveSpacingAfterDynamicScaling",null),i([o({readOnly:!0})],a.prototype,"numericSpacingInputShouldBeVisible",null),i([o()],a.prototype,"placementDisabled",void 0),i([o()],a.prototype,"_metersPerSRUnit",null),i([o()],a.prototype,"_pixelsPerStride",null),i([o()],a.prototype,"_isPlacing",null),i([o()],a.prototype,"_isRotating",null),i([o()],a.prototype,"_isScaling",null),i([o()],a.prototype,"_mostRecentlyShownGrid",void 0),i([o()],a.prototype,"_sketchedVertexCount",void 0),a=i([v("esri.widgets.support.GridControls.GridControlsViewModel")],a);var ge=a,it=new T({width:0}),lt=new H({color:p.fromArray([0,0,0,0]),outline:new T({color:p.fromArray([0,0,0,0])})});export{tt as a,Vt as b,ge as c};
