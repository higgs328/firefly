import{a as H,b as Q,d as X,e as Y,g as _,n as ee}from"./chunk-MOUPZWB7.js";import{b as te,e as ae}from"./chunk-DVXTNDEK.js";import{a as q,j as J,l as K,s as $,t as R}from"./chunk-TVZYM2NN.js";import"./chunk-TI4UXDNK.js";import"./chunk-YYU4WDV7.js";import"./chunk-U445SEXM.js";import"./chunk-TSQO2JBH.js";import"./chunk-6ZSOJV5L.js";import"./chunk-D7UZS622.js";import{a as W}from"./chunk-PWCKLYPC.js";import{a as p,d as I,e as D,g as P}from"./chunk-GYQWYHEG.js";import{b as O}from"./chunk-JC4DQSN3.js";import"./chunk-D43YNUSN.js";import"./chunk-QZ7GU4N4.js";import"./chunk-XBSD6EUF.js";import"./chunk-ES4WUTEM.js";import"./chunk-BC7GBJHB.js";import"./chunk-WBPLJNRU.js";import"./chunk-EBLTZITF.js";import"./chunk-GUIIGAD3.js";import"./chunk-SFSN6ZUK.js";import"./chunk-H2NTHPNN.js";import"./chunk-E2J2V7JN.js";import"./chunk-XOMCYIPA.js";import"./chunk-N2JUYKXN.js";import"./chunk-7U52UAO2.js";import"./chunk-NIRJWS2D.js";import"./chunk-H3ZWZZ2B.js";import"./chunk-M3TNQKVJ.js";import"./chunk-KLZGQ7M6.js";import"./chunk-N36GL6VL.js";import"./chunk-UX3QUEDM.js";import"./chunk-YZJDOXQC.js";import{a as U}from"./chunk-6ZY36ZHO.js";import"./chunk-6RHGQ4Z5.js";import"./chunk-G23ELQMS.js";import"./chunk-PZOK2JKH.js";import"./chunk-FJUYECJ6.js";import"./chunk-GAVFKWSK.js";import"./chunk-DK4DGLAO.js";import{t as j}from"./chunk-ZM24RY22.js";import"./chunk-7Y6S2GNA.js";import"./chunk-VOB6IBIW.js";import"./chunk-63B3IOWG.js";import"./chunk-PE276TWH.js";import"./chunk-BMZ3PE5Y.js";import"./chunk-EHG7JRYJ.js";import"./chunk-FNY6LFKI.js";import"./chunk-BBB7KLHV.js";import"./chunk-J2AEVBSH.js";import"./chunk-5ODXFRPI.js";import"./chunk-E5QCV5LT.js";import"./chunk-QS3EYJPF.js";import"./chunk-HJJZ2AXH.js";import"./chunk-TPNSUEHH.js";import"./chunk-SMVNQSZ4.js";import"./chunk-Z2QGLRDB.js";import"./chunk-7IDFDPA3.js";import"./chunk-VL2YL74P.js";import"./chunk-P2AJD2R2.js";import{c as A}from"./chunk-UMJIJLDA.js";import"./chunk-E5NFS3KN.js";import"./chunk-HQHD6BMN.js";import"./chunk-AIKKGGPG.js";import"./chunk-RDGG4TVD.js";import"./chunk-3IQFPOUU.js";import"./chunk-I4CY6X6S.js";import"./chunk-VQ4QGNRX.js";import{b as M}from"./chunk-GNEAU6X4.js";import"./chunk-4KXJ537H.js";import"./chunk-JIRULGDT.js";import"./chunk-QJGOWIJD.js";import"./chunk-QML26MQC.js";import"./chunk-RNZY2XUD.js";import"./chunk-JXPUHKCT.js";import"./chunk-XR5FT7TQ.js";import"./chunk-4YTM754S.js";import"./chunk-LAX5536Z.js";import"./chunk-N3HRYLNW.js";import"./chunk-4DBMALZW.js";import"./chunk-CVWWHM2V.js";import"./chunk-6OQYVEQJ.js";import"./chunk-YOXOWGT6.js";import"./chunk-EFZOSMYP.js";import"./chunk-WI7F4ZKJ.js";import"./chunk-MJ7M24NH.js";import"./chunk-GJH4QFRX.js";import"./chunk-T63F7663.js";import"./chunk-O4V2VBSK.js";import"./chunk-5TKRKB5E.js";import"./chunk-XAGMDNNR.js";import"./chunk-OP2TLIUN.js";import"./chunk-T2THIR6K.js";import"./chunk-LORHDXEB.js";import"./chunk-BBBPJI4H.js";import"./chunk-45BTW5EG.js";import"./chunk-TPFBHGDM.js";import"./chunk-73NLRHJD.js";import"./chunk-PNFEUBDF.js";import"./chunk-6RCCEJDL.js";import"./chunk-PQ2TNDUX.js";import"./chunk-6X6MKRQ3.js";import"./chunk-FQFHMHYU.js";import"./chunk-SZMEI3WL.js";import"./chunk-KKVGD67U.js";import"./chunk-MYOJWRDU.js";import"./chunk-L7UKJKHG.js";import"./chunk-V2IENAEU.js";import"./chunk-QAGQFNF2.js";import"./chunk-SY7JS2VW.js";import"./chunk-WK57SDN6.js";import"./chunk-AG4V3ZUO.js";import"./chunk-YWLMJ26A.js";import"./chunk-QAWNU3UJ.js";import"./chunk-HRQT4R6X.js";import"./chunk-44BHLWQ4.js";import"./chunk-5BPM64SU.js";import"./chunk-PMVHHMQJ.js";import"./chunk-NAFOM5UA.js";import"./chunk-DO7UF2F2.js";import"./chunk-ZTR6OS44.js";import"./chunk-VRTKAD2J.js";import"./chunk-DBLKLHK2.js";import"./chunk-UTE3ASAZ.js";import"./chunk-2AFEAPEX.js";import"./chunk-GNGXUEWV.js";import"./chunk-QBI5NDCA.js";import"./chunk-NOHW2DKR.js";import"./chunk-HVJAAM3A.js";import"./chunk-ACPEJEHK.js";import"./chunk-I7B3LWNP.js";import"./chunk-YP2E5N4E.js";import"./chunk-QLMNLSCT.js";import"./chunk-P55G5ATK.js";import"./chunk-JT3K52KQ.js";import"./chunk-SPLEGG4R.js";import"./chunk-Y4TJDUGP.js";import"./chunk-6PAFOJ4W.js";import"./chunk-74SDGE57.js";import"./chunk-FRXWHX3T.js";import"./chunk-DTDQ5X42.js";import"./chunk-RX2HFR4X.js";import"./chunk-AZW7YPTQ.js";import"./chunk-NJLJX4X6.js";import"./chunk-DZHFTD24.js";import"./chunk-K57Z4J34.js";import"./chunk-VWG3KVOU.js";import"./chunk-JOEUVLAN.js";import"./chunk-JZQDGIDQ.js";import"./chunk-CZ6CGC7I.js";import"./chunk-7B6U3N62.js";import"./chunk-46WDO5LS.js";import"./chunk-G5EYK5KM.js";import"./chunk-YJKJQU3F.js";import"./chunk-OK4K3OQT.js";import"./chunk-BPWNCOXC.js";import"./chunk-VNS4CQ27.js";import"./chunk-AVMO6LCR.js";import"./chunk-TEGPMVWT.js";import"./chunk-CLQRQC3Y.js";import"./chunk-KSNU73LO.js";import"./chunk-FACEVGRE.js";import"./chunk-5XTCPT52.js";import"./chunk-72MRWGPJ.js";import"./chunk-2GF6YDKP.js";import"./chunk-DDZ3KR2Q.js";import"./chunk-R3XLNYYB.js";import"./chunk-2HYVVLKS.js";import"./chunk-XRTA5GHC.js";import"./chunk-Y6XW36QP.js";import"./chunk-ZXKU6WBY.js";import"./chunk-RBVFFAW6.js";import"./chunk-XQOE7Z4Q.js";import"./chunk-BMYVPMAK.js";import"./chunk-6F25LG6O.js";import"./chunk-6KRFVLII.js";import"./chunk-EDZQZA57.js";import"./chunk-V6AA2XHK.js";import"./chunk-25WBXAEY.js";import"./chunk-7QY3BMVN.js";import"./chunk-Y7GY5YIF.js";import"./chunk-LMGYHZE3.js";import"./chunk-5LG2P6MT.js";import"./chunk-GJ2QRXGN.js";import"./chunk-EM35R6FY.js";import"./chunk-QXXXCEV5.js";import"./chunk-TJ6P6NLD.js";import"./chunk-NX5B6XBR.js";import"./chunk-2JABY6DU.js";import"./chunk-MPRKSQLC.js";import"./chunk-57TARQ4F.js";import"./chunk-6RBQSBA2.js";import"./chunk-Z42K5ECK.js";import"./chunk-NVTU6MJO.js";import"./chunk-56M6LBCJ.js";import"./chunk-HZK6UIET.js";import"./chunk-T2RV3ABV.js";import"./chunk-CSNRCIB5.js";import"./chunk-6FW4T2SJ.js";import"./chunk-4ZVBFHBA.js";import"./chunk-3JGYBNJA.js";import"./chunk-DA3SDKGO.js";import"./chunk-ZOEPYNM4.js";import"./chunk-57VFBGF3.js";import"./chunk-GWBRHLNH.js";import"./chunk-BJH4F4SM.js";import"./chunk-Z3RBZHAK.js";import"./chunk-F4XWARLZ.js";import{k as N,l as Z}from"./chunk-IO35PPBL.js";import{c as G,g as L}from"./chunk-F5AJITOA.js";import"./chunk-IHATPE6U.js";import"./chunk-PU4AK46X.js";import"./chunk-3CLJ5OX5.js";import"./chunk-E6C7G5SC.js";import"./chunk-73K3NWCV.js";import"./chunk-SP2CO3KX.js";import"./chunk-PTZYZULI.js";import"./chunk-NMLYCCKN.js";import"./chunk-FYZRIMPP.js";import"./chunk-ZC6EBRE4.js";import"./chunk-ZAZJB7CV.js";import"./chunk-KALOJIUA.js";import{b as k}from"./chunk-KMMTNF7G.js";import"./chunk-E7AX56GD.js";import"./chunk-IDVLLREH.js";import"./chunk-DWLSVYOY.js";import"./chunk-PQGCNP5H.js";import"./chunk-UASS7NJI.js";import"./chunk-WZRAC35O.js";import"./chunk-KUYAWYSS.js";import"./chunk-MIS6QMFE.js";import"./chunk-MDZTV2VL.js";import"./chunk-RNC4P66O.js";import"./chunk-7LHOQXZT.js";import"./chunk-BCREO4Q5.js";import"./chunk-U4QEPZJ3.js";import"./chunk-KJUZWSCL.js";import"./chunk-3WO6D7MU.js";import"./chunk-BUZ3SPLE.js";import"./chunk-K75TK42V.js";import"./chunk-CELWVZPW.js";import"./chunk-VV5G7VY5.js";import"./chunk-OLOKUDVI.js";import"./chunk-DYTVXYAV.js";import"./chunk-ZTOZWLEE.js";import"./chunk-RJWOVI3M.js";import"./chunk-RSDQHAJX.js";import"./chunk-BOVYXYHK.js";import"./chunk-KVM6SHDX.js";import"./chunk-POX73EYJ.js";import"./chunk-NKUXRYJG.js";import"./chunk-HX2VGIR2.js";import"./chunk-ERDKAICI.js";import"./chunk-EQZWYK27.js";import"./chunk-JLPLCY2B.js";import"./chunk-DKGGDYJI.js";import"./chunk-5LA3PVK5.js";import"./chunk-IR6XCBC4.js";import"./chunk-C6JPAW54.js";import"./chunk-WD3OPXCN.js";import"./chunk-FA3WGIU4.js";import"./chunk-WWVPA6PE.js";import"./chunk-ZQIC5NFT.js";import"./chunk-VIEK2X23.js";import"./chunk-XKIFGPJO.js";import"./chunk-PEW2PLAN.js";import"./chunk-Q6Y4JG7Q.js";import"./chunk-7F5DJLJT.js";import"./chunk-CX5IFQZJ.js";import"./chunk-NJWTSROP.js";import"./chunk-D3R25AF2.js";import"./chunk-ARRCN5K3.js";import"./chunk-O3EGNJTY.js";import"./chunk-4N4D2YQX.js";import"./chunk-G4DZJMGT.js";import"./chunk-WTB3O6DJ.js";import"./chunk-7P44K2YD.js";import"./chunk-32OAXCA4.js";import"./chunk-UST6HCE7.js";import"./chunk-K5T5FD5C.js";import"./chunk-MVHHPJM7.js";import"./chunk-VDO6JJ3Y.js";import"./chunk-WFKZLI6F.js";import"./chunk-X2B63YVS.js";import"./chunk-BAEF3CT6.js";import"./chunk-AUAZP44J.js";import"./chunk-PVDFCTA4.js";import"./chunk-KNVXE32P.js";import"./chunk-76ATOSLU.js";import"./chunk-CCJU4DSH.js";import"./chunk-TG45K3WR.js";import"./chunk-RAI4DTMT.js";import"./chunk-ACP3S2CH.js";import"./chunk-HVAXZ2NA.js";import"./chunk-T7DXJKX7.js";import"./chunk-TYYVNQUR.js";import"./chunk-QGVBCWUY.js";import"./chunk-MYO4NP2N.js";import"./chunk-NFIPKH6V.js";import"./chunk-JPU2PQZC.js";import"./chunk-5QEXLALV.js";import"./chunk-P6QFA5MM.js";import"./chunk-DGTD7Y73.js";import"./chunk-LI2SX4T6.js";import"./chunk-BWO7LS2H.js";import"./chunk-HEVQSRJ2.js";import"./chunk-OVHPPCBL.js";import"./chunk-SNFOAZZQ.js";import"./chunk-AML4XSEF.js";import"./chunk-4PTIEWMT.js";import"./chunk-TG2UTNEO.js";import{b as v}from"./chunk-YOFFGXOB.js";import"./chunk-XRGPJ3QY.js";import"./chunk-6MRUJ2UW.js";import"./chunk-2LI2GKBQ.js";import"./chunk-QBWJMFH5.js";import{a as E,b as B,c as z,f as g}from"./chunk-VTHXE323.js";function T(e,a=5){let t=Math.round(e);if(t<=1)return 1;let s=t.toString().length;for(let n=s-1>=3?3:s-1;n>=0;n--){let r=10**n,i=Math.floor(e/r)*r,d=Math.ceil(e/r)*r,m=Math.round((i+d)/2),u=Math.abs(e-i)/e*100,l=Math.abs(e-d)/e*100,o=Math.abs(e-m)/e*100,c=Math.min(u,l,o);if(c<=a){if(c===u){t=i;break}if(c===l){t=d;break}if(c===o){t=m;break}}}return t}function fe(e){return g(this,null,function*(){if(!(e&&e.layer&&e.attributes))throw new v("summary-statistics-for-attributes:missing-parameters","'layer' and 'attributes' parameters are required");if(e.attributes.some(c=>!!c.valueExpression)&&!e.view)throw new v("summary-statistics-for-attributes:missing-parameters","View is required when 'valueExpression' is specified in attributes");e.forBinning&&O(e,"summary-statistics-for-attributes");let o=e,{layer:a}=o,t=z(o,["layer"]),s=[p.CSVLayer,p.FeatureLayer,p.OGCFeatureLayer,p.GeoJSONLayer,p.KnowledgeGraphSublayer,p.ParquetLayer,p.WFSLayer],n=e.forBinning?I:s,r=P(a,n,e.forBinning);if(!r)throw new v("summary-statistics-for-attributes:invalid-parameters","'layer' must be one of these types: "+D(n).join(", "));let i=E({layerAdapter:r},t);i.includeZeros=i.includeZeros==null||i.includeZeros,i.includeNegatives=i.includeNegatives==null||i.includeNegatives;let d=i.view,m=i.signal!=null?{signal:i.signal}:null;yield Promise.all([d?.when(),r.load(m)]);let u=[];for(let c of i.attributes){let f=yield L({field:c.field,valueExpression:c.valueExpression});Array.prototype.push.apply(u,f)}let l=N(r,u,"summary-statistics-for-attributes:invalid-parameters");if(l)throw l;return i})}function re(e){return g(this,null,function*(){let n=yield fe(e),{layerAdapter:a}=n,t=z(n,["layerAdapter"]),s=Z(t.attributes,t.includeZeros,t.includeNegatives);return a.summaryStatistics({valueExpression:s.valueExpression,sqlExpression:s.sqlExpression,sqlWhere:s.sqlWhere,view:t.view,filter:t.filter,outStatisticTypes:G,signal:t.signal})})}function ie(e,a,t){return e!=null&&isFinite(e)&&((a??!0)||e!==0)&&((t??!0)||e>=0)}function ne(e){return g(this,null,function*(){let{features:a,attributes:t,includeZeros:s,includeNegatives:n,view:r}=e,i=0,d=0,m=1/0,u=-1/0,l=null,o=new Map;for(let f=0;f<t.length;f++){let{valueExpression:y}=t[f];if(y){if(!l){let{arcadeUtils:w}=yield k();l=w}o.set(f,l.createFunction(y))}}let c=r?l?.getViewInfo({viewingMode:r.type==="2d"?"map":r.viewingMode,scale:r.scale,spatialReference:r.spatialReference}):null;for(let f of a){let y=f.geometry,w=f.attributes;if(y){let h=y.extent;if(h){let V=h.width*h.height;if(V>0){let x=0,S=l?.createExecContext(f,c,r?.timeZone);for(let b=0;b<t.length;b++){let{field:C,valueExpression:me}=t[b],F=null;if(C)F=w[C];else if(me){let ce=o.get(b);F=l.executeFunction(ce,S)}ie(F,s,n)&&(x+=F||0)}if(ie(x,s,n)){let b=x/V;++i,d+=b,b<m&&(m=b),b>u&&(u=b)}}}}}return{minDensity:m!==1/0?m:null,maxDensity:u!==-1/0?u:null,avgDensity:i?d/i:null}})}var se=500;function le(e){return g(this,null,function*(){let a=e.view;if(!(e?.layer&&a&&e.attributes?.length))throw new v("dot-density-renderer:missing-parameters","'layer', 'view' and 'attributes' parameters are required");if(e.attributes.length>8)throw new v("dot-density-renderer:invalid-parameters","Dot density renderer does not support more than 8 attributes");e.forBinning&&O(e,"dot-density-renderer");let t=B(E({},e),{view:a,layer:e.layer,attributes:e.attributes}),s=[p.FeatureLayer,p.ParquetLayer,p.KnowledgeGraphSublayer,p.OGCFeatureLayer,p.GeoJSONLayer,p.WFSLayer],n=e.forBinning?I:s,r=P(t.layer,n,e.forBinning);if(!r)throw new v("dot-density-renderer:invalid-parameters","'layer' must be one of these types: "+D(n).join(", "));t.dotBlendingEnabled??=!0,t.dotValueOptimizationEnabled??=!0;let i=t.signal!=null?{signal:t.signal}:null;if(yield Promise.all([a.when(),r.load(i)]),r.geometryType!=="polygon")throw new v("dot-density-renderer:not-supported","Dot density renderer is supported for polygon layers only");let d=[],m=t.attributes;for(let l of m){let o=yield L({field:l.field,valueExpression:l.valueExpression});d.push(...o)}let u=K(r,d.filter(Boolean),"dot-density-renderer:invalid-parameters");if(u)throw u;return B(E({},t),{layer:r})})}function pe(e){return g(this,null,function*(){let a="regenerate-dot-density-renderer";yield H(e,a);let t=yield Q(e);if(X(t)!=="dot-density")throw new v(`${a}:invalid-parameters`,"Renderer is invalid");let{layer:s,forBinning:n,filter:r,view:i,signal:d}=e,m=Y(t),u=t.attributes.map(o=>({field:o.field,valueExpression:o.valueExpression,label:o.label,valueExpressionTitle:o.valueExpressionTitle})),l=yield le({layer:s,attributes:u,dotValueOptimizationEnabled:t.referenceScale!=null,outlineOptimizationEnabled:m,forBinning:n,filter:r,view:i,signal:d});return B(E({},e),{creatorParameters:l,renderer:t})})}function ye(e){return g(this,null,function*(){let a=e.dotDensityScheme,t=null,s=null,n=yield $(e.basemap,e.view);if(t=n.basemapId!=null?n.basemapId:null,s=n.basemapTheme!=null?n.basemapTheme:null,a)return{scheme:ae(a),basemapId:t,basemapTheme:s};let r=te({numColors:e.attributes.length,basemapTheme:s});return r&&(a=r.primaryScheme,t=r.basemapId,s=r.basemapTheme),{scheme:a,basemapId:t,basemapTheme:s}})}function oe(e){return{dotValue:1,referenceScale:e.scale,minSliderValue:1,maxSliderValue:100}}function ue(e){return g(this,null,function*(){let{view:a,layer:t,attributes:s,signal:n,filter:r}=e,i=yield t.getSampleFeatures({view:a,sampleSize:se,returnGeometry:!0,filter:r,signal:n},"json"),[d,m]=yield Promise.all([W({features:i,geometryType:t.geometryType}),re({layer:t,attributes:s,filter:r,includeZeros:!1,includeNegatives:!1,view:a,signal:n})]),u=d!=null&&"avgSize"in d&&d.avgSize,l=m.avg;if(!u||!l)return oe(a);let o=M(a.scale,a.spatialReference);return{dotValue:T(l/(u*u/(o*o)*.1))||1,referenceScale:a.scale,minSliderValue:1,maxSliderValue:T(l)}})}function de(e){return g(this,null,function*(){let{view:a,layer:t,attributes:s,signal:n,filter:r}=e,i=[];for(let h of s){let V=yield L({field:h.field,valueExpression:h.valueExpression});i.push(...V)}let d=yield t.getSampleFeatures({view:a,sampleSize:se,requiredFields:i,filter:r,returnGeometry:!0,signal:n},"json"),{minDensity:m,maxDensity:u,avgDensity:l}=yield ne({features:d,attributes:s,includeZeros:!1,includeNegatives:!1,view:a});if(!l||!m||!u)return oe(a);let o=M(a.scale,a.spatialReference),c=o*o,f=T(m*c),y=T(u*c),w=T(l*c*10)||1;return w>y&&(w=y),{dotValue:w,referenceScale:a.scale,minSliderValue:f,maxSliderValue:y}})}function Ue(e){return g(this,null,function*(){let a=yield le(e),t=a.layer,s=t.geometryType,n=yield ye(a),r=n?.scheme;if(!r)throw new v("dot-density-renderer:insufficient-info","Unable to find dot-density scheme");let i=a.view,d=a.filter,m={layer:t,view:i,filter:d,attributes:a.attributes,signal:a.signal},u={layer:a.layer,view:i,filter:d,signal:a.signal},[l,o]=yield Promise.all([a.trueDensity?de(m):ue(m),a.outlineOptimizationEnabled?q(u).catch(R):null]),{dotValue:c,referenceScale:f,minSliderValue:y,maxSliderValue:w}=l,h=j(r.colors,a.attributes.length),V=a.attributes.map((S,b)=>({field:S.field,valueExpression:S.valueExpression,label:S.label,valueExpressionTitle:S.valueExpressionTitle,color:h[b]})),x=new U({attributes:V,dotBlendingEnabled:a.dotBlendingEnabled,outline:o?J(r,s,o.opacity):null,dotValue:c,referenceScale:a.dotValueOptimizationEnabled?f:null,legendOptions:a.legendOptions});return o?.visualVariables.length&&(x.visualVariables=o.visualVariables.map(S=>S.clone())),x.authoringInfo=new A({type:"dot-density",minSliderValue:y,maxSliderValue:w}),{renderer:x,dotDensityScheme:r,basemapId:n.basemapId,basemapTheme:n.basemapTheme}})}function ke(e){return g(this,null,function*(){let{creatorParameters:a,renderer:t}=yield pe(e),{layer:s,attributes:n,outlineOptimizationEnabled:r,view:i,signal:d,filter:m}=a,u={layer:s,view:i,filter:m,attributes:n,signal:d},[l,o]=yield Promise.all([a.trueDensity?de(u):ue(u),r?q({layer:s,view:i,signal:d,filter:m}).catch(R):null]),{dotValue:c,referenceScale:f,minSliderValue:y,maxSliderValue:w}=l;return t.dotValue=c,t.referenceScale=a.dotValueOptimizationEnabled?f:null,t.authoringInfo&&(t.authoringInfo.minSliderValue=y,t.authoringInfo.maxSliderValue=w),ee(t,o?.visualVariables,_),{renderer:t}})}export{Ue as createRenderer,ke as regenerateRenderer};
