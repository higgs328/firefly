import{a as y}from"./chunk-E424TX4V.js";import{y as N}from"./chunk-QBWJMFH5.js";import{a as D,b as T}from"./chunk-VTHXE323.js";function C(e,t,a){let l=t.shift();if(a.length===0){let n=[];a.push({sliceId:-1,multidimensionalDefinition:n})}let i=a.length;for(let n=0;n<i;n++){let s=a.shift().multidimensionalDefinition;l.values?.forEach(r=>{a.push({sliceId:-1,multidimensionalDefinition:[...s,{variableName:e,dimensionName:l.name,values:[r]}]})})}t.length&&C(e,t,a)}function J(e,t){let a=[],l=0;return(t?e.variables.filter(i=>i.name.toLowerCase()===t.toLowerCase()):[...e.variables].sort((i,n)=>i.name>n.name?1:-1)).forEach(i=>{let n=[],s=[...i.dimensions].sort((r,m)=>r.name>m.name?-1:1);C(i.name,s,n),n.forEach(r=>{a.push(T(D({},r),{sliceId:l++}))})}),a}function P(e,t,a){let l=e;if(t&&(t=[...t].sort((i,n)=>i.dimensionName<n.dimensionName?-1:1)).forEach(({dimensionName:i,values:n,isSlice:s})=>{n.length&&(l=l.filter(r=>{let m=r.multidimensionalDefinition.find(u=>u.dimensionName===i);if(m==null)return!1;let o=m.values[0];return typeof o=="number"?typeof n[0]=="number"?n.includes(o):n.some(u=>u[0]<=o&&u[1]>=o):typeof n[0]=="number"?n.some(u=>o[0]<=u&&o[1]>=u):s?n.some(u=>u[0]===o[0]&&u[0]===o[1]):n.some(u=>u[0]>=o[0]&&u[0]<=o[1]||u[1]>=o[0]&&u[1]<=o[1]||u[0]<o[0]&&u[1]>o[1])}))}),l.length&&a?.start!=null&&a.end!=null){let i=a.start.getTime(),n=a.end.getTime(),s=l[0].multidimensionalDefinition.findIndex(r=>r.dimensionName==="StdTime");s>-1&&(l=l.filter(r=>{let m=r.multidimensionalDefinition[s].values[0];return i<=m&&n>=m}))}return l.map(i=>i.sliceId)}function x(e,t){return Array.isArray(e)?t[0]===t[1]?e[0]===t[0]||e[1]===t[0]:e[0]>=t[0]&&e[0]<=t[1]&&e[1]>=t[0]&&e[1]<=t[1]:e>=t[0]&&e<=t[1]}function Y(e,t){return e[0]<=t[0]&&e[1]>=t[0]||e[0]<=t[1]&&e[1]>=t[1]||e[0]>=t[0]&&e[1]<=t[1]}function U(e){return e.length===1?[e[0],e[0]]:[e[0],e[e.length-1]]}function p(e,t,a){if(!t?.subsetDefinitions?.length)return e;let l;if(a){let{variables:s}=t;if(s.length&&!s.includes(a))return null;let r=t.subsetDefinitions.find(m=>m.dimensionName===e.name&&m.variableName===a);if(!r?.values?.length)return e;l=U(r.values)}else l=t.dimensions.find(({name:r})=>r===e.name)?.extent;let i=l;if(!i?.length)return e;let n=e.values.filter(s=>x(s,i));return T(D({},e),{extent:[...i],values:n})}function M(e,t,a){if(!t?.subsetDefinitions?.length)return!1;let{variables:l}=t;if(l.length&&e.some(({variableName:i})=>i&&!l.includes(i)))return!0;for(let i=0;i<e.length;i++){let n=e[i],s=t.subsetDefinitions.find(r=>(n.variableName===""||r.variableName===n.variableName)&&r.dimensionName===n.dimensionName);if(s?.values.length){let r=U(s.values);if(!n.isSlice&&n.values.length===2&&!Array.isArray(n.values[0])&&n.values[0]!==n.values[1]&&a){if(!Y(n.values,r))return!0}else if(n.values.some(m=>!x(m,r)))return!0}}return!1}function j(e,t){if(e==null)return{isOutside:!1};let{geometry:a,timeExtent:l,multidimensionalDefinition:i}=t,n=null;if(l!=null&&(n=O(e,l),n==null))return{isOutside:!0};let{areaOfInterest:s}=e;if(s&&a){let r=a.type==="point"?a:a.type==="extent"?a.center:a.type==="polygon"?a.centroid:null;if(r&&!s.contains(r))return{isOutside:!0}}return i!=null&&i.length&&M(i,e,!0)?{isOutside:!0}:{isOutside:!1,intersection:{geometry:a,timeExtent:n,multidimensionalDefinition:i}}}function O(e,t){let a=e.dimensions.find(({name:s})=>s==="StdTime");if(a==null||t.start==null&&t.end==null)return t;t=t.clone();let{start:l,end:i}=t.toJSON(),n=l===i?[l]:l!=null&&i!=null?[l,i]:[l??i];return n.length===2&&a?.extent.length&&(n[0]=Math.max(n[0],a.extent[0]),n[1]=Math.min(n[1],a.extent[1]??a.extent[0]),n[1]<n[0])||M([new y({variableName:"",dimensionName:"StdTime",isSlice:n.length===1,values:n})],e,!0)?null:(t.start=new Date(n[0]),t.end=new Date(n[1]??n[0]),t)}function q(e){let{rasterInfo:t,multidimensionalSubset:a}=e,{multidimensionalInfo:l}=t;if(l==null)return null;let i=e.multidimensionalDefinition?.length?e.multidimensionalDefinition:w(t,{multidimensionalSubset:a});if(!i?.length)return null;if(i.some(s=>!s.dimensionName)){let{variableName:s}=i[0],r=w(t,{multidimensionalSubset:a,variableName:s});r?.forEach(m=>{let o=i?.find(({dimensionName:u})=>u===m.dimensionName);o?.values?.length&&(m.values=o.values,m.isSlice=o.isSlice)}),i=r}let{timeExtent:n}=e;if(i!=null&&n!=null&&(n.start!=null||n.end!=null)){i=i.map(h=>h.clone());let s=l.variables.find(({name:h})=>h===i[0].variableName)?.dimensions?.find(({name:h})=>h==="StdTime"),r=i.find(({dimensionName:h})=>h==="StdTime");if(!s||!r)return null;let{start:m,end:o}=n,u=m==null?null:m.getTime(),g=o==null?null:o.getTime(),c=u??g,d=g??u;if(s.values!=null){let h=s.values.filter(f=>{if(Array.isArray(f)){if(c===d)return f[0]<=c&&f[1]>=c;let v=f[0]<=c&&f[1]>c||f[0]<d&&f[1]>=d,b=f[0]>=c&&f[1]<=d||f[0]<c&&f[1]>d;return v||b}return c===d?f===c:f>=c&&f<=d});if(h.length){let f=h.sort((v,b)=>{let A=Array.isArray(v)?v[0]:v,k=Array.isArray(v)?v[1]:v,I=Array.isArray(b)?b[0]:b,F=Array.isArray(b)?b[1]:b;return c===d?A-I:Math.abs(k-d)-Math.abs(F-d)})[0];r.values=[f]}else i=null}else if(s.hasRegularIntervals&&s.extent){let[h,f]=s.extent;c>f||d<h?i=null:r.values=c===d?[c]:[Math.max(h,c),Math.min(f,d)]}}return i!=null&&M(i,a)?null:i}function E(e,t={}){let{multidimensionalInfo:a,keyProperties:l}=e;if(a==null)return null;let{variableName:i,multidimensionalSubset:n,multidimensionalDefinition:s}=t,r=s!=null?s[0]?.variableName:null,m=i||r||l?.DefaultVariable,{variables:o}=a;return n?.variables?.length&&(o=o.filter(({name:u})=>n.variables.includes(u))),m?o.find(({name:u})=>u===m)??o[0]:o[0]}function w(e,t={}){let a=E(e,t);if(!a)return null;let l=[],{dimensions:i,name:n}=a;if(i.length===0)return[new y({variableName:n,dimensionName:"",values:[],isSlice:!0})];for(let s=0;s<i.length;s++){let r=p(i[s],t.multidimensionalSubset,n);if(!r)return null;let{values:m,extent:o}=r,u=m?.[0]??o?.[0];r.name.toLowerCase()==="stdz"&&!r.hasRanges&&o&&Math.abs(o[1])<=Math.abs(o[0])&&(u=m?.length?m[m.length-1]:o[1]),l.push(new y({variableName:n,dimensionName:r.name,values:[u],isSlice:!t.useRangeForRangedDimensionInfo||!!r.hasRanges}))}return l}function B(e){return!!e?.length&&e.some(t=>{if(t.values==null)return!0;let a=t.values.length;return a===0||a>1||!t.isSlice&&Array.isArray(t.values[0])})}function G(e,t){if(t==null||e==null)return null;let a=t.variables.map(l=>D({},l));return e?.variables?.length&&(a=a.filter(({name:l})=>e.variables.includes(l)),a.forEach(l=>{l.dimensions=l.dimensions.map(i=>p(i,e,l.name)).filter(N)})),a}function L(e,t){let{values:a}=t;if(a?.length){let r=Array.isArray(a[0]),m=Array.isArray(e);return r!==m?-1:r&&m?a.findIndex(o=>o[0]===e[0]&&o[1]===e[1]):a.indexOf(e)}let{extent:l}=t;if(Array.isArray(e)||!l||e<l[0]||e>l[1])return-1;let i=t.interval||1;if(t.unit!=="ISO8601")return Math.round((e-l[0])/i);let n=l[0],s=-1;switch(t.intervalUnit?.toLowerCase()||"days"){case"seconds":s=Math.round((e-n)/1e3/i);break;case"minutes":s=Math.round((e-n)/6e4/i);break;case"hours":s=Math.round((e-n)/36e5/i);break;case"days":s=Math.round((e-n)/864e5/i);break;case"months":{let r=new Date(e).getUTCFullYear()-new Date(n).getUTCFullYear(),m=new Date(n).getUTCMonth(),o=new Date(e).getUTCMonth();s=r===0?o-m:o+11-m+12*(r-1)}break;case"years":s=Math.round((new Date(e).getUTCFullYear()-new Date(n).getUTCFullYear())/i);break;case"decades":s=Math.round((new Date(e).getUTCFullYear()-new Date(n).getUTCFullYear())/10/i)}return s}function S(e){let t=e.values?.length;if(t)return t;let{extent:a,unit:l}=e,i=e.interval||1,n=a?a[1]-a[0]:0;if(l!=="ISO8601")return Math.round(n/i);switch(e.intervalUnit?.toLowerCase()??"seconds"){case"seconds":t=Math.round(n/1e3/i);break;case"minutes":t=Math.round(n/6e4/i);break;case"hours":t=Math.round(n/36e5/i);break;case"days":t=Math.round(n/864e5/i);break;case"months":if(a){let s=new Date(a[1]).getUTCFullYear()-new Date(a[0]).getUTCFullYear(),r=new Date(a[0]).getUTCMonth(),m=new Date(a[1]).getUTCMonth();t=s===0?m-r+1:m+11-r+12*(s-1)+1}else t=0;break;case"years":t=a?Math.round((new Date(a[1]).getUTCFullYear()-new Date(a[0]).getUTCFullYear())/i):0;break;case"decades":t=a?Math.round((new Date(a[1]).getUTCFullYear()-new Date(a[0]).getUTCFullYear())/10/i):0;break;default:t=0}return t}function H(e){if(e.extent?.length!==2||!e.interval)return[];let{extent:[t,a],interval:l}=e;if(e.unit==="ISO8601"){let n=e.intervalUnit?.toLowerCase()??"days";return["decades","years","months","days","hours","minutes","seconds"].includes(n)?R(t,a,l,n):[]}let i=Math.round((a-t)/l);return Array.from({length:i},(n,s)=>s===i-1?a:t+s*l)}function R(e,t,a,l){let i=[],n=e,s=new Date(e);for(;n<=t;)switch(i.push(n),l){case"decades":s.setUTCFullYear(s.getUTCFullYear()+10*a),n=s.getTime();break;case"years":s.setUTCFullYear(s.getUTCFullYear()+a),n=s.getTime();break;case"months":s.setUTCMonth(s.getUTCMonth()+a),n=s.getTime();break;case"days":n+=864e5*a;break;case"hours":n+=36e5*a;break;case"minutes":n+=6e4*a;break;case"seconds":n+=1e3*a}return i.length===1?i[1]=t:i[i.length-1]=t,i}function K(e,t){let a=0,l=e[0].variableName,i=[...t.variables].sort((n,s)=>n.name>s.name?1:-1);for(let n=0;n<i.length;n++){let s=i[n],r=[...s.dimensions].sort((u,g)=>u.name>g.name?-1:1);if(s.name!==l){a+=r.map(u=>S(u)).reduce((u,g)=>u*g);continue}let m=r.map(u=>S(u)),o=r.length;for(let u=0;u<o;u++){let g=e.find(d=>d.dimensionName===r[u].name);if(g==null)return null;let c=L(g.values[0],r[u]);if(c===-1)return null;m.shift(),a+=u===o-1?c:c*m.reduce((d,h)=>d*h)}break}return a}function Q(e){return Math.round(24*(e-25569)*3600*1e3)}export{J as a,P as b,M as c,j as d,q as e,E as f,w as g,B as h,G as i,H as j,K as k,Q as l};
