import{a as z}from"./chunk-LORHDXEB.js";import{a as w}from"./chunk-6F25LG6O.js";import{a as b}from"./chunk-3JGYBNJA.js";import{b as v,g as M}from"./chunk-EQZWYK27.js";import{f as g}from"./chunk-CCJU4DSH.js";import{b as S}from"./chunk-ACP3S2CH.js";import{a as r}from"./chunk-QGVBCWUY.js";import{e as a}from"./chunk-NFIPKH6V.js";import{l as d}from"./chunk-5QEXLALV.js";import{r as B}from"./chunk-P6QFA5MM.js";var C=class extends b.ClonableMixin(g){constructor(){super(...arguments),this.color=null,this.position=0}};r([a({type:w,json:{type:[B],write:{enabled:!0,isRequired:!0}}})],C.prototype,"color",void 0),r([a({type:Number,json:{write:{enabled:!0,isRequired:!0}}})],C.prototype,"position",void 0),C=r([d("esri.layers.voxel.VoxelColorStop")],C);var _=C;var R=class extends b.ClonableMixin(g){constructor(){super(...arguments),this.opacity=1,this.position=0}};r([a({type:Number,json:{name:"alpha",write:{enabled:!0,isRequired:!0}}})],R.prototype,"opacity",void 0),r([a({type:Number,json:{write:{enabled:!0,isRequired:!0}}})],R.prototype,"position",void 0),R=r([d("esri.layers.voxel.VoxelOpacityStop")],R);var T=R;var j=class extends b.ClonableMixin(g){constructor(){super(...arguments),this.enabled=!1,this.range=null}};r([a({type:Boolean,json:{default:!1,write:!0}})],j.prototype,"enabled",void 0),r([a({type:[Number],json:{write:{isRequired:!0}}})],j.prototype,"range",void 0),j=r([d("esri.layers.voxel.VoxelRangeFilter")],j);var q=j;var f;(function(t){t[t.Color=1]="Color",t[t.Alpha=2]="Alpha",t[t.Both=3]="Both"})(f||(f={}));var y=class extends b.ClonableMixin(g){constructor(t){super(t),this.interpolation=null,this.stretchRange=null,this.rangeFilter=null,this._colorMapSize=256,this.colorStops=new(S.ofType(_)),this.opacityStops=new(S.ofType(T))}set colorStops(t){this._set("colorStops",z(t,this._get("colorStops"),S.ofType(_)))}set opacityStops(t){this._set("opacityStops",z(t,this._get("opacityStops"),S.ofType(T)))}getPreviousNext(t,e,o){let m=t;for(;--m>0&&e[m].type!==o&&e[m].type!==f.Both;);let c=t,u=e.length;for(;++c<u&&e[c].type!==o&&e[c].type!==f.Both;);return[m,c]}get rasterizedTransferFunction(){let t=[];if(this.colorStops.length<2)return t;let e=[],o=[],m=1e-5;for(let i of this.colorStops){if(!i.color)return t;o.push({color:{r:i.color.r,g:i.color.g,b:i.color.b,a:Math.round(255*(1-i.color.a))},position:i.position,type:f.Color})}if(this.opacityStops.length===0)for(let i of o)e.push({color:i.color,position:i.position});else{for(let n of this.opacityStops){let l=v(n.position,0,1),s=Math.round(255*v(1-n.opacity,0,1)),h=!1;for(let p of o)if(p.type===f.Color&&Math.abs(p.position-l)<m){p.color.a=s,p.type=f.Both,h=!0;break}h||o.push({color:{r:0,g:0,b:0,a:s},position:n.position,type:f.Alpha})}o.sort((n,l)=>n.position<l.position?-1:1);let i=o.length;for(let n=0;n<i;++n){let l=o[n];if(l.type!==f.Both)if(l.type===f.Color){let[s,h]=this.getPreviousNext(n,o,f.Alpha);if(s!==-1&&h!==i){let p=(l.position-o[s].position)/(o[h].position-o[s].position);l.color.a=Math.round(M(o[s].color.a,o[h].color.a,p))}else l.color.a=s!==-1?o[s].color.a:o[h].color.a}else{let[s,h]=this.getPreviousNext(n,o,f.Color);if(s!==-1&&h!==i){let p=(l.position-o[s].position)/(o[h].position-o[s].position),x=o[s].color,A=o[h].color;F.forEach(N=>{l.color[N]=Math.round(M(x[N],A[N],p))})}else s!==-1?F.forEach(p=>{l.color[p]=o[s].color[p]}):F.forEach(p=>{l.color[p]=o[h].color[p]})}}for(let n of o)e.push({color:n.color,position:n.position})}e[0].position=0,e[e.length-1].position=1;let c=0,u=1;for(let i=0;i<this._colorMapSize;++i){let n=i/this._colorMapSize;for(;n>e[u].position;)c=u++;let l=(n-e[c].position)/(e[u].position-e[c].position),s=e[c].color,h=e[u].color,p=new w;F.forEach(x=>{p[x]=Math.round(M(s[x],h[x],l))}),p.a=v(1-M(s.a,h.a,l)/255,0,1),t.push(p)}return t}getColorForContinuousDataValue(t,e){let o=this.rasterizedTransferFunction;if(this.colorStops.length<2||!Array.isArray(this.stretchRange)||this.stretchRange.length<2||o.length<256)return null;let m=this.stretchRange[0],c=this.stretchRange[1];if(m>c){let i=m;m=c,c=i}t=v(t,m,c);let u=o[Math.round((t-m)/(c-m)*(this._colorMapSize-1))].clone();return e||(u.a=1),u}};r([a({type:["linear","nearest"],json:{write:!0}})],y.prototype,"interpolation",void 0),r([a({type:[Number],json:{write:{enabled:!0,isRequired:!0}}})],y.prototype,"stretchRange",void 0),r([a({type:S.ofType(_),json:{write:{enabled:!0,overridePolicy(){return{enabled:!!this.colorStops&&this.colorStops.length>0}}}}})],y.prototype,"colorStops",null),r([a({type:S.ofType(T),json:{read:{source:"alphaStops"},write:{enabled:!0,target:"alphaStops",overridePolicy(){return{enabled:!!this.opacityStops&&this.opacityStops.length>0}}}}})],y.prototype,"opacityStops",null),r([a({type:q,json:{write:!0}})],y.prototype,"rangeFilter",void 0),r([a({type:[w],clonable:!1,json:{read:!1}})],y.prototype,"rasterizedTransferFunction",null),y=r([d("esri.layers.voxel.VoxelTransferFunctionStyle")],y);var To=y,F=["r","g","b"];export{To as a};
