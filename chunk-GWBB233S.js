import{a as E}from"./chunk-CSSRRM4C.js";import{a as x}from"./chunk-4ZBUTOIE.js";import{a as s}from"./chunk-CELWVZPW.js";import{b as f}from"./chunk-DYTVXYAV.js";import{b as w}from"./chunk-2LI2GKBQ.js";import{y as g}from"./chunk-QBWJMFH5.js";import{f as m}from"./chunk-VTHXE323.js";function y(e){return e!=null&&typeof e=="object"&&x in e}function v(e){return e.timeInfo!==void 0}function h(e,i){return m(this,null,function*(){return e.widgets?.timeSlider?.fullTimeExtent??W(e.allLayers,i)})}function S(e){let i=e.numThumbs??2,t=e.currentTimeExtent;if(t){let{start:r,end:l}=t;return r!=null&&l!=null&&r.getTime()===l.getTime()?"instant":i===2?"time-window":r==null||r.getTime()===0?"cumulative-from-start":"cumulative-from-end"}return i===2?"time-window":"cumulative-from-start"}function I(e){let{numStops:i,stopInterval:t,stops:r}=e;return r?{dates:w(r)}:t?{interval:t.clone()}:{count:i??5}}function W(e,i){return m(this,null,function*(){if(e.length===0)return s.allTime;yield Promise.all(e.map(n=>n.load({signal:i})));let t=e.filter(v),r=e.filter(n=>!v(n)&&n.visibilityTimeExtent!=null);if(t.length===0&&r.length===0)return s.allTime;let l=[],o=[];for(let n of t)n?.type!=="feature"&&n?.type!=="map-image"||!n.timeInfo?.hasLiveData?o.push(n):l.push(n);let c=n=>n==null||n.isAllTime,d=[...o.map(n=>{let a=n.timeInfo?.fullTimeExtent,{visibilityTimeExtent:u}=n;return a?.intersection(u)??u}),...r.map(n=>n.visibilityTimeExtent)];if(d.some(c))return s.allTime;let b=l.map(n=>m(this,null,function*(){let a=(yield n.fetchRecomputedExtents({signal:i}))?.timeExtent??n.timeInfo?.fullTimeExtent,{visibilityTimeExtent:u}=n;return a?.intersection(u)??u})),p=(yield Promise.allSettled(b)).map(n=>n.status==="fulfilled"?n.value:null);if(p.some(c))return s.allTime;let T=[...p,...d].filter(g);return T.length===0?s.allTime:T.reduce((n,a)=>n.union(a))})}function z(e,i){let t=e.currentTimeExtent;if(!t)return null;let{start:r,end:l}=t,o=r??l??null;switch(i){case"time-window":return new s({start:r,end:l});case"cumulative-from-start":return new s({start:null,end:o});case"cumulative-from-end":return new s({start:o,end:null});case"instant":return new s({start:o,end:o})}}function C(e,i){return m(this,null,function*(){if(!E(e)&&!y(e))return null;yield e.load({signal:i});let t=e?.widgets?.timeSlider;if(!t)return null;let r=yield h(e,i),l=t.loop,o=S(t);return{fullTimeExtent:r,loop:l,mode:o,playRate:t.stopDelay??2e3,stops:I(t),timeExtent:z(t,o)}})}function M(e){if(!e)return e;let{start:i,end:t}=e;return new s({start:i!=null?f(i,-i.getTimezoneOffset(),"minutes"):i,end:t!=null?f(t,-t.getTimezoneOffset(),"minutes"):t})}function U(e){if(!e)return e;let{start:i,end:t}=e;return new s({start:i!=null?f(i,i.getTimezoneOffset(),"minutes"):i,end:t!=null?f(t,t.getTimezoneOffset(),"minutes"):t})}export{W as a,C as b,M as c,U as d};
