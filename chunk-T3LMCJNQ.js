import{a as S}from"./chunk-YHRLMRSO.js";import{c as _,f as H}from"./chunk-EM35R6FY.js";import{a as W,b as R}from"./chunk-QXXXCEV5.js";import{b as A}from"./chunk-EQZWYK27.js";function u(s,t,e){return s.canvas||(s.canvas=document.createElement("canvas")),s.canvas.width=t,s.canvas.height=e,s.canvas}function v(s){let{size:t}=s.definition,e=s.fontString(t),i=U.get(e);if(!i){let n=u(E,0,0).getContext("2d");s.setFontProperties(n,t);let r=n.measureText(X);i=new L(r.actualBoundingBoxAscent,r.actualBoundingBoxDescent),U.set(e,i)}return i}var U=new Map,L=class{get maxHeight(){return this.maxAscent+this.maxDescent}constructor(t,e){this.maxAscent=t,this.maxDescent=e}},E={canvas:null},X=(()=>{let s="";for(let t=32;t<127;t++)s+=String.fromCharCode(t);return s})();var T=1,M=class{constructor(t,e,i,n){this.text=t,this._alignment=e,this._parameters=i,this._maxSize=n,this._textWidths=[],this._lineWidths=[],this._renderPixelRatio=null,this._metricsCached=null,this.key=`${t}--${this._parameters.key}-${this._alignment}`,this._lines=t.replaceAll(" ","\xA0").split(/\r?\n/)}get displayWidth(){return Math.ceil(this._displayWidth+2*this._horizontalPadding)}get displayHeight(){let t=this._metrics.firstLineAscent;for(let e=0;e<this._lines.length-1;e++)t+=this._lineSpacing;return t+=this._metrics.lastLineDescent,Math.ceil(t+2*this._haloSize+2*this._verticalPadding)}get renderedWidth(){return this._toRoundedRenderUnit(this.displayWidth)}get renderedHeight(){return this._toRoundedRenderUnit(this.displayHeight)}get firstRenderedBaselinePosition(){return this._toRenderUnit(this._firstLineYOffset+this._metrics.firstLineAscent)}get _firstLineYOffset(){return this._verticalPadding+this._haloSize}get _metrics(){if(this._metricsCached==null){let t=u(k,x,x).getContext("2d"),e=this._parameters.definition.pixelRatio,i=this._fontSize*e;this._parameters.setFontProperties(t,i);let n=2*this._haloSize,r=this._parameters.definition.font;r.style!=="italic"&&r.style!=="oblique"&&r.weight!=="bold"&&r.weight!=="bolder"||(n+=.3*t.measureText("A").width),this._textWidths.length=0,this._lineWidths.length=0;let a=0,l=0,h=0,o=0,d=0;this._lines.forEach((F,b)=>{let f=t.measureText(F),y=f.width/e,z=y+n;this._textWidths.push(y),this._lineWidths.push(z),a=Math.max(a,z),o=Math.max(o,f.actualBoundingBoxAscent/e),d=Math.max(d,f.actualBoundingBoxDescent/e),b===0&&(l=f.actualBoundingBoxAscent/e),b===this._lines.length-1&&(h=f.actualBoundingBoxDescent/e)});let c=v(this._parameters),m=Math.max(o,c.maxAscent),p=Math.max(d,c.maxDescent),D=l,C=this._parameters.definition.font.decoration==="underline"?p:h,O=a;this._metricsCached=new P(D,C,m,p,O)}return this._metricsCached}get _lineSpacing(){return(this._midLineHeight+this._linePadding)*this._parameters.definition.lineSpacingFactor}get _midLineHeight(){return this._metrics.midLineHeight}get _linePadding(){return this._midLineHeight*I}get _midLineAscent(){return this._metrics.maxLineAscent}get _renderedFontSize(){return this._toRenderUnit(this._fontSize)}get _fontSize(){return this._parameters.definition.size}get _renderedHaloSize(){return this._toRenderUnit(this._haloSize)}get _haloSize(){return this._parameters.haloSize}get _horizontalPadding(){return this._hasBackground?this._parameters.definition.background.padding[0]:0}get _verticalPadding(){return Math.max(this._hasBackground?this._parameters.definition.background.padding[1]:0,T)}get _hasBackground(){return!!this._parameters.backgroundStyle}get renderPixelRatio(){if(this._renderPixelRatio==null){let t=this._parameters.definition.pixelRatio;this._renderPixelRatio=Math.min(t,Math.min(this._maxSize[0]/this.displayWidth,this._maxSize[1]/this.displayHeight))}return this._renderPixelRatio}_getLineXOffset(t){switch(this._alignment){case g.Left:return this._horizontalPadding;case g.Center:return(this.displayWidth-this._lineWidths[t])/2;case g.Right:return this.displayWidth-this._horizontalPadding-this._lineWidths[t]}}render(t,e,i){t.save();let n=e/=this.renderPixelRatio,r=i/=this.renderPixelRatio,a=this._haloSize,l=this._firstLineYOffset+this._metrics.firstLineAscent;e+=a,i+=l;let h=this._haloSize>0;h&&this._renderHalo(t,n,r,a,l),this._parameters.setFontProperties(t,this._renderedFontSize);for(let o=0;o<this._lines.length;++o){let d=this._lines[o],c=this._getLineXOffset(o);h&&(t.globalCompositeOperation="destination-out",t.fillStyle="rgb(0, 0, 0)",this._fillText(t,d,e+c,i),this._renderLineDecoration(t,e+c,i,this._textWidths[o])),t.globalCompositeOperation="source-over",t.fillStyle=this._parameters.textStyle,this._fillText(t,d,e+this._getLineXOffset(o),i),this._renderLineDecoration(t,e+c,i,this._textWidths[o]),i+=this._lineSpacing}if(S.TEXT_SHOW_BASELINE){t.strokeStyle=B,t.setLineDash([2,2]),t.lineWidth=1;let o=r+l;for(let d=0;d<this._lines.length;++d)this._drawLine(t,[n,o],[n+this.displayWidth,o]),o+=this._lineSpacing}if(S.TEXT_SHOW_BORDER&&(t.strokeStyle=B,t.setLineDash([]),t.lineWidth=1,this._drawBox(t,[n,r],[this.displayWidth,this.displayHeight])),this._hasBackground){let o=this._parameters.definition.background.borderRadius*this.renderPixelRatio;this._roundedRect(t,n,r,o),t.globalCompositeOperation="destination-over",t.fillStyle=this._parameters.backgroundStyle,t.fill()}t.restore()}_renderLineDecoration(t,e,i,n,r=!1){if(this._parameters.definition.font.decoration==="none"||n===0)return;let a=1,l=Math.max(this._parameters.definition.size/16,a);switch(this._parameters.definition.font.decoration){case"underline":i+=2*l;break;case"line-through":i-=.33*this._midLineAscent}let h=r?this._haloSize:0;t.strokeStyle=r?this._parameters.haloStyle:this._parameters.textStyle,t.lineWidth=this._toRenderUnit(l+2*h),t.beginPath(),t.moveTo(this._toRenderUnit(e-h),this._toRenderUnit(i)),t.lineTo(this._toRenderUnit(e+n+h),this._toRenderUnit(i)),t.stroke()}_roundedRect(t,e,i,n){e=this._toRenderUnit(e),i=this._toRenderUnit(i);let r=this.renderedWidth,a=this.renderedHeight;n!==0?(n=A(n,0,Math.floor(a/2)),t.beginPath(),t.moveTo(e,i+n),t.arcTo(e,i,e+n,i,n),t.lineTo(e+r-n,i),t.arcTo(e+r,i,e+r,i+n,n),t.lineTo(e+r,i+a-n),t.arcTo(e+r,i+a,e+r-n,i+a,n),t.lineTo(e+n,i+a),t.arcTo(e,i+a,e,i+a-n,n),t.closePath()):t.rect(e,i,r,a)}_renderHalo(t,e,i,n,r){let a=this.renderedWidth,l=this.renderedHeight,h=u(k,Math.max(a,x),Math.max(l,x)),o=h.getContext("2d");o.clearRect(0,0,a,l),this._parameters.setFontProperties(o,this._renderedFontSize),o.fillStyle=this._parameters.haloStyle,o.strokeStyle=this._parameters.haloStyle;let d=this._renderedHaloSize<3;o.lineJoin=d?"miter":"round",d?this._renderHaloEmulated(o,n,r):this._renderHaloNative(o,n,r);let c=r;for(let m=0;m<this._lines.length;++m){let p=this._getLineXOffset(m);this._renderLineDecoration(o,n+p,c,this._textWidths[m],!0),c+=this._lineSpacing}t.globalAlpha=this._parameters.definition.halo.color[3],t.drawImage(h,0,0,a,l,this._toRenderUnit(e),this._toRenderUnit(i),a,l),t.globalAlpha=1}_renderHaloEmulated(t,e,i){for(let n=0;n<this._lines.length;++n){let r=this._lines[n],a=this._getLineXOffset(n);for(let[l,h]of w)this._fillText(t,r,e+a+this._haloSize*l,i+this._haloSize*h);i+=this._lineSpacing}}_renderHaloNative(t,e,i){let n=2*this._haloSize;for(let r=0;r<this._lines.length;++r){let a=this._lines[r],l=this._getLineXOffset(r),h=5,o=.1;for(let d=0;d<h;d++){let c=1-(h-1)*o+d*o;t.lineWidth=this._toRenderUnit(c*n),this._strokeText(t,a,e+l,i)}i+=this._lineSpacing}}get _displayWidth(){return this._metrics.displayWidth}_toRenderUnit(t){return t*this.renderPixelRatio}_toRoundedRenderUnit(t){return Math.round(t*this.renderPixelRatio)}_fillText(t,e,i,n){t.fillText(e,this._toRenderUnit(i),this._toRenderUnit(n))}_strokeText(t,e,i,n){t.strokeText(e,this._toRenderUnit(i),this._toRenderUnit(n))}_drawLine(t,e,i){t.beginPath(),t.moveTo(this._toRoundedRenderUnit(e[0])+.5,this._toRoundedRenderUnit(e[1])+.5),t.lineTo(this._toRoundedRenderUnit(i[0])+.5,this._toRoundedRenderUnit(i[1])+.5),t.stroke()}_drawBox(t,e,i){let n=this._toRenderUnit(e[0]),r=this._toRenderUnit(e[1]),a=this._toRenderUnit(i[0]),l=this._toRenderUnit(i[1]),h=Math.floor(n)+.5,o=Math.ceil(n+a)-.5,d=Math.floor(r)+.5,c=Math.ceil(r+l)-.5;t.beginPath(),t.moveTo(h,d),t.lineTo(o,d),t.lineTo(o,c),t.lineTo(h,c),t.lineTo(h,d),t.stroke()}},w=[];for(let t=0;t<360;t+=360/16)w.push([Math.cos(Math.PI*t/180),Math.sin(Math.PI*t/180)]);var g;(function(s){s[s.Left=0]="Left",s[s.Center=1]="Center",s[s.Right=2]="Right"})(g||(g={}));var k={canvas:null},I=.2,x=512,B="rgb(255, 0, 255, 0.5)",P=class{get firstLineHeight(){return this.firstLineAscent+this.maxLineDescent}get midLineHeight(){return this.maxLineAscent+this.maxLineDescent}get lastLineHeight(){return this.maxLineAscent+this.lastLineDescent}constructor(t,e,i,n,r){this.firstLineAscent=t,this.lastLineDescent=e,this.maxLineAscent=i,this.maxLineDescent=n,this.displayWidth=r}};var tt=Object.freeze({left:0,center:.5,right:1}),et=Object.freeze({"bottom-left":_(0,0),bottom:_(.5,0),"bottom-right":_(1,0),left:_(0,.5),center:_(.5,.5),right:_(1,.5),"top-left":_(0,1),top:_(.5,1),"top-right":_(1,1)});function it(s){switch(s){case"left":return g.Left;case"right":return g.Right;default:return g.Center}}function nt(s){switch(s){case"bottom-left":case"left":case"top-left":return"left";case"bottom":case"center":case"top":return"center";case"bottom-right":case"right":case"top-right":return"right"}}function st(s){switch(s){case"bottom-left":case"bottom":case"bottom-right":return"bottom";case"left":case"center":case"right":return"center";case"top-left":case"top":case"top-right":return"top"}}function rt(s,t){switch(t){case"bottom":return s==="left"?"bottom-left":s==="right"?"bottom-right":"bottom";case"center":return s;case"top":return s==="left"?"top-left":s==="right"?"top-right":"top"}}function ot(s){return s==="middle"?"center":s}function at(s,t){switch(s){case"top":return R(t,0,T);case"bottom":return R(t,0,-1);default:return W(t,H)}}export{u as a,v as b,T as c,M as d,tt as e,et as f,it as g,nt as h,st as i,rt as j,ot as k,at as l};
