import{a as w,b as T}from"./chunk-KPT44MCK.js";import{a as R}from"./chunk-XKFJ6GWH.js";import{a as L}from"./chunk-L7NOU4T2.js";import{h as Y}from"./chunk-G2JMPZCN.js";import{b as M,f as y,m as b}from"./chunk-QSQIQSC6.js";import{a as D}from"./chunk-QCZ3ZIGQ.js";import{c as g}from"./chunk-BOVYXYHK.js";import{b as d,g as h,i as u}from"./chunk-EQZWYK27.js";import{j as S}from"./chunk-QBWJMFH5.js";function X(t,e){return new f(t,N,e)}function Z(t,e){let{curvatureDependent:r,scaleStart:a,scaleFallOffRange:s}=N;return new f(t,{curvatureDependent:{min:{curvature:r.min.curvature,tiltAngle:r.min.tiltAngle,scaleFallOffFactor:v.curvatureDependent.min.scaleFallOffFactor},max:{curvature:r.max.curvature,tiltAngle:r.max.tiltAngle,scaleFallOffFactor:v.curvatureDependent.max.scaleFallOffFactor}},scaleStart:a,scaleFallOffRange:s,minPixelSize:v.minPixelSize},e)}function k(t){return Math.abs(t*t*t)}function z(t,e,r){let a=r.parameters;return _.scale=Math.min(a.divisor/(e-a.offset),1),_.factor=k(t),_}function G(t,e){return h(t*Math.max(e.scale,e.minScaleFactor),t,e.factor)}function I(t,e,r){let a=z(t,e,r);return a.minScaleFactor=0,G(1,a)}function $(t,e,r,a){a.scale=I(t,e,r),a.factor=0,a.minScaleFactor=r.minScaleFactor}function ee(t,e,r=[0,0]){let a=Math.min(Math.max(e.scale,e.minScaleFactor),1);return r[0]=t[0]*a,r[1]=t[1]*a,r}function V(t,e,r,a){return G(t,z(e,r,a))}var f=class t{get minScaleFactor(){return this._fontHeight!=null?Math.min(this._description.minPixelSize/this._fontHeight,1):0}constructor(e,r,a,s=B(),i){this._viewingMode=e,this._description=r,this._ellipsoidRadius=a,this.parameters=s,this._fontHeight=i,this._viewingMode===D.Local?(this._coverageCompensation=this._surfaceCoverageCompensationLocal,this._calculateCurvatureDependentParameters=this._calculateCurvatureDependentParametersLocal):(this._coverageCompensation=this._surfaceCoverageCompensationGlobal,this._calculateCurvatureDependentParameters=this._calculateCurvatureDependentParametersGlobal)}update(e){return(!this.parameters||this.parameters.camera.fovY!==e.fovY||this.parameters.camera.distance!==e.distance)&&(this._calculateParameters(e,this._ellipsoidRadius,this.parameters),!0)}overrideFontHeight(e){return e!==this._fontHeight?new t(this._viewingMode,this._description,this._ellipsoidRadius,this.parameters,e):this}_calculateParameters(e,r,a){let{scaleStart:s,scaleFallOffRange:i}=this._description,{fovY:n,distance:m}=e,p=this._calculateCurvatureDependentParameters(e,r),c=this._coverageCompensation(e,r,p),{tiltAngle:l,scaleFallOffFactor:o}=p,P=Math.sin(l)*m,x=.5*Math.PI-l-n*(.5-s*c),A=P/Math.cos(x),E=x+n*i*c,C=(A-o*(P/Math.cos(E)))/(1-o);return a.camera.fovY=e.fovY,a.camera.distance=e.distance,a.offset=C,a.divisor=A-C,a}_calculateCurvatureDependentParametersLocal(e,r,a=H){return a.tiltAngle=this._description.curvatureDependent.min.tiltAngle,a.scaleFallOffFactor=this._description.curvatureDependent.min.scaleFallOffFactor,a}_calculateCurvatureDependentParametersGlobal(e,r,a=H){let s=this._description.curvatureDependent,i=1+e.distance/r,n=Math.sqrt(i*i-1),[m,p]=[s.min.curvature,s.max.curvature],c=d((n-m)/(p-m),0,1),[l,o]=[s.min,s.max];return a.tiltAngle=h(l.tiltAngle,o.tiltAngle,c),a.scaleFallOffFactor=h(l.scaleFallOffFactor,o.scaleFallOffFactor,c),a}_surfaceCoverageCompensationLocal(e,r,a){return Y(a.tiltAngle,e.fovY)}_surfaceCoverageCompensationGlobal(e,r,a){return y(q,r),b(q,a.tiltAngle,e.distance,e.fovY)}},N={curvatureDependent:{min:{curvature:u(10),tiltAngle:u(12),scaleFallOffFactor:.5},max:{curvature:u(70),tiltAngle:u(40),scaleFallOffFactor:.8}},scaleStart:.3,scaleFallOffRange:.65,minPixelSize:0},v={curvatureDependent:{min:{scaleFallOffFactor:.7},max:{scaleFallOffFactor:.95}},minPixelSize:14};function B(){return{camera:{distance:0,fovY:0},divisor:0,offset:0}}var _={scale:0,factor:0,minScaleFactor:0},H={tiltAngle:0,scaleFallOffFactor:0},q=M();function ie(t,e,r,a,s){let i=(r.screenLength||0)*t.pixelRatio;s!=null&&(i=V(i,a,e,s));let n=i*Math.tan(.5*t.fovY)/(.5*t.fullHeight);return d(n*e,r.minWorldLength||0,r.maxWorldLength!=null?r.maxWorldLength:1/0)}function F(t,e){let r=!1;for(let a in e){let s=e[a];s!==void 0&&(Array.isArray(s)?Array.isArray(t[a])&&S(s,t[a])||(t[a]=s.slice(),r=!0):t[a]!==s&&(r=!0,t[a]=s))}return r}var ne={multiply:1,ignore:2,replace:3,tint:4};var W=class extends w{constructor(e,r){super(),this.type=T.Material,this.supportsEdges=!1,this._renderPriority=0,this.vertexAttributeLocations=R,this._pp0=g(0,0,1),this._pp1=g(0,0,0),this._parameters=new r,F(this._parameters,e),this.validateParameters(this._parameters)}get parameters(){return this._parameters}update(e){return!1}setParameters(e,r=!0){F(this._parameters,e)&&(this.validateParameters(this._parameters),r&&this._parametersChanged())}validateParameters(e){}shouldRender(e){return this.visible&&this.isVisibleForOutput(e.output)&&(!this.parameters.isDecoration||e.bind.decorations)&&!!(this.parameters.renderOccluded&e.renderOccludedMask)}isVisibleForOutput(e){return!0}get renderPriority(){return this._renderPriority}set renderPriority(e){e!==this._renderPriority&&(this._renderPriority=e,this._parametersChanged())}_parametersChanged(){this.repository?.materialChanged(this)}queryRenderOccludedState(e){return this.visible&&this.parameters.renderOccluded===e}get hasEmissions(){return!1}intersectDraped(e,r,a,s,i,n){return this._pp0[0]=this._pp1[0]=s[0],this._pp0[1]=this._pp1[1]=s[1],this.intersect(e,r,a,this._pp0,this._pp1,i)}},O;(function(t){t[t.None=0]="None",t[t.Occlude=1]="Occlude",t[t.Transparent=2]="Transparent",t[t.OccludeAndTransparent=4]="OccludeAndTransparent",t[t.OccludeAndTransparentStencil=8]="OccludeAndTransparentStencil",t[t.Opaque=16]="Opaque"})(O||(O={}));var j=class extends L{constructor(){super(...arguments),this.renderOccluded=O.Occlude,this.isDecoration=!1}};export{X as a,Z as b,G as c,$ as d,ee as e,ie as f,F as g,ne as h,W as i,O as j,j as k};
