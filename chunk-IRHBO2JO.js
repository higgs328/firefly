import{a as I}from"./chunk-THGBGAPW.js";import{a as g}from"./chunk-ZI7YPATJ.js";import{a as c}from"./chunk-PXU7AQS6.js";import{a as V}from"./chunk-O3DP7PW7.js";import{a as H}from"./chunk-AKI7NWXQ.js";import{b as M,m as b,w as C}from"./chunk-Z7TBAZRW.js";import{a as w,b as _}from"./chunk-LORHDXEB.js";import{c as A}from"./chunk-VIEK2X23.js";import{a as l,i as h,k as f}from"./chunk-TG45K3WR.js";import{b as u}from"./chunk-ACP3S2CH.js";import{a as n}from"./chunk-QGVBCWUY.js";import{e as r}from"./chunk-NFIPKH6V.js";import{l as T}from"./chunk-5QEXLALV.js";import{d as y}from"./chunk-TG2UTNEO.js";import{f as p}from"./chunk-VTHXE323.js";var v=u.ofType(g),o=class extends I{constructor(t){super(t),this.analysis=null,this.supportedViewType="3d",this.unsupportedErrorMessage="LineOfSightViewModel is only supported in 3D views.",this._vmTargetsToConnection=new Map,this._analysisTargetsToConnection=new Map}initialize(){this.addHandles([this.targets.on("after-add",t=>this._onViewModelTargetAdded(t.item)),this.targets.on("after-remove",t=>this._onViewModelTargetRemoved(t.item)),l(()=>this.analysis,t=>this._onAnalysisChange(t),f)])}destroy(){this._analysisTargetsToConnection.forEach(t=>t.remove())}get state(){return this.disabled||!this.ready?"disabled":this.tool==null?"ready":this.tool.state}get observer(){let{observer:t}=this.analysis;return t?.position==null?null:this._convertAnalysisPointToAbsoluteHeight(t.position,t.elevationInfo)}set observer(t){let e=null;t&&(e=t.clone(),e.hasZ||(e.z=0)),this.analysis.observer=new V({position:e})}get targets(){return this._get("targets")||new v}set targets(t){this._set("targets",w(t,this.targets,v))}continue(){this.tool!=null&&this.tool.continue()}stop(){this.tool!=null&&this.tool.stop()}get testInfo(){}constructAnalysis(){return new c}onConnectToAnalysisView(t){return p(this,null,function*(){this.addHandles([t.on("result-changed",e=>{let s=this._analysisTargetsToConnection.get(e.target);s&&(e.result!=null?(s.viewModelTarget.intersectedGraphic=e.result.intersectedGraphic,s.viewModelTarget.intersectedLocation=e.result.intersectedLocation,s.viewModelTarget.visible=e.result.visible):(s.viewModelTarget.intersectedGraphic=null,s.viewModelTarget.intersectedLocation=null,s.viewModelTarget.visible=void 0))})],"view")})}onDisconnectFromAnalysisView(){this.removeHandles("view")}_onViewModelTargetAdded(t){if(this._vmTargetsToConnection.get(t))return;let e=new H({position:t.location});this._connectViewModelWithAnalysisTarget(t,e),this.analysis.targets.add(e)}_onViewModelTargetRemoved(t){let e=this._vmTargetsToConnection.get(t);e&&(e.remove(),this.analysis.targets.remove(e.analysisTarget))}_onAnalysisTargetAdded(t){if(this._analysisTargetsToConnection.get(t))return;let{position:e}=t,s=new g({location:e?this._convertAnalysisPointToAbsoluteHeight(e,t.elevationInfo):null});this._connectViewModelWithAnalysisTarget(s,t),this.targets.add(s)}_onAnalysisTargetRemoved(t){let e=this._analysisTargetsToConnection.get(t);e&&(e.remove(),this.targets.remove(e.viewModelTarget))}_connectViewModelWithAnalysisTarget(t,e){let s=!1,d=y([l(()=>({position:e.position,elevationInfo:e.elevationInfo}),({position:a,elevationInfo:i})=>{s||(s=!0,t.location=a?this._convertAnalysisPointToAbsoluteHeight(a,i):null,s=!1)},h),l(()=>t.location,a=>{if(!s){s=!0;let i=null;a&&(i=a.clone(),i.hasZ||(i.z=0)),e.position=i,e.elevationInfo=null,s=!1}},h)]),m={analysisTarget:e,viewModelTarget:t,remove:()=>{d.remove(),this._vmTargetsToConnection.delete(t),this._analysisTargetsToConnection.delete(e)}};this._vmTargetsToConnection.set(t,m),this._analysisTargetsToConnection.set(e,m)}_onAnalysisChange(t){let e="analysis";this.removeHandles(e),this.addHandles([this.analysis.targets.on("after-add",s=>this._onAnalysisTargetAdded(s.item)),this.analysis.targets.on("after-remove",s=>this._onAnalysisTargetRemoved(s.item))],e),this.targets.removeAll(),t.targets.forEach(s=>{this._onAnalysisTargetAdded(s)})}_convertAnalysisPointToAbsoluteHeight(t,e){let s=t.clone();if(this.view!=null){let d=M(t.hasZ,e);s.z=b(this.view,t,d,C)}return s}};n([r({type:c})],o.prototype,"analysis",void 0),n([r({readOnly:!0})],o.prototype,"state",null),n([r({type:A})],o.prototype,"observer",null),n([r({type:v,cast:_,nonNullable:!0})],o.prototype,"targets",null),o=n([T("esri.widgets.LineOfSight.LineOfSightViewModel")],o);var B=o;export{B as a};
