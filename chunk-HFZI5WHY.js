import{d as C,g as M,h as I,i as A,j as L,k as $,l as j,m as F}from"./chunk-SU2NZAJW.js";import{b as R,g as x}from"./chunk-DA3SDKGO.js";import{c as _}from"./chunk-VIEK2X23.js";import{f as S}from"./chunk-Q6Y4JG7Q.js";import{a as p}from"./chunk-7F5DJLJT.js";import{d as P}from"./chunk-NJWTSROP.js";import{a}from"./chunk-QGVBCWUY.js";import{H as b}from"./chunk-MYO4NP2N.js";import{e as s}from"./chunk-NFIPKH6V.js";import{l as w}from"./chunk-5QEXLALV.js";import{b as d}from"./chunk-YOFFGXOB.js";import{f}from"./chunk-VTHXE323.js";function D(t,e){let r=v(e);return[t[0].toFixed(r),t[1].toFixed(r)]}function v(t){return t>=500?6:t<500&&t>=50?7:t<50&&t>=5?8:9}function U(t,e){let r=t.includes(",")?",":" ",[n,o,c]=t.split(r).map(u=>{let m=u.trim();return m?Number(m):null});if(!h(n)||!h(o))return null;let l=new _({x:n,y:o,spatialReference:e||p.WGS84});return c&&(l.z=c,l.hasZ=!0),l}function h(t){return typeof t=="number"&&isFinite(t)}function g(t){return!!t&&h(t.x)&&h(t.y)}function y(t,e){if(t.spatialReference.isGeographic&&e){let[r,n]=D([t.x,t.y],e);return`${r}, ${n}`}return`${t.x.toFixed(3)}, ${t.y.toFixed(3)}`}var G=["dd","dms","ddm","mgrs","usng","utm"];function O(t){return G.includes(t)}var i=class extends b{constructor(t){super(t),this.conversionInfo=null,this.coordinateSegments=null,this._currentPattern=void 0,this.defaultPattern=null,this.name=null,this.viewModel=null}get currentPattern(){return(this._currentPattern||this.defaultPattern)??""}set currentPattern(t){this._currentPattern=t}get label(){return this.name??""}set label(t){this._overrideIfSome("label",t)}get hasDisplayProperties(){return!(!this.defaultPattern||!this.coordinateSegments)}get spatialReference(){return this.name==="basemap"?this._viewSpatialReference:this.conversionInfo?.spatialReference??p.WGS84}set spatialReference(t){this._overrideIfSome("spatialReference",t)}get _viewSpatialReference(){return this.viewModel?.view?.spatialReference??p.WGS84}get _additionalCharactersPattern(){let t=this.coordinateSegments;if(!t)return null;let e=t.map(n=>n.alias),r=this.currentPattern.replaceAll(new RegExp(`["nsew${e.join()}]`,"gi"),"").replaceAll(" ","");return new RegExp(`[${r}]`,"g")}get test(){}convert(t){return f(this,null,function*(){if(!g(t))throw new d("format:invalid-point","Could not convert invalid point.",{point:t});let e=this.conversionInfo?.convert;if(e)return Promise.resolve().then(()=>e(t));let r=yield this._project(t,this.spatialReference);return{location:r,coordinate:yield this._getCoordinate(r)}})}getConversionStrategy(){let t=this._viewSpatialReference;return this.conversionInfo?.convert||this.viewModel?.formatterAvailable||this.name==="xy"&&(t.isWebMercator||t.isWGS84)||this.name==="basemap"?"client":"server"}getDisplayCoordinate(t){if(!t)return null;if(!this.coordinateSegments||!this.currentPattern)return t;let e=this.currentPattern,r=this._getSegmentMatches(t,!1);for(let n=this.coordinateSegments.length-1;n>=0;n--){let o=this.coordinateSegments[n];e=e.replace(o.alias,r[n])}return e}_parseUserInput(t){let{defaultPattern:e,_additionalCharactersPattern:r,coordinateSegments:n}=this;if(!e||!r)return"";let o=e.replace(r,"");t=t.replace(r,"");let c=this._getSegmentMatches(t,!0);if(n)for(let l=n.length-1;l>=0;l--){let u=n[l];o=o.replace(u.alias,c[l])}return o}_getSegmentMatches(t,e){let r=new Array,{coordinateSegments:n}=this;if(!n)return r;for(let o=0;o<n.length;o++){let c=n[o],l=t.match(c.searchPattern);if(!l){r.push("");continue}let u=l[0];if(t=t.replace(u,"").trim(),c.substitution){let m=e?c.substitution.input(u):c.substitution.output(u);m&&(u=`${m}`)}r.push(u)}return r}reverseConvert(t){return f(this,null,function*(){let e=this._parseUserInput(t),r=this.conversionInfo?.reverseConvert,n;if(r)n=r(e);else if(this.name==="xy"||this.name==="basemap")n=U(e,this.spatialReference);else if(this.viewModel?.formatterAvailable)switch(this.name){case"dd":case"ddm":case"dms":n=C(e,this.spatialReference);break;case"mgrs":{n=M(e,this.spatialReference,"automatic");break}case"utm":{n=A(e,this.spatialReference,"latitude-band-indicators");break}case"usng":n=I(e,this.spatialReference);break;default:n=null}if(!n)throw new d("format:invalid-input","Could not parse input into point.",{userInput:t});return this._project(n,this._viewSpatialReference)})}_getCoordinate(t){return f(this,null,function*(){let e=this.viewModel?.view?.scale??0;if(!g(t))throw new d("format:invalid-point","Could not transform invalid point into coordinate.",{point:t});if(this.viewModel?.formatterAvailable||this.name==="basemap"||this.name==="xy")switch(this.name){case"dd":case"ddm":case"dms":{let r=v(e);return L(t,this.name,r)}case"mgrs":return $(t,"automatic",5,!1);case"usng":return j(t,5,!1);case"utm":return F(t,"latitude-band-indicators",!0);default:return y(t,e)}return y(t,e)})}_project(t,e){return f(this,null,function*(){if(P(t.spatialReference,e)||!e)return t;if(this.viewModel?.formatterAvailable&&R())return x(t,e);if(!this.viewModel?.formatterAvailable){let r=S(t,e);if(r!=null)return r}return null})}};a([s()],i.prototype,"conversionInfo",void 0),a([s()],i.prototype,"coordinateSegments",void 0),a([s()],i.prototype,"currentPattern",null),a([s()],i.prototype,"_currentPattern",void 0),a([s()],i.prototype,"label",null),a([s()],i.prototype,"defaultPattern",void 0),a([s({readOnly:!0})],i.prototype,"hasDisplayProperties",null),a([s()],i.prototype,"name",void 0),a([s({type:p})],i.prototype,"spatialReference",null),a([s()],i.prototype,"viewModel",void 0),a([s({readOnly:!0})],i.prototype,"_viewSpatialReference",null),a([s({readOnly:!0})],i.prototype,"_additionalCharactersPattern",null),i=a([w("esri.widgets.CoordinateConversion.support.Format")],i);var et=i;export{g as a,O as b,et as c};
