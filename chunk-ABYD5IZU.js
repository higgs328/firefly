import{b as he,e as j}from"./chunk-HRDVAO34.js";import{a as de,b as ce,d as ye,e as fe,f as ve,g as be,k as ge,n as k}from"./chunk-MOUPZWB7.js";import{a as R,i as oe,j as se,k as V,l as Z,p as me,q as ue,s as pe,t as E}from"./chunk-TVZYM2NN.js";import{a as A}from"./chunk-47NA5MWW.js";import{a as D}from"./chunk-BN2AMH77.js";import{a as ie,c as te,d as re,e as P,g as U}from"./chunk-GYQWYHEG.js";import{b as ne}from"./chunk-JC4DQSN3.js";import{b as ae,i as le,j as L}from"./chunk-B3VPRADQ.js";import{a as _,b as ee}from"./chunk-GHDQGSQR.js";import{t as Y}from"./chunk-ZM24RY22.js";import{a as X}from"./chunk-PE276TWH.js";import{a as W}from"./chunk-EHG7JRYJ.js";import{a as N,f as Q,g as F}from"./chunk-F5AJITOA.js";import{da as B}from"./chunk-KALOJIUA.js";import{b as K}from"./chunk-UST6HCE7.js";import{b as f}from"./chunk-YOFFGXOB.js";import{b as q}from"./chunk-2LI2GKBQ.js";import{a as w,b as z,f as y}from"./chunk-VTHXE323.js";function we(a){return y(this,null,function*(){if(!a?.layer||!a.field&&!a.valueExpression)throw new f("type-renderer:missing-parameters","'layer' and 'field' or 'valueExpression' parameters are required");if(a.valueExpression&&!a.view)throw new f("type-renderer:missing-parameters","View is required when 'valueExpression' is specified");a.forBinning&&ne(a,"type-renderer");let e=z(w({},a),{layer:a.layer});e.symbolType=e.symbolType||"2d",e.defaultSymbolEnabled??=!0,e.sortBy??="count",e.sortEnabled??=!0,e.statistics=q(e.statistics);let l=e.numTypes==null?10:e.numTypes,n=a.forBinning?re:te,i=U(e.layer,n,a.forBinning);if(!i)throw new f("type-renderer:invalid-parameters","'layer' must be one of these types: "+P(n).join(", "));let t=e.signal!=null?{signal:e.signal}:null;yield i.load(t);let r=i.geometryType;if(e.outlineOptimizationEnabled=r==="polygon"&&e.outlineOptimizationEnabled,e.sizeOptimizationEnabled=(r==="point"||r==="multipoint"||r==="polyline")&&e.sizeOptimizationEnabled,r==="mesh")e.symbolType="3d-volumetric",e.colorMixMode=e.colorMixMode||"replace",e.edgesType=e.edgesType||"none";else{if(e.symbolType==="3d-volumetric-uniform"&&r!=="point")throw new f("type-renderer:not-supported","3d-volumetric-uniform symbols are supported for point layers only");if(e.symbolType.includes("3d-volumetric")&&(!e.view||e.view.type!=="3d"))throw new f("type-renderer:invalid-parameters","'view' parameter should be an instance of SceneView when 'symbolType' parameter is '3d-volumetric' or '3d-volumetric-uniform'")}let m=yield F({field:e.field,field2:e.field2,field3:e.field3,valueExpression:e.valueExpression}),o=Z(i,m,"type-renderer:invalid-parameters");if(o)throw o;return z(w({},e),{layer:i,numTypes:l})})}function xe(a){return y(this,null,function*(){let e="regenerate-type-renderer";yield de(a,e);let l=yield ce(a),n=ye(l);if(!n||!["type","type-size"].includes(n))throw new f(`${e}:invalid-parameters`,"Renderer is invalid");let{field:i,field2:t,field3:r,valueExpression:m,valueExpressionTitle:o}=l,u=l.uniqueValueInfos.length,{layer:p,forBinning:c,filter:T,view:v,signal:d}=a,S=fe(l),x=ve(l),b=yield we({layer:p,field:i,field2:t,field3:r,valueExpression:m,valueExpressionTitle:o,numTypes:u,outlineOptimizationEnabled:S,sizeOptimizationEnabled:x,forBinning:c,filter:T,view:v,signal:d});return z(w({},a),{creatorParameters:b,renderer:l})})}function Ie(a){return y(this,null,function*(){if(!a?.layer||!a.field)throw new f("type-point-cloud-class-renderer:missing-parameters","'layer' and 'field' parameters are required");let e=z(w({},a),{layer:a.layer});e.statistics=q(e.statistics);let l=[ie.PointCloudLayer],n=U(e.layer,l);if(!n)throw new f("type-point-cloud-class-renderer:invalid-parameters","'layer' must be one of these types: "+P(l).join(", "));if(e.layer=n,e.density=e.density||25,e.size=e.size||"100%",!me(e.size))throw new f("type-point-cloud-class-renderer:invalid-parameters","Invalid 'size' parameter. It should be a string of the form '100%'");let i=e.signal!=null?{signal:e.signal}:null;yield n.load(i);let t=yield F({field:e.field}),r=Z(n,t,"type-point-cloud-class-renderer:invalid-parameters");if(r)throw r;return e})}function Te(a){return y(this,null,function*(){let e=a.typeScheme,l=null,n=null,i=yield pe(a.basemap,a.view);if(l=i.basemapId!=null?i.basemapId:null,n=i.basemapTheme!=null?i.basemapTheme:null,e)return{scheme:j(e),basemapId:l,basemapTheme:n};let t=he({numColors:a.numColors,basemapTheme:n,geometryType:a.geometryType,theme:a.theme,worldScale:a.worldScale,view:a.view});return t&&(e=t.primaryScheme,l=t.basemapId,n=t.basemapTheme),{scheme:e,basemapId:l,basemapTheme:n}})}function ze(a,e){let l;return l=a.label<e.label?-1:a.label>e.label?1:0,l}function Ve(a,e){let l;return l=a.value<e.value?-1:a.value>e.value?1:0,l}function Me(a,e){let l=e.count-a.count;return l===0&&(l=ze(a,e)),l}function Oe(a,e){let l=e.count-a.count;return l===0&&(l=Ve(a,e)),l}function Ee(a,e,l){let n;e==="count"?(n=Oe,l&&"codedValues"in l&&l.codedValues&&(n=Me)):e==="value"&&(n=Ve,l&&"codedValues"in l&&l.codedValues&&(n=ze)),n&&a.sort(n)}function Ce(a,e,l,n){return y(this,null,function*(){let i=yield K("esri/smartMapping/t9n/smartMapping"),{field:t,field2:r,field3:m}=e,o=a.uniqueValueInfos,u=e.layer,p=t?u.getField(t):null,c=p?u.getFieldDomain(p.name):null,T=e.numTypes===-1?o.length:e.numTypes,v=u.geometryType,d=new X({field:t,field2:r,field3:m,fieldDelimiter:t&&r?N:null}),S=[],x=[],b={value:null,domain:c,fieldInfo:p};o.forEach((s,g)=>{b.value=s.value,s.label=L(b);let C=s.value;(C===null||typeof C=="string"&&C.toLowerCase().includes("<null>"))&&S.unshift(g)});for(let s of S)x.unshift(o.splice(s,1)[0]);e.sortEnabled!==!1&&Ee(o,e.sortBy,c),qe(b,e,o);let Se=l?.opacity,O=yield Te({numColors:o.length,basemap:e.basemap,geometryType:v,typeScheme:e.typeScheme,worldScale:!!e.symbolType?.includes("3d-volumetric"),view:e.view}),h=O.scheme,$=h.colors.map(s=>s.clone()),I=oe(h,v),M=se(h,v,Se);o.forEach((s,g)=>{b.value=s.value,s.label=L(b),s.symbol=V(v,{type:e.symbolType,color:$[g],size:I,outline:M,meshInfo:{colorMixMode:e.colorMixMode,edgesType:e.edgesType}})}),e.valueExpression&&(d.valueExpression=e.valueExpression,d.valueExpressionTitle=e.valueExpressionTitle),e.legendOptions&&(d.legendOptions=new W(e.legendOptions));for(let s=0;s<T;s++){let g=o[s];g&&d.addUniqueValueInfo({value:g.value,label:g.label,symbol:V(v,{type:e.symbolType,color:$[s].clone(),size:I,outline:M,meshInfo:{colorMixMode:e.colorMixMode,edgesType:e.edgesType}})})}e.defaultSymbolEnabled&&(d.defaultSymbol=V(v,{type:e.symbolType,color:h.noDataColor,size:I,outline:M,meshInfo:{colorMixMode:e.colorMixMode,edgesType:e.edgesType}}),d.defaultLabel=i.other);for(let s of x)s.symbol=V(v,{type:e.symbolType,color:h.noDataColor,size:I,outline:M,meshInfo:{colorMixMode:e.colorMixMode,edgesType:e.edgesType}}),o.push(s);let G=[],H=d.uniqueValueInfos?.length??0,J=H===o.length?-1:H;if(J>-1)for(let s=J;s<o.length;s++)G.push(w({},o[s]));return l?.visualVariables?.length&&(d.visualVariables=l.visualVariables.map(s=>s.clone())),n?.minSize&&(d.visualVariables?d.visualVariables.push(n.minSize):d.visualVariables=[n.minSize]),{renderer:d,uniqueValueInfos:o,excludedUniqueValueInfos:G,typeScheme:j(h),basemapId:O.basemapId,basemapTheme:O.basemapTheme}})}function qe(a,e,l){let{field:n,numTypes:i,layer:t,view:r}=e,m=n?t.getField(n):null;if(m&&(Q(m)||B(m))){let o=l.filter((c,T)=>T<i).map(c=>c.value),u=B(m)?null:le(o),p=u?ae[u]:void 0;if(a.dateFormatOptions={fieldType:m.type,format:p},r){let c=t.layer;a.dateFormatOptions.timeZoneOptions={layerTimeZone:"preferredTimeZone"in c?c.preferredTimeZone:null,viewTimeZone:r.timeZone,datesInUnknownTimezone:"datesInUnknownTimezone"in c&&c.datesInUnknownTimezone}}}}function Fe(a,e){return y(this,null,function*(){let l=a.uniqueValueInfos,n=yield Te({numColors:l.length,basemap:"gray",theme:"point-cloud-class",geometryType:"point",typeScheme:e}),i=n?.scheme,t=i?.theme==="point-cloud-class",r=t?i.colors:Y(i?.colors??[],l.length);return Ee(l,"value"),l.map((m,o)=>{let u=m.value,p=null;return t?(p=r[u],p||(p=r[r.length-1])):p=r[o],new _({values:[u],color:p,label:m.label})})})}function Ye(a){return y(this,null,function*(){let e=yield we(a),{layer:l,view:n,signal:i,filter:t}=e,r={layer:l,field:e.field,field2:e.field2,field3:e.field3,valueExpression:e.valueExpression,returnAllCodedValues:e.returnAllCodedValues,view:n,filter:t,signal:i},[m,o,u]=yield Promise.all([e.statistics!=null?e.statistics:D(r),e.outlineOptimizationEnabled?R({layer:l,view:n,signal:i,filter:t}).catch(E):null,e.sizeOptimizationEnabled?A({layer:l,view:n,signal:i,filter:t}).catch(E):null]);return Ce(m,e,o,u)})}function _e(a){return y(this,null,function*(){let{creatorParameters:e,view:l,signal:n,filter:i,renderer:t}=yield xe(a),{layer:r,outlineOptimizationEnabled:m,sizeOptimizationEnabled:o}=e,[u,p]=yield Promise.all([m?R({layer:r,view:l,signal:n,filter:i}).catch(E):null,o?A({layer:r,view:l,signal:n,filter:i}).catch(E):null]);return k(t,u?.visualVariables,be),k(t,p?.minSize,ge),{renderer:t}})}function ea(a){return y(this,null,function*(){let e=yield Ie(a),l=e.statistics!=null?e.statistics:yield D({layer:e.layer,field:e.field,signal:e.signal});return{renderer:new ee({field:e.field,pointsPerInch:e.density??void 0,pointSizeAlgorithm:ue(e.size),colorUniqueValueInfos:yield Fe(l,e.typeScheme)})}})}export{Ye as a,_e as b,ea as c};
