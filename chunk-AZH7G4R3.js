import{a as X}from"./chunk-MSDJIYGD.js";import{a as It}from"./chunk-WWVFKY5W.js";import{a as xt,d as H,e as z}from"./chunk-DLFX7BVG.js";import{a as rt}from"./chunk-S52JRLJC.js";import{b as nt}from"./chunk-E2QKN2KY.js";import{a as M}from"./chunk-RWCIDBNQ.js";import{F as yt,b as et,c as k,d as ht,e as ot,p as wt,u as j,v as q,w as st}from"./chunk-6B5XFA6F.js";import{a as y}from"./chunk-BOVYXYHK.js";import{i as tt,l as mt}from"./chunk-EQZWYK27.js";import{a as T}from"./chunk-AML4XSEF.js";import{c as dt}from"./chunk-QBWJMFH5.js";function at(t,o,s){let r=o/3,i=new Uint32Array(s+1),u=new Uint32Array(s+1),g=(e,n)=>{e<n?i[e+1]++:u[n+1]++};for(let e=0;e<r;e++){let n=t[3*e],l=t[3*e+1],c=t[3*e+2];g(n,l),g(l,c),g(c,n)}let d=0,I=0;for(let e=0;e<s;e++){let n=i[e+1],l=u[e+1];i[e+1]=d,u[e+1]=I,d+=n,I+=l}let a=new Uint32Array(6*r),f=i[s],w=(e,n,l)=>{if(e<n){let c=i[e+1]++;a[2*c]=n,a[2*c+1]=l}else{let c=u[n+1]++;a[2*f+2*c]=e,a[2*f+2*c+1]=l}};for(let e=0;e<r;e++){let n=t[3*e],l=t[3*e+1],c=t[3*e+2];w(n,l,e),w(l,c,e),w(c,n,e)}let N=(e,n)=>{let l=2*e,c=n-e;for(let x=1;x<c;x++){let E=a[l+2*x],v=a[l+2*x+1],p=x-1;for(;p>=0&&a[l+2*p]>E;p--)a[l+2*p+2]=a[l+2*p],a[l+2*p+3]=a[l+2*p+1];a[l+2*p+2]=E,a[l+2*p+3]=v}};for(let e=0;e<s;e++)N(i[e],i[e+1]),N(f+u[e],f+u[e+1]);let b=new Int32Array(3*r),D=(e,n)=>e===t[3*n]?0:e===t[3*n+1]?1:e===t[3*n+2]?2:-1,S=(e,n)=>{let l=D(e,n);b[3*n+l]=-1},R=(e,n,l,c)=>{let x=D(e,n);b[3*n+x]=c;let E=D(l,c);b[3*c+E]=n};for(let e=0;e<s;e++){let n=i[e],l=i[e+1],c=u[e],x=u[e+1];for(;n<l&&c<x;){let E=a[2*n],v=a[2*f+2*c];E===v?(R(e,a[2*n+1],v,a[2*f+2*c+1]),n++,c++):E<v?(S(e,a[2*n+1]),n++):(S(v,a[2*f+2*c+1]),c++)}for(;n<l;)S(e,a[2*n+1]),n++;for(;c<x;)S(a[2*f+2*c],a[2*f+2*c+1]),c++}return b}var it=.7,J=class{updateSettings(o){this.settings=o,this._edgeHashFunction=o.reducedPrecision?bt:Vt}write(o,s,r){G.seed=this._edgeHashFunction(r);let i=G.getIntRange(0,255),u=G.getIntRange(0,this.settings.variants-1),g=G.getFloat(),d=255*(.5*Ot(-(1-Math.min(g/it,1))+Math.max(0,g-it)/(1-it),1.2)+.5);o.position0.setVec(s,r.position0),o.position1.setVec(s,r.position1),o.componentIndex.set(s,r.componentIndex),o.variantOffset.set(s,i),o.variantStroke.set(s,u),o.variantExtension.set(s,d)}},B=new Float32Array(6),V=new Uint32Array(B.buffer),F=new Uint32Array(1);function Vt(t){return B[0]=t.position0[0],B[1]=t.position0[1],B[2]=t.position0[2],B[3]=t.position1[0],B[4]=t.position1[1],B[5]=t.position1[2],F[0]=31*(31*(31*(31*(31*(166811+V[0])+V[1])+V[2])+V[3])+V[4])+V[5],F[0]}function bt(t){let o=B;o[0]=_(t.position0[0]),o[1]=_(t.position0[1]),o[2]=_(t.position0[2]),o[3]=_(t.position1[0]),o[4]=_(t.position1[1]),o[5]=_(t.position1[2]),F[0]=5381;for(let s=0;s<V.length;s++)F[0]=31*F[0]+V[s];return F[0]}var Nt=1e4;function _(t){return Math.round(t*Nt)/Nt}function Ot(t,o){return Math.abs(t)**o*Math.sign(t)}var P=class{constructor(){this._commonWriter=new J}updateSettings(o){this._commonWriter.updateSettings(o)}allocate(o){return H.createBuffer(o)}write(o,s,r){this._commonWriter.write(o,s,r),ht(C,r.faceNormal0,r.faceNormal1),j(C,C);let{typedBuffer:i,typedBufferStride:u}=o.normalCompressed;X(i,s,C[0],C[1],C[2],u)}};P.Layout=H,P.glLayout=rt(H,1);var U=class{constructor(){this._commonWriter=new J}updateSettings(o){this._commonWriter.updateSettings(o)}allocate(o){return z.createBuffer(o)}write(o,s,r){this._commonWriter.write(o,s,r);{let{typedBuffer:i,typedBufferStride:u}=o.normalCompressed;X(i,s,r.faceNormal0[0],r.faceNormal0[1],r.faceNormal0[2],u)}{let{typedBuffer:i,typedBufferStride:u}=o.normal2Compressed;X(i,s,r.faceNormal1[0],r.faceNormal1[1],r.faceNormal1[2],u)}}};U.Layout=z,U.glLayout=rt(z,1);var C=y(),G=new dt;var K=class{constructor(){this.position0=y(),this.position1=y(),this.faceNormal0=y(),this.faceNormal1=y(),this.componentIndex=0,this.cosAngle=0}};var $=-1;function St(t,o,s){let r=t.vertices.position,i=t.vertices.componentIndex,u=h.position0,g=h.position1,d=h.faceNormal0,I=h.faceNormal1,{edges:a,normals:f}=Ct(t),w=a.length/4,N=o.allocate(w),b=0,D=w,S=s?.allocate(D),R=0,e=0,n=0;Q.length=0;for(let p=0;p<w;++p){let L=4*p;r.getVec(a.data[L],u),r.getVec(a.data[L+1],g);let W=Q.pushNew();W.index=4*p,W.length=wt(u,g)}Q.sort((p,L)=>L.length-p.length);let l=new Array,c=new Array;Q.forAll(({length:p,index:L})=>{let W=a.data[L],Bt=a.data[L+1],ft=a.data[L+2],pt=a.data[L+3],gt=pt===$;if(r.getVec(W,u),r.getVec(Bt,g),gt){let A=3*ft;k(d,f.data[A],f.data[A+1],f.data[A+2]),et(I,d),h.componentIndex=i.get(W),h.cosAngle=q(d,I)}else{let A=3*ft;if(k(d,f.data[A],f.data[A+1],f.data[A+2]),A=3*pt,k(I,f.data[A],f.data[A+1],f.data[A+2]),h.componentIndex=i.get(W),h.cosAngle=q(d,I),Mt(h,Pt))return;h.cosAngle<-.9999&&et(I,d)}e+=p,n++,gt||Wt(h,Dt)?(o.write(N,b++,h),l.push(p)):_t(h,Et)&&(S&&s&&s.write(S,R++,h),c.push(p))});let x=new Float32Array(l.reverse()),E=new Float32Array(c.reverse()),v=S&&s?{instancesData:S.slice(0,R),lodInfo:{lengths:E}}:void 0;return{regular:{instancesData:N.slice(0,b),lodInfo:{lengths:x}},silhouette:v,averageEdgeLength:e/n}}function Wt(t,o){return t.cosAngle<o}function Mt(t,o){return t.cosAngle>o}function _t(t,o){let s=mt(t.cosAngle);return yt(At,t.position1,t.position0),s*(q(st(Ft,t.faceNormal0,t.faceNormal1),At)>0?-1:1)>o}function Ct(t){let o=t.faces.length/3,s=t.faces,r=t.neighbors,i=t.vertices.position;m.length=ct.length=0;for(let u=0;u<o;u++){let g=3*u,d=r[g],I=r[g+1],a=r[g+2],f=s[g],w=s[g+1],N=s[g+2];i.getVec(f,O),i.getVec(w,Y),i.getVec(N,Z),ot(Y,Y,O),ot(Z,Z,O),st(O,Y,Z),j(O,O),ct.pushArray(O),(d===$||f<w)&&(m.push(f),m.push(w),m.push(u),m.push(d)),(I===$||w<N)&&(m.push(w),m.push(N),m.push(u),m.push(I)),(a===$||N<f)&&(m.push(N),m.push(f),m.push(u),m.push(a))}return{edges:m,normals:ct}}var lt=class{constructor(){this.index=0,this.length=0}},Q=new T({allocator:t=>t||new lt,deallocator:null}),m=new T({deallocator:null}),ct=new T({deallocator:null}),h=new K,Ft=y(),At=y(),O=y(),Y=y(),Z=y(),Et=tt(4),Pt=Math.cos(Et),Ut=tt(35),Dt=Math.cos(Ut);function le(t){let o=Rt(t.data,t.skipDeduplicate,t.indices,t.indicesLength);return Lt.updateSettings(t.writerSettings),vt.updateSettings(t.writerSettings),St(o,Lt,vt)}function Rt(t,o,s,r){if(o){let g=at(s,r,t.count);return new ut(s,r,g,t)}let i=It(t.buffer,t.stride/4,{originalIndices:s,originalIndicesLength:r}),u=at(i.indices,r,i.uniqueCount);return{faces:i.indices,facesLength:i.indices.length,neighbors:u,vertices:xt.createView(i.buffer)}}var ut=class{constructor(o,s,r,i){this.faces=o,this.facesLength=s,this.neighbors=r,this.vertices=i}},Lt=new P,vt=new U,ue=nt().vec3f(M.POSITION0).vec3f(M.POSITION1),fe=nt().vec3f(M.POSITION0).vec3f(M.POSITION1).u16(M.COMPONENTINDEX);export{St as a,P as b,U as c,le as d,Rt as e,ue as f,fe as g};
