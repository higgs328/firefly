import{a as ns,c as Ys}from"./chunk-LTHAIW3V.js";import{a as ct}from"./chunk-RRQS6PLL.js";import{$ as Lu,A as ln,B as Fu,C as Ps,D as Vu,E as qu,F as io,G as zi,J as rh,K as Wt,L as Oi,M as oh,N as Ae,O as un,P as si,Q as ke,R as ro,S as Rs,T as Yu,V as Xu,W as Qs,X as ku,Y as Ru,Z as Hu,_ as ah,a as Mu,aa as Bu,b as hn,ba as cn,c as Ft,ca as hh,d as sh,da as mh,e as Hi,ea as st,f as so,fa as Wi,g as no,ga as Me,h as xs,i as Li,j as nh,k as ot,l as ys,m as Mn,o as ih,p as Bi,q as Ce,r as Zs,s as mn,t as Gu,u as he,v as Ui,w as ei,x as Rt,y as Gn,z as Ot}from"./chunk-WFHQTMIY.js";import{a as V}from"./chunk-XAZOVQGA.js";import{$a as Xi,A as Qr,Aa as Fi,B as mu,Ba as Vi,C as Kr,Ca as ti,D as Ua,Da as $a,E as Qn,Ea as Z,F as oe,Fa as qi,G as B,Ga as xu,H,Ha as Kt,I as on,Ia as Ja,J as Kn,Ja as Yi,K as lu,Ka as ut,L as is,La as yu,M as rs,Ma as Pu,N as uu,Na as Ne,Oa as Cu,P as cu,Pa as At,Q as bs,Qa as Eu,R as an,Ra as We,S as Ut,Sa as th,T as zt,Ta as Pe,U as $n,V as ze,Va as eh,W as Oe,Wa as ne,X as pt,Xa as Su,Y as ae,Ya as vu,Z as se,Za as Iu,_ as qt,_a as ps,a as w,aa as Et,ab as ki,b as N,ba as za,bb as to,c as Te,ca as gu,cb as Ri,d as nn,da as Mt,db as bu,e as ou,eb as kt,fa as Oa,fb as bt,g as Qt,ga as Xs,gb as Tt,h as Ie,ha as du,hb as eo,i as at,ia as Wa,ib as wu,j as La,ja as _u,jb as _t,k as Zn,ka as Jn,kb as ge,la as $r,lb as ks,m as Mi,ma as ye,mb as Du,n as Ba,nb as Tu,o as U,oa as O,ob as J,pa as Nn,pb as fs,q as au,qa as Jr,qb as de,r as re,ra as os,rb as Nu,s as Gi,sa as _s,sb as Au,t as ft,ta as ja,tb as An,u as xt,ua as Za,ub as y,v as j,va as pu,w as hu,wa as Qa,x as Zr,xa as Ka,y as rn,ya as fu,z as ds,za as k}from"./chunk-V3KEO7AJ.js";import{d as xe,e as qs}from"./chunk-QGVBCWUY.js";import{a as Tn,b as Ha}from"./chunk-VTHXE323.js";var ii=class{constructor(){this.posStream=null,this.streams=null}get(t){return t>0?this.streams[t-1]:this.posStream}set(t,e){t>0?this.streams[t-1]=e:this.posStream=e}destroyAndSetSize(t){if(this.streams=null,t>1){this.streams=new Array(t-1);for(let e=0;e<t-1;++e)this.streams[e]=null}this.posStream=null}swap(t){[this.streams,t.streams]=[t.streams,this.streams],[this.posStream,t.posStream]=[t.posStream,this.posStream]}empty(){return this.posStream===null&&this.streams===null}};function mp(r,t,e,s,n){(t<0||e<0||s<1||t+s*(e-1)+1>r.size())&&U("Index out of bound");for(let i=t,o=t+s*(e-1)+1;i<o;i+=s)r.writeAsDbl(i,n(r.readAsDbl(i)))}function jc(r,t,e){if(r)for(let s=t.length-1;s>=0;--s)e(t[s]);else t.forEach(e)}function lp(r,t){let e=ki(r),s=t.length/Pe();for(let n=0;n<t.length;++n){let i=Math.trunc(e*s);e=ki(e);let o=Math.trunc(e*s),a=t[i];t[i]=t[o],t[o]=a}}function dE(r,t,e){if(r.length===0)return;let s=0,n=0;for(++n;n!==r.length;++n)t(r[s],r[n])||(e(s,n),s=n);e(s,n)}function _E(r,t,e,s,n){os(r,t,s-t,(i,o)=>n(i,o)?-1:1)}function Uu(r,t,e){if(!(e<=t))for(;t<e;)r[e]=O(r[t],r[t]=r[e]),t++,e--}function pE(r,t,e,s){Uu(r,t,e-1),Uu(r,e,s-1),r.reverse()}function up(r,t,e){let s=r.getDescription().getTotalComponentCount();r.setX(t[0]),r.setY(t[1]),ye(r.getAttributeArray(),t,0,2,s-2)}var jt=Ft,yh="can not assign an empty point to a vertex",Po=class{constructor(t){if(this.m_accelerators=null,t!==void 0&&t.move)this.m_description=t.move.m_description,t.move.m_description=xs(),this.m_vertexAttributes=t.move.m_vertexAttributes,t.move.m_vertexAttributes=new ii,this.m_envelopeData=t.move.m_envelopeData,t.move.m_envelopeData=new Wi,this.m_pointCount=t.move.m_pointCount,this.m_reservedPointCount=t.move.m_reservedPointCount,this.m_flags=t.move.m_flags,this.m_bFillRule=t.move.m_bFillRule,this.m_bPathStarted=t.move.m_bPathStarted,this.m_bPolygon=t.move.m_bPolygon,this.m_simpleTolerance=t.move.m_simpleTolerance;else{let e=t!==void 0&&t.vd?t.vd:xs();this.m_description=e,this.m_vertexAttributes=new ii,this.m_envelopeData=new Wi,this.m_pointCount=0,this.m_reservedPointCount=-1,this.m_flags=4063,this.m_bFillRule=this.m_bPathStarted=this.m_bPolygon=!1,this.m_simpleTolerance=0,t!==void 0&&t.copy&&t.copy.copyTo(this)}}equalsBase(t,e){if(!Ie(t.getGeometryType()))return!1;let s=t;if(this===s)return!0;if(!this.m_description.equals(s.getDescription())||this.isEmptyImpl()!==s.isEmptyImpl())return!1;if(this.isEmptyImpl())return!0;let n=this.getPointCount();if(n!==s.getPointCount())return!1;for(let i=0;i<this.m_description.getAttributeCount();i++){let o=this.m_description.getSemantics(i),a=this.getAttributeStreamRef(o),h=s.getAttributeStreamRef(o),m=jt.getComponentCount(o);if(!a.equals(h,0,n*m,e))return!1}if(e){if(!this.equalsImplTol(t,e))return!1}else if(!this.equalsImpl(t))return!1;return!0}transformAttribute(t,e,s,n,i){this.addAttribute(t),this.isEmpty()||s===0&&n===1||(mp(this.getAttributeStreamRef(t),e,this.getPointCount(),jt.getComponentCount(t),qu(s,n,i)),this.notifyModified())}getDescription(){return this.m_description}assignVertexDescription(t){this.m_description!==t&&this.assignVertexDescriptionImpl(t)}mergeVertexDescriptionImpl(t){let e=this.getDescription(),s=Hi(e,t);this.assignVertexDescription(s)}mergeVertexDescription(t){this.m_description!==t&&(this.m_description.hasAttributesFrom(t)||this.mergeVertexDescriptionImpl(t))}hasAttribute(t){return this.m_description.hasAttribute(t)}addAttribute(t){if(this.m_description.hasAttribute(t))return;let e=so(this.m_description,t);this.assignVertexDescription(e)}dropAttribute(t){if(!this.m_description.hasAttribute(t))return;let e=no(this.m_description,t);this.assignVertexDescription(e)}dropAllAttributes(){let t=xs();t!==this.m_description&&this.assignVertexDescription(t)}getAttributeStreamRef(t){this.throwIfEmpty(),this.m_description.hasAttribute(t)||U("AttributeStream : Geometry does not have the attribute");let e=this.m_description.getAttributeIndex(t);return this.m_vertexAttributes.get(e)}setAttributeStreamRef(t,e){e||U("stream"),e&&jt.getPersistence(t)!==e.getPersistence()&&U(""),this.addAttribute(t);let s=this.m_description.getAttributeIndex(t);this.m_vertexAttributes.empty()&&this.m_vertexAttributes.destroyAndSetSize(this.m_description.getAttributeCount()),this.m_vertexAttributes.set(s,e),this.notifyModifiedFlags(2001)}notifyModifiedFlags(t){t===65535&&(this.m_reservedPointCount=-1,this.notifyModifiedAllImpl()),this.setDirtyFlagProtected(t,!0),this.clearAccelerators(),32&t&&this.verifyAllStreamsAfterSizeChange()}notifyModified(){this.notifyModifiedFlags(2001)}getPointCount(){return this.m_pointCount}getPointByVal(t,e){let s=e;s.assignVertexDescription(this.m_description);for(let n=0;n<this.m_description.getAttributeCount();n++){let i=this.m_description.getSemantics(n);for(let o=0,a=jt.getComponentCount(i);o<a;o++){let h=this.m_vertexAttributes.get(n).readAsDbl(a*t+o);s.setAttributeBasic(i,o,h)}}}setPointByVal(t,e){let s=e;s.isEmpty()&&U(yh);let n=s.getDescription();n!==this.m_description&&this.mergeVertexDescription(n);let i=this.m_vertexAttributes.get(0);i.write(2*t,s.getX()),i.write(2*t+1,s.getY());for(let o=1,a=this.m_description.getAttributeCount();o<a;o++){let h=this.m_description.getSemantics(o),m=jt.getComponentCount(h);for(let l=0;l<m;l++){let u=s.getAttributeAsDbl(h,l);this.m_vertexAttributes.get(o).writeAsDbl(t*m+l,u)}}this.notifyModifiedFlags(2001)}setPointByValFromArray(t,e,s,n){w(0)}getPointByValAsArray(t,e,s,n){w(0)}isEmpty(){return this.isEmptyImpl()}isEmptyImpl(){return this.m_pointCount===0}getAttributeAsDbl(t,e,s){let n=jt.getComponentCount(t);s>=n&&xt("");let i=this.m_description.getAttributeIndex(t);return i>=0?this.m_vertexAttributes.get(i).readAsDbl(e*n+s):jt.getDefaultValue(t)}queryAttributeAsDbl(t,e,s,n){let i=jt.getComponentCount(t);n<i&&xt("");let o=this.m_description.getAttributeIndex(t);if(o>=0){let a=e*i,h=this.m_vertexAttributes.get(o);for(let m=0;m<i;m++)s[m]=h.readAsDbl(a+m)}else{let a=jt.getDefaultValue(t);for(let h=0;h<i;h++)s[h]=a}}getAttributeAsInt(t,e,s){return Math.trunc(this.getAttributeAsDbl(t,e,s))}queryAttributeAsInt(t,e,s,n){w(0)}setAttribute(t,e,s,n){let i=jt.getComponentCount(t);s>=i&&xt(""),this.addAttribute(t);let o=this.m_description.getAttributeIndex(t);this.notifyModifiedFlags(2001),this.m_vertexAttributes.get(o).writeAsDbl(e*i+s,n)}setAttributeFromArray(t,e,s,n){(e<0||e>=this.m_pointCount)&&xt("");let i=jt.getComponentCount(t);n!==i&&xt(""),this.addAttribute(t);let o=this.m_description.getAttributeIndex(t);this.notifyModifiedFlags(2001);let a=this.m_vertexAttributes.get(o);for(let h=0;h<i;++h)a.writeAsDbl(e*i+h,s[h])}getXY(t){return this.m_vertexAttributes.get(0).readPoint2D(2*t)}queryXY(t,e){return this.m_vertexAttributes.get(0).queryPoint2D(2*t,e)}setXY(t,e){this.m_vertexAttributes.get(0).writePoint2D(2*t,e),this.notifyModifiedFlags(2001)}setXYCoords(t,e,s){let n=this.m_vertexAttributes.get(0);n.write(2*t,e),n.write(2*t+1,s),this.notifyModifiedFlags(2001)}getXYZ(t){let e=this.m_vertexAttributes.get(0),s=ot.getNAN();return s.x=e.read(2*t),s.y=e.read(2*t+1),this.m_description.hasAttribute(1)?s.z=this.m_vertexAttributes.get(1).read(t):s.z=jt.getDefaultValue(1),s}setXYZ(t,e){this.addAttribute(1),this.notifyModifiedFlags(2001);let s=this.m_vertexAttributes.get(0);s.write(2*t,e.x),s.write(2*t+1,e.y),this.m_vertexAttributes.get(1).write(t,e.z)}queryEnvelope(t){t instanceof V||t instanceof ys?this.updateEnvelope(t):(this.updateAllDirtyIntervals(!0),this.m_envelopeData.copyTo(this.m_description,t))}queryLooseEnvelope(t){this.updateLooseEnvelope(t)}queryInterval(t,e){let s=B.constructEmpty();return this.isEmptyImpl()||(this.updateAllDirtyIntervals(!0),this.m_envelopeData.queryInterval(this.m_description,t,e,s)),s}setAttributeBasic(t,e,s){this.setAttributeImpl(t,e,s)}setAttributeImpl(t,e,s){if(this.addAttribute(t),this.isEmpty())return;let n=!1,i=jt.getComponentCount(t),o=this.getAttributeStreamRef(t),a=Number.isNaN(s);if(o.getPersistence()===1){let h=o;for(let m=e,l=this.m_pointCount*i;m<l;m+=i){let u=h.read(m);(a||u===s)&&Number.isNaN(u)||(h.write(m,s),n=!0)}}else for(let h=e,m=this.m_pointCount*i;h<m;h+=i)o.readAsDbl(h)!==s&&(o.writeAsDbl(h,s),n=!0);n&&this.notifyModifiedFlags(2001)}replaceNaNs(t,e){if(this.addAttribute(t),this.isEmpty())return;let s=!1,n=jt.getComponentCount(t),i=this.getAttributeStreamRef(t);for(let o=0;o<n;o++)if(i.getPersistence()===1){let a=i;for(let h=0,m=this.m_pointCount*n;h<m;h++){let l=a.read(h);Number.isNaN(l)&&(a.write(h,e),s=!0)}}else for(let a=0,h=this.m_pointCount*n;a<h;a++){let m=i.readAsDbl(a);Number.isNaN(m)&&(i.writeAsDbl(a,e),s=!0)}s&&this.notifyModifiedFlags(2001)}calculateLength3D(t){return w(0),0}setEnvelopeForImport(t){this.m_description.equals(t.getDescription())||U(""),this.m_envelopeData=new Wi({moveEnv:t}),this.setDirtyFlagProtected(192,!1)}copyTo(t){t.getGeometryType()!==this.getGeometryType()&&U(""),this!==t&&this.copyToUnchecked(t,!1)}queryCoordinates(t,e,s,n){let i=n<0?this.m_pointCount:n;if(i=Math.min(i,s+e),(s<0||i<s||this.m_pointCount>0&&s>=this.m_pointCount)&&U(""),this.m_pointCount===0)return i;let o=this.getAttributeStreamRef(0);for(let a=2*s,h=2*i,m=0;a<h;a+=2,m++)o.queryPoint2D(a,t[m]);return i}queryCoordinates3D(t,e,s,n){let i=n<0?this.m_pointCount:n;if(i=Math.min(i,s+e),(s<0||i<s||this.m_pointCount>0&&s>=this.m_pointCount)&&U(""),this.m_pointCount===0)return i;let o=this.getAttributeStreamRef(0),a=null,h=jt.getDefaultValue(1),m=this.m_description.hasAttribute(1);m&&(a=this.getAttributeStreamRef(1));let l=0;for(let u=s;u<i;u++,l++)t[l].x=o.read(2*u),t[l].y=o.read(2*u+1),t[l].z=m?a.read(u):h;return i}clearAndSetDirtyFlagProtected(t,e){let s=0,n=t&~e,i=e|n;s=this.m_flags,(s&i)!==e&&(this.m_flags=s&~n|e)}getIsSimple(t,e){e[0]=0;let s=-1,n=this.m_flags,i=this.m_simpleTolerance;return 1&n||(s=(14&n)>>1,e[0]=i,i<t&&(s=-1)),s}setIsSimple(t,e,s=!1){if(t===2?w(this.getGeometryType()===N.enumPolyline):t===1?w(this.getGeometryType()===N.enumMultiPoint||this.getGeometryType()===N.enumPolyline):t===3&&w(this.getGeometryType()===N.enumPolygon),t===-1)this.setDirtyFlagProtected(17,!0);else{let n=t<<1;s||(n|=16),this.clearAndSetDirtyFlagProtected(31,n),this.m_simpleTolerance!==e&&(this.m_simpleTolerance=e)}}attributeStreamIsAllocated(t){this.throwIfEmpty();let e=this.m_description.getAttributeIndex(t);return e>=0&&this.m_vertexAttributes.get(e)!==null}capacity(){return this.m_reservedPointCount===-1&&this.m_pointCount===0?0:this.m_reservedPointCount}getDescriptionImpl(){return this.m_description}copyToUnchecked(t,e=!1){e&&this.hasDirtyFlag(32)&&hu("Cannot do shallow clone on unprepared geometry");let s=t,n=this.getGeometryType(),i=s.getGeometryType();w(n===i||n===N.enumPolygon&&i===N.enumPolyline,"failure in copyToUnchcked"),s.clearAccelerators(),s.m_description=this.m_description,s.m_vertexAttributes.destroyAndSetSize(0),s.m_envelopeData.releaseAttributes();let o=this.m_description.getAttributeCount(),a=new ii;if(!this.m_vertexAttributes.empty()){a.destroyAndSetSize(o);for(let h=0;h<o;h++)if(this.m_vertexAttributes.get(h))if(e)a.set(h,this.m_vertexAttributes.get(h));else{let m=jt.getComponentCount(this.m_description.getSemantics(h));a.set(h,this.m_vertexAttributes.get(h).restrictedClone(this.getPointCount()*m))}}if(this.m_envelopeData.copyToIfNotNull(this.m_description,s.m_envelopeData),s.m_flags=this.m_flags,s.m_simpleTolerance=this.m_simpleTolerance,n!==i){let h=[Number.NaN];s.getIsSimple(0,h)>=3?s.setIsSimple(1,h[0]):s.setIsSimple(-1,0)}s.m_vertexAttributes.swap(a),a.destroyAndSetSize(0),s.m_pointCount=this.m_pointCount,s.hasDirtyFlag(32)?(w(!e),s.m_reservedPointCount=-1):s.m_reservedPointCount=s.m_pointCount;try{this.copyToImpl(s,e)}catch(h){throw s.setEmpty(),h}s.verifyAllStreamsAfterSizeChange()}buildRasterizedGeometryAccelerator(t,e){return!1}getAccelerators(){return this.m_accelerators}clearAccelerators(){this.m_accelerators&&this.m_accelerators.release(),this.m_accelerators=null}ensureUniqueAccelerators(){if(this.m_accelerators&&!this.m_accelerators.uniqueUse()){let t=this.m_accelerators.clone();this.m_accelerators.release(),this.m_accelerators=t}}interpolateTwoVertices(t,e,s,n){(t<0||t>=this.m_pointCount)&&xt(""),(e<0||e>=this.m_pointCount)&&xt(""),n.assignVertexDescription(this.m_description);let i=Z(jt.maxComponentCount(),Number.NaN),o=Z(jt.maxComponentCount(),Number.NaN),a=hn(),h=0;for(let m=0;m<this.m_description.getAttributeCount();m++){let l=this.m_description.getSemantics(m),u=jt.getInterpolation(l),c=jt.getComponentCount(l),g=jt.getDefaultValue(l);this.queryAttributeAsDbl(l,t,i,c),this.queryAttributeAsDbl(l,e,o,c),w(h+c<=Mu),$r(u,i,o,a,h,c,s,g),h+=c}up(n,a)}getShortestDistance(t,e){return y.distance(this.getXY(t),this.getXY(e))}getShortestSqrDistance(t,e){return y.sqrDistance(this.getXY(t),this.getXY(e))}resizeImpl(t){if(t<0&&U(),(t=Math.ceil(t))===this.m_pointCount)return;this.m_pointCount=t;let e=this.m_pointCount<=this.m_reservedPointCount?2001:4095;this.notifyModifiedFlags(e)}assignVertexDescriptionImpl(t){if(!this.m_vertexAttributes.empty()){let e=sh();nh(t,this.m_description,e);let s=new ii;s.destroyAndSetSize(t.getAttributeCount());for(let n=0;n<t.getAttributeCount();n++){let i=e[n];i!==-1?s.set(n,this.m_vertexAttributes.get(i)):this.m_reservedPointCount=-1}s.swap(this.m_vertexAttributes)}this.m_description=t,this.m_envelopeData.releaseAttributes(),this.notifyModifiedFlags(4095)}hasDirtyFlag(t){return!!(this.m_flags&t)}setDirtyFlagProtected(t,e){e?this.m_flags|=t:this.m_flags&=~t}notifyModifiedAllImpl(){}verifyAllStreamsAfterSizeChange(){this.hasDirtyFlag(32)&&this.verifyAllStreamsAfterSizeChangeImpl()}verifyAllStreamsAfterSizeChangeImpl(){if(this.hasDirtyFlag(32)){if(this.m_reservedPointCount<this.m_pointCount){this.m_vertexAttributes.empty()&&this.m_vertexAttributes.destroyAndSetSize(this.m_description.getAttributeCount()),this.m_reservedPointCount=Number.MAX_SAFE_INTEGER;let t=0;t=this.m_pointCount<4?3:this.m_pointCount<=128?2*this.m_pointCount:Math.trunc((4*this.m_pointCount+2)/3);for(let e=0;e<this.m_description.getAttributeCount();e++){let s=this.m_description.getSemantics(e),n=0;if(this.m_vertexAttributes.get(e)!==null){let i=jt.getComponentCount(s);n=this.m_vertexAttributes.get(e).size()/i,n<this.m_pointCount&&(this.m_vertexAttributes.get(e).resize(t*i,jt.getDefaultValue(s)),n=t)}else this.m_vertexAttributes.set(e,ih(s,t)),n=t;n<this.m_reservedPointCount&&(this.m_reservedPointCount=n)}}this.verifyStreamsAfterSizeChangeExtraImpl(),this.setDirtyFlagProtected(32,!1)}}verifyStreamsAfterSizeChangeExtraImpl(){}updateAllDirtyIntervals(t){if(t?this.hasDirtyFlag(192):this.hasDirtyFlag(128)){if(this.isEmpty())return this.hasDirtyFlag(192)&&this.m_envelopeData.setEmpty(this.m_description),void this.setDirtyFlagProtected(192,!1);let e=this.updateXYImpl(t),s=new Me({vd:this.m_description});s.setEnvelope(e);for(let n=1;n<this.m_description.getAttributeCount();n++){let i=this.m_description.getSemantics(n),o=jt.getComponentCount(i),a=this.m_vertexAttributes.get(n);for(let h=0;h<o;h++){let m=new B;m.setEmpty();for(let l=0;l<this.m_pointCount;l++){let u=a.readAsDbl(l*o+h);m.mergeCoordinate(u)}s.setIntervalEnvelope(i,h,m)}}(t?this.hasDirtyFlag(192):this.hasDirtyFlag(128))&&(this.m_envelopeData=new Wi({moveEnv:s}),this.clearDirtyIntervalsFlag(t))}}updateXYImpl(t){let e=V.constructEmpty(),s=this.m_vertexAttributes.get(0);return e.mergePointsInterleaved(s,0,this.m_pointCount),e}updateEnvelope3D(t){w(0)}updateLooseEnvelope(t){this.updateAllDirtyIntervals(!1),t instanceof V?t.assign(this.m_envelopeData.m_envelope2D):this.m_envelopeData.queryEnvelope3D(this.m_description,t)}updateEnvelope(t){this.updateAllDirtyIntervals(!0),t.assign(this.m_envelopeData.m_envelope2D)}setEmptyImpl(){this.m_pointCount=0,this.m_reservedPointCount=-1,this.m_vertexAttributes.destroyAndSetSize(0),this.notifyModifiedFlags(4095)}clearDirtyIntervalsFlag(t){this.setDirtyFlagProtected(192,!1)}reserveImpl(t,e){if(t<0&&U(""),t===0)return;let s=t=Math.ceil(t);if(this.m_reservedPointCount<s){this.m_vertexAttributes.empty()&&this.m_vertexAttributes.destroyAndSetSize(this.m_description.getAttributeCount()),e?(this.m_vertexAttributes.get(0)===null&&this.m_vertexAttributes.set(0,Bi(0,0)),this.m_vertexAttributes.get(0).resizeRounded(2*s),s=this.m_vertexAttributes.get(0).size()>>1):this.m_vertexAttributes.get(0)===null?this.m_vertexAttributes.set(0,Bi(0,s)):this.m_vertexAttributes.get(0).resize(2*s);for(let n=1;n<this.m_description.getAttributeCount();n++){let i=this.m_description.getSemantics(n),o=jt.getComponentCount(i);this.m_vertexAttributes.get(n)!==null?this.m_vertexAttributes.get(n).resize(s*o):this.m_vertexAttributes.set(n,Bi(i,s))}this.reserveImplImpl(s,e),this.m_reservedPointCount=s}}reserveRounded(t){t<0&&U(),t=Math.ceil(t),this.reserveImpl(t,!0)}reserveImplImpl(t,e){}throwIfEmpty(){this.isEmptyImpl()&&Gi("")}},Lt=class r extends Po{constructor(t){super(t),t&&(t.points?this.addPoints2D(t.points,t.pointsSize,0,-1):t.point&&this.add(t.point))}assignCopy(t){return t.copyTo(this),this}assignMove(t){return t.copyTo(this),t.setEmpty(),this}insertPoint2D(t,e){t>this.getPointCount()&&U("invalid point index"),t<0&&(t=this.getPointCount());let s=this.m_pointCount;this.resizeNoInit(this.m_pointCount+1);for(let n=0,i=this.m_description.getAttributeCount();n<i;n++){let o=this.m_description.getSemantics(n),a=Ft.getComponentCount(o);if(o===0)this.m_vertexAttributes.get(n).insert(a*t,e,a*s);else{let h=Ft.getDefaultValue(o);this.m_vertexAttributes.get(n).insertRange(a*t,h,a,a*s)}}this.notifyModifiedFlags(2001)}insertPoint(t,e){e.isEmpty()&&U(yh),t<0&&(t=this.getPointCount()),this.mergeVertexDescription(e.getDescription());let s=this.m_pointCount;this.resizeNoInit(this.m_pointCount+1);for(let n=0,i=this.m_description.getAttributeCount();n<i;n++){let o=this.m_description.getSemantics(n),a=Ft.getComponentCount(o);if(e.hasAttribute(o))this.m_vertexAttributes.get(n).insertAttributes(a*t,e,o,a*s);else{let h=Ft.getDefaultValue(o);this.m_vertexAttributes.get(n).insertRange(a*t,h,a,a*s)}}this.notifyModifiedFlags(2001)}insertPoints(t,e,s){if((t>this.getPointCount()||s<0)&&xt(""),t<0&&(t=this.getPointCount()),s===0)return;let n=e[0].getDescription();this.mergeVertexDescription(n);let i=this.m_pointCount;this.resizeNoInit(this.m_pointCount+s);for(let o=0,a=this.m_description.getAttributeCount();o<a;o++){let h=this.m_description.getSemantics(o),m=Ft.getComponentCount(h);if(this.m_vertexAttributes.get(o))if(n.hasAttribute(h))this.m_vertexAttributes.get(o).insertAttributesFromPoints(t*m,e,s,h,i*m);else{let l=Ft.getDefaultValue(h);this.m_vertexAttributes.get(o).insertRange(m*t,l,m*s,m*i)}}this.notifyModifiedFlags(2001)}insertPoints2D(t,e,s){if((t>this.getPointCount()||s<0)&&U("invalid point index"),t<0&&(t=this.getPointCount()),s===0)return;let n=this.m_pointCount;this.resizeNoInit(this.m_pointCount+s);for(let i=0,o=this.m_description.getAttributeCount();i<o;i++){let a=this.m_description.getSemantics(i),h=Ft.getComponentCount(a);if(this.m_vertexAttributes.get(i))if(a===0)this.m_vertexAttributes.get(i).insertRangeFromPoints(h*t,e,0,s,!0,h*n);else{let m=Ft.getDefaultValue(a);this.m_vertexAttributes.get(i).insertRange(h*t,m,h,h*n)}}this.notifyModifiedFlags(2001)}removePoints(t,e){if((t<0||e<0||t+e>this.getPointCount())&&xt("remove_points"),e!==0){for(let s=0,n=this.m_description.getAttributeCount();s<n;s++)if(this.m_vertexAttributes.get(s)){let i=this.m_description.getSemantics(s),o=Ft.getComponentCount(i);this.m_vertexAttributes.get(s).eraseRange(o*t,o*e,o*this.m_pointCount)}this.m_pointCount-=e,this.m_reservedPointCount>0&&(this.m_reservedPointCount-=e),this.notifyModifiedFlags(2001)}}removePoint(t){for(let e=0,s=this.m_description.getAttributeCount();e<s;e++)if(this.m_vertexAttributes.get(e)){let n=this.m_description.getSemantics(e),i=Ft.getComponentCount(n);this.m_vertexAttributes.get(e).eraseRange(i*t,i,i*this.m_pointCount)}this.m_pointCount--,this.m_reservedPointCount>0&&this.m_reservedPointCount--,this.notifyModifiedFlags(2001)}calculateEnvelope2D(){return this.updateXYImpl(!0)}resizeNoInit(t){this.resizeImpl(t)}resizeAndInitNonPositionAttributes(t){let e=this.m_pointCount;if(this.resizeImpl(t),this.m_pointCount>e)for(let s=1,n=this.m_description.getAttributeCount();s<n;s++){let i=this.m_description.getSemantics(s),o=Ft.getDefaultValue(i),a=Ft.getComponentCount(i);this.m_vertexAttributes.get(s).insertRange(a*e,o,a*(this.m_pointCount-e),a*e)}}queryCoordinates3D(t,e,s,n){let i=n<0?this.m_pointCount:n;if(i=Math.min(i,s+e),(s<0||i<s||this.m_pointCount>0&&s>=this.m_pointCount)&&U(""),this.m_pointCount===0)return i;let o=this.getAttributeStreamRef(0),a=null,h=Ft.getDefaultValue(1),m=this.m_description.hasAttribute(1);m&&(a=this.getAttributeStreamRef(1));let l=0;for(let u=s;u<i;u++,l++)t[l].x=o.read(2*u),t[l].y=o.read(2*u+1),t[l].z=m?a.read(u):h;return i}queryAttributeAsInt(t,e,s,n){w(0)}add(t){t.isEmpty()&&U(yh),this.resizeAndInitNonPositionAttributes(this.m_pointCount+1),this.setPointByVal(this.m_pointCount-1,t)}addXY(t,e){this.resizeAndInitNonPositionAttributes(this.m_pointCount+1);let s=new y(t,e);this.setXY(this.m_pointCount-1,s)}addXYZ(t,e,s){this.resizeAndInitNonPositionAttributes(this.m_pointCount+1);let n=new ot;n.setCoords(t,e,s),this.setXYZ(this.m_pointCount-1,n)}addPoint2D(t){this.addXY(t.x,t.y)}addPoint3D(t){this.addXYZ(t.x,t.y,t.z)}addPoints(t,e,s){this===t&&U("Multi_point_impl.add");let n=s<0?t.getPointCount():s;if((e<0||e>t.getPointCount()||n<e)&&U(""),e===n)return;let i=t.getDescription();this.mergeVertexDescription(i);let o=n-e,a=this.m_pointCount;this.resizeNoInit(this.m_pointCount+o);for(let h=0,m=this.m_description.getAttributeCount();h<m;h++){let l=this.m_description.getSemantics(h),u=Ft.getComponentCount(l),c=this.getAttributeStreamRef(l);if(i.hasAttribute(l)){let g=t.getAttributeStreamRef(l);c.insertRangeFromStream(a*u,g,e*u,o*u,!0,1,a*u)}else{let g=Ft.getDefaultValue(l);c.insertRange(a*u,g,o*u,a*u)}}}addPoints2D(t,e,s,n){let i=e,o=n<0?i:n;if((i<0||s<0||s>i||o<s)&&U(""),s===o)return;i=o-s;let a=this.m_pointCount;this.resizeAndInitNonPositionAttributes(this.m_pointCount+i);let h=this.getAttributeStreamRef(0);for(let m=0;m<i;++m)h.writePoint2D(2*(a+m),t[s+m]);this.notifyModifiedFlags(2001)}addPoints3D(t,e,s,n){let i=e,o=n<0?i:n;if((i<0||s<0||s>i||o<s)&&U(""),this.addAttribute(1),s===o)return;i=o-s;let a=this.m_pointCount;this.resizeAndInitNonPositionAttributes(this.m_pointCount+i);let h=this.getAttributeStreamRef(0),m=new y;for(let u=0;u<i;u++)m.x=t[s+u].x,m.y=t[s+u].y,h.writePoint2D(2*(a+u),m);let l=this.getAttributeStreamRef(1);for(let u=0;u<i;u++)l.write(a+u,t[s+u].z);this.notifyModifiedFlags(2001)}getGeometryType(){return N.enumMultiPoint}getDimension(){return 0}createInstance(){return new r({vd:this.getDescription()})}setEmpty(){this.setEmptyImpl()}applyTransformation(t){if(this.isEmpty()||t.isIdentity())return;let e=this.m_vertexAttributes.get(0);t.m_TransformationType===1?e.applyTransformation(t,0,this.m_pointCount):ft("3d xform not impl"),this.notifyModifiedFlags(2001)}calculateArea2D(){return 0}calculateLength2D(){return 0}calculateLength3D(t){return 0}equals(t,e){return t.getGeometryType()===N.enumMultiPoint&&this.equalsBase(t,e)}queryEnvelope(t){t.m_EnvelopeType===4?(this.updateAllDirtyIntervals(!0),this.m_envelopeData.copyTo(this.m_description,t)):t.m_EnvelopeType===2?this.updateEnvelope(t):ft("")}getImpl(){return this}getBoundary(){return null}reserve(t){this.reserveImpl(t)}clone(){let t=this.createInstance();return this.copyTo(t),t}swap(t){w(0)}buildQuadTreeAccelerator(t){return!1}getHashCodeImpl(){return w(0),0}equalsImpl(t){return!0}equalsImplTol(t,e){return!0}copyToImpl(t,e){}};Lt.type=N.enumMultiPoint;var me=class r{constructor(){this.m_EnvelopeType=5,this.envAabb=V.constructEmpty(),this.envRot=V.constructEmpty()}static constructEmpty(){return new r}width(){return this.envAabb.width()}height(){return this.envAabb.height()}maxDim(){return Math.max(this.width(),this.height())}setEmpty(){this.envAabb.setEmpty(),this.envRot.setEmpty()}setCoords(t){this.envAabb.setCoords(t),this.envRot.setCoords({x:ji(t),y:Zi(t)})}setFromPoints(t,e){this.setEmpty(),this.mergePoints(t,e)}mergeNe(t){this.envAabb.mergeNe(t),this.envRot.mergeNeCoords(ji(t),Zi(t))}mergePoints(t,e){this.envAabb.mergePoints(t,e);for(let s=0;s<e;){if(!this.envRot.isEmpty()){for(let n=s;n<e;n++){let i=ji(t[n]),o=Zi(t[n]);this.envRot.mergeNeCoords(i,o)}break}{let n=ji(t[s]),i=Zi(t[s]);this.envRot.setCoords({x:n,y:i}),s++}}}isIntersectingPoint2D(t){return!(!this.envAabb.contains(t)||!this.envRot.containsCoords(ji(t),Zi(t)))}isIntersectingW(t){return this.envAabb.isIntersecting(t.envAabb)&&this.envRot.isIntersecting(t.envRot)}containsW(t){return!(!this.envAabb.containsEnvelope(t.envAabb)||!this.envRot.containsEnvelope(t.envRot))}containsPoint2D(t){return this.isIntersectingPoint2D(t)}intersectW(t){let e=this.envAabb.intersect(t.envAabb),s=this.envRot.intersect(t.envRot);return e&&!s&&this.envAabb.setEmpty(),s&&!e&&this.envRot.setEmpty(),e&&s}inflate(t){this.envAabb.inflateCoords(t,t);let e=t*bu();this.envRot.inflateCoords(e,e),e<0&&r.st_reduceEmpty(this)}static st_reduceEmpty(t){let e=t.envAabb.isEmpty(),s=t.envRot.isEmpty();e&&!s?t.envRot.setEmpty():s&&!e&&t.envAabb.setEmpty()}};function ji(r){return r.x-r.y}function Zi(r){return r.x+r.y}var $=class r{constructor(){this.x=H.getNAN(),this.y=H.getNAN()}static getNAN(){return new r}static constructPoint2D(t){let e=new r;return e.x.set(t.x),e.y.set(t.y),e}static constructCoords(t,e){let s=new r;return s.x.set(t),s.y.set(e),s}static constructCoordsE(t,e){let s=new r;return s.setCoordsE(t,e),s}get 0(){return this.x.clone()}set 0(t){this.x.setE(t)}get 1(){return this.y.clone()}set 1(t){this.y.setE(t)}clone(){return new r().setE(this)}scaleThis(t){return this.x.mulThisE(t),this.y.mulThisE(t),this}setCoords(t,e){return this.x.set(t),this.y.set(e),this}setCoordsE(t,e){return this.x.setE(t),this.y.setE(e),this}set(t){return this.x.set(t.x),this.y.set(t.y),this}setE(t){return this.x.setE(t.x),this.y.setE(t.y),this}setWithEps(t,e){return this.x.setWithEps(t.x,e),this.y.setWithEps(t.y,e),this}getUnitVector(){let t=this.clone();return t.normalize(),t}sqrLength(){return this.x.sqr().addE(this.y.sqr())}length(){return this.sqrLength().sqrt()}mulE(t){let e=new r;return e.setCoordsE(this.x.mulE(t),this.y.mulE(t)),e}mul(t){let e=new r;return e.setCoordsE(this.x.mul(t),this.y.mul(t)),e}mulThis(t){return this.x.mulThis(t),this.y.mulThis(t),this}mulThisE(t){return this.x.mulThisE(t),this.y.mulThisE(t),this}divE(t){return this.clone().divThisE(t)}divThisE(t){return this.x.divThisE(t),this.y.divThisE(t),this}normalize(){let t=this.length();t.value()===0?(this.x=Kn.clone(),this.y=on.clone()):(this.x.divThisE(t),this.y.divThisE(t))}addE(t){return this.clone().addThisE(t)}addThisE(t){return this.x.addThisE(t.x),this.y.addThisE(t.y),this}subE(t){return this.clone().subThisE(t)}subThisE(t){return this.x.subThisE(t.x),this.y.subThisE(t.y),this}static distance(t,e){return t.subE(e).length()}negateThis(){return this.x.negateThis(),this.y.negateThis(),this}eq(t){return this.x.eq(t.x)&&this.y.eq(t.y)}isZero(){return this.x.isZero()&&this.y.isZero()}isTrueZero(){return!this.x.value()&&!this.y.value()}rotateDirect(t,e){let s=this.x.mulE(t).subThisE(this.y.mulE(e)),n=this.x.mulE(e).addThisE(this.y.mulE(t));return this.x.setE(s),this.y.setE(n),this}rotateReverse(t,e){let s=this.x.mulE(t).addThisE(this.y.mulE(e)),n=this.x.negate().mulThisE(e).addThisE(this.y.mulE(t));return this.x.setE(s),this.y.setE(n),this}dotProduct(t){return this.x.mulE(t.x).addE(this.y.mulE(t.y))}crossProduct(t){return this.x.mulE(t.y).subE(this.y.mulE(t.x))}value(){return y.construct(this.x.value(),this.y.value())}},rr=class r{constructor(){this.a11=new H(1),this.a12=new H(0),this.a21=new H(0),this.a22=new H(1)}clone(){let t=new r;return t.a11.setE(this.a11),t.a12.setE(this.a12),t.a21.setE(this.a21),t.a22.setE(this.a22),t}assign(t){return this.a11.setE(t.a11),this.a12.setE(t.a12),this.a21.setE(t.a21),this.a22.setE(t.a22),this}mulThis(t){let e=this.a11.mulE(t.a11).addThisE(this.a12.mulE(t.a21)),s=this.a11.mulE(t.a12).addThisE(this.a12.mulE(t.a22)),n=this.a21.mulE(t.a11).addThisE(this.a22.mulE(t.a21)),i=this.a21.mulE(t.a12).addThisE(this.a22.mulE(t.a22));return this.a11=e,this.a12=s,this.a21=n,this.a22=i,this}mulLeftThis(t){let e=t.clone();return this.assign(e.mulThis(this)),this}det(){return this.a11.mulE(this.a22).subThisE(this.a12.mulE(this.a21))}invertThis(){let t=this.det();if(t.value()!==0){let e=this.a22.divE(t),s=this.a12.negate().divThisE(t),n=this.a21.negate().divThisE(t),i=this.a11.divE(t);this.a11=e,this.a12=s,this.a21=n,this.a22=i}else this.setZero();return!t.isZero()}transposeThis(){return this.a21=O(this.a12,this.a12=this.a21),this}eigenSymmetric(t,e){let s=this.a12.clone();s.addThisE(this.a21),s.mulThisByPower2(.5);let n=new H(1),i=new H(0);if(s.isZero())t[0].setE(this.a11),t[1].setE(this.a22);else{let o=new H(1);if(this.a11.ne(this.a22)){let a=this.a11.subE(this.a22).divE(s);a.mulThisByPower2(.5);let h=a.sqr();o.setE(a),o.absThis(),o.subThisE(h.add(1).sqrtThis()),a.gt(on)&&o.negateThis();let m=o.sqr().addThis(1).sqrtThis().invThis();i=o.mulE(m),n.setE(m);let l=o.mulE(s);t[0]=this.a11.addE(l),t[1]=this.a22.subE(l)}else n=new H(1/Math.sqrt(2)),i=n.clone(),t[0]=this.a11.addE(s),t[1]=this.a22.subE(s)}e[0].x=n.toDouble(),e[0].y=i.toDouble(),e[1].x=i.negate().toDouble(),e[1].y=n.toDouble(),Math.abs(t[0].toDouble())>Math.abs(t[1].toDouble())&&(t[1]=O(t[0],t[0]=t[1]),e[1]=O(e[0],e[0]=e[1]))}setZero(){this.a11.set(0),this.a21.set(0),this.a12.set(0),this.a22.set(0)}},pn=Ft;function Ze(r,t){let e=r.getStartXY();if(e.equals(t.getStartXY())||e.equals(t.getEndXY()))return!0;let s=r.getEndXY();return!!s.equals(t.getStartXY())||!!s.equals(t.getEndXY())}function Fo(r,t){let e=r.calculateLowerLength2D();return!(e>t)&&(!!r.isLine()||(e=r.calculateUpperLength2D(),e<=t||t!==0&&r.calculateLength2D()<=t))}function am(r,t){let e=r.getEndXY().sub(r.getStartXY()).length(),s=r.calculateUpperLength2D()-e<=t[0];return t[0]*=.1,s}function Zc(r,t,e,s,n,i,o,a){let h=r.calculateUpperLength2D(),m=t.calculateUpperLength2D(),l=r,u=t,c=!1;h>m&&(u=O(l,l=u),s=O(e,e=s),m=O(h,h=m),c=!0);let g=e===0;{o[0]=g?1:0;let S=l.getCoord2D(o[0]);a[0]=u.getClosestCoordinate(S,!1);let I=u.getCoord2D(a[0]);if(y.distance(S,I)<=n){let D=[.5,.75,.25,.1,.9],b=!0;for(let T=0;T<D.length;T++)if(S.assign(l.getCoord2D(D[T])),!u.isCloserThanDistance(S,new B(0,1),n)){b=!1;break}if(b)return c&&(a[0]=O(o[0],o[0]=a[0])),1}}if(h<=3*n)return 0;let d=Tt(Math.max(n/h,.1),0,.5),_=.01*n,p=0,f=0,x=d,C=-1,P=0,E=1/32;for(let S=0;;S++){w(S<4095);let I=g?d:1-d,D=l.getCoord2D(I),b=u.getClosestCoordinate(D,!1);if(b===s)return P;let T=u.getCoord2D(b),A=y.distance(D,T);if(S===0&&(C=A),A<=_?(E=.5,f=A,p=d):(x=d,C=A),Math.abs(f-C)>.1*_&&x-p>1e-16)d=pt(p,x,E);else{if(o[P]=I,a[P]=b,c&&(a[P]=O(o[P],o[P]=a[P])),i===1||P===1)return P===1&&o[0]>o[1]&&(o[1]=O(o[0],o[0]=o[1]),a[1]=O(a[0],a[0]=a[1])),P+1;P++,p=x,f=C,x=.8,C=-1,d=.8,E=1/32,_=10*n,S=0}}}function tr(r,t,e,s,n,i,o,a,h){if(bt(e,0,1)&&bt(s,0,1)&&y.distance(r.getCoord2D(e),t.getCoord2D(s))===0){let l=new $,u=kt();if(r.queryDerivative(new H(e,u),l),l.isTrueZero()){let p=e===1?-1e-12:1e-12;r.queryDerivative(new H(e,u).add(p),l)}e===1&&l.negateThis();let c=new $;if(t.queryDerivative(new H(s,u),c),c.isTrueZero()){let p=e===1?-1e-12:1e-12;t.queryDerivative(new H(s,u).add(p),c)}s===1&&c.negateThis(),l.isZero()||l.normalize(),c.isZero()||c.normalize();let g=l.dotProduct(c),d=l.crossProduct(c);d.scaleError(3);let _=()=>{{let p=r.calculateUpperLength2D(),f=t.calculateUpperLength2D();return Math.min(.01*n/Math.min(p,f),1e-10)}};if(g.ge(on)&&(d.isZero()||Math.abs(d.value())<_()))return Zc(r,t,e,s,n,i,o,a)}return 0}function cp(r,t,e){return w(r.isCurve()||t.isCurve()),!!(r.getStartXY().equals(t.getStartXY())&&tr(r,t,0,0,e,2,[0,0],[0,0])||r.getEndXY().equals(t.getEndXY())&&tr(r,t,1,1,e,2,[0,0],[0,0])||r.getStartXY().equals(t.getEndXY())&&tr(r,t,0,1,e,2,[0,0],[0,0])||r.getEndXY().equals(t.getStartXY())&&tr(r,t,1,0,e,2,[0,0],[0,0]))}function hm(r,t){r.m_XStart=t.x,r.m_YStart=t.y}function zu(r,t,e){r.m_XStart=t,r.m_YStart=e}function mm(r,t){r.m_XEnd=t.x,r.m_YEnd=t.y}function Ou(r,t,e){r.m_XEnd=t,r.m_YEnd=e}function gp(r,t,e){t?r.m_XEnd===e.x&&r.m_YEnd===e.y||(r.m_XEnd=e.x,r.m_YEnd=e.y,r.endPointModified()):r.m_XStart===e.x&&r.m_YStart===e.y||(r.m_XStart=e.x,r.m_YStart=e.y,r.endPointModified())}function Wu(r,t){let e=new ot;return t?(e.x=r.m_XEnd,e.y=r.m_YEnd):(e.x=r.m_XStart,e.y=r.m_YStart),e.z=dp(r,t),e}function dp(r,t){return r.m_description.hasZ()?r.m_attributes[t*(r.m_description.getTotalComponentCount()-2)]:pn.getDefaultValue(1)}function oo(r,t,e){r.m_description.hasZ()||r.addAttribute(1),t?r.m_XEnd===e.x&&r.m_YEnd===e.y||(r.m_XEnd=e.x,r.m_YEnd=e.y,r.endPointModified()):r.m_XStart===e.x&&r.m_YStart===e.y||(r.m_XStart=e.x,r.m_YStart=e.y,r.endPointModified()),r.m_attributes[(r.m_description.getTotalComponentCount()-2)*t]=e.z}function ju(r,t,e){e.assignVertexDescription(r.m_description);let s=t===0?r.m_XStart:r.m_XEnd,n=t===0?r.m_YStart:r.m_YEnd;e.setXYCoords(s,n);for(let i=1;i<r.m_description.getAttributeCount();i++){let o=r.m_description.getSemantics(i);for(let a=0,h=pn.getComponentCount(o);a<h;a++){let m=Ds(r,t,o,a);e.setAttributeBasic(o,a,m)}}}function Zu(r,t,e){e.isEmpty()&&Gi(""),gp(r,t,e.getXY());let s=e.getDescription();s!==r.m_description&&r.mergeVertexDescription(s);for(let n=1,i=s.getAttributeCount();n<i;n++){let o=s.getSemantics(n),a=pn.getComponentCount(o);for(let h=0;h<a;h++)Ks(r,t,o,h,e.getAttributeAsDbl(o,h))}}function Ds(r,t,e,s){if((t<0||t>1)&&xt(""),e===0)return(s<0||s>=2)&&xt(""),t===0?s===0?r.m_XStart:r.m_YStart:s===0?r.m_XEnd:r.m_YEnd;let n=pn.getComponentCount(e);(s<0||s>=n)&&xt("");let i=r.m_description.getAttributeIndex(e);return i>=0?r.m_attributes[t*(r.m_description.getTotalComponentCount()-2)+r.m_description.getPointAttributeOffset(i)-2+s]:pn.getDefaultValue(e)}function Ks(r,t,e,s,n){if((t<0||t>1)&&xt(""),e===0)return t===0?s===0?r.m_XStart=n:s===1?r.m_YStart=n:xt(""):t===1?s===0?r.m_XEnd=n:s===1?r.m_YEnd=n:xt(""):xt(""),void r.endPointModified();let i=pn.getComponentCount(e);(s<0||s>=i)&&xt("");let o=r.m_description.getAttributeIndex(e);o<0&&(r.addAttribute(e),o=r.m_description.getAttributeIndex(e)),r.m_attributes[t*(r.m_description.getTotalComponentCount()-2)+r.m_description.getPointAttributeOffset(o)-2+s]=n}function Qc(r,t){if(r===t)return;t.isEmpty()&&Gi("");let e=t.getDescription();e!==r.m_description&&r.mergeVertexDescription(e);for(let s=1,n=e.getAttributeCount();s<n;s++){let i=e.getSemantics(s),o=pn.getComponentCount(i);for(let a=0;a<o;a++){let h=Ds(t,0,i,a);Ks(r,0,i,a,h),h=Ds(t,1,i,a),Ks(r,1,i,a,h)}}}function _p(r,t){let e=sh();nh(t,r.m_description,e);let s=null,n=t.getTotalComponentCount()-2,i=r.m_description?r.m_description.getTotalComponentCount()-2:0;if(n>0&&(s=Z(2*n,Number.NaN),ye(s,t.getDefaultPointAttributes(),0,2,n),ye(s,t.getDefaultPointAttributes(),n,2,n),r.m_description!==null))for(let o=1;o<t.getAttributeCount();o++){let a=e[o];if(a!==-1){let h=r.m_description.getPointAttributeOffset(a)-2,m=t.getPointAttributeOffset(o)-2,l=pn.getComponentCount(t.getSemantics(o));for(let u=0;u<l;++u)s[m]=r.m_attributes[h],s[n+m]=r.m_attributes[i+h]}}r.m_attributes=s,r.m_description=t}function Ts(r){return r.absNorm()*to()}function Fe(r,t){return Math.max(r.absNorm(),t.absNorm())*to()}function Qe(r,t,e){let s=new me;r.queryEnvelopeW(B.unit(),s);let n=new me;return t.queryEnvelopeW(B.unit(),n),n.inflate(e),!s.isIntersectingW(n)}function lm(r,t,e){let s=Vi(r,e),n=Vi(t,e);s.sort((i,o)=>i.compare(o)),n.sort((i,o)=>i.compare(o));for(let i=0;i<3;i++){if(s[i].compare(n[i])<0)return-1;if(s[i].compare(n[i])!==0)return 1}return 0}var ni=Ft,br=(()=>{class r{constructor(e){if(e.copy)this.m_XStart=e.copy.m_XStart,this.m_YStart=e.copy.m_YStart,this.m_XEnd=e.copy.m_XEnd,this.m_YEnd=e.copy.m_YEnd,this.m_description=e.copy.m_description,this.m_attributes=null,this.m_description&&this.m_description.getTotalComponentCount()-2&&(this.m_attributes=e.copy.m_attributes.slice());else{if(e.move)return this.m_description=e.move.m_description,e.move.m_description=null,this.m_attributes=e.move.m_attributes,e.move.m_attributes=null,this.m_XStart=e.move.m_XStart,this.m_YStart=e.move.m_YStart,this.m_XEnd=e.move.m_XEnd,void(this.m_YEnd=e.move.m_YEnd);if(e.XStart!==void 0)return this.m_XStart=e.XStart,this.m_YStart=e.YStart,this.m_XEnd=e.XEnd,this.m_YEnd=e.YEnd,this.m_attributes=null,this.m_description=e.vd?e.vd:xs(),void(e.vd&&this.setDefaultAttributeValues());if(e.ZStart!==void 0)return this.m_XStart=e.XStart,this.m_YStart=e.YStart,this.m_XEnd=e.XEnd,this.m_YEnd=e.YEnd,this.m_description=e.vd?e.vd:Li(),void(e.vd?(this.setDefaultAttributeValues(),this.addAttribute(1),this.m_attributes[0]=e.ZStart,this.m_attributes[this.m_description.getTotalComponentCount()-2]=e.ZEnd):this.m_attributes=[e.ZStart,e.ZEnd]);if(e.start)return this.m_XStart=e.start.x,this.m_YStart=e.start.y,this.m_XEnd=e.end.x,this.m_YEnd=e.end.y,this.m_attributes=null,void(this.m_description=xs());if(e.start3D)return this.m_XStart=e.start3D.x,this.m_YStart=e.start3D.y,this.m_XEnd=e.end3D.x,this.m_YEnd=e.end3D.y,this.m_description=e.vd?e.vd:Li(),void(e.vd?(this.setDefaultAttributeValues(),this.addAttribute(1),this.m_attributes[0]=e.start3D.z,this.m_attributes[this.m_description.getTotalComponentCount()-2]=e.end3D.z):this.m_attributes=[e.start3D.z,e.end3D.z]);j("bad constructor params"),this.m_XStart=this.m_YStart=this.m_XEnd=this.m_YEnd=Number.NaN}}setDefaultAttributeValues(){let e=this.m_description.getTotalComponentCount()-2;e>0&&(this.m_attributes===null&&(this.m_attributes=Z(2*e,Number.NaN)),ye(this.m_attributes,this.m_description.getDefaultPointAttributes(),0,2,e),ye(this.m_attributes,this.m_description.getDefaultPointAttributes(),e,2,e))}absNormXYZ(e){return ft("not implemented"),0}snapControlPoints3D(){return ft("not implemented"),!1}setCoordsForIntersector3D(e,s,n){ft("not implemented")}transformAttribute(e,s,n,i,o){ft("")}mergeVertexDescriptionImpl(e){let s=this.getDescription(),n=Hi(s,e);this.assignVertexDescription(n)}changeEndPoints(e,s){let n=e.getXY(),i=s.getXY();this.changeEndPoints2D(n,i);let o=e.getDescription();o!==this.getDescription()&&this.mergeVertexDescription(o),o=s.getDescription(),o!==this.getDescription()&&this.mergeVertexDescription(o);for(let a=1,h=o.getAttributeCount();a<h;a++){let m=o.getSemantics(a),l=ni.getComponentCount(m);for(let u=0;u<l;u++)Ks(this,0,m,u,e.getAttributeAsDbl(m,u)),Ks(this,1,m,u,s.getAttributeAsDbl(m,u))}}getStartXY(){return new y(this.m_XStart,this.m_YStart)}setStartXY(e){this.m_XStart=e.x,this.m_YStart=e.y,this.endPointModified()}setStartXYCoords(e,s){this.m_XStart=e,this.m_YStart=s,this.endPointModified()}getStartXYZ(){return Wu(this,0)}setStartXYZ(e){oo(this,0,e)}setStartXYZCoords(e,s,n){oo(this,0,ot.construct(e,s,n))}queryStart(e){ju(this,0,e)}setStart(e){Zu(this,0,e)}setStart2D(e){this.setStartXY(e)}getStartAttributeAsDbl(e,s){return Ds(this,0,e,s)}getStartAttributeAsInt(e,s){return w(0),0}setStartAttribute(e,s,n){Ks(this,0,e,s,n)}setStartAttributesFromPoint(e,s){let n=e.getDescription();for(let i=s&&n.hasZ()?2:1,o=n.getAttributeCount();i<o;++i){let a=n.getSemantics(i),h=ni.getComponentCount(a);for(let m=0;m<h;++m){let l=e.getAttributeAsDbl(a,m);this.setStartAttribute(a,m,l)}}}setEndAttributesFromPoint(e,s){let n=e.getDescription();for(let i=s&&n.hasZ()?2:1,o=n.getAttributeCount();i<o;++i){let a=n.getSemantics(i),h=ni.getComponentCount(a);for(let m=0;m<h;++m){let l=e.getAttributeAsDbl(a,m);this.setEndAttribute(a,m,l)}}}getStartX(){return this.m_XStart}getStartY(){return this.m_YStart}getStartZ(){return w(0),0}getEndX(){return this.m_XEnd}getEndY(){return this.m_YEnd}getEndZ(){return w(0),0}getEndXY(){return new y(this.m_XEnd,this.m_YEnd)}setEndXY(e){this.m_XEnd=e.x,this.m_YEnd=e.y,this.endPointModified()}setEndXYCoords(e,s){this.m_XEnd=e,this.m_YEnd=s,this.endPointModified()}getEndXYZ(){return Wu(this,1)}setEndXYZ(e){oo(this,1,e)}setEndXYZCoords(e,s,n){oo(this,1,ot.construct(e,s,n))}queryEnd(e){ju(this,1,e)}setEnd(e){Zu(this,1,e)}setEnd2D(e){this.setEndXY(e)}getEndAttributeAsDbl(e,s){return Ds(this,1,e,s)}getEndAttributeAsInt(e,s){return w(0),Math.trunc(0)}setEndAttribute(e,s,n){Ks(this,1,e,s,n)}getDimension(){return 1}copyTo(e){if(this===e)return;e.getGeometryType()!==this.getGeometryType()&&U("");let s=e;s.assignVertexDescription(this.m_description),s.m_attributes&&ye(s.m_attributes,this.m_attributes,0,0,2*(this.m_description.getTotalComponentCount()-2)),s.m_XStart=this.m_XStart,s.m_YStart=this.m_YStart,s.m_XEnd=this.m_XEnd,s.m_YEnd=this.m_YEnd,this.copyToImpl(s)}isEmpty(){return this.isEmptyImpl()}isClosed(){return this.m_XStart===this.m_XEnd&&this.m_YStart===this.m_YEnd}setEmpty(){}calculateArea2D(){return 0}queryInterval(e,s){let n=B.constructEmpty();return n.vmin=Ds(this,0,e,s),n.vmax=n.vmin,n.mergeNeCoordinate(Ds(this,1,e,s)),n}calculateLength3D(e){return w(0),0}getCoord3D(e){return w(0),{}}getCoord2D(e){let s=y.getNAN();return this.queryCoord2D(e,s),s}queryCoord3D(e,s){w(0)}getCoordZ(e){return w(0),0}queryCoord(e,s){s.assignVertexDescription(this.m_description),s.setXY(this.getCoord2D(e));for(let n=1,i=this.m_description.getAttributeCount();n<i;n++){let o=this.m_description.getSemantics(n),a=ni.getComponentCount(o);for(let h=0;h<a;h++){let m=this.getAttributeAsDbl(e,o,h);s.setAttributeBasic(o,h,m)}}}isCloserThanDistance(e,s,n){let i=V.constructEmpty();if(this.queryLooseEnvelopeOnInterval(s,i),i.distance(e)>n)return!1;let o=this.getClosestCoordinateOnInterval(e,s,n);return!Number.isNaN(o)&&y.distance(e,this.getCoord2D(o))<=n}isMonotoneQuickAndDirty(){return!1}isTrue3D(){return!1}getReversed(){let e=this.clone();return e.reverse(),e}reverse(){this.m_XEnd=O(this.m_XStart,this.m_XStart=this.m_XEnd),this.m_YEnd=O(this.m_YStart,this.m_YStart=this.m_YEnd),this.reverseImpl();for(let e=1,s=this.m_description.getAttributeCount();e<s;e++){let n=this.m_description.getSemantics(e);for(let i=0,o=ni.getComponentCount(n);i<o;i++){let a=Ds(this,0,n,i);Ks(this,0,n,i,Ds(this,1,n,i)),Ks(this,1,n,i,a)}}return this.afterCompletedModification(),this}isEmptyImpl(){return!1}isCircular(){return!1}distance(e,s,n,i){if(!s&&this.isIntersecting(e,0,!1)){if(n!==null||i!==null){let l=Z(9,Number.NaN),u=Z(9,Number.NaN),c=this.intersect(e,null,l,u,0);w(c<=9),c===0&&j(""),n!==null&&(n[0]=l[0]),i!==null&&(i[0]=u[0])}return 0}let o,a=Number.MAX_VALUE,h=-1,m=a;return o=this.getStartXY(),h=e.getClosestCoordinate(o,!1),o.subThis(e.getCoord2D(h)),m=o.length(),m<a&&(a=m,i!==null&&(i[0]=h),n!==null&&(n[0]=0)),o=this.getEndXY(),h=e.getClosestCoordinate(o,!1),o.subThis(e.getCoord2D(h)),m=o.length(),m<a&&(a=m,i!==null&&(i[0]=h),n!==null&&(n[0]=1)),o=e.getStartXY(),h=this.getClosestCoordinate(o,!1),o.subThis(this.getCoord2D(h)),m=o.length(),m<a&&(a=m,n!==null&&(n[0]=h),i!==null&&(i[0]=0)),o=e.getEndXY(),h=this.getClosestCoordinate(o,!1),o.subThis(this.getCoord2D(h)),m=o.length(),m<a&&(a=m,n!==null&&(n[0]=h),i!==null&&(i[0]=1)),a}calculateSubLengthFromStart(e){return this.tToLength(e)}calculateSubLength(e,s){return s===e?0:this.tToLength(s)-this.tToLength(e)}static recalculateParentT(e,s,n){return pt(e,s,n)}moveTo(e){let s=this.isClosed(),n=new ct;n.setShift(e.sub(this.getStartXY())),this.applyTransformation(n),s?this.changeEndPoints2D(e,e):this.changeEndPoints2D(e,this.getEndXY())}moveTo3D(e){w(0)}getDescription(){return this.m_description}assignVertexDescription(e){_p(this,e)}mergeVertexDescription(e){this.m_description!==e&&(this.m_description.hasAttributesFrom(e)||this.mergeVertexDescriptionImpl(e))}hasAttribute(e){return this.m_description.hasAttribute(e)}addAttribute(e){if(this.m_description.hasAttribute(e))return;let s=so(this.m_description,e);this.assignVertexDescription(s)}dropAttribute(e){if(!this.m_description.hasAttribute(e))return;let s=no(this.m_description,e);this.assignVertexDescription(s)}dropAllAttributes(){let e=xs();e!==this.m_description&&this.assignVertexDescription(e)}swap(e){if(this===e)return;e.getGeometryType()!==this.getGeometryType()&&U("wrong geometry type");let s=e;s.m_description=O(this.m_description,this.m_description=s.m_description),s.m_XStart=O(this.m_XStart,this.m_XStart=s.m_XStart),s.m_YStart=O(this.m_YStart,this.m_YStart=s.m_YStart),s.m_XEnd=O(this.m_XEnd,this.m_XEnd=s.m_XEnd),s.m_YEnd=O(this.m_YEnd,this.m_YEnd=s.m_YEnd),s.m_attributes=O(this.m_attributes,this.m_attributes=s.m_attributes),this.swapImpl(s)}equals(e,s){if(this.getGeometryType()!==e.getGeometryType())return!1;let n=s===void 0;n&&(s=0);let i=e;if(this===i)return!0;if(this.m_description!==i.m_description||Math.abs(this.m_XStart-i.m_XStart)>s||Math.abs(this.m_XEnd-i.m_XEnd)>s||Math.abs(this.m_YStart-i.m_YStart)>s||Math.abs(this.m_YEnd-i.m_YEnd)>s)return!1;for(let o=0,a=2*(this.m_description.getTotalComponentCount()-2);o<a;o++)if(!Cu(this.m_attributes[o],i.m_attributes[o],s))return!1;return n?this.equalsImpl(i):this.equalsImplTol(i,s)}getImpl(){return this}setAttributeBasic(e,s,n){if(this.addAttribute(e),e===0&&this.isCurve()){(s<0||s>1)&&U("");let i=new ct,o=s===0?n:0,a=s===1?n:0;i.setShiftCoords(o,a),s===0?i.xx=0:i.yy=0,this.applyTransformation(i)}else this.setStartAttribute(e,s,n),this.setEndAttribute(e,s,n)}replaceNaNs(e,s){if(this.addAttribute(e),this.isEmpty())return;let n=ni.getComponentCount(e);for(let i=0;i<n;i++){let o=this.getStartAttributeAsDbl(e,i);Number.isNaN(o)&&this.setStartAttribute(e,i,s);let a=this.getEndAttributeAsDbl(e,i);Number.isNaN(a)&&this.setEndAttribute(e,i,s)}}}return r.s_maxMonotonicPartParams=8,r})(),Ph=class extends ns{constructor(t,e){super(),this.m_index=-1,this.gc=t,this.dim=e}next(){for(;;){if(this.m_index>=this.gc.getGeometryCount()||(this.m_index++,this.m_index===this.gc.getGeometryCount()))return null;let t=this.gc.getGeometry(this.m_index);if(this.dim===-1||1<<t.getDimension()&this.dim)return t}return null}getGeometryID(){return this.m_index}tock(){return!0}getRank(){return 1}},Co=class r{constructor(t){this.m_geoms=[],this.m_description=xs(),t&&(t.vd?this.m_description=t.vd:t.copy?t.copy.copyTo(this):U("constructor argument not recognized"))}getGeometryCount(){return this.m_geoms.length}reserve(t){}addGeometry(t){if(t.getGeometryType()===N.enumGeometryCollection){let e=t;for(let s=0,n=e.getGeometryCount();s<n;s++)this.addGeometry(e.getGeometry(s))}else this.m_geoms.push(t.clone()),this.mergeVertexDescription(t.getDescription())}addCursor(t){for(let e=t.next();e!==null;e=t.next())this.addGeometry(e)}getGeometry(t){return(t<0||t>=this.m_geoms.length)&&U("Geometry_collection.get_geometry"),this.m_geoms[t]}modifiedElementIndex(t){this.mergeVertexDescription(this.getGeometry(t).getDescription())}modifiedElement(t){this.mergeVertexDescription(t.getDescription())}getGeometryType(){return N.enumGeometryCollection}getDimension(){let t=0;for(let e of this.m_geoms)t=Math.max(t,e.getDimension());return t}getDescription(){return this.m_description}assignVertexDescription(t){this.m_description!==t&&this.assignVertexDescriptionImpl(t)}assignVertexDescriptionImpl(t){for(let e of this.m_geoms)e.assignVertexDescription(t);this.m_description=t}mergeVertexDescription(t){this.m_description!==t&&(this.m_description.hasAttributesFrom(t)||this.mergeVertexDescriptionImpl(t))}hasAttribute(t){return this.m_description.hasAttribute(t)}addAttribute(t){if(this.m_description.hasAttribute(t))return;let e=so(this.m_description,t);this.assignVertexDescription(e)}dropAttribute(t){if(!this.m_description.hasAttribute(t))return;let e=no(this.m_description,t);this.assignVertexDescription(e)}dropAllAttributes(){let t=xs();t!==this.m_description&&this.assignVertexDescription(t)}queryInterval(t,e){let s=new B,n=new B;n.setEmpty();for(let i of this.m_geoms)s=i.queryInterval(t,e),n.merge(s);return n}queryEnvelope(t){if(t.m_EnvelopeType===4){let e=new Me;t.setEmpty(),t.assignVertexDescription(this.m_description);for(let s of this.m_geoms)s.queryEnvelope(e),t.merge(e)}else if(t.m_EnvelopeType===2){let e=new V;t.setEmpty();for(let s of this.m_geoms)s.queryEnvelope(e),t.mergeEnvelope2D(e)}ft("3d envelope case not implemented")}queryLooseEnvelope(t){if(t.m_EnvelopeType===2){let e=new V;t.setEmpty();for(let s of this.m_geoms)s.queryLooseEnvelope(e),t.mergeEnvelope2D(e)}ft("3d not impl")}isEmpty(){return this.m_geoms.length===0}setEmpty(){this.m_geoms.length=0}applyTransformation(t){if(t.m_TransformationType===1)for(let e of this.m_geoms)e.applyTransformation(t);ft("3d xform not impl")}transformAttribute(t,e,s,n,i){for(let o of this.m_geoms)o.transformAttribute(t,e,s,n,i)}createInstance(){return new r({vd:this.getDescription()})}copyTo(t){t.getGeometryType()!==N.enumGeometryCollection&&U("");let e=t;if(e!==this){e.m_geoms.length=0,e.assignVertexDescription(this.m_description);for(let s of this.m_geoms)e.m_geoms.push(s.clone())}}calculateArea2D(){let t=new oe(0);for(let e of this.m_geoms)t.pe(e.calculateArea2D());return t.getResult()}calculateLength2D(){let t=new oe(0);for(let e of this.m_geoms)t.pe(e.calculateLength2D());return t.getResult()}calculateLength3D(t){return w(0),0}getBoundary(){let t=this.createInstance(),e=t;for(let s of this.m_geoms){let n=s.getBoundary();n&&e.m_geoms.push(n)}return t}clone(){return new r({copy:this})}equals(t,e){if(t===this)return!0;if(t.getGeometryType()!==N.enumGeometryCollection)return!1;let s=t;if(this.m_description!==s.m_description||this.m_geoms.length!==s.m_geoms.length)return!1;for(let n=0;n<this.m_geoms.length;++n)if(!this.m_geoms[n].equals(s.m_geoms[n],e))return!1;return!0}swap(t){t.getGeometryType()!==N.enumGeometryCollection&&U("");let e=t;e!==this&&(this.m_geoms=O(e.m_geoms,e.m_geoms=this.m_geoms))}setAttributeBasic(t,e,s){for(let n of this.m_geoms)n.setAttributeBasic(t,e,s)}replaceNaNs(t,e){for(let s of this.m_geoms)s.replaceNaNs(t,e)}getImpl(){return this}mergeVertexDescriptionImpl(t){let e=this.getDescription(),s=Hi(e,t);this.assignVertexDescription(s)}};function Kc(r,t=-1){return new Ph(r,t)}Co.type=N.enumGeometryCollection;var qn=class extends br{constructor(t){super(t)}},Ch=class extends qn{isTrue3D(){return!0}constructor(t){super(t)}};function Re(r,t,e){um(t,r.getStartXY(),r.getEndXY(),e)}function um(r,t,e,s){qt(t,e,r,s)}function ao(r,t){return pt(r.m_XStart,r.m_XEnd,t)}function lh(r,t){return pt(r.m_YStart,r.m_YEnd,t)}function pp(r,t){let e=r.getStartZ(),s=r.getEndZ();return pt(e,s,t)}function fp(r,t,e){let s=$.constructPoint2D(r.getStartXY()),n=$.constructPoint2D(r.getEndXY());e.setCoordsE(n.x.subE(s.x),n.y.subE(s.y))}function $c(r,t,e){t.value()<=.5?ze(2,$.constructPoint2D(r.getStartXY()),$.constructPoint2D(r.getEndXY()),t,e):Oe(2,$.constructPoint2D(r.getStartXY()),$.constructPoint2D(r.getEndXY()),t,e)}function Qu(r,t,e){r.m_XStart=t.x,r.m_YStart=t.y,r.m_XEnd=e.x,r.m_YEnd=e.y,r.afterCompletedModification()}function xp(r,t){let e=r.getStartXYZ();e.z*=t;let s=r.getEndXYZ();return s.z*=t,e.norm(1)+s.norm(1)}function cm(r){if(r.m_YEnd<r.m_YStart||r.m_YEnd===r.m_YStart&&r.m_XEnd<r.m_XStart){r.m_XEnd=O(r.m_XStart,r.m_XStart=r.m_XEnd),r.m_YEnd=O(r.m_YStart,r.m_YStart=r.m_YEnd);for(let t=0,e=r.m_description.getTotalComponentCount()-2;t<e;t++)r.m_attributes[t+e]=O(r.m_attributes[t],r.m_attributes[t]=r.m_attributes[t+e])}}function Eh(r,t,e,s){let n=0;if((r.m_XStart===t.m_XStart&&r.m_YStart===t.m_YStart||r.m_XStart===t.m_XEnd&&r.m_YStart===t.m_YEnd)&&(n++,!s))return 1;if(r.m_XEnd===t.m_XStart&&r.m_YEnd===t.m_YStart||r.m_XEnd===t.m_XEnd&&r.m_YEnd===t.m_YEnd){if(n++,n===2)return 2;if(!s)return 1}return t.isIntersectingPoint(r.getStartXY(),e,!0)||t.isIntersectingPoint(r.getEndXY(),e,!0)||r.isIntersectingPoint(t.getStartXY(),e,!0)||r.isIntersectingPoint(t.getEndXY(),e,!0)?4:s&&n?0:Pp(r,t)?4:0}function Vo(r,t,e,s,n,i,o,a){s!==null&&Ka(s,2,Number.NaN),n!==null&&Ka(n,2,Number.NaN),e!==null&&fu(e,y,2);let h=yp(r,t,2,e,s,n,i,o,a);return s&&(s.length=h),n&&(n.length=h),e&&(e.length=h),h}function yp(r,t,e,s,n,i,o,a,h){let m=ri(r,t.getStartXY(),o,!1),l=ri(r,t.getEndXY(),o,!1),u=ri(t,r.getStartXY(),o,!1),c=ri(t,r.getEndXY(),o,!1),g=0,d=0;if(!Number.isNaN(m)){let p=!1;a&&bt(m,0,1)&&r.getCoord2D(m).isEqualPoint2D(t.getStartXY())&&(g++,p=!0),p||(n&&(n[d]=m),i&&(i[d]=0),s&&s[d].setCoords(t.m_XStart,t.m_YStart),d++)}if(!Number.isNaN(l)){let p=!1;a&&bt(l,0,1)&&r.getCoord2D(l).isEqualPoint2D(t.getEndXY())&&(g++,p=!0),p||(e>d&&(n&&(n[d]=l),i&&(i[d]=1),s&&s[d].setCoords(t.m_XEnd,t.m_YEnd)),d++)}if(d!==2&&!Number.isNaN(u)&&!(m===0&&u===0||l===0&&u===1)){let p=!1;a&&bt(u,0,1)&&t.getCoord2D(u).isEqualPoint2D(r.getStartXY())&&(g++,p=!0),p||(e>d&&(n&&(n[d]=0),i&&(i[d]=u),s&&s[d].setCoords(r.m_XStart,r.m_YStart)),d++)}if(d!==2&&!Number.isNaN(c)&&!(m===1&&c===0||l===1&&c===1)){let p=!1;a&&bt(c,0,1)&&t.getCoord2D(c).isEqualPoint2D(r.getEndXY())&&(g++,p=!0),p||(e>d&&(n&&(n[d]=1),i&&(i[d]=c),s&&s[d].setCoords(t.m_XEnd,t.m_YEnd)),d++)}if(d>0)return h&&(i=O(n,n=i)),d===2&&e>=2&&n&&n[0]>n[1]&&(n[1]=O(n[0],n[0]=n[1]),i&&(i[1]=O(i[0],i[0]=i[1])),s&&(s[1]=O(s[0],s[0]=s[1]))),d;if(g>0)return 0;let _=Cp(r,t,o);return Number.isNaN(_.x)?0:(s&&(s[0]=r.getCoord2D(_.x)),n&&(n[0]=_.x),i&&(i[0]=_.y),1)}function Pp(r,t){let e=ho(r,t.m_XStart,t.m_YStart),s=ho(r,t.m_XEnd,t.m_YEnd);if(e<0&&s<0||e>0&&s>0)return!1;let n=ho(t,r.m_XStart,r.m_YStart),i=ho(t,r.m_XEnd,r.m_YEnd);return n<0&&i<0||n>0&&i>0?!1:Sh(r)>Sh(t)?$u(r,t):$u(t,r)}function fE(r,t){let e={bIntersect:!1,t1:Number.NaN,t2:Number.NaN},s=r.m_XEnd-r.m_XStart,n=r.m_YEnd-r.m_YStart,i=t.m_XEnd-t.m_XStart,o=t.m_YEnd-t.m_YStart,a=i*n-s*o;if(a===0)return e;let h=t.m_XStart-r.m_XStart,m=t.m_YStart-r.m_YStart,l=i*m-h*o,u=s*m-h*n,c=1/a;return e.t1=l*c,e.t2=u*c,e.bIntersect=!0,e}function ri(r,t,e,s){let n=y.getNAN(),i=y.getNAN(),o=!1;r.m_YEnd<r.m_YStart||r.m_YEnd===r.m_YStart&&r.m_XEnd<r.m_XStart?(n.setCoords(r.m_XEnd,r.m_YEnd),i.setCoords(r.m_XStart,r.m_YStart),o=!0):(n.setCoords(r.m_XStart,r.m_YStart),i.setCoords(r.m_XEnd,r.m_YEnd));let a=o?1:0,h=o?0:1,m=y.getNAN();m.setSub(t,n);let l=m.length(),u=3*l*kt();if(l<=Math.max(e,u))return s&&l===0?Number.NaN:a;if(m.setSub(t,i),l=m.length(),u=3*l*kt(),l<=Math.max(e,u))return s&&l===0?Number.NaN:h;m.setCoords(i.x-n.x,i.y-n.y);let c=m.length();if(c>0){let g=1/c;m.scale(g);let d=y.getNAN();d.setSub(t,n);let _=d.dotProduct(m),p=8*d.dotProductAbs(m)*kt();m.leftPerpendicularThis();let f=d.dotProduct(m),x=8*d.dotProductAbs(m)*kt(),C=Math.max(e,p);if(_<-C||_>c+C)return Number.NaN;let P=Math.max(e,x);if(Math.abs(f)<=P){let E=_*g;E=Tt(E,0,1);let S=y.getNAN();if(um(E,n,i,S),y.distance(S,t)<=e){if(E<.5){if(y.distance(S,n)<=e&&y.distance(t,n)<=e)return a}else if(y.distance(S,i)<=e&&y.distance(t,i)<=e)return h;return o?1-E:E}}}return Number.NaN}function ho(r,t,e){let s=y.getNAN();s.setCoords(t,e),s.subThis(r.getStartXY());let n=y.getNAN();n.setSub(r.getEndXY(),r.getStartXY());let i=n.crossProduct(s),o=4*kt()*(Math.abs(n.x*s.y)+Math.abs(n.y*s.x));return i>o?-1:i<-o?1:0}function Ku(r,t,e,s){let n=s?r.m_XStart:r.m_XEnd,i=s?r.m_YStart:r.m_YEnd,o=y.getNAN();return o.x=t.getEndX()-n,o.y=t.getEndY()-i,e.dotProduct(o)>3*kt()*e.dotProductAbs(o)?(o.x=t.getStartX()-n,o.y=t.getStartY()-i,e.dotProduct(o)<=3*kt()*e.dotProductAbs(o)):!0}function $u(r,t){let e=y.getNAN();return e.x=r.m_XEnd-r.m_XStart,e.y=r.m_YEnd-r.m_YStart,!!Ku(r,t,e,!1)&&(e.negateThis(),!!Ku(r,t,e,!0))}function Sh(r){let t=r.m_XStart-r.m_XEnd,e=r.m_YStart-r.m_YEnd;return t*t+e*e}function Cp(r,t,e){let s=r.m_XEnd-r.m_XStart,n=r.m_YEnd-r.m_YStart,i=t.m_XEnd-t.m_XStart,o=t.m_YEnd-t.m_YStart,a=i*n-s*o;if(a===0)return y.getNAN();let h=4*kt()*(Math.abs(i*n)+Math.abs(s*o)),m=t.m_XStart-r.m_XStart,l=t.m_YStart-r.m_YStart,u=i*l-m*o,c=4*kt()*(Math.abs(i*l)+Math.abs(m*o)),g=u/a,d=Math.abs(a),_=(c*d+h*Math.abs(u))/(a*a)+kt()*Math.abs(g);if(g<-_||g>1+_)return y.getNAN();let p=s*l-m*n,f=p/a,x=(4*kt()*(Math.abs(s*l)+Math.abs(m*n))*d+h*Math.abs(p))/(a*a)+kt()*Math.abs(f);if(f<-x||f>1+x)return y.getNAN();let C=Tt(g,0,1),P=Tt(f,0,1),E=y.getNAN();Re(r,C,E);let S=y.getNAN();if(Re(t,P,S),!e||y.distance(E,S)>e){let I=y.getNAN();qt(E,S,.5,I),C=r.getClosestCoordinate(I,!1),P=t.getClosestCoordinate(I,!1);let D=y.getNAN();Re(r,C,D);let b=y.getNAN();Re(t,P,b),D.subThis(b);let T=D.length(),A=(r.absNorm()+t.absNorm())*to();if(T>Math.max(e,A))return y.getNAN()}return new y(C,P)}var nr=class{constructor(t){if(this.m_segFlagStream=null,this.m_xyStream=null,this.m_bCirculator=!1,this.m_currentSegmentIndex=-1,this.m_nextSegmentIndex=0,this.m_nextPathIndex=0,this.m_currentPathIndex=-1,this.m_parent=t.parent,this.m_buffer=new this.m_parent.m_segmentBufferCTor,this.m_description=t.parent.getDescription(),this.m_segmentCount=this.getSegmentCount(this.m_nextPathIndex),t.pointIndex!==void 0){(t.pointIndex<0||t.pointIndex>=t.parent.getPointCount())&&xt("");let e=t.parent.getPathIndexFromPointIndex(t.pointIndex);this.m_currentPathIndex=e,this.m_nextPathIndex=e+1,this.m_nextSegmentIndex=t.pointIndex-t.parent.getPathStart(e),this.m_segmentCount=this.getSegmentCount(this.m_currentPathIndex)}else if(t.pathIndex!==void 0){(t.pathIndex<0||t.pathIndex>=t.parent.getPathCount()||t.segmentIndex<0)&&xt("");let e=t.parent.isClosedPath(t.pathIndex)?0:1;t.segmentIndex>=t.parent.getPathSize(t.pathIndex)-e&&xt(""),this.m_nextSegmentIndex=t.segmentIndex,this.m_currentPathIndex=t.pathIndex,this.m_nextPathIndex=this.m_nextSegmentIndex+1,this.m_segmentCount=this.getSegmentCount(this.m_nextPathIndex)}this.prepare(),this.m_pathBegin=-1,this.m_bCurrentPathClosed=!1,this.m_bStripAttributes=!1,this.m_prevPathIndex=-1,this.m_prevSegmentIndex=-1,this.m_bNeedsUpdate=!1,this.m_currentPathIndex>-1&&(this.m_pathBegin=this.m_parent.getPathStart(this.m_currentPathIndex),this.m_bCurrentPathClosed=this.m_parent.isClosedPath(this.m_currentPathIndex))}stripAttributes(){this.m_bStripAttributes=!0}prepare(){this.m_bCirculator=!1,this.m_parent.isEmptyImpl()?(this.m_segFlagStream=null,this.m_xyStream=null):(this.m_segFlagStream=this.m_parent.getSegmentFlagsStreamRef(),this.m_xyStream=this.m_parent.getAttributeStreamRef(0))}nextPath(){return this.m_currentPathIndex=this.m_nextPathIndex,!(this.m_currentPathIndex>=this.m_parent.getPathCount())&&(this.m_currentSegmentIndex=-1,this.m_nextSegmentIndex=0,this.m_segmentCount=this.getSegmentCount(this.m_currentPathIndex),this.m_pathBegin=this.m_parent.getPathStart(this.m_currentPathIndex),this.m_bCurrentPathClosed=this.m_parent.isClosedPath(this.m_currentPathIndex),this.m_nextPathIndex++,!0)}previousPath(){return this.m_nextPathIndex!==0&&(this.m_nextPathIndex--,this.m_currentSegmentIndex=-1,this.m_nextSegmentIndex=0,this.m_segmentCount=this.getSegmentCount(this.m_nextPathIndex),this.m_currentPathIndex=this.m_nextPathIndex,this.m_pathBegin=this.m_parent.getPathStart(this.m_currentPathIndex),this.m_bCurrentPathClosed=this.m_parent.isClosedPath(this.m_currentPathIndex),this.resetToLastSegment(),!0)}getSegmentCount(t){return this.m_parent.isEmptyImpl()?0:this.m_parent.getSegmentCountPath(t)}resetToFirstPath(){this.m_currentSegmentIndex=-1,this.m_nextSegmentIndex=-1,this.m_segmentCount=-1,this.m_nextPathIndex=0,this.m_currentPathIndex=-1,this.m_pathBegin=-1,this.m_bCurrentPathClosed=!1}resetToLastPath(){this.m_nextPathIndex=this.m_parent.getPathCount(),this.m_currentPathIndex=-1,this.m_currentSegmentIndex=-1,this.m_nextSegmentIndex=-1,this.m_segmentCount=-1,this.m_pathBegin=-1}resetToPath(t){(t<0||t>this.m_parent.getPathCount())&&xt(""),this.m_nextPathIndex=t,this.m_currentPathIndex=-1,this.m_currentSegmentIndex=-1,this.m_nextSegmentIndex=-1,this.m_segmentCount=-1,this.m_pathBegin=-1,this.m_bCurrentPathClosed=!1}isLastPath(){return this.m_currentPathIndex===this.m_parent.getPathCount()-1}isFirstSegmentInPath(){return this.m_currentSegmentIndex===0}isLastSegmentInPath(){return this.m_currentSegmentIndex===this.m_segmentCount-1}resetToFirstSegment(){this.m_currentSegmentIndex=-1,this.m_nextSegmentIndex=0}resetToLastSegment(){this.m_nextSegmentIndex=this.m_segmentCount,this.m_currentSegmentIndex=-1}resetTo(t){this.m_parent!==t.m_parent&&re(""),this.m_currentSegmentIndex=t.m_currentSegmentIndex,this.m_nextSegmentIndex=t.m_nextSegmentIndex,this.m_currentPathIndex=t.m_currentPathIndex,this.m_nextPathIndex=t.m_nextPathIndex,this.m_segmentCount=t.m_segmentCount,this.m_bCirculator=t.m_bCirculator,this.m_pathBegin=t.m_pathBegin,this.m_bCurrentPathClosed=t.m_bCurrentPathClosed,this.m_bStripAttributes=t.m_bStripAttributes,this.m_description=t.m_description}resetToVertex(t,e){if(this.m_currentPathIndex>=0&&this.m_currentPathIndex<this.m_parent.getPathCount()){let n=this.getPathBegin();if(t>=n&&t<this.m_parent.getPathEnd(this.m_currentPathIndex))return this.m_currentSegmentIndex=-1,void(this.m_nextSegmentIndex=t-n)}let s;s=e>=0&&e<this.m_parent.getPathCount()&&t>=this.m_parent.getPathStart(e)&&t<this.m_parent.getPathEnd(e)?e:this.m_parent.getPathIndexFromPointIndex(t),this.m_nextPathIndex=s+1,this.m_currentPathIndex=s,this.m_currentSegmentIndex=-1,this.m_nextSegmentIndex=t-this.m_parent.getPathStart(s),this.m_segmentCount=this.getSegmentCount(s),this.m_pathBegin=this.m_parent.getPathStart(this.m_currentPathIndex),this.m_bCurrentPathClosed=this.m_parent.isClosedPath(this.m_currentPathIndex)}hasNextSegment(){return this.m_nextSegmentIndex<this.m_segmentCount}hasPreviousSegment(){return this.m_nextSegmentIndex>0}nextSegment(){return this.m_currentSegmentIndex!==this.m_nextSegmentIndex&&this.updateSegment(),this.m_bCirculator?this.m_nextSegmentIndex=(this.m_nextSegmentIndex+1)%this.m_segmentCount:(this.m_nextSegmentIndex===this.m_segmentCount&&xt("Segment_iterator_impl::next_segment"),this.m_nextSegmentIndex++),this.m_buffer.get()}previousSegment(){return this.m_bCirculator?this.m_nextSegmentIndex=(this.m_segmentCount+this.m_nextSegmentIndex-1)%this.m_segmentCount:(this.m_nextSegmentIndex===0&&xt(""),this.m_nextSegmentIndex--),this.m_nextSegmentIndex!==this.m_currentSegmentIndex&&this.updateSegment(),this.m_buffer.get()}nextCurve(){if(!this.m_parent.hasNonLinearSegments())return this.resetToLastSegment(),null;let t=0;for(;;){if(this.m_nextSegmentIndex===this.m_segmentCount||t===this.m_segmentCount)return null;let e=this.getPathBegin()+this.m_nextSegmentIndex;if((31&this.m_segFlagStream.read(e))!==1){this.updateSegment();break}this.m_bCirculator?this.m_nextSegmentIndex=(this.m_nextSegmentIndex+1)%this.m_segmentCount:this.m_nextSegmentIndex++,t++}return this.m_currentSegmentIndex!==this.m_nextSegmentIndex&&this.updateSegment(),this.m_bCirculator?this.m_nextSegmentIndex=(this.m_nextSegmentIndex+1)%this.m_segmentCount:(this.m_nextSegmentIndex===this.m_segmentCount&&xt(""),this.m_nextSegmentIndex++),this.m_buffer.get()}getPathBegin(){return this.m_pathBegin}getPathIndex(){return this.m_currentPathIndex}getStartPointIndex(){return this.getPathBegin()+this.m_currentSegmentIndex}getEndPointIndex(){return this.isClosingSegment()?this.getPathBegin():this.getStartPointIndex()+1}updateSegment(){(this.m_nextSegmentIndex<0||this.m_nextSegmentIndex>=this.m_segmentCount||this.m_currentPathIndex<0)&&xt(""),this.m_currentSegmentIndex=this.m_nextSegmentIndex,this.m_parent.getSegmentFromPath(this.m_currentPathIndex,this.m_currentSegmentIndex,this.m_buffer,this.m_bStripAttributes)}isClosingSegment(){return this.m_bCurrentPathClosed&&this.m_currentSegmentIndex===this.m_segmentCount-1}isCurve(){return this.m_segFlagStream!==null?(31&this.m_segFlagStream.read(this.m_currentSegmentIndex))!==1:!1}isPathClosed(){return this.m_bCurrentPathClosed}setCirculator(t){this.m_bCirculator=t}getImpl(){return this}},Eo=class r{constructor(t){this.m_rasterizedGeometry=null,this.m_quadTree=null,this.m_quadTreeForPaths=null,this.m_refCount=1,t&&t.copyTo(this)}getRasterizedGeometry(){return this.m_rasterizedGeometry}copyTo(t){t!==this&&(w(t.uniqueUse()),t.m_quadTree=this.m_quadTree,t.m_quadTreeForPaths=this.m_quadTreeForPaths,t.m_rasterizedGeometry=this.m_rasterizedGeometry)}clone(){let t=new r;return this.copyTo(t),t}uniqueUse(){return this.m_refCount===1}addRef(){++this.m_refCount}release(){--this.m_refCount==0&&(this.m_rasterizedGeometry=null,this.m_quadTree=null,this.m_quadTreeForPaths=null)}setRasterizedGeometry(t){w(this.uniqueUse())}setQuadTree(t){w(this.uniqueUse()),this.m_quadTree=t}setQuadTreeForPaths(t){w(this.uniqueUse()),this.m_quadTreeForPaths=t}getQuadTree(){return this.m_quadTree}getQuadTreeForPaths(){return this.m_quadTreeForPaths}};function wr(r){return!(r.isEmpty()||r.getGeometryType()!==N.enumPolyline&&r.getGeometryType()!==N.enumPolygon)&&!(r.getPointCount()<20)}function gm(r){return!(r.isEmpty()||r.getGeometryType()!==N.enumPolyline&&r.getGeometryType()!==N.enumPolygon)&&!(r.getPointCount()<20)}function Ep(r,t){return r.readPoint2D(t+4)}function uh(r){let t=r.getGeometryType();return t===N.enumEllipticArc?10:t===N.enumBezier?4:t===N.enumRationalBezier2?5:t===N.enumBezier2?2:void j("")}function Cs(r){let t=31&r;return t===4?10:t===2?4:t===8?5:t===16?2:0}function xn(r,t,e,s){let n=4*kt()*(Math.abs(t.vmin)+Math.abs(t.vmax)),i=kt();if(r.getMaxDerivative()===1){w(e>0);let l=tc(r,0,t,kt(),n);return s[0]=l.root,l.cRoots}let o,a=[],h=new B(t.vmin-n,t.vmax+n);a.push(new y(h.vmin,h.vmax));let m=0;for(let l=r.getMaxDerivative()-1;l>=0;l--){o=a,a=[];for(let u=0,c=o.length;u<c;u++){if(o[u][0]<o[u][1]){let g,d,_;if(l===r.getMaxDerivative()-1?{root:g,funcAtRoot:d,cRoots:_}=tc(r,l,B.construct(o[u][0],o[u][1]),i,.5*n):{root:g,funcAtRoot:d,cRoots:_}=bp(r,l,B.construct(o[u][0],o[u][1]),i,.5*n),_===1){if(l===0)m<e&&(o[u][0]<=t.vmin&&o[u][1]>=t.vmin&&g!==t.vmin&&r.getValue(0,t.vmin)===0&&(g=t.vmin),o[u][0]<=t.vmax&&o[u][1]>=t.vmax&&g!==t.vmax&&r.getValue(0,t.vmax)===0&&(g=t.vmax),s[m]=t.snapClip(g),m>0?s[m]-s[m-1]>n&&m++:m++);else{let p=y.getNAN();p[0]=o[u][0],p[1]=g,a.push(p);let f=y.getNAN();f[0]=g,f[1]=o[u][1],a.push(f)}continue}}a.push(o[u])}}return m}function Sp(r,t,e,s){let n=new H,i=or(new H(r),new H(t),e,n);return s[0]=n.value(),i}function Yn(r,t,e,s,n,i){let o=k(H,2),a=Le(new H(r),new H(t),new H(e),s,n,o);return i[0]=o[0].value(),i[1]=o[1].value(),a}function Jc(r,t,e,s,n,i,o){let a=k(H,3),h=So(new H(r),new H(t),new H(e),new H(s),n,i,a);return o[0]=a[0].value(),o[1]=a[1].value(),o[2]=a[2].value(),h}function Ju(r,t,e,s,n,i,o,a){return Ip(r,t,e,s,n,i,o,a)}function vp(r,t,e,s,n,i){return wp(r,t,e,s,n,i)}function Ip(r,t,e,s,n,i,o,a){let h=Z(e*e,Number.NaN);h.fill(0),ye(a,s,0,0,e);let m=Z(e,Number.NaN),l=Z(e,Number.NaN),u=Z(e,Number.NaN),c=r(a,e,t),g=100,d=0;for(d=0;d<g;d++){let _=c;for(let C=0;C<e;++C)l[C]=a[C];if(d%e==0){h.fill(0);for(let C=0;C<e;C++)h[C*e+C]=1}let p=0,f=0;for(let C=0;C<e;++C){for(let S=0;S<e;++S)m[S]=h[C*e+S];let P=c;c=ec(r,t,a,m,n,i,e);let E=P-c;E>p&&(f=C,p=E)}for(let C=0;C<e;C++)m[C]=a[C]-l[C],u[C]=a[C]+(a[C]-l[C]);let x=r(u,e,t);if(x<_&&2*(_-2*c+x)*Et(_-c-p)<Et(_-x)*p){c=ec(r,t,a,m,n,i,e);for(let C=0;C<e;++C)h[f*e+C]=h[(e-1)*e+C],h[(e-1)*e+C]=m[C]}if(_<=c)return r(a,e,t)}return c}function tc(r,t,e,s,n){let i={root:0,funcAtRoot:0,cRoots:0},o=e.vmin,a=e.vmax,h=0,m=Number.MAX_VALUE,l=r.getValue(t,o),u=r.getValue(t,a),c=0,g=0,d=0;if(l>=0&&u>=0||l<=0&&u<=0)return Math.abs(l)<Math.abs(u)?(i.funcAtRoot=l,i.root=o,i.cRoots=l===0?1:0,i):(i.funcAtRoot=u,i.root=a,i.cRoots=u===0?1:0,i);Math.abs(l)<Math.abs(u)&&(a=O(o,o=a),u=O(l,l=u)),h=o,c=l;let _=!0,p=0;for(;u!==0&&Math.abs(o-a)>s*Math.abs(a)+n;p++){let f=p>64;if(!f){g=l!==c&&u!==c?o*u*c/((l-u)*(l-c))+a*l*c/((u-l)*(u-c))+h*l*u/((c-l)*(c-u)):a-u*(a-o)/(u-l);let x=(3*o+a)/4;if(f=!(g>x&&g<a||g>a&&g<x),!f){let C=s*Math.abs(a)+n;if(_){let P=Math.abs(a-h);f=Math.abs(g-a)>=.5*P||P<C}else{let P=Math.abs(h-m);f=Math.abs(g-a)>=.5*P||P<C}}}if(f?(g=(o+a)/2,_=!0):_=!1,d=r.getValue(t,g),d===0)return i.root=g,i.funcAtRoot=d,i.cRoots=1,i;if(!f){let x=o-g,C=g-a;if(Math.abs(x)>10*Math.abs(C)){let P=a+3*C;for(let E=0;E<2;E++){let S=r.getValue(t,P);Mt(l)*Mt(S)>0?(o=P,l=S):P=pt(o,a,.75)}}else if(Math.abs(C)>10*Math.abs(x)){let P=o-3*x;for(let E=0;E<2;++E){let S=r.getValue(t,P);Mt(u)*Mt(S)>0?(a=P,u=S):P=pt(o,a,.25)}}}m=h,h=a,c=u,Mt(l)*Mt(d)<0?(a=g,u=d):(o=g,l=d),Math.abs(l)<Math.abs(u)&&(a=O(o,o=a),u=O(l,l=u)),p===128&&j("Root_finder iterations exceeded")}return i.root=a,i.funcAtRoot=u,i.cRoots=1,i}function bp(r,t,e,s,n){let i={root:0,funcAtRoot:0,cRoots:0},o=e.vmin,a=r.getValue(t,o),h=e.vmax,m=r.getValue(t,h);if(a>=0&&m>=0||a<=0&&m<=0)return Math.abs(a)<Math.abs(m)?(i.funcAtRoot=a,i.root=o,i.cRoots=a===0?1:0,i):(i.funcAtRoot=m,i.root=h,i.cRoots=m===0?1:0,i);m<0&&(m=O(a,a=m),h=O(o,o=h));let l=.5*(o+h),u=Math.abs(h-o),c=u,g=r.getValue(t,l),d=r.getValue(t+1,l),_=1,p=4,f=p,x=2,C=1,P=0,E=0,S=_,I=32,D=0;for(;++D<100;){let b;D>I||d===0||S===x&&P>1||S===_&&f<p?(S=_,C>1&&C--):(S=x,E>1&&Math.abs(2*g)>Math.abs(u*d)&&C++),u=c;let T=!1;if(S===_)do{if(E>2){let F=16*Math.abs(u);if(.5*Math.abs(o-h)>F){let M=Math.min(o,h),q=Math.max(o,h);if(l===M){b=l,l=M+F,c=l-b;break}if(l===q){b=l,l=q-F,c=l-b;break}}}c=.5*(h-o),b=l,l=o+c,T=o===l||h===l}while(!1);else for(;;){c=C*g/d,b=l,l-=c,T=l===b;let F=Math.min(o,h),M=Math.max(o,h);if(l<F){if(C>1){l=b,C--;continue}c=b-F,l=F}else if(l>M){if(C>1){l=b,C--;continue}c=b-M,l=M}break}if(T||Math.abs(c)<n){b!==l&&(g=r.getValue(t,l));break}g=r.getValue(t,l),d=r.getValue(t+1,l);let A=o,G=h;g<0?(a=g,o=l):(m=g,h=l),S===x&&(o===A&&h===G||E>1&&Math.abs(c)>=.5001*Math.abs(u))?P++:P=0,S===_?(f++,E=0):(f=0,E++)}return D===100&&j("Root_finder iterations exceeded"),i.root=l,i.funcAtRoot=g,i.cRoots=1,i}function ec(r,t,e,s,n,i,o){let a=s.slice(0,o),h=0;for(let f=0;f<o;f++)h+=s[f]*s[f];if(h=Math.sqrt(h),h>0)for(let f=0;f<o;f++)a[f]/=h;let m=Number.NEGATIVE_INFINITY,l=Number.POSITIVE_INFINITY;{let f=Z(o,0);for(let x=0;x<o;x++)f[x]=x;f.sort((x,C)=>{let P=Math.abs(a[x]),E=Math.abs(a[C]);return P<E?-1:P>E?1:0});for(let x=0;x<o;x++){let C=f[x];if(a[C]===0)continue;let P=(n[C]-e[C])/a[C],E=(i[C]-e[C])/a[C];E<P&&(E=O(P,P=E)),P>m&&(m=P),E<l&&(l=E)}}let u=0,c=(Math.abs(m)+Math.abs(l))*kt()*100,g=Z(o,Number.NaN),d=a.slice();function _(f,x){for(let C=0,P=o;C<P;C++)g[C]=e[C]+f*d[C];return r(g,o,t)}c>0&&(u=vp(_,null,m,0,l,c));let p=_(u);for(let f=0,x=o;f<x;f++)e[f]=Tt(g[f],n[f],i[f]);return p}function wp(r,t,e,s,n,i){let o=Ri(),a=s,h=r(a,t),m=e,l=n,u=r(m,t),c=r(l,t);h>u&&(h=u,a=m),h>c&&(h=c,a=l);let g=m,d=l,_=u,p=c;_>p&&(_=O(p,p=_),d=O(g,g=d));let f=a-g,x=g-d,C=.5*Math.min(i,l-m),P=2*C,E=100,S,I=0;for(S=0;S<E&&!(l-m<=P);++S){let D=m+.5*(l-m),b=I>0;if(!b&&Math.abs(x)<=C&&(b=!0,I=3),!b){let G=a-g,F=a-d,M=G*(h-p),q=F*(h-_),R=F*q-G*M;q=2*(q-M),q>0&&(R=-R),q=Math.abs(q),q===0||Math.abs(R)>=Math.abs(q*x/2)||R<=q*(m-a)||R>=q*(l-a)?(b=!0,I=3):(x=f,f=R/q)}b&&(x=a>=D?m-a:l-a,f=o*x,I--);let T=a+f;T<m+C?T=m+C:T>l-C&&(T=l-C);let A=r(T,t);A<h?(T>=a?(m=a,u=h):(l=a,c=h),d=g,g=a,a=T,p=_,_=h,h=A):(T<a?(m=T,u=A):(l=T,c=A),A<=_||g===a?(d=g,g=T,p=_,_=A):(A<=p||d===a||d===g)&&(d=T,p=A))}return a}function or(r,t,e,s){return r.isZero()?t.isZero()?-1:0:(s.setE(t.clone().negateThis().divThisE(r)),e.containsCoordinate(s.value())?1:0)}function Le(r,t,e,s,n,i){if(r.value()===0)return n?(i[0].set(1),s.containsCoordinate(i[0].value())?1:0):or(t,e,s,i[0]);if(n){let g=2;return i[0].set(1),i[1].setE(e).divThisE(r),i[1].eq(i[0])&&(i[1].set(1),g=1),s.containsCoordinate(i[1].value())||(g=1),s.containsCoordinate(i[0].value())||(g--,i[0].setE(i[1])),g===2&&i[0].value()>i[1].value()&&(i[1]=O(i[0],i[0]=i[1])),g}let o=t.clone().sqrThis().subThisE(r.clone().mulThisE(e).mulThisE(lu));if(o.lt(on))return 0;let a=new H(t.value()>=0?1:-1),h=o.clone().sqrtThis(),m=new H(-.5).mulThisE(t.clone().addThisE(a.clone().mulThisE(h))),l=0;i[0].setE(m.divE(r));let u=new H(i[0].value()),c=new H(r.value()).mulE(u).addE(new H(t.value()).mulE(u).addE(new H(e.value())));return c.isZero()||sc(i[0],r,t,e,i[0]),s.containsCoordinate(i[0].value())&&l++,h.value()!==0&&m.value()!==0&&(i[l].assign(e.divE(m)),u.set(i[l].value()),c.assign(new H(r.value()).mulE(u).addE(new H(t.value()).mulE(u).addE(new H(e.value())))),c.isZero()||sc(i[l],r,t,e,i[l]),s.containsCoordinate(i[l].value())&&l++,l===2&&i[0].value()>i[1].value()&&(i[1]=O(i[0],i[0]=i[1]))),l}function So(r,t,e,s,n,i,o){if(r.value()===0)return Le(t,e,s,n,i,o);if(i){let a=1;o[0].set(1);let h=o.slice(a),m=Le(r,t.addE(r),s.negate(),n,!1,h);if(m>0){a+=m;for(let u=1;u<a;u++)o[u].eq(Kn)&&(o[a-1]=O(o[u],o[u]=o[a-1]),a--)}let l=o.slice(0,a);l.sort((u,c)=>u.value()<c.value()?-1:u.value()>c.value()?1:0);for(let u=0;u<a;++u)o[u]=l[u];return a}return Tp(r,t,e,s,n,o)}function tg(r,t,e,s,n,i){return(i<t||t<0)&&U("nth_degree_real_roots"),Np(r,t,e,s,n)}function vh(r,t,e,s){return{coef0:r.clone(),coef1:t.clone(),coef2:e.clone(),coef3:s.clone(),calcF(n){return this.coef0.clone().mulThis(n).addThisE(this.coef1).mulThis(n).addThisE(this.coef2).mulThis(n).addThisE(this.coef3)},calcDF(n){return this.coef0.clone().mulThis(3).mulThis(n).addThisE(this.coef1.clone().mulThisByPower2(2)).mulThis(n).addThisE(this.coef2)},estimateError(n){let i=Math.abs(n),o=((this.coef0.eps()*i+this.coef1.eps())*i+this.coef2.eps())*i+this.coef3.eps()+this.calcF(n).eps(),a=this.coef0.clone().mulThis(n).mulThis(3).addThisE(this.coef1.clone().mulThis(2)).mulThis(n).addThisE(this.coef2);if(a.isZero()){let h=this.coef0.clone().mulThis(n).mulThis(6).addThisE(this.coef1.clone().mulThis(2));if(h.isZero()){let m=this.coef0.clone().mulThis(6);return Math.pow(6*o/Math.abs(m.value()),1/3)}return Math.sqrt(2*o/Math.abs(h.value()))}return o/Math.abs(a.value())}}}var Ih=class{updateCoefs(t){if(this.lastDeriv1===t)return this.curCoefs=this.derivCoefs1,void(this.lastUsed=1);if(this.lastDeriv2===t)return this.curCoefs=this.derivCoefs2,void(this.lastUsed=2);let e;this.lastUsed===1?(e=this.derivCoefs2,this.lastDeriv2=t,this.lastUsed=2):(e=this.derivCoefs1,this.lastDeriv1=t,this.lastUsed=1),e.length=0;for(let s=0,n=this.truePower-t;s<=n;++s){e.push(this.coefs[s+t].clone());let i=s+t,o=i--;for(let a=1;a<t;a++)o*=i--;e[s].mulThis(o)}this.curCoefs=e}constructor(t,e,s,n){this.derivCoefs1=[],this.derivCoefs2=[],this.lastDeriv1=-1,this.lastDeriv2=-1,this.lastUsed=-1,this.curCoefs=null,this.coefs=t,this.power=e,this.truePower=0;for(let i=e;i>=1;i--)if(this.coefs[i].value()!==0){this.truePower=i;break}}getMaxDerivative(){return this.truePower+1}getValue(t,e){let s=this.coefs;t===0?s=this.coefs:(this.updateCoefs(t),s=this.curCoefs);let n=new oe(0),i=1;for(let o=0,a=this.truePower-t;o<=a;++o)n.pe(i*s[o].value()),i*=e;return n.getResult()}getError(t){let e=Math.abs(t),s=new oe(0),n=new H(1),i=new H(0);for(let a=0,h=this.power;a<=h;++a)i.addThisE(this.coefs[a].mulE(n)),s.pe(n.value()*this.coefs[a].eps()),n.mulThis(e);s.pe(i.eps());let o=1;for(let a=1;a<=this.truePower;++a){o*=a,this.updateCoefs(a);let h=new H(1),m=new H(0);for(let l=0,u=this.truePower-a;l<=u;++l)m.addThisE(this.curCoefs[l].mulE(h)),h.mulThis(t);if(!m.isZero())return Math.pow(o*s.getResult()/Math.abs(m.value()),1/a)}return 0}};function eg(r,t,e,s,n,i){let o=r,a=t,h=a-o;if(!i){let g=s.calcF(r).value(),d=s.calcF(t).value();if((g>0||g>d)&&(a=O(o,o=a),d=O(g,g=d)),g>=0||d<=0)return!1}let m,l=!1,u=e,c=0;for(;c<100;c++){let g=s.calcF(u);if(m=s.calcDF(u),m.isZero())return!1;if(!g.value()||c>3&&g.isZero()){l=!0;break}i||(g.value()<0?o=u:a=u);let d=g.value()/m.value(),_=u-d;i||(_>=o&&_<=a||_>=a&&_<=o)&&Math.abs(d)<=.5*h?(u=_,h=Math.abs(d)):(h=Math.abs(.5*(a-o)),u=.5*(o+a))}return!!l&&(n.set(u,s.estimateError(u)),!0)}function Dp(r,t,e,s,n,i,o,a){return eg(r,t,e.value(),vh(s,n,i,o),a,!1)}var bh=class{constructor(t,e,s){this.coefs=k(H,3),this.coefs[0].setE(t),this.coefs[1].setE(e),this.coefs[2].setE(s)}calcF(t){let e=new H(t);return this.coefs[0].mulE(e).addE(this.coefs[1]).mulE(e).addE(this.coefs[2])}calcDF(t){let e=new H(t);return H.st_mulByPower2(this.coefs[0],2).mulE(e).addE(this.coefs[1])}estimateError(t){let e=Math.abs(t),s=(this.coefs[0].eps()*e+this.coefs[1].eps())*e+this.coefs[2].eps()+this.calcF(t).eps(),n=new H(2).mulE(this.coefs[0]).mul(t).addE(this.coefs[1]);if(n.isZero()){let i=this.coefs[0].value();return Math.sqrt(s/Math.abs(i))}return s/Math.abs(n.value())}};function sc(r,t,e,s,n){return eg(0,0,r.value(),new bh(t,e,s),n,!0)}function Tp(r,t,e,s,n,i){let o=k(H,3),a=0,h=t.negate().divThisE(r.clone().mulThis(3));n.containsCoordinate(h.value())&&(o[0].setE(h),a=1);let m=k(H,2),l=Le(r.mul(3),t.mul(2),e,n,!1,m);if(l<0)return s.isZero()?-1:0;for(let _=0;_<l;_++)n.containsCoordinate(m[_].value())&&o[a++].setE(m[_]);os(o,0,a,(_,p)=>_.value()<p.value()?-1:_.value()>p.value()?1:0);let u=k(H,5);u[0].set(n.vmin);for(let _=0;_<a;_++)u[1+_].setE(o[_]);u[1+a].set(n.vmax);let c=a+2,g=1,d=0;{let _=u[0].clone();if(r.clone().mulThisE(_).addThisE(t).mulThisE(_).addThisE(e).mulThisE(_).addThisE(s).isZero()){let p=vh(r,t,e,s);_.setError(p.estimateError(_.value())),i[d]=_,d++,g++}}for(let _=g;_<c;_++){let p=u[_].clone(),f=r.clone().mulThisE(p).addThisE(t).mulThisE(p).addThisE(e).mulThisE(p).addThisE(s).isZero();if(f||!u[_].eq(u[_-1])){if(f||Dp(u[_-1].value(),u[_].value(),u[_-1].clone().addThisE(u[_]).divThisByPower2(2),r,t,e,s,p)){if(d>0&&p.eq(i[d-1]))continue;if(d>=3&&j("cubic_polynomial_solver_too_many_roots"),f){let x=vh(r,t,e,s);p.setError(x.estimateError(p.value()))}i[d]=p,d++}if(u[_].value()===n.vmax)break;f&&_++}}return d}function Np(r,t,e,s,n,i){let o=new Ih(r,t,e,kt()),a=0;if(o.truePower===2)a=Le(r[2],r[1],r[0],e,s,n);else if(o.truePower===1)a=or(r[1],r[0],e,n[0]);else{if(o.truePower===0)return r[0].value()?0:-1;{let h=[];h.length=t,a=xn(o,e,t,h);for(let m=0;m<a;m++)n[m].set(h[m])}}for(let h=0;h<a;h++)n[h].setError(o.getError(n[h].value()));return a}var mo=Ft,Ls=class r extends qn{constructor(t){t===void 0||qi(t,"vd")?(super({vd:t?.vd,XStart:0,YStart:0,XEnd:0,YEnd:0}),this.m_cp=new y(0,0)):t.from?(super(Tn({XStart:t.from.x,YStart:t.from.y,XEnd:t.to.x,YEnd:t.to.y},t.vd)),this.m_cp=t.cp.clone()):t.points?(super(Tn({XStart:t.points[0].x,YStart:t.points[0].y,XEnd:t.points[2].x,YEnd:t.points[2].y},t.vd)),this.m_cp=t.points[1].clone()):t.copy?(super(t),this.m_cp=t.copy.m_cp.clone()):j("unexpected constructor args")}getBoundary(){return Es(this)}assignCopy(t){return this!==t&&t.copyTo(this),this}construct(t,e,s){this.setStartXY(t),this.m_cp.assign(e),this.setEndXY(s),co(this)}constructPoints(t){this.setStartXY(t[0]),this.m_cp.assign(t[1]),this.setEndXY(t[2]),co(this)}getGeometryType(){return N.enumBezier2}queryEnvelope(t){if(t.m_EnvelopeType!==2)ft("env type not impl");else{if(t.setCoords(this.getStartXY()),t.mergeNe(this.getEndXY()),t.contains(this.m_cp))return;let e=yc(this);if(e!==null){let s=new y;for(let n of e.specialPoints)this.queryCoord2D(n,s),t.mergeNe(s)}else{let s=[];gg(this,s);let n=new y;for(let i of s)this.queryCoord2D(i,n),t.mergeNe(n)}}}applyTransformation(t){if(t.m_TransformationType===1){let e=k(y,3);return this.queryControlPoints(e),t.transformPoints2D(e,3,e),this.setStartXY(e[0]),this.m_cp.assign(e[1]),this.setEndXY(e[2]),void this.afterCompletedModification()}w(0)}createInstance(){return new r({vd:this.m_description})}calculateLength2D(){return wo(this,1,!1)}calculateLowerLength2D(){return y.distance(this.getStartXY(),this.getEndXY())}calculateUpperLength2D(){return this.calculateUpperLength2D_()}calculateUpperLength2D_(){return y.distance(this.getStartXY(),this.m_cp)+y.distance(this.getEndXY(),this.m_cp)}queryCoord2D(t,e){this.queryCoord2DExtended(t,e,!1)}queryCoord2DExtended(t,e,s){let n=k(y,3);this.queryControlPoints(n),He(n,t,e,s)}queryCoord2DE(t,e){D0(this,t,e)}getCoordX(t){if(t<0||t>1){let e=new y;return this.queryCoord2DExtended(t,e,!0),e.x}if(t<=.5){let e=ae(this.getStartX(),this.m_cp.x,t),s=ae(this.m_cp.x,this.getEndX(),t);return ae(e,s,t)}{let e=se(this.getStartX(),this.m_cp.x,t),s=se(this.m_cp.x,this.getEndX(),t);return se(e,s,t)}}getCoordY(t){if(t<0||t>1){let e=new y;return this.queryCoord2DExtended(t,e,!0),e.y}if(t<=.5){let e=ae(this.getStartX(),this.m_cp.x,t),s=ae(this.m_cp.x,this.getEndX(),t);return ae(e,s,t)}{let e=se(this.getStartY(),this.m_cp.y,t),s=se(this.m_cp.y,this.getEndY(),t);return se(e,s,t)}}cut(t,e,s){let n=new et;return this.queryCut(t,e,n,s),n.releaseSegment()}queryCut(t,e,s,n){let i=s.createQuadraticBezier();if(this.cutBezierIgnoreAttributes(t,e,i),n)return;i.assignVertexDescription(this.m_description);let o=this.m_description.getAttributeCount();if(o>1){for(let a=1;a<o;a++){let h=this.m_description.getSemantics(a),m=mo.getComponentCount(h);for(let l=0;l<m;l++){let u=this.getAttributeAsDbl(t,h,l);i.setStartAttribute(h,l,u)}}for(let a=1;a<o;a++){let h=this.m_description.getSemantics(a),m=mo.getComponentCount(h);for(let l=0;l<m;l++){let u=this.getAttributeAsDbl(e,h,l);i.setEndAttribute(h,l,u)}}}}queryDerivative(t,e){N0(this,t,e)}cutBezierIgnoreAttributes(t,e,s){if((t<0||e>1||t>e)&&U("Quadratic_bezier.cut_bezier_ignore_attributes"),t===0&&e===1)return s.setStartXY(this.getStartXY()),s.m_cp.assign(this.m_cp),void s.setEndXY(this.getEndXY());let n=k(y,3);this.queryControlPoints(n),_r(n,t,e,n),s.constructPoints(n)}splitBezierIgnoreAttributes(t,e,s){w(0)}getAttributeAsDbl(t,e,s){if(e===0)return s===0?this.getCoordX(t):this.getCoordY(t);let n=this.calculateLength2D(),i=n>0?this.tToLength(t)/n:0,o=mo.getInterpolation(e),a=this.getStartAttributeAsDbl(e,s),h=this.getEndAttributeAsDbl(e,s);return Jn(o,a,h,i,mo.getDefaultValue(e))}getClosestCoordinate(t,e){return Do(this,t,B.unit(),e)}getClosestCoordinateOnInterval(t,e,s=-1){return Do(this,t,e,!1)}getYMonotonicParts(t,e){return this.getMonotonicParts(t,e)}getMonotonicParts(t,e){t.length<2&&U("");let s=Bh(this),n=0;if(s.specialPointsCount()===2)return 0;w(t.length>=s.specialPointsCount()-1);for(let i=1,o=s.specialPointsCount();i<o;++i)this.queryCut(s.specialPoints[i-1],s.specialPoints[i],t[n],e),n++;for(let i=0;i<n;++i)To(t[i].get());return n}intersectionWithAxis2D(t,e,s,n){let i=k(H,3),o=k(H,2),a=new B(0,1),h=0;if(t){if(i[0]=new H(this.getStartY()).sub(e),i[1]=new H(this.m_cp.y).subE(new H(this.getStartY())).mulThisByPower2(2),i[2]=new H(this.getStartY()).add(this.getEndY()).subE(new H(this.m_cp.y).mulThisByPower2(2)),h=Le(i[2],i[1],i[0],a,!1,o),s)for(let m=0;m<h;m++)s[m]=this.getCoordX(o[m].value())}else if(i[0]=new H(this.getStartX()).sub(e),i[1]=new H(this.m_cp.x).subE(new H(this.getStartX())).mulThisByPower2(2),i[2]=new H(this.getStartX()).add(this.getEndX()).subE(new H(this.m_cp.x).mulThisByPower2(2)),h=Le(i[2],i[1],i[0],a,!1,o),s)for(let m=0;m<h;m++)s[m]=this.getCoordY(o[m].value());if(n)for(let m=0;m<h;m++)n[m]=o[m].value();else s&&Jr(s,h);return h}intersectionOfYMonotonicWithAxisX(t,e){if(this.m_YStart===this.m_YEnd)return t===this.m_YStart?e:Number.NaN;if(t===this.m_YStart)return this.m_XStart;if(t===this.m_YEnd)return this.m_XEnd;let s=[0,0],n=this.intersectionWithAxis2D(!0,t,s,null);return w(n!==2),n===-1?e:s[0]}isCurve(){return!0}isLine(){return!1}isDegenerate(t){return Fo(this,t)}isDegenerate3D(t,e){return w(0),!1}queryLooseEnvelope(t){if(t.m_EnvelopeType===2)return t.setCoords(this.getStartXY()),t.mergeNe(this.m_cp),void t.mergeNe(this.getEndXY());w(0)}clone(t){let e=this.createInstance();return this.copyTo(e),e}queryInterval(t,e){if(t===0){let s=new V;this.queryEnvelope(s);let n=new B;return e===0?s.queryIntervalX(n):s.queryIntervalY(n),n}return super.queryInterval(t,e)}queryLooseEnvelopeOnInterval(t,e){let s=k(y,4);this.queryControlPoints(s),_r(s,t.vmin,t.vmax,s),e.setFromPoints(s,4)}changeEndPoints2D(t,e){if(t.isEqual(this.m_XStart,this.m_YStart)&&e.isEqual(this.m_XEnd,this.m_YEnd))return;let s=this.m_cp.isEqual(this.m_XStart,this.m_YStart),n=this.m_cp.isEqual(this.m_XEnd,this.m_YEnd);this.setStartXY(t),this.setEndXY(e),s?this.m_cp.setCoordsPoint2D(t):n&&this.m_cp.setCoordsPoint2D(e),this.normalizeAfterEndpointChange()}tToLength(t){return wo(this,t,!0)}lengthToT(t){return f0(this,t)}calculateWeightedAreaCentroid2D(t){let e=k(y,3);I0(this,e);let s=e[2],n=e[1],i=new y,o=s.y*n.x-s.x*n.y;i.x=-(4*s.x+5*n.x)*o/60,i.y=-(4*s.y+5*n.y)*o/60;let a=xc(this);return i.x+=(e[0].x-t.x)*a,i.y+=(e[0].y-t.y)*a,i}calculateWeightedCentroid2D(){let t=new y;return this.isDegenerate(0)?(t.setCoords(0,0),t):x0(this)?(t.assign(this.getCoord2D(.5).mul(this.calculateLength2D())),t):(t.assign(C0(this,1)),t)}getControlPoint1(){return this.m_cp.clone()}setControlPoint1(t){this.m_cp.setCoordsPoint2D(t),this.afterCompletedModification()}queryControlPoints(t){t[0].assign(this.getStartXY()),t[1].assign(this.m_cp),t[2].assign(this.getEndXY())}setControlPoints(t){for(let e=0;e<3;e++)t[e].isNAN()&&U("NaN control points in bezier are not supported");this.m_XStart=t[0].x,this.m_YStart=t[0].y,this.m_cp.setCoordsPoint2D(t[1]),this.m_XEnd=t[2].x,this.m_YEnd=t[2].y,this.afterCompletedModification()}getTangent(t){let e=Tt(t,0,1),s=$i(this,1,e);return s.isZero()&&(s=$i(this,2,e),e===1&&s.negateThis()),s}getDerivative(t){return $i(this,1,Tt(t,0,1))}getCurvature(t){let e=$i(this,1,t),s=$i(this,2,t),n=e.sqrLength();return n===0?Number.NaN:(e.divThis(Math.sqrt(n)),e.crossProduct(s)/n)}isIntersecting(t,e,s){return Hn(!1,this,t,e,s)!==0}isIntersectingPoint(t,e,s){if(s&&(t.isEqualPoint2D(this.getStartXY())||t.isEqualPoint2D(this.getEndXY())))return!1;let n=new V;if(this.queryLooseEnvelope(n),n.inflateCoords(e,e),!n.contains(t))return!1;let i=this.getClosestCoordinate(t,!1),o=new y;return this.queryCoord2D(i,o),y.distance(o,t)<=e}isIntersectingPoint3D(t,e,s,n,i=1){return w(0),!1}isMonotoneQuickAndDirty(){return!1}getMonotonicPartParams(t,e){let s=Bh(this),n=s.specialPointsCount();if(!e)return s.specialPointsCount();t<n&&U("");for(let i=0;i<n;i++)e[i]=s.specialPoints[i];return n}normalizeAfterEndpointChange(){return!1}orientBottomUp(){if(this.m_YEnd<this.m_YStart||this.m_YEnd===this.m_YStart&&this.m_XEnd<this.m_XStart){O(this.m_XStart,this.m_XStart=this.m_XEnd),O(this.m_YStart,this.m_YStart=this.m_YEnd);for(let t=0,e=this.m_description.getTotalComponentCount()-2;t<e;t++)this.m_attributes[t+e]=O(this.m_attributes[t],this.m_attributes[t]=this.m_attributes[t+e]);this.m_cachedValues=null}}isDegenerateToLineHelper(t){let e=[t];if(!am(this,e))return!1;let s=this.getEndXY().sub(this.getStartXY()),n=s.length(),i=this.getControlPoint1();return i.sub(this.getStartXY()),!(Math.abs(i.crossProduct(s))/n>e[0])}copyIgnoreAttributes(t){let e=k(y,3);this.queryControlPoints(e),t.setControlPoints(e)}calculateArea2DHelper(){return xc(this)}absNorm(){return S0(this)}queryEnvelopeW(t,e){let s=k(y,3);this.queryControlPoints(s),dr(s,t,e)}setSegmentFromCoords(t,e){this.construct(t[0],this.getControlPoint1(),t[e-1])}snapControlPoints(t){return V0(this,t)}writeInBufferStream(t,e){let s=new Float64Array(2);return s[0]=this.m_cp.x,s[1]=this.m_cp.y,t.writeRangeFromArray(e,s.length,s,!0,1),e+s.length}readFromBufferStream(t,e){let s=new Float64Array(2);t.queryRange(e,s.length,s,!0,1),this.m_cp.x=s[0],this.m_cp.y=s[1],this.m_cachedValues=null}needsSnapControlPoints(t){return q0(this,t)}calculateSpecialPointsForCracking(t,e){return 0}ensureXYMonotone(){return To(this)}setCoordsForIntersector(t,e,s){E0(this,t,e,s)}copyToImpl(t){let e=t;e.m_cp.setCoordsPoint2D(this.m_cp),pg(e,yc(this))}reverseImpl(){}equalsImplTol(t,e){let s=t;return!!this.m_cp.isEqualPoint2D(s.m_cp,e)}equalsImpl(t){let e=t;return!!this.m_cp.equals(e.m_cp)}swapImpl(t){let e=t;e.m_cp=O(this.m_cp,this.m_cp=e.m_cp),_0(this,e)}afterCompletedModification(){co(this)}intersect(t,e,s,n,i){return Pn(!1,this,t,e,s,n,i)}intersectPoint(t,e,s){return y0(this,t,e.length,e,s)}endPointModified(){co(this)}clearEndPointModified(){}};Ls.type=N.enumBezier2;var lo=Ft,_e=class r extends qn{constructor(t){return t===void 0||qi(t,"vd")?(super({vd:t?.vd,XStart:0,YStart:0,XEnd:0,YEnd:0}),this.m_cp=new y(0,0),void(this.m_weights=[1,0,1])):(t.fromPoint&&t.weight?t={fromPoint:t.fromPoint,controlPoint1:t.controlPoint1,toPoint:t.toPoint,weight0:1,weight1:t.weight,weight2:1}:t.points&&t.weight?t={fromPoint:t.points[0],controlPoint1:t.points[1],toPoint:t.points[2],weight0:1,weight1:t.weight,weight2:1}:t.points&&t.weights&&(t={fromPoint:t.points[0],controlPoint1:t.points[1],toPoint:t.points[2],weight0:t.weights[0],weight1:t.weights[1],weight2:t.weights[2]}),t.fromPoint&&t.weight0?(super({start:t.fromPoint,end:t.toPoint}),(t.weight0<=0||t.weight1<0||t.weight2<=0)&&U("weights"),this.m_cp=t.controlPoint1.clone(),void(this.m_weights=[t.weight0,t.weight1,t.weight2])):t.copy?(super(t),this.m_cp=t.copy.m_cp.clone(),void(this.m_weights=t.copy.m_weights.slice())):t.move?(super(t),this.m_cp=t.move.m_cp.clone(),void(this.m_weights=t.move.m_weights.slice())):void ft("unexpected constructor param"))}getBoundary(){return Es(this)}assignMove(t){return this}assignCopy(t){return t.copyTo(this),this}construct(t,e,s,n){this.dropAllAttributes(),this.setCpsAndWeights(t,e,s,1,n,1),Ki(this)}constructWeights(t,e,s,n,i,o){this.dropAllAttributes(),this.setCpsAndWeights(t,e,s,n,i,o),Ki(this)}constructArray(t,e){this.construct(t[0],t[1],t[2],e)}constructArrayWeights(t,e){this.dropAllAttributes(),this.setCpsAndWeightsArray(t,e),Ki(this)}convertToStandardForm(){}getStandardFormWeight(){return this.m_weights[1]/Math.sqrt(this.m_weights[0]*this.m_weights[2])}getGeometryType(){return N.enumRationalBezier2}queryEnvelope(t){if(t instanceof V){if(t.setCoords(this.getStartXY()),t.mergeNe(this.getEndXY()),t.contains(this.m_cp))return;let e=uc(this);if(e!==null){let s=new y;for(let n of e.specialPoints)this.queryCoord2D(n,s),t.mergeNe(s)}else{let s=[],n=k(y,3);this.queryControlPoints(n),ag(n,this.m_weights,s);let i=new y;for(let o of s)this.queryCoord2D(o,i),t.mergeNe(i)}}}applyTransformation(t){if(t instanceof ct){let e=k(y,3);return this.queryControlPoints(e),t.transformPoints2D(e,3,e),this.setStartXY(e[0]),this.m_cp.assign(e[1]),this.setEndXY(e[2]),void this.afterCompletedModification()}}createInstance(){return new r({vd:this.m_description})}calculateLength2D(){return hr(this,1,!1)}calculateLowerLength2D(){return y.distance(this.getStartXY(),this.getEndXY())}calculateUpperLength2D(){return this.calculateUpperLength2D_()}calculateUpperLength2D_(){return this.m_weights[1]>0?y.distance(this.getStartXY(),this.m_cp)+y.distance(this.getEndXY(),this.m_cp):y.distance(this.getStartXY(),this.getEndXY())}queryCoord2D(t,e){return this.queryCoord2DExtension(t,e,!0)}queryCoord2DE(t,e){c0(this,t,e)}queryCoord2DExtension(t,e,s){if(s){if(t<0)return void Re(new nt({start:this.getStartXY(),end:this.getStartXY().add(this.getTangent(0).getUnitVector())}),t,e);if(t>1)return void Re(new nt({start:this.getEndXY(),end:this.getEndXY().add(this.getTangent(1).getUnitVector())}),t-1,e)}let n=k(y,3);this.queryControlPoints(n),Xt(n,this.m_weights,t,e)}getCoordX(t){let e=new y;return this.queryCoord2DExtension(t,e,!0),e.x}getCoordY(t){let e=new y;return this.queryCoord2DExtension(t,e,!0),e.y}cut(t,e,s){let n=new et;return this.queryCut(t,e,n,s),n.releaseSegment()}queryCut(t,e,s,n){let i=s.createQuadraticRationalBezier();if(this.cutBezierIgnoreAttributes(t,e,i),n)return;i.assignVertexDescription(this.m_description);let o=this.m_description.getAttributeCount();if(o>1){for(let a=1;a<o;a++){let h=this.m_description.getSemantics(a),m=lo.getComponentCount(h);for(let l=0;l<m;l++){let u=this.getAttributeAsDbl(t,h,l);i.setStartAttribute(h,l,u)}}for(let a=1;a<o;a++){let h=this.m_description.getSemantics(a),m=lo.getComponentCount(h);for(let l=0;l<m;l++){let u=this.getAttributeAsDbl(e,h,l);i.setEndAttribute(h,l,u)}}}}queryDerivative(t,e){Zp(this,t,e)}cutBezierIgnoreAttributes(t,e,s){(t<0||e>1||t>e)&&U("Quadratic_rational_bezier.cut_bezier_ignore_attributes");let n=k(y,3);this.queryControlPoints(n);let i=[0,0,0];$s(n,this.m_weights,t,e,n,i),s.setControlPointsAndWeights(n,i)}splitBezierIgnoreAttributes(t,e,s){}getAttributeAsDbl(t,e,s){if(e===0)return s===0?this.getCoordX(t):this.getCoordY(t);let n=this.calculateLength2D(),i=n>0?this.tToLength(t)/n:0,o=lo.getInterpolation(e),a=this.getStartAttributeAsDbl(e,s),h=this.getEndAttributeAsDbl(e,s);return Jn(o,a,h,i,lo.getDefaultValue(e))}getClosestCoordinate(t,e){return bo(this,t,B.unit(),e,-1)}getClosestCoordinateOnInterval(t,e,s=-1){return bo(this,t,e,!1,s)}getYMonotonicParts(t,e){return this.getMonotonicParts(t,e)}getMonotonicParts(t,e){t.length<2&&U("");let s=ar(this),n=0;if(s.specialPointsCount()===2)return 0;w(t.length>=s.specialPointsCount()-1);for(let i=1,o=s.specialPointsCount();i<o;++i)this.queryCut(s.specialPoints[i-1],s.specialPoints[i],t[n],e),n++;for(let i=0;i<n;++i)Gh(t[i].get());return n}intersectionWithAxis2D(t,e,s,n){s&&(s.length=9),n&&(n.length=9);let i=new Array(3),o=k(H,2),a=new B(0,1),h=0,m=k(y,3);if(this.queryControlPoints(m),t){if(i[0]=new H(m[0].y).sub(e).mul(this.m_weights[0]),i[1]=new H(m[1].y).sub(e).mul(this.m_weights[1]),i[2]=i[0].subE(i[1].mul(2)).addE(new H(m[2].y).sub(e).mul(this.m_weights[2])),i[1]=i[1].subE(i[0]).mulThisByPower2(2),h=Le(i[2],i[1],i[0],a,!1,o),s)for(let l=0;l<h;l++)s[l]=this.getCoordX(o[l].value())}else if(i[0]=new H(m[0].x).sub(e).mul(this.m_weights[0]),i[1]=new H(m[1].x).sub(e).mul(this.m_weights[1]),i[2]=i[0].subE(i[1].mul(2)).addE(new H(m[2].x).sub(e).mul(this.m_weights[2])),i[1]=i[1].subE(i[0]).mulThisByPower2(2),h=Le(i[2],i[1],i[0],a,!1,o),s)for(let l=0;l<h;l++)s[l]=this.getCoordY(o[l].value());if(n)for(let l=0;l<h;l++)n[l]=o[l].value();else s&&os(s,0,h,_s);return h}intersectionOfYMonotonicWithAxisX(t,e){if(this.m_YStart===this.m_YEnd)return t===this.m_YStart?e:Number.NaN;if(t===this.m_YStart)return this.m_XStart;if(t===this.m_YEnd)return this.m_XEnd;let s=[Number.NaN,Number.NaN],n=this.intersectionWithAxis2D(!0,t,s,null);return w(n!==2),n===-1?e:s[0]}isCurve(){return!0}isDegenerate(t){return Fo(this,t)}isDegenerate3D(t,e){return!1}queryLooseEnvelope(t){if(t instanceof V)return t.setCoords({pt:this.getStartXY()}),t.mergeNe(this.m_cp),void t.mergeNe(this.getEndXY())}clone(t){let e=this.createInstance();return this.copyTo(e),e}queryInterval(t,e){if(t===0){let s=V.constructEmpty();this.queryEnvelope(s);let n=B.constructEmpty();return e===0?s.queryIntervalX(n):s.queryIntervalY(n),n}return super.queryInterval(t,e)}queryLooseEnvelopeOnInterval(t,e){let s=k(y,3);this.queryControlPoints(s);let n=[0,0,0];$s(s,this.m_weights,t.vmin,t.vmax,s,n),e.setFromPoints(s,3)}changeEndPoints2D(t,e){if(t.isEqual(this.m_XStart,this.m_YStart)&&e.isEqual(this.m_XEnd,this.m_YEnd))return;let s=this.m_cp.isEqual(this.m_XStart,this.m_YStart),n=this.m_cp.isEqual(this.m_XEnd,this.m_YEnd);this.setStartXY(t),this.setEndXY(e),s?this.m_cp.setCoordsPoint2D(t):n&&this.m_cp.setCoordsPoint2D(e),this.normalizeAfterEndpointChange()}tToLength(t){return hr(this,t,!0)}lengthToT(t){return $p(this,t)}calculateWeightedAreaCentroid2D(t){let e=e0(this),s=lc(this);return e.x+=(this.getStartX()-t.x)*s,e.y+=(this.getStartY()-t.y)*s,e}calculateWeightedCentroid2D(){let t=new y;return this.isDegenerate(0)?(t.setCoords(0,0),t):n0(this)?(t.assign(this.getCoord2D(.5).mul(this.calculateLength2D())),t):(t.assign(o0(this,1)),t)}getControlPoint1(){return this.m_cp.clone()}setControlPoint1(t){this.m_cp.setCoordsPoint2D(t),this.afterCompletedModification()}queryWeights(t){for(let e=0;e<3;++e)t[e]=this.m_weights[e]}setWeights(t){}queryControlPoints(t){t[0].assign(this.getStartXY()),t[1].assign(this.m_cp),t[2].assign(this.getEndXY())}setControlPointsAndWeights(t,e){this.setCpsAndWeightsArray(t,e),this.afterCompletedModification()}getTangent(t){let e=k(y,3);return this.queryControlPoints(e),Mh(e,this.m_weights,t)}getDerivative(t){let e=Tt(t,0,1),s=k(y,4);return Io(this,1,e,s),s[1]}getCurvature(t){let e=k(y,4);Io(this,2,t,e);let s=e[1].sqrLength();return s===0?Number.NaN:(e[1].divThis(Math.sqrt(s)),e[1].crossProduct(e[2])/s)}isIntersecting(t,e,s){return!1}isIntersectingPoint(t,e,s){return!1}isIntersectingPoint3D(t,e,s,n,i=1){return!1}isMonotoneQuickAndDirty(){let t=k(y,3);return this.queryControlPoints(t),qo(t)}getMonotonicPartParams(t,e){let s=ar(this),n=s.specialPointsCount();if(!e)return s.specialPointsCount();t<n&&U("");for(let i=0;i<n;i++)e[i]=s.specialPoints[i];return n}normalizeAfterEndpointChange(){return!1}orientBottomUp(){if(this.m_YEnd<this.m_YStart||this.m_YEnd===this.m_YStart&&this.m_XEnd<this.m_XStart){this.m_XEnd=O(this.m_XStart,this.m_XStart=this.m_XEnd),this.m_YEnd=O(this.m_YStart,this.m_YStart=this.m_YEnd),this.m_weights[2]=O(this.m_weights[0],this.m_weights[0]=this.m_weights[2]);for(let t=0,e=this.m_description.getTotalComponentCount()-2;t<e;t++)this.m_attributes[t+e]=O(this.m_attributes[t],this.m_attributes[t]=this.m_attributes[t+e]);this.m_cachedValues=null}}isLine(){return!1}isDegenerateToLineHelper(t){let e=[t];return!!am(this,e)&&m0(this,e[0])}copyIgnoreAttributes(t){let e=k(y,3);this.queryControlPoints(e);let s=[0,0,0];this.queryWeights(s),t.setControlPointsAndWeights(e,s)}calculateArea2DHelper(){return lc(this)}absNorm(){return this.getStartXY().norm(1)+this.getEndXY().norm(1)+this.m_cp.norm(1)}absNormXYZ(t){return w(0),0}queryEnvelopeW(t,e){lg(this,t,e)}setSegmentFromCoords(t,e){let s=[0,0,0];this.queryWeights(s),this.constructWeights(t[0],this.getControlPoint1(),t[e-1],s[0],s[1],s[2])}writeInBufferStream(t,e){let s=new Float64Array(5);return s[0]=this.m_cp.x,s[1]=this.m_cp.y,s[2]=this.m_weights[0],s[3]=this.m_weights[1],s[4]=this.m_weights[2],t.writeRangeFromArray(e,s.length,s,!0,1),e+s.length}readFromBufferStream(t,e){let s=new Float64Array(5);t.queryRange(e,s.length,s,!0,1),this.m_cp.x=s[0],this.m_cp.y=s[1],this.m_weights[0]=s[2],this.m_weights[1]=s[3],this.m_weights[2]=s[4],this.m_cachedValues=null}snapControlPoints(t){let e=k(y,3);this.queryControlPoints(e);let s=y.sqrDistance(e[1],e[0]),n=y.sqrDistance(e[1],e[2]),i=e[0].clone(),o=s;s>n&&(i=e[2].clone(),o=n);let a=!1;return o<=t&&o!==0&&(a=!0,this.setControlPoint1(i)),a}needsSnapControlPoints(t){if(!t)return!1;let e=k(y,3);this.queryControlPoints(e);let s=y.sqrDistance(e[1],e[0]),n=y.sqrDistance(e[1],e[2]);e[0].clone();let i=s;return s>n&&(e[2].clone(),i=n),i<=t&&i!==0}calculateSpecialPointsForCracking(t,e){return 0}ensureXYMonotone(){return Gh(this)}setCoordsForIntersector(t,e,s){h0(this,t,e,s)}copyToImpl(t){let e=t;e.m_cp.setCoordsPoint2D(this.m_cp),e.m_weights[0]=this.m_weights[0],e.m_weights[1]=this.m_weights[1],e.m_weights[2]=this.m_weights[2],mg(e,uc(this))}reverseImpl(){this.m_weights[2]=O(this.m_weights[0],this.m_weights[0]=this.m_weights[2])}equalsImpl(t){let e=t;if(!this.m_cp.equals(e.m_cp))return!1;for(let s=0;s<3;s++)if(this.m_weights[s]!==e.m_weights[s])return!1;return!0}equalsImplTol(t,e){let s=t;if(!this.m_cp.isEqualPoint2D(s.m_cp,e))return!1;let n=k(y,3);this.queryControlPoints(n);let i=k(y,3);s.queryControlPoints(i);let o=[s.m_weights[0],s.m_weights[1],s.m_weights[2]];for(let a=0;a<3;a++){let h=new ot;h.setCoordsPoint2DZ(n[a].mul(this.m_weights[a]),this.m_weights[a]);let m=new ot;if(m.setCoordsPoint2DZ(i[a].mul(o[a]),o[a]),!h.isEqual(m,e))return!1}return!0}swapImpl(t){let e=t;e.m_cp=O(this.m_cp,this.m_cp=e.m_cp),e.m_weights=O(this.m_weights,this.m_weights=e.m_weights),Up(this,e)}afterCompletedModification(){Ki(this)}intersect(t,e,s,n,i){return Pn(!1,this,t,e,s,n,i)}intersectPoint(t,e,s){return r0(this,t,e,s)}endPointModified(){Ki(this)}clearEndPointModified(){}setCpsAndWeights(t,e,s,n,i,o){(n<=0||o<=0||i<0)&&U("weights"),(t.isNAN()||e.isNAN()||s.isNAN())&&U("NAN control points in bezier are not supported"),this.setStartXY(t),this.m_cp.assign(e),this.m_weights[0]=n,this.m_weights[1]=i,this.m_weights[2]=o,this.setEndXY(s)}setCpsAndWeightsArray(t,e){this.setCpsAndWeights(t[0],t[1],t[2],e[0],e[1],e[2])}};_e.type=N.enumRationalBezier2;var Dt=class r{static constructPoint2D(t){return new r(J.constructDouble(t.x),J.constructDouble(t.y))}constructor(t,e){if(t===void 0)return this.x=new J().setNAN(),void(this.y=new J().setNAN());this.x=t.clone(),this.y=e.clone()}assignPoint2D(t){return this.x.setDouble(t.x),this.y.setDouble(t.y),this}setCoords(t,e){return this.x.setThis(t),this.y.setThis(e),this}asPoint2D(){return new y(this.x.value(),this.y.value())}crossProduct(t){return this.x.mul(t.y).sub(this.y.mul(t.x))}leftPerpendicularThis(){let t=this.x.clone();this.x=this.y.clone().negate(),this.y=t}clone(){return new r(this.x,this.y)}dotProduct(t){return this.x.mul(t.x).add(this.y.mul(t.y))}add(t){return new r(this.x.add(t.x),this.y.add(t.y))}sub(t){return new r(this.x.sub(t.x),this.y.sub(t.y))}sqrLength(){return this.x.sqr().addThis(this.y.sqr())}mulThis(t){return this.x.mulThis(t),this.y.mulThis(t),this}mul(t){return this.clone().mulThis(t)}},vo=class{constructor(t){return t.coefsT?(this.m_zeroCtor=t.zeroCtor,this.m_elements=t.coefsT.map(e=>e.clone()),w(this.m_elements.length===t.power+1),void this.updatePower()):t.coef0?(this.m_zeroCtor=t.zeroCtor,void(this.m_elements=[t.coef0.clone()])):t.copy?(this.m_zeroCtor=t.copy.m_zeroCtor,void(this.m_elements=t.copy.m_elements.map(e=>e.clone()))):(this.m_zeroCtor=t.zeroCtor,void(this.m_elements=[new this.m_zeroCtor]))}construct(t,e){return this.m_elements=t.map(s=>s.clone()),this.updatePower(),this}construct0(t){return this.m_elements.length=0,this.m_elements.push(t.clone()),this.updatePower(),this}assignCopy(t){return this.m_elements=t.m_elements.map(e=>e.clone()),this.updatePower(),this}assignMove(t){return this.m_elements=t.m_elements,t.m_elements=[],this.updatePower(),this}power(){return this.m_elements.length-1}addElement(t){this.m_elements.push(t.clone())}fmSubThis(t,e){return w(0),this}addThis(t){let e=Math.min(this.power(),t.power());for(let n=0;n<=e;++n)this.m_elements[n].addThis(t.m_elements[n]);let s=t.power();this.m_elements.length=Math.max(this.power(),t.power())+1;for(let n=e+1;n<=s;++n)this.m_elements[n]=t.m_elements[n];return this.updatePower(),this}add0(t){return this.m_elements[0].addThis(t),this.updatePower(),this}addNumber0(t){return w(0),this}sub(t){let e=Math.min(this.power(),t.power());for(let n=0;n<=e;++n)this.m_elements[n].subThis(t.m_elements[n]);let s=t.power();this.m_elements.length=Math.max(this.power(),t.power())+1;for(let n=e+1;n<=s;++n)this.m_elements[n]=t.m_elements[n].clone(),this.m_elements[n].negateThis();return this.updatePower(),this}sub0(t){return w(0),this}subNumber0(t){return w(0),this}subShifted(t,e){let s=this.power(),n=t.power()+e,i=Math.min(this.power(),n),o=0;for(let a=e;a<=i;++a)this.m_elements[a].subThis(t.m_elements[o]),o++;if(n<=s)return this.updatePower(),this;this.m_elements.length=n+1;for(let a=s+1;a<this.m_elements.length;++a)this.m_elements[a]=new this.m_zeroCtor;for(let a=i+1;a<=n;++a)this.m_elements[a].subThis(t.m_elements[o++]);return this.updatePower(),this}subShiftedWithCoef(t,e,s){let n=this.power(),i=t.power()+s,o=Math.min(this.power(),i),a=0;for(let h=s;h<=o;++h)this.m_elements[h].fmSubThis(t.m_elements[a],e),a++;if(i<=n)return this.updatePower(),this;this.m_elements.length=i+1;for(let h=n+1;h<this.m_elements.length;++h)this.m_elements[h]=new this.m_zeroCtor;for(let h=o+1;h<=i;++h)this.m_elements[h].fmSubThis(t.m_elements[a++],e);return this.updatePower(),this}mulThis(t){if(this.constructor===t.constructor){let e=t,s=[];for(let n=0,i=this.power();n<=i;n++)for(let o=0,a=e.power();o<=a;o++){let h=this.m_elements[n].clone();h.mulThis(e.m_elements[o]),n+o<s.length?s[n+o].addThis(h):s.push(h)}this.m_elements=s}else for(let e=0,s=this.power();e<=s;e++)this.m_elements[e].mulThis(t);return this.updatePower(),this}mulElementThis(t){for(let e=0,s=this.power();e<=s;e++)this.m_elements[e].mulThis(t);return this.updatePower(),this}mulNumber0(t){return w(0),this}mulBigint0(t){return w(0),this}mulBigIntThis(t){return w(0),this}mulInt320(t){return w(0),this}div0(t){return w(0),this}absThis(){return w(0),this}div(t,e,s){if(this.power()<t.power())return s.assignCopy(this),void e.setZero();s.setZero(),e.setZero();let n=t.getElement(t.power()),i=this.clone(),o=i.power(),a=i.power()-t.power(),h=a;for(e.m_elements=k(e.m_zeroCtor,a+1);;){if(o<t.power()){s.assignMove(i);break}if(o===i.power()){let m=i.getElement(i.power());m.divThis(n),i.subShiftedWithCoef(t,m,i.power()-t.power()),e.m_elements[h]=m.clone()}h--,o--}s.updatePower(),e.updatePower()}divThis(t){return w(0),this}subThis(t){let e=Math.min(this.power(),t.power());for(let n=0;n<=e;++n)this.m_elements[n].subThis(t.m_elements[n]);let s=t.power();this.m_elements.length=Math.max(this.power(),t.power())+1;for(let n=e+1;n<=s;++n)this.m_elements[n]=t.m_elements[n].clone(),this.m_elements[n].negateThis();return this.updatePower(),this}sub0This(t){return this.m_elements[0].subThis(t),this.updatePower(),this}subFrom(t,e){w(0)}isZero(){return this.power()===0&&this.m_elements[0].isZero()}negateThis(){for(let t=this.m_elements.length-1;t>=0;t--)this.m_elements[t].negateThis();return this}getElement(t){return this.m_elements[t].clone()}setElement(t,e){return this.m_elements[t]=e.clone(),this}evaluate(t){let e=this.power(),s=this.m_elements[e].clone();for(let n=e-1;n>=0;--n)s.mulThis(t),s.addThis(this.m_elements[n]);return s}equals(t){if(this===t)return!0;if(this.power()!==t.power())return!1;for(let e=this.m_elements.length-1;e>=0;e--)if(!this.m_elements[e].equals(t.m_elements[e]))return!1;return!0}updatePower(){for(let t=this.m_elements.length-1;t>0&&this.m_elements[t].isZero();t--)this.m_elements.pop();return this}setZero(){return this.m_elements.length=1,this.m_elements[0]=new this.m_zeroCtor,this.updatePower(),this}derivative(t){if(this.power()<t)return this.clone().setZero();if(t===0)return this.clone();let e=new this.constructor({coefsT:this.m_elements.slice(t),power:this.power()-t});for(let s=t,n=this.power();s<=n;s++){let i=BigInt(s);for(let o=s-1,a=s-t;o>a;--o)i*=BigInt(o);e.m_elements[s-t].mulBigIntThis(i)}return e.updatePower(),e}derivative1This(){if(this.m_elements.length>1){this.m_elements=this.m_elements.slice(1);for(let t=1,e=this.power();t<=e;t++)this.m_elements[t].mulThis(J.constructInt32(t+1))}else this.m_elements.length=0,this.m_elements.push(new this.m_zeroCtor);return this}limitPrecisionThis(t){for(let e=this.power();e>=0;--e)this.m_elements[e].limitPrecisionThis(t);return this.updatePower(),this}hiBitIndex(){return this.m_elements.reduce((t,e)=>{let s=e.hiBitIndex();return t<s?s:t},0)}shiftRight(t){return this.m_elements.splice(0,t),this.updatePower(),this}static evaluateCoefs(t,e,s){let n=t.power();s.construct0(t.getElement(0).evaluate(e));for(let i=1;i<=n;++i)s.addElement(t.getElement(i).evaluate(e));s.updatePower()}},gt=class r extends vo{constructor(t){super(t===void 0?{zeroCtor:J}:Ha(Tn({},t),{zeroCtor:J}))}clone(){return new r({copy:this})}absEvaluate(t){let e=this.power(),s=this.m_elements[e].clone();s.absThis();let n=t.clone();n.absThis();for(let i=e-1;i>=0;--i)s.mulThis(n),s.addThis(this.m_elements[i].abs());return s}},Ee=class r extends vo{constructor(t){super(t===void 0?{zeroCtor:gt}:Ha(Tn({},t),{zeroCtor:gt}))}clone(){return new r({copy:this})}constructFromMPValues(t,e){this.m_elements.length=0;for(let s=0;s<=e;++s)this.m_elements.push(new gt({coef0:t[s]}));return this.updatePower(),this}};function Ap(){return{polypoly1:new Ee,polypoly2:new Ee,polyX2:new gt,polyY2:new gt,polyX2Deriv:new gt,polyY2Deriv:new gt,polypolyX1:new Ee,polypolyY1:new Ee,polypolyX1Deriv:new Ee,polypolyY1Deriv:new Ee,lazyPolypolyD1:new Ee,lazyPolypolyD1Deriv:new Ee,lazyPolyD2:new gt,lazyPolyD2Deriv:null,polypoly11:new Ee,polypoly12:new Ee,tempPp:new Ee,tempPp1:new Ee,tempPp2:new Ee,tempP:new gt,tempP1:new gt,tempP2:new gt}}function pi(r,t,e,s,n,i,o,a,h,m,l,u,c,g,d,_,p,f=!1){let x=Ap();x.polyX2.construct(o,a),x.polyY2.construct(h,m),x.polypolyX1.constructFromMPValues(r,t),x.polypolyY1.constructFromMPValues(e,s),x.polypoly11.assignCopy(x.polypolyX1),x.polypoly12.assignCopy(x.polypolyY1),l&&(x.lazyPolyD2.construct(l,u),x.polypoly11.mulElementThis(x.lazyPolyD2),x.polypoly12.mulElementThis(x.lazyPolyD2)),n?(x.lazyPolypolyD1.constructFromMPValues(n,i),x.lazyPolypolyD1Deriv=new Ee({copy:x.lazyPolypolyD1}),x.lazyPolypolyD1Deriv.derivative1This(),x.tempPp.assignCopy(x.lazyPolypolyD1),x.tempPp.mulElementThis(x.polyX2),x.polypoly11.subThis(x.tempPp),x.tempPp.assignCopy(x.lazyPolypolyD1),x.tempPp.mulElementThis(x.polyY2),x.polypoly12.subThis(x.tempPp)):(x.polypoly11.sub0This(x.polyX2),x.polypoly12.sub0This(x.polyY2)),x.polypolyX1Deriv.assignCopy(x.polypolyX1),x.polypolyX1Deriv.derivative1This(),x.polypolyY1Deriv.assignCopy(x.polypolyY1),x.polypolyY1Deriv.derivative1This(),n&&(x.polypolyX1Deriv.mulThis(x.lazyPolypolyD1),x.tempPp2.assignCopy(x.lazyPolypolyD1Deriv),x.tempPp2.mulThis(x.polypolyX1),x.polypolyX1Deriv.subThis(x.tempPp2),x.polypolyY1Deriv.mulThis(x.lazyPolypolyD1),x.tempPp2.assignCopy(x.lazyPolypolyD1Deriv),x.tempPp2.mulThis(x.polypolyY1),x.polypolyY1Deriv.subThis(x.tempPp2)),x.polyX2Deriv.assignCopy(x.polyX2),x.polyX2Deriv.derivative1This(),x.polyY2Deriv.assignCopy(x.polyY2),x.polyY2Deriv.derivative1This(),l&&(w(x.lazyPolyD2Deriv===null),x.lazyPolyD2Deriv=new gt({copy:x.lazyPolyD2}),x.lazyPolyD2Deriv.derivative1This(),x.polyX2Deriv.mulThis(x.lazyPolyD2),x.tempP1.assignCopy(x.lazyPolyD2Deriv),x.tempP1.mulThis(x.polyX2),x.polyX2Deriv.subThis(x.tempP1),x.polyY2Deriv.mulThis(x.lazyPolyD2),x.tempP1.assignCopy(x.lazyPolyD2Deriv),x.tempP1.mulThis(x.polyY2),x.polyY2Deriv.subThis(x.tempP1)),x.polypoly1.assignCopy(x.polypoly11),x.polypoly1.mulElementThis(x.polyX2Deriv),x.tempPp.assignCopy(x.polypoly12),x.tempPp.mulElementThis(x.polyY2Deriv),x.polypoly1.addThis(x.tempPp),x.polypoly2.assignCopy(x.polypolyX1Deriv),x.polypoly2.mulElementThis(x.polyY2Deriv),x.tempPp.assignCopy(x.polypolyY1Deriv),x.tempPp.mulElementThis(x.polyX2Deriv),x.polypoly2.subThis(x.tempPp);let C=[],P=[];p||(p=[]),_||(_=[]),Dh(x.polypoly11,x.polypoly12,x.tempP);let E=57,S=.25*Number.EPSILON,I=[],D=gn(x.tempP,c,d,S,E,I);if(D<0)return-1;for(let G=0;G<D;G++){gt.evaluateCoefs(x.polypoly11,J.constructDouble(I[G]),x.tempP1);let F=[],M=gn(x.tempP1,c,g,S,E,F);if(M!==0)if(gt.evaluateCoefs(x.polypoly12,J.constructDouble(I[G]),x.tempP2),M<0){M=gn(x.tempP2,c,g,S,E,F),M<0&&j("mp_curve_proximity");for(let q=0;q<M;q++)P.push(Kt(F[q],I[G]))}else{let q=x.tempP2.absEvaluate(fs);q.mulThis(J.constructDouble(1e-12));for(let R=0;R<M;R++){let X=x.tempP2.evaluate(J.constructDouble(F[R]));X.absThis(),X.lt(q)&&P.push(Kt(F[R],I[G]))}}}D=P.length,Dh(x.polypoly1,x.polypoly2,x.tempP),E=57,S=.25*Number.EPSILON;let b=[],T=gn(x.tempP,c,d,S,E,b);T<0&&(T=0);for(let G=0;G<T;G++){gt.evaluateCoefs(x.polypoly1,J.constructDouble(b[G]),x.tempP1);let F=[],M=gn(x.tempP1,c,g,S,E,F);if(M!==0)if(gt.evaluateCoefs(x.polypoly2,J.constructDouble(b[G]),x.tempP2),M<0){if(M=gn(x.tempP2,c,g,S,E,F),M<0)continue;for(let q=0;q<M;q++)C.push(Kt(F[q],b[G]))}else{let q=x.tempP2.absEvaluate(fs);q.mulThis(J.constructDouble(1e-12));for(let R=0;R<M;R++){let X=x.tempP2.evaluate(J.constructDouble(F[R]));X.absThis(),X.lt(q)&&C.push(Kt(F[R],b[G]))}}}if(T=C.length,D===0&&T===0)return 0;C=C.concat(P),C.sort((G,F)=>f?_s(G.second,F.second):_s(G.first,F.first));let A=Za(C,(G,F)=>G.first===F.first&&G.second===F.second);C=C.slice(0,A),_.length=0,p.length=0;for(let G of C)_.push(G.first),p.push(G.second);return w(_.length===p.length),p.length}function Mp(r,t,e,s,n,i,o){if(r.power()===0)return r.isZero()?-1:0;let a=r.evaluate(J.constructInt32(1)).isZero();if(r.power()===1){let h=sg(r.getElement(1),r.getElement(0),t,i.at(0));return i[0].limitPrecisionThis(s),h!==1?0:(i[0].limitPrecisionThis(s),1)}return r.power()===2?er(r.getElement(2),r.getElement(1),r.getElement(0),s,t,a,i):r.power()===3?sr(r.getElement(3),r.getElement(2),r.getElement(1),r.getElement(0),s,t,a,i):r.power()===4?ng(r.getElement(4),r.getElement(3),r.getElement(2),r.getElement(1),r.getElement(0),s,t,a,i):rg(r,t,e,s,a,n,i,o)}function Gp(){return{polyIntersect:new gt,polyX1:new gt,polyY1:new gt,polyX1Deriv:new gt,polyY1Deriv:new gt,lazyPolyD1:new gt,lazyPolyD1Deriv:new gt,tempP:new gt,tempP1:new gt,tempP2:new gt,polypoly1Proximity:new Ee,polypoly2Proximity:new Ee}}function dm(r,t,e,s,n,i,o,a,h,m,l){let u=Gp();u.polyX1.construct(r,t),u.polyY1.construct(e,s),u.polyX1Deriv.assignCopy(u.polyX1),u.polyX1Deriv.derivative1This(),u.polyY1Deriv.assignCopy(u.polyY1),u.polyY1Deriv.derivative1This(),u.polyIntersect.assignCopy(u.polyX1),u.polyIntersect.mulThis(u.polyX1),u.polyIntersect.mulElementThis(o[0]),u.tempP.assignCopy(u.polyY1),u.tempP.mulThis(u.polyY1),u.tempP.mulElementThis(o[1]),u.polyIntersect.addThis(u.tempP),n?(u.lazyPolyD1.construct(n,i),u.tempP.assignCopy(u.lazyPolyD1),u.tempP.mulThis(u.lazyPolyD1),u.tempP.mulElementThis(o[2]),u.polyIntersect.addThis(u.tempP)):u.polyIntersect.add0(o[2]);{let P=o[0].clone(),E=P.clone();E.sqrThis();let S=o[1].clone(),I=S.clone();I.sqrThis();let D=o[2].clone(),b=P.clone();b.subThis(S),u.polyX1.construct(r,t),u.polyX1Deriv.assignCopy(u.polyX1),u.polyX1Deriv.derivative1This(),u.polyY1.construct(e,s),u.polyY1Deriv.assignCopy(u.polyY1),u.polyY1Deriv.derivative1This(),u.tempP.assignCopy(u.polyX1),u.tempP.mulThis(u.polyX1),u.tempP.mulElementThis(I),u.tempP.mulElementThis(D),u.polypoly1Proximity.construct0(u.tempP),u.tempP.assignCopy(u.polyX1),u.tempP.mulThis(S.mul(b).mul(D).ldexpThis(1)),u.polypoly1Proximity.addElement(u.tempP),u.tempP.assignCopy(u.polyX1),u.tempP.mulThis(u.polyX1),u.tempP.mulElementThis(P.mul(I)),u.tempP1.assignCopy(u.polyY1),u.tempP1.mulThis(u.polyY1),u.tempP1.mulElementThis(E.mul(S)),u.tempP.addThis(u.tempP1),u.tempP.add0(b.mul(b).mul(D)),u.polypoly1Proximity.addElement(u.tempP),u.tempP.assignCopy(u.polyX1),u.tempP.mulElementThis(b.mul(P).mul(S).ldexpThis(1)),u.polypoly1Proximity.addElement(u.tempP),u.tempP.construct0(P.mul(b).mul(b)),u.polypoly1Proximity.addElement(u.tempP),u.polypoly1Proximity.updatePower(),u.tempP.construct0(de),u.polypoly2Proximity.construct0(u.tempP),u.tempP.assignCopy(u.polyX1),u.tempP.mulThis(u.polyX1Deriv),u.tempP1.assignCopy(u.polyY1),u.tempP1.mulThis(u.polyY1Deriv),u.tempP.addThis(u.tempP1),u.tempP.mulElementThis(P.mul(S)),u.polypoly2Proximity.addElement(u.tempP),u.tempP.assignCopy(u.polyX1Deriv),u.tempP.mulElementThis(b.mul(P)),u.polypoly2Proximity.addElement(u.tempP),u.polypoly2Proximity.updatePower()}let c=[],g=[];l||(l=[]);let d=2*u.polyIntersect.power()+58,_=.5*Number.EPSILON,p=gn(u.polyIntersect,a,h,_,d,g);if(p<0)return-1;Dh(u.polypoly1Proximity,u.polypoly2Proximity,u.tempP),d=2*u.tempP.power()+58;let f=gn(u.tempP,a,h,_,d,c);if(f<0&&(f=0),p===0&&f===0)return 0;let x=c.concat(g);l.length=x.length,ye(l,x,0,0,x.length),Nn(l);let C=Za(l,(P,E)=>_s(P,E)===0);return l.length=C,l.length}function sg(r,t,e,s){return r.isZero()?t.isZero()?-1:0:(s.setThis(t),s.negateThis(),s.divThis(r),e.isEmpty()||e.containsCoordinate(s.value())?1:0)}function er(r,t,e,s,n,i,o){if(r.isZero())return i?(o[0].setInt32(1),n.containsCoordinate(1)?1:0):sg(t,e,n,o[0]);if(i){let g=2;return o[0].setInt32(1),e.equals(r)?(o[1].setInt32(1),g=1):o[1].setThis(e.div(r)),n.containsCoordinate(o[1].value())||(g=1),n.containsCoordinate(o[0].value())||(g--,o[0].setThis(o[1])),g===2&&o[0].value()>o[1].value()&&(o[1]=O(o[0],o[0]=o[1])),g}let a=t.clone();a.sqrThis();let h=r.clone();if(h.mulThis(e).ldexpThis(2).negateThis().addThis(a),h.LZ())return 0;let m=s+2,l=J.sqrt(h,m),u=l.clone();t.LZ()&&u.negateThis(),u.addThis(t).limitPrecisionThis(m).ldexpThis(-1).negateThis();let c=0;return o[0].setThis(u).divThis(J.constructAssign(r,m)).limitPrecisionThis(s),(n.isEmpty()||n.containsCoordinate(o[0].value()))&&c++,l.isZero()||u.isZero()||(o[c].setThis(e).divThis(u).limitPrecisionThis(s),(n.isEmpty()||n.containsCoordinate(o[c].value()))&&c++,c===2&&o[0].gt(o[1])&&(o[1]=O(o[0],o[0]=o[1]))),c}function sr(r,t,e,s,n,i,o,a){if(r.isZero())return er(t,e,s,n,i,o,a);let h=(A,G)=>{if(A>0){let F=G+A;for(let M=1;M<F;M++)a[M].equals(a[0])&&(a[F-1]=O(a[M],a[M]=a[F-1]),F--);G=F}return os(a,0,G,(F,M)=>F.compare(M)),G};if(s.isZero()){let A=0;return i.containsCoordinate(0)&&(a[0].setInt32(0),A=1),h(er(r,t,e,n,i,o,a.slice(1)),A)}if(o){let A=0;i.containsCoordinate(1)&&(a[0].setInt32(1),A=1);let G=t.add(r),F=s.negate(),M=r.add(G).add(F).isZero();return h(er(r,G,F,n,i,M,a.slice(A)),A)}let m=new J,l=new J,u=new J,c=t.clone();if(c.isZero())l.setThis(e),l.divThis(r),u.setThis(s),l.divThis(r);else{c.divThis(r).divDoubleThis(3).negateThis();let A=t.clone();A.sqrThis();let G=r.clone();G.sqrThis(),l.setThis(r),l.mulThis(e).mulDoubleThis(3).subThis(A).divThis(G).divDoubleThis(3),u.setThis(A),u.mulThis(t),u.ldexpThis(1),m.setThis(r),m.mulThis(t).mulThis(e).mulDoubleThis(9),u.subThis(m),m.setThis(G),m.mulThis(s).mulDoubleThis(27),u.addThis(m),u.divThis(G).divThis(r).divDoubleThis(27)}if(l.isZero()){let A=u.clone();return A.negateThis(),A.isZero()?(a[0].setThis(c),Qi(i,n,a,1)):(a[0].setThis(J.cubicRoot(u,n).add(c)),Qi(i,n,a,1))}let g=u.clone();if(g.sqrThis().ldexpThis(-2),m.setThis(l.clone()),m.sqrThis().mulThis(l).divDoubleThis(27),g.addThis(m),g.isZero())return a[0].setThis(u),a[0].mulDoubleThis(3).divThis(l),a[1].setThis(a[0]),a[1].negateThis(),a[1].ldexpThis(-1),a[0].addThis(c),a[1].addThis(c),Qi(i,n,a,2);if(g.GZ())return g.setThis(J.sqrt(g,n+8)),m.setThis(u),m.ldexpThis(-1).negateThis(),m.addThis(g),a[0].setThis(J.cubicRoot(m,n+8)),m.setThis(u),m.ldexpThis(-1).negateThis(),m.subThis(g),a[0].addThis(J.cubicRoot(m,n+8)),a[0].addThis(c),Qi(i,n,a,1);m.setThis(l),m.divDoubleThis(3).negateThis(),w(m.GEZ());let d=J.sqrt(m,n+8),_=d.clone();_.negateThis(),_.addThis(c),d.addThis(c);let p=J.constructDouble(i.isEmpty()?-Number.MAX_VALUE:i.vmin),f=J.constructDouble(i.isEmpty()?Number.MAX_VALUE:i.vmax),x=new gt({zeroCtor:J});x.construct0(s),x.addElement(e),x.addElement(t),x.addElement(r);let C=new gt({copy:x});C.derivative1This();let P=0,E=k(J,4);E[P++].setThis(p),_.gt(p)&&_.lt(f)&&E[P++].setThis(_),d.gt(p)&&d.lt(f)&&E[P++].setThis(d),E[P++].setThis(f);let S=3*n,I=52,D=Number.EPSILON;for(;I<S;)2*I<=S?(D*=D,I*=2):(D*=Number.EPSILON,I+=52);I+=2;let b=0,T=!1;for(let A=1;A<P;A++)if(Th(x,C,E[A-1],E[A],D,I,a[0])){b=1,T=A+1<P;break}if(!b)return 0;if(T){let A=new gt({zeroCtor:J,coef0:a[0]});A.negateThis(),A.addElement(fs);let G=new gt({zeroCtor:J}),F=new gt({zeroCtor:J});x.div(A,G,F),w(G.power()===2),w(F.power()===0);let M=er(G.getElement(2),G.getElement(1),G.getElement(0),n,i,!1,a.slice(1));w(M>=0&&M<=2),b+=M}return Qi(i,n,a,b)}function ng(r,t,e,s,n,i,o,a,h){if(r.isZero())return sr(t,e,s,n,i,o,a,h);let m=(_,p)=>{if(_>0){let f=p+_;for(let x=1;x<f;x++)h[x].equals(h[0])&&(h[f-1]=O(h[x],h[x]=h[f-1]),f--);p=f}return os(h,0,p,(f,x)=>f.compare(x)),p};if(n.isZero()){let _=0;return o.containsCoordinate(0)&&(h[0].setInt32(0),_=1),m(sr(r,t,e,s,i,o,a,h.slice(_)),_)}let l=new gt({zeroCtor:J,coef0:n});if(l.addElement(s),l.addElement(e),l.addElement(t),l.addElement(r),a){let _=0;o.containsCoordinate(1)&&(h[0].setInt32(1),_=1);let p=new gt({zeroCtor:J,coef0:J.constructInt32(-1)});p.addElement(J.constructInt32(1));let f=new gt({zeroCtor:J}),x=new gt({zeroCtor:J});return l.div(p,f,x),m(sr(f.power()===3?f.getElement(3):de.clone(),f.power()>=2?f.getElement(2):de.clone(),f.power()>=1?f.getElement(1):de.clone(),f.getElement(0),i,o,f.evaluate(fs).isZero(),h.slice(_)),_)}if(l.getElement(0).isZero()){let _=0;for(o.containsCoordinate(0)&&(_=1,h[0].setDouble(0));l.getElement(0).isZero()&&l.power()>0;)l.shiftRight(1);let p=sr(l.power()===3?l.getElement(3):de.clone(),l.power()>=2?l.getElement(2):de.clone(),l.power()>=1?l.getElement(1):de.clone(),l.getElement(0),i,o,!1,h.slice(_));return p>0&&(_+=p),os(h,0,_,(f,x)=>f.compare(x)),_}let u=52,c=Number.EPSILON;for(;u<i;)2*u<=i?(c*=c,u*=2):(c*=Number.EPSILON,u+=52);u+=2;let g=og(l),d=J.constructDouble(Math.max(Math.abs(o.vmax),Math.abs(o.vmin)));return c=(g.lt(d)?g:d).mul(J.constructDouble(c)).toDouble(),rg(l,o,c,u,a,!1,h,4)}function Fp(r,t){let e=r,s=t;s.power()>e.power()&&(s=O(e,e=s));let n=e.power()-s.power(),i=new gt({copy:e.getElement(e.power())});e.mulThis(s.getElement(s.power()));for(let o=0,a=e.power();o<a;o++)if(o>=n){let h=new gt({copy:s.getElement(o-n)});h.mulThis(i);let m=e.getElement(o).sub(h);e.setElement(o,m)}e.setElement(e.power(),e.getElement(e.power()).setZero()),e.updatePower(),wh(e)}function wh(r){let t=0;for(;t<r.power()&&r.getElement(t).isZero();)t++;return t>0&&(r.shiftRight(t),!0)}function Dh(r,t,e){let s=r.clone(),n=t.clone();for(wh(s),wh(n);s.power()!==0||n.power()!==0;)Fp(s,n);e.assignMove(s.getElement(0))}function gn(r,t,e,s,n,i){i.length=0;let o=r.power(),a=k(J,2*o+4),h=Mp(r,e||B.unit(),s,n,!1,a,a.length);if(h>0){i.length=0;for(let m=0;m<h;m++){let l=a[m].value();m>0&&l<=i.at(-1)||i.push(l)}return i.length}return h}function ig(r,t,e){if(w(e>=1),r.power()===0)return r.isZero()?-1:0;let s=r.getElement(0);return s.negateThis(),s.divThis(r.getElement(1)),t[0].setThis(s),1}function Vp(r,t,e,s){if(r.power()<2)return ig(r,e,s);w(s>=1);let n=r.getElement(1);n.mulThis(r.getElement(1));let i=r.getElement(0);if(i.mulThis(r.getElement(2)),i.ldexpThis(2),n.subThis(i),n.LZ())return 0;if(n.isZero()){let m=r.getElement(1);return m.negateThis(),m.divThis(r.getElement(2)),m.ldexpThis(-1),m.limitPrecisionThis(t),e[0].setThis(m),1}w(s>=2),n=J.sqrt(n,t+8);let o=r.getElement(1);o.negateThis();let a=o.clone();a.subThis(n),a.divThis(r.getElement(2)),a.ldexpThis(-1),a.limitPrecisionThis(t);let h=o.clone();return h.addThis(n),h.divThis(r.getElement(2)),h.ldexpThis(-1),h.limitPrecisionThis(t),a.lt(h)?(e[0].setThis(a),e[1].setThis(h)):(e[1].setThis(a),e[0].setThis(h)),2}function Th(r,t,e,s,n,i,o){let a=e.clone(),h=s.clone();a.limitPrecisionThis(i),h.limitPrecisionThis(i);let m=r.evaluate(a);m.limitPrecisionThis(i+2);let l=r.evaluate(h);if(l.limitPrecisionThis(i+2),m.GEZ()&&l.GEZ()||m.LEZ()&&l.LEZ())return m.absLessAbs(l)?(o=a,m.isZero()):(o=h,l.isZero());let u=l.LZ();u&&(l=O(m,m=l),h=O(a,a=h));let c=u?h:a,g=u?a:h,d=a.add(h).ldexpThis(-1);d.limitPrecisionThis(i);let _=h.sub(a);_.limitPrecisionThis(i),_.absThis();let p=_.clone(),f=r.evaluate(d),x=t.evaluate(d),C=new gt({copy:r}),P=new gt({copy:t});{let z=Math.max(r.hiBitIndex(),t.hiBitIndex()),Y=fs.clone();Y.ldexpThis(-(i+2));for(let L=64;L<z;){C.limitPrecisionThis(L),P.limitPrecisionThis(L);let W=C.evaluate(d),K=P.evaluate(d),yt=W.sub(f),rt=K.sub(x);if(yt.divThis(f).absThis().lt(Y)&&(x.isZero()||rt.divThis(x).absThis().lt(Y)))break;C.assignCopy(r),P.assignCopy(t),L=Math.min(L+64,z)}f.limitPrecisionThis(i+2),x.limitPrecisionThis(i+2)}let E=1,S=4,I=S,D=2,b=1,T=0,A=0,G=E,F=32,M=J.constructDouble(.25*n),q=J.constructDouble(.5001),R=0,X=300;for(;++R<X;){if(R>F&&T>0||x.isZero()||G===D&&T>1||G===E&&I<S)G=E,b>1&&b--;else if(G=D,A>1){let K=_.mul(x);K.absThis(),K.ldexpThis(-3),K.absLessAbs(f)&&b++}_.setThis(p);let z=new J,Y=!1;if(G===E)do{if(A>2){let K=_.clone();if(K.absThis(),K.ldexpThis(4),g.sub(c).ldexpThis(-1).gt(K)){if(d.equals(c)){z.setThis(d),d.setThis(c.add(K)),d.limitPrecisionThis(i),p.setThis(d.sub(z));break}if(d.equals(g)){z.setThis(d),d.setThis(g.sub(K)),d.limitPrecisionThis(i),p.setThis(d.sub(z));break}}}p.setThis(h.sub(a)),p.ldexpThis(-1),p.limitPrecisionThis(i),z.setThis(d),d.setThis(a.add(p)),d.limitPrecisionThis(i),d.lt(c)?d.setThis(c):d.gt(g)&&d.setThis(g),Y=a.equals(d)||h.equals(d)}while(!1);else for(;;){if(p.setThis(f.div(x)),p.limitPrecisionThis(i),b!==1&&p.mulDoubleThis(b),z.setThis(d),d.subThis(p),d.limitPrecisionThis(i),Y=d.equals(z),d.lt(c)){if(b>1){d.setThis(z),b--;continue}p.setThis(z.sub(c)),d.setThis(c)}else if(d.gt(g)){if(b>1){d.setThis(z),b--;continue}p.setThis(z.sub(g)),d.setThis(g)}break}if(Y||p.absLessAbs(M)){z.equals(d)||(f=C.evaluate(d),f.limitPrecisionThis(i+2));break}f=C.evaluate(d),f.limitPrecisionThis(i+2),x=P.evaluate(d),x.limitPrecisionThis(i+2);let L=a.clone(),W=h.clone();f.LZ()?(m.setThis(f),a.setThis(d)):(l.setThis(f),h.setThis(d)),G===D&&(a.equals(L)&&h.equals(W)||A>1&&!p.absLessAbs(q.mul(_)))?T++:T=0,G===E?(I++,A=0):(I=0,A++)}return R>=X&&j("Root_finder iterations exceeded"),o.setThis(d),!0}function qp(r,t,e,s,n){let i=r.evaluate(e);if(i.isZero())return!0;let o=J.constructDouble(.5*s),a=e.clone();a.subThis(o);let h=r.evaluate(a),m=e.clone();m.addThis(o);let l=r.evaluate(m);if(h.LZ()&&l.GZ()||h.GZ()&&l.LZ()||(i.GZ()?h.LEZ()||l.LEZ():h.GEZ()||l.GEZ()))return!0;let u=h.LEZ()&&l.LEZ(),c=h.GEZ()&&l.GEZ(),g=!1;return u?i.gt(h)&&i.gt(l)&&(g=!0):c&&i.lt(h)&&i.lt(l)&&(g=!0),!!g&&i.absThis().lt(J.constructDouble(1e-17))}function rg(r,t,e,s,n,i,o,a){w(e>0),w(a>=r.power());let h=o,m=[],l=[],u=new gt({zeroCtor:r.m_zeroCtor}),c=new gt({zeroCtor:r.m_zeroCtor}),g=new gt({zeroCtor:r.m_zeroCtor}),d=J.constructDouble(e),_=J.constructDouble(t.vmin),p=J.constructDouble(t.vmax),f=_.sub(d),x=p.add(d),C=og(r),P=C.clone();if(P.negateThis(),f.lt(P))f.setThis(P.sub(d));else if(f.gt(C))return 0;if(x.gt(C))x.setThis(C.add(d));else if(x.lt(P))return 0;let E=r,S=null;if(n){let q=new gt({coef0:J.constructInt32(-1)});q.addElement(fs),S=new gt,E=S;let R=new gt,X=new gt;for(r.div(q,R,X),S.assignCopy(R);E.evaluate(fs).isZero();)E.div(q,R,X),S.assignCopy(R)}let I=!1;if(E.power()>0&&E.getElement(0).isZero())for(I=!0,S||(S=new gt({copy:E}),E=S);E.getElement(0).isZero();)S.shiftRight(1);let D=s+2*E.power()+2,b=e/Math.pow(2,E.power()+2),T=D;if(de.gt(f)&&de.lt(x)){for(let q=0,R=E.power();q<R;q++)if(E.getElement(q).isZero()){m.push(de.clone());break}}for(let q=E.power()-1;q>0;q--)if(b*=2,D-=2,T-=2,E.power()-q!=1)if(E.power()-q!=2){c.assignMove(g),g.assignMove(E.derivative(q-1));let R=[];for(let X=0,z=l.length;X<z;++X)if(l[X].first.lte(l[X].second)){let Y=new J;if(Th(c,u,l[X].first,l[X].second,b,D,Y)){m.push(Y);let L=Y.sub(d);L.limitPrecisionThis(T),R.push(Kt(l[X].first,L)),L=Y.add(d),L.limitPrecisionThis(T),R.push(Kt(L,l[X].second))}else R.push(l[X])}l=R,R=[],u.assignMove(c)}else{c.assignMove(E.derivative(q));let R=Vp(c,D,h,a);w(R>=0&&R<=2);for(let X=0;X<R;X++)h[X].gt(f)&&h[X].lt(x)&&!h[X].isZero()&&m.push(h[X].clone());if(m.length>1&&m.sort((X,z)=>X.compare(z)),m.length>0){let X=m[0].sub(d);X.limitPrecisionThis(T),l.push(Kt(f.clone(),X));let z=m.length===1?x.clone():m[1].sub(d);X=m[0].add(d),X.limitPrecisionThis(T),z.limitPrecisionThis(T),l.push(Kt(X,z)),m.length>1&&(z=m.length===2?x.clone():m[2].sub(d),z.limitPrecisionThis(T),X=m[1].add(d),X.limitPrecisionThis(T),l.push(Kt(X,z)),m.length>2&&(X=m[2].add(d),X.limitPrecisionThis(T),l.push(Kt(X,x.clone()))))}else l.push(Kt(f.clone(),x.clone()));u.assignCopy(c),g.assignMove(E.derivative(q-1))}else c.assignMove(E.derivative(q)),ig(c,h,a)===1&&(h[0].gt(f)&&h[0].lt(x)&&!h[0].isZero()&&m.push(h[0].clone()),u.assignMove(c),g.assignMove(E.derivative(q-1)));m.sort((q,R)=>q.compare(R)),l.length===0&&(u.assignMove(E.derivative(E.power())),u.isZero()||l.push(Kt(f.clone(),x.clone())));let A=0,G=0,F=0,M=new J;for(;;){if(G<l.length){if(l[G].first.gt(l[G].second)){G++;continue}let q=!1;if(F<m.length&&m[F].lt(l[G].first)&&(q=!0),!q){Th(E,u,l[G].first,l[G].second,e,s,M)&&(M.lt(_)?h[A++].setThis(_):M.gt(p)?h[A++].setThis(p):h[A++].setThis(M)),G++;continue}}if(!(F<m.length))break;F!==0&&m[F-1].equals(m[F])||qp(E,u,m[F],e)&&(M.setThis(m[F]),M.lt(_)?M.setThis(_):M.gt(p)&&M.setThis(p),A!==0&&h[A].equals(M)||h[A++].setThis(M)),F++}return I&&de.gt(f)&&de.lt(x)&&(h[A++].setThis(de),os(h,0,A,(q,R)=>q.compare(R))),n&&fs.gt(f)&&fs.lt(x)&&(h[A++].setThis(fs),os(h,0,A,(q,R)=>q.compare(R))),A}function og(r){let t=r.getElement(r.power());t.limitPrecisionThis(53);let e=de.clone();for(let s=0,n=r.power();s<n;s++){let i=r.getElement(s);i.limitPrecisionThis(53),i.divThis(t).absThis(),i.gt(e)&&e.setThis(i)}return e.addThis(fs),e.mulThis(J.constructDouble(1+100*Number.EPSILON)),e}function Qi(r,t,e,s){let n=s;if(!r.isEmpty()){n=0;for(let i=0;i<s;++i)r.containsCoordinate(e[i].value())&&(n!==i&&e[n].setThis(e[i]),n++)}n>1&&(e[0].gt(e[1])&&(e[1]=O(e[0],e[0]=e[1])),n>2&&(e[0].gt(e[2])&&(e[2]=O(e[0],e[0]=e[2])),e[1].gt(e[2])&&(e[2]=O(e[1],e[1]=e[2]))));for(let i=0;i<n;++i)e[i].limitPrecisionThis(t);return n}var nc=[[.33998104358485626,.6521451548625461],[.8611363115940526,.34785484513745385]],ic=[[.1834346424956498,.362683783378362],[.525532409916329,.31370664587788727],[.7966664774136267,.22238103445337448],[.9602898564975363,.10122853629037626]],rc=[[.09501250983763744,.1894506104550685],[.2816035507792589,.18260341504492358],[.45801677765722737,.16915651939500254],[.6178762444026438,.14959598881657674],[.755404408355003,.12462897125553388],[.8656312023878318,.09515851168249279],[.9445750230732326,.062253523938647894],[.9894009349916499,.027152459411754096]],oc=[[.04830766568773832,.0965400885147278],[.1444719615827965,.09563872007927486],[.23928736225213706,.09384439908080457],[.33186860228212767,.09117387869576389],[.42135127613063533,.08765209300440381],[.5068999089322294,.08331192422694675],[.5877157572407623,.07819389578707031],[.6630442669302152,.0723457941088485],[.7321821187402897,.06582222277636185],[.7944837959679424,.058684093478535544],[.84936761373257,.050998059262376175],[.8963211557660521,.04283589802222668],[.9349060759377397,.03427386291302143],[.9647622555875064,.02539206530926206],[.9856115115452684,.01627439473090567],[.9972638618494816,.007018610009470096]],ac=[[.024350292663424433,.048690957009139724],[.07299312178779904,.04857546744150343],[.12146281929612056,.048344762234802954],[.16964442042399283,.04799938859645831],[.21742364374000708,.04754016571483031],[.2646871622087674,.04696818281621002],[.31132287199021097,.046284796581314416],[.3572201583376681,.04549162792741814],[.4022701579639916,.044590558163756566],[.4463660172534641,.04358372452932345],[.48940314570705296,.04247351512365359],[.5312794640198946,.04126256324262353],[.571895646202634,.03995374113272034],[.6111553551723933,.038550153178615626],[.6489654712546573,.03705512854024005],[.6852363130542333,.035472213256882386],[.7198818501716109,.033805161837141606],[.7528199072605319,.03205792835485155],[.7839723589433414,.030234657072402478],[.8132653151227975,.028339672614259483],[.8406292962525803,.02637746971505466],[.8659993981540928,.024352702568710874],[.8893154459951141,.022270173808383253],[.9105221370785028,.02013482315353021],[.9295691721319396,.017951715775697343],[.9464113748584028,.015726030476024718],[.9610087996520538,.013463047896718643],[.973326827789911,.011168139460131128],[.983336253884626,.008846759826363947],[.9910133714767443,.006504457968978363],[.9963401167719553,.004147033260562468],[.9993050417357722,.001783280721696433]],hc=[[.012223698960615764,.024446180196262518],[.03666379096873349,.024431569097850044],[.06108196960413957,.02440235563384958],[.08546364050451549,.024358557264690626],[.10979423112764375,.024300200167971867],[.13405919946118777,.02422731922281525],[.15824404271422493,.024139957989019287],[.18233430598533718,.024038168681024052],[.2063155909020792,.023922012136703457],[.23017356422666,.023791557781003402],[.2538939664226943,.023646883584447616],[.2774626201779044,.02348807601653591],[.3008654388776772,.02331522999406276],[.32408843502441337,.023128448824387027],[.3471177285976355,.022927844143686846],[.369939555349859,.02271353585023646],[.39254027503326744,.022485652032744968],[.414906379552275,.022244328893799764],[.43702450103710416,.02198971066846049],[.4588814198335522,.021721949538052076],[.48046407240417205,.02144120553920846],[.5017595591361445,.02114764646822135],[.5227551520511755,.02084144778075115],[.5434383024128103,.02052279248696007],[.5637966482266181,.020191871042130043],[.5838180216287631,.01984888123283086],[.6034904561585486,.019494028058706602],[.6228021939105849,.019127523609950944],[.6417416925623075,.01874958694054471],[.660297632272646,.01836044393733134],[.6784589224477192,.017960327185008687],[.6962147083695144,.017549475827117706],[.7135543776835874,.01712813542311138],[.7304675667419088,.016696557801589205],[.746944166797062,.016255000909785187],[.7629743300440948,.015803728659399347],[.7785484755064119,.015343010768865144],[.7936572947621933,.014873122602147314],[.8082917575079137,.014394345004166847],[.8224431169556439,.013906964132951985],[.8361029150609068,.013411271288616333],[.8492629875779689,.012907562739267348],[.8619154689395485,.012396139543950923],[.8740527969580318,.01187730737274028],[.8856677173453972,.011351376324080417],[.8967532880491582,.010818660739503076],[.9073028834017568,.010279479015832158],[.9173101980809605,.009734153415006806],[.9267692508789478,.009183009871660874],[.9356743882779164,.00862637779861675],[.9440202878302202,.008064589890486059],[.9518019613412644,.0074979819256347285],[.9590147578536999,.006926892566898814],[.9656543664319652,.006351663161707189],[.9717168187471366,.005772637542865698],[.9771984914639074,.00519016183267633],[.9820961084357185,.004604584256702955],[.9864067427245862,.004016254983738642],[.9901278184917344,.0034255260409102157],[.9932571129002129,.0028327514714579912],[.9957927585349812,.0022382884309626186],[.997733248625514,.0016425030186690294],[.9990774599773758,.0010458126793403489],[.9998248879471319,.00044938096029209035]];function Hs(r,t,e,s){let n=.5*(s-e),i=e+n,o=new oe(0);for(let a=0,h=Math.trunc(r/2);a<h;++a){let m,l;switch(r){case 4:m=nc[a][0],l=nc[a][1];break;case 8:m=ic[a][0],l=ic[a][1];break;case 16:m=rc[a][0],l=rc[a][1];break;case 32:m=oc[a][0],l=oc[a][1];break;case 64:m=ac[a][0],l=ac[a][1];break;case 128:m=hc[a][0],l=hc[a][1];break;default:throw new Error("Quadrature_integral: invalid n")}let u=Oa(-.5,m,i),c=Oa(n,m,i);o.pe(t(u)*l),o.pe(t(c)*l)}return o.getResult()*n}function hi(r,t,e,s,n,i){return kp(r,t,e,i,s,n)}function Yp(r,t,e,s,n,i){let o=n;if(s)return i[0]=1,o=.5*(t-r)*(e(r)+e(t)),o;let a=i[0],h=(t-r)/a,m=r,l=new oe(0);for(let u=1;u<=i[0];++u){let c=(u-.5)*h;l.add(e(m+c))}return o=.5*(o+(t-r)*l.getResult()/a),i[0]*=2,o}function Xp(r,t,e,s,n,i,o){let a=0,h=Math.abs(n-e[r]),m=Z(t,Number.NaN),l=Z(t,Number.NaN);for(let d=0;d<t;++d){let _=Math.abs(n-e[r+d]);_<h&&(a=d,h=_),m[d]=s[r+d],l[d]=s[r+d]}let u=0,c=0,g=0;i[0]=s[r+a],a--;for(let d=1;d<t;d++){for(let _=0;_<t-d;_++){if(c=e[r+_]-n,g=e[r+_+d]-n,u=c-g,u===0)return!1;let p=(m[_+1]-l[_])/u;m[_]=c*p,l[_]=g*p}if(2*(a+1)<t-d){let _=a+1;o[0]=m[_]}else{let _=a;o[0]=l[_],a--}i[0]+=o[0]}return!0}function kp(r,t,e,s,n,i){if(e<t&&U("xTo < xFrom"),e===t)return 0;let o=[0],a=Number.MAX_VALUE,h=[Number.MAX_VALUE],m=0,l=32,u=Z(l+1,Number.NaN),c=Z(l+1,Number.NaN),g=[0];u[0]=1;let d=0,_=0;for(let p=0;p<l;p++){if(m=Yp(t,e,s,p===0,m,g),c[p]=m,p+1>=r){Xp(p+1-r,r,u,c,0,o,h)||j("polynomial_interpolation");let f=n*Math.abs(o[0])+i,x=Math.abs(a-o[0]);if(x<=f&&Math.abs(h[0])<=f){if(d++,d>1&&(x<=.1*_||_===0||d>2))return o[0]}else d=0;_=x,a=o[0]}c[p+1]=c[p],u[p+1]=.25*u[p]}return o[0]}var Nh=class{constructor(){this.length=Number.NaN,this.area=Number.NaN,this.centroidX=Number.NaN,this.centroidY=0,this.specialPoints=[],this.specialPointsLength=[]}specialPointsCount(){return this.specialPoints.length}};function Ah(r,t,e,s,n,i,o,a){for(;;){let h=y.distance(t[0],t[2]),m=y.distance(t[0],t[1])+y.distance(t[1],t[2]);if(m-h<=n+s*m)return r+pt(h,m,.5);let l=k(y,4),u=I=>(ai(t,e,1,I,l),l[1].length());if(o===0&&a<8){w(a<8);let I=u(0),D=u(1);i[0]+=2,I>D&&(D=O(I,I=D),t[2]=O(t[0],t[0]=t[2]),e[2]=O(e[0],e[0]=e[2]));let b=I/(I+D),T=1,A=m;for(;b<1/32&&A>=n+s*A;){T/=4;let G=u(T);i[0]++,b=I/(G+I);let F=new y;if(Xt(t,e,.5*T,F),A=y.distance(F,t[0]),A<=n){let M=new y;Xt(t,e,T,M),A+=y.distance(M,F)}}if(T!==1){let G=k(y,3),F=[0,0,0];cc(t,e,T,t,e,G,F),r=Ah(r,G,F,s,n,i,0,a+1),o++,a++;continue}}let c=!1,g=8;i[0]+=g;let d=Hs(g,u,0,1),_=16;i[0]+=_;let p=Hs(_,u,0,1);if(c=Math.abs(d-p)>n+s*m,!c)return r+p;if(o<8&&a<9){let I=k(y,3),D=[0,0,0];cc(t,e,.5,t,e,I,D),r=Ah(r,I,D,s,n,i,o+1,a+1),o++,a++;continue}let f=32;i[0]+=f;let x=Hs(f,u,0,1);if(c=Math.abs(p-x)>n+s*m,!c)return r+x;let C=64;i[0]+=C;let P=Hs(C,u,0,1);if(c=Math.abs(x-P)>n+s*m,!c)return r+P;let E=128;i[0]+=E;let S=Hs(E,u,0,1);return c=Math.abs(P-S)>n+s*m,r+S}}function Rp(r,t,e,s,n){if(e===t)return 0;let i=k(y,3),o=[0,0,0];r.queryControlPoints(i),r.queryWeights(o);let a=[0,0,0],h=k(y,3);return $s(i,o,t,e,h,a),Ah(0,h,a,s,n,[0],0,0)}var Hp=class{constructor(r,t,e){this.controlPoints=Vi(r,3),this.weights=[0,0,0],ye(this.weights,t,0,0,3),this.point=e.clone()}getMaxDerivative(){return 3}getValue(r,t){if(r===0){let e=new y;Xt(this.controlPoints,this.weights,t,e);let s=k(y,4);return ai(this.controlPoints,this.weights,1,t,s),2*e.sub(this.point).dotProduct(s[1])}if(r===1){let e=new y;Xt(this.controlPoints,this.weights,t,e);let s=k(y,4);return ai(this.controlPoints,this.weights,2,t,s),2*(e.sub(this.point).dotProduct(s[2])+s[1].dotProduct(s[1]))}if(r===2){let e=new y;Xt(this.controlPoints,this.weights,t,e);let s=k(y,4);return ai(this.controlPoints,this.weights,3,t,s),2*(e.sub(this.point).dotProduct(s[3])+3*s[1].dotProduct(s[2]))}return 0}getError(r){return w(0),0}};function Lp(r,t,e,s){let n=i0(0,0,0,0,y.getNAN()),i=Z(18,Number.NaN),o=k(y,3);r.queryControlPoints(o),o[2].subThis(t),o[1].subThis(t),o[0].subThis(t);let a=[0,0,0];r.queryWeights(a);let h=[1,ms(a),1],m=cr(a,e),l=cr(a,s),u=xn(new Hp(o,h,new y(0,0)),B.construct(m,l),18,i);Xt(o,h,m,n.pt),n.t=m,n.d=y.distance(n.pt,new y(0,0));let c=new y;Xt(o,h,l,c);let g=y.distance(c,new y(0,0));g<n.d&&(n.d=g,n.t=l,n.pt.assign(c));for(let d=0;d<u;d++){Xt(o,h,i[d],c);let _=y.distance(c,new y(0,0));_<n.d&&(n.d=_,n.t=mi(a,i[d]),n.pt.assign(c))}return n}function Bp(r,t,e,s,n){let i=!0,o=k(y,4),a=hi(5,t,e,s,n,m=>(Io(r,1,m,o),(i?r.getCoordX(m)-r.getStartX():r.getCoordY(m)-r.getStartY())*o[1].length()));i=!1;let h=hi(5,t,e,s,n,m=>(Io(r,1,m,o),(i?r.getCoordX(m)-r.getStartX():r.getCoordY(m)-r.getStartY())*o[1].length()));return new y(a,h)}function Ki(r){r.m_cachedValues=null}function Up(r,t){t.m_cachedValues=O(r.m_cachedValues,r.m_cachedValues=t.m_cachedValues)}function ar(r){if(r.m_cachedValues)return r.m_cachedValues;let t=new Nh,e=k(y,3);r.queryControlPoints(e);let s=[0,0,0];return r.queryWeights(s),ag(e,s,t.specialPoints),mg(r,t),t}function ag(r,t,e){if(t[1]===0)return e.length=0,e.push(0),void e.push(1);let s=k(H,8);s[0].set(0);let n=1;{let i=new H(r[1].x).subThis(r[0].x).mulThis(t[1]).mulThis(t[0]),o=new H(r[2].x).subThis(r[0].x).mulThis(t[2]).mulThis(t[0]),a=i.subE(o).addThisE(new H(r[2].x).subThis(r[1].x).mulThis(t[2]).mulThis(t[1]));o.subThisE(i.mul(2));let h=k(H,2),m=Le(a,o,i,new B(0,1),!1,h);m<0&&(m=0);for(let l=0;l<m;l++)bt(h[l].value(),0,1)||(s[n]=h[l],n++)}{let i=new H(r[1].y).subThis(r[0].y).mulThis(t[1]).mulThis(t[0]),o=new H(r[2].y).subThis(r[0].y).mulThis(t[2]).mulThis(t[0]),a=i.subE(o).addThisE(new H(r[2].y).subThis(r[1].y).mulThis(t[2]).mulThis(t[1]));o.subThisE(i.mul(2));let h=k(H,2),m=Le(a,o,i,new B(0,1),!1,h);m<0&&(m=0);for(let l=0;l<m;l++)bt(h[l].value(),0,1)||(s[n]=h[l],n++)}if(s[n].set(1),n++,n>2){os(s,0,n,(h,m)=>_s(h.value(),m.value()));let i=0,o=s[0].value(),a=1;for(let h=1;h<n;h++)s[h].eq(s[h-1])?(o+=s[h].value(),a++):(a>1&&(o/=a,s[i].set(o)),i++,s[i]=s[h],o=s[h].value(),a=1);i++,n=i}s[0].set(0),s[n-1].set(1),e.length=n;for(let i=0;i<n;i++)e[i]=s[i].value()}function hr(r,t,e){if(e){if(t<0)return t;if(t>1)return t-1+hr(r,1,!1)}if(r.isDegenerate(0))return 0;let s=t===1,n=ar(r);if(s&&!Number.isNaN(n.length))return n.length;let i=hg(r),o=i/r.calculateUpperLength2D(),a=0,h=0;for(let m=1,l=n.specialPointsCount();m<l;m++){let u=n.specialPoints[m];if(a+=Rp(r,h,Math.min(t,u),o,i),t<=u)break;h=u}return s&&(n.length=a),a}function Io(r,t,e,s){let n=k(y,3);r.queryControlPoints(n);let i=[0,0,0];r.queryWeights(i),ai(n,i,t,e,s)}function ai(r,t,e,s,n){let i=[r[0],r[1],r[2]],o=[t[0],t[1],t[2]],a=k(y,4);zp(i,o,e,s,a);for(let h=0;h<=e;h++)n[h].setCoords(a[h].x,a[h].y)}function zp(r,t,e,s,n){w(e>0);let i=[r[0].clone(),r[1].clone(),r[2].clone()];if(!i[0].isZero()){for(let C=1;C<3;++C)i[C].subThis(i[0]);i[0].setCoords(0,0)}let o=uo(i,t,0,s),a=ch(t,0,s),h=o.divide(a);if(n[0].assign(h),e===0)return;let m=[t[1]*t[0],t[2]*t[0]*.5,t[1]*t[2]],l=[r[1].sub(r[0]),r[2].sub(r[0]),r[2].sub(r[1])],u=a*a,c=uo(l,m,0,s).mul(2).divide(u);if(n[1].assign(c),e===1)return;let g=ch(t,1,s),d=2*a*g,_=uo(l,m,1,s).mul(2).sub(c.mul(d)).divide(u);if(n[2].assign(_),e===2)return;let p=uo(l,m,2,s).mul(2),f=2*(g*g+a*ch(t,2,s)),x=p.sub(_.mul(d).mul(2)).sub(c.mul(f)).divide(u);n[3].assign(x),e!==3&&j("")}function uo(r,t,e,s){if(e===0){if(s<=.5){let n=new y;Ut(2,r[0].mul(t[0]),r[1].mul(t[1]),s,n);let i=new y;Ut(2,r[1].mul(t[1]),r[2].mul(t[2]),s,i);let o=new y;return Ut(2,n,i,s,o),o}{let n=new y;zt(2,r[0].mul(t[0]),r[1].mul(t[1]),s,n);let i=new y;zt(2,r[1].mul(t[1]),r[2].mul(t[2]),s,i);let o=new y;return zt(2,n,i,s,o),o}}if(e===1){let n=r[1].mul(t[1]),i=n.sub(r[0].mul(t[0])).mul(1-s).add(r[2].mul(t[2]).sub(n).mul(s));return i.mulThis(2),i}if(e===2){let n=r[1].mul(t[1]),i=r[2].mul(t[2]).sub(n).sub(n.sub(r[0].mul(t[0])));return i.mulThis(2),i}j("")}function mc(r,t,e,s){if(s.toDouble()<=.5){let n=new $;ze(2,r[0].mulE(t[0]),r[1].mulE(t[1]),s,n);let i=new $;ze(2,r[1].mulE(t[1]),r[2].mulE(t[2]),s,i);let o=new $;return ze(2,n,i,s,o),o}{let n=new $;Oe(2,r[0].mulE(t[0]),r[1].mulE(t[1]),s,n);let i=new $;Oe(2,r[1].mulE(t[1]),r[2].mulE(t[2]),s,i);let o=new $;return Oe(2,n,i,s,o),o}}function ch(r,t,e){if(t===0){let s=pt(r[0],r[1],e),n=pt(r[1],r[2],e);return pt(s,n,e)}if(t===1)return 2*((1-e)*(r[1]-r[0])+(r[2]-r[1])*e);if(t===2)return 2*(r[2]-r[1]-(r[1]-r[0]));j("")}function Op(r,t,e){if(e.toDouble()<=.5){let s=is(r[0],r[1],e),n=is(r[1],r[2],e);return is(s,n,e)}{let s=rs(r[0],r[1],e),n=rs(r[1],r[2],e);return rs(s,n,e)}}function Wp(r,t,e,s,n){let i=[$.constructPoint2D(r[0]),$.constructPoint2D(r[1]),$.constructPoint2D(r[2])];i[2].subThisE(i[0]),i[1].subThisE(i[0]),i[0].setCoords(0,0),jp(i,[new H(t[0]),new H(t[1]),new H(t[2])],e,s,n)}function jp(r,t,e,s,n){w(e>0);let i=[r[0].clone(),r[1].clone(),r[2].clone()];if(!i[0].isZero()){for(let g=1;g<3;++g)i[g].subThisE(i[0]);i[0]=$.constructCoords(0,0)}let o=mc(i,t,0,s),a=Op(t,0,s),h=o.divE(a);n[0].setE(h);let m=[t[1].mulE(t[0]),t[2].mulE(t[0]).mul(.5),t[1].mulE(t[2])],l=mc([r[1].subE(r[0]),r[2].subE(r[0]),r[2].subE(r[1])],m,0,s).mul(2),u=a.sqr(),c=l.divE(u);n[1].setE(c)}function Zp(r,t,e){let s=k(y,3);r.queryControlPoints(s);let n=Z(3,Number.NaN);r.queryWeights(n),Qp(s,n,t,e)}function Qp(r,t,e,s){e.value()<0&&e.set(0,e.eps()),e.value()>1&&e.set(1,e.eps());let n=k($,4);Wp(r,t,1,e,n),s.setE(n[1])}function Mh(r,t,e){let s=Tt(e,0,1),n=k(y,4);if(ai(r,t,3,s,n),n[1].isZero()){if(n[2].isZero())return n[3];{let i=n[2].clone();return s===1&&i.negateThis(),i}}return n[1]}var Kp=class{constructor(r,t){this.len=0,this.b=r,this.len=t}getMaxDerivative(){return 1}getValue(r,t){return r===0?this.len-hr(this.b,t,!1):0}getError(r){return w(0),0}};function $p(r,t,e){let s=hr(r,1,!1);if(t<=0)return t;if(t>=s)return t-s+1;let n=[0];return xn(new Kp(r,t),B.unit(),1,n)!==1&&j(""),n[0]}function lc(r){let t=k(y,3),e=[0,0,0];return r.queryControlPoints(t),r.queryWeights(e),Jp(t,e)}function Jp(r,t){let e=ms(t);if(e===1)return _g(r);if(e===0)return 0;let s=[new y(0,0),r[1].sub(r[0]),r[2].sub(r[0])],n=s[1].crossProduct(s[2]);if(e<1){w(e>0);let i=1-e,o;if(i<.01)o=-1/3+i*(2/15+i*(3/35+i*(16/315+i*(20/693+i*(16/1001+i*(56/6435))))));else{let a=i*(1+e),h=Math.atan2(Math.sqrt(i),Math.sqrt(1+e));o=e*(.5*e-gu(a)*h)/a}return n*o}{let i=(e-1)*(e+1);return .25*e/Math.pow(i,1.5)*(-2*e*Math.sqrt(i)*n-4*s[1].y*s[2].x*Math.atanh(Math.sqrt((e-1)/(e+1)))-s[1].x*s[2].y*Math.log(2*e*(e-Math.sqrt(i))-1))}}function t0(r,t){let e=ms(t);if(e===1){let i=k(y,3);xm(r,i);let o=i[2].clone(),a=i[1].clone(),h=new y,m=o.y*a.x-o.x*a.y;return h.x=-(4*o.x+5*a.x)*m/60,h.y=-(4*o.y+5*a.y)*m/60,h}if(e===0)return new y(0,0);w(e>0);let s=r[1].sub(r[0]),n=r[2].sub(r[0]);if(e<1){let i=Math.sqrt(1-e),o=Math.sqrt(1+e),a=(s.y*n.x-s.x*n.y)*e/Math.pow(i*o,5)/12,h=Math.atan2(i,o),m=e*i*o,l=e*e,u=s.mul(2*(2+l)),c=n.mul(2*l-5),g=u.add(c).mul(m),d=n.sub(s.mul(2*l)).mul(6*h);return g.add(d).mul(a)}{let i=Math.sqrt(e-1),o=Math.sqrt(e+1),a=(s.y*n.x-s.x*n.y)*e/Math.pow(i*o,5)/12,h=Math.atanh(i/o),m=e*i*o,l=e*e,u=s.mul(4).sub(n.mul(5)),c=s.add(n).mul(2*l),g=u.add(c).mul(m),d=n.sub(s.mul(2*l)).mul(6*h);return g.add(d).mul(a)}}function e0(r){let t=k(y,3),e=[0,0,0];return r.queryControlPoints(t),r.queryWeights(e),t0(t,e)}function hg(r){return s0(r.calculateUpperLength2D())}function s0(r){return 256*kt()*r}function n0(r){if(r.m_weights[1]===0)return!0;let t=y.distance(r.getStartXY(),r.getEndXY()),e=r.calculateUpperLength2D();return e-t<=8*Number.EPSILON*e}function uc(r){return r.m_cachedValues}function mg(r,t){r.m_cachedValues=t}function bo(r,t,e,s,n){let i=k(y,3);r.queryControlPoints(i);let o=[0,0,0];r.queryWeights(o);let a=[0];return _m(i,o,t,B.unit(),s,n,1,a)===1?a[0]:Number.NaN}function _m(r,t,e,s,n,i,o,a){Qn(B.unit().contains(s)&&o>0,""),(i<0||Number.isNaN(i))&&(i=Number.MAX_VALUE);let h=new Array(3);for(let Y=0;Y<3;++Y)h[Y]=r[Y].sub(e);let m=ms(t),l=Dt.constructPoint2D(h[0]),u=Dt.constructPoint2D(h[1]),c=Dt.constructPoint2D(h[2]),g=J.constructDouble(m),d=g.clone();d.ldexpThis(1);let _=l.dotProduct(u.sub(l)).mul(g),p=g.mul(g.addDouble(2)),f=c.sub(u.mul(p.ldexp(1))),x=u.sqrLength().mul(g.mul(g).ldexp(1)).add(l.sqrLength().mul(g.ldexp(2).subDouble(1))).add(l.dotProduct(f)),C=c.sub(u.mul(d)).add(l.mul(d.subDouble(1))),P=u.mul(g).sub(l).dotProduct(C).mulDouble(3),E=u.dotProduct(c).mul(g.subDouble(3).mul(g)).ldexp(1),S=u.sqrLength().mul(g.mul(g).ldexp(2)),I=l.sqrLength().mul(g.ldexp(2).subDouble(3)),D=l.dotProduct(c.sub(u.mul(g.mulDouble(3).subDouble(1)).mul(g))).ldexp(1),b=c.sqrLength().addThis(E).addThis(S).addThis(I).addThis(D),T=l.add(c).sub(u.mul(d)),A=g.subDouble(1),G=c.sub(l).dotProduct(T).mul(A),F=new y(0,0),M=[],q=new y;Xt(h,t,s.vmin,q);let R=y.distance(q,F);if(R<=i&&M.push(new y(s.vmin,R)),s.vmin!==s.vmax&&(Xt(h,t,s.vmax,q),R=y.distance(q,F),R<=i&&M.push(new y(s.vmax,R))),s.width()>0){let Y=h[2].isZero(),L=k(J,4),W=ng(G,b,P,x,_,58,s,Y,L);for(let K=0;K<W;K++){if(!s.containsExclusiveCoordinate(L[K].toDouble()))continue;let yt=L[K].toDouble();yt=mi(t,yt);let rt=new y;Xt(h,t,yt,rt),R=y.distance(rt,F),R<=i&&M.push(new y(yt,R))}}if(n){w(s.equals(B.unit()));{Xt(h,t,-1,q,!0);let Y=new y;Xt(h,t,0,Y);let L=new nt({start:q,end:Y}),W=L.getClosestCoordinate(F,!0);W<1&&(q=L.getCoord2D(W),R=y.distance(q,F),R<=i&&M.push(new y(W-1,R)))}{Xt(h,t,2,q,!0);let Y=new y;Xt(h,t,s.vmax,Y);let L=new nt({start:Y,end:q}),W=L.getClosestCoordinate(F,!0);W>0&&(q=L.getCoord2D(W),R=y.distance(q,F),R<=i&&M.push(new y(1+W,R)))}}if(!M.length)return 0;M.sort((Y,L)=>Y.compare(L));let X=0,z=M[0].x;if(a[X++]=z,X<o){let Y=rh(h,4,!1).total(),L=M[0].y;for(let W=1,K=M.length;W<K;W++)if(M[W].y>L+Y){M.length=W;break}M.sort((W,K)=>_s(W.x,K.x)),X=0,a[X++]=M[0].x;for(let W=1,K=M.length;W<K;W++)M[W].x!==a[X-1]&&X<o&&(a[X++]=M[W].x)}return X}function i0(r,t,e,s,n){return{tmin:r,tmax:t,t:e,d:s,pt:n.clone()}}function r0(r,t,e,s,n){let i=new me;if(lg(r,B.unit(),i),i.inflate(s),!i.isIntersectingPoint2D(t))return 0;let o=ar(r),a=0,h=[],m=o.specialPoints[0];for(let l=1,u=o.specialPoints.length;l<u;++l){let c=o.specialPoints[l],g=Lp(r,t,m,c);if(h.length===0)h.push(g);else if(g.t===g.tmin)w(h.at(-1).d<=g.d),h.at(-1).tmax=g.tmax;else if(h.at(-1).t===h.at(-1).tmax){w(h.at(-1).d>=g.d);let d=h.at(-1).tmin;h[h.length-1]=g,h.at(-1).tmin=d}else h.push(g);m=c}for(let l of h)if(l.d<=s){let u=l.t;e&&(e[a]=u),a++}return a}function lg(r,t,e){let s=k(y,3);r.queryControlPoints(s);let n=[0,0,0];r.queryWeights(n),mr(s,n,t,e)}function mr(r,t,e,s){if(e.equalsRange(0,1))return void s.setFromPoints(r,3);let n=k(y,3),i=[0,0,0];$s(r,t,e.vmin,e.vmax,n,i),s.setFromPoints(n,3)}function qo(r){let t=At(r[0].y,r[1].y),e=At(r[1].y,r[2].y);if(t>=0&&e>=0||t<=0&&e<=0){let s=At(r[0].x,r[1].x),n=At(r[1].x,r[2].x);if(s>=0&&n>=0||s<=0&&n<=0)return!0}return!1}function Gh(r){let t=k(y,3);r.queryControlPoints(t);let e=Xn(t);return e&&(r.m_cp.setCoordsPoint2D(t[1]),r.afterCompletedModification()),e}function Xn(r){let t=!1;for(let e=0;e<2;e++){let s=At(r[0][e],r[2][e]);s>0?(At(r[0][e],r[1][e])<0&&(r[1][e]=r[0][e],t=!0),At(r[1][e],r[2][e])<0&&(r[1][e]=r[2][e],t=!0)):s<0?(At(r[0][e],r[1][e])>0&&(r[1][e]=r[0][e],t=!0),At(r[1][e],r[2][e])>0&&(r[1][e]=r[2][e],t=!0)):r[1][e]!==r[0][e]&&(r[1][e]=r[0][e],t=!0)}return t}function o0(r,t,e){e===void 0&&(e=t,t=0);let s=new y;if(t<0||e>1)return s.setNAN(),s;if(t>e&&U("calculate_sub_weighted_centroid"),t===e||r.isDegenerate(0))return s.setCoords(0,0),s;let n=ar(r),i=hg(r),o=i/r.calculateUpperLength2D(),a=t,h=0;for(let m=1,l=n.specialPointsCount();m<l;m++)if(t<n.specialPoints[m]){h=m-1;break}s.setCoords(0,0);for(let m=h+1,l=n.specialPointsCount();m<l;m++){let u=Math.min(n.specialPoints[m],e),c=Bp(r,a,u,o,i);if(s.addThis(c),a=u,e<=n.specialPoints[m])break}return s.add(r.getStartXY().mul(r.calculateLength2D()))}function cc(r,t,e,s,n,i,o){w(e>=0&&e<=1&&s!==i&&n!==o),w(t[0]>0&&t[2]>0&&t[1]>=0);let a=[1,ms(t),1],h=cr(t,e),m=Vi(r,3),l=k(ot,3);ug(m,a,l);let u=k(ot,3),c=k(ot,3);Xh(l,h,s?u:null,i?c:null),kh(t,e,n,o);let g=qo(m);if(s){for(let d=0;d<3;++d)qh(u[d],s[d]);Rh(m,s),g&&Xn(s)}if(i){for(let d=0;d<3;++d)qh(c[d],i[d]);Rh(m,i),g&&Xn(i)}}function $s(r,t,e,s,n,i){if(w(e>=0&&s<=1&&e<=s),e===s){let l=new y,u=cg(r,t,e,l);return pm(r,l),n[0].assign(l),n[1].assign(l),n[2].assign(l),i[0]=u,i[1]=u,void(i[2]=u)}if(e===0&&s===1)return n[0].assign(r[0]),n[1].assign(r[1]),n[2].assign(r[2]),i[0]=t[0],i[1]=t[1],void(i[2]=t[2]);let o=k(ot,3);{let l=[1,ms(t),1],u=cr(t,e),c=cr(t,s);ug(r,l,o),Xh(o,c,o,null),Xh(o,u>=c?1:u/c,null,o)}let a=[0,0,0];kh(t,s,a,null),kh(a,e/s,null,a);let h=qo(r),m=k(y,3);qh(o[1],m[1]),Xt(r,t,e,m[0]),Xt(r,t,s,m[2]),Rh(r,m);for(let l=0;l<3;++l)n[l].assign(m[l]),i[l]=a[l];h&&Xn(n)}function a0(r,t,e){let s=ms(t),n=[1,s,1],i=4*s/(3*(1+s));e[0].assign(r[0]),e[3].assign(r[2]),qt(r[0],r[1],i,e[1]),qt(r[2],r[1],i,e[2]),new Ge({cp:e}),new _e({points:r,weight:s});let o=0,a=.1,h=0;for(let m=0;m<9;m++,a+=.1){let l=new y;Xt(r,n,a,l);let u=new y;Gt(e,a,u);let c=y.sqrDistance(l,u);c>o&&(o=c,h=a)}{let m=new y;Xt(r,n,h,m);let l=[0];Rn(e,m,B.unit(),!1,-1,1,l);let u=new y;return Gt(e,l[0],u),o=y.sqrDistance(m,u),Math.sqrt(o)}}function h0(r,t,e,s){if(t.isEqual(r.m_XStart,r.m_YStart)&&e.isEqual(r.m_XEnd,r.m_YEnd))return;let n=!!s&&r.isMonotoneQuickAndDirty(),i=new ct,o=k(y,3);o[0].setCoords(r.m_XStart,r.m_YStart),o[2].setCoords(r.m_XEnd,r.m_YEnd);let a=new y;a.setSub(o[2],o[0]),a.leftPerpendicularThis(),o[1].setAdd(o[0],a);let h=k(y,3);h[0].setCoordsPoint2D(t),h[2].setCoordsPoint2D(e),a.setSub(h[2],h[0]),a.leftPerpendicularThis(),h[1].setAdd(h[0],a),i.setFromTwoTriangles(o,h)?i.transformInPlace(r.m_cp):qt(t,e,.5,r.m_cp),r.changeEndPoints2D(t,e),n&&Gh(r)}function gc(r,t,e,s,n){if(n){if(Ve(t,e)!==0)return r?4:2}else if(Ze(t,e))return 1;return kn(r,t,e,null,null,null,s,n!==void 0&&n,!0,!1)!==0?4:0}function dc(r,t,e,s,n){if(n){if(Ve(t,e)!==0)return r?4:2}else if(Ze(t,e))return 1;return Fh(r,t,e,null,null,null,s,n??!1,!0,!1)!==0?4:0}function m0(r,t){let e=r.getEndXY().sub(r.getStartXY()),s=e.length(),n=r.getControlPoint1();return n.subThis(r.getStartXY()),!(Math.abs(n.crossProduct(e))/s>t)}function l0(r,t,e,s,n){if(n){let i=Ve(t,e);if(i!==0){if(r){if(i===1){if(t.m_weights[0]===e.m_weights[0]&&t.m_weights[1]===e.m_weights[1]&&t.m_weights[2]===e.m_weights[2])return 2}else if(t.m_weights[0]===e.m_weights[2]&&t.m_weights[1]===e.m_weights[1]&&t.m_weights[2]===e.m_weights[0])return 2;return 4}return 2}}else if(Ze(t,e))return 1;return lr(r,t,e,null,null,null,s,n!==void 0&&n,!0,!1)!==0?4:0}function _c(r,t,e,s,n){if(n){if(Ve(t,e)!==0)return r?4:2}else if(Ze(t,e))return 1;return Vh(r,t,e,null,null,null,s,n??!1,!0,!1)!==0?4:0}function kn(r,t,e,s,n,i,o,a,h,m){if(n!==null&&(n.length=0),i!==null&&(i.length=0),s!==null&&(s.length=0),e.isDegenerate(0)){let Q=[0,0],ht=t.intersectPoint(e.getStartXY(),Q,o);if(ht>0){if(n!==null)for(let it=0;it<ht;it++)n.push(Q[it]);if(i!=null)for(let it=0;it<ht;it++)i.push(0);if(s!=null)for(let it=0;it<ht;it++){let mt=new y;t.queryCoord2D(Q[it],mt),s.push(mt)}}return ht}let l=Fe(t,e);if(o=Math.max(o,l),t.isDegenerateToLineHelper(l)){let Q=new nt({start:t.getStartXY(),end:t.getEndXY()}),ht=Vo(Q,e,s,n,i,o,a,m);if(n)for(let it=0;it<ht;++it){let mt=Q.getCoord2D(n[it]);n[it]=t.getClosestCoordinate(mt,!1)}return ht}if(Qe(t,e,o))return 0;let u=k(y,3);t.queryControlPoints(u);let c=[0,0,0];t.queryWeights(c);let g=[1,ms(c),1],d=e.getEndXY().sub(e.getStartXY()),_=d.clone();_.leftPerpendicularThis();let p=u[0].clone(),f=u[1].clone(),x=u[2].clone(),C=f.sub(p),P=x.sub(p),E=x.sub(f),S=g[0],I=g[1],D=g[2],b=S*I,T=S*D,A=I*D,G=C.dotProduct(_)*b,F=P.dotProduct(_)*T,M=G,q=F-2*G,R=E.dotProduct(_)*A+F-F,X=Z(13,Number.NaN),z=Z(13,Number.NaN),Y=Yn(R,q,M,B.unit(),!1,X);Y<0&&(X[0]=0,X[1]=1,Y=2);let L=0;for(let Q=0,ht=L;Q<Y;++Q){let it=new y;Xt(u,g,X[Q+ht],it),z[L]=e.getClosestCoordinate(it,!1),y.distance(it,e.getCoord2D(z[L]))<=o&&(X[L]=X[Q+ht],L++)}let W=k(y,3),K=k(y,3);if(t.queryControlPoints(K),K[0].subThis(e.getStartXY()),K[1].subThis(e.getStartXY()),K[2].subThis(e.getStartXY()),u0(K,g,W,!1),Math.abs(d.x)>=Math.abs(d.y)){let Q=d.y/d.x;R=W[2].y-W[2].x*Q,q=W[1].y-W[1].x*Q,M=W[0].y-W[0].x*Q}else{let Q=d.x/d.y;R=W[2].x-W[2].y*Q,q=W[1].x-W[1].y*Q,M=W[0].x-W[0].y*Q}let yt=t.getEndXY().equals(e.getStartXY())||t.getEndXY().equals(e.getEndXY()),rt=[0,0];Y=Yn(R,q,M,B.unit(),yt,rt);for(let Q=0,ht=L;Q<Y;++Q){X[Q+ht]=rt[Q];let it=new y;Xt(u,g,X[Q+ht],it),z[L]=e.getClosestCoordinate(it,!1),y.distance(it,e.getCoord2D(z[L]))<=o&&(X[L]=X[Q+ht],L++)}w(L<X.length+4);for(let Q=0;Q<L;Q++)X[Q]=mi(c,X[Q]);Y=t.intersectPoint(e.getStartXY(),rt,o);for(let Q=0;Q<Y;Q++)X[L]=rt[Q],z[L++]=0;Y=t.intersectPoint(e.getEndXY(),rt,o);for(let Q=0;Q<Y;Q++)X[L]=rt[Q],z[L++]=1;Y=e.intersectPoint(t.getStartXY(),rt,o);for(let Q=0;Q<Y;Q++)z[L]=rt[Q],X[L++]=0;Y=e.intersectPoint(t.getEndXY(),rt,o);for(let Q=0;Q<Y;Q++)z[L]=rt[Q],X[L++]=1;return L===0?0:Ke(r,t,e,X,z,L,s,n,i,o,a,h,m)}function Fh(r,t,e,s,n,i,o,a,h,m){if(wt(e))return kn(r,t,new nt({start:e.getStartXY(),end:e.getEndXY()}),s,n,i,o,a,h,m);let l=Fe(t,e);if(Qe(t,e,o=Math.max(o,l)))return 0;let u=[],c=[],g=k(y,4);{t.queryControlPoints(g);let _=k(y,4),p=new ct;e.canonicToWorldTransformation(p);let f=new ct;f.setInvert(p),f.transformPoints2D(g,4,_);let x=k(J,3),C=k(J,3),P=k(J,3),E=[0,0,0];t.queryWeights(E),ur(_,E,x,C,P);let S=k(J,3);S[0].setDouble(e.getSemiMinorAxis()),S[0].sqrThis(),S[1].setDouble(e.getSemiMajorAxis()),S[1].sqrThis(),S[2].setThis(S[0]),S[2].mulThis(S[1]),S[2].negateThis();let I=dm(x,2,C,2,P,2,S,!0,B.unit(),B.unit(),u);if(I>0){let D=0;for(let b=0;b<I;b++){let T=new y;t.queryCoord2D(u[b],T);let A=e.getClosestCoordinate(T,!1),G=new y;e.queryCoord2D(A,G),y.distance(T,G)<=o&&(u[D]=u[b],c.push(A),D++)}u.length=D}}let d=[0,1];for(let _=0;_<2;_++){let p=_===0?e.getStartXY():e.getEndXY(),f=bo(t,p,B.unit(),!1,-1),x=new y;t.queryCoord2D(f,x),y.distance(p,x)<=o&&(u.push(f),c.push(d[_]))}for(let _=0;_<2;_++){let p=[0,3];{let f=e.getClosestCoordinate(g[p[_]],!1),x=new y;e.queryCoord2D(f,x),y.distance(g[p[_]],x)<=o&&(u.push(d[_]),c.push(f))}}return Ke(r,t,e,u,c,u.length,s,n,i,o,a,h,m)}function lr(r,t,e,s,n,i,o,a,h,m){let l=k(y,3);t.queryControlPoints(l);let u=k(y,3);if(e.queryControlPoints(u),lm(l,u,3)<0)return lr(r,e,t,s,i,n,o,a,h,!m);let c=Fe(t,e);if(t.isDegenerateToLineHelper(c)){let S=new nt({start:t.getStartXY(),end:t.getEndXY()}),I=kn(r,e,S,s,i,n,o,a,h,!m);if(n)for(let D=0;D<I;++D){let b=S.getCoord2D(n[D]);n[D]=t.getClosestCoordinate(b,!1)}return I}if(e.isDegenerateToLineHelper(c)){let S=new nt({start:e.getStartXY(),end:e.getEndXY()}),I=kn(r,t,S,s,n,i,o,a,h,m);if(i)for(let D=0;D<I;++D){let b=S.getCoord2D(i[D]);i[D]=e.getClosestCoordinate(b,!1)}return I}if(Qe(t,e,o=Math.max(o,c)))return 0;let g=Z(3,Number.NaN);t.queryWeights(g);let d=Z(3,Number.NaN);e.queryWeights(d);let _=[1,ms(g),1],p=[1,ms(d),1],f=new B(0,1),x=new B(0,1);{let S=me.constructEmpty();mr(l,_,new B(0,1),S);let I=me.constructEmpty();mr(u,p,new B(0,1),I);let D=Math.max(S.maxDim(),I.maxDim());if(S.inflate(3*o),I.inflate(3*o),!S.intersectW(I))return 0;if(S.maxDim()<.1*D){if(Yh(l,_,S,f),Yh(u,p,S,x),f.isEmpty()||x.isEmpty())return 0;$s(l,_,f.vmin,f.vmax,l,_),$s(u,p,x.vmin,x.vmax,u,p)}}let C=fi(l,2,u,2,o);if(C===0)return 0;let P=[],E=[];if(C===-1){let S=k(J,3),I=k(J,3),D=k(J,3);ur(l,_,S,I,D);let b=k(J,3),T=k(J,3),A=k(J,3);ur(u,p,b,T,A);let G=[],F=[],M=pi(S,2,I,2,D,2,b,2,T,2,A,2,!0,B.unit(),B.unit(),G,F);if(M>0)for(let q=0;q<M;q++){let R=new y;Xt(u,p,F[q],R);let X=new y;Xt(l,_,G[q],X),y.distance(X,R)<=o&&(P.push(G[q]),E.push(F[q]))}}for(let S=0;S<2;S++){let I,D,b;S===0?(I=l,D=u,b=p):(I=u,D=l,b=_);for(let T=0;T<2;T++){let A=T===0?0:I.length-1,G=new y,F=[0],M=_m(D,b,I[A],B.unit(),!1,-1,1,F);w(M===1),Xt(D,b,F[0],G),y.distance(I[A],G)<=o&&(S===0?(P.push(A===0?0:1),E.push(F[0])):(E.push(A===0?0:1),P.push(F[0])))}}if(P.length===0)return 0;if(!f.equalsRange(0,1))for(let S=0;S<P.length;++S)P[S]=_e.recalculateParentT(f.vmin,f.vmax,P[S]);if(!x.equalsRange(0,1))for(let S=0;S<E.length;++S)E[S]=_e.recalculateParentT(x.vmin,x.vmax,E[S]);for(let S=0;S<P.length;++S)P[S]=mi(g,P[S]);for(let S=0;S<E.length;++S)E[S]=mi(d,E[S]);return Ke(r,t,e,P,E,P.length,s,n,i,o,a,h,m)}function Vh(r,t,e,s,n,i,o,a,h,m){if(t.isLine())return pr(r,e,new nt({start:t.getStartXY(),end:t.getEndXY()}),s,i,n,o,a,h,!m);if(e.isLine())return kn(r,t,new nt({start:e.getStartXY(),end:e.getEndXY()}),s,n,i,o,a,h,m);let l=Fe(t,e);if(Qe(t,e,o=Math.max(o,l)))return 0;let u=k(y,3);t.queryControlPoints(u);let c=k(y,3);e.queryControlPoints(c);let g=fi(u,2,c,2,o);if(g===0)return 0;let d=[],_=[];if(g===-1){let p=k(J,3),f=k(J,3),x=k(J,3),C=[0,0,0];t.queryWeights(C),ur(u,C,p,f,x);let P=k(Dt,3);li(c,P);let E=pi(p,2,f,2,x,2,[P[0].x,P[1].x,P[2].x],2,[P[0].y,P[1].y,P[2].y],2,null,0,!0,B.unit(),B.unit(),d,_);if(E>0){let S=0;for(let I=0;I<E;I++){let D=new y;e.queryCoord2D(_[I],D);let b=new y;t.queryCoord2D(d[I],b),y.distance(b,D)<=o&&(d[S]=d[I],_[S]=_[I],S++)}d.length=S,_.length=S}}for(let p=0;p<2;p++){let f;f=p===0?u:c;for(let x=0;x<2;x++){let C=x===0?0:f.length-1,P,E=new y;p===0?(P=Do(e,f[C],B.unit(),!1),e.queryCoord2D(P,E)):(P=bo(t,f[C],B.unit(),!1,-1),t.queryCoord2D(P,E)),y.distance(f[C],E)<=o&&(p===0?(d.push(C===0?0:1),_.push(P)):(_.push(C===0?0:1),d.push(P)))}}return Ke(r,t,e,d,_,d.length,s,n,i,o,a,h,m)}function u0(r,t,e,s=!1){let n=k(y,3);s?(n[0].setCoordsPoint2D(r[0]),n[1].setCoordsPoint2D(r[1]),n[1].subThis(n[0]),n[2].setCoordsPoint2D(r[2]),n[2].subThis(n[0]),n[0].setCoords(0,0)):(n[0].setCoordsPoint2D(r[0]),n[1].setCoordsPoint2D(r[1]),n[2].setCoordsPoint2D(r[2])),n[0].mulThis(t[0]),n[1].mulThis(t[1]),n[2].mulThis(t[2]),e[1].setCoords(n[1].x-n[0].x,n[1].y-n[0].y),e[2].setCoordsPoint2D(n[2].sub(n[1])),e[2].subThis(e[1]),e[1].x*=2,e[1].y*=2,e[0].setCoordsPoint2D(n[0])}function ur(r,t,e,s,n){let i=J.constructDouble(t[0]),o=J.constructDouble(t[1]),a=J.constructDouble(t[2]);e[0].setDouble(r[0].x),e[0].mulThis(i),e[1].setDouble(r[1].x),e[1].mulThis(o),e[2].setDouble(r[2].x),e[2].mulThis(a),e[2].subThis(e[1]),e[1].subThis(e[0]),e[2].subThis(e[1]),e[1].ldexpThis(1),s[0].setDouble(r[0].y),s[0].mulThis(i),s[1].setDouble(r[1].y),s[1].mulThis(o),s[2].setDouble(r[2].y),s[2].mulThis(a),s[2].subThis(s[1]),s[1].subThis(s[0]),s[2].subThis(s[1]),s[1].ldexpThis(1),n[0].setDouble(t[0]),n[1].setDouble(t[1]),n[2].setThis(n[1]),n[2].ldexpThis(1),n[2].negateThis(),n[2].addThis(n[0]),n[2].addDoubleThis(t[2]),n[1].subThis(n[0]),n[1].ldexpThis(1)}function ug(r,t,e){for(let s=0;s<3;++s)e[s].setCoordsPoint2DZ(r[s].mul(t[s]),t[s])}function cg(r,t,e,s){if(e===0)return s.assign(r[0]),t[0];if(e===1)return s.assign(r[2]),t[2];let n=[r[0].x*t[0],r[1].x*t[1],r[2].x*t[2]],i=[r[0].y*t[0],r[1].y*t[1],r[2].y*t[2]],o=[t[0],t[1],t[2]],a=e,h,m,l;if(e<=.5){let u=ae(n[0],n[1],a),c=ae(n[1],n[2],a);h=pt(u,c,a);let g=ae(i[0],i[1],a),d=ae(i[1],i[2],a);m=pt(g,d,a);let _=ae(o[0],o[1],a),p=ae(o[1],o[2],a);l=ae(_,p,a)}else{let u=se(n[0],n[1],a),c=se(n[1],n[2],a);h=se(u,c,a);let g=se(i[0],i[1],a),d=se(i[1],i[2],a);m=se(g,d,a);let _=se(o[0],o[1],a),p=se(o[1],o[2],a);l=se(_,p,a)}return h/=l,m/=l,s.setCoords(h,m),pm(r,s),l}function c0(r,t,e){let s=k(y,3);r.queryControlPoints(s);let n=[0,0,0];r.queryWeights(n),g0([$.constructPoint2D(s[0]),$.constructPoint2D(s[1]),$.constructPoint2D(s[2])],[new H(n[0]),new H(n[1]),new H(n[2])],t,e)}function g0(r,t,e,s){if(e.value()===0)return void s.setE(r[0]);if(e.value()===1)return void s.setE(r[2]);let n=[r[0].x.mulE(t[0]),r[1].x.mulE(t[1]),r[2].x.mulE(t[2])],i=[r[0].y.mulE(t[0]),r[1].y.mulE(t[1]),r[2].y.mulE(t[2])],o=[t[0].clone(),t[1].clone(),t[2].clone()],a=new H,h=new H,m=new H;if(e.value()<=.5){let u=is(n[0],n[1],e),c=is(n[1],n[2],e);a.setE(is(u,c,e));let g=is(i[0],i[1],e),d=is(i[1],i[2],e);h.setE(is(g,d,e));let _=is(o[0],o[1],e),p=is(o[1],o[2],e);m.setE(is(_,p,e))}else{let u=rs(n[0],n[1],e),c=rs(n[1],n[2],e);a.setE(rs(u,c,e));let g=rs(i[0],i[1],e),d=rs(i[1],i[2],e);h.setE(rs(g,d,e));let _=rs(o[0],o[1],e),p=rs(o[1],o[2],e);m.setE(rs(_,p,e))}a.divThisE(m),h.divThisE(m);let l=new y(a.value(),h.value());pm([r[0].value(),r[1].value(),r[2].value()],l),s.x.set(l.x,a.eps()),s.y.set(l.y,h.eps())}function qh(r,t){return t.setCoords(r.x/r.z,r.y/r.z),r.z}function Xt(r,t,e,s,n){if(n){if(e<0)return void Re(new nt({start:r[0],end:r[0].add(Mh(r,t,0).getUnitVector())}),e,s);if(e>1)return void Re(new nt({start:r[2],end:r[2].add(Mh(r,t,1).getUnitVector())}),e-1,s)}cg(r,t,e,s)}function Yh(r,t,e,s){s.setEmpty();let n=[];n.push(new B(0,1));let i=.5*Math.max(e.width(),e.height());for(;n.length;){let o=n.at(-1);n.pop();let a=new me;if(mr(r,t,o,a),a.isIntersectingW(e)){let h=Math.max(a.width(),a.height());if(e.containsW(a)||h<=i||o.width()<1e-12)s.merge(o);else{let m=o.getCenter();n.push(B.construct(o.vmin,m)),n.push(B.construct(m,o.vmax))}}}}function ms(r){return r[1]/Math.sqrt(r[0]*r[2])}function mi(r,t){let e=Math.sqrt(r[2]/r[0]);return t/pt(e,1,t)}function cr(r,t){let e=Math.sqrt(r[0]/r[2]);return t/pt(e,1,t)}function Xh(r,t,e,s){w(t>=0&&t<=1),new ot().setCoordsPoint3D(r[0]),new ot().setCoordsPoint3D(r[1]),new ot().setCoordsPoint3D(r[2]);let n=new ot,i=new ot,o=new ot;$n(3,r[0],r[1],t,n),$n(3,r[1],r[2],t,i),$n(3,n,i,t,o);let a=r[2].clone();e&&(e[0].assign(r[0]),e[1].assign(n),e[2].assign(o)),s&&(s[0].assign(o),s[1].assign(i),s[2].assign(a))}function kh(r,t,e,s){let n=[r[0],r[1],r[2]];w(t>=0&&t<=1&&e!==s);let i=pt(n[0],n[1],t),o=pt(n[1],n[2],t),a=pt(i,o,t);e&&(e[0]=n[0],e[1]=i,e[2]=a),s&&(s[0]=a,s[1]=o,s[2]=n[2])}function pm(r,t){let e=B.constructEmpty();e.vmin=e.vmax=r[0].x,e.mergeNeCoordinate(r[1].x),e.mergeNeCoordinate(r[2].x),t.x=Tt(t.x,e.vmin,e.vmax),e.vmin=e.vmax=r[0].y,e.mergeNeCoordinate(r[1].y),e.mergeNeCoordinate(r[2].y),t.y=Tt(t.y,e.vmin,e.vmax)}function Rh(r,t){let e=new B;e.vmin=e.vmax=r[0].x,e.mergeNeCoordinate(r[1].x),e.mergeNeCoordinate(r[2].x),t[0].x=Tt(t[0].x,e.vmin,e.vmax),t[1].x=Tt(t[1].x,e.vmin,e.vmax),t[2].x=Tt(t[2].x,e.vmin,e.vmax),e.vmin=e.vmax=r[0].y,e.mergeNeCoordinate(r[1].y),e.mergeNeCoordinate(r[2].y),t[0].y=Tt(t[0].y,e.vmin,e.vmax),t[1].y=Tt(t[1].y,e.vmin,e.vmax),t[2].y=Tt(t[2].y,e.vmin,e.vmax)}var Hh=class{constructor(){this.area=Number.NaN,this.centroid_x=Number.NaN,this.centroid_y=0,this.specialPoints=[],this.specialPointsLength=[]}specialPointsCount(){return this.specialPoints.length}},Lh=class{constructor(t,e){this.b=t,this.len=e}getMaxDerivative(){return 1}getValue(t,e){return t===0?this.len-wo(this.b,e,!1):0}getError(t){return w(0),0}};function d0(r,t,e,s,n){let i=!0,o=k(y,3);r.queryControlPoints(o);let a=i?0:1,h=o[1][a]-o[0][a],m=o[2][a]-o[0][a],l=hi(5,t,e,s,n,c=>{let g;if(c<=.5){let d=ae(0,h,c),_=ae(h,m,c);g=ae(d,_,c)}else{let d=se(0,h,c),_=se(h,m,c);g=se(d,_,c)}return g*gr(o,1,c).length()});i=!1,a=i?0:1,h=o[1][a]-o[0][a],m=o[2][a]-o[0][a];let u=hi(5,t,e,s,n,c=>{let g;if(c<=.5){let d=ae(0,h,c),_=ae(h,m,c);g=ae(d,_,c)}else{let d=se(0,h,c),_=se(h,m,c);g=se(d,_,c)}return g*gr(o,1,c).length()});return new y(l,u)}function co(r){r.m_cachedValues=null}function _0(r,t){t.m_cachedValues=O(r.m_cachedValues,r.m_cachedValues=t.m_cachedValues)}function Bh(r){if(r.m_cachedValues)return r.m_cachedValues;let t=new Hh;return gg(r,t.specialPoints),pg(r,t),t}function gg(r,t){let e=k(y,3);r.queryControlPoints(e);let s=k(H,8);s[0].set(0);let n=1;{let i=k(H,3);b0(e,i,!1);let o=k(H,2),a=new B(0,1),h=or(i[2].mul(2),i[1],a,o[0]);h<0&&(h=0);for(let m=0;m<h;m++)bt(o[m].value(),0,1)||(s[n]=o[m],n++)}{let i=k(H,3);w0(e,i,!1);let o=k(H,2),a=new B(0,1),h=or(i[2].mul(2),i[1],a,o[0]);h<0&&(h=0);for(let m=0;m<h;m++)bt(o[m].value(),0,1)||(s[n]=o[m],n++)}if(s[n].set(1),n++,n>2){os(s,0,n,(h,m)=>h.value()-m.value());let i=0,o=s[0].value(),a=1;for(let h=1;h<n;h++)s[h].eq(s[h-1])?(o+=s[h].value(),a++):(a>1&&(o/=a,s[i].set(o)),i++,s[i]=s[h],o=s[h].value(),a=1);i++,n=i}s[0].set(0),s[n-1].set(1),t.length=n;for(let i=0;i<n;i++)t[i]=s[i].value()}function wo(r,t,e){let s=k(y,3);return r.queryControlPoints(s),dg(s,t,e)}function dg(r,t,e){if(e){if(t<0)return t;if(t>1)return t-1+dg(r,1,!1)}if(t===1)return pc(r);let s=k(y,3);return Uh(r,t,s,null),pc(s)}function pc(r){if(r[0].equals(r[1]))return y.distance(r[2],r[0]);if(r[1].equals(r[2]))return y.distance(r[0],r[2]);let t=y.distance(r[0],r[1])+y.distance(r[2],r[1]),e=y.distance(r[0],r[2]);if(t-e<=t*Number.EPSILON)return e;let s=1,n=k(y,3);xm(r,n,!0);let i=4*(Et(n[2].x)+Et(n[2].y)),o=2*(n[2].x*n[1].x+n[2].y*n[1].y),a=Et(n[1].x)+Et(n[1].y);if(1e-14*(Math.abs(o)+Math.abs(a))>=Math.abs(i))return 1e-14*Math.abs(a)>=Math.abs(o)?Math.sqrt(a)*s:2/(3*o)*(Math.pow(o*s+a,1.5)-Math.pow(a,1.5));let h=o/i,m=a/i,l=m-h*h,u=s+h;if(l===0)return h>=0&&u>=0||h<=0&&u<=0?Math.abs(.5*Math.sqrt(i)*(u*u-h*h)):.5*Math.sqrt(i)*(u*u+h*h);let c=Math.sqrt(l+u*u),g=Math.sqrt(m);return .5*Math.sqrt(i)*(u*c-h*g+l*Math.log(Math.abs((u+c)/(h+g))))}function fc(r,t){let e=Tt(t,0,1),s=gr(r,1,e);return s.isZero()&&(s=gr(r,2,e)),s}function $i(r,t,e){let s=k(y,3);return r.queryControlPoints(s),gr(s,t,e)}function gr(r,t,e){if(t===1){let s=r[1].sub(r[0]).mul(1-e).add(r[2].sub(r[1]).mul(e));return s.mulThis(2),s}return t===2?r[2].sub(r[1]).sub(r[1].sub(r[0]).mul(2)):y.construct(0,0)}function p0(r,t,e){{let s=$.constructPoint2D(r[1]).subE($.constructPoint2D(r[0])),n=new H(1).subE(e),i=$.constructPoint2D(r[2]).subE($.constructPoint2D(r[1])),o=s.mulE(n).addE(i.mulE(e));return o.mulThisE(new H(2)),o}}function f0(r,t,e){let s=wo(r,1,!1);if(t<=0)return t;if(t>=s)return t-s+1;let n=[0];return xn(new Lh(r,t),B.unit(),1,n)!==1&&j(""),n[0]}function xc(r){let t=k(y,3);return r.queryControlPoints(t),_g(t)}function _g(r){return-r[1].sub(r[0]).crossProduct(r[2].sub(r[0]))/3}function x0(r){let t=y.distance(r.getStartXY(),r.getEndXY()),e=r.calculateUpperLength2D();return e-t<=8*Number.EPSILON*e}function yc(r){return r.m_cachedValues}function pg(r,t){r.m_cachedValues=t}function Do(r,t,e,s,n){Qn(B.unit().contains(e),"QuadraticBezierHelper::getClosestCoordinateSegment");let i=k(y,3);r.queryControlPoints(i);let o=Number.MAX_VALUE,a=[0],h=Yo(i,t,a);if(e.containsCoordinate(a[0]))o=y.distance(t,h);else{a[0]=e.vmin,He(i,a[0],h),o=y.distance(h,t);let m=new y;He(i,e.vmax,m);let l=y.distance(m,t);o>l&&(h.setCoordsPoint2D(m),a[0]=e.vmax,o=l)}if(!s)return a[0];if(e.vmin<=0){let m=new y;r.queryCoord2DExtended(-1,m,!0);let l=new y;r.queryCoord2D(e.vmin,l);let u=new nt({start:m,end:l}),c=u.getClosestCoordinate(t,!0);if(c<1){let g=u.getCoord2D(c),d=y.distance(g,t);d<o&&(o=d,a[0]=c-1,h.assign(g))}}if(e.vmin>=1){let m=new y;r.queryCoord2DExtended(2,m,!0);let l=new y;r.queryCoord2D(e.vmax,l);let u=new nt({start:l,end:m}),c=u.getClosestCoordinate(t,!0);if(c>0){let g=u.getCoord2D(c),d=y.distance(g,t);d<o&&(o=d,a[0]=1+c,h.assign(g))}}return a[0]}function Yo(r,t,e){let s=r[2].sub(r[1]).sub(r[1].sub(r[0])),n=r[1].sub(r[0]),i=r[0].sub(t),o=i.dotProduct(n),a=i.dotProduct(s)+2*n.dotProduct(n),h=3*n.dotProduct(s),m=s.dotProduct(s),l=Z(3,Number.NaN),u=Jc(m,h,a,o,B.unit(),!1,l),c=r[0].clone(),g=0,d=y.sqrDistance(r[0],t),_=y.sqrDistance(r[2],t);_<d&&(g=1,c.assign(r[2]),d=_);for(let p=0;p<u;p++){let f=new y;He(r,l[p],f),_=y.sqrDistance(f,t),_<d&&(d=_,c.assign(f),g=l[p])}return e&&(e[0]=g),c}function y0(r,t,e,s,n,i){let o=new me;if(P0(r,B.unit(),o),o.inflate(n),!o.isIntersectingPoint2D(t))return 0;let a=new y,h=Do(r,t,B.unit(),!1);return r.queryCoord2D(h,a),y.distance(a,t)<=n?(s&&(s[0]=h),1):0}function P0(r,t,e){let s=k(y,3);r.queryControlPoints(s),dr(s,t,e)}function dr(r,t,e){if(t.equalsRange(0,1))return void e.setFromPoints(r,3);let s=k(y,3);_r(r,t.vmin,t.vmax,s),e.setFromPoints(s,3)}function Pc(r,t,e){e.setEmpty();let s=[];s.push(new B(0,1));let n=.5*Math.max(t.width(),t.height());for(;s.length;){let i=s.at(-1);s.pop();let o=new me;if(dr(r,i,o),o.isIntersectingW(t)){let a=Math.max(o.width(),o.height());if(t.containsW(o)||a<=n||i.width()<1e-12)e.merge(i);else{let h=i.getCenter();s.push(B.construct(i.vmin,h)),s.push(B.construct(h,i.vmax))}}}}function To(r){let t=k(y,3);r.queryControlPoints(t);let e=ir(t);return e&&(r.m_cp.setCoordsPoint2D(t[1]),r.afterCompletedModification()),e}function ir(r){let t=!1;for(let e=0;e<2;e++){let s=At(r[0][e],r[2][e]);s>0?(At(r[0][e],r[1][e])<0&&(r[1][e]=r[0][e],t=!0),At(r[1][e],r[2][e])<0&&(r[1][e]=r[2][e],t=!0)):s<0?(At(r[0][e],r[1][e])>0&&(r[1][e]=r[0][e],t=!0),At(r[1][e],r[2][e])>0&&(r[1][e]=r[2][e],t=!0)):r[1][e]!==r[0][e]&&(r[1][e]=r[0][e],t=!0)}return t}function C0(r,t,e){e===void 0&&(e=t,t=0);let s=new y;if(t<0||e>1)return s.setNAN(),s;if(t>e&&U("calculate_sub_weighted_centroid"),t===e||r.isDegenerate(0))return s.setCoords(0,0),s;let n=Bh(r),i=Ts(r),o=Math.min(i/r.calculateUpperLength2D(),1e-7),a=t,h=0;for(let m=1,l=n.specialPointsCount();m<l;m++)if(t<n.specialPoints[m]){h=m-1;break}s.setCoords(0,0);for(let m=h+1,l=n.specialPointsCount();m<l;m++){let u=Math.min(n.specialPoints[m],e),c=d0(r,a,u,o,i);if(s.addThis(c),a=u,e<=n.specialPoints[m])break}return s.add(r.getStartXY().mul(r.calculateLength2D()))}function Uh(r,t,e,s){new y().setCoordsPoint2D(r[0]),new y().setCoordsPoint2D(r[1]),new y().setCoordsPoint2D(r[2]);let n=new y,i=new y,o=new y;if(qt(r[0],r[1],t,n),qt(r[1],r[2],t,i),qt(n,i,t,o),e&&(e[0].assign(r[0]),e[1].assign(n),e[2].assign(o)),s){let a=r[2];s[0].assign(o),s[1].assign(i),s[2].assign(a)}}function _r(r,t,e,s){if(t===e){let i=new y;return He(r,t,i),s[0]=i,s[1]=i,void(s[2]=i)}let n=k(y,3);Uh(r,e,n,null),Uh(n,t/e,null,n),He(r,t,n[0]),He(r,e,n[2]),s[0].setCoordsPoint2D(n[0]),s[1].setCoordsPoint2D(n[1]),s[2].setCoordsPoint2D(n[2])}function E0(r,t,e,s){if(t.isEqual(r.m_XStart,r.m_YStart)&&e.isEqual(r.m_XEnd,r.m_YEnd))return;let n=!!s&&r.isMonotoneQuickAndDirty(),i=new ct,o=k(y,3);o[0].setCoords(r.m_XStart,r.m_YStart),o[2].setCoords(r.m_XEnd,r.m_YEnd);let a=new y;a.setSub(o[2],o[0]),a.leftPerpendicularThis(),o[1].setAdd(o[0],a);let h=k(y,3);h[0].setCoordsPoint2D(t),h[2].setCoordsPoint2D(e),a.setSub(h[2],h[0]),a.leftPerpendicularThis(),h[1].setAdd(h[0],a),i.setFromTwoTriangles(o,h)?i.transformInPlace(r.m_cp):qt(t,e,.5,r.m_cp),r.changeEndPoints2D(t,e),n&&To(r)}function S0(r){return r.getStartXY().norm(1)+r.getEndXY().norm(1)+r.m_cp.norm(1)}function Cc(r,t,e,s,n){if(n){if(Ve(t,e)!==0)return r?4:2}else if(Ze(t,e))return 1;return pr(r,t,e,null,null,null,s,n??!1,!0,!1)!==0?4:0}function Ec(r,t,e,s,n){if(n){if(Ve(t,e)!==0)return r?4:2}else if(Ze(t,e))return 1;return zh(r,t,e,null,null,null,s,n??!1,!0,!1)!==0?4:0}function v0(r,t,e,s,n){if(n){if(Ve(t,e)!==0)return 2}else if(Ze(t,e))return 1;return fm(r,t,e,null,null,null,s,n??!1,!0,!1)!==0?4:0}function pr(r,t,e,s,n,i,o,a,h,m){if(n!=null&&(n.length=0),i!==null&&(i.length=0),s!==null&&(s.length=0),e.isDegenerate(0)){let T=[0,0],A=t.intersectPoint(e.getStartXY(),T,o);if(A>0){if(n!==null)for(let G=0;G<A;G++)n.push(T[G]);if(i!==null)for(let G=0;G<A;G++)i.push(0);if(s!==null)for(let G=0;G<A;G++){let F=new y;t.queryCoord2D(T[G],F),s.push(F)}}return A}let l=Fe(t,e);if(o=Math.max(o,l),t.isDegenerateToLineHelper(l)){let T=new nt({start:t.getStartXY(),end:t.getEndXY()}),A=Vo(T,e,s,n,i,o,a,m);if(n)for(let G=0;G<A;++G){let F=T.getCoord2D(n[G]);n[G]=t.getClosestCoordinate(F,!1)}return A}if(Qe(t,e,o))return 0;let u=Dt.constructPoint2D(e.getStartXY()),c=Dt.constructPoint2D(e.getEndXY()).sub(u),g=c.clone();g.leftPerpendicularThis();let d=Dt.constructPoint2D(t.m_cp).sub(Dt.constructPoint2D(t.getStartXY())),_=Dt.constructPoint2D(t.getEndXY()).sub(Dt.constructPoint2D(t.m_cp)),p=d.dotProduct(g).toDouble(),f=_.sub(d).dotProduct(g).toDouble(),x=Z(12,Number.NaN),C=Z(12,Number.NaN),P=Sp(f,p,B.unit(),x);P<0&&(x[0]=0,x[1]=1,P=2);let E,S=0;for(let T=0,A=S;T<P;++T){let G=t.getCoord2D(x[T+A]);C[S]=e.getClosestCoordinate(G,!1),y.distance(G,e.getCoord2D(C[S]))<=o&&(x[S]=x[T+A],S++)}let I=k(y,3);t.queryControlPoints(I);{let T=k(Dt,3);if(li(I,T,!1),T[0]=T[0].sub(u),c.x.abs().gte(c.y.abs())){let A=c.y.div(c.x);f=T[2].y.sub(T[2].x.mul(A)).toDouble(),p=T[1].y.sub(T[1].x.mul(A)).toDouble(),E=T[0].y.sub(T[0].x.mul(A)).toDouble()}else{let A=c.x.div(c.y);f=T[2].x.sub(T[2].y.mul(A)).toDouble(),p=T[1].x.sub(T[1].y.mul(A)).toDouble(),E=T[0].x.sub(T[0].y.mul(A)).toDouble()}}let D=t.getEndXY().equals(e.getStartXY())||t.getEndXY().equals(e.getEndXY()),b=[0,0];P=Yn(f,p,E,B.unit(),D,b);for(let T=0,A=S;T<P;++T){x[T+A]=b[T];let G=t.getCoord2D(x[T+A]);C[S]=e.getClosestCoordinate(G,!1),y.distance(G,e.getCoord2D(C[S]))<=o&&(x[S]=x[T+A],S++)}w(S<x.length+4),P=t.intersectPoint(e.getStartXY(),b,o);for(let T=0;T<P;T++)x[S]=b[T],C[S++]=0;P=t.intersectPoint(e.getEndXY(),b,o);for(let T=0;T<P;T++)x[S]=b[T],C[S++]=1;P=e.intersectPoint(t.getStartXY(),b,o);for(let T=0;T<P;T++)C[S]=b[T],x[S++]=0;P=e.intersectPoint(t.getEndXY(),b,o);for(let T=0;T<P;T++)C[S]=b[T],x[S++]=0;return S===0?0:Ke(r,t,e,x,C,S,s,n,i,o,a,h,m)}function zh(r,t,e,s,n,i,o,a,h,m){if(wt(e))return pr(r,t,new nt({start:e.getStartXY(),end:e.getEndXY()}),s,n,i,o,a,h,m);let l=Fe(t,e);if(Qe(t,e,o=Math.max(o,l)))return 0;let u=[],c=[],g=k(y,3);{t.queryControlPoints(g);let _=k(y,3),p=new ct;e.canonicToWorldTransformation(p);let f=new ct;f.setInvert(p),f.transformPoints2D(g,3,_);let x=k(Dt,3);li(_,x);let C=[x[0].x,x[1].x,x[2].x],P=[x[0].y,x[1].y,x[2].y],E=k(J,3);E[0].setDouble(e.getSemiMinorAxis()),E[0].sqrThis(),E[1].setDouble(e.getSemiMajorAxis()),E[1].sqrThis(),E[2]=E[0],E[2].mul(E[1]),E[2].negate();let S=dm(C,2,P,2,null,0,E,!0,B.unit(),B.unit(),u);if(S>0){let I=0;for(let D=0;D<S;D++){let b=new y;t.queryCoord2D(u[D],b);let T=e.getClosestCoordinate(b,!1),A=new y;e.queryCoord2D(T,A),y.distance(b,A)<=o&&(u[I]=u[D],c.push(T),I++)}u.length=I}}let d=[0,1];for(let _=0;_<2;_++){let p=_===0?e.getStartXY():e.getEndXY(),f=[0];Yo(g,p,f);let x=new y;He(g,f[0],x),y.distance(p,x)<=o&&(u.push(f[0]),c.push(d[_]))}for(let _=0;_<2;_++){let p=[0,2];{let f=e.getClosestCoordinate(g[p[_]],!1),x=new y;e.queryCoord2D(f,x),y.distance(g[p[_]],x)<=o&&(u.push(d[_]),c.push(f))}}return Ke(r,t,e,u,c,u.length,s,n,i,o,a,h,m)}function fm(r,t,e,s,n,i,o,a,h,m){let l=k(y,3);t.queryControlPoints(l);let u=k(y,3);if(e.queryControlPoints(u),lm(l,u,3)<0)return fm(r,e,t,s,i,n,o,a,h,!m);let c=Fe(t,e);if(Qe(t,e,o=Math.max(o,c)))return 0;if(Y0(t,e,s,n,i,o,a,h,m))return 2;let g=new B(0,1),d=new B(0,1);{let x=new me;dr(l,B.unit(),x);let C=new me;dr(u,B.unit(),C);let P=Math.max(x.maxDim(),C.maxDim());if(x.inflate(3*o),C.inflate(3*o),!x.intersectW(C))return 0;if(x.maxDim()<.1*P){if(Pc(l,x,g),Pc(u,x,d),g.isEmpty()||d.isEmpty())return 0;_r(l,g.vmin,g.vmax,l),_r(u,d.vmin,d.vmax,u)}}let _=fi(l,2,u,2,o);if(_===0)return 0;let p=[],f=[];if(_===-1){let x=k(Dt,3);li(l,x);let C=[x[0].x,x[1].x,x[2].x],P=[x[0].y,x[1].y,x[2].y],E=k(Dt,3);li(u,E);let S=pi(C,2,P,2,null,0,[E[0].x,E[1].x,E[2].x],2,[E[0].y,E[1].y,E[2].y],2,null,0,!0,B.unit(),B.unit(),p,f,m);if(S>0){let I=0;for(let D=0;D<S;D++){let b=new y,T=new y;He(u,f[D],T),He(l,p[D],b),y.distance(b,T)<=o&&(p[I]=p[D],f[I]=f[D],I++)}p.length=I,f.length=I}}for(let x=0;x<2;x++){let C=x===0?l:u,P=x===0?u:l;for(let E=0;E<2;E++){let S=E===0?0:2,I=[0];Yo(P,C[S],I);let D=new y;He(P,I[0],D),y.distance(C[S],D)<=o&&(x===0?(p.push(S===0?0:1),f.push(I[0])):(f.push(S===0?0:1),p.push(I[0])))}}if(p.length===0)return 0;if(!g.equalsRange(0,1))for(let x=0;x<p.length;++x)p[x]=Ls.recalculateParentT(g.vmin,g.vmax,p[x]);if(!d.equalsRange(0,1))for(let x=0;x<f.length;++x)f[x]=Ls.recalculateParentT(d.vmin,d.vmax,f[x]);return Ke(r,t,e,p,f,p.length,s,n,i,o,a,h,m)}function xm(r,t,e=!1){let s=r[1].sub(r[0]);t[1].assign(s.mul(2)),t[2].assign(r[2].sub(r[1]).sub(s)),e?t[0].setCoords(0,0):t[0].assign(r[0])}function I0(r,t,e=!1){let s=k(y,3);r.queryControlPoints(s),xm(s,t,e)}function b0(r,t,e=!1){let n=new H(r[1][0]).subE(new H(r[0][0]));t[1]=n.mul(2),t[2]=new H(r[2][0]).subE(new H(r[1][0])).subE(n),e?t[0].set(0):t[0].set(r[0][0])}function w0(r,t,e=!1){let n=new H(r[1][1]).subE(new H(r[0][1]));t[1]=n.mul(2),t[2]=new H(r[2][1]).subE(new H(r[1][1])).subE(n),e?t[0].set(0):t[0].set(r[0][1])}function li(r,t,e=!1){let s=Dt.constructPoint2D(r[1]),n=s.sub(Dt.constructPoint2D(r[0]));t[1]=n.mul(J.constructInt32(2)),t[2]=Dt.constructPoint2D(r[2]).sub(s).sub(n),t[0]=e?new Dt(de,de):Dt.constructPoint2D(r[0])}function He(r,t,e,s){if(s){if(t<0)return void Re(new nt({start:r[0],end:r[0].add(fc(r,0).getUnitVector())}),t,e);if(t>1)return void Re(new nt({start:r[2],end:r[2].add(fc(r,1).getUnitVector())}),t-1,e)}if(t<=.5){let n=r[1].clone(),i=new y;Ut(2,r[0],n,t,i);let o=new y;Ut(2,n,r[2],t,o);let a=new y;Ut(2,i,o,t,a),e.assign(a)}else{let n=r[1].clone(),i=new y;zt(2,r[0],n,t,i);let o=new y;zt(2,n,r[2],t,o);let a=new y;zt(2,i,o,t,a),e.assign(a)}}function D0(r,t,e){let s=k(y,3);r.queryControlPoints(s),T0(s,t,e)}function T0(r,t,e){if(t.value()<=.5){let s=$.constructPoint2D(r[1]),n=new $;ze(2,$.constructPoint2D(r[0]),s,t,n);let i=new $;ze(2,s,$.constructPoint2D(r[2]),t,i);let o=new $;ze(2,n,i,t,o),e.setE(o)}else{let s=$.constructPoint2D(r[1]),n=new $;Oe(2,$.constructPoint2D(r[0]),s,t,n);let i=new $;Oe(2,s,$.constructPoint2D(r[2]),t,i);let o=new $;Oe(2,n,i,t,o),e.setE(o)}}function N0(r,t,e){let s=k(y,4);r.queryControlPoints(s),A0(s,t,e)}function A0(r,t,e){t.value()<0&&t.set(0,t.eps()),t.value()>1&&t.set(1,t.eps()),e.setE(p0(r,1,t))}function M0(r,t){let e=1;r[1].isEqualPoint2D(r[0])&&(e=2,r[2].isEqualPoint2D(r[0])&&(e=3));let s=2;r[2].isEqualPoint2D(r[3])&&(s=1,r[1].isEqualPoint2D(r[3])&&(s=0)),t[0].assign(r[0]),t[2].assign(r[3]);let n=y.intersectLinesAtOnePoint(r[0],r[e],r[s],r[3]),i=new y;qt(r[0],r[3],.5,i);let o=new y;Gt(r,.5,o);let a=new y;t[1].assign(n),He(t,.5,a);let h=new y;t[1].assign(i),He(t,.5,h);let m=y.sqrDistance(o,a),l=y.sqrDistance(o,h);return m<l?(t[1].setCoordsPoint2D(n),Math.sqrt(m)):(t[1].setCoordsPoint2D(i),Math.sqrt(l))}function G0(r,t,e){e[0].assign(r[0]),e[1].assign(r[1]),e[2].assign(r[2]);let s=new y;Xt(r,t,.5,s);let n=new y;He(e,.5,n);let i=y.sqrDistance(s,n);return Math.sqrt(i)}function F0(r,t){t[0].assign(r[0]),t[3].assign(r[2]),qt(r[0],r[1],2/3,t[1]),qt(r[1],r[2],1/3,t[2])}function V0(r,t){let e=k(y,3);r.queryControlPoints(e);let s=y.sqrDistance(e[1],e[0]),n=y.sqrDistance(e[1],e[2]),i=e[0].clone(),o=s;s>n&&(i=e[2].clone(),o=n);let a=!1;return o<=t&&o!==0&&(a=!0,r.setControlPoint1(i)),a}function q0(r,t){if(!t)return!1;let e=k(y,3);r.queryControlPoints(e);let s=y.sqrDistance(e[1],e[0]),n=y.sqrDistance(e[1],e[2]);e[0].clone();let i=s;return s>n&&(e[2].clone(),i=n),i<=t&&i!==0}function Y0(r,t,e,s,n,i,o,a,h){let m=k(y,3);r.queryControlPoints(m);let l=k(y,3);if(t.queryControlPoints(l),m[0].equals(l[0])){if(m[1].equals(l[1])&&m[2].equals(l[2]))return e&&(e.length=0,e.push(m[0]),e.push(m[2])),s&&(s.length=0,s.push(0),s.push(1)),n&&(n.length=0,n.push(0),n.push(1)),!0;if(!m[0].equals(l[2]))return!1}return!!(m[0].equals(l[2])&&m[1].equals(l[1])&&m[2].equals(l[0]))&&(s&&(s.length=0,s.push(0),s.push(1),h&&(s[1]=O(s[0],s[0]=s[1]))),n&&(n.length=0,n.push(1),n.push(0),h&&(n[1]=O(n[0],n[0]=n[1]))),e&&(e.length=0,e.push(m[0]),e.push(m[2]),h&&(e[1]=O(e[0],e[0]=e[1]))),!0)}var go=Ft,Ge=class r extends qn{constructor(t){t&&t.cp?(super({start:t.cp[0],end:t.cp[3],vd:t.vd}),this.m_cp=k(y,2),this.m_cp[0].assign(t.cp[1]),this.m_cp[1].assign(t.cp[2])):t===void 0||qi(t,"vd")?(super({vd:t?.vd,XStart:0,YStart:0,XEnd:0,YEnd:0}),this.m_cp=k(y,2),this.m_cp[0].setCoords(0,0),this.m_cp[1].setCoords(0,0)):t.from?(super({start:t.from,end:t.to,vd:t.vd}),this.m_cp=k(y,2),this.m_cp[0].assign(t.cp1),this.m_cp[1].assign(t.cp2)):(super({XStart:0,YStart:0,XEnd:0,YEnd:0,vd:t.vd}),j("unrecognized constructor params"),this.m_cp=k(y,2),this.m_cp[0].setCoords(0,0),this.m_cp[1].setCoords(0,0)),this.m_cachedValues=0}getBoundary(){return Es(this)}construct(t,e,s,n){this.m_XStart=t.x,this.m_YStart=t.y,this.m_XEnd=n.x,this.m_YEnd=n.y,this.m_cp[0].assign(e),this.m_cp[1].assign(s),this.afterCompletedModification()}constructPoints(t){this.m_XStart=t[0].x,this.m_YStart=t[0].y,this.m_XEnd=t[3].x,this.m_YEnd=t[3].y,this.m_cp[0].assign(t[1]),this.m_cp[1].assign(t[2]),this.afterCompletedModification()}constructFromQuadratic(t){let e=k(y,4);F0(t,e),this.constructPoints(e)}constructFromQuadraticSegment(t){this.dropAllAttributes(),this.assignVertexDescription(t.getDescription()),this.m_XStart=t.getStartX(),this.m_YStart=t.getStartY(),this.m_XEnd=t.getEndX(),this.m_YEnd=t.getEndY(),$n(2,t.getStartXY(),t.getControlPoint1(),2/3,this.m_cp[0]),$n(2,t.getControlPoint1(),t.getEndXY(),1/3,this.m_cp[1]),this.afterCompletedModification(),Qc(this,t)}getGeometryType(){return N.enumBezier}queryEnvelope(t){if(t.m_EnvelopeType!==2)return void w(0);if(t.setCoords(this.getStartXY()),t.mergeNe(this.getEndXY()),t.contains(this.m_cp[0])&&t.contains(this.m_cp[1]))return;let e=Sc(this);if(e!==null){let a=new y;for(let h of e.specialPoints)this.queryCoord2D(h,a),t.mergeNe(a);return}let s=k(H,8),n=k(y,4);this.queryControlPoints(n);let i=Ig(n,s),o=new y;for(let a=1;a<i-1;a++)this.queryCoord2D(s[a].value(),o),t.mergeNe(o)}applyTransformation(t){if(t.m_TransformationType===1){let e=k(y,4);return this.queryControlPoints(e),t.transformPoints2D(e,4,e),this.setStartXY(e[0]),this.m_cp[0].assign(e[1]),this.m_cp[1].assign(e[2]),this.setEndXY(e[3]),void gh(this)}w(0)}createInstance(){return new r({vd:this.m_description})}calculateLength2D(){return fr(this,1,!1)}calculateLowerLength2D(){return y.distance(this.getStartXY(),this.getEndXY())}calculateUpperLength2D(){return y.distance(this.getStartXY(),this.m_cp[0])+y.distance(this.m_cp[0],this.m_cp[1])+y.distance(this.getEndXY(),this.m_cp[1])}queryCoord2D(t,e){return this.queryCoord2DExtends(t,e,!0)}queryCoord2DExtends(t,e,s){let n=k(y,4);this.queryControlPoints(n),Gt(n,t,e,s)}queryCoord2DE(t,e){K0(this,t,e)}getCoordX(t){if(t<0||t>1){let a=new y;return this.queryCoord2DExtends(t,a,!0),a.x}let e=pt(this.getStartX(),this.m_cp[0].x,t),s=pt(this.m_cp[0].x,this.m_cp[1].x,t),n=pt(this.m_cp[1].x,this.getEndX(),t),i=pt(e,s,t),o=pt(s,n,t);return pt(i,o,t)}getCoordY(t){if(t<0||t>1){let a=new y;return this.queryCoord2DExtends(t,a,!0),a.y}let e=pt(this.getStartY(),this.m_cp[0].y,t),s=pt(this.m_cp[0].y,this.m_cp[1].y,t),n=pt(this.m_cp[1].y,this.getEndY(),t),i=pt(e,s,t),o=pt(s,n,t);return pt(i,o,t)}cut(t,e,s){let n=new et;return this.queryCut(t,e,n,s),n.releaseSegment()}queryCut(t,e,s,n){let i=s.createCubicBezier();if(this.cutBezierIgnoreAttributes(t,e,i),n)return;i.assignVertexDescription(this.m_description);let o=this.m_description.getAttributeCount();if(o>1){for(let a=1;a<o;a++){let h=this.m_description.getSemantics(a),m=go.getComponentCount(h);for(let l=0;l<m;l++){let u=this.getAttributeAsDbl(t,h,l);i.setStartAttribute(h,l,u)}}for(let a=1;a<o;a++){let h=this.m_description.getSemantics(a),m=go.getComponentCount(h);for(let l=0;l<m;l++){let u=this.getAttributeAsDbl(e,h,l);i.setEndAttribute(h,l,u)}}}}queryDerivative(t,e){Sg(this,t,e)}cutBezierIgnoreAttributes(t,e,s){(t<0||e>1||t>e)&&U("Cubic_bezier.cut_bezier_ignore_attributes");let n=k(y,4);this.queryControlPoints(n);let i=k(y,4);fn(n,t,e,i),s.setControlPoints(i)}splitBezierIgnoreAttributes(t,e,s){this===e&&this===s&&U("Cubic_bezier.split_bezier_ignore_attributes");let n=k(y,4);this.queryControlPoints(n);let i=k(y,4),o=k(y,4);yr(n,t,i,o),e&&e.setControlPoints(i),s&&s.setControlPoints(o)}getAttributeAsDbl(t,e,s){if(e===0)return s===0?this.getCoordX(t):this.getCoordY(t);if(t===0)return this.getStartAttributeAsDbl(e,s);if(t===1)return this.getEndAttributeAsDbl(e,s);let n=this.getStartAttributeAsDbl(e,s),i=this.getEndAttributeAsDbl(e,s),o=this.calculateLength2D(),a=o>0?this.tToLength(t)/o:0,h=go.getInterpolation(e);return Jn(h,n,i,a,go.getDefaultValue(e))}getClosestCoordinate(t,e){let s=[Number.NaN];return Mo(this,t,B.unit(),e,-1,1,s),s[0]}getClosestCoordinateOnInterval(t,e,s=-1){let n=[Number.NaN];return Mo(this,t,e,!1,s,1,n)===0?Number.NaN:n[0]}getYMonotonicParts(t,e=!1){return this.getMonotonicParts(t,e)}getMonotonicParts(t,e){t.length<2&&U("");let s=xr(this);if(s.specialPointsCount()===2&&this.isMonotoneQuickAndDirty())return 0;let n=0;w(t.length>=s.specialPointsCount()-1);for(let i=1,o=s.specialPointsCount();i<o;++i)this.queryCut(s.specialPoints[i-1],s.specialPoints[i],t[n],e),n++;for(let i=0;i<n;++i)No(t[i].get());return n}intersectionWithAxis2D(t,e,s,n){let i=k(y,4);return this.queryControlPoints(i),af(i,t,e,s,n)}intersectionOfYMonotonicWithAxisX(t,e){if(this.m_YStart===this.m_YEnd)return t===this.m_YStart?e:Number.NaN;if(t===this.m_YStart)return this.m_XStart;if(t===this.m_YEnd)return this.m_XEnd;let s=[0,0],n=this.intersectionWithAxis2D(!0,t,s,null);return w(n!==2),n===-1?e:s[0]}isCurve(){return!0}isDegenerate(t){return Fo(this,t)}isDegenerate3D(t,e){return w(0),!1}queryLooseEnvelope(t){if(t.m_EnvelopeType===2)return t.setCoords({pt:this.getStartXY()}),t.mergeNe(this.m_cp[0]),t.mergeNe(this.m_cp[1]),void t.mergeNe(this.getEndXY());w(0)}clone(t){let e=this.createInstance();return this.copyTo(e),e}queryInterval(t,e){if(t===0){let s=V.constructEmpty();this.queryEnvelope(s);let n=B.constructEmpty();return e===0?s.queryIntervalX(n):s.queryIntervalY(n),n}return super.queryInterval(t,e)}queryLooseEnvelopeOnInterval(t,e){let s=k(y,4);this.queryControlPoints(s),fn(s,t.vmin,t.vmax,s),e.setFromPoints(s,4)}changeEndPoints2D(t,e){if(t.isEqual(this.m_XStart,this.m_YStart)&&e.isEqual(this.m_XEnd,this.m_YEnd))return;let s=this.m_cp[0].isEqual(this.m_XStart,this.m_YStart),n=this.m_cp[0].isEqual(this.m_XEnd,this.m_YEnd),i=this.m_cp[1].isEqual(this.m_XStart,this.m_YStart),o=this.m_cp[1].isEqual(this.m_XEnd,this.m_YEnd);this.setStartXY(t),this.setEndXY(e),s?this.m_cp[0].setCoordsPoint2D(t):n&&this.m_cp[0].setCoordsPoint2D(e),o?this.m_cp[1].setCoordsPoint2D(e):i&&this.m_cp[1].setCoordsPoint2D(t),this.normalizeAfterEndpointChange()}tToLength(t){return fr(this,t,!0)}lengthToT(t){return R0(this,t)}calculateWeightedAreaCentroid2D(t){let e=k(y,4);xg(this,e);let s=e[3],n=e[2],i=e[1],o=new y;o.x=(5*s.x*s.x*(7*n.y+16*i.y)+s.x*(-35*s.y*n.x+40*n.x*n.y-80*s.y*i.x+140*n.x*i.y+112*i.x*i.y)-2*(s.y*(20*n.x*n.x+70*n.x*i.x+56*i.x*i.x)-7*(4*n.x+5*i.x)*(-n.y*i.x+n.x*i.y)))/840,o.y=(-5*s.y*s.y*(7*n.x+16*i.x)+s.y*(5*s.x*(7*n.y+16*i.y)-4*(10*n.x*n.y+35*n.y*i.x+28*i.x*i.y))+2*(-7*(4*n.y+5*i.y)*(n.y*i.x-n.x*i.y)+s.x*(20*n.y*n.y+70*n.y*i.y+56*i.y*i.y)))/840;let a=vc(this);return o.x+=(e[0].x-t.x)*a,o.y+=(e[0].y-t.y)*a,o}calculateWeightedCentroid2D(){let t=new y;return this.isDegenerate(0)?(t.setCoords(0,0),t):k0(this)?(t.assign(this.getCoord2D(.5).mul(this.calculateLength2D())),t):(t.assign(H0(this,1)),t)}getControlPoint1(){return this.m_cp[0].clone()}setControlPoint1(t){this.m_cp[0].setCoordsPoint2D(t),this.afterCompletedModification()}getControlPoint2(){return this.m_cp[1].clone()}setControlPoint2(t){this.m_cp[1].setCoordsPoint2D(t),this.afterCompletedModification()}queryControlPoints(t){t[0].assign(this.getStartXY()),t[1].assign(this.m_cp[0]),t[2].assign(this.m_cp[1]),t[3].assign(this.getEndXY())}setControlPoints(t){for(let e=0;e<4;e++)t[e].isNAN()&&U("NAN control points in bezier are not supported");this.m_XStart=t[0].x,this.m_YStart=t[0].y,this.m_cp[0].setCoordsPoint2D(t[1]),this.m_cp[1].setCoordsPoint2D(t[2]),this.m_XEnd=t[3].x,this.m_YEnd=t[3].y,this.afterCompletedModification()}getTangent(t){let e=k(y,4);return this.queryControlPoints(e),Wh(e,t)}getDerivative(t){let e=k(y,4);return this.queryControlPoints(e),Se(e,1,t)}getCurvature(t){let e=Fn(this,1,t),s=Fn(this,2,t),n=e.sqrLength();return n===0?Number.NaN:(e.divThis(Math.sqrt(n)),e.crossProduct(s)/n)}isIntersectingPoint(t,e,s){if(s&&(t.equals(this.getStartXY())||t.equals(this.getEndXY())))return!1;let n=new V;if(this.queryLooseEnvelope(n),n.inflateCoords(e,e),!n.contains(t))return!1;let i=this.getClosestCoordinate(t,!1),o=new y;return this.queryCoord2D(i,o),y.distance(o,t)<=e}isIntersectingPoint3D(t,e,s,n,i=1){return w(0),!1}isMonotoneQuickAndDirty(){let t=k(y,4);return this.queryControlPoints(t),Z0(t)}getMonotonicPartParams(t,e){let s=xr(this),n=s.specialPointsCount();if(w(br.s_maxMonotonicPartParams>=n),!e)return s.specialPointsCount();t<n&&U("");for(let i=0;i<n;i++)e[i]=s.specialPoints[i];return n}normalizeAfterEndpointChange(){return!1}orientBottomUp(){if(this.m_YEnd<this.m_YStart||this.m_YEnd===this.m_YStart&&this.m_XEnd<this.m_XStart){this.m_XEnd=O(this.m_XStart,this.m_XStart=this.m_XEnd),this.m_YEnd=O(this.m_YStart,this.m_YStart=this.m_YEnd);for(let t=0,e=this.m_description.getTotalComponentCount()-2;t<e;t++)this.m_attributes[t+e]=O(this.m_attributes[t],this.m_attributes[t]=this.m_attributes[t+e]);this.m_cp[1]=O(this.m_cp[0],this.m_cp[0]=this.m_cp[1]),this.m_cachedValues=null}}findMinDeriv(){let t=new H;return Eg(this,t),t.value()}isLine(){return!1}isDegenerateToLineHelper(t){let e=this.getEndXY().sub(this.getStartXY()),s=e.length(),n=.1*t,i=this.getControlPoint1();i.subThis(this.getStartXY());let o=Math.abs(i.crossProduct(e))/s;return!(o>n)&&(i=this.getControlPoint2(),i.subThis(this.getStartXY()),o=Math.abs(i.crossProduct(e))/s,!(o>n))}copyIgnoreAttributes(t){let e=k(y,4);this.queryControlPoints(e),t.setControlPoints(e)}calculateArea2DHelper(){return vc(this)}absNorm(){return ef(this)}queryEnvelopeW(t,e){vg(this,t,e)}setSegmentFromCoords(t,e){nf(this,t,e)}writeInBufferStream(t,e){let s=new Float64Array(4);return this.writeInBuffer_(s),t.writeRangeFromArray(e,s.length,s,!0,1),e+s.length}writeInBuffer_(t){return t[0]=this.m_cp[0].x,t[1]=this.m_cp[0].y,t[2]=this.m_cp[1].x,t[3]=this.m_cp[1].y,4}readFromBufferStream(t,e){let s=new Float64Array(4);t.queryRange(e,s.length,s,!0,1),this.readFromBuffer_(s)}readFromBuffer_(t){this.m_cp=k(y,2),this.m_cp[0].x=t[0],this.m_cp[0].y=t[1],this.m_cp[1].x=t[2],this.m_cp[1].y=t[3],this.m_cachedValues=null}snapControlPoints(t){let e=k(y,4);this.queryControlPoints(e);let s=(o,a,h)=>{let m=!1;return y.sqrDistance(o,h)<=t&&(m=!o.equals(h),o.setCoordsPoint2D(h),y.sqrDistance(a,h)<=t&&(m||=!a.equals(h),a.setCoordsPoint2D(h))),m},n=s(e[1],e[2],e[0]),i=s(e[2],e[1],e[3]);return(n||i)&&this.setControlPoints(e),n||i}needsSnapControlPoints(t){if(!t)return!1;let e=k(y,4);this.queryControlPoints(e);let s=(o,a,h)=>{let m=!1;return y.sqrDistance(o,h)<=t&&(m=!o.equals(h),o.setCoordsPoint2D(h),y.sqrDistance(a,h)<=t&&(m||=!a.equals(h),a.setCoordsPoint2D(h))),m},n=s(e[1],e[2],e[0]),i=s(e[2],e[1],e[3]);return n||i}calculateSpecialPointsForCracking(t,e){return hf(this,t,e)}ensureXYMonotone(){return No(this)}setCoordsForIntersector(t,e,s){B0(this,t,e,s)}copyToImpl(t){let e=t;e.m_cp[0].assign(this.m_cp[0]),e.m_cp[1].assign(this.m_cp[1]),Cg(e,Sc(this))}reverseImpl(){this.m_cp[1]=O(this.m_cp[0],this.m_cp[0]=this.m_cp[1])}equalsImpl(t){let e=t;return!!this.m_cp[0].equals(e.m_cp[0])&&!!this.m_cp[1].equals(e.m_cp[1])}equalsImplTol(t,e){let s=t;return!!this.m_cp[0].isEqualPoint2D(s.m_cp[0],e)&&!!this.m_cp[1].isEqualPoint2D(s.m_cp[1],e)}swapImpl(t){let e=t;e.m_cp[0]=O(this.m_cp[0],this.m_cp[0]=e.m_cp[0]),e.m_cp[1]=O(this.m_cp[1],this.m_cp[1]=e.m_cp[1]),L0(this,e)}afterCompletedModification(){gh(this)}isIntersecting(t,e,s){return Hn(!1,this,t,e,s)!==0}intersect(t,e,s,n,i){return Pn(!1,this,t,e,s,n,i)}intersectPoint(t,e,s){return tf(this,t,e,s)}endPointModified(){gh(this)}clearEndPointModified(){}};Ge.type=N.enumBezier;var Oh=class{constructor(){this.length=Number.NaN,this.specialPoints=[]}specialPointsCount(){return this.specialPoints.length}};function fg(r){return X0(r.calculateUpperLength2D())}function X0(r){return 256*kt()*r}function k0(r){let t=y.distance(r.getStartXY(),r.getEndXY()),e=r.calculateUpperLength2D();return e-t<=8*Number.EPSILON*e}function xg(r,t,e=!1){t[1].setCoords(r.m_cp[0].x-r.getStartX(),r.m_cp[0].y-r.getStartY()),t[1].mulThis(3),t[2].setCoords(r.m_cp[1].x-r.m_cp[0].x,r.m_cp[1].y-r.m_cp[0].y),t[2].mulThis(3),t[3]=r.getEndXY().sub(r.getStartXY()),t[3].subThis(t[2]),t[2].subThis(t[1]),e?t[0].setCoords(0,0):t[0]=r.getStartXY()}function yg(r,t,e){let s=k(y,4);r.queryControlPoints(s),ym(s,t,e)}function Pg(r,t,e){let s=k(y,4);r.queryControlPoints(s),Pm(s,t,e)}function ym(r,t,e){let s=r[1].x;s-=r[0].x,s*=3;let n=r[2].x;n-=r[1].x,n*=3;let i=r[3].x;i-=r[0].x,i-=n,n-=s,t[3].setWithEps(i),t[2].setWithEps(n),t[1].setWithEps(s),e?t[0].set(0):t[0].set(r[0].x)}function Pm(r,t,e){let s=r[1].y;s-=r[0].y,s*=3;let n=r[2].y;n-=r[1].y,n*=3;let i=r[3].y;i-=r[0].y,i-=n,n-=s,t[3].setWithEps(i),t[2].setWithEps(n),t[1].setWithEps(s),e?t[0].set(0):t[0].set(r[0].y)}function ui(r,t,e=!1){let s=k(Dt,4);s[0].assignPoint2D(r[0]),s[1].assignPoint2D(r[1]),s[2].assignPoint2D(r[2]),s[3].assignPoint2D(r[3]),t[1].setCoords(s[1].x.sub(s[0].x),s[1].y.sub(s[0].y)),t[1].mulThis(J.constructInt32(3)),t[2].setCoords(s[2].x.sub(s[1].x),s[2].y.sub(s[1].y)),t[2].mulThis(J.constructInt32(3)),t[3]=s[3].sub(s[0]),t[3]=t[3].sub(t[2]),t[2]=t[2].sub(t[1]),e?t[0].setCoords(de,de):t[0]=s[0].clone()}function fr(r,t,e){if(e){if(t<0)return t;if(t>1)return t-1+fr(r,1,!1)}if(r.isDegenerate(0))return 0;let s=t===1,n=xr(r);if(s&&!Number.isNaN(n.length)&&!Number.isNaN(n.length))return n.length;let i=fg(r),o=i/r.calculateUpperLength2D(),a=0,h=0;for(let m=1,l=n.specialPointsCount();m<l;m++){let u=n.specialPoints[m];if(a+=mf(r,h,Math.min(t,u),o,i),t<=u)break;h=u}return s&&(n.length=a),a}function R0(r,t,e){let s=fr(r,1,!1);if(t<=0)return t;if(t>=s)return t-s+1;let n=[0];return xn(new $h(r,t),B.unit(),1,n)!==1&&j(""),n[0]}function H0(r,t,e){e===void 0&&(e=t,t=0);let s=new y;if(t<0||e>1)return s.setNAN(),s;if(t>e&&U("calculate_sub_weightedCentroid"),t===e||r.isDegenerate(0))return s.setCoords(0,0),s;let n=xr(r),i=fg(r),o=i/r.calculateUpperLength2D(),a=t,h=0;for(let m=1,l=n.specialPointsCount();m<l;m++)if(t<n.specialPoints[m]){h=m-1;break}s.setCoords(0,0);for(let m=h+1,l=n.specialPointsCount();m<l;m++){let u=Math.min(n.specialPoints[m],e),c=lf(r,a,u,o,i);if(s.addThis(c),a=u,e<=n.specialPoints[m])break}return s.add(r.getStartXY().mul(r.calculateLength2D()))}function xr(r){if(r.m_cachedValues)return r.m_cachedValues;let t=new Oh,e=k(H,8),s=k(y,4);r.queryControlPoints(s);let n=Ig(s,e);t.specialPoints=[];for(let i=0;i<n;i++)t.specialPoints.push(e[i].value());return Cg(r,t),t}function Sc(r){let t=null;return t=r.m_cachedValues,t}function Cg(r,t){r.m_cachedValues=t}function gh(r){r.m_cachedValues=null}function L0(r,t){t.m_cachedValues=O(r.m_cachedValues,r.m_cachedValues=t.m_cachedValues)}function B0(r,t,e,s){if(t.isEqual(r.m_XStart,r.m_YStart)&&e.isEqual(r.m_XEnd,r.m_YEnd))return;let n=!!s&&r.isMonotoneQuickAndDirty(),i=new ct,o=k(y,3);o[0].setCoords(r.m_XStart,r.m_YStart),o[2].setCoords(r.m_XEnd,r.m_YEnd);let a=new y;a.setSub(o[2],o[0]),a.leftPerpendicularThis(),o[1].setAdd(o[0],a);let h=k(y,3);h[0].setCoordsPoint2D(t),h[2].setCoordsPoint2D(e),a.setSub(h[2],h[0]),a.leftPerpendicularThis(),h[1].setAdd(h[0],a),i.setFromTwoTriangles(o,h)?i.transformPoints2D(r.m_cp,2,r.m_cp):(qt(t,e,1/3,r.m_cp[0]),qt(t,e,2/3,r.m_cp[1])),r.changeEndPoints2D(t,e),n&&No(r)}function U0(r,t,e,s,n){return{tmin:r,tmax:t,t:e,d:s,pt:n.clone()}}function z0(r,t,e,s){let n=Z(18,Number.NaN),i=k(y,4);r.queryControlPoints(i);let o=xn(new Ao(i,t),B.construct(e,s),18,n),a=new y;r.queryCoord2D(e,a);let h=e,m=y.distance(a,t),l=new y;r.queryCoord2D(s,l);let u=y.distance(l,t);u<m&&(m=u,h=s,a.assign(l));for(let c=0;c<o;c++){r.queryCoord2D(n[c],l);let g=y.distance(l,t);g<m&&(m=g,h=n[c],a.assign(l))}return U0(e,s,h,m,a)}function Eg(r,t){let e=k(H,4);yg(r,e,!0);let s=k(H,4);Pg(r,s,!0);let n=e[3].clone(),i=e[2].clone(),o=e[1].clone(),a=s[3].clone(),h=s[2].clone(),m=s[1].clone(),l=i.mulE(o).addE(h.mulE(m)).mul(4),u=i.mulE(i).mul(8).addE(n.mulE(o).mul(12)).addE(h.mulE(h).mul(8).addE(a.mulE(m).mul(12))),c=n.mulE(i).addE(a.mulE(h)).mul(36),g=n.mulE(n).addE(a.mulE(a)).mul(36),d=k(H,3),_=So(g,c,u,l,new B(0,1),!1,d);if(w(_<=3),_>0){let p=Fn(r,1,0).sqrLength(),f=Fn(r,1,1).sqrLength(),x=p;t.set(0),x<f&&(x=f,t.set(1));for(let C=0;C<_;C++){let P=Fn(r,1,d[C].value()).sqrLength();P<x&&(x=P,t=d[C])}}}function O0(r,t,e,s){if(t===1){let n=1-e,i=n*n,o=e*e,a=r[1].sub(r[0]),h=r[2].sub(r[1]),m=r[3].sub(r[2]),l=a.mul(i).add(h.mul(2*n*e)).add(m.mul(o));s.assign(l.mul(3))}else if(t===2){let n=1-e,i=r[2].sub(r[1]).sub(r[1].sub(r[0])),o=r[3].sub(r[2]).sub(r[2].sub(r[1])),a=i.mul(n).add(o.mul(e));s.assign(a.mul(6))}else if(t===3){let n=r[2].sub(r[1]),i=r[3].sub(n.mul(3)).sub(r[0]);s.assign(i.mul(6))}else s.setCoords(0,0)}function W0(r,t,e,s){{let n=Kn.subE(e),i=n.sqr(),o=e.sqr(),a=r[1].subE(r[0]).mulE(i).addE(r[2].subE(r[1]).mulE(new H(2).mulE(n).mulE(e))).addE(r[3].subE(r[2]).mulE(o));s.setE(a.mulE(new H(3)))}}function Se(r,t,e){let s=new y;return O0(r,t,e,s),s}function j0(r,t,e){let s=[$.constructPoint2D(r[0]),$.constructPoint2D(r[1]),$.constructPoint2D(r[2]),$.constructPoint2D(r[3])],n=new $;return W0(s,t,e,n),n}function Fn(r,t,e){let s=k(y,4);return r.queryControlPoints(s),Se(s,t,e)}function vc(r){let t=r.m_cp[0].sub(r.getStartXY()),e=r.m_cp[1].sub(r.m_cp[0]),s=r.getEndXY().sub(r.getStartXY());return t.mulThis(3),e.mulThis(3),s.subThis(e),e.subThis(t),(3*s.x*(2*e.y+5*t.y)-3*s.y*(2*e.x+5*t.x)+10*(e.x*t.y-e.y*t.x))/60}function No(r){let t=k(y,4);r.queryControlPoints(t);let e=Xo(t);return e&&(r.m_cp[0].setCoordsPoint2D(t[1]),r.m_cp[1].setCoordsPoint2D(t[2]),r.afterCompletedModification()),e}function Xo(r){let t=!1;for(let e=0;e<2;e++){let s=At(r[0][e],r[3][e]);s>0?(At(r[0][e],r[1][e])<0&&(r[1][e]=r[0][e],t=!0),At(r[1][e],r[3][e])<0&&(r[1][e]=r[3][e],t=!0),At(r[0][e],r[2][e])<0&&(r[2][e]=r[0][e],t=!0),At(r[2][e],r[3][e])<0&&(r[2][e]=r[3][e],t=!0),At(r[1][e],r[2][e])<0&&(r[2][e]=r[1][e],t=!0)):s<0?(At(r[0][e],r[1][e])>0&&(r[1][e]=r[0][e],t=!0),At(r[1][e],r[3][e])>0&&(r[1][e]=r[3][e],t=!0),At(r[0][e],r[2][e])>0&&(r[2][e]=r[0][e],t=!0),At(r[2][e],r[3][e])>0&&(r[2][e]=r[3][e],t=!0),At(r[1][e],r[2][e])>0&&(r[2][e]=r[1][e],t=!0)):r[1][e]===r[0][e]&&r[2][e]===r[0][e]||(r[1][e]=r[0][e],r[2][e]=r[0][e],t=!0)}return t}function Z0(r){let t=At(r[0].y,r[1].y),e=At(r[1].y,r[2].y),s=At(r[2].y,r[3].y);if(t>=0&&e>=0&&s>=0||t<=0&&e<=0&&s<=0){let n=At(r[0].x,r[1].x),i=At(r[1].x,r[2].x),o=At(r[2].x,r[3].x);if(n>=0&&i>=0&&o>=0||n<=0&&i<=0&&o<=0)return!0}return!1}function _o(r,t,e){let s=new y,n=new y,i=new y,o=new y,a=new y;t<=.5?(Ut(2,r[0],r[1],t,s),Ut(2,r[1],r[2],t,n),Ut(2,r[2],r[3],t,i),Ut(2,s,n,t,o),Ut(2,n,i,t,a),Ut(2,o,a,t,e)):(zt(2,r[0],r[1],t,s),zt(2,r[1],r[2],t,n),zt(2,r[2],r[3],t,i),zt(2,s,n,t,o),zt(2,n,i,t,a),zt(2,o,a,t,e))}function yr(r,t,e,s){w(t>=0&&t<=1);let n=new y,i=new y,o=new y,a=new y,h=new y,m=new y;t<=.5?(Ut(2,r[0],r[1],t,n),Ut(2,r[1],r[2],t,i),Ut(2,r[2],r[3],t,o),Ut(2,n,i,t,a),Ut(2,i,o,t,h),Ut(2,a,h,t,m)):(zt(2,r[0],r[1],t,n),zt(2,r[1],r[2],t,i),zt(2,r[2],r[3],t,o),zt(2,n,i,t,a),zt(2,i,o,t,h),zt(2,a,h,t,m));let l=r[3].clone();e&&(e[0].assign(r[0]),e[1].assign(n),e[2].assign(a),e[3].assign(m)),s&&(s[0].assign(m),s[1].assign(h),s[2].assign(o),s[3].assign(l))}function fn(r,t,e,s){if(w(t>=0&&e<=1&&t<=e),t===e){let i=new y;return Gt(r,t,i),s[0].assign(i),s[1].assign(i),s[2].assign(i),void s[3].assign(i)}if(t===0&&e===1){for(let i=0;i<4;++i)s[i].assign(r[i]);return}let n=k(y,4);yr(r,e,n,null),yr(n,e>0?t/e:0,null,n),Gt(r,t,n[0]),Gt(r,e,n[3]),s[0].setCoordsPoint2D(n[0]),s[1].setCoordsPoint2D(n[1]),s[2].setCoordsPoint2D(n[2]),s[3].setCoordsPoint2D(n[3])}function Gt(r,t,e,s){if(s){if(t<0)return void Re(new nt({start:r[0],end:r[0].add(Wh(r,0).getUnitVector())}),t,e);if(t>1)return void Re(new nt({start:r[3],end:r[3].add(Wh(r,1).getUnitVector())}),t-1,e)}if(t<=.5){let n=new y;Ut(2,r[0],r[1],t,n);let i=new y;Ut(2,r[1],r[2],t,i);let o=new y;Ut(2,r[2],r[3],t,o);let a=new y;Ut(2,n,i,t,a);let h=new y;Ut(2,i,o,t,h),Ut(2,a,h,t,e)}else{let n=new y;zt(2,r[0],r[1],t,n);let i=new y;zt(2,r[1],r[2],t,i);let o=new y;zt(2,r[2],r[3],t,o);let a=new y;zt(2,n,i,t,a);let h=new y;zt(2,i,o,t,h),zt(2,a,h,t,e)}}function Q0(r,t,e){if(t.value()<=.5){let s=new $;ze(2,$.constructPoint2D(r[0]),$.constructPoint2D(r[1]),t,s);let n=new $;ze(2,$.constructPoint2D(r[1]),$.constructPoint2D(r[2]),t,n);let i=new $;ze(2,$.constructPoint2D(r[2]),$.constructPoint2D(r[3]),t,i);let o=new $;ze(2,s,n,t,o);let a=new $;ze(2,n,i,t,a),ze(2,o,a,t,e)}else{let s=new $;Oe(2,$.constructPoint2D(r[0]),$.constructPoint2D(r[1]),t,s);let n=new $;Oe(2,$.constructPoint2D(r[1]),$.constructPoint2D(r[2]),t,n);let i=new $;Oe(2,$.constructPoint2D(r[2]),$.constructPoint2D(r[3]),t,i);let o=new $;Oe(2,s,n,t,o);let a=new $;Oe(2,n,i,t,a),Oe(2,o,a,t,e)}}function K0(r,t,e){let s=k(y,4);r.queryControlPoints(s),Q0(s,t,e)}function Wh(r,t){let e=Tt(t,0,1),s=Se(r,1,e);return s.isZero()&&(s=Se(r,2,e),s.isZero()?s=Se(r,3,e):e===1&&s.negateThis()),s}function Sg(r,t,e){let s=k(y,4);r.queryControlPoints(s),$0(s,t,e)}function $0(r,t,e){t.value()<0&&t.set(0,t.eps()),t.value()>1&&t.set(1,t.eps()),e.setE(j0(r,1,t))}function Ic(r,t,e,s,n){if(n){if(Ve(t,e)!==0)return r?4:2}else if(Ze(t,e))return 1;return Pr(r,t,e,null,null,null,s,n!==void 0&&n,!0,!1)!==0?4:0}function bc(r,t,e,s,n){if(n){if(Ve(t,e)!==0)return r?4:2}else if(Ze(t,e))return 1;return jh(r,t,e,null,null,null,s,n!==void 0&&n,!0,!1)!==0?4:0}function J0(r,t,e,s,n){if(n){if(Ve(t,e)!==0)return 2}else if(Ze(t,e))return 1;return Cm(r,t,e,null,null,null,s,n!==void 0&&n,!0,!1)!==0?4:0}function wc(r,t,e,s,n){if(n){if(Ve(t,e)!==0)return r?4:2}else if(Ze(t,e))return 1;return Zh(r,t,e,null,null,null,s,n!==void 0&&n,!0,!1)!==0?4:0}function Dc(r,t,e,s,n){if(n){if(Ve(t,e)!==0)return r?4:2}else if(Ze(t,e))return 1;return Qh(r,t,e,null,null,null,s,n??!1,!0,!1)!==0?4:0}function Pr(r,t,e,s,n,i,o,a,h,m){if(n!==null&&(n.length=0),i!=null&&(i.length=0),s!==null&&(s.length=0),e.isDegenerate(0)){let D=[0,0,0],b=t.intersectPoint(e.getStartXY(),D,o);if(b>0){if(n!==null)for(let T=0;T<b;T++)n.push(D[T]);if(i!==null)for(let T=0;T<b;T++)i.push(0);if(s!=null)for(let T=0;T<b;T++){let A=new y;t.queryCoord2D(D[T],A),s.push(A)}}return b}let l=Fe(t,e);if(Qe(t,e,o=Math.max(o,l)))return 0;let u=k(y,4);xg(t,u);let c=e.getEndXY();c.subThis(e.getStartXY());let g=c.clone();g.leftPerpendicularThis();let d=3*u[3].dotProduct(g),_=2*u[2].dotProduct(g),p=u[1].dotProduct(g),f=Z(15,Number.NaN),x=Z(15,Number.NaN),C=Yn(d,_,p,B.unit(),!1,f);C<0&&(f[0]=0,f[1]=1,C=2);let P,E=0;for(let D=0,b=E;D<C;++D){let T=t.getCoord2D(f[D+b]);x[E]=e.getClosestCoordinate(T,!1),y.distance(T,e.getCoord2D(x[E]))<=o&&(f[E]=f[D+b],E++)}if(u[0].subThis(e.getStartXY()),Math.abs(c.x)>=Math.abs(c.y)){let D=c.y/c.x;d=u[3].y-u[3].x*D,_=u[2].y-u[2].x*D,p=u[1].y-u[1].x*D,P=u[0].y-u[0].x*D}else{let D=c.x/c.y;d=u[3].x-u[3].y*D,_=u[2].x-u[2].y*D,p=u[1].x-u[1].y*D,P=u[0].x-u[0].y*D}let S=t.getEndXY().equals(e.getStartXY())||t.getEndXY().equals(e.getEndXY()),I=[0,0,0];C=Jc(d,_,p,P,B.unit(),S,I);for(let D=0,b=E;D<C;++D){f[D+b]=I[D];let T=t.getCoord2D(f[D+b]);x[E]=e.getClosestCoordinate(T,!1),y.distance(T,e.getCoord2D(x[E]))<=o&&(f[E]=f[D+b],E++)}C=t.intersectPoint(e.getStartXY(),I,o);for(let D=0;D<C;D++)f[E]=I[D],x[E++]=0;C=t.intersectPoint(e.getEndXY(),I,o);for(let D=0;D<C;D++)f[E]=I[D],x[E++]=1;return e.intersectPoint(t.getStartXY(),I,o)!==0&&(x[E]=I[0],f[E++]=0),e.intersectPoint(t.getEndXY(),I,o)!==0&&(x[E]=I[0],f[E++]=1),E===0?0:Ke(r,t,e,f,x,E,s,n,i,o,a,h,m)}function jh(r,t,e,s,n,i,o,a,h,m){if(wt(e))return Pr(r,t,new nt({start:e.getStartXY(),end:e.getEndXY()}),s,n,i,o,a,h,m);let l=Fe(t,e);if(Qe(t,e,o=Math.max(o,l)))return 0;let u=[],c=[],g=[],d=k(y,4);{t.queryControlPoints(d);let p=k(y,4),f=new ct;e.canonicToWorldTransformation(f);let x=new ct;x.setInvert(f),x.transformPoints2D(d,4,p);let C=k(Dt,4);ui(p,C);let P=[C[0].x,C[1].x,C[2].x,C[3].x],E=[C[0].y,C[1].y,C[2].y,C[3].y],S=k(J,3);S[0].setDouble(e.getSemiMinorAxis()),S[0].sqrThis(),S[1].setDouble(e.getSemiMajorAxis()),S[1].sqrThis(),S[2].setThis(S[0]),S[2].mulThis(S[1]),S[2].negateThis();let I=dm(P,3,E,3,null,0,S,!0,B.unit(),B.unit(),c);if(I>0){let D=0;for(let b=0;b<I;b++){let T=new y;t.queryCoord2D(c[b],T);let A=e.getClosestCoordinate(T,!1),G=new y;e.queryCoord2D(A,G),y.distance(T,G)<=o&&(u.push(T.clone()),c[D]=c[b],g.push(A),D++)}c.length=D,u.length=D}}let _=[0,1];for(let p=0;p<2;p++){let f=p===0?e.getStartXY():e.getEndXY(),x=[0];Rn(d,f,B.unit(),!1,-1,1,x);let C=new y;Gt(d,x[0],C),y.distance(f,C)<=o&&(c.push(x[0]),g.push(_[p]),u.push(C.clone()))}for(let p=0;p<2;p++){let f=[0,3];{let x=e.getClosestCoordinate(d[f[p]],!1),C=new y;e.queryCoord2D(x,C),y.distance(d[f[p]],C)<=o&&(c.push(_[p]),g.push(x),u.push(C.clone()))}}return Ke(r,t,e,c,g,c.length,s,n,i,o,a,h,m)}function Cm(r,t,e,s,n,i,o,a,h,m){let l=k(y,4);t.queryControlPoints(l);let u=k(y,4);if(e.queryControlPoints(u),lm(l,u,4)<0)return Cm(r,e,t,s,i,n,o,a,h,!m);let c=Fe(t,e);if(Qe(t,e,o=Math.max(o,c)))return 0;if(uf(t,e,s,n,i,o,a,h,m))return 2;let g=new B(0,1),d=new B(0,1);{let P=new me;Cr(l,new B(0,1),P);let E=new me;Cr(u,new B(0,1),E);let S=Math.max(P.maxDim(),E.maxDim());if(P.inflate(3*o),E.inflate(3*o),!P.intersectW(E))return 0;if(P.maxDim()<.1*S){if(Kh(l,P,g),Kh(u,P,d),g.isEmpty()||d.isEmpty())return 0;fn(l,g.vmin,g.vmax,l),fn(u,d.vmin,d.vmax,u)}}let _=fi(l,3,u,3,o);if(_===0)return 0;let p=[],f=[],x=[],C=!1;if(_===-1){let P=k(Dt,4);ui(l,P);let E=[P[0].x,P[1].x,P[2].x,P[3].x],S=[P[0].y,P[1].y,P[2].y,P[3].y],I=k(Dt,4);ui(u,I);let D=[],b=[],T=pi(E,3,S,3,null,0,[I[0].x,I[1].x,I[2].x,I[3].x],3,[I[0].y,I[1].y,I[2].y,I[3].y],3,null,0,!0,B.unit(),B.unit(),D,b);if(T>0)for(let A=0;A<T;A++){let G=new y;Gt(u,b[A],G);let F=new y;Gt(l,D[A],F),y.distance(F,G)<=o&&(p.push(F.clone()),x.push(b[A]),f.push(D[A]))}else T===-1&&(C=!0)}for(let P=0;P<2;P++){let E=P===0?l:u,S=P===0?u:l;for(let I=0;I<2;I++){let D=I===0?0:3,b=[0];Rn(S,E[D],B.unit(),!1,-1,1,b);let T=new y;Gt(S,b[0],T),y.distance(E[D],T)<=o&&(P===0?(f.push(D===0?0:1),x.push(b[0])):(x.push(D===0?0:1),f.push(b[0])),p.push(T.clone()))}}if(f.length===0&&C){let P=t.calculateUpperLength2D()>e.calculateUpperLength2D();{let E=[0,0];if(rf(P?t:e,E,!0)===2&&(w(B.unit().containsCoordinate(E[0])),!B.unit().containsCoordinate(E[1]))){let S=new y;Gt(P?l:u,E[0],S);let I=[0,0];Rn(P?u:l,S,B.unit(),!1,-1,2,I)===1&&(p.push(S.clone()),f.push(P?E[0]:I[0]),x.push(P?I[0]:E[0]))}}}if(f.length===0)return 0;if(!g.equalsRange(0,1))for(let P=0;P<f.length;++P)f[P]=Ge.recalculateParentT(g.vmin,g.vmax,f[P]);if(!d.equalsRange(0,1))for(let P=0;P<x.length;++P)x[P]=Ge.recalculateParentT(d.vmin,d.vmax,x[P]);return Ke(r,t,e,f,x,f.length,s,n,i,o,a,h,m)}function Zh(r,t,e,s,n,i,o,a,h,m){let l=Fe(t,e);if(e.isDegenerateToLineHelper(l)){let E=new nt({start:e.getStartXY(),end:e.getEndXY()}),S=Pr(r,t,E,s,n,i,o,a,h,m);if(i)for(let I=0;I<S;++I){let D=E.getCoord2D(i[I]);i[I]=e.getClosestCoordinate(D,!1)}return S}if(Qe(t,e,o=Math.max(o,l)))return 0;let u=k(y,4);t.queryControlPoints(u);let c=k(y,3);e.queryControlPoints(c);let g=new B(0,1),d=new B(0,1),_=[0,0,0];e.queryWeights(_);let p=[1,ms(_),1];{let E=new me;Cr(u,new B(0,1),E);let S=new me;mr(c,p,new B(0,1),S);let I=Math.max(E.maxDim(),S.maxDim());if(E.inflate(3*o),S.inflate(3*o),!E.intersectW(S))return 0;if(E.maxDim()<.1*I){if(Kh(u,E,g),Yh(c,p,E,d),g.isEmpty()||d.isEmpty())return 0;fn(u,g.vmin,g.vmax,u),$s(c,p,d.vmin,d.vmax,c,p)}}let f=fi(u,3,c,2,o);if(f===0)return 0;let x=[],C=[],P=[];if(f===-1){let E=k(Dt,4);ui(u,E);let S=[E[0].x,E[1].x,E[2].x,E[3].x],I=[E[0].y,E[1].y,E[2].y,E[3].y],D=k(J,3),b=k(J,3),T=k(J,3);ur(c,p,D,b,T);let A=[],G=[],F=pi(D,2,b,2,T,2,S,3,I,3,null,0,!0,B.unit(),B.unit(),G,A);if(F>0)for(let M=0;M<F;M++){let q=new y;Gt(u,A[M],q);let R=new y;Xt(c,p,G[M],R),y.distance(q,R)<=o&&(x.push(q.clone()),C.push(A[M]),P.push(G[M]))}}for(let E=0;E<2;E++){let S,I;E===0?(S=u,I=c):(I=u,S=c);for(let D=0;D<2;D++){let b=D===0?0:S.length-1,T=[0],A=new y;if(E===0){let G=_m(I,p,S[b],B.unit(),!1,-1,1,T);w(G===1),Xt(I,p,T[0],A)}else{let G=Rn(I,S[b],B.unit(),!1,-1,1,T);w(G===1),Gt(I,T[0],A)}y.distance(S[b],A)<=o&&(E===0?(C.push(b===0?0:1),P.push(T[0])):(P.push(b===0?0:1),C.push(T[0])),x.push(A.clone()))}}if(C.length===0)return 0;if(!g.equalsRange(0,1))for(let E=0;E<C.length;++E)C[E]=Ge.recalculateParentT(g.vmin,g.vmax,C[E]);if(!d.equalsRange(0,1))for(let E=0;E<P.length;++E)P[E]=_e.recalculateParentT(d.vmin,d.vmax,P[E]);for(let E=0;E<P.length;++E)P[E]=mi(_,P[E]);return Ke(r,t,e,C,P,C.length,s,n,i,o,a,h,m)}function Qh(r,t,e,s,n,i,o,a,h,m){let l=Fe(t,e);if(Qe(t,e,o=Math.max(o,l)))return 0;let u=k(y,4);t.queryControlPoints(u);let c=k(y,3);e.queryControlPoints(c);let g=fi(u,3,c,2,o);if(g===0)return 0;let d=[],_=[],p=[];if(g===-1){let f=k(Dt,4);ui(u,f);let x=[f[0].x,f[1].x,f[2].x,f[3].x],C=[f[0].y,f[1].y,f[2].y,f[3].y],P=k(Dt,3);li(c,P);let E=pi([P[0].x,P[1].x,P[2].x],2,[P[0].y,P[1].y,P[2].y],2,null,0,x,3,C,3,null,0,!0,B.unit(),B.unit(),p,_);if(E>0){let S=0;for(let I=0;I<E;I++){let D=new y;t.queryCoord2D(_[I],D);let b=new y;e.queryCoord2D(p[I],b),y.distance(D,b)<=o&&(d.push(D.clone()),_[S]=_[I],p[S]=p[I],S++)}_.length=S,d.length=S}}for(let f=0;f<2;f++){let x,C;f===0?(x=u,C=c):(C=u,x=c);for(let P=0;P<2;P++){let E=P===0?0:x.length-1,S=[0],I=new y;if(f===0)Yo(C,x[E],S),He(C,S[0],I);else{let D=Rn(C,x[E],B.unit(),!1,-1,1,S);w(D===1),Gt(C,S[0],I)}y.distance(x[E],I)<=o&&(f===0?(_.push(E===0?0:1),p.push(S[0])):(p.push(E===0?0:1),_.push(S[0])),d.push(I.clone()))}}return Ke(r,t,e,_,p,_.length,s,n,i,o,a,h,m)}function tf(r,t,e,s,n){let i=new me;if(vg(r,B.unit(),i),i.inflate(s),!i.isIntersectingPoint2D(t))return 0;let o=xr(r),a=0,h=o.specialPoints[0],m=[];for(let l=1,u=o.specialPoints.length;l<u;++l){let c=o.specialPoints[l],g=z0(r,t,h,c);if(m.length===0)m.push(g);else if(g.t===g.tmin)w(m.at(-1).d<=g.d),m.at(-1).tmax=g.tmax;else if(m.at(-1).t===m.at(-1).tmax){w(m.at(-1).d>=g.d);let d=m.at(-1).tmin;m[m.length-1]=g,m.at(-1).tmin=d}else m.push(g);h=c}for(let l of m)if(l.d<=s){let u=l.t;e&&(a>=e.length&&xt(""),e[a]=u),a++}return a}function vg(r,t,e){let s=k(y,4);r.queryControlPoints(s),Cr(s,t,e)}function Cr(r,t,e){if(t.equalsRange(0,1))return void e.setFromPoints(r,4);let s=k(y,4);fn(r,t.vmin,t.vmax,s),e.setFromPoints(s,4)}var Ao=class{constructor(t,e){this.controlPoints=t,this.point=e.clone()}getMaxDerivative(){return 6}getValue(t,e){switch(t){case 0:{let s=new y;Gt(this.controlPoints,e,s);let n=Se(this.controlPoints,1,e);return 2*s.sub(this.point).dotProduct(n)}case 1:{let s=new y;Gt(this.controlPoints,e,s);let n=Se(this.controlPoints,1,e),i=Se(this.controlPoints,2,e);return 2*(s.sub(this.point).dotProduct(i)+n.dotProduct(n))}case 2:{let s=new y;Gt(this.controlPoints,e,s);let n=Se(this.controlPoints,1,e),i=Se(this.controlPoints,2,e),o=Se(this.controlPoints,3,e);return 2*(s.sub(this.point).dotProduct(o)+3*n.dotProduct(i))}case 3:{let s=Se(this.controlPoints,1,e),n=Se(this.controlPoints,2,e),i=Se(this.controlPoints,3,e);return 2*(4*s.dotProduct(i)+3*n.sqrLength())}case 4:{let s=Se(this.controlPoints,2,e),n=Se(this.controlPoints,3,e);return 2*(10*s.dotProduct(n))}case 5:{let s=Se(this.controlPoints,3,e);return 2*(10*s.dotProduct(s))}default:return 0}}getError(t){return 0}};function Rn(r,t,e,s,n,i,o){Qn(B.unit().contains(e)&&i>0,"getClosestCoordinate"),(n<0||Number.isNaN(n))&&(n=Number.MAX_VALUE);let a=[],h=new y;Gt(r,e.vmin,h);let m=y.distance(h,t);if(m<=n&&a.push(new y(e.vmin,m)),e.vmin!==e.vmax&&(Gt(r,e.vmax,h),m=y.distance(h,t),m<=n&&a.push(new y(e.vmax,m))),e.width()>0){let c=Z(18,Number.NaN),g=xn(new Ao(r,t),e,18,c);for(let d=0;d<g;d++)Gt(r,c[d],h),m=y.distance(h,t),m>n||a.push(new y(c[d],m))}if(s){w(e.equals(B.unit()));{Gt(r,-1,h,!0);let c=new y;Gt(r,0,c);let g=new nt({start:h,end:c}),d=g.getClosestCoordinate(t,!0);d<1&&(h.assign(g.getCoord2D(d)),m=y.distance(h,t),m<=n&&a.push(new y(d-1,m)))}{Gt(r,2,h,!0);let c=new y;Gt(r,e.vmax,c);let g=new nt({start:c,end:h}),d=g.getClosestCoordinate(t,!0);d>0&&(h.assign(g.getCoord2D(d)),m=y.distance(h,t),m<=n&&a.push(new y(1+d,m)))}}if(!a.length)return 0;a.sort((c,g)=>c.compare(g));let l=0,u=a[0].x;if(o[l++]=u,l<i){let c=rh(r,4,!1).total(),g=a[0].y;for(let d=1,_=a.length;d<_;d++)if(a[d].y>g+c){a.length=d;break}a.sort((d,_)=>_s(d.x,_.x)),l=0,o[l++]=a[0].x;for(let d=1,_=a.length;d<_;d++)a[d].x!==o[l-1]&&l<i&&(o[l++]=a[d].x)}return l}function Mo(r,t,e,s,n,i,o){let a=k(y,4);return r.queryControlPoints(a),Rn(a,t,e,s,n,i,o)}function ef(r){return r.getStartXY().norm(1)+r.getEndXY().norm(1)+r.m_cp[0].norm(1)+r.m_cp[1].norm(1)}function sf(r){return r[0].norm(1)+r[1].norm(1)+r[2].norm(1)+r[3].norm(1)}function nf(r,t,e){if(w(e>=2),e===2){let d=new y;qt(t[0],t[e-1],1/3,d);let _=new y;return qt(t[0],t[e-1],2/3,_),void r.construct(t[0],d,_,t[e-1])}let s=t[0],n=t[e-1],i=[0,0],o=Mo(r,s,B.unit(),!1,Number.NaN,2,i),a=[0,0],h=Mo(r,n,B.unit(),!1,Number.NaN,2,a),m=[];for(let d=0;d<o;d++)for(let _=0;_<h;_++){let p=i[d],f=a[_],x=(S,I)=>{let D=Z(e-2,Number.NaN),b=()=>{let Y=0;for(let L=1,W=e-1;L<W;L++){Y+=y.distance(t[L-1],t[L]);let K=Y;D[L-1]=K}Y+=y.distance(t[e-2],t[e-1]);for(let L=1,W=e-1;L<W;L++)D[L-1]/=Y},T=!1,A=!1;{let Y=new et;p<=f?(r.queryCut(p,f,Y,!0),S.assign(Y.get().getControlPoint1()),I.assign(Y.get().getControlPoint2())):(r.queryCut(f,p,Y,!0),S.assign(Y.get().getControlPoint2()),I.assign(Y.get().getControlPoint1())),s.equals(S)&&(T=!0),n.equals(I)&&(A=!0)}b();let G=Number.MAX_VALUE,F=S.clone(),M=I.clone();for(let Y=0;Y<5;Y++)G=dh(!0,!1,s,F,M,n,T,A,D,e-2,t,e);for(let Y=0;Y<30;Y++){let L=F.clone();M.clone();let W=dh(!0,!0,s,F,M,n,T,A,D,e-2,t,e);if(G<=W&&L.equals(F)&&L.equals(M))break;G=W}b();let q=!1,R=Number.EPSILON,X=S.clone(),z=I.clone();for(let Y=0;Y<30;Y++){let L=X.clone();z.clone();let W=dh(q,!0,s,X,z,n,T,A,D,e-2,t,e);if(R<=W&&L.equals(X)&&L.equals(z))break;q=!0,R=W}return R<G?(S.assign(X),I.assign(z)):(S.assign(F),I.assign(M),R=G),R},C=new y,P=new y,E=[x(C,P),y.distance(s,C)+y.distance(C,P)+y.distance(P,n),C.x,C.y,P.x,P.y];m.splice(m.length,0,...E)}let l=m[0],u=m[1],c=0;for(let d=6;d<m.length;d+=6)m[d]<l&&(l=m[d],u=m[d+1],c=d);let g=c;for(let d=0;d<m.length;d+=6)d!==c&&m[d+1]<u&&Math.abs(l-m[d])<10*l&&(u=m[d+1],g=d);r.construct(s,new y(m[g+2],m[g+3]),new y(m[g+4],m[g+5]),n)}function rf(r,t,e=!1){let s=k(y,4);r.queryControlPoints(s);let n=k(Dt,4),i,o,a;ui(s,n,!0);let h=n[3].x.isZero(),m=n[3].y.isZero();if(h||m)if(h&&!m){if(n[2].x.isZero())return 0;i=n[1].x.div(n[2].x).negate(),o=n[2].y.div(n[3].y),a=n[1].y.div(n[3].y)}else{if(h||!m||n[2].y.isZero())return 0;i=n[1].y.div(n[2].y).negate(),o=n[2].x.div(n[3].x),a=n[1].x.div(n[3].x)}else{n[2].x.divThis(n[3].x),n[1].x.divThis(n[3].x),n[2].y.divThis(n[3].y),n[1].y.divThis(n[3].y);let g=n[2].x.sub(n[2].y);if(g.isZero())return 0;i=n[1].x.sub(n[1].y).div(g).negate(),o=n[2].x.clone(),a=n[1].x.clone()}if(!e&&i.abs().value()>2)return 0;let l=[0,0],u=r.getStartXY().equals(r.getEndXY()),c=Yn(1,-i.toDouble(),i.add(o).mul(i).add(a).toDouble(),B.unit(),u,l);if(c===0)return 0;if(l[0]>=0&&l[0]<=1){let g=i.toDouble()-l[0];if(e||g>=0&&g<=1)return t[0]=l[0],t[1]=g,t[0]>t[1]&&(t[1]=O(t[0],t[0]=t[1])),2}if(c===2&&l[1]>=0&&l[1]<=1){let g=i.toDouble()-l[1];if(e||g>=0&&g<=1)return t[0]=l[1],t[1]=g,t[0]>t[1]&&(t[1]=O(t[0],t[0]=t[1])),2}return 0}function of(r,t,e){let s=r[1].mulE(t[2]).subThisE(r[2].mulE(t[1])),n=r[1].mulE(t[3]).subThisE(r[3].mulE(t[1])).mulThis(3),i=r[2].mulE(t[3]).subThisE(r[3].mulE(t[2])).mulThis(3),o=k(H,2),a=Le(i,n,s,new B(0,1),!1,o);a<0&&(a=0);let h=0;for(let m=0;m<a;m++)bt(o[m].value(),0,1)||(e[h].setE(o[m]),h++);return h}function Ig(r,t){t[0].set(0);let e=1,s=k(H,4);ym(r,s,!0);let n=k(H,4);Pm(r,n,!0);{let i=s[3].mul(3),o=s[2].mul(2),a=s[1].clone(),h=k(H,2),m=Le(i,o,a,new B(0,1),!1,h);m<0&&(m=0);for(let l=0;l<m;l++)bt(h[l].value(),0,1)||(t[e]=h[l],e++)}{let i=n[3].mul(3),o=n[2].mul(2),a=n[1].clone(),h=k(H,2),m=Le(i,o,a,new B(0,1),!1,h);m<0&&(m=0);for(let l=0;l<m;l++)bt(h[l].value(),0,1)||(t[e]=h[l],e++)}if(e+=of(s,n,t.slice(e)),t[e].set(1),e++,e>2){os(t,0,e,(l,u)=>{let c=l.value(),g=u.value();return c<g?-1:c>g?1:0});let i=0,o=t[0].clone(),a=0,h=sf(r)*kt(),m=new y;_o(r,t[0].value(),m);for(let l=1;l<e;l++){let u=new y;if(_o(r,t[l].value(),u),t[l].eq(o)||u.isEqualPoint2D(m,h)){if(i!==0){if(t[l].eps()===0)o.setE(t[l]),a=0;else if(a!==0){let c=Et(1/t[l].eps()),g=1/a,d=c+g;o.set((t[l].value()*c+o.value()*g)/d),a=1/d,o.setError(Math.sqrt(a))}t[i].setE(o),_o(r,o.value(),m)}}else i++,t[i].setE(t[l]),o.setE(t[l]),_o(r,o.value(),m),a=Et(t[l].eps())}i++,e=i}return e===1&&(e=2,t[1].set(1)),w(t[0].value()===0),w(t[e-1].value()===1),e}function af(r,t,e,s,n){let i=k(H,4),o=k(H,3),a=new B(0,1),h=0;if(t){if(Pm(r,i,!1),h=So(i[3],i[2],i[1],i[0].sub(e),a,!1,o),s)for(let m=0;m<h;m++){let l=new y;Gt(r,o[m].value(),l),s[m]=l.x}}else if(ym(r,i,!1),h=So(i[3],i[2],i[1],i[0].sub(e),a,!1,o),s)for(let m=0;m<h;m++){let l=new y;Gt(r,o[m].value(),l),s[m]=l.y}if(n)for(let m=0;m<h;m++)n[m]=o[m].value();else s&&os(s,0,h,_s);return h}function Kh(r,t,e){e.setEmpty();let s=[];s.push(new B(0,1));let n=.5*Math.max(t.width(),t.height());for(;s.length;){let i=s.at(-1);s.pop();let o=new me;if(Cr(r,i,o),o.isIntersectingW(t)){let a=Math.max(o.width(),o.height());if(t.containsW(o)||a<=n||i.width()<1e-12)e.merge(i);else{let h=i.getCenter();s.push(B.construct(i.vmin,h)),s.push(B.construct(h,i.vmax))}}}}function hf(r,t,e){e.length=0;{let D=new H;Eg(r,D);let b=new $;if(Sg(r,D,b),b.isZero())return D.isZero()||D.eq(new H(1))?0:(e.push(D.value()),1)}let s=k(H,4);yg(r,s,!0);let n=k(H,4);Pg(r,n,!0);let i=k(H,6),o=s[3].negate().mulE(n[1]).addE(s[2].mulE(n[2]).mul(2)).addE(s[1].mulE(n[3])),a=s[3].negate().mulE(n[1]).subE(s[2].mulE(n[2]).mul(2)).addE(s[1].mulE(n[3])),h=s[2].mulE(s[2]).subE(n[2].mulE(n[2]));i[0]=n[1].mulE(n[1]).mulE(o).addE(s[1].mulE(s[1]).mulE(a)).addE(s[1].mulE(n[1]).mulE(h).mul(2)).mul(6),i[1]=s[2].mulE(n[1]).subE(s[1].mulE(n[2])).mulE(s[2].mulE(s[2]).addE(s[1].mulE(s[3]).mul(2)).addE(n[2].mulE(n[2])).addE(n[1].mulE(n[3]).mul(2))).mul(24);let m=s[1].mulE(n[2]).mulE(n[2]).mulE(n[3]),l=s[2].mulE(s[2]).mulE(s[3]).mulE(n[1]).subE(m).mul(156),u=s[3].mulE(n[1]).subE(s[1].mulE(n[3])),c=s[3].mulE(n[1]).subE(s[1].mulE(n[3])),g=s[1].mulE(s[3]).mulE(c).addE(n[1].mulE(n[3]).mulE(u)).mul(72),d=n[1].mulE(n[3]).subE(s[1].mulE(s[3])),_=s[2].mulE(n[2]).mulE(d).mul(120),p=s[1].mulE(s[2]).mulE(s[2]).mulE(n[3]),f=s[3].mulE(n[1]).mulE(n[2]).mulE(n[2]).subE(p).mul(36);i[2]=l.addE(g).addE(_).addE(f);let x=s[2].mulE(s[3]).mulE(s[3]).mulE(n[1]).subE(s[1].mulE(n[2]).mulE(n[3]).mulE(n[3])).mul(360),C=s[2].mulE(n[2]).mulE(s[2].mulE(s[3]).subE(n[2].mulE(n[3]))).addE(s[3].mulE(n[2]).mulE(n[2]).mulE(n[2])).subE(s[2].mulE(s[2]).mulE(s[2]).mulE(n[3])).mul(24),P=s[2].mulE(n[1]).mulE(n[3]).mulE(n[3]).subE(s[1].mulE(s[3]).mulE(s[3]).mulE(n[2])).mul(72),E=s[3].mulE(n[3]).mulE(n[1].mulE(n[2]).subE(s[1].mulE(s[2]))).mul(288);i[3]=x.addE(C).addE(P).addE(E),i[4]=n[3].mulE(n[3]).addE(s[3].mulE(s[3])).mulE(s[3].mulE(n[1]).subE(s[1].mulE(n[3]))).mul(270).addE(s[3].mulE(n[2]).subE(s[2].mulE(n[3]))).mulE(s[2].mulE(s[3]).addE(n[2].mulE(n[3]))).mul(180),i[5]=s[3].mulE(n[2]).subE(s[2].mulE(n[3])).mulE(s[3].mulE(s[3]).addE(n[3].mulE(n[3]))).mul(216);let S=k(H,5),I=tg(i,5,new B(0,1),!1,S,5);if(I>0){let D=Math.abs(r.getCurvature(0)),b=0,T=Math.abs(r.getCurvature(1));(T>D||!Number.isFinite(T))&&(b=1);for(let A=0;A<I;A++){let G=Math.abs(r.getCurvature(S[A].value()));r.getCoord2D(S[A].value()),(G>D||!Number.isFinite(G))&&(D=G,b=S[A].value())}if((!Number.isFinite(D)||1/D<t)&&!bt(b,0,1)){let A=r.getCoord2D(b);if(!A.equals(r.getStartXY())&&!A.equals(r.getEndXY()))return e.push(b),1}}return 0}var $h=class{constructor(t,e){this.b=t,this.len=e}getMaxDerivative(){return 1}getValue(t,e){return t===0?this.len-fr(this.b,e,!1):0}getError(t){return 0}};function Jh(r,t,e,s,n,i,o){for(;;){let a=y.distance(t[0],t[3]),h=y.distance(t[0],t[1])+y.distance(t[1],t[2])+y.distance(t[2],t[3]);if(h-a<=s+e*h)return r+pt(a,h,.5);let m=E=>Se(t,1,E).length();if(i===0){w(o<8);let E=m(0),S=m(1);n[0]+=2,E>S&&(S=O(E,E=S),t[3]=O(t[0],t[0]=t[3]),t[2]=O(t[1],t[1]=t[2]));let I=E/(E+S),D=1,b=h;for(;I<1/32&&b>=32*(s+e*b);){D/=4;let T=m(D);n[0]++,I=E/(T+E);let A=new y;if(Gt(t,.5*D,A),b=y.distance(A,t[0]),b<=s){let G=new y;Gt(t,D,G),b+=y.distance(G,A)}}if(D!==1){let T=k(y,4);yr(t,D,t,T),r=Jh(r,T,e,s,n,0,o+1),i++,o++;continue}}let l=8;n[0]+=l;let u=Hs(l,m,0,1),c=16;n[0]+=c;let g=Hs(c,m,0,1),d=Math.abs(u-g)>s+e*h;if(!d)return r+g;if(i<3){let E=k(y,4);yr(t,.5,t,E),r=Jh(r,E,e,s,n,i+1,o+1),i++,o++;continue}let _=32;n[0]+=_;let p=Hs(_,m,0,1);if(d=Math.abs(g-p)>s+e*h,!d)return r+p;let f=64;n[0]+=f;let x=Hs(f,m,0,1);if(d=Math.abs(p-x)>s+e*h,!d)return r+x;let C=128;n[0]+=C;let P=Hs(C,m,0,1);return d=Math.abs(x-P)>s+e*h,r+P}}function mf(r,t,e,s,n){if(e===t)return 0;let i=k(y,4);r.queryControlPoints(i);let o=k(y,4);return fn(i,t,e,o),Jh(0,o,s,n,[0],0,0)}function lf(r,t,e,s,n){let i=!0,o=hi(5,t,e,s,n,h=>{let m=Fn(r,1,h);return(i?r.getCoordX(h)-r.getStartX():r.getCoordY(h)-r.getStartY())*m.length()});i=!1;let a=hi(5,t,e,s,n,h=>{let m=Fn(r,1,h);return(i?r.getCoordX(h)-r.getStartX():r.getCoordY(h)-r.getStartY())*m.length()});return new y(o,a)}function uf(r,t,e,s,n,i,o,a,h){let m=k(y,4);r.queryControlPoints(m);let l=k(y,4);if(t.queryControlPoints(l),m[0].equals(l[0])){if(m[1].equals(l[1])&&m[2].equals(l[2])&&m[3].equals(l[3]))return e&&(e.length=0,e.push(m[0]),e.push(m[3])),s&&(s.length=0,s.push(0),s.push(1)),n&&(n.length=0,n.push(0),n.push(1)),!0;if(!m[0].equals(l[3]))return!1}return!!(m[0].equals(l[3])&&m[1].equals(l[2])&&m[2].equals(l[1])&&m[3].equals(l[0]))&&(s&&(s.length=0,s.push(0),s.push(1),h&&(s[1]=O(s[0],s[0]=s[1]))),n&&(n.length=0,n.push(1),n.push(0),h&&(n[1]=O(n[0],n[0]=n[1]))),e&&(e.length=0,e.push(m[0]),e.push(m[3]),h&&(e[1]=O(e[0],e[0]=e[1]))),!0)}function dh(r,t,e,s,n,i,o,a,h,m,l,u){let c=0,g=0,d=0,_=0,p=0,f=0,x=0;for(let P=1,E=u-1;P<E;P++){let S,I,D,b,T,A,G=-1,F=h[P-1];r&&(P>2?(F=Tt(2*h[P-2]-h[P-3],0,1),h[P-1]=F):P===2&&F<=h[0]&&(F=h[0]));for(let R=0;R<11&&(S=h[P-1],I=S*S,D=I*S,b=1-S,T=b*b,A=T*b,r)&&!(Math.abs(S-G)<1e-12)&&R!==10;R++){let X=e.x-2*s.x+n.x,z=e.x-3*s.x+3*n.x-i.x,Y=e.y-2*s.y+n.y,L=e.y-3*s.y+3*n.y-i.y,W=e.x-s.x-2*X*S+z*I,K=-l[P].x+e.x*A+S*(3*s.x*T+S*(3*n.x-3*n.x*S+i.x*S)),yt=e.y-s.y-2*Y*S+L*I,rt=-l[P].y+e.y*A+S*(3*s.y*T+S*(3*n.y-3*n.y*S+i.y*S));G=S;let Q=S- -6*(W*K+yt*rt)/(6*(3*Et(W)-(-2*X+2*z*S)*K)+6*(3*Et(yt)-(-2*Y+2*L*S)*rt));h[P-1]=Tt(Q,P>1?h[P-2]:0,1)}c+=3*I*T*T,g+=3*D*A,d+=3*I*I*T;let M=-(A*e.x+D*i.x-l[P].x);_+=M*S*T,p+=M*I*b;let q=-(A*e.y+D*i.y-l[P].y);f+=q*S*T,x+=q*I*b}if(t){let P=c*d-g*g;Math.abs(P)>=1e-12*(Math.abs(c*d)+Math.abs(g*g))+1e-10?(o||(s.x=(_*d-p*g)/P,s.y=(f*d-x*g)/P),a||(n.x=(c*p-g*_)/P,n.y=(c*x-g*f)/P)):(qt(e,i,.3,s),qt(e,i,.6,n))}let C=0;for(let P=1,E=u-1;P<E;P++){let S=h[P-1],I=1-S,D=e.mul(za(I)),b=s.mul(3*S*I*I),T=n.mul(3*S*S*I),A=i.mul(za(S));C+=D.add(b).add(T).add(A).sub(l[P]).sqrLength()}return C}function Tc(r,t,e,s){let n=r.getPathStart(t),i=r.getPathEnd(t);if(i-n<3)return;let o=2*n,a=y.getNAN();e.queryPoint2D(o,a);let h=a.x,m=a.y,l=y.getNAN();e.queryPoint2D(o+2,l);let u=y.getNAN();for(let c=o+4,g=2*i;c<g;c+=2)e.queryPoint2D(c,u),s.pe((u.x-a.x)*(l.y-m)),a.setCoordsPoint2D(l),l.setCoordsPoint2D(u);s.pe((h-a.x)*(l.y-m))}function cf(r,t,e){for(;t.hasNextSegment();){let s=t.nextCurve();if(s===null)break;e.pe(2*s.calculateArea2DHelper())}}var Pt=Ft,ws=class{static toSegType(t){let e=0;switch(t){case N.enumLine:e=1;break;case N.enumBezier:e=2;break;case N.enumEllipticArc:e=4;break;case N.enumRationalBezier2:e=8;break;case N.enumBezier2:e=16;break;default:j("")}return e}constructor(){this.m_segmentFlags=null,this.m_segmentParamIndex=null,this.m_segmentParams=null,this.m_curveCount=0,this.m_bezierCount=0,this.m_arcCount=0,this.m_rbezier2Count=0,this.m_bezier2Count=0,this.m_curveParamWritePoint=0}assignCopy(t){return this.m_segmentFlags=t.m_segmentFlags,this.m_segmentParamIndex=t.m_segmentParamIndex,this.m_segmentParams=t.m_segmentParams,this.m_curveCount=t.m_curveCount,this.m_bezierCount=t.m_bezierCount,this.m_arcCount=t.m_arcCount,this.m_rbezier2Count=t.m_rbezier2Count,this.m_bezier2Count=t.m_bezier2Count,this.m_curveParamWritePoint=t.m_curveParamWritePoint,this}},bg=(()=>{class r extends Po{constructor(e){super(e),this.m_cachedRingAreas2D=null,this.m_paths=null,this.m_pathFlags=null,this.m_curveData=null,e.move?(this.m_bPolygon=e.move.m_bPolygon,this.m_cachedLength2D=e.move.m_cachedLength2D,this.m_cachedArea2D=e.move.m_cachedArea2D,this.m_currentPathIndex=e.move.m_currentPathIndex,this.m_cachedRingAreas2D=e.move.m_cachedRingAreas2D,this.m_paths=e.move.m_paths,this.m_pathFlags=e.move.m_pathFlags,this.m_curveData=e.move.m_curveData,e.move.m_curveData=null,e.move.setEmpty()):(this.m_bPolygon=e.bPolygon,this.m_cachedLength2D=0,this.m_cachedArea2D=0,this.m_currentPathIndex=0)}getGeometryType(){return this.m_bPolygon?N.enumPolygon:N.enumPolyline}getDimension(){return this.m_bPolygon?2:1}changeRingStartPoint(e){w(this.m_bPolygon);let s=this.getPathIndexFromPointIndex(e),n=this.getPathStart(s);if(n===e)return;let i=this.getPathEnd(s);(e>=i||e<n)&&U("change_ring_start_point");for(let o=0,a=this.m_description.getAttributeCount();o<a;o++){let h=this.m_description.getSemantics(o),m=Pt.getComponentCount(h);this.m_vertexAttributes.get(o).rotate(n*m,e*m,i*m)}this.hasNonLinearSegments()&&(this.m_curveData.m_segmentFlags.rotate(n,e,i),this.m_curveData.m_segmentParamIndex.rotate(n,e,i))}setFillRule(e){this.m_bFillRule=e===1}getFillRule(){return this.m_bFillRule?1:0}isExteriorRingOGC(e){return!!this.m_bPolygon&&(this.updateOGCFlagsProtected(),!!(8&this.m_pathFlags.read(e)))}isExteriorRing(e){return this.calculateRingArea2D(e)>0}calculateRingArea2D(e){return this.m_bPolygon?(this.updateRingAreas2DProtected(),this.m_cachedRingAreas2D.read(e)):0}updateRingAreas2DProtected(){if(!this.hasDirtyFlag(1024))return;let e=this.getPathCount();if(e===0)return this.hasDirtyFlag(1024)&&(this.m_cachedArea2D=0),void this.setDirtyFlagProtected(1024,!1);let s=new Ui(e),n=new oe(0),i=new oe(0);if(this.m_pointCount!==0){let o=this.getAttributeStreamRef(0);if(this.hasNonLinearSegments()){let a=new nr({parent:this});for(a.stripAttributes();a.nextPath();){i.reset();let h=a.getPathIndex();Tc(this,h,o,i),cf(this,a,i);let m=.5*i.getResult();n.add(m),s.write(h,m)}}else for(let a=0;a<e;a++){i.reset(),Tc(this,a,o,i);let h=.5*i.getResult();n.add(h),s.write(a,h)}}this.hasDirtyFlag(1024)&&(this.m_cachedArea2D=n.getResult(),this.m_cachedRingAreas2D=s,this.setDirtyFlagProtected(1024,!1))}getOGCPolygonCount(){if(!this.m_bPolygon)return 0;this.updateOGCFlagsProtected();let e=0,s=this.getPathCount();for(let n=0;n<s;n++)8&this.m_pathFlags.read(n)&&e++;return e}getHashCodeImpl(){return w(0),0}equalsImpl(e){let s=e,n=this.getPathCount();if(n!==s.getPathCount())return!1;let i=this.hasNonLinearSegments();if(i!==s.hasNonLinearSegments()||i&&(this.m_curveData.m_curveCount!==s.m_curveData.m_curveCount||this.m_curveData.m_bezierCount!==s.m_curveData.m_bezierCount)||this.m_paths&&!this.m_paths.equals(s.m_paths,0,n+1)||this.m_bFillRule!==s.m_bFillRule||!this.m_bPolygon&&this.m_pathFlags&&!this.m_pathFlags.equals(s.m_pathFlags,0,n))return!1;if(this.hasNonLinearSegments()){if(!this.m_curveData.m_segmentFlags.equals(s.m_curveData.m_segmentFlags,0,this.getPointCount()))return!1;for(let o=0,a=this.getPointCount();o<a;o++){let h=this.m_curveData.m_segmentFlags.read(o);if(!r.isNonLinearSegmentFlag(h))continue;let m=this.m_curveData.m_segmentParamIndex.read(o),l=s.m_curveData.m_segmentParamIndex.read(o),u=Cs(h);for(let c=0;c<u;c++){let g=this.m_curveData.m_segmentParams.read(m+c),d=s.m_curveData.m_segmentParams.read(l+c);if(!Ne(g,d))return!1}}}return!0}equalsImplTol(e,s){let n=e,i=this.getPathCount();if(i!==n.getPathCount())return!1;let o=this.hasNonLinearSegments();if(o!==n.hasNonLinearSegments()||o&&(this.m_curveData.m_curveCount!==n.m_curveData.m_curveCount||this.m_curveData.m_bezierCount!==n.m_curveData.m_bezierCount)||this.m_paths&&!this.m_paths.equals(n.m_paths,0,i+1)||this.m_bFillRule!==n.m_bFillRule||!this.m_bPolygon&&this.m_pathFlags&&!this.m_pathFlags.equals(n.m_pathFlags,0,i))return!1;if(!o)return!0;if(!this.m_curveData.m_segmentFlags.equals(n.m_curveData.m_segmentFlags,0,this.getPointCount()))return!1;let a=this.querySegmentIterator(),h=n.querySegmentIterator();for(;a.nextPath();){if(!h.nextPath())return!1;for(;a.hasNextSegment();){let m=a.nextCurve(),l=h.nextCurve();if(!(m&&l&&m.equals(l,s))){if(!m&&!l)break;return!1}}}return!0}reserveImplImpl(e,s){this.m_curveData&&this.m_curveData.m_segmentFlags&&(this.m_curveData.m_segmentFlags.resize(e,1),this.m_curveData.m_segmentParamIndex.resize(e,-1),this.checkCompactSegmentParams())}verifyStreamsAfterSizeChangeExtraImpl(){this.m_paths||(this.m_paths=Ce(1,0),this.m_pathFlags=Zs(1,0)),this.m_curveData&&this.m_curveData.m_segmentFlags&&(this.m_curveData.m_segmentFlags.resize(this.m_reservedPointCount,1),this.m_curveData.m_segmentParamIndex.resize(this.m_reservedPointCount,-1),this.checkCompactSegmentParams())}copyToImpl(e,s){let n=e;n.m_bPathStarted=!1,n.m_bFillRule=this.m_bFillRule,this.m_paths?n.m_paths=s?this.m_paths:this.m_paths.clone():n.m_paths=null,this.m_pathFlags?n.m_pathFlags=s?this.m_pathFlags:this.m_pathFlags.clone():n.m_pathFlags=null,this.m_curveData&&(n.m_curveData||(n.m_curveData=new ws),n.m_curveData.assignCopy(this.m_curveData),n.m_curveData.m_curveCount=0,n.updateCurveCounter(this.m_curveData.m_curveCount),s||(this.m_curveData.m_segmentParamIndex?n.m_curveData.m_segmentParamIndex=this.m_curveData.m_segmentParamIndex.clone():n.m_curveData.m_segmentParamIndex=null,this.m_curveData.m_segmentFlags?n.m_curveData.m_segmentFlags=this.m_curveData.m_segmentFlags.clone():n.m_curveData.m_segmentFlags=null,this.m_curveData.m_segmentParams?n.m_curveData.m_segmentParams=this.m_curveData.m_segmentParams.clone():n.m_curveData.m_segmentParams=null)),n.hasDirtyFlag(512)||(n.m_cachedLength2D=this.m_cachedLength2D),n.m_cachedRingAreas2D=null,n.hasDirtyFlag(1024)||(n.m_cachedArea2D=this.m_cachedArea2D,this.m_cachedRingAreas2D!==null&&(n.m_cachedRingAreas2D=s?this.m_cachedRingAreas2D:this.m_cachedRingAreas2D.clone()))}calculateArea2D(){return this.m_bPolygon?(this.updateRingAreas2DProtected(),this.m_cachedArea2D):0}calculateLength2D(){if(!this.hasDirtyFlag(512))return this.m_cachedLength2D;let e=this.querySegmentIterator(),s=new oe(0);for(;e.nextPath();)for(;e.hasNextSegment();)s.add(e.nextSegment().calculateLength2D());return this.hasDirtyFlag(512)&&(this.m_cachedLength2D=s.getResult()),this.setDirtyFlagProtected(512,!1),s.getResult()}calculatePathLength2D(e){let s=this.querySegmentIteratorAtVertex(this.getPathStart(e)),n=new oe(0);for(;s.hasNextSegment();)n.add(s.nextSegment().calculateLength2D());return n.getResult()}calculateLength3D(e){return w(0),0}calculatePathLength3D(e,s){return w(0),0}copyTo(e){at(e.getGeometryType())||U(""),this!==e&&super.copyTo(e)}swap(e){w(0)}hasNonLinearSegments(){return this.getCurveCount()!==0}getSegmentCount(){let e=this.getPointCount();if(!this.m_bPolygon){e-=this.getPathCount();for(let s=0,n=this.getPathCount();s<n;s++)this.isClosedPath(s)&&e++}return e}getSegmentCountPath(e){let s=this.getPathSize(e);return!this.isClosedPath(e)&&s>0&&s--,s}add(e,s){this===e&&U("Multi_path_impl::add");for(let n=0,i=e.getPathCount();n<i;n++)this.addPath(e,n,!s)}addPath(e,s,n){this.insertPath(-1,e,s,n)}addPathPoint2D(e,s,n){this.insertPath2D(-1,e,0,s,n)}addPathMultiPoint(e,s,n,i){n<0&&(n=e.getPointCount()-s),this.insertPointsFromMultipoint(-1,0,e,s,n,i)}addSegmentsFromPath(e,s,n,i,o){if(this===e&&U("Multi_path_impl.add_segments_from_path"),o||this.getPathCount()!==0||(o=!0),s<0&&(s=e.getPathCount()-1),(s>=e.getPathCount()||n<0||i<0||n+i>e.getSegmentCountPath(s))&&xt("add_segments_from_path"),i===0)return;let a=e.getPathStart(s),h=e.isClosedPath(s)&&n+i===e.getSegmentCountPath(s);this.m_bPathStarted=!1,this.mergeVertexDescription(e.getDescription());let m=i,l=a+n,u=l+1;o&&(m++,u--),!o&&e.hasNonLinearSegments()&&e.m_curveData.m_segmentFlags.read(l)!==1&&(e.getXY(l).equals(this.getXY(this.m_pointCount-1))||U("add_segments_from_path: start point mismatch"));let c=this.m_pointCount;if(this.resizeImpl(this.m_pointCount+m),this.verifyAllStreamsAfterSizeChange(),o){if(m===0)return;this.m_paths.add(this.m_pointCount);let d=e.m_pathFlags.read(s);this.m_bPolygon&&(d|=1),this.m_pathFlags.write(this.m_pathFlags.size()-1,d),this.m_pathFlags.add(0)}else this.m_paths.write(this.m_pathFlags.size()-1,this.m_pointCount);let g=h?m-1:m;for(let d=0,_=this.m_description.getAttributeCount();d<_;d++){let p=this.m_description.getSemantics(d),f=Pt.getComponentCount(p),x=e.m_description.getAttributeIndex(p);if(g>0){if(x<0||!e.m_vertexAttributes.get(x)){let C=Pt.getDefaultValue(p);this.m_vertexAttributes.get(d).insertRange(f*c,C,g*f,f*c),h&&this.m_vertexAttributes.get(d).insertRange(f*c+g*f,C,f,f*c);continue}this.m_vertexAttributes.get(d).insertRangeFromStream(f*c,e.m_vertexAttributes.get(x),f*u,g*f,!0,f,f*c)}h&&this.m_vertexAttributes.get(d).insertRangeFromStream(f*(c+g),e.m_vertexAttributes.get(x),f*a,f,!0,f,f*(c+g))}if(this.hasNonLinearSegments()&&this.initSegmentData(0),e.hasNonLinearSegments()){let d=0;for(let _=0,p=l;_<i;_++)d+=Cs(e.m_curveData.m_segmentFlags.read(p)),p++;if(d>0){this.initSegmentData(d);let _=l,p=c-(o?0:1),f=0;for(let x=0;x<i;x++){let C=e.m_curveData.m_segmentFlags.read(_);if(this.m_curveData.m_segmentFlags.write(p,C),r.isNonLinearSegmentFlag(C)){f++;let P=e.m_curveData.m_segmentParamIndex.read(_),E=Cs(C);this.m_curveData.m_segmentParamIndex.write(p,this.m_curveData.m_curveParamWritePoint);for(let S=0;S<E;S++){let I=e.m_curveData.m_segmentParams.read(P);this.m_curveData.m_segmentParams.write(this.m_curveData.m_curveParamWritePoint,I),this.m_curveData.m_curveParamWritePoint++,P++}this.incCurveType(C,1)}else this.m_curveData.m_segmentParamIndex.write(p,-1);p++,_++}this.modifyCurveCounter(f)}}if(h){let d=this.getPathCount()-1,_=this.getPathStart(d),p=this.getPathEnd(d)-1,f=this.getXY(_),x=this.getXY(p);f.isEqualPoint2D(x)&&(--this.m_pointCount,this.m_paths.write(d+1,this.m_pointCount))}this.notifyModifiedFlags(2001)}reverseAllPaths(){for(let e=0,s=this.getPathCount();e<s;e++)this.reversePath(e)}reversePath(e){e>=this.getPathCount()&&U("");let s=this.getPathSize(e);if(s===0)return;let n=this.getPathStart(e),i=this.isClosedPath(e);if(this.hasNonLinearSegments()){let h=n,m=new this.m_segmentBufferCTor,l=!1;for(let u=0;u<s;u++,h++){let c=this.m_curveData.m_segmentFlags.read(h);if(!r.isNonLinearSegmentFlag(c))continue;l=!0,this.querySegment(h,m,!0),m.get().reverse();let g=this.m_curveData.m_segmentParamIndex.read(h);m.get().writeInBufferStream(this.m_curveData.m_segmentParams,g)}if(l){let u=i?0:1;this.m_curveData.m_segmentFlags.reverseRange(n,s-u,1),this.m_curveData.m_segmentParamIndex.reverseRange(n,s-u,1)}}let o=i?1:0;for(let h=0,m=this.m_description.getAttributeCount();h<m;h++)if(this.m_vertexAttributes.get(h)){let l=this.m_description.getSemantics(h),u=Pt.getComponentCount(l);this.m_vertexAttributes.get(h).reverseRange(u*(n+o),u*(s-o),u)}let a=6&this.m_pathFlags.read(e);if(a){let h=0;4&a&&(h|=2),2&a&&(h|=4),this.m_pathFlags.clearBits(e,6),this.m_pathFlags.setBits(e,h)}this.notifyModifiedFlags(1233)}removePath(e){let s=this.getPathCount();e<0&&(e=s-1),e>=s&&U("");let n=this.getPathStart(e),i=this.getPathSize(e);for(let o=0,a=this.m_description.getAttributeCount();o<a;o++)if(this.m_vertexAttributes.get(o)){let h=this.m_description.getSemantics(o),m=Pt.getComponentCount(h);this.m_vertexAttributes.get(o).eraseRange(m*n,m*i,m*this.m_pointCount)}if(this.hasNonLinearSegments()){let o=0;for(let a=n,h=n+i;a<h;a++){let m=this.m_curveData.m_segmentFlags.read(a);r.isNonLinearSegmentFlag(m)&&(this.incCurveType(m,-1),o++)}this.modifyCurveCounter(-o),this.m_curveData.m_segmentFlags.eraseRange(n,i,this.m_pointCount),this.m_curveData.m_segmentParamIndex.eraseRange(n,i,this.m_pointCount)}for(let o=e+1;o<=s;o++){let a=this.m_paths.read(o);this.m_paths.write(o-1,a-i)}if(this.m_pathFlags)for(let o=e+1;o<=s;o++){let a=this.m_pathFlags.read(o);this.m_pathFlags.write(o-1,a)}this.m_paths.resize(s),this.m_pathFlags.resize(s),this.m_pointCount-=i,this.m_reservedPointCount-=i,e===s-1&&(this.m_bPathStarted=!1),this.notifyModifiedFlags(2001),this.checkCompactSegmentParams(),this.dbgVerifyCurves()}dbgVerifyCurves(){}insertPath(e,s,n,i){this===s&&U("Multi_path_impl::insert_path");let o=this.getPathCount();if(!i&&s.hasNonLinearSegmentsPath(n))return e=this.insertPath(e,s,n,!0),this.reversePath(e),e;n>=s.getPathCount()&&U(""),e>o&&U(""),e<0&&(e=o),n<0&&(n=s.getPathCount()-1),this.m_bPathStarted=!1,this.mergeVertexDescription(s.getDescription());let a=s.getPathStart(n),h=s.getPathSize(n);if(h===0)return this.insertPath2D(e,null,0,0,!0);let m=this.m_pointCount,l=s.isClosedPath(n)&&!i?1:0;this.resizeImpl(this.m_pointCount+h),this.verifyAllStreamsAfterSizeChange();let u=e<o?this.getPathStart(e):m;for(let d=0,_=this.m_description.getAttributeCount();d<_;d++){let p=this.m_description.getSemantics(d),f=s.getDescription().getAttributeIndex(p),x=Pt.getComponentCount(p);if(f>=0&&s.m_vertexAttributes.get(f))l!==0&&this.m_vertexAttributes.get(d).insertRangeFromStream(u*x,s.m_vertexAttributes.get(f),x*a,x,!0,x,x*m),this.m_vertexAttributes.get(d).insertRangeFromStream((u+l)*x,s.m_vertexAttributes.get(f),x*(a+l),x*(h-l),i,x,x*(m+l));else{let C=Pt.getDefaultValue(p);this.m_vertexAttributes.get(d).insertRange(u*x,C,x*h,x*m)}}let c=m+h;this.m_paths.add(c);for(let d=o;d>=e+1;d--){let _=this.m_paths.read(d-1);this.m_paths.write(d,_+h)}this.m_pathFlags.add(0);for(let d=o-1;d>=e+1;d--){let _=this.m_pathFlags.read(d);_&=-9,this.m_pathFlags.write(d+1,_)}let g=s.getPathFlagsStreamRef().read(n);if(g&=-9,this.m_bPolygon&&(g|=1),this.m_pathFlags.write(e,g),s.hasNonLinearSegments()){this.initSegmentData(0);let d=a,_=0;for(let p=0;p<h;p++)_+=Cs(s.m_curveData.m_segmentFlags.read(d)),d++;if(_>0){this.m_curveData.m_segmentFlags===null?(this.m_curveData.m_segmentFlags=Zs(this.m_pointCount,1),this.m_curveData.m_segmentParamIndex=Ce(this.m_pointCount,-1)):(this.m_curveData.m_segmentFlags.insertRange(u,1,h,m),this.m_curveData.m_segmentParamIndex.insertRange(u,-1,h,m)),this.m_curveData.m_segmentParams?this.m_curveData.m_segmentParams.resize(this.m_curveData.m_curveParamWritePoint+_):this.m_curveData.m_segmentParams=mn(_),d=a;let p=u,f=0;for(let x=0;x<h;x++){let C=s.m_curveData.m_segmentFlags.read(d);if(r.isNonLinearSegmentFlag(C)){this.m_curveData.m_segmentFlags.write(p,C),this.m_curveData.m_segmentParamIndex.write(p,this.m_curveData.m_curveParamWritePoint);let P=Cs(C),E=s.m_curveData.m_segmentParamIndex.read(d);for(let S=0;S<P;S++){let I=s.m_curveData.m_segmentParams.read(E);this.m_curveData.m_segmentParams.write(this.m_curveData.m_curveParamWritePoint,I),this.m_curveData.m_curveParamWritePoint++,E++}f++,this.incCurveType(C,1)}d++,p++}this.modifyCurveCounter(f)}}return this.notifyModifiedFlags(2001),e}insertPath2D(e,s,n,i,o){let a=this.getPathCount();(e>a||n<0)&&U(""),e<0&&(e=a),this.m_bPathStarted=!1;let h=this.m_pointCount;this.resizeImpl(this.m_pointCount+i),i===0&&this.notifyModifiedFlags(32),this.verifyAllStreamsAfterSizeChange();let m=e<a?this.getPathStart(e):h;if(s)this.m_vertexAttributes.get(0).insertRangeFromPoints(2*m,s,n,i,o,2*h);else{let l=Pt.getDefaultValue(0);this.m_vertexAttributes.get(0).insertRange(2*m,l,2*i,2*h)}for(let l=1,u=this.m_description.getAttributeCount();l<u;l++){let c=this.m_description.getSemantics(l),g=Pt.getComponentCount(c),d=Pt.getDefaultValue(c);this.m_vertexAttributes.get(l).insertRange(m*g,d,g*i,g*h)}this.m_paths.add(this.m_pointCount);for(let l=a;l>=e+1;l--){let u=this.m_paths.read(l-1);this.m_paths.write(l,u+i)}this.m_pathFlags.add(0);for(let l=a-1;l>=e+1;l--){let u=this.m_pathFlags.read(l);u&=-9,this.m_pathFlags.write(l+1,u)}return this.m_bPolygon&&this.m_pathFlags.write(e,1),this.hasNonLinearSegments()&&(this.m_curveData.m_segmentFlags.insertRange(m,1,i,h),this.m_curveData.m_segmentParamIndex.insertRange(m,-1,i,h)),this.notifyModifiedFlags(2001),e}insertPathFromMultipoint(e,s,n,i,o){let a=s.getImpl(),h=this.getPathCount();(e>h||n<0)&&U("");let m=i<0?a.getPointCount()-n:i;if(m>a.getPointCount()&&U(""),n>=a.getPointCount()&&U("pointsOffset"),e<0&&(e=h),this.m_bPathStarted=!1,this.mergeVertexDescription(a.getDescription()),m===0)return void this.insertPath2D(e,null,0,0,!0);let l=this.m_pointCount,u=n;this.resizeImpl(this.m_pointCount+m),this.verifyAllStreamsAfterSizeChange();let c=e<h?this.getPathStart(e):l;for(let _=0,p=this.m_description.getAttributeCount();_<p;_++){let f=this.m_description.getSemantics(_),x=a.getDescription().getAttributeIndex(f),C=Pt.getComponentCount(f);if(x>=0){let P=a.getAttributeStreamRef(f);this.m_vertexAttributes.get(_).insertRangeFromStream(c*C,P,C*u,C*m,o,C,C*l)}else{let P=Pt.getDefaultValue(f);this.m_vertexAttributes.get(_).insertRange(c*C,P,C*m,C*l)}}let g=l+m;this.m_paths.add(g);for(let _=h;_>=e+1;_--){let p=this.m_paths.read(_-1);this.m_paths.write(_,p+m)}this.m_pathFlags.add(0);for(let _=h-1;_>=e+1;_--){let p=this.m_pathFlags.read(_);p&=-9,this.m_pathFlags.write(_+1,p)}let d=0;this.m_bPolygon&&(d|=1),this.m_pathFlags.write(e,d),this.notifyModifiedFlags(2001)}insertPoints(e,s,n,i,o,a,h){if(this===n&&U("Multi_path_impl.insert_points"),e<0&&(e=this.getPathCount()),i<0&&(i=n.getPathCount()-1),(e>this.getPathCount()||s>=0&&s>this.getPathSize(e)||i>=n.getPathCount()||a>n.getPathSize(i))&&xt(""),!a)return;if(this.mergeVertexDescription(n.m_description),e===this.getPathCount()){this.m_paths.add(this.m_pointCount);let d=n.m_pathFlags.read(i);d&=-9,this.m_bPolygon?this.m_pathFlags.add(1|d):this.m_pathFlags.add(d)}s<0&&(s=this.getPathSize(e));let m=this.m_pointCount;this.resizeImpl(this.m_pointCount+a),this.verifyAllStreamsAfterSizeChange();let l=this.getPathStart(e),u=l+s;a<0&&(a=n.getPathSize(i));let c=n.getPathStart(i),g=c+a;for(let d=0,_=this.m_description.getAttributeCount();d<_;d++){let p=this.m_description.getSemantics(d),f=Pt.getComponentCount(p),x=n.m_description.getAttributeIndex(p);if(x<0||!n.m_vertexAttributes.get(x)){let C=Pt.getDefaultValue(p);this.m_vertexAttributes.get(d).insertRange(f*u,C,g*f,f*m)}else this.m_vertexAttributes.get(d)?.insertRangeFromStream(f*(l+s),n.m_vertexAttributes.get(x),f*(c+o),a*f,h,f,f*m)}this.hasNonLinearSegments()&&(this.m_curveData.m_segmentFlags.insertRange(l+s,1,a,m),this.m_curveData.m_segmentParamIndex.insertRange(l+s,-1,a,m),s>0&&this.isNonLinearSegment(l+s-1)&&(this.incCurveType(this.m_curveData.m_segmentFlags.read(l+s-1),-1),this.m_curveData.m_segmentFlags.write(l+s-1,1),this.m_curveData.m_segmentParamIndex.write(l+s-1,-1),this.modifyCurveCounter(-1)));for(let d=e+1,_=this.getPathCount();d<=_;d++){let p=this.m_paths.read(d);this.m_paths.write(d,p+a)}this.notifyModifiedFlags(2001)}insertPointsFromPoints(e,s,n,i,o,a){if(e<0&&(e=this.getPathCount()),(e>this.getPathCount()||s>this.getPathSize(e)||i<0)&&xt(""),!o)return;e===this.getPathCount()&&(this.m_paths.add(this.m_pointCount),this.m_bPolygon?this.m_pathFlags.add(1):this.m_pathFlags.add(0)),s<0&&(s=this.getPathSize(e));let h=this.m_pointCount;this.resizeImpl(this.m_pointCount+o),this.verifyAllStreamsAfterSizeChange();let m=this.getPathStart(e);this.m_vertexAttributes.get(0).insertRangeFromPoints(2*(m+s),n,i,o,a,2*h);for(let l=1,u=this.m_description.getAttributeCount();l<u;l++){let c=this.m_description.getSemantics(l),g=Pt.getComponentCount(c),d=Pt.getDefaultValue(c);this.m_vertexAttributes.get(l).insertRange((m+s)*g,d,g*o,g*h)}this.hasNonLinearSegments()&&(this.m_curveData.m_segmentFlags.insertRange(m+s,1,o,h),this.m_curveData.m_segmentParamIndex.insertRange(m+s,-1,o,h),s>0&&this.isNonLinearSegment(m+s-1)&&(this.incCurveType(this.m_curveData.m_segmentFlags.read(m+s-1),-1),this.m_curveData.m_segmentFlags.write(m+s-1,1),this.m_curveData.m_segmentParamIndex.write(m+s-1,-1),this.modifyCurveCounter(-1)));for(let l=e+1,u=this.getPathCount();l<=u;l++)this.m_paths.write(l,this.m_paths.read(l)+o);this.notifyModifiedFlags(2001)}insertPointsFromMultipoint(e,s,n,i,o,a){let h=n.getImpl(),m=this.getPathCount();e<0&&(e=this.getPathCount());let l=h.getPointCount();if((i<0||i>l)&&xt(""),(o<0||i+o>l)&&(o=l-i),s<0&&(s=e<m?this.getPathSize(e):0),(e>m||e<m&&s>this.getPathSize(e)||e===m&&s>0||o<0)&&xt(""),!o)return;if(this.mergeVertexDescription(h.getDescription()),e===m){this.m_paths.add(this.m_pointCount);let p=0;this.m_bPolygon?this.m_pathFlags.add(1|p):this.m_pathFlags.add(p)}s<0&&(s=this.getPathSize(e));let u=this.m_pointCount;this.resizeImpl(this.m_pointCount+o),this.verifyAllStreamsAfterSizeChange();let c=this.getPathStart(e),g=c+s,d=0,_=d+o;for(let p=0,f=this.m_description.getAttributeCount();p<f;p++){let x=this.m_description.getSemantics(p),C=Pt.getComponentCount(x);if(h.getDescription().getAttributeIndex(x)<0){let E=Pt.getDefaultValue(x);this.m_vertexAttributes.get(p).insertRange(C*g,E,_*C,C*u);continue}let P=h.getAttributeStreamRef(x);this.m_vertexAttributes.get(p).insertRangeFromStream(C*(c+s),P,C*(d+i),o*C,a,C,C*u)}this.hasNonLinearSegments()&&(this.m_curveData.m_segmentFlags.insertRange(c+s,1,o,u),this.m_curveData.m_segmentParamIndex.insertRange(c+s,-1,o,u),s>0&&this.isNonLinearSegment(c+s-1)&&(this.incCurveType(this.m_curveData.m_segmentFlags.read(c+s-1),-1),this.m_curveData.m_segmentFlags.write(c+s-1,1),this.m_curveData.m_segmentParamIndex.write(c+s-1,-1),this.modifyCurveCounter(-1)));for(let p=e+1,f=this.getPathCount();p<=f;p++){let x=this.m_paths.read(p);this.m_paths.write(p,x+o)}this.notifyModifiedFlags(2001)}insertPoint2D(e,s,n){let i=this.getPathCount();e<0&&(e=i),(e>i||e<i&&s>this.getPathSize(e))&&xt(""),e===i&&this.addPathPoint2D(null,0,!0);let o=this.m_pointCount;this.resizeImpl(this.m_pointCount+1),this.verifyAllStreamsAfterSizeChange();let a=this.getPathStart(e),h=s<0?this.getPathSize(e)+a:s+a,m=this.m_vertexAttributes.get(0);if(h===o)this.m_paths.write(e+1,o+1),m.writePoint2D(2*h,n);else{m.insert(2*h,n,2*o);for(let l=1,u=this.m_description.getAttributeCount();l<u;l++){let c=this.m_description.getSemantics(l),g=Pt.getComponentCount(c),d=Pt.getDefaultValue(c);this.m_vertexAttributes.get(l).insertRange(g*h,d,g,g*o)}this.m_curveData&&this.m_curveData.m_segmentFlags&&(this.m_curveData.m_segmentFlags.insertRange(h,1,1,o),this.m_curveData.m_segmentParamIndex.insertRange(h,-1,1,o));for(let l=e+1,u=i;l<=u;l++)this.m_paths.write(l,this.m_paths.read(l)+1)}this.m_curveData&&this.m_curveData.m_segmentFlags&&h>a&&this.isNonLinearSegment(h-1)&&(this.incCurveType(this.m_curveData.m_segmentFlags.read(h-1),-1),this.modifyCurveCounter(-1),this.m_curveData.m_segmentFlags.write(h-1,1),this.m_curveData.m_segmentParamIndex.write(h-1,-1)),this.notifyModifiedFlags(2001)}insertPoint(e,s,n){let i=this.getPathCount();e<0&&(e=i),(e>i||e<i&&s>this.getPathSize(e))&&xt(""),e===i&&this.addPathPoint2D(null,0,!0);let o=this.m_pointCount;this.resizeImpl(this.m_pointCount+1),this.verifyAllStreamsAfterSizeChange();let a=this.getPathStart(e),h=s<0?this.getPathSize(e)+a:s+a;if(h===o)this.m_paths.write(e+1,o+1),this.setPointByVal(h,n);else{let m=n.getDescription();this.m_description!==m&&this.mergeVertexDescription(m);for(let l=0,u=this.m_description.getAttributeCount();l<u;l++){let c=this.m_description.getSemantics(l),g=Pt.getComponentCount(c);if(m.hasAttribute(c))this.m_vertexAttributes.get(l).insertAttributes(g*h,n,c,g*o);else{let d=Pt.getDefaultValue(c);this.m_vertexAttributes.get(l).insertRange(g*h,d,g,g*o)}}this.m_curveData&&this.m_curveData.m_segmentFlags&&(this.m_curveData.m_segmentFlags.insertRange(h,1,1,o),this.m_curveData.m_segmentParamIndex.insertRange(h,-1,1,o));for(let l=e+1,u=i;l<=u;l++)this.m_paths.write(l,this.m_paths.read(l)+1)}this.m_curveData&&this.m_curveData.m_segmentFlags&&h>a&&this.isNonLinearSegment(h-1)&&(this.incCurveType(this.m_curveData.m_segmentFlags.read(h-1),-1),this.modifyCurveCounter(-1),this.m_curveData.m_segmentFlags.write(h-1,1),this.m_curveData.m_segmentParamIndex.write(h-1,-1)),this.notifyModifiedFlags(2001)}removePointFromPath(e,s){let n=this.getPathCount();e<0&&(e=n-1),(e>=n||s>=this.getPathSize(e))&&xt("Multi_path.remove_point");let i=this.getPathStart(e),o=this.isClosedPath(e);s<0&&(s=this.getPathSize(e)-1),s<0&&xt("Multi_path.remove_point");let a=i+s;for(let h=0,m=this.m_description.getAttributeCount();h<m;h++)if(this.m_vertexAttributes.get(h)){let l=this.m_description.getSemantics(h),u=Pt.getComponentCount(l);this.m_vertexAttributes.get(h).eraseRange(u*a,u,u*this.m_pointCount)}if(this.m_curveData&&this.m_curveData.m_segmentFlags){this.checkCompactSegmentParams();let h=0;if(a>i&&this.isNonLinearSegment(a-1))h+=1,this.incCurveType(this.m_curveData.m_segmentFlags.read(a-1),-1),this.m_curveData.m_segmentFlags.write(a-1,1),this.m_curveData.m_segmentParamIndex.write(a-1,-1);else{let m=this.getPathEnd(e);o&&i+1<m&&this.isNonLinearSegment(m-1)&&(this.incCurveType(this.m_curveData.m_segmentFlags.read(m-1),-1),this.m_curveData.m_segmentFlags.write(m-1,1),this.m_curveData.m_segmentParamIndex.write(m-1,-1),h+=1)}this.isNonLinearSegment(a)&&(this.incCurveType(this.m_curveData.m_segmentFlags.read(a),-1),h+=1),h>0&&this.modifyCurveCounter(-h),this.m_curveData.m_segmentFlags.eraseRange(a,1,this.m_pointCount),this.m_curveData.m_segmentParamIndex.eraseRange(a,1,this.m_pointCount)}for(let h=n;h>=e+1;h--){let m=this.m_paths.read(h);this.m_paths.write(h,m-1)}this.m_pointCount--,this.m_reservedPointCount--,this.notifyModifiedFlags(2001)}removePoint(e){let s;s=e<0?this.getPathCount()-1:this.getPathIndexFromPointIndex(e),this.removePointFromPath(s,e-this.getPathStart(s))}getNumberOfCurves(e){if(!this.hasNonLinearSegments())return 0;let s=0;for(let n=this.getPathStart(e),i=this.getPathEnd(e);n<i;n++)r.isNonLinearSegmentFlag(this.m_curveData.m_segmentFlags.read(n))&&++s;return s}getPathCount(){return this.m_paths?this.m_paths.size()-1:0}getPathSize(e){return this.m_paths.read(e+1)-this.m_paths.read(e)}getPathStart(e){return this.m_paths.read(e)}getPathEnd(e){return this.m_paths.read(e+1)}getPathIndexFromPointIndex(e,s=-1){s===-1&&(s=this.m_currentPathIndex);let n=this.getPathCount(),i=r.getPathIndexFromPointIndexImpl(this.m_paths,n,e,s);return this.m_currentPathIndex=i,i}startPathCoords(e,s){this.startPathPoint(new st({x:e,y:s}))}startPath(e){this.startPathPoint(new st({pt:e}))}startPath3D(e){this.startPathPoint(new st({x:e.x,y:e.y,z:e.z}))}startPath3DCoords(e,s,n){this.startPathPoint(new st({x:e,y:s,z:n}))}startPathPoint(e){e.isEmpty()&&U("");let s=e.getDescription(),n;if(this.m_description!==s){this.mergeVertexDescription(s);let i=new st({vd:this.m_description});e.copyCommonAttributesTo(i),n=i}else n=e;this.m_bPathStarted?this.setPointByVal(this.m_pointCount-1,n):(this.insertPoint(-1,-1,n),this.m_bPathStarted=!0)}beforeNewSegmentHelper2(){this.m_paths=Ce(2),this.m_paths.write(0,0),this.m_pathFlags=Zs(2,0),this.m_bPolygon&&this.m_pathFlags.write(0,1)}beforeNewSegmentHelper1(){this.m_paths!==null?(this.m_paths.add(0),this.m_pathFlags.add(0),this.m_bPolygon&&this.m_pathFlags.write(this.m_pathFlags.size()-2,1)):this.beforeNewSegmentHelper2()}beforeNewSegment(e){this.m_pointCount!==0||this.m_bPathStarted||this.startPathCoords(0,0);let s=this.m_pointCount,n=this.m_paths.size()-1,i=s+e;this.m_paths.write(n,i),this.resizeImpl(i),this.m_bPathStarted&&(this.m_bPathStarted=!1)}finishLineTo(){if(this.hasNonLinearSegments()){let e=this.m_curveData.m_segmentFlags.read(this.m_pointCount-1);e!==1&&(this.m_curveData.m_segmentFlags.write(this.m_pointCount-1,1),this.m_curveData.m_segmentParamIndex.write(this.m_pointCount-1,-1),this.modifyCurveCounter(-1),this.incCurveType(e,-1))}}lineToCoords(e,s){if(this.beforeNewSegment(1),this.m_description.getAttributeCount()===1)this.setXYCoords(this.m_pointCount-1,e,s);else{let n=hn(),i=new st({vd:this.m_description,attribBuffer:n,initDefaultValues:!0});i.setXYCoords(e,s),this.setPointByVal(this.m_pointCount-1,i)}this.finishLineTo()}lineTo(e){this.lineToCoords(e.x,e.y)}lineTo3D(e){this.beforeNewSegment(1);let s=Hi(this.m_description,Li()),n=hn(),i=new st({vd:s,attribBuffer:n,initDefaultValues:!0});i.setXYZ(e),this.setPointByVal(this.m_pointCount-1,i),this.finishLineTo()}lineTo3DCoords(e,s,n){this.lineTo3D(new ot(e,s,n))}lineToPoint(e){if(this.beforeNewSegment(1),this.m_description===e.getDescription())this.setPointByVal(this.m_pointCount-1,e);else{this.mergeVertexDescription(e.getDescription());let s=hn(),n=new st({vd:this.m_description,attribBuffer:s,initDefaultValues:!1});e.copyCommonAttributesTo(n),this.setPointByVal(this.m_pointCount-1,n)}this.finishLineTo()}openPathAndDuplicateStartVertex(e){this.m_bPolygon&&j("");let s=this.getPathCount();if(e>s&&U(""),!this.isClosedPath(e))return;this.m_pathFlags||j("");let n=this.m_pointCount,i=this.getPathStart(e),o=this.getPathEnd(e);if(o-i!=0){this.resizeImpl(this.m_pointCount+1),this.verifyAllStreamsAfterSizeChange();for(let a=0,h=this.m_description.getAttributeCount();a<h;a++)if(this.m_vertexAttributes.get(a)){let m=this.m_description.getSemantics(a),l=Pt.getComponentCount(m);this.m_vertexAttributes.get(a).insertRangeFromStream(l*o,this.m_vertexAttributes.get(a),l*i,l,!0,1,l*n)}for(let a=s;a>e;a--){let h=this.m_paths.read(a);this.m_paths.write(a,h+1)}this.hasNonLinearSegments()&&(this.m_curveData.m_segmentFlags.insertRange(o,1,1,n),this.m_curveData.m_segmentParamIndex.insertRange(o,-1,1,n)),this.m_pathFlags.clearBits(e,1)}}openPath(e){this.m_bPolygon&&j(""),e>this.getPathCount()&&U(""),this.m_pathFlags||j(""),this.m_pathFlags.clearBits(e,1)}isStrongPathStart(e){return!!(2&this.m_pathFlags.read(e))}setStrongPathStart(e,s){s?this.m_pathFlags.setBits(e,2):this.m_pathFlags.clearBits(e,2)}isStrongPathEnd(e){return!!(4&this.m_pathFlags.read(e))}setStrongPathEnd(e,s){s?this.m_pathFlags.setBits(e,4):this.m_pathFlags.clearBits(e,4)}clearStrongPathEnds(){for(let e=0,s=this.getPathCount();e<s;++e)this.m_pathFlags.clearBits(e,6)}openAllPathsAndDuplicateStartVertex(){if(this.m_bPolygon&&j(""),this.isEmpty())return;this.m_pathFlags||j("");let e=0,s=this.getPathCount();for(let u=0;u<s;u++)this.isClosedPath(u)&&(this.getPathSize(u)>0?e++:this.m_pathFlags.clearBits(u,1));if(e===0)return;let n=this.hasNonLinearSegments(),i=0,o=this.getPathCount(),a=this.m_description.getAttributeCount(),h=new Array(a),m=null,l=null;for(let u=0;u<o;++u){let c=this.getPathStart(u),g=this.getPathSize(u),d=this.isClosedPath(u);if(g>0){let _=c+i;for(let p=0;p<a;p++)if(this.m_vertexAttributes.get(p)){let f=this.m_description.getSemantics(p),x=Pt.getComponentCount(f);if(!h[p]){let C=x*(this.m_pointCount+e),P=Bi(f,C);h[p]=P}h[p].writeRange(_*x,g*x,this.m_vertexAttributes.get(p),c*x,!0,1),d&&h[p].writeRange((_+g)*x,x,this.m_vertexAttributes.get(p),c*x,!0,1)}if(n){if(m===null){let p=this.m_pointCount+e;m=Zs(p),l=Ce(p)}m.writeRange(_,g,this.m_curveData.m_segmentFlags,c,!0,1),l.writeRange(_,g,this.m_curveData.m_segmentParamIndex,c,!0,1),d&&(m.write(_+g,1),l.write(_+g,-1))}}this.m_paths.write(u,c+i),d&&(this.m_pathFlags.clearBits(u,1),++i)}this.m_paths.write(o,this.m_pointCount+e),this.m_pathFlags.clearBits(o,1);for(let u=0;u<a;u++)this.m_vertexAttributes.get(u)&&this.m_vertexAttributes.set(u,h[u]);n&&(this.m_curveData.m_segmentFlags=m,this.m_curveData.m_segmentParamIndex=l),this.m_pointCount+=e,this.m_reservedPointCount>0&&(this.m_reservedPointCount=this.m_pointCount)}closePathWithLine(e){e===void 0&&(e=this.getPathCount()-1),this.throwIfEmpty(),(e<0||e>=this.getPathCount())&&U("close_path_with_line"),e===this.getPathCount()-1&&(this.m_bPathStarted=!1);let s=this.m_pathFlags.read(e);if(1&s||this.m_pathFlags.write(e,1|s),this.m_curveData&&this.m_curveData.m_segmentFlags){let n=this.getPathEnd(e)-1,i=this.m_curveData.m_segmentFlags.read(n);i!==1&&(this.m_curveData.m_segmentFlags.write(n,1),this.m_curveData.m_segmentParamIndex.write(n,-1),i!==1&&(this.incCurveType(i,-1),this.modifyCurveCounter(-1)))}this.notifyModifiedFlags(2001)}closeLastPathWithSegment(e){this.closePathWithSegment(this.getPathCount()-1,e)}closePathWithSegment(e,s){if(this.throwIfEmpty(),(e<0||e>=this.getPathCount())&&U("close_path_with_line"),s.getEndXY().equals(this.getXY(this.getPathStart(e)))||U("close_path_with_segment: end point mismatch"),e===this.getPathCount()-1)this.m_bPathStarted=!1,this.addSegment(s,!1),--this.m_pointCount,this.m_paths.write(e+1,this.m_pointCount);else{this.mergeVertexDescription(s.getDescription());let i=s.getStartXY(),o=this.getPathEnd(e)-1;i.equals(this.getXY(o))||U("close_path_with_segment: start point mismatch");let a=s.getGeometryType();if(a===N.enumLine)return void this.closePathWithLine(e);{let h=uh(s);this.initSegmentData(h);let m=ws.toSegType(a),l=this.m_curveData.m_segmentFlags.read(o);if(l!==m)this.m_curveData.m_segmentParamIndex.write(o,this.m_curveData.m_curveParamWritePoint),s.writeInBufferStream(this.m_curveData.m_segmentParams,this.m_curveData.m_curveParamWritePoint),this.m_curveData.m_curveParamWritePoint+=h,this.incCurveType(m,1),l!==1?this.incCurveType(l,-1):this.modifyCurveCounter(1);else{let u=this.m_curveData.m_segmentParamIndex.read(o);s.writeInBufferStream(this.m_curveData.m_segmentParams,u)}this.m_curveData.m_segmentFlags.write(o,m)}}let n=this.m_pathFlags.read(e);1&n||this.m_pathFlags.write(e,1|n),this.notifyModifiedFlags(2001)}closeAllPaths(){if(this.m_bPolygon||this.isEmptyImpl())return;this.m_bPathStarted=!1;let e=!1;for(let s=0,n=this.m_paths.size()-1;s<n;s++){if(this.isClosedPath(s))continue;let i=this.m_pathFlags.read(s);this.m_pathFlags.write(s,1|i),e=!0}e&&this.notifyModifiedFlags(512)}isClosedPath(e){return!!(1&this.m_pathFlags.read(e))}isClosedPathInXYPlane(e){if(this.isClosedPath(e))return!0;let s=this.getPathStart(e),n=this.getPathEnd(e)-1;if(s>n)return!1;let i=this.getXY(s),o=this.getXY(n);return i.isEqualPoint2D(o)}isClosedPathIn3D(e){return w(0),!1}hasNonLinearSegmentsPath(e){if(!this.hasNonLinearSegments())return!1;for(let s=this.getPathStart(e),n=this.getPathEnd(e);s<n;s++)if(r.isNonLinearSegmentFlag(this.m_curveData.m_segmentFlags.read(s)))return!0;return!1}isNonLinearSegment(e){return!(1&this.getSegmentFlags(e))}addEnvelope(e,s){if(e.isEmpty())return;let n=this.m_pointCount===0;if(e instanceof V)this.startPathCoords(e.xmin,e.ymin),s?(this.lineToCoords(e.xmax,e.ymin),this.lineToCoords(e.xmax,e.ymax),this.lineToCoords(e.xmin,e.ymax)):(this.lineToCoords(e.xmin,e.ymax),this.lineToCoords(e.xmax,e.ymax),this.lineToCoords(e.xmax,e.ymin));else{let i=e.getDescription(),o=hn(),a=new st({vd:i,attribBuffer:o,initDefaultValues:!1});for(let h=0,m=4;h<m;h++){let l=s?m-h-1:h;e.queryCornerByVal(l,a),h===0?this.startPathPoint(a):this.lineToPoint(a)}}this.closePathWithLine(),this.m_bPathStarted=!1,n&&!s&&(this.setDirtyFlagProtected(256,!1),this.m_bPolygon&&Math.min(e.width(),e.height())>0&&this.setIsSimple(3,0))}addPathFromClosedSegment(e,s){if(e.isClosed()||U("add_path_from_closedSegment: segment must be closed"),s){let n=e.getReversed(),i=new st;n.queryStart(i),this.startPathPoint(i),this.closeLastPathWithSegment(n)}else{let n=new st;e.queryStart(n),this.startPathPoint(n),this.closeLastPathWithSegment(e)}}addSegment_(e,s){let n=e.getDescription();this.mergeVertexDescription(n);let i=hn(),o=new st({vd:n,attribBuffer:i,initDefaultValues:!1}),a=e.getGeometryType();if(a===N.enumLine)(s||this.isEmptyImpl())&&(e.queryStart(o),this.startPathPoint(o)),e.queryEnd(o),this.lineToPoint(o);else{let h=!1;if((s||this.isEmptyImpl())&&(h=!0),!h&&(e.getStartXY().equals(this.getXY(this.m_pointCount-1))||U("add_segment: start point mismatch")),h&&(e.queryStart(o),this.startPathPoint(o)),this.beforeNewSegment(1),e.queryEnd(o),o.getDescription()===this.m_description)this.setPointByVal(this.m_pointCount-1,o);else{let u=hn(),c=new st({vd:this.m_description,attribBuffer:u,initDefaultValues:!1});o.copyCommonAttributesTo(c),this.setPointByVal(this.m_pointCount-1,c)}let m=uh(e);this.initSegmentData(m),this.m_curveData.m_segmentParamIndex.write(this.m_pointCount-2,this.m_curveData.m_curveParamWritePoint),e.writeInBufferStream(this.m_curveData.m_segmentParams,this.m_curveData.m_curveParamWritePoint),this.m_curveData.m_curveParamWritePoint+=m;let l=ws.toSegType(a);this.incCurveType(l,1),this.modifyCurveCounter(1),this.m_curveData.m_segmentFlags.write(this.m_pointCount-2,l)}}addSegment(e,s,n){n?s?this.addPathFromClosedSegment(e,!1):this.closeLastPathWithSegment(e):this.addSegment_(e,s)}interpolateAttributesRange(e,s,n,i){for(let h=e;h<n-1;h++)this.isClosedPath(h)&&U("cannot interpolate across closed paths");let o=this.m_description.getAttributeCount();if(o===1)return;let a=this.calculateSubLength2D(e,s,n,i);if(a!==0)for(let h=1;h<o;h++){let m=this.m_description.getSemantics(h);this.interpolateAttributesSemanticsImpl(m,e,s,n,i,a)}}interpolateAttributesSemantics(e,s,n,i,o){if(e===0)return;this.hasAttribute(e)||U("does not have the given attribute"),Pt.getInterpolation(e)===2&&U("angular interpolation");for(let h=s;h<i-1;h++)this.isClosedPath(h)&&U("cannot interpolate across closed paths");let a=this.calculateSubLength2D(s,n,i,o);a!==0&&this.interpolateAttributesSemanticsImpl(e,s,n,i,o,a)}interpolateAttributesPath(e,s,n){let i=this.m_description.getAttributeCount();if(i===1||s===n)return;let o=this.calculatePathSubLength2D(e,s,n);for(let a=1;a<i;a++){let h=this.m_description.getSemantics(a);this.interpolateAttributesSemanticsPathImpl(h,e,s,n,o)}}interpolateAttributesSemanticsPath(e,s,n,i){if(e===0)return;this.hasAttribute(e)||U("does not have the given attribute"),Pt.getInterpolation(e)===2&&U("angular interpolation");let o=this.calculatePathSubLength2D(s,n,i);o!==0&&this.interpolateAttributesSemanticsPathImpl(e,s,n,i,o)}interpolateAttributesSemanticsImpl(e,s,n,i,o,a){let h=this.querySegmentIterator(),m=this.getPathStart(s)+n,l=this.getPathStart(i)+o,u=Pt.getComponentCount(e),c=Z(Pt.maxComponentCount(),Number.NaN);this.queryAttributeAsDbl(e,m,c,u);let g=Z(Pt.maxComponentCount(),Number.NaN);this.queryAttributeAsDbl(e,l,g,u);let d=Z(Pt.maxComponentCount(),Number.NaN);ye(d,c,0,0,u);let _=0,p=Pt.getDefaultValue(e),f=Pt.getInterpolation(e);h.resetToVertex(m,s);do if(h.hasNextSegment()){if(h.nextSegment(),h.getStartPointIndex()===l)return;this.setAttributeFromArray(e,h.getStartPointIndex(),d,u),h.previousSegment();do{let x=h.nextSegment();if(h.getEndPointIndex()===l)return;_+=x.calculateLength2D(),$r(f,c,g,d,0,u,_/a,p),h.isClosingSegment()||this.setAttributeFromArray(e,h.getEndPointIndex(),d,u)}while(h.hasNextSegment())}while(h.nextPath())}interpolateAttributesSemanticsPathImpl(e,s,n,i,o){let a=this.querySegmentIterator(),h=Pt.getInterpolation(e),m=this.getPathStart(s)+n,l=this.getPathStart(s)+i;if(l===m)return;let u=Pt.getComponentCount(e),c=Z(Pt.maxComponentCount(),Number.NaN);this.queryAttributeAsDbl(e,m,c,u);let g=Z(Pt.maxComponentCount(),Number.NaN);this.queryAttributeAsDbl(e,l,g,u);let d=new oe(0);a.resetToVertex(m,s),a.setCirculator(this.isClosedPath(s));let _=Pt.getDefaultValue(e),p=Z(Pt.maxComponentCount(),Number.NaN);ye(p,c,0,0,u);let f=o===0,x=.5;do{let C=a.nextSegment();if(this.setAttributeFromArray(e,a.getStartPointIndex(),p,u),!f){let P=C.calculateLength2D();d.pe(P),x=d.getResult()/o}$r(h,c,g,p,0,u,x,_)}while(a.getEndPointIndex()!==l)}querySegment(e,s,n){let i=this.getPathIndexFromPointIndex(e),o=e-this.getPathStart(i);o>=this.getSegmentCountPath(i)&&U("get_segment"),this.getSegmentFromPath(i,o,s,n)}getSegment(e,s){let n=new this.m_segmentBufferCTor;return this.getSegmentBuffer(e,n,s),n.releaseSegment()}getSegmentType(e){let s=this.getPathIndexFromPointIndex(e),n=e-this.getPathStart(s);return n>=this.getSegmentCountPath(s)&&U("get_segment"),this.getSegmentTypeFromPath(s,n)}getSegmentFromPath(e,s,n,i){let o=this.getPathStart(e)+s,a=this.getSegmentFlagsStreamRef(),h=1;switch(a&&(h=31&a.read(o)),h){case 1:n.createLine();break;case 2:n.createCubicBezier();break;case 4:n.createEllipticArc();break;case 8:n.createQuadraticRationalBezier();break;case 16:n.createQuadraticBezier();break;default:j("")}let m=n.get(),l,u=null;if(i?(u=xs(),m.assignVertexDescription(u)):m.assignVertexDescription(this.m_description),l=o===this.getPathEnd(e)-1&&this.isClosedPath(e)?this.getPathStart(e):o+1,hm(m,this.getXY(o)),mm(m,this.getXY(l)),!i)for(let c=1,g=this.m_description.getAttributeCount();c<g;c++){let d=this.m_description.getSemantics(c),_=Pt.getComponentCount(d);for(let p=0;p<_;p++){let f=this.getAttributeAsDbl(d,o,p);m.setStartAttribute(d,p,f);let x=this.getAttributeAsDbl(d,l,p);m.setEndAttribute(d,p,x)}}if(r.isNonLinearSegmentFlag(h)){let c=this.m_curveData.m_segmentParamIndex.read(o);m.readFromBufferStream(this.m_curveData.m_segmentParams,c)}}replaceLinearEllipticalArcsWithTrueLines(){if(!this.hasNonLinearSegments()||this.m_curveData.m_arcCount===0)return!1;let e=!1;for(let s=0,n=this.getPointCount();s<n;s++)if(this.m_curveData.m_segmentFlags.read(s)===4){let i=this.m_curveData.m_segmentParamIndex.read(s);Ep(this.m_curveData.m_segmentParams,i).isNAN()&&(this.m_curveData.m_segmentFlags.write(s,1),this.m_curveData.m_segmentParamIndex.write(s,-1),this.incCurveType(4,-1),this.modifyCurveCounter(-1),e=!0)}return e&&this.checkCompactSegmentParams(),e}queryPointAlongPath(e,s,n,i=!1){let o={iSegment:-1},a=i?o:{iSegment:-1,tSegment:0};if(n.setEmpty(),this.isEmpty()||((e<0||e>=this.getPathCount())&&U("query_point_along_path"),s<0))return o;let h=this.getPathSize(e);if(h===0)return o;if(h===1)return this.getPointByVal(this.getPathStart(e),n),a.tSegment=0,o.iSegment=this.getPathStart(e),o;let m=this.querySegmentIteratorAtVertex(this.getPathStart(e)),l=new oe(0);for(;m.hasNextSegment();){let u=m.nextSegment(),c=u.calculateLength2D(),g=l.getResult();if(l.add(c),l.getResult()>=s){let d=s-g;d>c&&(d=c);let _=u.lengthToT(d);return u.queryCoord(_,n),a.tSegment=_,o.iSegment=m.getStartPointIndex(),o}}if(this.isClosedPath(e)){let u=this.getPathStart(e);return this.getPointByVal(u,n),a.tSegment=1,o.iSegment=this.getPathEnd(e)-1,o}{let u=this.getPathEnd(e)-1;return this.getPointByVal(u,n),this.getPathSize(e)>1?(a.tSegment=1,o.iSegment=this.getPathEnd(e)-2,o):(a.tSegment=0,o.iSegment=this.getPathStart(e),o)}}queryPointsAlongPath(e,s,n,i,o,a){{let _=0;for(let p=0;p<s;++p)i&&i[p].setEmpty(),o&&(o[p]=-1),a&&(a[p]=0),_>n[p]&&U("query_points_along"),_=n[p]}let h=this.getPathSize(e);if(s===0||h===0)return 0;if(h===1){let _=this.getPathStart(e);return i&&this.getPointByVal(_,i[0]),a&&(a[0]=0),o&&(o[0]=_),1}let m=this.getPathStart(e),l=new oe(0),u=this.querySegmentIteratorAtVertex(m),c=0,g=0,d=n[c];for(;u.hasNextSegment();){let _=u.nextSegment(),p=_.calculateLength2D(),f=l.getResult();for(l.add(p);l.getResult()>=d;){let x=d-f;x>p&&(x=p);let C=_.lengthToT(x);if(i&&_.queryCoord(C,i[g]),a&&(a[g]=C),o&&(o[g]=u.getStartPointIndex()),g++,c++,d=n[c],c===s)return g}}if(this.isClosedPath(e)){let _=this.getPathStart(e),p=0;i&&this.getPointByVal(_,i[g]),a&&(a[g]=p),o&&(o[g]=_),g++}else if(this.getPathSize(e)>1){let _=this.getPathEnd(e)-2,p=1;i&&this.getPointByVal(_+1,i[g]),a&&(a[g]=p),o&&(o[g]=_),g++}return g}queryPointsAlong(e,s,n,i,o){{let g=0;for(let d=0;d<e;++d)n&&n[d].setEmpty(),i&&(i[d]=-1),o&&(o[d]=0),g>s[d]&&U("query_points_along"),g=s[d]}if(e===0)return 0;let a=new oe(0),h=this.querySegmentIterator(),m=-1,l=0,u=0,c=s[l];for(;h.nextPath();)for(;h.hasNextSegment();){m=h.getPathIndex();let g=h.nextSegment(),d=g.calculateLength2D(),_=a.getResult();for(a.add(d);a.getResult()>=c;){let p=c-_;p>d&&(p=d);let f=g.lengthToT(p);if(n&&g.queryCoord(f,n[u]),o&&(o[u]=f),i&&(i[u]=h.getStartPointIndex()),u++,l++,c=s[l],l===e)return u}}if(m<0)return 0;if(this.isClosedPath(m)){let g=this.getPathStart(m),d=0;n&&this.getPointByVal(g,n[u]),o&&(o[u]=d),i&&(i[u]=g),u++}else if(this.getPathSize(m)>1){let g=this.getPathEnd(m)-2,d=1;n&&this.getPointByVal(g+1,n[u]),o&&(o[u]=d),i&&(i[u]=g),u++}return u}querySegmentIterator(){return new nr({parent:this})}querySegmentIteratorAtVertex(e){return new nr({parent:this,pointIndex:e})}queryPathEnvelope(e,s){this.queryPathEnvelopeImpl(e,s,!0)}queryLoosePathEnvelope(e,s){this.queryPathEnvelopeImpl(e,s,!1)}queryPathEnvelopeImpl(e,s,n){if(s instanceof Me&&w(0,"not implemented for Envelope"),s instanceof ys&&w(0,"not implemented for Envelope3D"),(e>=this.getPathCount()||e<0)&&U(""),this.isEmpty())return void s.setEmpty();let i=this.getAttributeStreamRef(0),o=V.constructEmpty();o.setEmpty();for(let a=2*this.getPathStart(e),h=2*this.getPathEnd(e);a<h;){let m=h-a;w(!(1&m)),o.mergePointsInterleaved(i,a/2,m/2),a+=m}if(s.setCoords({env2D:o}),this.hasNonLinearSegmentsPath(e)){let a=this.querySegmentIterator();if(a.resetToPath(e),a.nextPath())for(;a.hasNextSegment();){let h=a.nextCurve();if(!h)break;{let m=V.constructEmpty();n?h.queryEnvelope(m):h.queryLooseEnvelope(m),s.mergeEnvelope2D(m)}}else w(0)}}checkCompactSegmentParams(){if(!this.m_curveData||this.m_curveData.m_segmentParams===null||this.m_curveData.m_segmentParams.size()<=this.m_vertexAttributes.get(0).size())return!1;let e=10,s=Cs(4)*this.m_curveData.m_arcCount+Cs(2)*this.m_curveData.m_bezierCount+Cs(8)*this.m_curveData.m_rbezier2Count+Cs(16)*this.m_curveData.m_bezier2Count;return this.m_curveData.m_segmentParams.size()>Math.max(3*s>>1,e)?(this.forceCompactSegmentParams(),!0):(this.m_pointCount===0&&(this.m_curveData.m_curveParamWritePoint=0),!1)}forceCompactSegmentParams(){let e=0;for(let i=0,o=this.getPointCount();i<o;i++){let a=this.m_curveData.m_segmentFlags.read(i);r.isNonLinearSegmentFlag(a)&&(e+=Cs(a))}let s=mn(e),n=0;for(let i=0,o=this.getPointCount();i<o;i++){let a=this.m_curveData.m_segmentFlags.read(i);if(r.isNonLinearSegmentFlag(a)){let h=this.m_curveData.m_segmentParamIndex.read(i);this.m_curveData.m_segmentParamIndex.write(i,n);let m=Cs(a);for(let l=0;l<m;l++)s.write(n,this.m_curveData.m_segmentParams.read(h)),n++,h++}}this.m_curveData.m_segmentParams=s,this.m_curveData.m_curveParamWritePoint=n}setEmpty(){this.m_curveData&&(this.removeAllCurvesFromGlobalCounter(),this.m_curveData=null),this.m_bPathStarted=!1,this.m_paths=null,this.m_pathFlags=null,this.setEmptyImpl()}applyTransformation(e){this.applyTransformationToPath(e,-1)}applyTransformation3D(e){w(0)}getImpl(){return this}reserve(e){this.reserveImpl(e),e>0&&!this.m_paths&&(this.m_paths=Ce(0),this.m_pathFlags=Zs(0),this.m_paths.reserve(2),this.m_pathFlags.reserve(2),this.m_paths.resize(1,0),this.m_pathFlags.resize(1,this.m_bPolygon?1:0))}reserveParts(e,s){this.reserveImpl(e),s>0&&(this.m_paths?(this.m_paths.reserve(s+1),this.m_pathFlags.reserve(s+1)):(this.m_paths=Ce(0),this.m_pathFlags=Zs(0),this.m_paths.reserve(s+1),this.m_pathFlags.reserve(s+1),this.m_paths.resize(1,0),this.m_pathFlags.resize(1,this.m_bPolygon?1:0)))}clone(){let e=this.createInstance();return this.copyTo(e),e}queryLimitedSegmentIterator(e){return new tm(this,e)}getPathStreamRef(){return this.throwIfEmpty(),this.m_paths}setPathStreamRef(e){this.m_paths=e}getSegmentFlagsStreamRef(){return this.throwIfEmpty(),this.m_curveData!=null?this.m_curveData.m_segmentFlags:null}getPathFlagsStreamRef(){return this.throwIfEmpty(),this.m_pathFlags}setPathFlagsStreamRef(e){this.m_pathFlags=e}getSegmentIndexStreamRef(){return this.throwIfEmpty(),this.m_curveData!==null?this.m_curveData.m_segmentParamIndex:null}getSegmentDataStreamRef(){return this.throwIfEmpty(),this.m_curveData!==null?this.m_curveData.m_segmentParams:null}setSegmentData(e,s,n,i){this.m_curveData||(this.m_curveData=new ws),this.m_curveData.m_segmentFlags=n,this.m_curveData.m_segmentParams=s,this.m_curveData.m_segmentParamIndex=e,this.m_curveData.m_curveParamWritePoint=i}static getPathIndexFromPointIndexImpl(e,s,n,i){if(i>=0&&i<s){if(n>=e.read(i)){if(n<e.read(i+1))return i;i++}else i--;if(i>=0&&i<s&&n>=e.read(i)&&n<e.read(i+1))return i}if(s<5){for(let h=0;h<s;h++)if(n<e.read(h+1))return h;Ba("")}let o=0,a=s-1;for(;a>o;){let h=o+(a-o>>1);if(n<e.read(h))a=h-1;else{if(!(n>=e.read(h+1)))return h;o=h+1}}return o}getHighestPointIndex(e){w(e>=0&&e<this.getPathCount());let s=this.getAttributeStreamRef(0),n=this.getPathEnd(e),i=this.getPathStart(e),o=-1,a=new y;a.y=Number.NEGATIVE_INFINITY,a.x=Number.NEGATIVE_INFINITY;for(let h=i+0;h<n;h++){let m=s.readPoint2D(2*h);a.compare(m)===-1&&(o=h,a.setCoordsPoint2D(m))}return o}applyTransformationToPath(e,s){if(s>=this.getPathCount()&&U("apply_transformation"),this.isEmpty()||e.isIdentity())return;let n=this.m_vertexAttributes.get(0);if(!(s<0?this.hasNonLinearSegments():this.hasNonLinearSegmentsPath(s))){let h,m;return s<0?(h=0,m=this.m_pointCount):(h=this.getPathStart(s),m=this.getPathEnd(s)),n.applyTransformation(e,2*h,m-h),void this.notifyModifiedFlags(2001)}let i=new this.m_segmentBufferCTor,o=this.getPathCount(),a=s<0?0:s;do{let h=this.getPathStart(a),m=this.getPathEnd(a),l=this.isClosedPath(a),u=n.readPoint2D(2*h);if(!this.hasNonLinearSegmentsPath(a)){n.applyTransformation(e,2*h,m-h);continue}let c=y.getNAN();for(let g=h;g<m;++g){if((31&this.m_curveData.m_segmentFlags.read(g))!==1){let _=l&&g+1===m;_&&n.writePoint2D(2*h,u),this.getSegmentBuffer(g,i,!0),i.get().applyTransformation(e);let p=this.m_curveData.m_segmentParamIndex.read(g);i.get().writeInBufferStream(this.m_curveData.m_segmentParams,p),n.writePoint2D(2*g,i.get().getStartXY()),_&&n.writePoint2D(2*h,i.get().getEndXY());continue}let d=2*g;n.queryPoint2D(d,c),e.transformInPlace(c),n.writePoint2D(d,c)}if(a===s)break}while(++a<o);this.notifyModifiedFlags(2001)}calculateSubLength2D(e,s,n,i){let o=this.getPathStart(e)+s,a=this.getPathStart(n)+i;(a<o||o<0||a>this.getPointCount()-1)&&re("");let h=this.querySegmentIterator(),m=0;h.resetToVertex(o,e);do{for(;h.hasNextSegment();){let l=h.nextSegment();if(h.getStartPointIndex()===a)break;m+=l.calculateLength2D()}if(h.getStartPointIndex()===a)break}while(h.nextPath());return m}calculatePathSubLength2D(e,s,n){let i=this.getPathStart(e)+s,o=this.getPathStart(e)+n;(i<0||o>this.getPointCount()-1)&&re("");let a=this.querySegmentIterator();if(i>o&&(this.isClosedPath(e)||U("cannot iterate across an open path"),a.setCirculator(!0)),i===o)return 0;let h=0,m=0;a.resetToVertex(i,e);do m+=h,h=a.nextSegment().calculateLength2D();while(a.getStartPointIndex()!==o);return m}calculateEnvelope2D(e){return this.updateXYImpl(e)}updateXYImpl(e){let s=super.updateXYImpl(e);if(this.hasNonLinearSegments()){let n=V.constructEmpty(),i=this.querySegmentIterator();for(;i.nextPath();)for(;i.hasNextSegment();){let o=i.nextCurve();if(!o)break;e?o.queryEnvelope(n):o.queryLooseEnvelope(n),s.mergeEnvelope2D(n)}}return s}notifyModifiedAllImpl(){this.m_paths!==null&&this.m_paths.size()?this.m_pointCount=this.m_paths.read(this.m_paths.size()-1):this.m_pointCount=0}setDirtyOGCFlags(e){this.setDirtyFlagProtected(16,e)}hasDirtyOGCStartFlags(){return this.hasDirtyFlag(16)}setDirtyRingAreas2D(e){this.setDirtyFlagProtected(1024,e)}hasDirtyRingAreas2D(){return this.hasDirtyFlag(1024)}static isNonLinearSegmentFlag(e){return!(1&e)}addAndExplicitlyOpenAllPaths(e,s){this===e&&U("Multi_path_impl::add");let n=this.getPathCount();for(let i=0,o=e.getPathCount();i<o;i++)this.addPath(e,i,!s),this.openPathAndDuplicateStartVertex(n),n++}getSegmentFlags(e){return this.m_curveData!==null&&this.m_curveData.m_segmentFlags!==null?this.m_curveData.m_segmentFlags.read(e):1}getSegmentBuffer(e,s,n){let i=this.getPathIndexFromPointIndex(e),o=e-this.getPathStart(i);o>=this.getSegmentCountPath(i)&&U("getSegmentBuffer"),this.getSegmentFromPath(i,o,s,n)}getSegmentTypeFromPath(e,s){let n=this.getPathStart(e)+s,i=this.getSegmentFlagsStreamRef(),o=1;switch(i&&(o=31&i.read(n)),o){case 1:return N.enumLine;case 2:return N.enumBezier;case 4:return N.enumEllipticArc;case 8:return N.enumRationalBezier2;case 16:return N.enumBezier2;default:j("")}}ensureXYMonotoneSegments(){if(!this.m_curveData)return!1;let e=!1;for(let s=0,n=this.getPathCount();s<n;s++){let i=this.getPathStart(s),o=this.getPathEnd(s),a=o-i;for(let h=i;h<o;h++){let m=31&this.m_curveData.m_segmentFlags.read(h);if(m===1)continue;m!==2&&ft("ensure_xy_monotone_segments");let l=(h-i+1)%a+i,u=this.m_curveData.m_segmentParamIndex.read(h),c=k(y,4);c[0]=this.getXY(h),c[3]=this.getXY(l),c[1].x=this.m_curveData.m_segmentParams.read(u),c[1].y=this.m_curveData.m_segmentParams.read(u+1),c[2].x=this.m_curveData.m_segmentParams.read(u+2),c[2].y=this.m_curveData.m_segmentParams.read(u+3),Xo(c)&&(e=!0,this.m_curveData.m_segmentParams.write(u,c[1].x),this.m_curveData.m_segmentParams.write(u+1,c[1].y),this.m_curveData.m_segmentParams.write(u+2,c[2].x),this.m_curveData.m_segmentParams.write(u+3,c[2].y))}}return e&&this.notifyModifiedFlags(2001),e}buildRasterizedGeometryAccelerator(e,s){return!1}buildQuadTreeAccelerator(e){if(this.m_accelerators||(this.m_accelerators=new Eo),this.m_accelerators.getQuadTree()!==null)return!0;this.ensureUniqueAccelerators(),this.m_accelerators.setQuadTree(null);let s=cn(this);return this.m_accelerators.setQuadTree(s),!0}buildQuadTreeForPathsAccelerator(e){if(this.m_accelerators||(this.m_accelerators=new Eo),this.m_accelerators.getQuadTreeForPaths()!==null)return!0;this.ensureUniqueAccelerators(),this.m_accelerators.setQuadTreeForPaths(null);let s=Bu(this);return this.m_accelerators.setQuadTreeForPaths(s),!0}updateCurveCounter(e){this.modifyCurveCounter(e-this.getCurveCount())}removeAllCurvesFromGlobalCounter(){this.m_curveData&&(r.st_totalCurveCount-=this.m_curveData.m_curveCount,this.m_curveData.m_curveCount=0,this.m_curveData.m_bezierCount=0,this.m_curveData.m_arcCount=0,this.m_curveData.m_bezier2Count=0,this.m_curveData.m_rbezier2Count=0,this.m_curveData.m_curveParamWritePoint=0)}modifyCurveCounter(e){e&&(this.m_curveData||(this.m_curveData=new ws),r.st_totalCurveCount+=e,this.m_curveData.m_curveCount+=e)}getCurveCount(){return this.m_curveData?this.m_curveData.m_curveCount:0}incCurveType(e,s){this.m_curveData||(this.m_curveData=new ws),2&e?this.m_curveData.m_bezierCount+=s:4&e?this.m_curveData.m_arcCount+=s:8&e?this.m_curveData.m_rbezier2Count+=s:16&e&&(this.m_curveData.m_bezier2Count+=s)}getCurveWritePoint(){return this.m_curveData!==null?this.m_curveData.m_curveParamWritePoint:0}initSegmentData(e){this.m_curveData===null&&(this.m_curveData=new ws);let s=this.m_reservedPointCount>0?this.m_reservedPointCount:this.m_pointCount;this.m_curveData.m_segmentParamIndex===null&&(this.m_curveData.m_segmentFlags=Zs(s,1),this.m_curveData.m_segmentParamIndex=Ce(s,-1));let n=this.m_curveData.m_curveParamWritePoint+e;this.m_curveData.m_segmentParams===null?this.m_curveData.m_segmentParams=mn(n):n!==this.m_curveData.m_segmentParams.size()&&this.m_curveData.m_segmentParams.resize(n,0),this.m_curveData.m_segmentFlags.size()<s&&(this.m_curveData.m_segmentFlags.resize(s,1),this.m_curveData.m_segmentParamIndex.resize(s,-1))}updateCurveWritePoint(e){this.m_curveData===null&&(this.m_curveData=new ws),this.m_curveData.m_curveParamWritePoint=e}updateOGCFlagsHelper(){let e=this.getPathCount();if(e===0)return;let s=this.m_pathFlags,n=0;for(let i=0;i<e;i++){let o=this.m_cachedRingAreas2D.read(i);n===0&&(n=Mt(o)),o*n>0||n===0?s.setBits(i,8):s.clearBits(i,8)}}updateOGCFlagsProtected(){this.hasDirtyFlag(16)&&(this.updateRingAreas2DProtected(),this.updateOGCFlagsHelper(),this.setDirtyFlagProtected(16,!1))}replaceSegment(e,s,n){(e<0||e>=this.getPointCount())&&U("Multi_path_impl.replace_segment"),w(s.isCurve());let i=this.getPathIndexFromPointIndex(e),o=this.getPathStart(i),a=(e-o+1)%this.getPathSize(i)+o;{let x=this.getXY(e),C=this.getXY(a),P=!x.isEqualPoint2D(s.getStartXY())||!C.isEqualPoint2D(s.getEndXY());w(!P)}let h=s.getDescription();this.mergeVertexDescription(h);let m=Z(32,Number.NaN),l=new st({vd:h,attribBuffer:m,initDefaultValues:!1}),u=this.m_curveData===null?1:31&this.m_curveData.m_segmentFlags.read(e),c=Cs(u),g=uh(s),d,_=!1;c>=g?(w(this.m_curveData!==null),_=!0,d=this.m_curveData.m_segmentParamIndex.read(e)):(this.initSegmentData(g),_=!1,d=this.m_curveData.m_curveParamWritePoint);let p=s.getGeometryType(),f=ws.toSegType(p);n||(s.queryStart(l),this.setPointByVal(e,l),s.queryEnd(l),this.setPointByVal(a,l)),this.m_curveData.m_segmentParamIndex.write(e,f!==1?d:-1),this.m_curveData.m_segmentFlags.write(e,f),f!==1&&s.writeInBufferStream(this.m_curveData.m_segmentParams,d),_||(this.m_curveData.m_curveParamWritePoint+=g),u!==f&&(this.incCurveType(u,-1),this.incCurveType(f,1),this.modifyCurveCounter(u===1?1:-1))}setAttributeImpl(e,s,n){if(this.addAttribute(e),!this.isEmpty())if(this.hasNonLinearSegments()&&e===0){(s<0||s>1)&&U("");let i=new ct,o=s===0?n:0,a=s===0?0:1;i.setShiftCoords(o,a),s===0?i.xx=0:i.yy=0,this.applyTransformation(i)}else super.setAttributeImpl(e,s,n)}}return r.st_totalCurveCount=0,r})(),tm=class{constructor(t,e){this.m_segIter=null,this.m_quadTree=null,this.m_qtIter=null,this.m_extentOfInterest=new V(e),this.m_bfirst=!0,this.m_prevIndex=-100,this.m_parent=t}nextSegment(){return this.m_bfirst&&this.prepare_(),this.m_quadTree?this.nextSegmentQt():this.nextSegmentNoQt()}getPathIndex(){return this.m_segIter.getPathIndex()}getStartPointIndex(){return this.m_segIter.getStartPointIndex()}getEndPointIndex(){return this.m_segIter.getEndPointIndex()}isClosingSegment(){return this.m_segIter.isClosingSegment()}isPathClosed(){return this.m_segIter.isPathClosed()}prepare_(){let t=this.m_parent.getAccelerators();t&&(this.m_quadTree=t.getQuadTree(),this.m_quadTree&&(this.m_qtIter=this.m_quadTree.getSortedIterator(this.m_extentOfInterest,0))),this.m_segIter=this.m_parent.querySegmentIterator()}nextSegmentQt(){this.m_bfirst=!1;let t=this.m_qtIter.next();if(t===-1)return null;let e=this.m_quadTree.getElement(t);return(e!==this.m_prevIndex+1||this.m_segIter.isLastSegmentInPath())&&(this.m_segIter.resetToVertex(e,this.m_segIter.getPathIndex()),this.m_prevIndex=e),this.m_segIter.nextSegment()}nextSegmentNoQt(){for(;;){if(!this.m_bfirst&&this.m_segIter.hasNextSegment()){let t=this.m_segIter.nextSegment(),e=V.constructEmpty();if(t.queryLooseEnvelope(e),!e.isIntersecting(this.m_extentOfInterest))continue;return t}if(this.m_bfirst=!1,!this.m_segIter.nextPath())return null}}},dt=class r extends bg{constructor(t){t?t.vd?(super({vd:t.vd,bPolygon:!1}),this.m_segmentBufferCTor=et):t.copy?(super({vd:t.copy.getDescription(),bPolygon:!1}),this.m_segmentBufferCTor=et,t.copy.copyTo(this)):t.move?(super({move:t.move}),this.m_segmentBufferCTor=et):t.start?(super({vd:t.start.getDescription(),bPolygon:!1}),this.m_segmentBufferCTor=et,this.startPathPoint(t.start),this.lineToPoint(t.end)):t.path?(super({bPolygon:!1}),this.m_segmentBufferCTor=et,this.addPathPoint2D(t.path,t.pointCount,t.bForward)):j("bad constructor arg"):(super({bPolygon:!1}),this.m_segmentBufferCTor=et)}getBoundary(){return Es(this)}assignCopy(t){return this!==t&&t.copyTo(this),this}assignMove(t){return t.copyTo(this),this}getGeometryType(){return r.type}getDimension(){return 1}createInstance(){return new r({vd:this.getDescription()})}equals(t,e){return this.equalsBase(t,e)}};dt.type=N.enumPolyline;var dn=N;function yn(r,t){if(r.isEmpty())return!1;let e=r.getGeometryType();if(e===dn.enumPolygon)return r.calculateArea2D()!==0;if(e===dn.enumPolyline)return wg(r.getImpl(),t,!0).bNotEmpty;if(e===dn.enumEnvelope)return!0;if(Qt(e))return!!r.isClosed();if(nn(e))return!1;if(e===dn.enumGeometryCollection){let s=r;for(let n=0,i=s.getGeometryCount();n<i;n++)if(yn(s.getGeometry(n),t))return!0;return!1}ft("")}function Es(r,t){let e=r.getGeometryType();if(e===dn.enumPolygon){let s=new dt({vd:r.getDescription()});return r.isEmpty()||r.copyToUnchecked(s),s}if(e===dn.enumPolyline)return wg(r.getImpl(),t,!1).boundary;if(e===dn.enumEnvelope){let s=new dt({vd:r.getDescription()});return r.isEmpty()||s.addEnvelope(r,!1),s}if(Qt(e)){let s=new Lt({vd:r.getDescription()});if(!r.isEmpty()&&!r.isClosed()){let n=new st;s.reserve(2),r.queryStart(n),s.add(n),r.queryEnd(n),s.add(n)}return s}if(e===dn.enumGeometryCollection){let s=r,n=null;for(let i=0,o=s.getGeometryCount();i<o;i++){let a=Es(s.getGeometry(i),t);if(a!==null){n===null&&(n=r.createInstance());let h=a;n.addGeometry(h)}}return n}if(nn(e))return new st({vd:r.getDescription()});ft("")}function wg(r,t,e){let n=r,i=null;if(e||(i=new Lt({vd:n.getDescription()})),!n.isEmpty()){let o=new he(0);for(let a=0,h=n.getPathCount();a<h;a++)if(n.getPathSize(a)>0&&!n.isClosedPathInXYPlane(a)){let m=n.getPathStart(a);o.add(m);let l=n.getPathEnd(a)-1;o.add(l)}if(o.size()>0){let a=new ei,h=n.getAttributeStreamRef(0),m={userSort(d,_,p){let f=y.getNAN(),x=y.getNAN();p.sort(d,_,(C,P)=>(h.queryPoint2D(2*C,f),h.queryPoint2D(2*P,x),f.compare(x)))},getValue:d=>h.read(2*d+1)};a.sort(o,0,o.size(),m);let l=h.readPoint2D(2*o.read(0)),u=0,c=1,g=new st;for(let d=1,_=o.size();d<_;d++){let p=h.readPoint2D(2*o.read(d));if(p.isEqualPoint2D(l))o.read(u)>o.read(d)?(o.write(u,We()),u=d):o.write(d,We()),c++;else{if(1&c){if(e)return{bNotEmpty:!0,boundary:new Lt({})}}else o.write(u,We());l=p,u=d,c=1}}if(1&c){if(e)return{bNotEmpty:!0,boundary:new Lt({})}}else o.write(u,We());if(!e){o.sort(0,o.size());for(let d=0,_=o.size();d<_&&o.read(d)!==We();d++)n.getPointByVal(o.read(d),g),i.add(g)}}}return e?{bNotEmpty:!1,boundary:new Lt({})}:{bNotEmpty:!1,boundary:i}}var gf=Ja/180,df=180/Ja;function _f(r){let t=r;return t>=-360&&t<720?(t<0?t+=360:t>=360&&(t-=360),t):(t=Xs(t,360),t<0&&(t+=360),t)}function Dg(r){let t=r;return t=_f(t),t>180&&(t-=360),t}function Em(r){return r*gf}function Dr(r){return r*df}function Tg(r){let t=ge(),e=r;return e>=-t&&e<2*t?(e<0&&(e+=t),e>=t&&(e-=t),e):(e=Xs(e,t),e<0&&(e+=t),e)}function Nc(r){let t=_t(),e=r;return e>-t&&e<=t||(e=Tg(e),e>t&&(e-=ge())),e}function Sm(r,t){return Dg(t-r)}var Ji=Ft,je=class r extends qn{constructor(t){if(t===void 0||qi(t,"vd"))return super({vd:t?.vd,XStart:0,YStart:0,XEnd:0,YEnd:0}),this.m_semiMajorAxis=0,this.m_minorMajorRatio=1,this.m_rotation=0,this.m_cosr=1,this.m_sinr=0,this.m_center=new y(0,0),this.m_sweepAngle=0,this.m_startAngle=0,this.m_interior=new y(0,0),void(this.m_bits=0);if(t.copy)return super(t),void(this!==t.copy&&(this.m_center=new y(0,0),this.m_interior=new y(0,0),t.copy.copyToImpl(this)));if(t.move)super(t),this.m_semiMajorAxis=t.move.m_semiMajorAxis,this.m_minorMajorRatio=t.move.m_minorMajorRatio,this.m_rotation=t.move.m_rotation,this.m_cosr=t.move.m_cosr,this.m_sinr=t.move.m_sinr,this.m_center=t.move.m_center.clone(),this.m_sweepAngle=t.move.m_sweepAngle,this.m_startAngle=t.move.m_startAngle,this.m_interior=t.move.m_interior.clone(),this.m_bits=t.move.m_bits,this.m_cachedValues=t.move.m_cachedValues,t.move.m_cachedValues=null;else{if(t.fromPoint)return super({XStart:0,YStart:0,XEnd:0,YEnd:0}),this.m_center=new y(0,0),this.m_interior=new y(0,0),void this.constructCircularArcThreePoint(t.fromPoint,t.toPoint,t.interiorPoint);if(t.center)return super({XStart:0,YStart:0,XEnd:0,YEnd:0}),this.m_center=new y(0,0),this.m_interior=new y(0,0),void this.constructCircleRadius(t.radius,t.center,t.bIsCounterClockwise);if(t.semiMajorAxis)return super({XStart:0,YStart:0,XEnd:0,YEnd:0}),void this.constructEllipticArcEndPoints(t.fromPoint,t.toPoint,t.semiMajorAxis,t.minorMajorRatio,t.axisXRotationRad,t.bBigArc,t.bIsCounterClockwise)}}getBoundary(){return Es(this)}assignCopy(t){return this!==t&&t.copyTo(this),this}constructCircleRadius(t,e,s=!1){return this.constructEllipse(t,1,e,0,s),this.setProjectionBehavior(0),this.afterCompletedModification(),this}constructCircleCenterAndPoint(t,e,s=!1){let n=y.distance(t,e);return this.constructEllipticArcEndPointsCenter(e,e,n,1,0,!0,s,t),this.setProjectionBehavior(0),this.afterCompletedModification(),this}constructTwoPointCircle(t,e,s=!1){let n=y.lerp(t,e,.5);return this.constructCircleCenterAndPoint(n,t,s),this}constructLineEllipticArc(t,e){return hs(this,t,e,1),this}constructLineCircularArc(t,e){return hs(this,t,e,0),this}constructEllipse(t,e,s,n,i=!1){this.m_semiMajorAxis=Math.abs(t),this.m_minorMajorRatio=Math.abs(e),this.m_minorMajorRatio>1&&(this.m_semiMajorAxis*=this.m_minorMajorRatio,this.m_minorMajorRatio=1/this.m_minorMajorRatio);let o=new y(0,this.m_minorMajorRatio*this.m_semiMajorAxis),a=Math.cos(n),h=Math.sin(n);return o.rotateDirect(a,h),o.addThis(s),this.constructEllipticArcEndPointsCenter(o,o,this.m_semiMajorAxis,this.m_minorMajorRatio,n,!0,i,s),this}inflate(t){if(this.isDegenerateToLine())return;let e=this.getSemiMinorAxis()+t;if(e=e<=0?0:(this.getSemiMajorAxis()+t)/this.getSemiMajorAxis(),this.isCircular()){let s=new ct;s.setShiftCoords(-this.m_center.x,-this.m_center.y),s.scale(e,e),s.shiftCoords(this.m_center.x,this.m_center.y),this.applyTransformation(s)}else{let s=new ct;this.canonicToWorldTransformation(s);let n=s.clone();n.invertPreciseThis(),n.scale(e,e),n.multiply(s),this.applyTransformation(n)}}constructEnclosingCircle(t,e,s=!1){return qf(this,t,e,s),this}constructThreePointCircle(t,e,s,n=!1){if(t.equals(e)||e.equals(s)||t.equals(s)){let i=t.clone(),o=e.clone(),a=s.clone();return i.equals(o)&&o.assign(a),this.constructTwoPointCircle(i,o,n)}{let i=y.calculateCircleCenterFromThreePoints(t,e,s);if(!i.isFinite()||!Number.isFinite(y.distance(t,i))){let o=y.distance(t,e),a=y.distance(t,s);this.constructLineCircularArc(t,o>=a?e:s)}return this.constructCircleCenterAndPoint(i,t,n)}}constructCircularArcThreePoint(t,e,s){let n=new H(t.x),i=new H(e.x),o=new H(s.x),a=new H(t.y),h=new H(e.y),m=new H(s.y),l=new H(.5),u=i.subE(n),c=h.subE(a),g=o.subE(n),d=m.subE(a),_=u.mulE(d).subThisE(c.mulE(g));if(_.scaleError(10),_.isZero()){if(!u.isZero()||!c.isZero())return hs(this,t,e,0),this;{let z=t.clone().addThis(e).mulThis(.5).addThis(s).mulThis(.5),Y=s.sub(z).length();this.constructEllipticArcEndPointsCenter(t,e,Y,1,0,!0,!1,z),this.m_interior.assign(s)}return this.setProjectionBehavior(0),this}let p=u.sqr().addThisE(c.sqr()).mulThisE(l),f=g.sqr().addThisE(d.sqr()).mulThisE(l),x=p.mulE(d).subThisE(f.mulE(c)),C=u.mulE(f).subThisE(g.mulE(p));x.divThisE(_),C.divThisE(_);let P=x.sqr().addThisE(C.sqr());P.sqrtThis();let E=x.addE(n),S=C.addE(a),I=t.x-E.value(),D=t.y-S.value(),b=Math.atan2(D,I);I=e.x-E.value(),D=e.y-S.value();let T=Math.atan2(D,I);I=s.x-E.value(),D=s.y-S.value();let A=Math.atan2(D,I),G=A-2*_t();for(;G<b;)G+=2*_t();let F=T-2*_t();for(;F<G;)F+=2*_t();let M=A+2*_t();for(;M>b;)M-=2*_t();let q,R=T+2*_t();for(;R>M;)R-=2*_t();q=F-b<b-R?F-b:R-b;let X=new y(E.value(),S.value());return this.constructEllipticArcEndPointsCenter(t,e,P.value(),1,0,Math.abs(q)>_t(),q>0,X),this.m_interior.assign(s),this.setProjectionBehavior(0),this.afterCompletedModification(),this}constructCircularArc(t,e,s,n){return this.constructEllipticArcGeneral(t,1,e,s,n,0),this.setProjectionBehavior(0),this.afterCompletedModification(),this}constructEllipticArcEndPoints(t,e,s,n,i,o,a){return Yc(this,t,e,s,n,i,o,a)}constructEllipticArcEndPointsCenter(t,e,s,n,i,o,a,h){return Yc(this,t,e,s,n,i,o,a,h)}constructEllipticArcGeneral(t,e,s,n,i,o){this.m_semiMajorAxis=Math.abs(t),this.m_minorMajorRatio=Math.abs(e),this.m_minorMajorRatio>1&&(this.m_semiMajorAxis*=this.m_minorMajorRatio,this.m_minorMajorRatio=1/this.m_minorMajorRatio);let a=Nc(o),h=Math.cos(a),m=Math.sin(a),l=new y(this.m_semiMajorAxis,this.m_minorMajorRatio*this.m_semiMajorAxis),u=y.getNAN(),c=Nc(n);u.x=l.x*Math.cos(c),u.y=l.y*Math.sin(c),u.rotateDirect(h,m),u.addThis(s);let g=wu(i,ge()),d=g;Math.abs(d)===ge()&&(d=0);let _=y.getNAN();return _.x=l.x*Math.cos(c+d),_.y=l.y*Math.sin(c+d),_.rotateDirect(h,m),_.addThis(s),this.constructEllipticArcEndPointsCenter(u,_,this.m_semiMajorAxis,this.m_minorMajorRatio,a,Math.abs(g)>_t(),g>0,s)}constructEllipticArcAsNURB(t,e,s,n){return(n>=1||n<0)&&U("construct_elliptic_arc_as_NURB: weight"),e.isFinite()||U("construct_elliptic_arc_as_NURB: control_point"),vr([t,e,s],n*n,null,!1,this),this}constructCanonic(t){return this.assignCopy(t),t.isDegenerateToLine()||t.m_center.isEqual(0,0)&&this.m_rotation===0||(this.m_XStart=t.getSemiMajorAxis()*Math.cos(t.m_startAngle),this.m_YStart=t.getSemiMinorAxis()*Math.sin(t.m_startAngle),this.m_XEnd=t.getSemiMajorAxis()*Math.cos(t.getEndAngle()),this.m_YEnd=t.getSemiMinorAxis()*Math.sin(t.getEndAngle()),this.m_center.setCoords(0,0),this.m_rotation=0,this.m_cosr=1,this.m_sinr=0,oi(this),this.afterCompletedModification(),t!==this&&Qc(this,t)),this}isCircular(){return this.m_minorMajorRatio===1&&this.m_rotation===0&&!this.isDegenerateToLine()}isDegenerateToLineHelper(t){return!!am(this,[t])&&wt(this)}isDegenerateToLine(){return wt(this)}getCenter(){return this.m_center.clone()}setCenter(t){if(!this.m_center.isNAN()){let e=t.sub(this.m_center);this.m_XStart+=e.x,this.m_YStart+=e.y,this.m_XEnd+=e.x,this.m_YEnd+=e.y,this.m_interior.addThis(e),this.m_center.assign(t),this.endPointModified(),this.normalizeAfterEndpointChange()}}getAxisXRotation(){return this.m_rotation}getSemiAxes(){return y.construct(this.m_semiMajorAxis,this.m_semiMajorAxis*this.m_minorMajorRatio)}getSemiMajorAxis(){return this.m_semiMajorAxis}getSemiMinorAxis(){return this.m_semiMajorAxis*this.m_minorMajorRatio}getMinorMajorRatio(){return this.m_minorMajorRatio}isClockwise(){return!ci(this)}isMajor(){return bm(this)}getSweepAngle(){return this.m_sweepAngle}getStartAngle(){return this.m_startAngle}getEndAngle(){return this.m_startAngle+this.m_sweepAngle}getGeometryType(){return N.enumEllipticArc}queryEnvelope(t){if(t.m_EnvelopeType===4){t.setEmpty(),t.assignVertexDescription(this.m_description);let e=V.constructEmpty();this.queryEnvelope(e),t.setEnvelope(e);for(let s=1,n=this.m_description.getAttributeCount();s<n;s++){let i=this.m_description.getSemantics(s);for(let o=0,a=Ji.getComponentCount(i);s<a;s++){let h=this.queryInterval(i,o);t.setIntervalEnvelope(i,o,h)}}}else t.m_EnvelopeType===2?Hc(this,B.unit(),t):ft("3d not impl")}applyTransformation(t){Im(this,t,!1)}createInstance(){return new r}calculateLength2D(){return Tf(this,0,1)}queryCoord2D(t,e){if(wt(this))um(t,this.getStartXY(),this.getEndXY(),e);else if(t===0)e.assign(y.construct(this.m_XStart,this.m_YStart));else if(t===1)e.assign(y.construct(this.m_XEnd,this.m_YEnd));else{let s=as(this,t),n=new y(this.m_semiMajorAxis*Math.cos(s),this.getSemiMinorAxis()*Math.sin(s));n.rotateDirect(this.m_cosr,this.m_sinr),n.addThis(this.m_center),e.assign(n)}}queryCoord2DE(t,e){vf(this,t,e)}getCoordX(t){let e=new y;return this.queryCoord2D(t,e),e.x}getCoordY(t){let e=new y;return this.queryCoord2D(t,e),e.y}cut(t,e,s){let n=new et;return this.queryCut(t,e,n,s),n.releaseSegment()}queryCut(t,e,s,n){let i=s.createEllipticArc(),o=t===0&&e===1;if(o&&!n)return void this.copyTo(i);let a=y.getNAN();this.queryCoord2D(t,a);let h=y.getNAN();if(this.queryCoord2D(e,h),!o){if(a.equals(h))e-t>.5&&this.isMajor()&&this.isClosed()?(o=!0,t=0,e=1):e===1?t=e:e=t;else if(t>0&&a.isEqual(this.m_XStart,this.m_YStart)&&(t=0),e<1&&h.isEqual(this.m_XEnd,this.m_YEnd)&&(e=1),o=t===0&&e===1,o&&!n)return void this.copyTo(i)}if(i.m_center.assign(this.m_center),i.m_semiMajorAxis=this.m_semiMajorAxis,i.m_minorMajorRatio=this.m_minorMajorRatio,i.m_interior.assign(this.m_interior),i.m_rotation=this.m_rotation,i.m_cosr=this.m_cosr,i.m_sinr=this.m_sinr,i.m_sweepAngle=this.m_sweepAngle,i.m_startAngle=this.m_startAngle,i.m_bits=this.m_bits,zu(i,a.x,a.y),Ou(i,h.x,h.y),o)return void fh(i,ph(this));i.m_startAngle=as(this,t),i.m_sweepAngle=as(this,e)-i.m_startAngle,i.m_startAngle=Vn(i.m_startAngle),gi(i,Math.abs(i.m_sweepAngle)>_t()),i.assignVertexDescription(this.m_description),oi(i),nm(i);let m=this.m_description.getAttributeCount();if(m>1){for(let l=1;l<m;l++){let u=this.m_description.getSemantics(l),c=Ji.getComponentCount(u);for(let g=0;g<c;g++){let d=this.getAttributeAsDbl(t,u,g);i.setStartAttribute(u,g,d)}}for(let l=1;l<m;l++){let u=this.m_description.getSemantics(l),c=Ji.getComponentCount(u);for(let g=0;g<c;g++){let d=this.getAttributeAsDbl(e,u,g);i.setEndAttribute(u,g,d)}}}i.afterCompletedModification()}queryDerivative(t,e){kf(this,t,e)}cutArcIgnoreAttributes(t,e,s){let n=t===0&&e===1,i=new y;this.queryCoord2D(t,i);let o=new y;this.queryCoord2D(e,o),n||(i.equals(o)?e-t>.5&&this.isMajor()&&this.isClosed()?(n=!0,t=0,e=1):e===1?t=e:e=t:(t>0&&i.isEqual(this.m_XStart,this.m_YStart)&&(t=0),e<1&&o.isEqual(this.m_XEnd,this.m_YEnd)&&(e=1),n=t===0&&e===1)),s.m_center.assign(this.m_center),s.m_semiMajorAxis=this.m_semiMajorAxis,s.m_minorMajorRatio=this.m_minorMajorRatio,s.m_interior.assign(this.m_interior),s.m_rotation=this.m_rotation,s.m_cosr=this.m_cosr,s.m_sinr=this.m_sinr,s.m_sweepAngle=this.m_sweepAngle,s.m_startAngle=this.m_startAngle,s.m_bits=this.m_bits,zu(s,i.x,i.y),Ou(s,o.x,o.y),n?fh(s,ph(this)):(s.m_startAngle=as(this,t),s.m_sweepAngle=as(this,e)-s.m_startAngle,s.m_startAngle=Vn(s.m_startAngle),gi(s,Math.abs(s.m_sweepAngle)>Math.PI),oi(s),s.afterCompletedModification())}changeEndPoints2D(t,e){qc(this,t,e,!1)}getAttributeAsDbl(t,e,s){if(e===0)return s===0?this.getCoordX(t):this.getCoordY(t);if(t===0)return this.getStartAttributeAsDbl(e,s);if(t===1)return this.getEndAttributeAsDbl(e,s);let n=this.calculateLength2D(),i=n>0?this.tToLength(t)/n:0,o=Ji.getInterpolation(e),a=this.getStartAttributeAsDbl(e,s),h=this.getEndAttributeAsDbl(e,s);return Jn(o,a,h,i,Ji.getDefaultValue(e))}getClosestCoordinate(t,e){return Lc(this,t,B.unit(),e)}getClosestCoordinateOnInterval(t,e,s=-1){return Lc(this,t,e,!1)}getYMonotonicParts(t,e=!1){t.length<2&&U("");let s=this.getSemiAxes(),n=Math.atan2(s.y*this.m_cosr,s.x*this.m_sinr),i=n+_t(),o=Z(3,Number.NaN),a=0;if(o[0]=Ht(this,n),o[0]>0&&o[0]<1&&a++,o[1]=Ht(this,i),o[1]>0&&o[1]<1&&(o[a]=o[1],a++),a===0)return 0;o[a]=1,a++,w(t.length>=a);let h=0;for(let m=0;m<a;m++){let l=o[m];this.queryCut(h,l,t[m],e),h=l}return a}getMonotonicParts(t,e){if(t.length<4&&U(""),this.isDegenerateToLine())return t[0].createEllipticArc().assignCopy(this),e&&t[0].get().dropAllAttributes(),1;let s=this.getSemiAxes(),n=Z(4,Number.NaN);n[0]=Math.atan2(s.y*this.m_cosr,s.x*this.m_sinr),n[1]=n[0]+_t(),n[2]=Math.atan2(-s.y*this.m_sinr,s.x*this.m_cosr),n[3]=n[2]+_t();let i=Z(5,Number.NaN),o=0;for(let h=0;h<4;h++)i[o]=Ht(this,n[h]),i[o]>0&&i[o]<1&&o++;if(o===0)return 0;Jr(i,o),i[o-1]<1&&(i[o]=1,o++),w(t.length>=o);let a=0;for(let h=0;h<o;h++){let m=i[h];this.queryCut(a,m,t[h],e),a=m}return o}intersectionWithAxis2D(t,e,s,n){if(wt(this))return new nt({start:this.getStartXY(),end:this.getEndXY()}).intersectionWithAxis2D(t,e,s,n);let i,o,a=new H(e),h=this.getSemiAxes();if(t){if(e>this.m_center.y+h.x||e<this.m_center.y-h.x)return 0;i=new H(h.x).mulThis(this.m_sinr),o=new H(h.y).mulThis(this.m_cosr),a.subThis(this.m_center.y)}else{if(e>this.m_center.x+h.x||e<this.m_center.x-h.x)return 0;i=new H(h.x).mulThis(this.m_cosr),o=new H(h.y).mulThis(-this.m_sinr),a.subThis(this.m_center.x)}let m=i.sqr(),l=o.sqr(),u=m.addE(l),c=o.mulE(a).mulThis(-2),g=a.sqr().subThisE(m),d=c.sqr().subThisE(u.mulE(g).mulThis(4)),_=i.mulE(a).mulThis(-2),p=a.sqr().subThisE(l),f=_.sqr().subThisE(u.mulE(p).mulThis(4)),x=d.eps()*Math.abs(f.value())<=f.eps()*Math.abs(d.value());x?i.isZero()&&(x=!1):o.isZero()&&(x=!0),x||(c.setE(_),g.setE(p));let C=k(H,2),P=Le(u,c,g,B.construct(-1,1),!1,C);if(P===0)return 0;let E=[0,0],S=0;for(let I=0;I<P;I++){let D=new H,b=new H;x?(D.setE(C[I]),b.setE(a.subE(o.mulE(C[I])).divThisE(i))):(b.setE(C[I]),D.setE(a.subE(i.mulE(C[I])).divThisE(o)));let T=Ht(this,Math.atan2(D.value(),b.value()));T>=0&&T<=1&&(E[S]=T,S++)}return P=S,P===0?0:(P===2&&E[0]>E[1]&&(E[1]=O(E[0],E[0]=E[1])),n&&ye(n,E,0,0,P),s&&(s[0]=t?this.getCoordX(E[0]):this.getCoordY(E[0]),P>1&&(s[1]=t?this.getCoordX(E[1]):this.getCoordY(E[1]),!n&&s[0]>s[1]&&(s[1]=O(s[0],s[0]=s[1])))),P)}intersectionOfYMonotonicWithAxisX(t,e){if(this.m_YStart===this.m_YEnd)return t===this.m_YStart?e:Number.NaN;if(t===this.m_YStart)return this.m_XStart;if(t===this.m_YEnd)return this.m_XEnd;let s=[0,0];return this.intersectionWithAxis2D(!0,t,s,null)===-1?e:s[0]}isCurve(){return!0}isDegenerate(t){return Fo(this,t)}isDegenerate3D(t,e){return w(0),!1}queryLooseEnvelope(t){t.m_EnvelopeType!==3?this.queryLooseEnvelopeOnInterval(new B(0,1),t):ft("3d not impl")}clone(t){let e=new r;return this.copyTo(e),e}queryInterval(t,e){if(t===0){if(wt(this))return e===0?B.construct(this.getStartX(),this.getEndX()):B.construct(this.getStartY(),this.getEndY());let s,n=this.getSemiAxes();s=e===0?Math.atan2(-n.y*this.m_sinr,n.x*this.m_cosr):Math.atan2(n.y*this.m_cosr,n.x*this.m_sinr);let i=s+Math.PI,o=[0,0];o[0]=Ht(this,s),o[1]=Ht(this,i);let a=e===0?B.construct(this.getStartX(),this.getEndX()):B.construct(this.getStartY(),this.getEndY()),h=new y;for(let m=0;m<2;m++){let l=o[m];l>0&&l<1&&(this.queryCoord2D(l,h),a.mergeNeCoordinate(e===0?h.x:h.y))}return a}return super.queryInterval(t,e)}queryLooseEnvelopeOnInterval(t,e){let s=new B(0,1);if(s.intersect(t),s.isEmpty())return void e.setEmpty();if(wt(this))return e.setCoords(this.getCoord2D(s.vmin)),void e.mergeNe(this.getCoord2D(s.vmax));let n=this.getCoord2D(s.vmin),i=this.getCoord2D(s.vmax);if(this.m_minorMajorRatio===1&&Math.abs(this.m_sweepAngle)*s.width()<=ut){let o=y.lerp(n,i,.5),a=o.sub(this.m_center);return a.normalize(),o=o.add(a.mul(.5*y.distance(n,i))),e.setCoords(n),e.mergeNe(i),void e.mergeNe(o)}Hc(this,s,e)}tToLength(t){return wt(this)?t*y.distance(this.getStartXY(),this.getEndXY()):this.m_minorMajorRatio===1?Math.abs(this.getSweepAngle()*t)*this.m_semiMajorAxis:im(this,t)}parametricAngleToT(t){return Ht(this,t)}tToParametricAngle(t){return as(this,t)}lengthToT(t){if(wt(this)){let e=y.distance(this.getStartXY(),this.getEndXY());return e===0?0:t/e}if(this.m_minorMajorRatio===1){let e=Math.abs(this.getSweepAngle())*this.m_semiMajorAxis;return e===0?0:t/e}return Mf(this,t)}calculateWeightedAreaCentroid2D(t){if(wt(this)){let l=new y;return l.setCoords(0,0),l}let e=kc(this),s=this.getStartXY().sub(this.m_center),n=this.getEndXY().sub(this.m_center),i=this.m_semiMajorAxis,o=this.getSemiMinorAxis(),a=this.m_startAngle+this.m_sweepAngle,h=new y;h.x=i*o*(i*this.m_cosr*(-Math.sin(a)+Math.sin(this.m_startAngle))+o*(-Math.cos(a)+Math.cos(this.m_startAngle))*this.m_sinr)/3,h.y=i*o*(o*(Math.cos(a)-Math.cos(this.m_startAngle))*this.m_cosr+i*(-Math.sin(a)+Math.sin(this.m_startAngle))*this.m_sinr)/3;let m=n.add(s).mul(n.crossProduct(s)/6);return h.x-=m.x,h.y-=m.y,h.add(this.m_center.sub(t).mul(e))}calculateWeightedCentroid2D(){let t=new y;if(this.isDegenerate(0))return t.setCoords(0,0),t;if(wt(this))return t.assign(this.getCoord2D(.5).mul(this.calculateLength2D())),t;let e=this.m_startAngle,s=this.m_startAngle+this.m_sweepAngle;if(s<e){let h=e;e=s,s=h}let n=Math.sin(e),i=Math.sin(s),o=Math.cos(e),a=Math.cos(s);if(this.m_minorMajorRatio===1){let h=this.getSemiMajorAxis(),m=h*h,l=m*(i-n),u=m*(o-a);t.setCoords(l,u)}else{let h=this.getSemiMajorAxis(),m=this.getSemiMinorAxis(),l=h*h,u=m*m,c=h*m,g=l-u,d=g/u,_=g/l,p=Math.sqrt(d),f=Math.sqrt(_),x=.5*c*(Math.asinh(p*i)/p+i*Math.sqrt(1+d*i*i))-.5*c*(Math.asinh(p*n)/p+n*Math.sqrt(1+d*n*n)),C=-.5*c*(Math.asin(f*a)/f+a*Math.sqrt(1-_*a*a))- -.5*c*(Math.asin(f*o)/f+o*Math.sqrt(1-_*o*o));t.setCoords(x,C)}return t.rotateDirect(this.m_cosr,this.m_sinr),t.assign(t.add(this.m_center.mul(this.calculateLength2D()))),t}isIntersectingPoint(t,e,s){if(s&&(t.isEqualPoint2D(this.getStartXY())||t.isEqualPoint2D(this.getEndXY())))return!1;if(!wt(this)){let o=y.distance(t,this.m_center),a=this.getSemiAxes();if(o<a.x-e||o>a.y+e)return!1}let n=this.getClosestCoordinate(t,!1),i=new y;return this.queryCoord2D(n,i),y.distance(i,t)<=e}isIntersectingPoint3D(t,e,s,n,i=1){return w(0),!1}getTangent(t){if(wt(this))return this.getEndXY().sub(this.getStartXY());{let e=as(this,t),s=new y;return s.setCoords(-this.m_semiMajorAxis*Math.sin(e),this.getSemiMinorAxis()*Math.cos(e)),this.m_rotation&&s.rotateDirect(this.m_cosr,this.m_sinr),s.scale(this.getSweepAngle()),s}}getDerivative(t){if(wt(this))return this.getEndXY().sub(this.getStartXY());{let e=as(this,t),s=new y;return s.setCoords(-this.m_semiMajorAxis*Math.sin(e),this.getSemiMinorAxis()*Math.cos(e)),this.m_rotation&&s.rotateDirect(this.m_cosr,this.m_sinr),s.scale(this.getSweepAngle()),s}}normalizeAfterEndpointChange(){return!!Vg(this)&&(wt(this)?(yo(this),!1):qg(this,!1))}projectionBehavior(){return(4&this.m_bits)>>2}setProjectionBehavior(t){this.m_bits=-5&this.m_bits|t<<2}convertToCanonic(t){let e=new y(t.x,t.y);return e.subThis(this.m_center),e.rotateReverse(this.m_cosr,this.m_sinr),e}convertFromCanonic(t){let e=new y(t.x,t.y);return e.rotateDirect(this.m_cosr,this.m_sinr),e.addThis(this.m_center),e}canonicToWorldTransformation(t){t.setRotate(this.m_cosr,this.m_sinr),t.shiftCoords(this.m_center.x,this.m_center.y)}getCurvature(t){let e=as(this,t),s=new y,n=this.getSemiMinorAxis();s.setCoords(-this.m_semiMajorAxis*Math.sin(e),n*Math.cos(e));let i=new y;i.setCoords(-this.m_semiMajorAxis*Math.cos(e),-n*Math.sin(e)),this.m_rotation&&(s.rotateDirect(this.m_cosr,this.m_sinr),i.rotateDirect(this.m_cosr,this.m_sinr));let o=s.sqrLength();if(o===0)return Number.NaN;let a=Math.sqrt(o);return s.divThis(a),s.crossProduct(i)/o}getMonotonicPartParams(t,e){let s=Z(6,Number.NaN);s[0]=0;let n=1;if(this.isDegenerateToLine())s[1]=1,n=2;else{let i=this.getSemiAxes(),o=Z(4,Number.NaN);this.m_rotation?(o[0]=Math.atan2(i.y*this.m_cosr,i.x*this.m_sinr),o[1]=o[0]+Math.PI,o[2]=Math.atan2(-i.y*this.m_sinr,i.x*this.m_cosr),o[3]=o[2]+Math.PI):(o[0]=0,o[1]=Math.PI,o[2]=.5*Math.PI,o[3]=Du());for(let a=0;a<4;a++){let h=Ht(this,o[a]);h>0&&h<1&&(s[n]=h,n++)}n>2&&Jr(s,n),s[n]=1,n++}if(e){t<n&&U("");for(let i=0;i<n;i++)e[i]=s[i]}return n}calculateLowerLength2D(){let t=y.distance(this.getStartXY(),this.getEndXY());if(this.isDegenerateToLine())return t;let e=Math.abs(this.m_sweepAngle)*this.getSemiMinorAxis();return Math.max(e,t)}calculateUpperLength2D(){let t=y.distance(this.getStartXY(),this.getEndXY());if(this.isDegenerateToLine())return t;let e=Math.abs(this.m_sweepAngle)*this.getSemiMajorAxis();return Math.max(e,t)}orientBottomUp(){if(this.m_YEnd<this.m_YStart||this.m_YEnd===this.m_YStart&&this.m_XEnd<this.m_XStart){this.m_XEnd=O(this.m_XStart,this.m_XStart=this.m_XEnd),this.m_YEnd=O(this.m_YStart,this.m_YStart=this.m_YEnd);for(let t=0,e=this.m_description.getTotalComponentCount()-2;t<e;t++)this.m_attributes[t+e]=O(this.m_attributes[t],this.m_attributes[t]=this.m_attributes[t+e]);this.m_startAngle=this.m_startAngle+this.m_sweepAngle,this.m_sweepAngle=-this.m_sweepAngle}}isLine(){return wt(this)}copyIgnoreAttributes(t){t.m_XStart=this.m_XStart,t.m_YStart=this.m_YStart,t.m_XEnd=this.m_XEnd,t.m_YEnd=this.m_YEnd,t.m_center.assign(this.m_center),t.m_semiMajorAxis=this.m_semiMajorAxis,t.m_minorMajorRatio=this.m_minorMajorRatio,t.m_interior.assign(this.m_interior),t.m_rotation=this.m_rotation,t.m_cosr=this.m_cosr,t.m_sinr=this.m_sinr,t.m_sweepAngle=this.m_sweepAngle,t.m_startAngle=this.m_startAngle,t.m_bits=this.m_bits,xo(t)}calculateArea2DHelper(){return kc(this)}absNorm(){let t=this.getStartXY().norm(1)+this.getEndXY().norm(1);return this.isDegenerateToLine()||(t+=this.m_center.norm(1),t+=this.m_semiMajorAxis),t}queryEnvelopeW(t,e){if(e.setCoords(this.getCoord2D(t.vmin)),e.mergeNe(this.getCoord2D(t.vmax)),wt(this))return;let s=this.getSemiAxes(),n=Z(8,Number.NaN);{let o=Math.atan2(-s.y*this.m_sinr,s.x*this.m_cosr),a=o+Math.PI,h=Math.atan2(s.y*this.m_cosr,s.x*this.m_sinr),m=h+Math.PI;n[0]=Ht(this,o),n[1]=Ht(this,a),n[2]=Ht(this,h),n[3]=Ht(this,m)}{let o=this.m_cosr+this.m_sinr,a=this.m_cosr-this.m_sinr,h=Math.atan2(-s.y*o,s.x*a),m=h+Math.PI,l=Math.atan2(s.y*a,s.x*o),u=l+Math.PI;n[4]=Ht(this,h),n[5]=Ht(this,m),n[6]=Ht(this,l),n[7]=Ht(this,u)}let i=y.getNAN();for(let o=0;o<8;o++){let a=n[o];t.containsExclusiveCoordinate(a)&&(this.queryCoord2D(a,i),e.mergeNe(i))}}setSegmentFromCoords(t,e){Nf(this,t,e)}writeInBufferStream(t,e){let s=new Float64Array(10);return s[0]=this.m_bits,s[1]=this.m_semiMajorAxis,s[2]=this.m_minorMajorRatio,s[3]=this.m_rotation,s[4]=this.m_center.x,s[5]=this.m_center.y,s[6]=this.m_sweepAngle,s[7]=this.m_startAngle,s[8]=this.m_interior.x,s[9]=this.m_interior.y,t.writeRangeFromArray(e,s.length,s,!0,1),e+s.length}readFromBufferStream(t,e){let s=new Float64Array(10);t.queryRange(e,s.length,s,!0,1),this.m_bits=s[0],this.m_semiMajorAxis=s[1],this.m_minorMajorRatio=s[2],this.m_rotation=s[3],this.m_center.x=s[4],this.m_center.y=s[5],this.m_sweepAngle=s[6],this.m_startAngle=s[7],this.m_interior.x=s[8],this.m_interior.y=s[9],this.m_cosr=Math.cos(this.m_rotation),this.m_sinr=Math.sin(this.m_rotation),this.m_cachedValues=null}snapControlPoints(t){return!1}needsSnapControlPoints(t){return!1}calculateSpecialPointsForCracking(t,e){return j("should not1; be called"),0}ensureXYMonotone(){if(wt(this))return!1;if(this.getStartXY().equals(this.getEndXY()))return hs(this,this.getStartXY(),this.getEndXY(),this.projectionBehavior()),!0;let t=k(y,3),e=wm(this,t);if(Xn(t)){let s=!1;if(this.projectionBehavior()===0){let n=new V;n.setCoords({pt:t[0]}),n.mergeNe(t[2]);let i=new y;i.setSub(t[2],t[0]),i.leftPerpendicularThis(),i.normalize(),i.scale(y.distance(t[2],t[0]));let o=y.lerp(t[2],t[0],.5),a=o.sub(i),h=o.add(i);n.clipLine(a,h);let m=y.getClosestCoordinate(a,h,t[1],!1);t[1]=y.lerp(a,h,m);let l=t[2].sub(t[1]),u=t[0].sub(t[1]),c=l.crossProduct(u),g=l.dotProduct(u);e=ks()-Math.abs(.5*Math.atan2(c,g)),s=!0}return vr(t,e*e,null,s,this),!0}return!1}setCoordsForIntersector(t,e,s){qc(this,t,e,s)}getInteriorPoint(){return this.m_interior.clone()}copyToImpl(t){let e=t;e.m_center.assign(this.m_center),e.m_semiMajorAxis=this.m_semiMajorAxis,e.m_minorMajorRatio=this.m_minorMajorRatio,e.m_interior.assign(this.m_interior),e.m_rotation=this.m_rotation,e.m_cosr=this.m_cosr,e.m_sinr=this.m_sinr,e.m_sweepAngle=this.m_sweepAngle,e.m_startAngle=this.m_startAngle,e.m_bits=this.m_bits,fh(e,ph(this))}reverseImpl(){ko(this,!ci(this)),nm(this),(this.projectionBehavior()!==0||this.getStartXY().equals(this.getEndXY()))&&oi(this)}equalsImpl(t){let e=t;if(this.m_bits!==e.m_bits||this.m_semiMajorAxis!==e.m_semiMajorAxis||this.m_minorMajorRatio!==e.m_minorMajorRatio||!(this.m_center.isEqualPoint2D(e.m_center)||this.m_center.isNAN()&&e.m_center.isNAN())||this.m_rotation!==e.m_rotation||!this.m_interior.equals(e.m_interior))return!1;let s=e.m_sweepAngle;if(this.m_sweepAngle!==s)return!1;let n=e.m_startAngle;return this.m_startAngle===n}equalsImplTol(t,e){let s=t;if(this.m_bits!==s.m_bits)return!1;if(this.m_center.isNAN()&&s.m_center.isNAN())return!0;if(this.m_center.isNAN()!==s.m_center.isNAN()||!this.getSemiAxes().isEqualPoint2D(s.getSemiAxes(),e)||!this.m_center.isEqualPoint2D(s.m_center,e))return!1;let n=Math.abs(Em(Dg(Dr(this.m_rotation-s.m_rotation)))),i=Math.abs(_t()-n),o=Math.min(n,i);if(this.m_semiMajorAxis*Math.abs(o)>e)return!1;let a=this.getCoord2D(.5),h=s.getCoord2D(.5);return!!a.isEqualPoint2D(h,e)}swapImpl(t){let e=t;this.m_center=O(e.m_center,e.m_center=this.m_center),this.m_semiMajorAxis=O(e.m_semiMajorAxis,e.m_semiMajorAxis=this.m_semiMajorAxis),this.m_minorMajorRatio=O(e.m_minorMajorRatio,e.m_minorMajorRatio=this.m_minorMajorRatio),this.m_interior=O(e.m_interior,e.m_interior=this.m_interior),this.m_rotation=O(e.m_rotation,e.m_rotation=this.m_rotation),this.m_cosr=O(e.m_cosr,e.m_cosr=this.m_cosr),this.m_sinr=O(e.m_sinr,e.m_sinr=this.m_sinr),this.m_sweepAngle=O(e.m_sweepAngle,e.m_sweepAngle=this.m_sweepAngle),this.m_startAngle=O(e.m_startAngle,e.m_startAngle=this.m_startAngle),this.m_bits=O(e.m_bits,e.m_bits=this.m_bits),Ff(this,e)}afterCompletedModification(){yo(this),xo(this)}intersect(t,e,s,n,i){return Pn(!1,this,t,e,s,n,i)}intersectPoint(t,e,s){if(e.length<2&&xt(""),wt(this))return new nt({start:this.getStartXY(),end:this.getEndXY()}).intersectPoint(t,e,s);{let o=y.distance(t,this.m_center);if(o>this.m_semiMajorAxis+s||o<this.getSemiMinorAxis()-s)return 0}let n=this.getClosestCoordinate(t,!1),i=y.getNAN();return this.queryCoord2D(n,i),y.distance(i,t)<=s?bt(n,0,1)&&(this.queryCoord2D(n===0?1:0,i),y.distance(i,t)<=s)?(e&&(e[0]=0,e[1]=1),2):(e&&(e[0]=n),1):0}isIntersecting(t,e,s){return Hn(!1,this,t,e,s)!==0}endPointModified(){this.m_bits|=8,xo(this)}clearEndPointModified(){yo(this)}};function xE(r,t,e){r.isEmpty()&&Gi(""),rn(r);let s=r.getImpl(),n=[];return Ng(s.getPointCount(),n),Ag(ff(s),n,s.getPointCount(),t)}function pf(r,t,e,s){let n=[];return Ng(t,n),Ag(r,n,t,e)}function ff(r){return{at:t=>r.getXY(t)}}function Ng(r,t){t.length=r;for(let e=0;e<t.length;++e)t[e]=e;r>3&&lp(r,t)}function Ag(r,t,e,s,n){let i=0,o=[0,0,0],a=0,h=3,m=0;for(let l=0;l<h;++l){let u=!1;for(;m<e;){let c=r.at(t[m]),g=1;if(i===3?g=y.inCircleRobust(r.at(s[0]),r.at(s[1]),r.at(s[2]),c):i===2?g=y.inCircleRobust3Point(r.at(s[0]),r.at(s[1]),c):i===1&&c.equals(r.at(s[0]))&&(g=0),g<=0){if(g<0&&l+1<h){t[a]=O(t[m],t[m]=t[a]);for(let _=0;_<i;_++)if(s[_]===t[m]){o[_]=m;break}a++}m++;continue}u=!0;let d=0;for(let _=0;_<i;_++)o[_]>m&&(s[d]=s[_],o[d]=o[_],d++);i=d,s[i]=t[m],o[i]=m,i++,i<3?m=a:(y.orientationRobust(r.at(s[0]),r.at(s[1]),r.at(s[2]))===1&&(s[2]=O(s[0],s[0]=s[2]),o[2]=O(o[0],o[0]=o[2])),m++)}if(!u)break;if(l+1<h){a=0;let c=!1;for(let g=0;g<i;g++)for(let d=g+1;d<i;d++)o[g]>o[d]&&(o[d]=O(o[g],o[g]=o[d]),s[d]=O(s[g],s[g]=s[d]),c=!0);for(let g=0;g<i;g++)t[o[g]]=O(t[g],t[g]=t[o[g]]),o[g]=g;c&&i===3&&y.orientationRobust(r.at(s[0]),r.at(s[1]),r.at(s[2]))===1&&(s[2]=O(s[0],s[0]=s[2]),o[2]=O(o[0],o[0]=o[2]))}m=i}return i}je.type=N.enumEllipticArc;var lt=class r extends bg{constructor(t){t?t.vd?(super({vd:t.vd,bPolygon:!0}),this.m_segmentBufferCTor=et):t.copy?(super({vd:t.copy.getDescription(),bPolygon:!0}),this.m_segmentBufferCTor=et,t.copy.copyTo(this)):t.move?(super({move:t.move}),this.m_segmentBufferCTor=et):t.envelope?ft("envelope constructor not impl"):j("bad arg to polygon constructor"):(super({bPolygon:!0}),this.m_segmentBufferCTor=et)}assignMove(t){return t.copyTo(this),this}assignCopy(t){return t.copyTo(this),this}getBoundary(){return Es(this)}getExteriorRingCount(){return this.getOGCPolygonCount()}getGeometryType(){return r.type}getDimension(){return 2}createInstance(){return new r({vd:this.getDescription()})}equals(t,e){return this.equalsBase(t,e)}};function Mg(r,t,e,s,n,i){return new Sr(0,0,0,null,!1,Pe()).densifyEx(r,t,e,s,!1,i)}function yE(r,t,e,s){return Number.isFinite(t)||U("replace_all_curves_with_beziers: maxDeviation"),Cf(N.enumBezier,r,t,e)}function Tr(r,t,e,s,n,i,o,a){i&&(i.length=0),o&&(o.length=0);let h=r.getGeometryType();if(h===N.enumLine)return i&&(i.push(r.getStartXY()),i.push(y.getNAN()),i.push(y.getNAN()),i.push(r.getEndXY())),o&&(o.push(0),o.push(1)),1;if(h===N.enumBezier){if(!s)return i&&(i.push(r.getStartXY()),i.push(r.getControlPoint1()),i.push(r.getControlPoint2()),i.push(r.getEndXY())),o&&(o.push(0),o.push(1)),1;let m=Z(9,Number.NaN),l=r.getMonotonicPartParams(m.length,m);if(m.length=l,l=Ns(r,e,m),l===2&&n&&(m[1]=.5,m.push(1),l=3),o&&o.splice(0,0,...m.slice(0,l)),i){let u=new et;for(let c=1;c<l;c++){let g=m[c-1],d=m[c];r.queryCut(g,d,u,!0);let _=u.get();No(_),c===1&&i.push(_.getStartXY()),i.push(_.getControlPoint1()),i.push(_.getControlPoint2()),i.push(_.getEndXY())}}return l-1}if(h===N.enumEllipticArc){let m=r;if(m.isDegenerateToLine()||m.isDegenerate(0))return i&&(i.push(r.getStartXY()),i.push(y.getNAN()),i.push(y.getNAN()),i.push(r.getEndXY())),o&&(o.push(0),o.push(1)),1;if(s&&(n||!m.isMonotoneQuickAndDirty())){let l=Z(6,Number.NaN),u=m.getMonotonicPartParams(l.length,l);l.length=u,u=Ns(r,e,l),u===2&&n&&(l[1]=.5,l.push(1),u=3);let c=0;if(u>2){let g=new et,d=o||[],_=0;for(let p=1;p<u;p++){let f=l[_],x=l[p];if(m.queryCut(f,x,g,!0),g.get().isDegenerate(0))continue;let C=d.length,P=em(p===1,g.get(),t,e,s,i,o);w(P>0),c+=P;let E=p===u-1,S=l[_],I=g.get().getSweepAngle()/m.getSweepAngle();for(let D=C,b=d.length;D<b;D++)if(d[D]=!E||D+1<b?S+d[D]*I:1,i){let T=3*D,A=m.getCoord2D(d[D]);i[T].setCoordsPoint2D(A),T>0&&Xo(i.slice(T-3))}_=p}return c}}return em(!0,m,t,e,s,i,o)}if(h===N.enumRationalBezier2){let m=r;if(s&&(n||!m.isMonotoneQuickAndDirty())){let l=Z(6,Number.NaN),u=m.getMonotonicPartParams(l.length,l);l.length=u,u=Ns(r,e,l),u===2&&n&&(l[1]=.5,l.push(1),u=3);let c=0;if(u>2){let g=new et,d=o||[];for(let _=1;_<u;_++){let p=l[_-1],f=l[_];m.queryCut(p,f,g,!0);let x=d.length;c+=Mc(_===1,g.get(),t,e,!1,i,o);let C=_===u-1,P=l[_-1];for(let E=x,S=d.length;E<S;E++)if(d[E]=!C||E+1<S?P+d[E]:1,i){let I=3*E,D=m.getCoord2D(d[E]);i[I].setCoordsPoint2D(D),I>0&&ir(i.slice(I-3))}}return c}}return Mc(!0,m,t,e,s,i,o)}if(h===N.enumBezier2){let m=r,l=k(y,3);m.queryControlPoints(l);let u=new Ge;return u.constructFromQuadratic(l),Tr(u,t,e,s,n,i,o)}ft("")}function xf(r,t,e,s,n,i,o,a){i.length=0,o.length=0;let h=r.getGeometryType();if(h===N.enumLine)return i.push(r.getStartXY()),i.push(y.getNAN()),i.push(r.getEndXY()),o.push(0),o.push(1),1;if(h===N.enumBezier2){let m=Z(9,Number.NaN),l=r.getMonotonicPartParams(m.length,m);m.length=l,l=Ns(r,e,m),o.splice(0,0,...m.slice(0,l));{let u=new et;for(let c=1;c<l;c++){let g=m[c-1],d=m[c];r.queryCut(g,d,u,!0);let _=u.get();To(_),c===1&&i.push(_.getStartXY()),i.push(_.getControlPoint1()),i.push(_.getEndXY())}}return l-1}if(h===N.enumEllipticArc){let m=r;if(m.isDegenerateToLine()||m.isDegenerate(0))return i.push(r.getStartXY()),i.push(y.getNAN()),i.push(r.getEndXY()),o.push(0),o.push(1),1;if(!m.isMonotoneQuickAndDirty()){let l=Z(6,Number.NaN),u=m.getMonotonicPartParams(l.length,l);l.length=u,u=Ns(r,e,l);let c=0;if(u>2){let g=new et,d=o;for(let _=1;_<u;_++){let p=l[_-1],f=l[_];m.queryCut(p,f,g,!0);let x=d.length;c+=Ef(_===1,g.get(),t,e,!1,i,o);let C=_===u-1,P=l[_-1],E=g.get().getSweepAngle()/m.getSweepAngle();for(let S=x,I=d.length;S<I;S++){d[S]=!C||S+1<I?P+d[S]*E:1;{let D=2*S,b=m.getCoord2D(d[S]);i[D].setCoordsPoint2D(b),D>0&&ir(i.slice(D-2))}}}return c}}return em(!0,m,t,e,s,i,o)}if(h===N.enumBezier){let m=r;if(!m.isMonotoneQuickAndDirty()){let l=Z(6,Number.NaN),u=m.getMonotonicPartParams(l.length,l);l.length=u,u=Ns(r,e,l);let c=0;if(u>2){let g=new et,d=o;for(let _=1;_<u;_++){let p=l[_-1],f=l[_];m.queryCut(p,f,g,!0);let x=d.length;c+=Gc(_===1,g.get(),t,e,!1,i,o);let C=_===u-1,P=l[_-1];for(let E=x,S=d.length;E<S;E++){d[E]=!C||E+1<S?P+d[E]:1;{let I=2*E,D=m.getCoord2D(d[E]);i[I].setCoordsPoint2D(D),I>0&&ir(i.slice(I-2))}}}return c}}return Gc(!0,m,t,e,s,i,o)}if(h===N.enumRationalBezier2){let m=r;if(!m.isMonotoneQuickAndDirty()){let l=Z(6,Number.NaN),u=m.getMonotonicPartParams(l.length,l);l.length=u,u=Ns(r,e,l);let c=0;if(u>2){let g=new et,d=o;for(let _=1;_<u;_++){let p=l[_-1],f=l[_];m.queryCut(p,f,g,!0);let x=d.length;c+=Ac(_===1,g.get(),t,e,!1,i,o);let C=_===u-1,P=l[_-1];for(let E=x,S=d.length;E<S;E++){d[E]=!C||E+1<S?P+d[E]:1;{let I=2*E,D=m.getCoord2D(d[E]);i[I].setCoordsPoint2D(D),I>0&&ir(i.slice(I-2))}}}return c}}return Ac(!0,m,t,e,s,i,o)}ft("")}function Er(r,t,e,s,n,i,o,a,h){let m=r.getGeometryType();if(i&&(i.length=0,o.length=0),a&&(a.length=0),m===N.enumEllipticArc){let c=r;if(c.isDegenerateToLine()||c.isDegenerate(0))return i&&(i.push(r.getStartXY()),i.push(y.getNAN()),i.push(r.getEndXY()),o.push(Number.NaN),o.push(Number.NaN),o.push(Number.NaN)),a&&(a.push(0),a.push(1)),1}let l=Z(9,Number.NaN),u;if(n)u=r.getMonotonicPartParams(l.length,l),l.length=u,u=Ns(r,e,l);else{if(u=2,l[0]=0,l[1]=1,m===je.type){let c=r.getSweepAngle();if(c>.9*Math.PI){let g=2*Math.PI/3;Math.min(3,Math.trunc(c/g+.5))>2?(l[0]=0,l[1]=1/3,l[2]=2/3,l[3]=1,u=4):(l[0]=0,l[1]=.5,l[2]=1,u=3)}}else w(m===_e.type);l.length=u}if(u===2&&s&&(l[1]=.5,l.push(1),u=3),i){let c=new et,g=1;for(;g<u;){let d=l[g-1],_=l[g];r.queryCut(d,_,c,!0);let p=k(y,3),f=[1,1,1];if(m===N.enumEllipticArc){let x=c.get();if(Math.abs(x.getSweepAngle())>.9*Math.PI){let C=(_-d)/3;l.splice(g,0,d+C),l.splice(g+1,0,d+2*C),u+=2;continue}f[1]=wm(x,p)}else{let x=c.get();x.queryControlPoints(p),x.queryWeights(f)}n&&Xn(p),g===1&&(i.push(p[0].clone()),o.push(f[0])),i.push(p[1].clone()),i.push(p[2].clone()),o.push(f[1]),o.push(f[2]),g++}}return a&&(a.length=u,ye(a,l,0,0,u)),u-1}lt.type=N.enumPolygon;var Sr=class r{static constructDefault(t){return new r(0,0,0,t,!1,Pe())}constructor(t,e,s,n,i,o){this.m_segmentBuffer=null,this.m_dummyPoint=new st,this.m_progressCounter=0,this.m_progressTracker=n,this.m_bSetDensifyFlag=i,this.m_maxLength=t,this.m_maxDeviation=e,this.m_maxAngle=s>ks()?ks():s,this.m_cosMaxAngle=Math.cos(this.m_maxAngle),this.m_bOnlyCurveDensify=this.m_maxAngle>0||this.m_maxDeviation>0,this.m_maxSegmentsPerCurve=o,Qn(this.m_maxSegmentsPerCurve>0,"this.m_maxSegmentsPerCurve > 0"),this.m_minStep=1/this.m_maxSegmentsPerCurve}densify(t){return this.densifyGeom(t)}densifySegment(t,e){this.densifySegmentEx(t,null,!0,!1,e)}densifyEx(t,e,s,n,i,o){return this.m_maxLength=e,this.m_maxDeviation=s,this.m_maxAngle=n>ks()?ks():n,this.m_cosMaxAngle=Math.cos(this.m_maxAngle),this.m_bOnlyCurveDensify=this.m_maxAngle>0||this.m_maxDeviation>0,this.m_bSetDensifyFlag=i,this.m_maxSegmentsPerCurve=o,Qn(this.m_maxSegmentsPerCurve>0,"this.m_maxSegmentsPerCurve > 0"),this.m_minStep=1/this.m_maxSegmentsPerCurve,this.densifyGeom(t)}densifyGeom(t){if(t.isEmpty()||t.getDimension()<1)return t;let e=t.getGeometryType();return La(e)?t:at(e)?this.densifyMultiPath(t):Qt(e)?this.densifySegmentImpl(t):e===N.enumEnvelope?this.densifyEnvelope(t):void j("")}densifySegmentEx(t,e,s,n,i){let o=t.getGeometryType();if(!(this.m_maxLength>0||this.m_bOnlyCurveDensify&&o!==N.enumLine)&&(!n||s))return void(e?o===N.enumLine?e.addSegment(t,s):(s&&(t.queryStart(this.m_dummyPoint),e.startPathPoint(this.m_dummyPoint)),t.queryEnd(this.m_dummyPoint),e.lineToPoint(this.m_dummyPoint)):(s&&i.push(0),i.push(1)));if(o===N.enumBezier)return void this.densifyCubicBezier(t,e,s,n,i);if(o===N.enumRationalBezier2)return void this.densifyRationalBezier2(t,e,s,n,i);if(o===N.enumBezier2)return void this.densifyBezier2(t,e,s,n,i);if(o===N.enumEllipticArc&&!t.isLine()&&t.getMinorMajorRatio()<.25)return void this.densifyEllipticArc(t,e,s,n,i);let a=1;this.m_maxLength>0&&(a=this.calculateLengthSubdivisionStep(t,this.m_maxLength)),this.m_maxDeviation>0&&(a=Math.min(a,this.calculateDeviationSubdivisionStep(t,this.m_maxDeviation))),this.m_maxAngle>0&&(a=Math.min(a,this.calculateAngularSubdivisionStep(t,this.m_maxAngle))),this.densifySegmentByLength(t,a,e,s,n,i)}densifyMultiPath(t){if(!t.hasNonLinearSegments()){if(t.getDescription().getAttributeCount()===1)return this.densifyMultiPathLinear(t);if(!(this.m_maxLength>0))return t}let e=t.createInstance();e.getGeometryType()===N.enumPolygon&&e.setFillRule(t.getFillRule()),e.reserve(t.getPointCount());let s=t.getImpl().querySegmentIterator();for(;s.nextPath();){let n=!0;for(;s.hasNextSegment();){let i=s.nextSegment(),o=s.isClosingSegment();this.densifySegmentEx(i,e,n,o,null),o&&e.closePathWithLine(),n=!1}}return e}densifySegmentImpl(t){let e=new dt({vd:t.getDescription()}),s=[0];return this.densifySegmentEx(t,e,!0,!1,s),e}densifyEnvelope(t){let e=new lt({vd:t.getDescription()});e.addEnvelope(t,!1);let s=V.constructEmpty();t.queryEnvelope(s);let n=s.width(),i=s.height();return!(this.m_maxLength>0)||n<=this.m_maxLength&&i<=this.m_maxLength?e:this.densifyMultiPath(e)}densifyMultiPathLinear(t){if(!(this.m_maxLength>0))return t;let e=t.createInstance();e.getGeometryType()===N.enumPolygon&&e.setFillRule(t.getFillRule()),e.reserve(t.getPointCount());let s=e.getImpl(),n=t.getImpl(),i=n.getAttributeStreamRef(0),o=new nt;for(let a=0,h=n.getPathCount();a<h;a++){let m=n.isClosedPath(a);if(n.getPathSize(a)===0)continue;let l=n.getPathStart(a),u=i.readPoint2D(2*l),c=u.clone();s.startPath(u);for(let g=l+1,d=n.getPathEnd(a);g<d;g++){let _=i.readPoint2D(2*g),p=y.distance(c,_);if(p>this.m_maxLength){let f=Math.ceil(p/this.m_maxLength);f>Pe()&&(f=Pe());let x=1/f,C,P,E;c.compare(_)<0?(o.setStartXY(c),o.setEndXY(_),C=0,P=1):(o.setStartXY(_),o.setEndXY(c),C=f-2,P=-1);for(let S=0,I=f-1;S<I;S++,C+=P){this.progress_(),E=x*(C+1);let D=new y;o.queryCoord2D(E,D),s.lineTo(D),this.m_bSetDensifyFlag&&s.setAttribute(10,s.getPointCount()-1,0,1)}}else this.progress_();e.lineTo(_),c.assign(_)}if(m){let g=y.distance(c,u);if(g>this.m_maxLength){let d=u,_=Math.ceil(g/this.m_maxLength);_>Pe()&&(_=Pe());let p=1/_,f,x;c.compare(d)<0?(o.setStartXY(c),o.setEndXY(d),f=0,x=1):(o.setStartXY(d),o.setEndXY(c),f=_-2,x=-1);let C=new y(0,0),P;for(let E=0,S=_-1;E<S;E++,f+=x)this.progress_(),P=p*(f+1),o.queryCoord2D(P,C),s.lineTo(C),this.m_bSetDensifyFlag&&s.setAttribute(10,s.getPointCount()-1,0,1)}s.closePathWithLine()}}return e}densifySegmentByLength(t,e,s,n,i,o){w(t.getGeometryType()!==N.enumBezier);let a=t.getStartXY().compare(t.getEndXY());a===0&&e<1&&(t.getGeometryType()===N.enumEllipticArc?a=t.getSweepAngle()<0?1:-1:ft("densify segment by length"));let h=0;if(n&&(s?(t.queryStart(this.m_dummyPoint),s.startPathPoint(this.m_dummyPoint)):o.push(0),++h),e*this.m_maxSegmentsPerCurve<1&&(e=1/this.m_maxSegmentsPerCurve),e<1){this.m_segmentBuffer||(this.m_segmentBuffer=new et);let m=Math.ceil(1/e);m>Pe()&&(m=Pe()),e=1/m,this.m_segmentBuffer.create(t.getGeometryType());let l,u,c,g=t;a<0?(l=0,u=1):(t.copyTo(this.m_segmentBuffer.get()),this.m_segmentBuffer.get().reverse(),l=m-2,u=-1,g=this.m_segmentBuffer.get());let d=m-1;for(let _=0;_<d;_++,l+=u)c=e*(l+1),s?(g.queryCoord(c,this.m_dummyPoint),s.lineToPoint(this.m_dummyPoint),this.m_bSetDensifyFlag&&c!==1&&c!==0&&s.setAttribute(10,s.getPointCount()-1,0,1)):o.push(a>0?1-c:c),this.progress_();c=1,h+=d}(!i||i&&n&&h<2)&&(s?(t.queryEnd(this.m_dummyPoint),s.lineToPoint(this.m_dummyPoint)):o.push(1))}densifyCubicBezier(t,e,s,n,i){let o=new Ge,a=t,h=t.calculateUpperLength2D(),m=t.getStartXY().compare(t.getEndXY());if(m===0&&h>0){let p=k(y,4);t.queryControlPoints(p),m=p[1].compare(p[2]),m===0&&(m=p[1].compare(p[0]))}m>0&&(t.copyTo(o),o.reverse(),a=o);let l=0;s&&(e?(t.queryStart(this.m_dummyPoint),e.startPathPoint(this.m_dummyPoint)):i.push(0),++l);let u=[],c=[],g=Math.trunc(Math.log2(this.m_maxSegmentsPerCurve)),d=!0,_=0;if(m>0)for(u.push([a.getStartXY(),a.getControlPoint1(),a.getControlPoint2(),a.getEndXY(),new y(0,1)]),c.push(0);u.length;){this.progress_();let p=u.at(-1),f=c.at(-1),x=p[4].x,C=p[4].y;if(f<g&&this.bezierNeedsSplit(p)){d&&(_=a.findMinDeriv(),d=!1);let P=.5*(x+C);Math.abs(_-P)<.4*(C-x)&&(P=_);let E=(P-x)/(C-x),S=p[0].mul(1-E).add(p[1].mul(E)),I=p[1].mul(1-E).add(p[2].mul(E)),D=p[2].mul(1-E).add(p[3].mul(E)),b=S.mul(1-E).add(I.mul(E)),T=I.mul(1-E).add(D.mul(E)),A=b.mul(1-E).add(T.mul(E)),G=p[3];p[1]=S,p[2]=b,p[3]=A,p[4].setCoords(x,P);let F=[A,T,D,G,new y(P,C)];u.push(F),c[c.length-1]=f+1,c.push(f+1)}else u.pop(),c.pop(),(u.length>0||!n||n&&s&&l<2)&&(e?(a.queryCoord(x,this.m_dummyPoint),e.lineToPoint(this.m_dummyPoint),this.m_bSetDensifyFlag&&x!==1&&x!==0&&e.setAttribute(10,e.getPointCount()-1,0,1)):i.push(1-x),++l)}else for(u.push([a.getStartXY(),a.getControlPoint1(),a.getControlPoint2(),a.getEndXY(),new y(0,1)]),c.push(0);u.length;){this.progress_();let p=u.at(-1),f=c.at(-1),x=p[4].x,C=p[4].y;if(f<g&&this.bezierNeedsSplit(p)){d&&(_=a.findMinDeriv(),d=!1);let P=.5*(x+C);Math.abs(_-P)<.4*(C-x)&&(P=_);let E=(P-x)/(C-x),S=p[0].mul(1-E).add(p[1].mul(E)),I=p[1].mul(1-E).add(p[2].mul(E)),D=p[2].mul(1-E).add(p[3].mul(E)),b=S.mul(1-E).add(I.mul(E)),T=I.mul(1-E).add(D.mul(E)),A=b.mul(1-E).add(T.mul(E)),G=p[0];p[0]=A,p[1]=T,p[2]=D,p[4].setCoords(P,C);let F=[G,S,b,A,new y(x,P)];u.push(F),c[c.length-1]=f+1,c.push(f+1)}else u.pop(),c.pop(),(u.length>0||!n||n&&s&&l<2)&&(e?(a.queryCoord(C,this.m_dummyPoint),e.lineToPoint(this.m_dummyPoint),this.m_bSetDensifyFlag&&C!==1&&C!==0&&e.setAttribute(10,e.getPointCount()-1,0,1)):i.push(C),++l)}}densifyRationalBezier2(t,e,s,n,i){let o=new _e,a=t,h=t.calculateUpperLength2D(),m=t.getStartXY().compare(t.getEndXY());m===0&&h>0&&(m=0),m>0&&(t.copyTo(o),o.reverse(),a=o);let l=0;s&&(e?(t.queryStart(this.m_dummyPoint),e.startPathPoint(this.m_dummyPoint)):i.push(0),++l);let u=Math.trunc(Math.log2(this.m_maxSegmentsPerCurve)),c=new _e,g=[],d=[];for(g.push(new B(0,1)),d.push(0);g.length;){this.progress_();let _=g.at(-1).clone(),p=d.at(-1);if(p<u&&this.rationalBezier2NeedsSplit(a,c,_.vmin,_.vmax)){let f=_.getCenter();m>0?(g.at(-1).vmax=f,g.push(new B(f,_.vmax))):(g.at(-1).vmin=f,g.push(new B(_.vmin,f))),d[d.length-1]=p+1,d.push(p+1)}else if(g.pop(),d.pop(),g.length>0||!n||n&&s&&l<2){let f=m>0?_.vmin:_.vmax;e?(a.queryCoord(f,this.m_dummyPoint),e.lineToPoint(this.m_dummyPoint),this.m_bSetDensifyFlag&&f!==1&&f!==0&&e.setAttribute(10,e.getPointCount()-1,0,1)):i.push(m>0?1-f:f),++l}}}densifyBezier2(t,e,s,n,i){let o=new Ls,a=t,h=t.calculateUpperLength2D(),m=t.getStartXY().compare(t.getEndXY());m===0&&h>0&&(m=0),m>0&&(t.copyTo(o),o.reverse(),a=o);let l=0;s&&(e?(t.queryStart(this.m_dummyPoint),e.startPathPoint(this.m_dummyPoint)):i.push(0),++l);let u=Math.ceil(Math.log2(this.m_maxSegmentsPerCurve)),c=new Ls,g=[],d=[];for(g.push(new B(0,1)),d.push(0);g.length;){this.progress_();let _=g.at(-1).clone(),p=d.at(-1);if(p<u&&this.bezier2NeedsSplit(a,c,_.vmin,_.vmax)){let f=_.getCenter();m>0?(g.at(-1).vmax=f,g.push(new B(f,_.vmax))):(g.at(-1).vmin=f,g.push(new B(_.vmin,f))),d[d.length-1]=p+1,d.push(p+1)}else if(g.pop(),d.pop(),g.length>0||!n||n&&s&&l<2){let f=m>0?_.vmin:_.vmax;e?(a.queryCoord(f,this.m_dummyPoint),e.lineToPoint(this.m_dummyPoint),this.m_bSetDensifyFlag&&f!==1&&f!==0&&e.setAttribute(10,e.getPointCount()-1,0,1)):i.push(m>0?1-f:f),++l}}}densifyEllipticArc(t,e,s,n,i){let o=new je,a=t,h=t.calculateUpperLength2D(),m=t.getStartXY().compare(t.getEndXY());m===0&&h>0&&(m=t.isClockwise()?0:1),m>0&&(t.copyTo(o),o.reverse(),a=o);let l=0;s&&(e?(t.queryStart(this.m_dummyPoint),e.startPathPoint(this.m_dummyPoint)):i.push(0),++l);let u=Math.trunc(Math.log2(this.m_maxSegmentsPerCurve)),c=new je,g=[],d=[];for(g.push(new B(0,1)),d.push(0);g.length;){this.progress_();let _=g.at(-1).clone(),p=d.at(-1);if(p<u&&this.ellipticArcNeedsSplit(a,c,_.vmin,_.vmax)){let f=_.getCenter();m>0?(g.at(-1).vmax=f,g.push(new B(f,_.vmax))):(g.at(-1).vmin=f,g.push(new B(_.vmin,f))),d[d.length-1]=p+1,d.push(p+1)}else if(g.pop(),d.pop(),g.length>0||!n||n&&s&&l<2){let f=m>0?_.vmin:_.vmax;e?(a.queryCoord(f,this.m_dummyPoint),e.lineToPoint(this.m_dummyPoint),this.m_bSetDensifyFlag&&f!==1&&f!==0&&e.setAttribute(10,e.getPointCount()-1,0,1)):i.push(m>0?1-f:f),++l}}}calculateLengthSubdivisionStep(t,e){let s=t.calculateUpperLength2D();if(!t.isCurve())return s?e/s:1;if(t.getGeometryType()===N.enumEllipticArc){let n=t;if(n.isCircular()||n.isDegenerate(0)||n.isDegenerateToLine()){let i=e/s;return i<this.m_minStep&&(i=this.m_minStep),i}return e/s*n.getSemiAxes().y/n.getSemiAxes().x}t.getGeometryType()===N.enumBezier&&ft(""),ft("")}calculateDeviationSubdivisionStep(t,e){if(!t.isCurve())return 1;if(t.getGeometryType()===N.enumEllipticArc){let s=t;if(s.isDegenerate(0)||s.isDegenerateToLine())return 1;{let n=s.getSemiMajorAxis(),i=1-e/n,o=Math.PI/2;if(i>0){let h=4*Math.sqrt(e/n*.5);o=Math.min(Math.PI/2,Math.abs(h))}o=Math.max(o,2*Math.PI/this.m_maxSegmentsPerCurve);let a=o*n;return this.calculateLengthSubdivisionStep(t,a)}}ft("")}calculateAngularSubdivisionStep(t,e){if(!t.isCurve())return 1;if(t.getGeometryType()===N.enumEllipticArc){let s=t;return s.isDegenerate(0)||s.isDegenerateToLine()?1:this.calculateLengthSubdivisionStep(t,e*s.getSemiMinorAxis())}ft("")}rationalBezier2NeedsSplit(t,e,s,n){t.cutBezierIgnoreAttributes(s,n,e);let i=!1;if(this.m_maxLength>0&&e.calculateUpperLength2D()>this.m_maxLength)return i=!0,!0;let o=k(y,3);e.queryControlPoints(o);let a=[0,0,0];return e.queryWeights(a),!i&&this.m_maxDeviation>0&&(i=!r.checkRationalBezier2MaxDeviation(o,a,this.m_maxDeviation)),!i&&this.m_maxAngle>0&&(i=!r.checkRationalBezier2MaxAngle(o,a,this.m_cosMaxAngle)),i}bezier2NeedsSplit(t,e,s,n){t.cutBezierIgnoreAttributes(s,n,e);let i=!1;if(this.m_maxLength>0&&e.calculateUpperLength2D()>this.m_maxLength)return i=!0,!0;let o=k(y,3);return e.queryControlPoints(o),!i&&this.m_maxDeviation>0&&(i=!r.checkBezier2MaxDeviation(o,this.m_maxDeviation)),!i&&this.m_maxAngle>0&&(i=!r.checkBezier2MaxAngle(o,this.m_cosMaxAngle)),i}ellipticArcNeedsSplit(t,e,s,n){t.cutArcIgnoreAttributes(s,n,e);let i=!1;return this.m_maxLength>0&&e.calculateUpperLength2D()>this.m_maxLength?(i=!0,!0):(!i&&this.m_maxDeviation>0&&(i=!r.checkEllipticArcMaxDeviation(e,this.m_maxDeviation)),!i&&this.m_maxAngle>0&&(i=!r.checkEllipticArcMaxAngle(e,this.m_cosMaxAngle)),i)}bezierNeedsSplit(t){let e=!1;return this.m_maxLength>0&&y.distance(t[0],t[1])+y.distance(t[1],t[2])+y.distance(t[2],t[3])>this.m_maxLength?(e=!0,!0):(!e&&this.m_maxDeviation>0&&(e=!r.checkBezierMaxDeviation(t,this.m_maxDeviation)),!e&&this.m_maxAngle>0&&(e=!r.checkBezierMaxAngle(t,this.m_cosMaxAngle)),e)}progress_(){}static checkBezierMaxDeviation(t,e){let s=t[3].sub(t[0]);if(s.sqrLength()>0){let n=s.clone();n.leftPerpendicularThis(),n.normalize();let i=n.dotProduct(t[0].sub(t[1])),o=n.dotProduct(t[0].sub(t[2]));if(Math.max(Math.abs(i),Math.abs(o))<=e){let a=new y;Gt(t,.5,a,!1);let h=a.sub(t[0]).dotProduct(s);return h>=0&&h<=s.sqrLength()}return!1}return Math.max(t[0].sub(t[1]).sqrLength(),t[0].sub(t[2]).sqrLength())<=e*e}static checkBezierMaxAngle(t,e){if(t[0].equals(t[3]))return!(!t[0].equals(t[1])||!t[1].equals(t[2]));let s=t[3].sub(t[0]);s.normalize();{let n=t[1].sub(t[0]),i=n.dotProduct(s);if(i<0||n.length()*e>i)return!1}{let n=t[2].sub(t[0]),i=n.dotProduct(s);if(i<0||n.length()*e>i)return!1}{let n=t[2].sub(t[1]),i=n.dotProduct(s);if(i<0||n.length()*e>i)return!1}return!0}static checkRationalBezier2MaxDeviation(t,e,s){if(e[1]===0)return!1;let n=t[2].sub(t[0]);if(n.sqrLength()>0){let i=n.clone();i.leftPerpendicularThis(),i.normalize();let o=i.dotProduct(t[0].sub(t[1]));if(Math.abs(o)<=s){let a=t[1].sub(t[0]).dotProduct(n);return a>=0&&a<=n.sqrLength()}return!1}return t[0].sub(t[1]).sqrLength()<=s*s}static checkRationalBezier2MaxAngle(t,e,s){if(e[1]===0)return!1;if(t[0].equals(t[2]))return!!t[0].equals(t[1]);let n=t[2].sub(t[0]);n.normalize();{let i=t[1].sub(t[0]),o=i.dotProduct(n);if(o<0||i.length()*s>o)return!1}return!0}static checkBezier2MaxDeviation(t,e){let s=t[2].sub(t[0]);if(s.sqrLength()>0){let n=s.clone();n.leftPerpendicularThis(),n.normalize();let i=n.dotProduct(t[0].sub(t[1]));if(Math.abs(i)<=e){let o=t[1].sub(t[0]).dotProduct(s);return o>=0&&o<=s.sqrLength()}return!1}return t[0].sub(t[1]).sqrLength()<=e*e}static checkBezier2MaxAngle(t,e){if(t[0].equals(t[2]))return!!t[0].equals(t[1]);let s=t[2].sub(t[0]);s.normalize();{let n=t[1].sub(t[0]),i=n.dotProduct(s);if(i<0||n.length()*e>i)return!1}return!0}static checkEllipticArcMaxDeviation(t,e){if(Math.abs(t.getSweepAngle())<Math.PI){let i=t.getEndXY().sub(t.getStartXY()),o=[0,0];if(Xf(t,i,o)===1){let a=t.getCoord2D(o[0]),h=y.getClosestCoordinate(t.getStartXY(),t.getEndXY(),a),m=new y;return qt(t.getStartXY(),t.getEndXY(),h,m),y.distance(a,m)<=e}}let s=t.getCoord2D(.5),n=new y;return qt(t.getEndXY(),t.getStartXY(),.5,n),y.distance(s,n)<=e}static checkEllipticArcMaxAngle(t,e){let s=t.getTangent(0),n=t.getTangent(1),i=s.dotProduct(n);return!(i<0)&&!(s.length()*n.length()*e>i)}static checkTypeForReplace(t,e){return t.getGeometryType()===e&&(e!==N.enumEllipticArc||t.isCircular())}};function Ns(r,t,e){let s=e.length;if(t<=0||s<=2)return s;let n=0,i=Z(s-1,Number.NaN);for(let o=1,a=s;o<a;o++){let h=r.tToLength(e[o]);i[o-1]=h-n,n=h}for(;i.length>1;){let o=i.findIndex(m=>m<=2*t);if(o===-1)break;let a=o+1,h=o+1;if(o>0){let m=o-1;(h===i.length||i[m]>i[h])&&(h=m,a--)}i[h]+=i[o],i.splice(o,1),e.splice(a,1)}return e.length}function yf(r,t,e,s,n){let i=[],o=[],a=Tr(t,e,0,s,!1,i,o),h=new Ge,m=n,l=t.getDescription();h.assignVertexDescription(l);let u=l.getAttributeCount()>1,c=new st,g=new nt;for(let d=0,_=0;d<a;d++){if(i[_+1].isNAN()){if(u){let p=o[d];t.queryCoord(p,c),g.setStart(c),p=o[d+1],t.queryCoord(p,c),g.setEnd(c)}g.setStartXY(i[_]),g.setEndXY(i[_+3]),r.addSegment(g,m)}else{if(u){let p=o[d];t.queryCoord(p,c),h.setStart(c),p=o[d+1],t.queryCoord(p,c),h.setEnd(c)}h.setStartXY(i[_]),h.setControlPoint1(i[_+1]),h.setControlPoint2(i[_+2]),h.setEndXY(i[_+3]),r.addSegment(h,m)}_+=3,m=!1}}function Pf(r,t,e,s,n){let i=[],o=[],a=xf(t,e,0,s,!1,i,o),h=new Ls,m=n,l=t.getDescription();h.assignVertexDescription(l);let u=l.getAttributeCount()>1,c=new st,g=new nt;for(let d=0,_=0;d<a;d++){if(i[_+1].isNAN()){if(u){let p=o[d];t.queryCoord(p,c),g.setStart(c),p=o[d+1],t.queryCoord(p,c),g.setEnd(c)}g.setStartXY(i[_]),g.setEndXY(i[_+2]),r.addSegment(g,m)}else{if(u){let p=o[d];t.queryCoord(p,c),h.setStart(c),p=o[d+1],t.queryCoord(p,c),h.setEnd(c)}h.setStartXY(i[_]),h.setControlPoint1(i[_+1]),h.setEndXY(i[_+2]),r.addSegment(h,m)}_+=2,m=!1}}function Cf(r,t,e,s,n){w(r===N.enumBezier||r===N.enumEllipticArc||r===N.enumBezier2);let i=t.createInstance();i.getGeometryType()===N.enumPolygon&&i.setFillRule(t.getFillRule());let o=t.querySegmentIterator();for(let a=0,h=t.getPathCount();a<h;++a){if(!t.hasNonLinearSegmentsPath(a)){i.addPath(t,a,!0);continue}let m=t.getPathStart(a),l=!0,u=0;for(o.resetToPath(a),w(o.nextPath());o.hasNextSegment();){let g=o.nextCurve();if(!g)break;{let d=o.getStartPointIndex()-m,_=d-u;_>0&&(i.addSegmentsFromPath(t,a,u,_,l),l=!1),u=d+1,r===N.enumBezier?yf(i,g,e,s,l):r===N.enumBezier2?Pf(i,g,e,s,l):j(""),l=!1}}let c=t.getSegmentCountPath(a);c-u!=0&&i.addSegmentsFromPath(t,a,u,c-u,l)}return i}function em(r,t,e,s,n,i,o,a){let h=t.clone();h.dropAllAttributes();let m=(X,z,Y,L)=>(z&&(X&&z.push(L.getStartXY()),z.push(y.getNAN()),z.push(y.getNAN()),z.push(L.getEndXY())),Y&&(X&&Y.push(0),Y.push(1)),1);if(h.isDegenerateToLine()||h.isDegenerate(0))return m(r,i,o,t);let l=h.getStartXY(),u=h.getEndXY(),c=h.getSemiAxes(),g=new ct;if(h.isCircular())g.setIdentity();else{let X=h.getAxisXRotation();g.setScaleCoords(1,h.getMinorMajorRatio()),g.rotateAngle(X)}let d=h.getCenter();g.shift(d);let _=g.clone();_.invertThis(),h.applyTransformation(_);let p=h.getSweepAngle();if(p===0)return m(r,i,o,t);let f=V.constructEmpty();f.setCoords({center:d,width:2*c.x,height:2*c.x});let x=.05*f.calculateToleranceFromEnvelope(),C=Math.max(e/c.x,x/c.x),P=4*Math.pow(C/.0741,1/6);P=Math.min(P,Math.PI/2);let E=Tg(h.getStartAngle()),S=p>0?Math.floor(E/P):Math.ceil(E/P);S*=P;let I=p>0?P:-P;S+I===E&&(S+=I);let D=4/3*Math.tan(Math.abs(P)/4);p>0&&(D=-D),o&&r&&o.push(0);let b=P/Math.abs(p),T=(S-E)/p,A=l.clone(),G=new y;h.queryCoord2D(0,G);let F=G.clone(),M=1-.01*b,q=0,R=0;for(;T<1;){let X;if(T+=b,R>0&&T<M)X=D;else{T>=M&&(T=1);let K=(T-R)*p;X=4/3*Math.tan(Math.abs(K)/4),p>0&&(X=-X)}h.queryCoord2D(T,G);let z=new y;g.queryTransform(G,z);let Y=t.getClosestCoordinate(z,!1);if(t.queryCoord2D(Y,z),T!==1&&(y.distance(A,z)<=2*s||y.distance(z,u)<=2*s))continue;A.setCoordsPoint2D(z);let L=k(y,4);L[0].assign(F),L[3].assign(G),L[1].rightPerpendicularOther(F),L[1].scaleAddThis(X,F),L[2].leftPerpendicularOther(G),L[2].scaleAddThis(X,G),g.transformPoints2D(L,3,L),L[3].assign(z),R===0&&L[0].setCoordsPoint2D(l),T===1&&L[3].setCoordsPoint2D(u),n&&Xo(L);let W=!0;for(let K=1;K<4;K++)if(!L[K].isEqualPoint2D(L[0])){W=!1;break}W||(o&&o.push(Y),i&&(R===0&&r&&i.push(L[0].clone()),i.push(L[1].clone()),i.push(L[2].clone()),i.push(L[3].clone())),q++),R=T,F.setCoordsPoint2D(G)}return q}function Ac(r,t,e,s,n,i,o,a){t.clone().dropAllAttributes();let h=new V;t.queryLooseEnvelope(h);let m=.05*h.calculateToleranceFromEnvelope(),l=Math.max(e,m);r&&o.push(0);let u=0,c=k(y,3);t.queryControlPoints(c);let g=[0,0,0];t.queryWeights(g);let d=[],_=Z(9,Number.NaN),p=t.getMonotonicPartParams(_.length,_);_.length=p,p=Ns(t,s,_);let f=0,x=r;for(let C=1;C<p;C++){let P=_[C];for(d.push(f),d.push(P);d.length>1;){let E=d.at(-1);d.pop();let S=d.at(-1),I=k(y,3);$s(c,g,E,S,I,[0,0,0]);let D=k(y,3),b=G0(I,g,D),T=16,A=d.length>T;l>=b||A?(o.push(S),x&&(i.push(D[0]),x=!1),i.push(D[1]),i.push(D[2]),u++):(d.push(.5*(E+S)),d.push(E))}f=P}return u}function Mc(r,t,e,s,n,i,o,a){t.clone().dropAllAttributes();let h=new V;t.queryLooseEnvelope(h);let m=.05*h.calculateToleranceFromEnvelope(),l=Math.max(e,m);o&&r&&o.push(0);let u=0,c=k(y,3);t.queryControlPoints(c);let g=[0,0,0];t.queryWeights(g);let d=[],_=Z(9,Number.NaN),p=0;n?(p=t.getMonotonicPartParams(_.length,_),_.length=p,p=Ns(t,s,_)):(_.length=2,p=2,_[0]=0,_[1]=1);let f=0,x=r;for(let C=1;C<p;C++){let P=_[C];for(d.length=0,d.push(P),d.push(f);d.length>1;){let E=d.at(-1);d.pop();let S=d.at(-1),I=k(y,3),D=[0,0,0];$s(c,g,E,S,I,D);let b=k(y,4),T=a0(I,D,b),A=16,G=d.length>A;l>=T||G?(o.push(S),i&&(x&&(i.push(b[0]),x=!1),i.push(b[1]),i.push(b[2]),i.push(b[3])),u++):(d.push(.5*(E+S)),d.push(E))}f=P}return u}function Ef(r,t,e,s,n,i,o,a){let h=t.clone();if(h.dropAllAttributes(),h.isDegenerateToLine()||h.getSweepAngle()===0)return r&&i.push(t.getStartXY()),i.push(y.getNAN()),i.push(t.getEndXY()),r&&o.push(0),o.push(1),1;let m=h.getStartXY(),l=h.getEndXY(),u=h.getSemiAxes(),c=new ct;if(h.isCircular())c.setIdentity();else{let T=h.getAxisXRotation();c.setScaleCoords(1,h.getMinorMajorRatio()),c.rotateAngle(T)}let g=h.getCenter();c.shift(g);let d=c.clone();d.invertThis(),h.applyTransformation(d);let _=V.constructEmpty();_.setCoords({center:g,width:2*u.x,height:2*u.x});let p=.05*_.calculateToleranceFromEnvelope(),f=Math.max(e/u.x,p/u.x),x=Math.sqrt(2*f+f*f),C=2*Math.sqrt(2*x*(1+f-x));C=Math.min(C,Math.PI/2);let P=h.getSweepAngle(),E=Math.ceil(Math.abs(P)/C),S=Math.max(E,1);C=P/S;let I=1/S,D=Math.tan(Math.abs(C)/2);P>0&&(D=-D),r&&o.push(0);let b=new y;h.queryCoord2D(0,b);for(let T=0;T<S;T++){let A=b.clone(),G=(T+1)*I;o.push(G),h.queryCoord2D(G,b);let F=k(y,3);F[0].assign(A),F[2].assign(b),F[1].rightPerpendicularOther(F[0]),F[1].mulThis(D),F[1].addThis(F[0]),c.transformPoints2D(F,3,F),T===0&&F[0].setCoordsPoint2D(m),T===S-1&&F[2].setCoordsPoint2D(l),T===0&&r&&i.push(F[0]),i.push(F[1]),i.push(F[2])}return S}function Gc(r,t,e,s,n,i,o,a){t.clone().dropAllAttributes();let h=new V;t.queryLooseEnvelope(h);let m=.05*h.calculateToleranceFromEnvelope(),l=Math.max(e,m);r&&o.push(0);let u=0,c=k(y,4);t.queryControlPoints(c);let g=[],d=Z(9,Number.NaN),_=t.getMonotonicPartParams(d.length,d);d.length=_,_=Ns(t,s,d);let p=0,f=r;for(let x=1;x<_;x++){let C=d[x];for(g.push(p),g.push(C);g.length>1;){let P=g.at(-1);g.pop();let E=g.at(-1),S=k(y,4);fn(c,P,E,S);let I=k(y,3),D=M0(S,I),b=16,T=g.length>b;l>=D||T?(o.push(E),f&&(i.push(I[0]),f=!1),i.push(I[1]),i.push(I[2]),u++):(g.push(.5*(P+E)),g.push(P))}p=C}return u}function Sf(){return{e2:0,completeE:0}}var sm=class{constructor(t,e){this.m_arc=t,this.m_sqrChordLength=e}getMaxDerivative(){return 1}getValue(t,e){return t===0?y.sqrDistance(this.m_arc.getCoord2D(e),this.m_arc.getCoord2D(1-e))-this.m_sqrChordLength:0}getError(t){return 0}};function vf(r,t,e){if(wt(r))$c(new nt({start:r.getStartXY(),end:r.getEndXY()}),t,e);else if(t.value()===0)e.set(r.getStartXY());else if(t.value()===1)e.set(r.getEndXY());else{let s=new H;Gg(r,t,s);let n=new H,i=new H;H.st_cosAndSin(s,n,i);let o=$.constructCoordsE(new H(r.m_semiMajorAxis).mulThisE(n),new H(r.m_semiMajorAxis).mulThis(r.m_minorMajorRatio).mulThisE(i)),a=new H(r.m_rotation);H.st_cosAndSin(a,n,i),o.rotateDirect(n,i),o.addThisE($.constructPoint2D(r.m_center)),e.setE(o)}}function _h(r,t){return r.convertToCanonic(t)}function If(r,t){let e=new B(r.getStartAngle(),r.getEndAngle());e.normalize();let s=ge(),n=Xs(t,s);if(n<e.vmin){let i=n+s;for(;i<e.vmin;)i+=s;return e.containsCoordinate(i)?i:e.vmin-n<i-e.vmax?n:i}if(n>e.vmax){let i=n-s;for(;i>e.vmax;)i-=s;return e.containsCoordinate(i)||e.vmin-i<n-e.vmax?i:n}return n}function bf(r,t,e,s){let n=r.m_startAngle,i=r.m_sweepAngle,o=1e-12;for(;n>_t();)n-=2*_t();for(;n<=-_t();)n+=2*_t();if(!Number.isNaN(t)){for(;t>_t();)t-=2*_t();for(;t<=-_t();)t+=2*_t();!e&&t>n&&(t-=2*_t()),e&&t<n&&(t+=2*_t()),i=t-n,Math.abs(i)<o&&!s&&(i=e?2*_t():-2*_t()),Math.abs(i)>2*_t()-o&&s&&(i=0)}Math.abs(i)>2*_t()-o&&(i=i>=0?2*_t():-2*_t(),r.setEndXY(r.getStartXY())),Math.abs(i)<o&&(i=0,r.setEndXY(r.getStartXY())),s=Math.abs(i)<=_t(),i&&(e=i>0),r.m_startAngle=Vn(n),r.m_sweepAngle=i,gi(r,!s),ko(r,e)}function Vn(r){let t=r,e=!1;return t<=-_t()?(t+=ge(),e=!0):t>_t()&&(t-=ge(),e=!0),t<=-_t()?(t=Xs(t,ge()),t<=-_t()&&(t+=ge()),e=!0):t>_t()&&(t=Xs(t,ge()),t>_t()&&(t-=ge()),e=!0),e&&(t>_t()||t<=-_t())&&(t=_t()),t}function Fc(r,t,e){let s=e,n=s.getSemiAxes(),i=new y(n.x*Math.cos(r[0]),n.y*Math.sin(r[0]));return i=s.convertFromCanonic(i),y.sqrDistance(i,s.getStartXY())}function Vc(r,t,e){let s=e,n=s.getSemiAxes(),i=r[0]+s.getStartAngle(),o=new y(n.x*Math.cos(i),n.y*Math.sin(i));return o=s.convertFromCanonic(o),y.sqrDistance(o,s.getEndXY())}function nm(r){if(r.m_center.isNAN())return r.m_startAngle=0,void(r.m_sweepAngle=0);let t=r.getStartXY(),e=r.getEndXY(),s=t.equals(e),n=bm(r),i=ci(r),o=r.projectionBehavior();if(s){let a=r.convertToCanonic(t),h=new y(r.m_semiMajorAxis,r.m_semiMajorAxis*r.m_minorMajorRatio);a.x/=h.x,a.y/=h.y,r.m_startAngle=Vn(Math.atan2(a.y,a.x)),r.m_sweepAngle=n?i?ge():-ge():0}else{let a=r.convertToCanonic(t),h=new y(r.m_semiMajorAxis,r.m_semiMajorAxis*r.m_minorMajorRatio);a.x/=h.x,a.y/=h.y;let m=r.convertToCanonic(e);m.x/=h.x,m.y/=h.y,r.m_startAngle=Math.atan2(a.y,a.x),r.m_sweepAngle=y.calculateAngle(a,m),i?r.m_sweepAngle<0&&(r.m_sweepAngle+=ge()):r.m_sweepAngle>0&&(r.m_sweepAngle-=ge()),r.m_startAngle=Vn(r.m_startAngle);let l=Fc([r.m_startAngle],1,r);if(l=Math.sqrt(l),l>.25*Ts(r)){let c=r.m_startAngle-1e-4,g=r.m_startAngle+1e-4,d=[0];Ju(Fc,r,1,[r.m_startAngle],[c],[g],1e-14,d),r.m_startAngle=Vn(d[0])}if(l=Vc([r.m_sweepAngle],1,r),l=Math.sqrt(l),l>.25*Ts(r)){let c=r.m_sweepAngle-1e-4,g=r.m_sweepAngle+1e-4,d=[0];Ju(Vc,r,1,[r.m_sweepAngle],[c],[g],1e-14,d),r.m_sweepAngle=d[0]}let u=Math.abs(r.m_sweepAngle)>_t();if(gi(r,u),n!==u&&!n&&Math.abs(r.m_sweepAngle)>1.5*_t()||r.m_sweepAngle===0||i!==r.m_sweepAngle>0)return void hs(r,t,e,o)}}function Ht(r,t){return(If(r,t)-r.getStartAngle())/r.getSweepAngle()}function as(r,t){return r.m_startAngle+t*r.m_sweepAngle}function Gg(r,t,e){e.assign(new H(r.m_startAngle).addE(t.mulE(new H(r.m_sweepAngle))))}function wf(r,t){let e=new H(r.m_cosr).sqrThis(),s=new H(r.m_sinr).sqrThis(),n=new H(r.m_minorMajorRatio),i=new H(1/r.m_minorMajorRatio),o=n.mulE(e).addThisE(i.mulE(s)),a=n.subE(i).mulThis(2*r.m_cosr*r.m_sinr),h=n.mulE(s).addThisE(i.mulE(e));t[0]=o,t[1]=a,t[2]=h,t[3]=new H(-r.m_semiMajorAxis).mulThis(r.m_semiMajorAxis).mulThis(r.m_minorMajorRatio)}function Df(r,t){let e=new rr;e.a11.setE(r[0]),e.a12=H.st_mulByPower2(r[1],.5),e.a21.setE(e.a12),e.a22.setE(r[2]);let s=[y.getNAN(),y.getNAN()],n=[new H,new H];e.eigenSymmetric(n,s);let i=r[3].clone();return i.negateThis(),i.invThis(),n[0].mulThisE(i),n[1].mulThisE(i),n[0].sqrtThis().invThis(),n[1].sqrtThis().invThis(),t.x=n[0].toDouble(),t.y=n[1].toDouble(),Math.atan2(s[0].y,s[0].x)}function Tf(r,t,e){if(wt(r))return(e-t)*y.distance(r.getStartXY(),r.getEndXY());if(r.m_minorMajorRatio===1)return Math.abs(r.getSweepAngle()*(t-e))*r.m_semiMajorAxis;let s=im(r,t);return im(r,e)-s}function ph(r){return r.m_cachedValues}function vm(r){if(r.m_cachedValues)return r.m_cachedValues;let t=Sf();return t.e2=Af(r),t.completeE=du(t.e2),r.m_cachedValues=t,t}function qc(r,t,e,s){if(!t.isEqual(r.m_XStart,r.m_YStart)||!e.isEqual(r.m_XEnd,r.m_YEnd)){if(wt(r))return r.m_XStart=t.x,r.m_YStart=t.y,r.m_XEnd=e.x,r.m_YEnd=e.y,oi(r),void r.afterCompletedModification();if(s&&Math.abs(r.getSweepAngle())<=1.01*ks()){let n=k(y,3),i=wm(r,n);if(qo(n)){if(n[0].assign(t),n[2].assign(e),Xn(n),r.projectionBehavior()===0){let o=0,a=2;y.sqrDistance(n[1],n[0])<y.sqrDistance(n[1],n[2])&&(a=O(o,o=a));let h=n[a].sub(n[o]),m=h.length();h.divThis(m);let l=n[1].sub(n[o]),u=l.length(),c=l.dotProduct(h)/u,g=l.crossProduct(h)/u,d=new y;qt(n[o],n[a],.5,d);let _=.5*m/g*Tt(1-c,0,1),p=n[1].side(n[o],n[a]),f=h.clone();p?f.leftPerpendicularThis():f.rightPerpendicularThis();let x=d.sub(f.mul(_));r.constructCircularArcThreePoint(n[0],n[2],x)}else vr(n,i*i,null,!1,r);return}}r.projectionBehavior()===0?Rf(r,t,e):kg(r,t,e)}}function Nf(r,t,e){let s=r.projectionBehavior()===0;if(e<=2)return void hs(r,t[0],t[e-1],s?0:1);if(s){r.constructCircularArcThreePoint(t[0],t[e-1],t[Math.trunc(e/2)]);let d=new y;return r.queryCoord2D(.5,d),void r.m_interior.setCoordsPoint2D(d)}let n=r.getSemiMajorAxis(),i=r.getMinorMajorRatio(),o=r.getAxisXRotation(),a=r.getCenter(),h=new Array(4);h[0]=r.isMajor(),h[1]=!h[0],h[2]=h[0],h[3]=!h[0];let m=new Array(4);m[0]=r.isClockwise(),m[1]=m[0],m[2]=!m[0],m[3]=!m[0];let l=Math.trunc(e<5?1:(e+4)/5),u=k(je,4),c=Z(4,Number.NaN),g=0;for(let d=0;d<4;d++){u[d].constructEllipticArcEndPointsCenter(t[0],t[e-1],n,i,o,h[d],m[d],a),c[d]=0;let _=0;for(let p=l;p<e-1;p+=l){let f=u[d].getClosestCoordinate(t[p],!1);c[d]+=y.sqrDistance(u[d].getCoord2D(f),t[p]),_++}c[d]/=_,c[d]<c[g]&&(g=d)}r.assignCopy(u[g])}function Af(r){return 1-Et(r.m_minorMajorRatio)}function Yc(r,t,e,s,n,i,o,a,h){return r.m_bits=0,r.m_rotation=i,hm(r,t),mm(r,e),r.m_cosr=Math.cos(i),r.m_sinr=Math.sin(i),gi(r,o),ko(r,a),h!==void 0?r.m_center.assign(h):r.m_center.setNAN(),r.setProjectionBehavior(1),r.m_semiMajorAxis=s,r.m_minorMajorRatio=n,qg(r,h===void 0)}function hs(r,t,e,s){r.m_bits=0,r.m_rotation=0,hm(r,t),mm(r,e),r.m_interior.assign(t.add(e).mul(.5)),r.m_startAngle=0,r.m_sweepAngle=0,r.m_cosr=1,r.m_sinr=0,gi(r,!1),ko(r,!1),r.m_center.setNAN(),r.m_semiMajorAxis=1,r.m_minorMajorRatio=0,r.setProjectionBehavior(s),r.afterCompletedModification()}function wt(r){return r.m_center.isNAN()}function im(r,t){if(t===0)return 0;let e=vm(r),s=as(r,t),n=ks(),i=Fg(r),o=Wa(s+n,e.e2,e.completeE),a=r.m_semiMajorAxis*(o-i);return Math.abs(a)}function Mf(r,t){if(wt(r)){let h=y.distance(r.getStartXY(),r.getEndXY());return h===0?0:t/h}if(r.m_minorMajorRatio===1){let h=Math.abs(r.getSweepAngle()*r.m_semiMajorAxis);return h===0?0:t/h}if(t===0)return 0;let e=r.getSweepAngle();if(e===0)return .5;let s=vm(r),n=ks(),i=Fg(r);e<0&&(t=-t);let o=t/r.m_semiMajorAxis+i,a=_u(o,s.e2,s.completeE);return a-=n,a-=r.getStartAngle(),a/e}function Fg(r){let t=vm(r);return Wa(r.getStartAngle()+ks(),t.e2,t.completeE)}function Im(r,t,e){if(t.m_TransformationType===2)return void w(0);if(w(!Vg(r)),t.isIdentity())return;xo(r);let s=y.getNAN();s.x=r.m_XStart,s.y=r.m_YStart,t.transformInPlace(s);let n=y.getNAN();if(n.x=r.m_XEnd,n.y=r.m_YEnd,t.transformInPlace(n),wt(r))return r.m_XStart=s.x,r.m_YStart=s.y,r.m_XEnd=n.x,void(r.m_YEnd=n.y);let i=r.m_center.clone();if(t.transformInPlace(i),e||t.isUniformNoRotation()){let o=ci(r);if(t.isReflective()&&(o=!o),r.projectionBehavior()===0){if(!s.equals(n)){let u=r.m_interior.clone();return t.transformInPlace(u),void r.constructCircularArcThreePoint(s,n,u)}return void Gf(r,s,n,i,o,!1)}let a=new y(r.m_cosr,r.m_sinr);t.transformWithoutTranslateInPlace(a);let h=Math.atan2(a.y,a.x),m=r.getSemiAxes();t.transformWithoutTranslateInPlace(m);let l=r.m_center.clone();return t.transformInPlace(l),void r.constructEllipticArcEndPointsCenter(s,n,m.x,m.y/m.x,h,r.isMajor(),o,l)}{{let u=new Array(4);wf(r,u);let c=new rr;if(c.a11.setE(u[0]),c.a12.setE(u[1]),c.a12.mulThisByPower2(.5),c.a21.setE(c.a12),c.a22.setE(u[2]),!c.det().isZero()){let g=new rr;if(g.a11.set(t.xx),g.a12.set(t.xy),g.a21.set(t.yx),g.a22.set(t.yy),g.invertThis()){let d=g.clone();d.transposeThis();let _=c.clone();if(_.mulThis(g),_.mulLeftThis(d),!_.det().isZero()){let p=k(H,4);p[0].setE(_.a11),p[1].setE(_.a12),p[1].mulThisByPower2(2),p[2].setE(_.a22),p[3].setE(u[3]);let f=y.getNAN(),x=Df(p,f),C=ci(r);return t.isReflective()&&(C=!C),void r.constructEllipticArcEndPointsCenter(s,n,f.x,f.y/f.x,x,r.isMajor(),C,i)}}}}let o=[y.getNAN(),y.getNAN(),y.getNAN()];o[0].setCoords(r.getSemiMajorAxis(),0),o[0].rotateDirect(r.m_cosr,r.m_sinr),o[1].setCoords(r.getSemiMajorAxis(),r.getSemiMinorAxis()),o[1].rotateDirect(r.m_cosr,r.m_sinr),o[2].setCoords(0,r.getSemiMinorAxis()),o[2].rotateDirect(r.m_cosr,r.m_sinr);let a=r.isClockwise();a&&(o[2]=O(o[0],o[0]=o[2]));let h=.5;t.transformWithoutTranslateArray(o,3,o),t.isReflective()&&(a=!a);let m=new y(0,0),l=r.createInstance();vr(o,h,m,!1,l),r.constructEllipticArcEndPointsCenter(s,n,l.getSemiMajorAxis(),l.getMinorMajorRatio(),l.getAxisXRotation(),r.isMajor(),!a,i)}}function Gf(r,t,e,s,n,i){let o=.5*(s.sub(t).length()+s.sub(e).length());r.m_center.assign(s),r.m_startAngle=Math.atan2(t.y-r.m_center.y,t.x-r.m_center.x),bf(r,Math.atan2(e.y-r.m_center.y,e.x-r.m_center.x),n,i);let a=r.constructEllipticArcEndPointsCenter(t,e,o,1,0,Math.abs(r.m_sweepAngle)>Math.PI,r.m_sweepAngle>0,s);return r.setProjectionBehavior(0),a}function fh(r,t){r.m_cachedValues=t}function xo(r){r.m_cachedValues=null}function Ff(r,t){t.m_cachedValues=O(r.m_cachedValues,r.m_cachedValues=t.m_cachedValues)}function ko(r,t){let e=t?1:0;r.m_bits=-2&r.m_bits|e}function ci(r){return!!(1&r.m_bits)}function gi(r,t){let e=t?1:0;r.m_bits=-3&r.m_bits|e<<1}function bm(r){return!!(2&r.m_bits)}function Vf(r){if(r.m_center.isNAN())return!1;let t=8,e=new $;e.setWithEps(r.getStartXY(),t),e.subThisE(new $().setWithEps(r.m_center,t));let s=new H;s.setWithEps(r.m_rotation,t);let n=new H,i=new H;H.st_cosAndSin(s,n,i),e.rotateReverse(n,i);let o=new $;o.setWithEps(r.getEndXY()),o.subThisE($.constructPoint2D(r.m_center)),o.rotateReverse(n,i);let a=new H;a.setWithEps(r.m_semiMajorAxis,t);let h=a.clone(),m=new H;m.setWithEps(r.m_minorMajorRatio),h.mulThisE(m),e.x.divThisE(a),e.y.divThisE(h),o.x.divThisE(a),o.y.divThisE(h);let l=e.x.sqr().addThisE(e.y.sqr()).subThisE(Kn),u=o.x.sqr().addThisE(o.y.sqr()).subThisE(Kn);return!l.isZero()||!u.isZero()}function Vg(r){return!!(8&r.m_bits)}function yo(r){r.m_bits&=-9}function qg(r,t){yo(r);let e=r.getStartXY(),s=r.getEndXY(),n=!1,i=bm(r),o=ci(r),a=r.projectionBehavior(),h=e.equals(s),m=r.m_minorMajorRatio===0||r.m_semiMajorAxis===0;if(Number.isNaN(r.m_minorMajorRatio)&&(r.m_semiMajorAxis===0?r.m_minorMajorRatio=1:Ba("NAN minor major ratio and non-zero major axis")),m||=t?h:r.m_center.isNAN(),m)return hs(r,e,s,a),!0;r.m_semiMajorAxis=Math.abs(r.m_semiMajorAxis),r.m_minorMajorRatio=Math.abs(r.m_minorMajorRatio),r.m_minorMajorRatio>1&&(r.m_semiMajorAxis*=r.m_minorMajorRatio,r.m_minorMajorRatio=1/r.m_minorMajorRatio);let l=new y(r.m_semiMajorAxis,r.m_semiMajorAxis*r.m_minorMajorRatio);if(h){let u=r.convertToCanonic(e);u.x/=l.x,u.y/=l.y;let c=Math.sqrt(Et(u.x)+Et(u.y));if(n=c!==1,r.m_semiMajorAxis*=c,l.mulThis(c),r.m_startAngle=Vn(Math.atan2(u.y,u.x)),!i)return r.m_interior.assign(e),r.m_sweepAngle=0,r.afterCompletedModification(),n;r.m_sweepAngle=o?ge():-ge()}else{let u=r.m_center.isNAN()||Vf(r);if(!u){let c=r.convertToCanonic(e);c.x/=l.x,c.y/=l.y;let g=new y(1,0);r.m_startAngle=y.calculateAngle(g,c);let d=r.convertToCanonic(s);d.x/=l.x,d.y/=l.y,r.m_sweepAngle=y.calculateAngle(c,d),u=!Xc(r)}if(u){n=!0;let c=e.sub(s).mulThis(.5);c.rotateReverse(r.m_cosr,r.m_sinr);let g=Et(c.x/l.x)+Et(c.y/l.y);g>1&&(g=Math.sqrt(g),r.m_semiMajorAxis*=g,l.mulThis(g));let d=new y(0,0);{let _=l.x*l.x,p=l.y*l.y,f=_*c.y*c.y+p*c.x*c.x,x=_*p-f;if(x>0){let C=Math.sqrt(x/f);d.setCoords(l.x*c.y/l.y,-l.y*c.x/l.x),d.mulThis(C),i===o&&d.negateThis()}}{let _=new y(d.x,d.y);_.rotateDirect(r.m_cosr,r.m_sinr),_.addThis(e.add(s).mulThis(.5)),r.m_center.assign(_)}}if(nm(r),!Xc(r))return hs(r,e,s,a),!0}return oi(r),r.afterCompletedModification(),n}function wm(r,t){w(Math.abs(r.getSweepAngle())<15*Math.PI/16);let e=r.getSemiMajorAxis(),s=r.getSemiMinorAxis(),n;if(e===0)return t[0].setCoordsPoint2D(r.getStartXY()),t[1].setCoordsPoint2D(r.getStartXY()),t[2].setCoordsPoint2D(r.getStartXY()),n=1,n;if(s===0)return t[0].setCoordsPoint2D(r.getStartXY()),t[2].setCoordsPoint2D(r.getEndXY()),t[1]=y.lerp(t[0],t[2],.5),n=1,n;let i=r.getSweepAngle(),o=r.getStartAngle(),a=o+i,h=new y(-e*Math.sin(o),s*Math.cos(o)),m=new y(-e*Math.sin(a),s*Math.cos(a));h.normalize(),m.normalize(),h.rotateDirect(r.m_cosr,r.m_sinr),m.rotateDirect(r.m_cosr,r.m_sinr),t[0].setCoordsPoint2D(r.getStartXY()),t[2].setCoordsPoint2D(r.getEndXY()),t[1].setSub(t[2],t[0]);let l=h.crossProduct(m);return t[1].assign(h.mul(t[1].crossProduct(m)/l)),t[1].addThis(t[0]),n=Math.cos(.5*i),n}function vr(r,t,e,s,n){if(s){let X=Math.sqrt(t),z=Et(1-.5)+2*X*.5*(1-.5)+Et(.5),Y=r[0].mul(Et(1-.5)).add(r[1].mul(2*X*.5*(1-.5))).add(r[2].mul(Et(.5))).divThis(z);return n.constructCircularArcThreePoint(r[0],r[2],Y),!0}let i=r[0].sub(r[1]),o=r[2].sub(r[1]),a=i.crossProduct(o),h=i.dotProduct(o),m=t;w(m<=1),w(m>0);let l=.5/(1-m),u=i.sqrLength(),c=h,g=o.sqrLength(),d=Et(a),_=i.sub(o).sqrLength();if(d===0||h<=-Math.sqrt(u)*Math.sqrt(g))return hs(n,r[0],r[2],1),!1;let p=[0,0],f=new B;f.setInfinite();let x=Yn(2*d,-(_/m+4*c),2*(1-m)/m,f,!1,p);if(x===0)return hs(n,r[0],r[2],1),!1;x===1&&(p[1]=p[0]);let C=Math.sqrt(l/p[0]),P=Math.sqrt(l/p[1]),E=.5/m,S=E-g*p[0],I=E-u*p[0];Math.abs(S)>Math.abs(I)?I=c*p[0]-E+1:S=c*p[0]-E+1;let D=i.mul(S).add(o.mul(I)),b=D.norm(1)<1e-15*C?0:Math.atan2(D.y,D.x)+Math.PI,T=i.add(o),A=e?e.clone():r[1].add(T.mul(l)),G=r[0].sub(A),F=r[2].sub(A),M=G.crossProduct(F)<0,q=!1;return new je,n.constructEllipticArcEndPointsCenter(r[0],r[2],C,P/C,b,q,!M,A)}function Yg(r,t,e,s,n){return vr(r,t,e,s,n)}function Xc(r){let t=!1;{let s=new y(r.m_semiMajorAxis*Math.cos(r.m_startAngle),r.getSemiMinorAxis()*Math.sin(r.m_startAngle));s.rotateDirect(r.m_cosr,r.m_sinr),s.addThis(r.m_center),t=y.distance(r.getStartXY(),s)>Ts(r)}let e=!1;if(!t){let s=new y(r.m_semiMajorAxis*Math.cos(r.m_startAngle+r.m_sweepAngle),r.getSemiMinorAxis()*Math.sin(r.m_startAngle+r.m_sweepAngle));s.rotateDirect(r.m_cosr,r.m_sinr),s.addThis(r.m_center),e=y.distance(r.getEndXY(),s)>Ts(r)}return!t&&!e}function qf(r,t,e,s){e===0&&U("construct_enclosing_circle");let n=[0,0,0],i=pf(t,e,n);if(i===1)r.constructCircleRadius(0,t[n[0]],s);else if(i===2){let o=y.lerp(t[n[0]],t[n[1]],.5),a=y.distance(t[n[0]],o),h=y.distance(t[n[1]],o);r.constructCircleRadius(Math.max(a,h),o,s)}else if(i===3){let o=y.calculateCircleCenterFromThreePoints(t[n[0]],t[n[1]],t[n[2]]),a=y.distance(t[n[0]],o),h=y.distance(t[n[1]],o),m=y.distance(t[n[2]],o);r.constructCircleRadius(Math.max(a,h,m),o,s)}else j("unexpected")}function kc(r){if(wt(r)||r.isDegenerate(0))return 0;let t=r.m_semiMajorAxis,e=r.getSemiMinorAxis(),s=t*t+e*e,n=r.getStartAngle(),i=r.getEndAngle(),o=r.m_center.y-r.m_YStart,a=r.m_cosr,h=r.m_sinr,m=1,l=0;r.m_rotation&&(m=(a-h)*(a+h),l=2*a*h);let u=((-.5*(i-n)+.25*m*(2*Math.cos(i+n)*Math.sin(i-n)))*e+-2*Math.sin(.5*(i+n))*Math.sin(.5*(i-n))*a*o)*t/s,c=0;return r.m_rotation&&(c=.125*(-2*Math.sin(i+n)*Math.sin(i-n))*l-e*o/s*(2*Math.cos(.5*(i+n))*Math.sin(.5*(i-n)))*h),s*(u+c)+-.5*(r.m_XEnd-r.m_XStart)*(r.m_YEnd-r.m_YStart)}function oi(r){r.queryCoord2D(.5,r.m_interior)}function Rc(r,t,e,s,n){if(n){if(Ve(t,e)!==0)return 2}else if(Ze(t,e))return 1;return Ir(r,t,e,null,null,null,s,n!==void 0&&n,!0,!1)!==0?4:0}function Yf(r,t,e,s,n){if(n){if(Ve(t,e)!==0)return 2}else if(Ze(t,e))return 1;return Xg(r,t,e,null,null,null,s,n!==void 0&&n,!0,!1)!==0?4:0}function Ir(r,t,e,s,n,i,o,a,h,m){if(wt(t))return Vo(new nt({start:t.getStartXY(),end:t.getEndXY()}),e,s,n,i,o,a,m);n!==null&&(n.length=0),i!==null&&(i.length=0),s!==null&&(s.length=0);let l=Fe(t,e);if(Qe(t,e,o=Math.max(l,o)))return 0;let u=e.getStartXY();u.subThis(t.m_center);let c=e.getEndXY();c.subThis(t.m_center),u.rotateReverse(t.m_cosr,t.m_sinr),c.rotateReverse(t.m_cosr,t.m_sinr);let g=c.clone();g.subThis(u);let d=t.m_semiMajorAxis,_=1/d,p=t.getSemiMinorAxis(),f=1/p,x=g.clone();x.leftPerpendicularThis();let C=Math.atan2(p*x.y,d*x.x),P=Z(16,Number.NaN),E=Z(16,Number.NaN),S=0,I=[C,C+Math.PI];for(let M=0;M<2;++M){let q=Ht(t,I[M]);if(q>=0&&q<=1){P[S]=q;let R=t.getCoord2D(P[S]);E[S]=e.getClosestCoordinate(R,!1),y.distance(R,e.getCoord2D(E[S]))<=o&&S++}}let D=u.x*_,b=u.y*f,T=g.x*_,A=g.y*f,G=Yn(T*T+A*A,2*(D*T+b*A),D*D+b*b-1,B.unit(),!1,E);w(G>=0);for(let M=0;M<G;M++){let q=g.mul(E[M]).add(u);q.x*=_,q.y*=f;let R=Ht(t,Math.atan2(q.y,q.x));if(R>=0&&R<=1){P[S]=R;let X=t.getCoord2D(R);E[S]=e.getClosestCoordinate(X,!1),y.distance(X,e.getCoord2D(E[S]))<=o&&S++}}w(S<P.length+4);let F=Z(16,Number.NaN);G=t.intersectPoint(e.getStartXY(),F,o);for(let M=0;M<G;M++,S++)P[S]=F[M],E[S]=0;G=t.intersectPoint(e.getEndXY(),F,o);for(let M=0;M<G;M++,S++)P[S]=F[M],E[S]=1;G=e.intersectPoint(t.getStartXY(),F,o);for(let M=0;M<G;M++,S++)P[S]=0,E[S]=F[M];G=e.intersectPoint(t.getEndXY(),F,o);for(let M=0;M<G;M++,S++)P[S]=1,E[S]=F[M];return S===0?0:Ke(r,t,e,P,E,S,s,n,i,o,a,h,m)}function Xg(r,t,e,s,n,i,o,a,h,m){if(wt(t)){let T=new nt({start:t.getStartXY(),end:t.getEndXY()});return Ir(r,e,T,s,i,n,o,a,h,!0)}if(wt(e)){let T=new nt({start:e.getStartXY(),end:e.getEndXY()});return Ir(r,t,T,s,n,i,o,a,h,m)}let l=Fe(t,e);o=Math.max(o,l);let u=!1;{let T=t.getSemiAxes(),A=t.getCenter(),G=e.getSemiAxes(),F=e.getCenter(),M=y.distance(F,A),q=T.x+G.x;if(M>q+o)return 0;if(T.y>G.x){if(M+G.x+o<T.y)return 0}else if(G.y>T.x&&M+T.x+o<G.y)return 0;if(h&&!a){let R=t.m_minorMajorRatio===1&&t.isClosed()&&t.isMajor(),X=e.m_minorMajorRatio===1&&e.isClosed()&&e.isMajor();if(R&&X&&(u=!0,M<=q)&&Math.max(T.x,G.x)<=Math.min(T.x,G.x)+M)return w(!n&&!i),1}}if(!u&&Qe(t,e,o))return 0;let c=[],g=[],d=!1,_=!1,p=Er(t,0,0,d,_,c,g,null),f=[],x=[],C=Er(e,0,0,d,_,f,x,null);if(p===1&&C===1){let T=new _e({points:c,weights:g}),A=new _e({points:f,weights:x}),G=[],F=[],M=lr(!1,T,A,s,n===null?null:G,i===null?null:F,o,a,h,m);if(M>0&&n!==null||i!==null){n&&(n.length=0),i&&(i.length=0);for(let q=0;q<M;++q){if(n)if(bt(G[q],0,1))n.push(G[q]);else{let R=T.tToLength(G[q]),X=t.lengthToT(R);n.push(X)}if(i)if(bt(F[q],0,1))i.push(F[q]);else{let R=A.tToLength(F[q]),X=e.lengthToT(R);i.push(X)}}}return M}let P=[],E=[],S=0,I=h&&!a;for(let T=0;T<p;T++){let A=new _e({points:c.slice(2*T,2*T+3),weights:g.slice(2*T,2*T+3)}),G=0;for(let F=0;F<C;F++){E.length<=F&&E.push(new _e({points:f.slice(2*F,2*F+3),weights:x.slice(2*F,2*F+3)}));let M=[],q=[],R=I?null:M,X=I?null:q,z=lr(!1,A,E[F],null,R,X,o,!1,I,!1);if(z>0&&I)return 1;for(let Y=0;Y<z;++Y){if(M[Y]===0&&T===0)M[Y]=0;else if(M[Y]===1&&T===p-1)M[Y]=1;else{let L=A.tToLength(M[Y])+S,W=t.lengthToT(L);M[Y]=W}if(q[Y]===0&&F===0)q[Y]=0;else if(q[Y]===1&&F===C-1)q[Y]=1;else{let L=E[F].tToLength(q[Y])+G,W=e.lengthToT(L);q[Y]=W}P.push(Kt(M[Y],q[Y]))}G+=E[F].calculateLength2D()}S+=A.calculateLength2D()}if(P.length===0)return 0;if(a&&(P=P.filter(T=>!bt(T.first,0,1)||!bt(T.second,0,1)||!t.getCoord2D(T.first).equals(e.getCoord2D(T.second)))),h)return P.length;let D=[],b=[];for(let T of P)D.push(T.first),b.push(T.second);return Ke(r,t,e,D,b,D.length,s,n,i,o,a,h,m)}function Hc(r,t,e){if(e.setCoords(r.getCoord2D(t.vmin)),e.mergeNe(r.getCoord2D(t.vmax)),wt(r))return;let s=r.getSemiAxes(),n=[0,0,0,0];{let o=Math.atan2(-s.y*r.m_sinr,s.x*r.m_cosr),a=o+Math.PI,h=Math.atan2(s.y*r.m_cosr,s.x*r.m_sinr),m=h+Math.PI;n[0]=Ht(r,o),n[1]=Ht(r,a),n[2]=Ht(r,h),n[3]=Ht(r,m)}let i=new y;for(let o=0;o<4;o++){let a=n[o];t.containsExclusiveCoordinate(a)&&(r.queryCoord2D(a,i),e.mergeNe(i))}}function Lc(r,t,e,s,n){if(r.m_semiMajorAxis===0)return e.vmin;let i=y.getNAN();r.queryCoord2D(e.vmin,i);let o=y.getNAN();if(r.queryCoord2D(e.vmax,o),wt(r))return new nt({start:i,end:o}).getClosestCoordinate(t,s);let a=_h(r,t);if(i=_h(r,i),o=_h(r,o),r.m_minorMajorRatio===1){if(a.isEqual(0,0))return e.vmin;let S=Ht(r,Math.atan2(a.y,a.x));return s||e.containsCoordinate(S)?S:y.distance(a,i)<=y.distance(a,o)?e.vmin:e.vmax}let h=r.getSemiMajorAxis(),m=r.getSemiMinorAxis(),l=(h-m)*(h+m),u=Et(l),c=a.x,g=a.y,d=Et(m*g),_=m*l*g*2,p=[new H(d),new H(_),new H(u-Et(h*c)-d),new H(-_),new H(-u)],f=k(H,4),x=tg(p,4,new B(-1,1),!1,f,4),C=e.vmin,P=y.sqrDistance(a,i);{let S=y.sqrDistance(a,o);S<P&&(C=e.vmax,P=S)}w(!s);let E=Z(8,Number.NaN);for(let S=0;S<x;++S){let I=f[S].value(),D=Math.sqrt(1-I*I),b=Math.atan2(I,D),T=Math.atan2(I,-D);E[2*S]=Ht(r,b),E[2*S+1]=Ht(r,T)}E=E.slice(0,2*x),Nn(E);for(let S=0,I=2*x;S<I;++S)if(E[S]>e.vmin&&E[S]<e.vmax){let D=y.sqrDistance(t,r.getCoord2D(E[S]));P>D&&(P=D,C=E[S])}return C}function Xf(r,t,e){w(!wt(r));let s=new ct;s.setRotateAngle(-r.getAxisXRotation());let n=new y;s.queryTransform(t,n);let i=Math.atan2(-n.x*r.getMinorMajorRatio(),n.y),o=i+_t(),a=Ht(r,i),h=Ht(r,o);h<a&&(h=O(a,a=h));let m=0;return a>=0&&a<=1&&(e[m++]=a),h>=0&&h<=1&&(e[m++]=h),m}function Bc(r,t,e){return r.m_semiMajorAxis===t.m_semiMajorAxis&&r.isMajor()!==t.isMajor()&&!!r.m_center.equals(t.m_center)&&r.m_sinr===t.m_sinr&&r.m_cosr===t.m_cosr&&r.m_minorMajorRatio===t.m_minorMajorRatio&&(e?r.isClockwise()!==t.isClockwise():r.isClockwise()===t.isClockwise())}function kf(r,t,e){if(wt(r))e.setE($.constructPoint2D(r.getEndXY()).subE($.constructPoint2D(r.getStartXY())));else{let s=new H;Gg(r,t,s);let n=new $;if(n.setCoordsE(new H(r.m_semiMajorAxis).negate().mulE(new H().setSin(s)),new H(r.getSemiMinorAxis()).mulE(new H().setCos(s))),r.m_rotation){let i=new H(r.m_rotation);n.rotateDirect(new H().setCos(i),new H().setSin(i))}n.scaleThis(new H(r.getSweepAngle())),e.setE(n)}}function Rf(r,t,e,s){let n=r.getStartXY(),i=r.getEndXY(),o=n.equals(i),a=t.equals(e);if(!o&&!a){let _=new ct;_.setShiftCoords(-r.m_XStart,-r.m_YStart);let p=y.distance(t,e),f=y.distance(n,i),x=p/f;_.scale(x,x);let C=i.sub(n);C.divThis(f);let P=e.sub(t);P.divThis(p);let E=C.crossProduct(P),S=P.dotProduct(C);return _.rotate(S,E),_.shiftCoords(t.x,t.y),Im(r,_,!0),r.m_XStart=t.x,r.m_YStart=t.y,r.m_XEnd=e.x,void(r.m_YEnd=e.y)}let h=new y;if(r.queryCoord2D(.5,h),a){if(o){let _=r.m_center.add(t.sub(n));r.constructEllipticArcEndPointsCenter(t,e,r.getSemiMajorAxis(),1,0,!0,!r.isClockwise(),_),r.setProjectionBehavior(0)}else if(r.isMajor()){let _=h.sub(t).getUnitVector().mul(2*r.getSemiMajorAxis()).add(t);r.constructCircularArcThreePoint(t,e,_)}else r.constructCircularArcThreePoint(t,e,t);return}let m=t.add(e).mul(.5),l=e.sub(t);l.rightPerpendicularThis();let u=m.add(l),c=y.getClosestCoordinate(m,u,r.getCenter(),!0),g=new y;qt(m,u,c,g);let d=y.distance(t,g);r.constructEllipticArcEndPointsCenter(t,e,d,1,0,!0,!r.isClockwise(),g),r.setProjectionBehavior(0)}function kg(r,t,e,s){let n=r.getStartXY(),i=r.getEndXY(),o=n.equals(i),a=t.equals(e);if(!o&&!a){let g=new ct;return g.initializeFromTwoPoints(n,i,t,e),Im(r,g,!0),r.m_XStart=t.x,r.m_YStart=t.y,r.m_XEnd=e.x,r.m_YEnd=e.y,r.endPointModified(),void r.normalizeAfterEndpointChange()}if(!r.isMajor())return void hs(r,t,e,1);if(o&&a){let g=r.m_center.add(t.sub(n));return void r.constructEllipticArcEndPointsCenter(t,e,r.getSemiMajorAxis(),r.getMinorMajorRatio(),r.getAxisXRotation(),!0,!r.isClockwise(),g)}if(!o){let g=.5*(ge()-Math.abs(r.getSweepAngle())),d=(r.getSweepAngle()+g*Mt(r.getSweepAngle()))/r.getSweepAngle(),_=new y;r.queryCoord2D(d,_),r.constructEllipticArcEndPointsCenter(_,_,r.getSemiMajorAxis(),r.getMinorMajorRatio(),r.getAxisXRotation(),!0,!r.isClockwise(),r.getCenter());let p=r.getCenter().add(t.sub(_));return void r.constructEllipticArcEndPointsCenter(t,e,r.getSemiMajorAxis(),r.getMinorMajorRatio(),r.getAxisXRotation(),!0,!r.isClockwise(),p)}let h=y.sqrDistance(t,e),m=.25,l=.75;if(h<y.sqrDistance(r.getCoord2D(.25),r.getCoord2D(.75))){let g=[0],d=xn(new sm(r,h),B.construct(0,.25),1,g);d>0&&(w(d===1),m=g[0],l=1-g[0])}let u=r.getCoord2D(m),c=r.getCoord2D(l);w(!u.equals(c)),r.constructEllipticArcEndPointsCenter(u,c,r.getSemiMajorAxis(),r.getMinorMajorRatio(),r.getAxisXRotation(),!0,!r.isClockwise(),r.m_center),kg(r,t,e)}function Hf(r,t){let e,s=t,n=null;switch(s||(n=La(r)?Li():xs(),s=n),r){case N.enumPoint:e=new st({vd:s});break;case N.enumLine:e=new nt({vd:s});break;case N.enumBezier:e=new Ge({vd:s});break;case N.enumEllipticArc:e=new je({vd:s});break;case N.enumRationalBezier2:e=new _e({vd:s});break;case N.enumBezier2:e=new Ls({vd:s});break;case N.enumEnvelope:e=new Me({vd:s});break;case N.enumMultiPoint:e=new Lt({vd:s});break;case N.enumPolyline:e=new dt({vd:s});break;case N.enumPolygon:e=new lt({vd:s});break;case N.enumMultipatch:ft("multipatch not impl");break;case N.enumGeometryCollection:e=new Co({vd:s});break;default:U("Geometry.create")}return e}var Uc=Ft,v=-1,Yt=1,rm=class{constructor(t){this.m_shape=t}userSort(t,e,s){this.m_shape.sortVerticesSimpleByYHelper(s,t,e)}getValue(t){return this.m_shape.getY(t)}};function Lf(r){return r.parent!==void 0}var di=class r{constructor(t){Lf(t)?(this.m_parent=t.parent,this.m_geometry=t.geometry,this.m_path=t.path,this.m_vertex=t.vertex,this.m_firstVertex=t.firstVertex,this.m_index=t.selection?0:t.index,this.m_bSkipMultiPoints=t.bSkipMultiPoints,this.m_selection=t.selection,this.m_bOneGeom=t.bOneGeom,this.m_bFirst=!0):(this.m_parent=t.copy.m_parent,this.m_geometry=t.copy.m_geometry,this.m_path=t.copy.m_path,this.m_vertex=t.copy.m_vertex,this.m_index=t.copy.m_index,this.m_bSkipMultiPoints=t.copy.m_bSkipMultiPoints,this.m_firstVertex=t.copy.m_firstVertex,this.m_bFirst=!0,this.m_selection=t.copy.m_selection,this.m_bOneGeom=t.copy.m_bOneGeom)}moveToNextHelper(){for(this.m_path=this.m_parent.getNextPath(this.m_path),this.m_index=0;this.m_geometry!==v;){for(;this.m_path!==v;this.m_path=this.m_parent.getNextPath(this.m_path))if(this.m_vertex=this.m_parent.getFirstVertex(this.m_path),this.m_firstVertex=this.m_vertex,this.m_vertex!==v)return this.m_vertex;if(this.m_bOneGeom)return v;if(this.m_geometry=this.m_parent.getNextGeometry(this.m_geometry),this.m_geometry===v)break;this.m_bSkipMultiPoints&&!at(this.m_parent.getGeometryType(this.m_geometry))||(this.m_path=this.m_parent.getFirstPath(this.m_geometry))}return v}nextSelection(){for(;this.m_index<this.m_parent.m_selectedVertices.length;){let t=this.m_parent.m_selectedVertices[this.m_index++];if(t!==v&&(this.m_path=this.m_parent.getPathFromVertex(t),!this.m_bOneGeom||this.m_geometry===this.m_parent.getGeometryFromPath(this.m_path)))return this.m_geometry=this.m_parent.getGeometryFromPath(this.m_path),t}return v}next(){return this.m_selection?this.nextSelection():this.m_bFirst?(this.m_bFirst=!1,this.m_vertex):this.m_vertex!==v?(this.m_vertex=this.m_parent.getNextVertex(this.m_vertex),this.m_index++,this.m_vertex!==v&&this.m_vertex!==this.m_firstVertex?this.m_vertex:this.moveToNextHelper()):v}currentGeometry(){return this.m_geometry}currentPath(){return this.m_path}static create_(t,e,s,n,i,o,a,h,m){return new r({parent:t,geometry:e,path:s,vertex:n,firstVertex:i,index:o,bSkipMultiPoints:a,selection:h,bOneGeom:m})}},_i=class{constructor(t){this.parentage=t}equals(t){return this.parentage===t.parentage}},Nt=class r{setPrevPath(t,e){this.m_pathIndexList.setField(t,1,e)}setNextPath(t,e){this.m_pathIndexList.setField(t,2,e)}setPathFlags(t,e){this.m_pathIndexList.setField(t,6,e)}getPathFlags(t){return this.m_pathIndexList.getField(t,6)}setPathGeometry(t,e){this.m_pathIndexList.setField(t,7,e)}getPathIndex(t){return this.m_pathIndexList.getField(t,0)}setNextGeometry(t,e){this.m_geometryIndexList.setField(t,1,e)}setPrevGeometry(t,e){this.m_geometryIndexList.setField(t,0,e)}getGeometryIndex(t){return this.m_geometryIndexList.getField(t,7)}setFirstPath(t,e){this.m_geometryIndexList.setField(t,3,e)}setLastPath(t,e){this.m_geometryIndexList.setField(t,4,e)}newGeometry(t){let e=this.m_geometryIndexList.newElement();return this.m_geometryIndexList.setField(e,2,t),this.m_geometryIndexList.setField(e,5,0),this.m_geometryIndexList.setField(e,6,0),this.m_geometryIndexList.setField(e,7,this.m_geometryIndexList.elementToIndex(e)),e}freeGeometry(t){this.m_geometryIndexList.deleteElement(t)}newPath(t){let e=this.m_pathIndexList.newElement(),s=this.m_pathIndexList.elementToIndex(e);if(this.m_pathIndexList.setField(e,0,s),this.m_pathIndexList.setField(e,3,0),this.m_pathIndexList.setField(e,6,0),this.setPathGeometry(e,t),s>=this.m_pathAreas.length){let n=Math.trunc(s<16?16:3*s/2);this.m_pathAreas.length=n,this.m_pathLengths.length=n}return this.m_pathAreas[s]=0,this.m_pathLengths[s]=0,this.m_pathCount++,e}freePath(t){this.m_pathIndexList.deleteElement(t),this.m_pathCount--}newVertex(t){let e=this.m_vertexIndexList.newElement(),s=t>=0?t:this.m_vertexIndexList.elementToIndex(e);if(this.m_vertexIndexList.setField(e,0,s),t<0){if(s>=this.m_vertices.getPointCount()){let n=Math.trunc(s<16?16:3*s/2);this.m_vertices.reserveRounded(n),this.m_vertices.resizeNoInit(n),this.m_segments!==null&&(this.m_segments.length=n),this.m_xyStream=this.m_vertices.getAttributeStreamRef(0)}this.m_segments&&(this.m_segments[s]=null)}return this.m_pointCount++,e}freeVertex(t){this.unselect(t);let e=this.getVertexIndex(t);this.m_vertexIndexList.deleteElement(t),this.m_pointCount--;for(let s=0,n=this.m_indices.length;s<n;s++){if(s===this.m_selectionIndex)continue;let i=this.m_indices[s];i!==null&&i.size()>e&&i.write(e,-1)}this.m_weights&&this.m_weights.size()>e&&this.m_weights.write(e,1),this.m_ranks&&this.m_ranks.size()>e&&this.m_ranks.write(e,Yt),this.m_segmentWeights&&this.m_segmentWeights.size()>e&&this.m_segmentWeights.write(e,1),this.m_segmentRanks&&this.m_segmentRanks.size()>e&&this.m_segmentRanks.write(e,Yt),this.m_segments&&this.setSegmentToIndex(e,null)}insertVertex_(t,e,s,n){this.m_hasForceSetEnvelope=0;let i=e!==v?this.getPrevVertex(e):this.getLastVertex(t),o=i!==v?this.getNextVertex(i):v,a=this.newVertex(s===null?this.m_pointCount:-1),h=this.getVertexIndex(a);s!==null&&this.m_vertices.setPointByVal(h,s),this.setPathToVertex(a,t),this.setNextVertex(a,o),this.setPrevVertex(a,i),o!==v&&this.setPrevVertex(o,a),i!==v&&this.setNextVertex(i,a);let m=this.isClosedPath(t),l=this.getFirstVertex(t);e===v&&this.setLastVertex(t,a),e===l&&(m&&n&&l!==v||this.setFirstVertex(t,a)),m&&o===v&&(this.setNextVertex(a,a),this.setPrevVertex(a,a)),this.setPathSize(t,this.getPathSize(t)+1);let u=this.getGeometryFromPath(t);return this.setGeometryVertexCount(u,this.getPointCount(u)+1),a}getHelperPoint(){return this.m_helperPoint||(this.m_helperPoint=new st({vd:this.m_vertices.getDescription()}),this.m_helperPoint.setXYCoords(0,0)),this.m_helperPoint}addMultiPoint(t,e){let s=this.createGeometry(t.getGeometryType(),t.getDescription());return this.appendMultiPoint(s,t,e),s}addPoint_(t,e){let s=this.createGeometry(N.enumMultiPoint,t.getDescription());return this.appendPoint(s,t,e),s}appendMultiPath_(t,e){if(e.isEmpty())return;let s=e.getImpl();this.m_vertices.reserveRounded(this.m_vertices.getPointCount()+s.getPointCount()),this.m_verticesMp.addPoints(e,0,s.getPointCount()),this.m_xyStream=this.m_vertices.getAttributeStreamRef(0);let n=this.m_segments!==null||s.getSegmentFlagsStreamRef()!==null;this.m_vertexIndexList.setCapacity(this.m_vertexIndexList.size()+s.getPointCount()),this.m_pathIndexList.setCapacity(this.m_pathIndexList.size()+s.getPathCount());for(let i=0,o=s.getPathCount();i<o;i++){if(s.getPathSize(i)===0)continue;let a=this.insertPath(t,v);this.setClosedPath(a,s.isClosedPath(i));for(let h=s.getPathStart(i),m=s.getPathEnd(i);h<m;h++){let l=this.insertVertex_(a,v,null,!1);if(n){let u=this.getVertexIndex(l);if(1&s.getSegmentFlags(h))this.setSegmentToIndex(u,null);else{let c=new et;s.querySegment(h,c,!0),this.setSegmentToIndex(u,c.releaseSegment())}}}s.isStrongPathStart(i)&&this.setStrongPathStart(a,!0),s.isStrongPathEnd(i)&&this.setStrongPathEnd(a,!0)}}addMultiPath(t,e){let s=this.createGeometry(t.getGeometryType(),t.getDescription());return t.getGeometryType()===N.enumPolygon&&this.setFillRule(s,t.getFillRule()),this.appendMultiPath(s,t,e),s}appendMultiPathPolyline(t,e,s){let n=e.getImpl(),i=this.m_segments!==null||n.getSegmentFlagsStreamRef()!==null,o=new V;e.queryEnvelope(o);{let a=s.clone(),h=n.getPointCount(),m=n.getAccelerators();if(m&&m.getQuadTree()&&(h=m.getQuadTree().getIntersectionCount(a,0,n.getPointCount()+1)),h<e.getPointCount()){if(h===0)return;let l=n.queryLimitedSegmentIterator(a),u=-1,c=-100,g=-1,d=0,_=-1,p=v,f=!1,x=l.nextSegment();if(x!==null)for(;;x=l.nextSegment()){let C=x===null,P=x!==null?l.getPathIndex():u,E=x!==null?l.getStartPointIndex():c;if(C||(u===P&&c+1===E?d++:C=!0),C){if(_!==-1){let S=-1,I=-1;if(d===g){this.setClosedPath(p,f);let D=n.getPathEnd(u);this.m_vertices.reserveRounded(this.m_vertices.getPointCount()+D-_),this.m_verticesMp.addPoints(e,_,D),I=n.getPathSize(u),S=D-1}else if(!f||c+1<n.getPathEnd(u))this.m_vertices.reserveRounded(this.m_vertices.getPointCount()+c+2-_),this.m_verticesMp.addPoints(e,_,c+2),I=c-_+2,S=c;else{this.m_vertices.reserveRounded(this.m_vertices.getPointCount()+c+2-_),this.m_verticesMp?.addPoints(e,_,c+1),S=c,I=c-_+1;let D=n.getPathStart(u);this.m_verticesMp.addPoints(e,D,D+1),I+=1}this.m_xyStream=this.m_vertices.getAttributeStreamRef(0);for(let D=0,b=_;D<I;D++,b++){let T=this.insertVertex_(p,v,null,!1);if(i){let A=this.getVertexIndex(T);if(1&n.getSegmentFlags(b)||b>S)this.setSegmentToIndex(A,null);else{let G=new et;n.getSegmentBuffer(b,G,!0),this.setSegmentToIndex(A,G.releaseSegment())}}}}if(x===null)break;d=1,_=E,u!==P?(p=this.insertPath(t,v),this.setClosedPath(p,!1),g=n.getSegmentCountPath(P),f=n.isClosedPath(P),u=P):p=this.insertPath(t,v)}c=E}return}}this.appendMultiPath_(t,e)}appendMultiPathPolygon(t,e,s){let n=e.getImpl(),i=this.m_segments!==null||n.getSegmentFlagsStreamRef()!==null,o=V.constructEmpty();e.queryEnvelope(o),w(s.isIntersecting(o)&&!s.containsEnvelope(o));let a=V.construct(Number.NEGATIVE_INFINITY,s.ymin,Number.POSITIVE_INFINITY,s.ymax),h=V.construct(s.xmin,Number.NEGATIVE_INFINITY,s.xmax,Number.POSITIVE_INFINITY),m=n.getAccelerators();if(m&&m.getQuadTree()){let E=m.getQuadTree(),S=E.getIntersectionCount(a,0,0);S>E.getIntersectionCount(h,0,S+1)&&(h=O(a,a=h))}else a.height()>h.width()&&(h=O(a,a=h));let l=[],u=n.queryLimitedSegmentIterator(a),c=-1,g=-100,d=-1,_=0,p=-1,f=-1,x=v,C=!0,P=u.nextSegment();if(P!==null)for(;;P=u.nextSegment()){let E=P===null,S=P!==null?u.getPathIndex():c,I=P!==null?u.getStartPointIndex():g;if(E||(S===c?g+1===I?_++:E=!0:(E=c>=0,c<0&&(c=S,d=n.getSegmentCountPath(c),p=I,x=v,_=1))),E){if(!(l.length===0&&d===_)){l.length!==0&&l[0].first===p||(this.m_vertices.reserveRounded(this.m_vertices.getPointCount()+1),this.m_verticesMp.addPoints(e,p,p+1),f===-1&&(f=p),x===v&&(x=this.insertPath(t,v),this.setClosedPath(x,!0)),this.m_xyStream=this.m_vertices.getAttributeStreamRef(0),this.insertVertex_(x,v,null,!1));for(let{first:D,second:b}of l){f===-1&&(f=D);let T=-1,A=-1,G=D+b-1;if(b===d){let F=G+1;A=F-D,this.m_vertices.reserveRounded(this.m_vertices.getPointCount()+A),this.m_verticesMp.addPoints(e,D,F),T=G,w(l.length===1)}else if(G+1<n.getPathEnd(c)){let F=G+2;A=F-D,this.m_vertices.reserveRounded(this.m_vertices.getPointCount()+A),this.m_verticesMp.addPoints(e,D,F),T=G}else{let F=n.getPathStart(c),M=F!==f?1:0,q=G+1;A=q-D+M,this.m_vertices.reserveRounded(this.m_vertices.getPointCount()+(q-D)+M),this.m_verticesMp.addPoints(e,D,q),T=G,M>0&&this.m_verticesMp?.addPoints(e,F,F+1)}this.m_xyStream=this.m_vertices.getAttributeStreamRef(0),x===v&&(x=this.insertPath(t,v),this.setClosedPath(x,!0));for(let F=0,M=D;F<A;F++,M++){let q=this.insertVertex_(x,v,null,!1);if(i){let R=this.getVertexIndex(q);if(1&n.getSegmentFlags(M)||M>T)this.setSegmentToIndex(R,null);else{let X=new et;n.getSegmentBuffer(M,X,!0),this.setSegmentToIndex(R,X.releaseSegment())}}}}if(l.length===0||l.at(-1).first+l.at(-1).second!==p+_){let D=p+_;D===e.getPathEnd(c)&&(D=e.getPathStart(c)),f!==D&&(this.m_vertices.reserveRounded(this.m_vertices.getPointCount()+1),this.m_verticesMp.addPoints(e,D,D+1),this.insertVertex_(x,v,null,!1))}}l.length=0,C=!0,S!==c&&(c=S,d=n.getSegmentCountPath(c),x=v,f=-1),p=I,_=1}if(!P)break;{let D=V.constructEmpty();P.queryLooseEnvelope(D),h.isIntersecting(D)?(C?l.push(Kt(I,1)):l.at(-1).second++,C=!1):C=!0}g=I}}appendMultiPath(t,e,s){if(s===void 0)return void this.appendMultiPath_(t,e);if(e.isEmpty())return;let n=e.getGeometryType()===N.enumPolygon,i=V.constructEmpty();e.queryEnvelope(i),s.isIntersecting(i)&&(!s.containsEnvelope(i)&&e.getPointCount()>10?n?this.appendMultiPathPolygon(t,e,s):this.appendMultiPathPolyline(t,e,s):this.appendMultiPath_(t,e))}appendPoint(t,e,s){if(e.isEmpty()||s!==void 0&&!s.contains(e.getXY()))return;this.m_vertices.reserveRounded(this.m_vertices.getPointCount()+1),this.m_verticesMp.add(e),this.m_xyStream=this.m_vertices.getAttributeStreamRef(0),this.m_vertexIndexList.setCapacity(this.m_vertexIndexList.size()+1);let n=this.insertPath(t,v);this.insertVertex_(n,v,null,!1)}appendMultiPoint_(t,e){this.m_vertices.reserveRounded(this.m_vertices.getPointCount()+e.getPointCount()),this.m_verticesMp.addPoints(e,0,e.getPointCount()),this.m_xyStream=this.m_vertices.getAttributeStreamRef(0),this.m_vertexIndexList.setCapacity(this.m_vertexIndexList.size()+e.getPointCount());let s=this.insertPath(t,v);for(let n=0,i=e.getPointCount();n<i;n++)this.insertVertex_(s,v,null,!1)}appendMultiPoint(t,e,s){if(s===void 0)return void this.appendMultiPoint_(t,e);let n=e.getAttributeStreamRef(0),i=0;for(let l=0,u=e.getPointCount();l<u;l++){let c=n.readPoint2D(2*l);s.contains(c)&&i++}this.m_vertices.reserveRounded(this.m_vertices.getPointCount()+i);let o=-1,a=-1,h=0;for(let l=0,u=e.getPointCount();l<u;l++){let c=n.readPoint2D(2*l);s.contains(c)?(o===-1&&(o=l,a=l),a++):o>=0&&(this.m_verticesMp.addPoints(e,o,a-o),o=-1,h++)}if(o>0&&(this.m_verticesMp.addPoints(e,o,a-o),h++),!h)return;this.m_xyStream=this.m_vertices.getAttributeStreamRef(0),this.m_vertexIndexList.setCapacity(this.m_vertexIndexList.size()+i);let m=this.insertPath(t,v);for(let l=0,u=e.getPointCount();l<u;l++){let c=n.readPoint2D(2*l);s.contains(c)&&this.insertVertex_(m,v,null,!1)}}splitSegmentForward(t,e,s,n,i){let o=this.getNextVertex(t);o===v&&U("Edit_shape.split_segment_forward_");let a=this.getHelperPoint(),h=this.getPathFromVertex(t),m=t,l=this.hasSegmentParentage();for(let u=0,c=e.getResultSegmentCount(s);u<c;u++){let g=this.getVertexIndex(m),d=this.getNextVertex(m),_=e.getResultSegment(s,u),p=null;if(_.getGeometryType()!==N.enumLine&&(p=_.clone(),p.dropAllAttributes()),u===0&&(_.queryStart(a),this.setSegmentToIndex(g,null),this.setPointEx(m,a,e.getResultSegmentStartPointRank(s,u),e.getResultSegmentStartPointWeight(s,u),i)),this.setSegmentRank(m,e.getResultSegmentInteriorRank(s,u)),this.setSegmentWeight(m,e.getResultSegmentInteriorWeight(s,u)),l){let f=e.getResultSegmentSegmentParentage(s,u),x=e.getResultSegmentStartPointIsBreak(s,u);this.setSegmentParentageAndBreak(m,f,x)}if(_.queryEnd(a),u<c-1){this.setSegmentToIndex(g,p);let f=this.insertVertex(h,d,a);this.setWeight(f,e.getResultSegmentEndPointWeight(s,u)),this.setRank(f,e.getResultSegmentEndPointRank(s,u)),this.select(f),m=f}else{this.setPointEx(o,a,e.getResultSegmentEndPointRank(s,u),e.getResultSegmentEndPointWeight(s,u),i);let f=e.getResultSegmentEndPointIsBreak(s,u);this.setSegmentParentageBreakVertex(o,f),this.setSegmentToIndex(g,p)}}}splitSegmentBackward(t,e,s,n,i){let o=this.getNextVertex(t);o===v&&U("Edit_shape.split_segment_backward_");let a=this.getHelperPoint(),h=this.getPathFromVertex(t),m=t,l=this.hasSegmentParentage();for(let u=0,c=e.getResultSegmentCount(s);u<c;u++){let g=c-u-1,d=this.getVertexIndex(m),_=this.getNextVertex(m),p=e.getResultSegment(s,g),f=null;if(p.getGeometryType()!==N.enumLine&&(f=p.clone(),f.reverse(),f.dropAllAttributes()),u===0&&(p.queryEnd(a),this.setSegmentToIndex(d,null),this.setPointEx(m,a,e.getResultSegmentEndPointRank(s,g),e.getResultSegmentEndPointWeight(s,g),i),this.setSegmentParentageAndBreak(m,e.getResultSegmentSegmentParentage(s,g),e.getResultSegmentEndPointIsBreak(s,g))),p.getGeometryType()===N.enumLine?this.setSegmentToIndex(d,null):this.setSegmentToIndex(d,f),this.setSegmentRank(m,e.getResultSegmentInteriorRank(s,g)),this.setSegmentWeight(m,e.getResultSegmentInteriorWeight(s,g)),p.queryStart(a),u<c-1){let x=this.insertVertex(h,_,a);this.setWeight(x,e.getResultSegmentStartPointWeight(s,g)),this.setRank(x,e.getResultSegmentStartPointRank(s,g)),this.select(x),m=x,l&&this.setSegmentParentageAndBreak(x,e.getResultSegmentSegmentParentage(s,g),e.getResultSegmentEndPointIsBreak(s,g))}else this.setPointEx(o,a,e.getResultSegmentStartPointRank(s,g),e.getResultSegmentStartPointWeight(s,g),i)}}selected_(t){return this.getUserIndex(t,this.m_selectionIndex)>=0}allocateIndex(t=!0){if(this.m_deletedIndices.length){let e=this.m_deletedIndices.pop();return t&&e.setRange(-1,0,e.size()),e}return t?Ce(0,-1):Ce(0)}recycleUserIndex(t){this.m_deletedIndices.push(t)}allocatePathIndex(){if(this.m_deletedPathIndices.length){let t=this.m_deletedPathIndices.at(-1);return this.m_deletedPathIndices.pop(),t}return Ce(0)}recyclePathUserIndex(t){this.m_deletedPathIndices.push(t)}peelALoop_(t,e,s){let n=this.getNextVertex(t),i=this.getNextVertex(e),o=this.getVertexIndex(t),a=this.getVertexIndex(e);if(this.setNextVertex(t,i),this.setPrevVertex(i,t),this.setNextVertex(e,n),this.setPrevVertex(n,e),this.m_segments){let h=this.getSegmentFromIndex(o),m=this.getSegmentFromIndex(a);this.setSegmentToIndex(a,null),this.setSegmentToIndex(o,m),this.setSegmentToIndex(a,h)}if(this.hasSegmentParentage()){let h=this.getSegmentParentage(e),m=this.getSegmentParentage(t);h===-1&&m===-1||(m=O(h,h=m),this.setSegmentParentageAndBreak(t,m),this.setSegmentParentageAndBreak(e,h))}if(s){let h=this.getPathFromVertex(t),m=this.getGeometryFromPath(h),l=[!1],u=this.insertClosedPath(m,v,n,this.getFirstVertex(h),l);l[0]&&this.setFirstVertex(h,i);let c=this.getPathSize(h);return c-=this.getPathSize(u),this.setPathSize(h,c),u}return v}sortVerticesSimpleByYHelper(t,e,s){t.sort(e,s,(n,i)=>{let o=this.compareVerticesSimpleY(n,i);if(o===0){let a=this.getPathInternalIndexFromVertex(n),h=this.getPathInternalIndexFromVertex(i);o=a<h?-1:a>h?1:0}return o})}sortVerticesSimpleByYHelper3D(t,e,s){w(0)}constructor(){this.m_verticesMp=null,this.m_vertices=null,this.m_xyStream=null,this.m_vertexDescription=null,this.m_segments=null,this.m_weights=null,this.m_ranks=null,this.m_segmentWeights=null,this.m_segmentRanks=null,this.m_indices=[],this.m_deletedIndices=[],this.m_pathAreas=[],this.m_pathLengths=[],this.m_pathindices=[],this.m_deletedPathIndices=[],this.m_geometryIndices=[],this.m_selectedVertices=[],this.m_helperPoint=null,this.m_forceSetEnvelope=ys.constructEmpty(),this.m_hasForceSetEnvelope=0,this.m_workPoint2D=y.getNAN(),this.m_workPoint2_2D=y.getNAN(),this.m_curveStitcher=null,this.m_pathCount=0,this.m_pointCount=0,this.m_firstGeometry=v,this.m_lastGeometry=v,this.m_vertexIndexList=new Rt(5),this.m_pathIndexList=new Rt(8),this.m_geometryIndexList=new Rt(8),this.m_bHasAttributes=!1,this.m_selectedCount=0,this.m_selectionIndex=-1,this.m_selection=!1,this.m_bucketSort=new ei,this.m_segmentParentageIndex=-1}getTotalPointCount(){return this.m_pointCount}getEnvelope2D(t){if(this.m_hasForceSetEnvelope!==0)return new V(this.m_forceSetEnvelope.xmin,this.m_forceSetEnvelope.ymin,this.m_forceSetEnvelope.xmax,this.m_forceSetEnvelope.ymax);let e=this.hasCurves(),s=V.constructEmpty(),n=this.queryVertexIterator(),i=!0;for(let o=n.next();o!==v;o=n.next()){if(i?s.merge(this.getXY(o)):s.mergeNe(this.getXY(o)),e){let a=this.getSegment(o);if(a!==null){let h=V.constructEmpty();a.queryLooseEnvelope(h),s.mergeEnvelope2D(h)}}i=!1}return s}getEnvelope3D(t){return w(0),ys.constructEmpty()}forceSetEnvelope2D(t){this.m_hasForceSetEnvelope=1,this.m_forceSetEnvelope.setCoords(t.xmin,t.ymin,0,t.xmax,t.ymax,0)}forceSetEnvelope3D(t){w(0)}forgetForceSetEnvelope(){this.m_hasForceSetEnvelope=0}getGeometryCount(){return this.m_geometryIndexList.size()}addGeometry(t,e){let s=t.getGeometryType();if(at(s))return this.addMultiPath(t,e);if(s===N.enumMultiPoint)return this.addMultiPoint(t,e);if(s===N.enumPoint)return this.addPoint_(t,e);if(s===N.enumEnvelope){let n=new lt;return n.addEnvelope(t,!1),this.addMultiPath(n,e)}U("")}appendGeometry(t,e){this.mergeVertexDescription(e.getDescription());let s=e.getGeometryType();at(s)?this.appendMultiPath(t,e):s!==N.enumMultiPoint?U(""):this.appendMultiPoint(t,e)}assignRankToGeometryVertices(t,e){e<Yt&&(e=Yt);let s=this.queryVertexIterator();for(let n=s.next();n!==v;n=s.next())this.setRank(n,e),this.setSegmentRank(n,e)}collapseAllGeometriesToFirst(){this.collapseGeometriesToFirst(N.enumUnknown)}collapseGeometriesToFirst(t){this.dbgVerifyVertexCounts();let e=v,s=-1,n=-1;for(let i=this.getFirstGeometry();i!==v;)if(t!==N.enumUnknown&&this.getGeometryType(i)!==t)i=this.getNextGeometry(i);else{if(e===v){e=i,s=this.getPathCount(e),n=this.getPointCount(e),i=this.getNextGeometry(i);continue}for(let m=this.getFirstPath(i);m!==v;m=this.getNextPath(m))this.setPathGeometry(m,e);s+=this.getPathCount(i),n+=this.getPointCount(i);let o=this.getLastPath(e),a=this.getFirstPath(i);o!==v?this.setNextPath(o,a):this.setFirstPath(e,a),a!==v&&(this.setPrevPath(a,o),this.setLastPath(e,this.getLastPath(i))),this.setFirstPath(i,v),this.setLastPath(i,v);let h=i;i=this.getNextGeometry(i),this.setGeometryVertexCount(h,0),this.removeGeometry(h)}return e!==v&&(this.setGeometryVertexCount(e,n),this.setGeometryPathCount(e,s),this.dbgVerifyVertexCounts()),e}setFillRule(t,e){let s=this.m_geometryIndexList.getField(t,2);s&=-134217729,s|=e===1?134217728:0,this.m_geometryIndexList.setField(t,2,s)}getFillRule(t){return 134217728&this.m_geometryIndexList.getField(t,2)?1:0}setGeometryModified(t,e){let s=this.m_geometryIndexList.getField(t,2);!!(67108864&s)!==e&&(s&=-67108865,s|=e?67108864:0,this.m_geometryIndexList.setField(t,2,s))}getGeometryModified(t){return!!(67108864&this.m_geometryIndexList.getField(t,2))}setGeometryModifiedWithVertex(t,e){let s=this.getPathFromVertex(t),n=this.getGeometryFromPath(s);this.setGeometryModified(n,e)}getGeometryModifiedWithVertex(t){let e=this.getPathFromVertex(t),s=this.getGeometryFromPath(e);return this.getGeometryModified(s)}swapGeometry(t,e){let s=this.getFirstPath(t),n=this.getFirstPath(e),i=this.getLastPath(t),o=this.getLastPath(e);for(let g=this.getFirstPath(t);g!==v;g=this.getNextPath(g))this.setPathGeometry(g,e);for(let g=this.getFirstPath(e);g!==v;g=this.getNextPath(g))this.setPathGeometry(g,t);this.setFirstPath(t,n),this.setFirstPath(e,s),this.setLastPath(t,o),this.setLastPath(e,i);let a=this.getPointCount(t),h=this.getPathCount(t),m=this.getPointCount(e),l=this.getPathCount(e);this.setGeometryVertexCount(t,m),this.setGeometryVertexCount(e,a),this.setGeometryPathCount(t,l),this.setGeometryPathCount(e,h);let u=this.m_geometryIndexList.getField(t,2),c=this.m_geometryIndexList.getField(e,2);this.m_geometryIndexList.setField(t,2,c),this.m_geometryIndexList.setField(e,2,u)}addPathFromMultiPath(t,e,s){let n=this.createGeometry(s?N.enumPolygon:N.enumPolyline,t.getDescription()),i=t.getImpl();if(t.getPathSize(e)<2)return n;this.m_vertices.reserveRounded(this.m_vertices.getPointCount()+t.getPathSize(e)),this.m_verticesMp.addPoints(t,t.getPathStart(e),i.getPathEnd(e)),this.m_xyStream=this.m_vertices.getAttributeStreamRef(0);let o=this.insertPath(n,v);this.setClosedPath(o,i.isClosedPath(e)||s);let a=this.m_segments!==null||i.getSegmentFlagsStreamRef()!==null;for(let h=i.getPathStart(e),m=i.getPathEnd(e);h<m;h++){let l=this.insertVertex_(o,v,null,!1);if(a){let u=this.getVertexIndex(l);if(1&i.getSegmentFlags(h))this.setSegmentToIndex(u,null);else{let c=new et;i.querySegment(h,c,!0),this.setSegmentToIndex(u,c.releaseSegment())}}}return i.isStrongPathStart(e)&&this.setStrongPathStart(o,!0),i.isStrongPathEnd(e)&&this.setStrongPathEnd(o,!0),n}getGeometry(t){let e=this.getGeometryType(t),s=Hf(e,this.m_verticesMp.getDescription()),n=this.getPointCount(t);if(n===0)return s;if(at(e)){let i=s.getImpl(),o=this.getPathCount(t),a=Ce(o+1),h=Zs(o+1,0),m=s.getDescription(),l=this.hasCurves();for(let u=0,c=m.getAttributeCount();u<c;u++){let g=m.getSemantics(u),d=Uc.getComponentCount(g),_=ih(g,n),p=this.m_vertices.getAttributeStreamRef(g),f=0,x=0,C=0;for(let P=this.getFirstPath(t);P!==v;P=this.getNextPath(P)){let E=0;this.isClosedPath(P)&&(E|=1),this.isExterior(P)&&(E|=8),this.isStrongPathStart(P)&&(E|=2),this.isStrongPathEnd(P)&&(E|=4),E&&h.setBits(x,E);let S=this.getPathSize(P);if(a.write(x++,C),C+=S,g===0){let I=p,D=_,b;for(let T=this.getFirstVertex(P);f<C;T=this.getNextVertex(T),f++){let A=this.getVertexIndex(T);b=I.readPoint2D(2*A),D.writePoint2D(2*f,b)}}else for(let I=this.getFirstVertex(P);f<C;I=this.getNextVertex(I),f++){let D=this.getVertexIndex(I);for(let b=0;b<d;b++){let T=p.readAsDbl(D*d+b);_.writeAsDbl(f*d+b,T)}}}i.setAttributeStreamRef(g,_),a.write(o,n)}if(i.setPathFlagsStreamRef(h),i.setPathStreamRef(a),i.notifyModifiedFlags(65535),l){let u=0,c=0;for(let g=this.getFirstPath(t);g!==v;g=this.getNextPath(g)){u+=this.getPathSize(g);for(let d=this.getFirstVertex(g);c<u;d=this.getNextVertex(d)){let _=this.getSegment(d);_!==null&&_.isCurve()&&i.replaceSegment(c,_,!0),c++}}}}else if(e===N.enumMultiPoint){let i=s.getImpl(),o=s.getDescription();i.reserve(n),i.resizeNoInit(n);for(let a=0,h=o.getAttributeCount();a<h;a++){let m=o.getSemantics(a),l=Uc.getComponentCount(m),u=i.getAttributeStreamRef(m),c=this.m_vertices.getAttributeStreamRef(m),g=0,d=this.getFirstPath(t),_=this.getPathSize(d);for(let p=this.getFirstVertex(d);g<_;p=this.getNextVertex(p),g++){let f=this.getVertexIndex(p);for(let x=0;x<l;x++){let C=c.readAsDbl(f*l+x);u.writeAsDbl(g*l+x,C)}}i.setAttributeStreamRef(m,u)}i.notifyModifiedFlags(65535)}else j("getGeometry");return s}queryPointGeometryOnly(t,e){this.getGeometryType(t)!==N.enumMultiPoint&&U("get_point_geometry_only");let s=this.getPointCount(t);if(s>1&&U("get_point_geometry_only"),s===0)return e.assignVertexDescription(this.m_vertexDescription),void e.setEmpty();let n=this.getFirstPath(t),i=this.getFirstVertex(n);this.queryPoint(i,e)}removeGeometry(t){for(let n=this.getFirstPath(t);n!==v;n=this.removePath(n));let e=this.getPrevGeometry(t),s=this.getNextGeometry(t);return e!==v?this.setNextGeometry(e,s):this.m_firstGeometry=s,s!==v?this.setPrevGeometry(s,e):this.m_lastGeometry=e,this.freeGeometry(t),s}createGeometry(t,e){e===void 0&&(e=xs());let s=this.newGeometry(t);return this.m_vertices||(this.m_verticesMp=new Lt({vd:e}),this.m_vertices=this.m_verticesMp.getImpl()),this.mergeVertexDescription(e),this.m_firstGeometry===v?(this.m_firstGeometry=s,this.m_lastGeometry=s):(this.setPrevGeometry(s,this.m_lastGeometry),this.setNextGeometry(this.m_lastGeometry,s),this.m_lastGeometry=s),s}getFirstGeometry(){return this.m_firstGeometry}getLastGeometry(){return this.m_lastGeometry}getNextGeometry(t){return this.m_geometryIndexList.getField(t,1)}getPrevGeometry(t){return this.m_geometryIndexList.getField(t,0)}getGeometryType(t){return 16777215&this.m_geometryIndexList.getField(t,2)}setGeometryUserIndex(t,e,s){let n=this.m_geometryIndices[e],i=this.getGeometryIndex(t);i>=n.size()&&n.resize(Math.max(1.25*i,16),-1),n.write(i,s)}getGeometryUserIndex(t,e){let s=this.getGeometryIndex(t),n=this.m_geometryIndices[e];return s<n.size()?n.read(s):-1}createGeometryUserIndex(){for(let e=0;e<this.m_geometryIndices.length;e++)if(this.m_geometryIndices[e]===null)return this.m_geometryIndices[e]=Ce(0),e;this.m_geometryIndices.push(Ce(0));let t=this.m_geometryIndices.length-1;return w(t>=0&&t<=Number.MAX_SAFE_INTEGER),t}removeGeometryUserIndex(t){for(this.m_geometryIndices[t]=null;this.m_geometryIndices.length>0&&this.m_geometryIndices.at(-1)===null;)this.m_geometryIndices.pop()}getFirstPath(t){return this.m_geometryIndexList.getField(t,3)}getLastPath(t){return this.m_geometryIndexList.getField(t,4)}hasPointFeatures(){for(let t=this.getFirstGeometry();t!==v;t=this.getNextGeometry(t))if(!at(this.getGeometryType(t)))return!0;return!1}getPointCount(t){return this.m_geometryIndexList.getField(t,5)}getPathCount(t){return this.m_geometryIndexList.getField(t,6)}filterClosePoints(t,e,s,n,i){let o=t*t,a=0,h=this.hasCurves(),m=this.hasSegmentParentage();for(let l=i===v?this.getFirstGeometry():i;l!==v;l=i===v?this.getNextGeometry(l):v){let u=this.getGeometryType(l);if(!at(u)||s&&u!==N.enumPolygon)continue;let c=this.getGeometryType(l)===N.enumPolygon,g=this.getGeometryModified(l);for(let d=this.getFirstPath(l);d!==v;){let _=0;for(let C=this.getFirstVertex(d);_<Math.trunc(this.getPathSize(d)/2);){let P=this.getNextVertex(C);if(P===v)break;let E=this.getXY(C),S=this.getXY(P),I=y.sqrDistance(E,S),D=!0;do if(I<=o){if(h){let b=this.getSegment(C);if(b!==null){let T=b.calculateLength2D();if(I=T*T,I>o)break}}if(I===0?a===0&&(a=-1):a=1,P!==this.getLastVertex(d)){let b=m&&(this.getSegmentParentageBreakVertex(C)||this.getSegmentParentageBreakVertex(P));if(this.transferAllDataToTheVertex(P,C),this.removeVertex(P,!1),n&&!g&&(this.setGeometryModified(l,!0),g=!0),m&&C!==P){this.setSegmentParentageBreakVertex(C,b);let T=this.getNextVertex(C);w(T!==v),this.isDiscontinuousSegmentParentage(T)&&this.setSegmentParentageBreakVertex(T,!0)}}D=!1}while(!1);D&&(C=this.getNextVertex(C)),_++}let p=this.getFirstVertex(d);for(let C=this.isClosedPath(d)?p:this.getLastVertex(d);this.getPathSize(d)>0;){let P=this.getPrevVertex(C);if(P===v)break;{let E=this.getXY(P),S=this.getXY(C),I=y.sqrDistance(E,S),D=!0;do if(I<=o){if(h){let T=this.getSegment(P);if(T!==null){let A=T.calculateLength2D();if(I=A*A,I>o)break}}I===0?a===0&&(a=-1):a=1;let b=m&&(this.getSegmentParentageBreakVertex(C)||this.getSegmentParentageBreakVertex(P));this.removeVertex(P,!0),n&&!g&&(this.setGeometryModified(l,!0),g=!0),m&&P!==C&&(b||this.isDiscontinuousSegmentParentage(C))&&this.setSegmentParentageBreakVertex(C,!0),p===P&&(p=this.getFirstVertex(d)),D=!1}while(!1);if(D&&(C=this.getPrevVertex(C),C===p))break}}let f=this.getPathSize(d),x=e&&f<(c?3:2);x&&c&&f===2&&h&&(x=!this.pathHasCurves(d)),x?(d=this.removePath(d),a===0&&(a=-1),n&&!g&&(this.setGeometryModified(l,!0),g=!0)):d=this.getNextPath(d)}}return a}filterClosePoints3D(t,e,s,n,i,o){return w(0),0}hasDegenerateSegments(t){for(let e=this.getFirstGeometry();e!==v;e=this.getNextGeometry(e))if(at(this.getGeometryType(e)))for(let s=this.getFirstPath(e);s!==v;){let n=this.getPathSize(s);if(n===0)return!0;let i=this.getFirstVertex(s);for(let o=0;o<n;o++){let a=this.getNextVertex(i);if(a===v)break;let h=this.getVertexIndex(i),m=this.getSegmentFromIndex(h),l=0;if(m!==null){if(l=m.calculateLowerLength2D(),l<=t&&(l=m.calculateUpperLength2D(),l<=t||(l=m.calculateLength2D(),l<=t)))return!0}else{let u=this.getVertexIndex(a);if(l=this.m_vertices.getShortestDistance(h,u),l<=t)return!0}i=a}s=this.getNextPath(s)}return!1}hasDegenerateSegments3D(t,e){return w(0),!1}transferAllDataToTheVertex(t,e){let s=this.getVertexIndex(t),n=this.getVertexIndex(e);if(this.m_weights){let o=this.getWeightWithIndex(s);this.setWeightWithIndex(n,o)}if(this.m_ranks){let o=this.getRankWithIndex(s);this.setRankWithIndex(n,o)}if(this.m_segmentWeights){let o=this.getSegmentWeightWithIndex(s);this.setSegmentWeightWithIndex(n,o)}if(this.m_segmentRanks){let o=this.getSegmentRankWithIndex(s);this.setSegmentRankWithIndex(n,o)}for(let o=0,a=this.m_indices.length;o<a;o++)if(o!==this.m_selectionIndex&&this.m_indices[o]!==null){let h=this.getUserIndex(t,o);h!==-1&&this.setUserIndex(e,o,h)}let i=this.selected(t);i!==this.selected(e)&&(i?this.select(e):this.unselect(e))}splitSegmentAxisAware(t,e,s,n,i){let o=0,a=this.getNextVertex(t);a===v&&U("");let h=this.getVertexIndex(t),m=this.getVertexIndex(a),l=this.getSegmentFromIndex(h),u=this.m_vertices.getShortestDistance(h,m),c=this.getPathFromVertex(t),g=this.m_bHasAttributes;g&&l&&(u=l.calculateLength2D());let d=this.getSegmentParentage(t),_=this.getHelperPoint();if(l){let p=0,f=0,x=v;for(let C=0;C<s;C++){let P=e[C];if(p<P&&P<1){let E=l.cut(p,P);if(n!==null&&(C>0&&E.setStartXY(n[C-1]),E.setEndXY(n[C]),E.normalizeAfterEndpointChange(),f=C),g){let D=u>0?l.calculateSubLengthFromStart(P)/u:0;this.m_vertices.interpolateTwoVertices(h,m,D,_)}_.setXY(E.getEndXY()),x=this.insertVertex(c,a,_),o++;let S=this.getPrevVertex(x),I=this.getVertexIndex(S);this.setSegmentToIndex(I,E),d!==-1&&this.setSegmentParentageAndBreak(x,d,!1),p=P}}if(x!==v){let C=l.cut(p,1);n!==null&&(C.setStartXY(n[f]),C.normalizeAfterEndpointChange());let P=this.getVertexIndex(x);this.setSegmentToIndex(P,C)}}else{let p=0;for(let f=0;f<s;f++){let x=e[f];if(p<x&&x<1){this.m_vertices.interpolateTwoVertices(h,m,x,_);let C=this.insertVertex(c,a,_);o++,d!==-1&&this.setSegmentParentageAndBreak(C,d,!1)}p=x}}return o}splitSegment(t,e,s,n=null){return this.splitSegmentAxisAware(t,e,s,n,-1)}snapControlPoints(t,e,s){this.getNextVertex(t)===v&&U("");let n=t,i=!1;for(let o=0;o<e;++o){let a=this.getVertexIndex(n),h=this.getSegmentFromIndex(a);if(h){let m=h.snapControlPoints(s);i||=m}n=this.getNextVertex(n)}return i}snapControlPointsOnSelection(t){if(!this.hasCurves())return!1;let e=0,s=this.queryVertexIteratorOnSelection();for(let n=s.next();n!==v;n=s.next()){let i=this.getVertexIndex(n),o=this.getSegmentFromIndex(i);o&&(e|=o.snapControlPoints(t)?1:0)}return e!==0}calculateSubLength2D(t,e,s){return w(0),0}setPoint(t,e,s){if(this.setPointOnly(t,e),this.m_segments!==null){let n=this.getVertexIndex(t),i=this.getSegmentFromIndex(n);i!==null&&(i.setStartXY(e.getXY()),i.normalizeAfterEndpointChange(),s&&i.ensureXYMonotone());let o=this.getPrevVertex(t);if(o!==v){let a=this.getVertexIndex(o),h=this.getSegmentFromIndex(a);h!==null&&(h.setEndXY(e.getXY()),h.normalizeAfterEndpointChange(),s&&h.ensureXYMonotone())}}}setPointEx(t,e,s,n,i){this.setPoint(t,e,i);let o=this.getVertexIndex(t);this.setWeightWithIndex(o,n),this.setRankWithIndex(o,s)}setPointOnly(t,e){let s=this.getVertexIndex(t);this.m_vertices.setPointByVal(s,e)}setPointOnlyEx(t,e,s,n){w(0)}queryPoint(t,e){let s=this.getVertexIndex(t);this.m_vertices.getPointByVal(s,e)}setXY(t,e){this.setXYCoords(t,e.x,e.y)}setXYCoords(t,e,s){let n=this.getVertexIndex(t);if(this.m_vertices?.setXYCoords(n,e,s),this.m_segments!==null){let i=this.getSegmentFromIndex(n);i!==null&&(i.setStartXYCoords(e,s),i.normalizeAfterEndpointChange());let o=this.getPrevVertex(t);if(o!==v){let a=this.getVertexIndex(o),h=this.getSegmentFromIndex(a);h!=null&&(h.setEndXYCoords(e,s),h.normalizeAfterEndpointChange())}}}setXYMonotonic(t,e,s){let n=this.getVertexIndex(t);if(this.m_vertices.setXYCoords(n,e,s),this.m_segments!==null){let i=this.getSegmentFromIndex(n);if(i!==null){let a=i.getEndXY();i.setCoordsForIntersector(new y(e,s),a,!1),i.ensureXYMonotone()}let o=this.getPrevVertex(t);if(o!==v){let a=this.getVertexIndex(o),h=this.getSegmentFromIndex(a);if(h!==null){let m=h.getStartXY();h.setCoordsForIntersector(m,new y(e,s),!1),h.ensureXYMonotone()}}}}setXYMonotonicPoint2D(t,e){this.setXYMonotonic(t,e.x,e.y)}queryXY(t,e){let s=this.getVertexIndex(t);return this.m_vertices.queryXY(s,e)}getXY(t){let e=this.getVertexIndex(t);return this.m_vertices.getXY(e)}getXYWithIndex(t){return this.m_xyStream.readPoint2D(2*t)}static setSegDefault(t,e,s){w(0)}setXYZ(t,e,s){w(0)}setXYZCoords(t,e,s,n){w(0)}queryXYZ(t,e){w(0)}getXYZ(t){return w(0),ot.getNAN()}getXYZWithIndex(t){return w(0),ot.getNAN()}mergeVertexDescription(t){this.m_verticesMp.mergeVertexDescription(t),this.m_vertexDescription=this.m_verticesMp.getDescription(),this.m_bHasAttributes=this.m_vertexDescription.getAttributeCount()>1}addAttribute(t){w(0)}getAttributeAsDbl(t,e,s){return this.m_vertices.getAttributeAsDbl(t,this.getVertexIndex(e),s)}queryAttributeAsDbl(t,e,s,n){w(0)}setAttribute(t,e,s,n){w(0)}setAttributeInt(t,e,s,n){w(0)}getVertexDescription(){return this.m_vertexDescription}getMinPathVertexY(t){return w(0),0}getVertexIndex(t){return this.m_vertexIndexList.getField(t,0)}getY(t){let e=this.getVertexIndex(t);return this.m_vertices.queryXY(e,this.m_workPoint2D),this.m_workPoint2D.y}getX(t){return this.getXY(t).x}isEqualXY(t,e){return this.queryXY(t,this.m_workPoint2D),this.queryXY(e,this.m_workPoint2_2D),this.m_workPoint2D.isEqualPoint2D(this.m_workPoint2_2D)}isEqualXYPoint2D(t,e){return this.queryXY(t,this.m_workPoint2D),this.m_workPoint2D.isEqualPoint2D(e)}isEqualXYZPoint3D(t,e){return w(0),!1}setWeight(t,e){e<1&&(e=1);let s=e===1;if(this.m_weights==null){if(s)return;this.m_weights=mn(this.m_vertices.getPointCount(),1)}let n=this.getVertexIndex(t);if(n>=this.m_weights.size()){if(s)return;this.m_weights.resize(n+1,1)}this.m_weights.write(n,e)}setWeightWithIndex(t,e){e<1&&(e=1);let s=e===1;if(this.m_weights===null){if(s)return;this.m_weights=mn(this.m_vertices.getPointCount(),1)}if(t>=this.m_weights.size()){if(s)return;this.m_weights.resize(t+1,1)}this.m_weights.write(t,e)}getWeight(t){if(this.m_weights===null)return 1;let e=this.getVertexIndex(t);return e>=this.m_weights.size()?1:this.m_weights.read(e)}getWeightWithIndex(t){return this.m_weights===null||t>=this.m_weights.size()?1:this.m_weights.read(t)}getRank(t){if(this.m_ranks===null)return Yt;let e=this.getVertexIndex(t);return e>=this.m_ranks.size()?Yt:this.m_ranks.read(e)}getRankWithIndex(t){return this.m_ranks===null||t>=this.m_ranks.size()?Yt:this.m_ranks.read(t)}setRank(t,e){e<Yt&&(e=Yt);let s=e===Yt;if(this.m_ranks===null){if(s)return;this.m_ranks=Ce(this.m_vertices.getPointCount(),Yt)}let n=this.getVertexIndex(t);if(n>=this.m_ranks.size()){if(s)return;this.m_ranks.resize(n+1,Yt)}this.m_ranks.write(n,e)}setRankWithIndex(t,e){e<Yt&&(e=Yt);let s=e===Yt;if(this.m_ranks===null){if(s)return;this.m_ranks=Ce(this.m_vertices.getPointCount(),Yt)}if(t>=this.m_ranks.size()){if(s)return;this.m_ranks.resize(t+1,Yt)}this.m_ranks.write(t,e)}setSegmentWeight(t,e){e<1&&(e=1);let s=e===1;if(this.m_segmentWeights===null){if(s)return;this.m_segmentWeights=mn(this.m_vertices.getPointCount(),1)}let n=this.getVertexIndex(t);if(n>=this.m_segmentWeights.size()){if(s)return;this.m_segmentWeights.resize(n+1,1)}this.m_segmentWeights.write(n,e)}setSegmentWeightWithIndex(t,e){e<1&&(e=1);let s=e===1;if(this.m_segmentWeights==null){if(s)return;this.m_segmentWeights=mn(this.m_vertices.getPointCount(),1)}if(t>=this.m_segmentWeights.size()){if(s)return;this.m_segmentWeights.resize(t+1,1)}this.m_segmentWeights.write(t,e)}getSegmentWeight(t){if(this.m_segmentWeights===null)return 1;let e=this.getVertexIndex(t);return e>=this.m_segmentWeights.size()?1:this.m_segmentWeights.read(e)}getSegmentWeightWithIndex(t){return this.m_segmentWeights==null||t>=this.m_segmentWeights.size()?1:this.m_segmentWeights.read(t)}getSegmentRank(t){if(this.m_segmentRanks===null)return r.st_defaultRank;let e=this.getVertexIndex(t);return e>=this.m_segmentRanks.size()?r.st_defaultRank:this.m_segmentRanks.read(e)}getSegmentRankWithIndex(t){return this.m_segmentRanks===null||t>=this.m_segmentRanks.size()?Yt:this.m_segmentRanks.read(t)}setSegmentRank(t,e){e<Yt&&(e=Yt);let s=e===Yt;if(this.m_segmentRanks===null){if(s)return;this.m_segmentRanks=Ce(this.m_vertices.getPointCount(),Yt)}let n=this.getVertexIndex(t);if(n>=this.m_segmentRanks.size()){if(s)return;this.m_segmentRanks.resize(n+1,Yt)}this.m_segmentRanks.write(n,e)}setSegmentRankWithIndex(t,e){e<Yt&&(e=Yt);let s=e===Yt;if(this.m_segmentRanks===null){if(s)return;this.m_segmentRanks=Ce(this.m_vertices.getPointCount(),Yt)}if(t>=this.m_segmentRanks.size()){if(s)return;this.m_segmentRanks.resize(t+1,Yt)}this.m_segmentRanks.write(t,e)}removeWeights(){this.m_weights=null,this.m_segmentWeights=null}removeRanks(){this.m_ranks=null,this.m_segmentRanks=null}setUserIndex(t,e,s){let n=this.m_indices[e],i=this.getVertexIndex(t);if(n.size()<=i){if(s===-1)return;n.resize(this.m_vertices.getPointCount(),-1)}n.write(i,s)}getUserIndex(t,e){let s=this.getVertexIndex(t),n=this.m_indices[e];return s<n.size()?n.read(s):-1}addToUserIndex(t,e,s){let n=this.m_indices[e],i=this.getVertexIndex(t);n.size()<=i&&n.resize(this.m_vertices.getPointCount(),-1);let o=n.read(i);n.write(i,o+s)}createUserIndex(){for(let e=0;e<this.m_indices.length;e++)if(this.m_indices[e]===null)return this.m_indices[e]=this.allocateIndex(),e;this.m_indices.push(this.allocateIndex());let t=this.m_indices.length-1;return w(t>=0&&t<=Pe()),t}createUserIndexUninitialized(){for(let e=0;e<this.m_indices.length;e++)if(this.m_indices[e]===null)return this.m_indices[e]=this.allocateIndex(!1),e;this.m_indices.push(this.allocateIndex(!1));let t=this.m_indices.length-1;return w(t>=0&&t<=Number.MAX_SAFE_INTEGER),t}fillUserIndexForGeometry(t,e,s){let n=this.m_indices[e],i=n.size();for(let o=this.getFirstPath(t);o!==v;o=this.getNextPath(o)){let a=this.getFirstVertex(o);for(let h=0,m=this.getPathSize(o);h<m;h++,a=this.getNextVertex(a)){let l=this.getVertexIndex(a);l<i&&n.write(l,s)}}}fillUserIndexForSelection(t,e){w(0)}removeUserIndex(t){for(this.recycleUserIndex(this.m_indices[t]),this.m_indices[t]=null;this.m_indices.length>0&&this.m_indices[this.m_indices.length-1]===null;)this.m_indices.pop()}replaceCurveWithLine(t){if(this.m_segments!==null){let e=this.getVertexIndex(t);this.setSegmentToIndex(e,null)}}queryLineConnector(t,e,s=!1){let n=this.getNextVertex(t);if(n===v)return!1;if(!this.m_bHasAttributes||s){let i=this.getXY(t);e.setStartXY(i);let o=this.getXY(n);e.setEndXY(o)}else{let i=new st({vd:this.getVertexDescription()});this.queryPoint(t,i),e.setStart(i),this.queryPoint(n,i),e.setEnd(i)}return!0}queryLineConnector3D(t,e,s=!1){return w(0),!1}hasCurves(){return this.m_segments!==null}geometryHasCurves(t){return w(0),!1}pathHasCurves(t){if(!this.hasCurves())return!1;let e=this.getFirstVertex(t);if(e===v)return!1;let s=this.getPathSize(t),n=e;for(let i=0;i<s;i++,n=this.getNextVertex(n)){let o=this.getSegment(n);if(o!==null&&o.getGeometryType()!==N.enumLine)return!0}return!1}insertPath(t,e){let s=v;e!==v?(t!==this.getGeometryFromPath(e)&&U(""),s=this.getPrevPath(e)):s=this.getLastPath(t);let n=this.newPath(t);return e!==v&&this.setPrevPath(e,n),this.setNextPath(n,e),this.setPrevPath(n,s),s!==v?this.setNextPath(s,n):this.setFirstPath(t,n),e===v&&this.setLastPath(t,n),this.setGeometryPathCount(t,this.getPathCount(t)+1),n}removePath(t){let e=this.getPrevPath(t),s=this.getNextPath(t),n=this.getGeometryFromPath(t);return e!==v?this.setNextPath(e,s):this.setFirstPath(n,s),s!==v?this.setPrevPath(s,e):this.setLastPath(n,e),this.clearPath(t),this.setGeometryPathCount(n,this.getPathCount(n)-1),this.freePath(t),s}clearPath(t){let e=this.getFirstVertex(t);if(e!==v){let s=e;for(let i=0,o=this.getPathSize(t);i<o;i++){let a=s;s=this.getNextVertex(s),this.freeVertex(a)}let n=this.getGeometryFromPath(t);this.setGeometryVertexCount(n,this.getPointCount(n)-this.getPathSize(t))}this.setPathSize(t,0)}getNextPath(t){return this.m_pathIndexList.getField(t,2)}getPrevPath(t){return this.m_pathIndexList.getField(t,1)}getPathSize(t){return this.m_pathIndexList.getField(t,3)}isClosedPath(t){return!!(1&this.getPathFlags(t))}setClosedPath(t,e){if(this.isClosedPath(t)===e)return;if(this.getPathSize(t)>0){let n=this.getFirstVertex(t),i=this.getLastVertex(t);if(e){this.setNextVertex(i,n),this.setPrevVertex(n,i);let o=this.getVertexIndex(i);this.setSegmentToIndex(o,null)}else{this.setNextVertex(i,v),this.setPrevVertex(n,v);let o=this.getVertexIndex(i);this.setSegmentToIndex(o,null)}}let s=(1|this.getPathFlags(t))-1;this.setPathFlags(t,s|(e?1:0))}closeAllPaths(t){w(0)}isStrongPathStart(t){return!!(8&this.getPathFlags(t))}isStrongPathEnd(t){return!!(16&this.getPathFlags(t))}setStrongPathStart(t,e){let s=(8|this.getPathFlags(t))-8;this.setPathFlags(t,s|(e?8:0))}setStrongPathEnd(t,e){let s=(16|this.getPathFlags(t))-16;this.setPathFlags(t,s|(e?16:0))}getGeometryFromPath(t){return this.m_pathIndexList.getField(t,7)}isExterior(t){return!!(2&this.getPathFlags(t))}setExterior(t,e){let s=(2|this.getPathFlags(t))-2;this.setPathFlags(t,s|(e?2:0))}getRingArea(t){if(this.isRingAreaValid(t))return this.m_pathAreas[this.getPathIndex(t)];let e=this.getFirstVertex(t);if(e===v)return 0;let s=this.getXY(e),n=new oe(0),i=this.getPathSize(t);if(i>2){let a=s.clone(),h=a.x,m=a.y,l=this.getNextVertex(e),u=this.getXY(l);l=this.getNextVertex(l);let c=y.getNAN();for(let g=2;g<i;g++,l=this.getNextVertex(l))this.queryXY(l,c),n.pe((c.x-a.x)*(u.y-m)),a.setCoordsPoint2D(u),u.setCoordsPoint2D(c);n.pe((h-a.x)*(u.y-m))}if(this.hasCurves()){let a=e;for(let h=0;h<i;h++,a=this.getNextVertex(a)){let m=this.getSegment(a);if(m===null||m.getGeometryType()===N.enumLine)continue;let l=2*m.calculateArea2DHelper();n.pe(l)}}this.setRingAreaValid(t,!0);let o=.5*n.getResult();return this.m_pathAreas[this.getPathIndex(t)]=o,o}getPathIndexInternal(t){return this.getPathIndex(t)}getPathInternalIndexFromVertex(t){return this.getPathIndex(this.getPathFromVertex(t))}setPathUserIndex(t,e,s){let n=this.m_pathindices[e],i=this.getPathIndex(t);n.size()<this.m_pathAreas.length&&n.resize(this.m_pathAreas.length,-1),n.write(i,s)}getPathUserIndex(t,e){let s=this.getPathIndex(t),n=this.m_pathindices[e];return s<n.size()?n.read(s):-1}createPathUserIndex(){for(let e=0;e<this.m_pathindices.length;e++)if(this.m_pathindices[e]===null)return this.m_pathindices[e]=this.allocatePathIndex(),e;this.m_pathindices.push(this.allocatePathIndex());let t=this.m_pathindices.length-1;return w(t>=0&&t<=Number.MAX_SAFE_INTEGER),t}fillPathUserIndexForGeometry(t,e,s){let n=this.m_pathindices[e],i=n.size();for(let o=this.getFirstPath(t);o!==v;o=this.getNextPath(o)){let a=this.getPathIndex(o);a<i&&n.write(a,s)}}removePathUserIndex(t){for(this.recyclePathUserIndex(this.m_pathindices[t]),this.m_pathindices[t]=null;this.m_pathindices.length>0&&this.m_pathindices.at(-1)===null;)this.m_pathindices.pop()}movePath(t,e,s){if(s===v&&U(""),e===s)return;let n=this.getNextPath(s),i=this.getPrevPath(s),o=this.getGeometryFromPath(s);i===v?this.setFirstPath(o,n):this.setNextPath(i,n),n===v?this.setLastPath(o,i):this.setPrevPath(n,i),this.setGeometryVertexCount(o,this.getPointCount(o)-this.getPathSize(s)),this.setGeometryPathCount(o,this.getPathCount(o)-1),i=e===v?this.getLastPath(t):this.getPrevPath(e),this.setPrevPath(s,i),this.setNextPath(s,e),e===v?this.setLastPath(t,s):this.setPrevPath(e,s),i===v?this.setFirstPath(t,s):this.setNextPath(i,s),this.setGeometryVertexCount(t,this.getPointCount(t)+this.getPathSize(s)),this.setGeometryPathCount(t,this.getPathCount(t)+1),this.setPathGeometry(s,t)}addVertex(t,e){return this.m_vertices.getPointByVal(this.getVertexIndex(e),this.getHelperPoint()),this.insertVertex_(t,v,this.getHelperPoint(),!1)}insertVertex(t,e,s){return this.insertVertex_(t,e,s,!0)}removeVertex(t,e){let s=this.getPathFromVertex(t),n=this.getPrevVertex(t),i=this.getNextVertex(t);n!==v&&this.setNextVertex(n,i);let o=this.getPathSize(s);if(t===this.getFirstVertex(s)&&this.setFirstVertex(s,o>1?i:v),i!==v&&this.setPrevVertex(i,n),t===this.getLastVertex(s)&&this.setLastVertex(s,o>1?n:v),this.hasCurves()&&n!==v&&i!==v){let h=this.getVertexIndex(t),m=this.getVertexIndex(n),l=this.getVertexIndex(i);if(e){let u=this.getSegmentFromIndex(m);if(u!==null){let c=this.m_vertices.getXY(l);u.setEndXY(c),u.normalizeAfterEndpointChange()}this.setSegmentToIndex(h,null)}else{let u=this.getSegmentFromIndex(h);if(this.setSegmentToIndex(h,null),u!==null){let c=this.m_vertices.getXY(m);u.setStartXY(c),u.normalizeAfterEndpointChange()}this.setSegmentToIndex(m,u)}}this.setPathSize(s,o-1);let a=this.getGeometryFromPath(s);return this.setGeometryVertexCount(a,this.getPointCount(a)-1),this.freeVertex(t),i}removeVertices(t,e){w(t!==e);let s=this.getPathFromVertex(t),n=this.getPrevVertex(t),i=this.getPrevVertex(e);n!==v&&this.setNextVertex(n,e);let o=this.getPathSize(s),a=this.getVertexIndex(t);this.setSegmentToIndex(a,null),this.setPrevVertex(e,n),this.setPrevVertex(t,v),this.setNextVertex(i,v);let h=0,m=t,l=this.getFirstVertex(s),u=!1;for(;;){let g=this.getNextVertex(m);if(u||=l===m,this.freeVertex(m),h++,m===i)break;m=g}o-=h,u&&this.setFirstVertex(s,o>0?e:v),this.setPathSize(s,o);let c=this.getGeometryFromPath(s);this.setGeometryVertexCount(c,this.getPointCount(c)-h)}getFirstVertex(t){return this.m_pathIndexList.getField(t,4)}getLastVertex(t){return this.m_pathIndexList.getField(t,5)}getNextVertex(t){return this.m_vertexIndexList.getField(t,2)}getPrevVertex(t){return this.m_vertexIndexList.getField(t,1)}getNextVertexEx(t,e){return e>0?this.m_vertexIndexList.getField(t,2):this.m_vertexIndexList.getField(t,1)}getPrevVertexEx(t,e){return e>0?this.m_vertexIndexList.getField(t,1):this.m_vertexIndexList.getField(t,2)}getPathFromVertex(t){return this.m_vertexIndexList.getField(t,3)}addPoint(t,e){return this.insertVertex_(t,v,e,!1)}getGeometryFromVertex(t){return this.getGeometryFromPath(this.getPathFromVertex(t))}replaceNaNs(t,e){this.m_vertexDescription.hasAttribute(t)||j(""),this.m_vertices.replaceNaNs(t,e)}removeNaNVertices(){for(let t=this.getFirstGeometry();t!==v;t=this.getNextGeometry(t))for(let e=this.getFirstPath(t);e!==v;e=this.getNextPath(e)){let s=this.getFirstVertex(e);for(let n=0,i=this.getPathSize(e);n<i;n++)s=this.getXY(s).isFinite()?this.getNextVertex(s):this.removeVertex(s,!0)}}queryVertexIterator(t=v){return this.queryVertexIteratorEx(!1,t)}queryVertexIteratorEx(t,e=v){let s=v,n=v,i=v,o=v,a=0,h=!1;for(s=e!==v?e:this.getFirstGeometry();s!==v;s=this.getNextGeometry(s))if(!t||at(this.getGeometryType(s))){for(n=this.getFirstPath(s);n!==v;n=this.getNextPath(n))if(i=this.getFirstVertex(n),o=i,a=0,i!==v){h=!0;break}if(h||e!==v)break}return h||(s=v),di.create_(this,s,n,i,o,a,t,!1,e!==v)}queryVertexIteratorOnSelection(t=v){return this.m_selection?di.create_(this,t,v,v,v,-1,!1,!0,t!==v):this.queryVertexIteratorEx(!1,t)}hasSelection(){return this.m_selection}createEmptySelection(){w(0)}removeSelection(){this.m_selection&&(this.m_selectedVertices.length=0,this.removeUserIndex(this.m_selectionIndex),this.m_selectionIndex=-1,this.m_selection=!1,this.m_selectedCount=0)}select(t){return!!this.selected(t)||(this.setUserIndex(t,this.m_selectionIndex,this.m_selectedVertices.length),this.m_selectedVertices.push(t),this.m_selectedCount++,!1)}unselect(t){if(!this.m_selection)return;let e=this.getUserIndex(t,this.m_selectionIndex);e>=0&&(this.m_selectedVertices[e]=v,this.setUserIndex(t,this.m_selectionIndex,-1),this.m_selectedCount--)}selected(t){return!this.m_selection||this.selected_(t)}getSelectedCount(){return this.m_selection?this.m_selectedCount:this.getTotalPointCount()}createSelectionForCrackingAndClustering(t,e){return w(0),!1}peelALoop(t,e){this.peelALoop_(t,e,!1)}peelALoopIntoAPath(t,e){return this.peelALoop_(t,e,!0)}applyTransformation(t){if(this.m_verticesMp.applyTransformation(t),this.m_segments!==null)for(let e=0,s=this.m_segments.length;e<s;e++)this.m_segments[e]&&this.m_segments[e].applyTransformation(t)}setGeometryType(t,e){this.m_geometryIndexList.setField(t,2,e)}splitSegmentWithIntersector(t,e,s,n,i){n?this.splitSegmentForward(t,e,s,!0,i):this.splitSegmentBackward(t,e,s,!0,i)}setPrevVertex(t,e){this.m_vertexIndexList.setField(t,1,e)}setNextVertex(t,e){this.m_vertexIndexList.setField(t,2,e)}setPathToVertex(t,e){this.m_vertexIndexList.setField(t,3,e)}setPathSize(t,e){this.m_pathIndexList.setField(t,3,e)}setFirstVertex(t,e){this.m_pathIndexList.setField(t,4,e)}setLastVertex(t,e){this.m_pathIndexList.setField(t,5,e)}getSegment(t){if(this.m_segments!=null){let e=this.getVertexIndex(t);return this.getSegmentFromIndex(e)}return null}isCurve(t){return w(0),!1}querySegment(t,e,s=!0,n=!1){let i=this.getNextVertex(t);if(i===v)return!1;let o=this.getSegment(t);if(!o)return!s&&(this.queryLineConnector(t,e.createLine(),n),!0);if(e.copyFrom(o,!0),n)return!0;if(this.m_vertexDescription.getAttributeCount()>1){let a=this.getHelperPoint();this.queryPoint(t,a),e.get().setStart(a),this.queryPoint(i,a),e.get().setEnd(a)}return!0}getSegmentFromIndex(t){return(this.m_segments!==null&&this.m_segments.length>t?this.m_segments[t]:null)||null}getAndClearSegmentFromIndex(t){return(this.m_segments!==null&&this.m_segments.length>t?this.m_segments[t]:null)||null}setSegmentToIndex(t,e){if(this.m_hasForceSetEnvelope=0,this.m_segments===null){if(!e)return;this.m_segments=[],this.m_segments.length=this.m_vertices.getPointCount()}t>=this.m_segments.length&&(this.m_segments.length=t+1),this.m_segments[t]=e}setGeometryPathCount(t,e){this.m_geometryIndexList.setField(t,6,e)}setGeometryVertexCount(t,e){this.m_geometryIndexList.setField(t,5,e)}ringParentageCheckInternal(t,e){return w(0),!1}reverseRingInternal(t){let e=this.hasCurves(),s=this.hasSegmentParentage(),n=null,i=-1,o=t;if(e){let a=this.getVertexIndex(o);n=this.getAndClearSegmentFromIndex(a)}s&&(i=this.getSegmentParentage(o));do{let a=this.getPrevVertex(o),h=this.getNextVertex(o);if(this.setNextVertex(o,a),this.setPrevVertex(o,h),e){let m=this.getVertexIndex(h),l=this.getSegmentFromIndex(m);n&&n.reverse(),this.setSegmentToIndex(m,n),n=l}if(s){let m=this.getSegmentParentage(h);this.setSegmentParentagePreserveBreak(h,i),i=m}o=h}while(o!==t);this.dbgVerifyIntegrity(t)}setTotalPointCount(t){this.m_pointCount=t}removePathOnly(t){let e=this.getPrevPath(t),s=this.getNextPath(t),n=this.getGeometryFromPath(t);e!==v?this.setNextPath(e,s):this.setFirstPath(n,s),s!==v?this.setPrevPath(s,e):this.setLastPath(n,e),this.setFirstVertex(t,v),this.setLastVertex(t,v),this.freePath(t)}insertClosedPath(t,e,s,n,i){let o=this.insertPath(t,v),a=0,h=s;for(i[0]=!1;;){h===n&&(i[0]=!0),this.setPathToVertex(h,o),a++;let m=this.getNextVertex(h);if(m===s)break;h=m}return this.setClosedPath(o,!0),this.setPathSize(o,a),i[0]&&(s=n),this.setFirstVertex(o,s),this.setLastVertex(o,this.getPrevVertex(s)),this.setRingAreaValid(o,!1),o}findVertex2D(t,e){return w(0),0}findVertex3D(t,e,s){return w(0),0}dbgVerifyMonotone(){}dbgCheckSelection(){}dbgVerifySegment(t){}dbgVerifyIntegrity(t,e=!0){}dbgVerifyVertexCounts(){}dbgVerifyCurves(){}dbgDumpGeometry(t,e){}removeVertexInternal(t,e){let s=this.getPrevVertex(t),n=this.getNextVertex(t);if(s!==v&&this.setNextVertex(s,n),n!==v&&this.setPrevVertex(n,s),this.hasCurves()&&s!==v&&n!==v){let i=this.getVertexIndex(t),o=this.getVertexIndex(s),a=this.getVertexIndex(n);if(e){let h=this.getSegmentFromIndex(o);if(h!==null){let m=this.m_vertices.getXY(a);h.setEndXY(m),h.normalizeAfterEndpointChange()}this.setSegmentToIndex(i,null)}else{let h=this.getSegmentFromIndex(i);if(this.setSegmentToIndex(i,null),h!==null){let m=this.m_vertices.getXY(o);h.setStartXY(m),h.normalizeAfterEndpointChange()}this.setSegmentToIndex(o,h)}}return this.freeVertex(t),n}isRingAreaValid(t){return!!(4&this.getPathFlags(t))}setRingAreaValid(t,e){let s=(4|this.getPathFlags(t))-4;this.setPathFlags(t,s|(e?4:0))}compareVerticesSimpleY(t,e){return this.queryXY(t,this.m_workPoint2D),this.queryXY(e,this.m_workPoint2_2D),this.m_workPoint2D.compare(this.m_workPoint2_2D)}compareVerticesSimpleY3D(t,e){return this.getXYZ(t).compare(this.getXYZ(e))}compareVerticesSimpleX(t,e){return this.getXY(t).compareX(this.getXY(e))}sortVerticesSimpleByYHeapMerge(t,e){w(0)}sortVerticesSimpleByY(t,e,s){this.m_bucketSort.sort(t,e,s,new rm(this))}sortVerticesSimpleByX(t,e,s){w(0)}sortVerticesSimpleByY3D(t,e,s){w(0)}snapVertexForPoleClipping(t,e){let s=this.getPrevVertex(t);s!==v&&this.replaceCurveWithLine(s),this.getNextVertex(t)!==v&&this.replaceCurveWithLine(t);let n=new y;this.queryXY(t,n),n.y=e,this.setXY(t,n)}setSegmentParentageAndBreak(t,e,s=!0){if(this.m_segmentParentageIndex===-1){if(e===-1)return;this.m_segmentParentageIndex=this.createUserIndex()}e>=0&&(w(e<=We()>>1),e<<=1,e|=s?1:0),this.setUserIndex(t,this.m_segmentParentageIndex,e)}setSegmentParentagePreserveBreak(t,e){if(w(e>=-1),this.m_segmentParentageIndex===-1){if(e===-1)return;this.m_segmentParentageIndex=this.createUserIndex()}e>=0&&(w(e<=We()>>1),e<<=1,e|=this.getSegmentParentageBreakVertex(t)?1:0),this.setUserIndex(t,this.m_segmentParentageIndex,e)}getSegmentParentage(t){if(this.m_segmentParentageIndex===-1)return-1;let e=this.getUserIndex(t,this.m_segmentParentageIndex);return e<0?e:e>>1}getOriginalSegmentInfo(t){if(this.m_segmentParentageIndex!==-1){let e=this.getSegmentParentage(t);return new _i(e)}return new _i(-1)}setSegmentParentageBreakVertex(t,e){if(this.m_segmentParentageIndex===-1)return;let s=this.getUserIndex(t,this.m_segmentParentageIndex);s<0||!!(1&s)!==e&&(e?s|=1:s&=We()>>1<<1,this.setUserIndex(t,this.m_segmentParentageIndex,s))}getSegmentParentageBreakVertex(t){if(this.m_segmentParentageIndex===-1)return!0;let e=this.getUserIndex(t,this.m_segmentParentageIndex);return e<0||!!(1&e)}isDiscontinuousSegmentParentage(t){let e=this.getPrevVertex(t);return e===v?!1:this.getSegmentParentage(e)!==this.getSegmentParentage(t)}setCurveStitcherPointer(t){this.m_curveStitcher=t}hasSegmentParentage(){return this.m_segmentParentageIndex!==-1}deleteSegmentParentage(){this.m_segmentParentageIndex!==-1&&(this.removeUserIndex(this.m_segmentParentageIndex),this.m_segmentParentageIndex=-1),this.m_curveStitcher=null}clearSegments(){this.m_segments=null}};function PE(r){if(r.isEmpty())return new lt({vd:r.getDescription()});let t=r.getImpl(),e=t.getPointCount();if(e<=2){if(e===1||t.getXY(0).equals(t.getXY(1))){let g=new st({vd:t.getDescription()});return t.getPointByVal(0,g),g}{let g=new st,d=new dt({vd:t.getDescription()});return t.getPointByVal(0,g),d.startPathPoint(g),t.getPointByVal(1,g),d.lineToPoint(g),d}}let s=t.getAttributeStreamRef(0),n=new Go({stream:s,n:e}),i=0,o=1,a=s.readPoint2D(i<<1),h=new y;for(;o<e&&s.queryPoint2D(o<<1,h).equals(a);)o++;if(n.m_treeHull.addElement(i),o<e){n.m_treeHull.addBiggestElement(o);let g=new y;for(let d=o+1;d<t.getPointCount();d++){s.queryPoint2D(d<<1,g);let _=n.treeHull(g);_!==-1&&n.m_treeHull.setElement(_,d)}}let m=t.getDescription(),l=m.getAttributeCount()>1,u=n.m_treeHull.size(),c=null;if(u>=2){c=u>=3?new lt({vd:m}):new dt({vd:m});let g=c.getImpl();g.reserve(n.m_treeHull.size()),g.addPathPoint2D(null,0,!0);let d=new y;for(let _=n.m_treeHull.getFirst();_!==-1;_=n.m_treeHull.getNext(_))if(l){let p=new st;t.getPointByVal(n.m_treeHull.getElement(_),p),g.insertPoint(0,-1,p)}else s.queryPoint2D(n.m_treeHull.getElement(_)<<1,d),g.insertPoint2D(0,-1,d)}else if(l){let g=new st({vd:m});t.getPointByVal(n.m_treeHull.getElement(n.m_treeHull.getFirst()),g),c=g}else{let g=s.readPoint2D(n.m_treeHull.getElement(n.m_treeHull.getFirst())<<1);c=new st(g)}return c}function zc(r,t,e){if(t<=262144)return zf(r,t,e);w(0);let s=new Go({points:r,n:t}),n=0,i=1,o=r[n].clone();for(;i<t&&r[i].equals(o);)i++;if(s.m_treeHull.addElement(n),i<t){s.m_treeHull.addBiggestElement(i);for(let h=i+1;h<t;h++){let m=r[h],l=s.treeHull(m);l!==-1&&s.m_treeHull.setElement(l,h)}}let a=0;for(let h=s.m_treeHull.getFirst();h!==-1;h=s.m_treeHull.getNext(h))e[a++]=s.m_treeHull.getElement(h);return a}function CE(r,t,e){let s=r.getImpl(),n=s.getPathStart(t),i=s.getPathEnd(t),o=!s.isClosedPath(t)&&s.isClosedPathInXYPlane(t),a=s.getAttributeStreamRef(0),h=2*n,m=2*i;if(o&&(m-=2),m-h<6)return!0;let l=a.readPoint2D(h),u=a.readPoint2D(h+2),c=a.readPoint2D(h+4);if(!_n(y.orientationRobust(u,c,l)))return!1;let g=u.clone(),d=new y;for(let _=h+6;_<m;_+=2)if(d.assign(u),u.assign(c),a.queryPoint2D(_,c),!_n(y.orientationRobust(u,c,l))||!_n(y.orientationRobust(g,c,l))||!_n(y.orientationRobust(u,c,d)))return!1;return!0}function EE(r,t,e,s,n){if(e.setNAN(),s.setCoords(1,0),n.setCoords(0,0),r.isEmpty())return;if(r.getGeometryType()===N.enumPoint)return void e.assign(r.getXY());let i=r,o=i.getPointCount();if(o===2){let a=i.getXY(0),h=i.getXY(1);e.assign(a.add(h).mul(.5));let m=h.sub(a);s=Wc(m),n.setCoords(.5*m.length(),0)}else{let a=Number.MAX_VALUE,h=[0,1,0,0],m=new yu(4,2);for(m.set(0,0,0),m.set(0,1,1),m.set(1,0,1),m.set(1,1,2);h[0]<o;++h[0],xh(m,0,o)){h[1]===h[0]&&(++h[1],xh(m,1,o));for(let _=1;;++_){for(;;){let p=Wf(i.getXY(m.get(0,0)),i.getXY(m.get(0,1)),i.getXY(m.get(_,0)),i.getXY(m.get(_,1)),2^_);if(p>0||(++h[_],xh(m,_,o),p===0))break}if(_===3)break;h[_+1]<h[_]&&(h[_+1]=h[_],m.set(_+1,0,m.get(_,0)),m.set(_+1,1,m.get(_,1)))}let l=i.getXY(m.get(0,0)).add(i.getXY(m.get(2,0))).mul(.5),u=Wc(i.getXY(m.get(0,1)).sub(i.getXY(m.get(0,0)))),c=new y,g,d;if(c.x=Math.max(0,u.dotProduct(i.getXY(m.get(1,0)).sub(i.getXY(m.get(3,0))))),c.y=Math.max(0,u.crossProduct(i.getXY(m.get(0,0)).sub(i.getXY(m.get(2,0))))),t?(g=c.x*c.y,d=g<a):(g=c.y,d=g<a),d){a=g;let _=i.getXY(m.get(1,0)),p=i.getXY(m.get(3,0)),f=_.add(p).mul(.5).sub(l);e.assign(l.add(u.mul(u.dotProduct(f)))),s.assign(u),n.assign(c)}}n.mulThis(.5),n.x<n.y&&(n.y=O(n.x,n.x=n.y),s.leftPerpendicularThis())}s.y<0?s.negateThis():s.y===0&&(s.x=1)}Nt.st_defaultRank=1;var om=class{constructor(t){this.m_handleP=-1,this.m_handleQ=-1,this.m_currentSupport=-1,this.m_area=0,this.m_bDone=!0,w(0),this.m_convexHull=t,this.m_function=this.done_}next(){return w(0),!1}get_vertex_handle_p(){return w(0),0}get_vertex_handle_q(){return w(0),0}get_current_support(){return w(0),0}getNext(t){return w(0),0}getPrev(t){return w(0),0}intialize_(){return w(0),!1}increment_(){return w(0),!1}increment_q_(){return w(0),!1}increment_p_(){return w(0),!1}parallel_edge_with_q_support_(){return w(0),!1}parallel_edge_with_p_support_(){return w(0),!1}done_(){return w(0),!1}},Go=class{nullGetXY(t){return j("m_getXY is null"),{}}nullDeleteNode(t){j("m_deleteNode is null")}constructor(t){return this.m_treeHull=new Ot,this.m_shape=null,this.m_stream=null,this.m_points=null,this.m_geometryHandle=-1,this.m_pathHandle=-1,this.m_getXY=this.nullGetXY,this.m_deleteNode=this.nullDeleteNode,t?t.stream?(this.m_treeHull.setCapacity(Math.min(20,t.n)),this.m_stream=t.stream,this.m_getXY=this.getXYStream,this.m_deleteNode=this.deleteNodeStream,this.m_points=null,this.m_geometryHandle=v,void(this.m_pathHandle=v)):t.points?(this.m_treeHull.setCapacity(Math.min(20,t.n)),this.m_points=t.points,this.m_getXY=this.getXYPoints,this.m_deleteNode=this.deleteNodePoints,this.m_stream=null,this.m_geometryHandle=v,void(this.m_pathHandle=v)):void re("unrecognized constructor parameter"):(this.m_treeHull.setCapacity(20),this.m_shape=new Nt,this.m_geometryHandle=this.m_shape.createGeometry(N.enumMultiPoint),this.m_pathHandle=this.m_shape.insertPath(this.m_geometryHandle,v),this.m_getXY=this.getXYShape,this.m_deleteNode=this.deleteNodeShape,this.m_stream=null,void(this.m_points=null))}getXYShape(t){return this.m_shape.getXY(t)}getXYStream(t){return this.m_stream.readPoint2D(t<<1)}getXYPoints(t){return w(0),new y}deleteNodeShape(t){let e=this.m_treeHull.getElement(t);this.m_treeHull.deleteNode(t),this.m_shape.removeVertex(e,!1)}deleteNodeStream(t){this.m_treeHull.deleteNode(t)}deleteNodePoints(t){w(0)}addGeometry(t){if(t.isEmpty())return;let e=t.getGeometryType();if(e===N.enumGeometryCollection){let s=t;for(let n=0,i=s.getGeometryCount();n<i;n++)this.addGeometry(s.getGeometry(n))}else Ie(e)?this.addMultiVertexGeometry(t):Qt(e)?this.addSegment(t):e===N.enumEnvelope?this.addEnvelope(t):e===N.enumPoint?this.addPoint(t):U("Convex_hull: geometry not supported")}getBoundingGeometry(){let t=new st,e=this.m_treeHull.getFirst(),s=new lt({vd:this.m_shape.getVertexDescription()});if(this.m_treeHull.size()===0)return s;s.reserve(this.m_treeHull.size()),this.m_shape.queryPoint(this.m_treeHull.getElement(e),t),s.startPathPoint(t);for(let n=this.m_treeHull.getNext(e);n!==-1;n=this.m_treeHull.getNext(n))this.m_shape.queryPoint(this.m_treeHull.getElement(n),t),s.lineToPoint(t);return s}getAntipodalPairsIterator(){return w(0),new om(this)}getXY(t){return w(0),new y}getXYWithIndex(t){return w(0),new y}getFirst(){return w(0),0}getLast(){return w(0),0}getNext(t){return w(0),0}getPrev(t){return w(0),0}getVertexIndex(t){return w(0),0}getPointCount(){return w(0),0}addMultiVertexGeometry(t){let e=new st,s=t.getImpl(),n=new y;for(let i=0;i<t.getPointCount();i++){s.queryXY(i,n);let o=this.addPoint2D(n);if(o!==-1){t.getPointByVal(i,e);let a=this.m_shape.addPoint(this.m_pathHandle,e);this.m_treeHull.setElement(o,a)}}}addEnvelope(t){let e=new st;for(let s=0;s<4;s++){let n=new y;t.queryCorner(s,n);let i=this.addPoint2D(n);if(i!==-1){t.queryCornerByVal(s,e);let o=this.m_shape.addPoint(this.m_pathHandle,e);this.m_treeHull.setElement(i,o)}}}addSegment(t){let e=new st,s=t.getStartXY(),n=this.addPoint2D(s);if(n!==-1){t.queryStart(e);let a=this.m_shape.addPoint(this.m_pathHandle,e);this.m_treeHull.setElement(n,a)}let i=t.getEndXY(),o=this.addPoint2D(i);if(o!==-1){t.queryEnd(e);let a=this.m_shape.addPoint(this.m_pathHandle,e);this.m_treeHull.setElement(o,a)}}addPoint(t){let e=t.getXY(),s=this.addPoint2D(e);if(s!==-1){let n=this.m_shape.addPoint(this.m_pathHandle,t);this.m_treeHull.setElement(s,n)}}addPoint2D(t){let e=-1;if(this.m_treeHull.size()===0)return e=this.m_treeHull.addElement(-4),e;if(this.m_treeHull.size()===1){let s=this.m_treeHull.getElement(this.m_treeHull.getFirst()),n=this.m_shape.getXY(s);return t.equals(n)||(e=this.m_treeHull.addBiggestElement(-5)),e}return e=this.treeHull(t),e}treeHull(t){let e=-1;do{let s=this.m_treeHull.getFirst(),n=this.m_treeHull.getLast(),i=this.m_treeHull.getElement(s),o=this.m_treeHull.getElement(n),a=this.m_getXY(i),h=this.m_getXY(o),m=y.orientationRobust(h,t,a);if(_n(m)){e=this.m_treeHull.addBiggestElement(-1);let l=this.treeHullWalkBackward(t,n,s);l!==s&&this.treeHullWalkForward(t,s,this.m_treeHull.getPrev(l));break}if(Oc(m)){let l=this.m_treeHull.getRoot(),u=this.m_treeHull.getFirst(),c=this.m_treeHull.getLast(),g=-1,d=-1,_=-1;for(;u!==this.m_treeHull.getPrev(c);){d=this.m_treeHull.getElement(l);let x=this.m_getXY(d);Oc(y.orientationRobust(x,t,a))?(c=l,l=this.m_treeHull.getLeft(l)):(u=l,l=this.m_treeHull.getRight(l))}l=c,g=u,d=this.m_treeHull.getElement(l),_=this.m_treeHull.getElement(g);let p=this.m_getXY(d),f=this.m_getXY(_);if(g!==s&&!_n(y.orientationRobust(f,t,p)))break;e=this.m_treeHull.addElementAtPosition(g,l,-2,!0,!1),this.treeHullWalkForward(t,l,n),this.treeHullWalkBackward(t,g,s);break}{let l=Of(t,h,a);if(l===-1){let u=this.m_treeHull.getPrev(n);this.m_treeHull.deleteNode(n),e=this.m_treeHull.addBiggestElement(-3),this.treeHullWalkBackward(t,u,s)}else if(l===1){let u=this.m_treeHull.getNext(s);this.m_treeHull.deleteNode(s),e=this.m_treeHull.addElementAtPosition(-1,u,-3,!0,!1),this.treeHullWalkForward(t,u,n)}break}}while(!1);return e}treeHullWalkForward(t,e,s){if(e===s)return s;let n=e,i=this.m_treeHull.getElement(n),o=this.m_treeHull.getNext(n),a=this.m_getXY(i);for(;n!==s&&this.m_treeHull.size()>2;){let h=this.m_treeHull.getElement(o),m=this.m_getXY(h);if(_n(y.orientationRobust(m,t,a)))break;let l=n;n=o,i=h,a.assign(m),o=this.m_treeHull.getNext(n),this.m_deleteNode(l)}return n}treeHullWalkBackward(t,e,s){if(e===s)return s;let n=e,i=this.m_treeHull.getElement(n),o=this.m_treeHull.getPrev(n),a=this.m_getXY(i);for(;n!==s&&this.m_treeHull.size()>2;){let h=this.m_treeHull.getElement(o),m=this.m_getXY(h);if(_n(y.orientationRobust(a,t,m)))break;let l=n;n=o,i=h,a.assign(m),o=this.m_treeHull.getPrev(n),this.m_deleteNode(l)}return n}};function Bf(r,t,e){let s=t.sub(r),n=e.sub(t);if(s.x===0)return n.x>0?-1:0;if(s.y===0)return n.y>0?1:n.y<0?-1:0;let i=s.crossProduct(n),o=4*Number.EPSILON*(Math.abs(n.x*s.y)+Math.abs(n.y*s.x));return i>o?1:i<-o?-1:y.orientationRobust(r,t,e)}function Uf(r,t,e){let s=t.sub(r),n=e.sub(t);if(s.x===0)return n.x<0?-1:0;if(s.y===0)return n.y>0?-1:n.y<0?1:0;let i=s.crossProduct(n),o=4*Number.EPSILON*(Math.abs(n.x*s.y)+Math.abs(n.y*s.x));return i>o?1:i<-o?-1:y.orientationRobust(r,t,e)}function zf(r,t,e){let s=new he(0);for(let a=0;a<t;a++)s.add(a);let n={userSort(a,h,m){m.sort(a,h,(l,u)=>r[l].compareX(r[u]))},getValue:a=>r[a].x};ei.sortEx(s,0,t,n);let i=0;t:for(let a=0;a<t;++a){let h=s.read(a);for(;i>=2;){let m=e[i-2],l=e[i-1];if(r[l].equals(r[h])){s.write(a,-1);continue t}if(!(Bf(r[m],r[l],r[h])>=0)){l===s.read(a-1)&&s.write(a-1,-1);break}i--}e[i++]=h,i===2&&r[h].equals(r[e[0]])&&(s.write(1,-1),i--)}let o=i+1;t:for(let a=t-2;a>=0;--a){let h=s.read(a);if(!(h<0)){for(;i>=o;){let m=e[i-2],l=e[i-1];if(r[l].equals(r[h]))continue t;if(!(Uf(r[m],r[l],r[h])>=0))break;i--}if(a!==0){let m=e[i-1];e[i++]=h,r[h].equals(r[m])&&i--}}}return i>1&&r[e[0]].equals(r[e[i-1]])&&i--,i}function _n(r){return r<0}function Oc(r){return r>0}function Of(r,t,e){let s=-1;t.y===e.y?s=0:t.x===e.x?s=1:s=Math.abs(t.x-e.x)>=Math.abs(t.y-e.y)?0:1;let n=-1;return n=t[s]<e[s]?r[s]<t[s]?-1:e[s]<r[s]?1:0:t[s]<r[s]?-1:r[s]<e[s]?1:0,n}function Wc(r){return(r=r.clone()).divThis(Math.max(Math.abs(r.x),Math.abs(r.y))),r.normalize(),r}function xh(r,t,e){r.inc(t,0)===e&&r.set(t,0,0),r.inc(t,1)===e&&r.set(t,1,0)}function Wf(r,t,e,s,n){switch(n){case 0:break;case 1:t.rightPerpendicularThis(),r.rightPerpendicularThis();break;case 2:t.negateThis(),r.negateThis();break;case 3:t.leftPerpendicularThis(),r.leftPerpendicularThis();break;default:U("")}return y.orientationRobustEx(r,t,e,s)}function Hn(r,t,e,s,n){return Nr(r,!1,t,e,s,n)}function Nr(r,t,e,s,n,i){let o=e.getGeometryType(),a=s.getGeometryType(),h=Math.max(n,Fe(e,s));if(o===N.enumLine&&a===N.enumLine)return Eh(e,s,h,i);let m=e,l=s,u=e.getStartXY(),c=e.getEndXY();if(u.compare(c)>0&&(m=e.clone().reverse()),u=s.getStartXY(),c=s.getEndXY(),u.compare(c)>0&&(l=s.clone().reverse()),t){if(e.equals(s))return 2;if(cp(e,s,h))return 4}switch(o){case N.enumLine:switch(a){case N.enumEllipticArc:return Rc(r,l,m,h,i);case N.enumBezier:return Ic(r,l,m,h,i);case N.enumRationalBezier2:return gc(r,l,m,h,i);case N.enumBezier2:return Cc(r,l,m,h,i);default:j("")}break;case N.enumEllipticArc:switch(a){case N.enumLine:return Rc(r,m,l,h,i);case N.enumEllipticArc:return Yf(r,m,l,h,i);case N.enumBezier:return bc(r,l,m,h,i);case N.enumRationalBezier2:return dc(r,l,m,h,i);case N.enumBezier2:return Ec(r,l,m,h,i);default:j("")}break;case N.enumBezier:switch(a){case N.enumLine:return Ic(r,m,l,h,i);case N.enumEllipticArc:return bc(r,m,l,h,i);case N.enumBezier:return J0(r,m,l,h,i);case N.enumRationalBezier2:return wc(r,m,l,h,i);case N.enumBezier2:return Dc(r,m,l,h,i);default:j("")}break;case N.enumRationalBezier2:switch(a){case N.enumLine:return gc(r,m,l,h,i);case N.enumEllipticArc:return dc(r,m,l,h,i);case N.enumBezier:return wc(r,l,m,h,i);case N.enumRationalBezier2:return l0(r,m,l,h,i);case N.enumBezier2:return _c(r,m,l,h,i);default:j("")}break;case N.enumBezier2:switch(a){case N.enumLine:return Cc(r,m,l,h,i);case N.enumEllipticArc:return Ec(r,m,l,h,i);case N.enumBezier:return Dc(r,l,m,h,i);case N.enumRationalBezier2:return _c(r,l,m,h,i);case N.enumBezier2:return v0(r,m,l,h,i);default:j("")}break;default:j("")}}function Ve(r,t,e=!0){if(!e&&!Dm(r,t))return 0;let s=r.isLine()&&t.isLine();if(r.getStartXY().equals(t.getStartXY())&&r.getEndXY().equals(t.getEndXY())){if(s)return 1;let i=r.getGeometryType();if(i!==t.getGeometryType())return 0;if(i===N.enumBezier){let o=r,a=t;return o.getControlPoint1().equals(a.getControlPoint1())&&o.getControlPoint2().equals(a.getControlPoint2())?1:0}if(i===N.enumEllipticArc)return Bc(r,t,!1)?1:0;if(i===N.enumRationalBezier2){let o=r,a=t;if(o.getControlPoint1().equals(a.getControlPoint1())&&o.getStandardFormWeight()===a.getStandardFormWeight())return 1}else if(i===N.enumBezier2){let o=t;if(r.getControlPoint1().equals(o.getControlPoint1()))return 1}return 0}if(r.getStartXY().equals(t.getEndXY())&&r.getEndXY().equals(t.getStartXY())){if(s)return-1;let i=r.getGeometryType();if(i!==t.getGeometryType())return 0;if(i===N.enumBezier){let o=r,a=t;return o.getControlPoint1().equals(a.getControlPoint2())&&o.getControlPoint2().equals(a.getControlPoint1())?-1:0}if(i===N.enumEllipticArc)return Bc(r,t,!0),-1;if(i===N.enumRationalBezier2){let o=r,a=t;if(o.getControlPoint1().equals(a.getControlPoint1())&&o.getStandardFormWeight()===a.getStandardFormWeight())return-1}else if(i===N.enumBezier2){let o=t;if(r.getControlPoint1().equals(o.getControlPoint1()))return-1}return 0}return 0}function Dm(r,t){let e=r.getGeometryType();return e===t.getGeometryType()&&(e!==N.enumEllipticArc||r.projectionBehavior()===t.projectionBehavior())}function Pn(r,t,e,s,n,i,o){!n&&i&&U("");let a=t.getGeometryType(),h=e.getGeometryType(),m=Math.max(o,Fe(t,e));if(s&&(s.length=0),n&&(n.length=0),i&&(i.length=0),a===N.enumLine&&h===N.enumLine)return Vo(t,e,s,n,i,m,!1,!1);let l=t,u=e,c=t.getStartXY(),g=t.getEndXY(),d=!1,_=!1;c.compare(g)>0&&(l=t.clone(!0).reverse(),d=!0),c=e.getStartXY(),g=e.getEndXY(),c.compare(g)>0&&(u=e.clone(!0).reverse(),_=!0);let p=0;switch(a){case N.enumLine:switch(h){case N.enumEllipticArc:p=Ir(r,u,l,s,i,n,m,!1,!1,!0);break;case N.enumBezier:p=Pr(r,u,l,s,i,n,m,!1,!1,!0);break;case N.enumRationalBezier2:p=kn(r,u,l,s,i,n,m,!1,!1,!0);break;case N.enumBezier2:p=pr(r,u,l,s,i,n,m,!1,!1,!0);break;default:j("")}break;case N.enumEllipticArc:switch(h){case N.enumLine:p=Ir(r,l,u,s,n,i,m,!1,!1,!1);break;case N.enumEllipticArc:p=Xg(r,l,u,s,n,i,m,!1,!1,!1);break;case N.enumBezier:p=jh(r,u,l,s,i,n,m,!1,!1,!0);break;case N.enumRationalBezier2:p=Fh(r,u,l,s,i,n,m,!1,!1,!0);break;case N.enumBezier2:p=zh(r,u,l,s,i,n,m,!1,!1,!0);break;default:j("")}break;case N.enumRationalBezier2:switch(h){case N.enumLine:p=kn(r,l,u,s,n,i,m,!1,!1,!1);break;case N.enumEllipticArc:p=Fh(r,l,u,s,n,i,m,!1,!1,!1);break;case N.enumBezier:p=Zh(r,u,l,s,i,n,m,!1,!1,!0);break;case N.enumRationalBezier2:p=lr(r,l,u,s,n,i,m,!1,!1,!1);break;case N.enumBezier2:p=Vh(r,l,u,s,n,i,m,!1,!1,!1);break;default:j("")}break;case N.enumBezier2:switch(h){case N.enumLine:p=pr(r,l,u,s,n,i,m,!1,!1,!1);break;case N.enumEllipticArc:p=zh(r,l,u,s,n,i,m,!1,!1,!1);break;case N.enumBezier:p=Qh(r,u,l,s,i,n,m,!1,!1,!0);break;case N.enumRationalBezier2:p=Vh(r,u,l,s,i,n,m,!1,!1,!0);break;case N.enumBezier2:p=fm(r,l,u,s,n,i,m,!1,!1,!1);break;default:j("")}break;case N.enumBezier:switch(h){case N.enumLine:p=Pr(r,l,u,s,n,i,m,!1,!1,!1);break;case N.enumEllipticArc:p=jh(r,l,u,s,n,i,m,!1,!1,!1);break;case N.enumBezier:p=Cm(r,l,u,s,n,i,m,!1,!1,!1);break;case N.enumRationalBezier2:p=Zh(r,l,u,s,n,i,m,!1,!1,!1);break;case N.enumBezier2:p=Qh(r,l,u,s,n,i,m,!1,!1,!1);break;default:j("")}break;default:j("")}if(d){if(n){for(let f=0;f<p;f++)n[f]=1-n[f];n.reverse()}s&&s.reverse(),i&&i.reverse()}if(_&&i)for(let f=0;f<p;f++)i[f]=1-i[f];return p}function po(r,t,e){return t===e?0:(t>e&&(e=O(t,t=e)),r.cut(t,e,!0).calculateUpperLength2D())}function jf(r,t,e,s,n){let i=[],o=[],a=[];for(let m=0,l=n;m<l;m++)i.push(r.calculateSubLengthFromStart(e[m])),o.push(t.calculateSubLengthFromStart(s[m])),bt(e[m],0,1)&&bt(s[m],0,1)&&r.getCoord2D(e[m]).equals(t.getCoord2D(s[m]))&&a.push(m);if(a.length===0||a.length===n)return;a.sort((m,l)=>e[m]<e[l]?-1:e[m]>e[l]?1:s[m]<s[l]?-1:s[m]>s[l]?1:0);let h=-1;for(let m of a){if(h>=0&&e[m]===e[h]&&e[m]===e[h]){h=m;continue}h=m;let l=[];l.length=n;for(let u=0;u<l.length;++u)l[u]=u;l.sort((u,c)=>{let g=i[m],d=o[m],_=i[u]-g,p=o[u]-d,f=_*_+p*p,x=i[c]-g,C=o[c]-d,P=x*x+C*C;return f<P?-1:f>P?1:0});for(let u=0;u<n;u++){let c=l[u];if(c===m||e[c]===e[m]&&s[c]===s[m]||bt(e[c],0,1)&&bt(s[c],0,1))continue;let g=(S,I,D,b)=>{let T=new $,A=new H;A.setWithEps(1);let G=new H;G.set(I,A.eps()),r.queryCoord2DE(G,T);let F=new $;r.queryCoord2DE(new H(S),F);let M=!1;return T.eq(F)&&(G.set(b,A.eps()),t.queryCoord2DE(G,T),t.queryCoord2DE(new H(D),F),M=T.eq(F)),!M},d=y.getNAN();r.queryCoord2D(e[c],d);let _=y.getNAN();if(t.queryCoord2D(s[c],_),y.distance(d,_)===0&&g(e[m],e[c],s[m],s[c]))break;let p=new B(s[c],s[m]);p.normalizeNoNAN();let f=new B(e[c],e[m]);f.normalizeNoNAN();let x=-1,C=Number.POSITIVE_INFINITY,P=Number.POSITIVE_INFINITY,E=e[c];d.assign(r.getCoord2D(E));for(let S=0;S<5;S++){let I=t.getClosestCoordinateOnInterval(d,p,-1);_.assign(t.getCoord2D(I));let D=y.distance(d,_);if(E=r.getClosestCoordinateOnInterval(_,f,-1),E===e[m]&&I===s[m]){x=1;break}d.assign(r.getCoord2D(E));let b=y.distance(_,d);if(!(b<P&&D<C)){x=0;break}if(b===0&&D===0){g(e[m],e[c],s[m],s[c])?(e[c]=E,s[c]=I,x=0):x=1;break}P=b,C=D}if(x===-1&&(x=bt(e[c],0,1)||bt(s[c],0,1)?0:1),x!==1)break;e[c]=e[m],s[c]=s[m]}}}function Ke(r,t,e,s,n,i,o,a,h,m,l,u,c){if(!i)return 0;let g=(f,x)=>{for(let C=0;C<i;++C){let P=x[C];if(bt(P,0,1)){P=Tu(P);continue}let E=f.getCoord2D(P);P<.5?E.equals(f.getStartXY())&&po(f,0,P)<=Ts(f)&&(x[C]=0):E.equals(f.getEndXY())&&po(f,P,1)<=Ts(f)&&(x[C]=1)}};g(t,s),g(e,n),jf(t,e,s,n,i);let d=[];for(let f=0,x=i;f<x;f++)d.push(f);let _=(f,x)=>c?ja(n[f],s[f],n[x],s[x]):ja(s[f],n[f],s[x],n[x]);if(d.length>1){d.sort(_);let f=Math.max(Ts(t),Ts(e)),x=0;for(let C=1,P=d.length;C<P;C++){let E=s[d[x]],S=s[d[C]],I=n[d[x]],D=n[d[C]];if(E!==S||I!==D)if(!(po(t,E,S)<=f&&po(e,I,D)<=f)||bt(E,0,1)&&bt(I,0,1)||bt(S,0,1)&&bt(D,0,1))x++,d[x]=d[C];else{let b=y.distance(t.getCoord2D(E),e.getCoord2D(I)),T=y.distance(t.getCoord2D(S),e.getCoord2D(D));if(b<=T)continue;if(T<b){d[x]=d[C];continue}}}if(d.length=x+1,d.length===1&&d[0]!==0&&(s[0]=s[d[0]],n[0]=n[d[0]],d[0]=0),d.length>2){let C=B.constructEmpty(),P=B.constructEmpty();C.setCoords(s[d[0]],s[d.at(-1)]),P.setCoords(n[d[0]],n[d.at(-1)]);let E=!0;for(let S=1,I=d.length-1;S<I;S++)if(!C.containsCoordinate(s[d[S]])||!P.containsCoordinate(n[d[S]])){E=!1;break}if(E){let S=[.5,.2,.7,.1,.3,.4,.6,.8,.9];for(let I=0;I<S.length;I++){let D=pt(C.vmin,C.vmax,S[I]),b=t.getCoord2D(D);if(!e.isCloserThanDistance(b,P,m)){E=!1;break}D=pt(P.vmin,P.vmax,S[I]);let T=e.getCoord2D(D);if(!t.isCloserThanDistance(T,C,m)){E=!1;break}}}E&&(d[1]=d.at(-1),d.length=2)}}if(d.length===1&&r&&tr(t,e,s[0],n[0],m,1,[0],[0])&&(d.push(1),s[1]=0,n[1]=0,d.sort(_)),l&&d.length===1){let f=!0;for(let x=0,C=d.length;x<C;x++)if(!(bt(s[d[x]],0,1)&&bt(n[d[x]],0,1)&&y.distance(t.getCoord2D(s[d[x]]),e.getCoord2D(n[d[x]]))===0)){f=!1;break}if(f)return 0}let p=0;for(let f=0,x=d.length;f<x;f++){if(a&&a.push(s[d[f]]),h&&h.push(n[d[f]]),o){let C=y.getNAN();t.queryCoord2D(s[d[f]],C),o.push(C)}p++}return p}function Ar(r,t,e,s,n,i,o,a,h){if(bt(e,0,1)&&bt(s,0,1)&&y.distance(r.getCoord2D(e),t.getCoord2D(s))===0){let l=new $,u=Number.EPSILON;if(r.queryDerivative(new H(e,u),l),l.isTrueZero()){let p=e===1?-1e-12:1e-12;r.queryDerivative(new H(e,u).add(p),l)}e===1&&l.negateThis();let c=new $;if(t.queryDerivative(new H(s,u),c),c.isTrueZero()){let p=e===1?-1e-12:1e-12;t.queryDerivative(new H(s,u).add(p),c)}s===1&&c.negateThis(),l.isZero()||l.normalize(),c.isZero()||c.normalize();let g=l.dotProduct(c),d=l.crossProduct(c);d.scaleError(3);let _=()=>{if(h)return .001;{let p=r.calculateUpperLength2D(),f=t.calculateUpperLength2D();return Math.min(.01*n/Math.min(p,f),1e-10)}};if(g.ge(on)&&(d.isZero()||Math.abs(d.value())<_()))return Zc(r,t,e,s,n,i,o,a)}return 0}function fi(r,t,e,s,n){let i=-1,o=-1,a=-1,h=-1;{let m=[0,t],l=[t,0],u=[0,s],c=[s,0];for(let g=0;g<2&&i===-1;++g)for(let d=0;d<2;++d)if(r[m[g]].equals(e[u[d]])){i=m[g],o=l[g],a=u[d],h=c[d];break}}if(i===-1){let m=new me;m.setFromPoints(r,t+1);let l=new me;return l.setFromPoints(e,s+1),l.inflate(n),m.isIntersectingW(l)?-1:0}{let m=Z(t+1,Number.NaN),l=zc(r,t+1,m);w(l>1);let u=0,c=0;for(let D=0;D<l;++D)i===m[D]&&(c=D,u++),o===m[D]&&u++;if(u!==2)return-1;let g=Z(s+1,Number.NaN),d=zc(e,s+1,g);w(d>1),u=0;let _=0;for(let D=0;D<d;++D)a===g[D]&&(_=D,u++),h===g[D]&&u++;if(u!==2)return-1;let p=r[m[(c+l-1)%l]],f=r[m[(c+1)%l]],x=e[g[(_+d-1)%d]],C=e[g[(_+1)%d]],P=r[i],E=[p,f,x,C],S=[0,1,2,3];S.sort((D,b)=>y.compareVectorsOrigin(P,E[D],E[b]));let I=S[0];for(let D=1;D<4;D++){if(S[D]!==(I+1)%4)return-1;I=S[D]}{let D=p.sub(P),b=C.sub(P),T=b.dotProduct(D);if(T>0){let A=b.crossProduct(D),G=Math.abs(Math.atan2(A,T)),F=G*D.length(),M=G*b.length();if(F<=n||M<=n)return-1}}{let D=f.sub(P),b=x.sub(P),T=b.dotProduct(D);if(T>0){let A=b.crossProduct(D),G=Math.abs(Math.atan2(A,T)),F=G*D.length(),M=G*b.length();if(F<=n||M<=n)return-1}}return 1}}var fo=Ft,nt=class r extends Ch{constructor(t){super(t||{XStart:0,YStart:0,XEnd:0,YEnd:0})}assignMove(t){return this!==t&&(this.m_description=t.m_description,t.m_description=null,this.m_attributes=t.m_attributes,t.m_attributes=null,this.m_XStart=t.m_XStart,t.m_XStart=Number.NaN,this.m_YStart=t.m_YStart,this.m_XEnd=t.m_XEnd,t.m_XEnd=Number.NaN,this.m_YEnd=t.m_YEnd),this}assignCopy(t){return this!==t&&t.copyTo(this),this}calculateLowerLength3D(){return w(0),0}calculateUpperLength3D(){return w(0),0}changeEndPoints3D(t,e){w(0)}getClosestCoordinate3D(t,e,s){return w(0),0}getBoundary(){return Es(this)}getAttributeAsDbl(t,e,s){if(e===0)return s===0?ao(this,t):lh(this,t);let n=fo.getInterpolation(e),i=this.getStartAttributeAsDbl(e,s),o=this.getEndAttributeAsDbl(e,s);return Jn(n,i,o,t,fo.getDefaultValue(e))}constructFromCoords(t,e,s,n){this.dropAllAttributes(),this.setStartXYCoords(t,e),this.setEndXYCoords(s,n)}construct(t,e){this.dropAllAttributes(),this.setStartXY(t),this.setEndXY(e)}construct3D(t,e){w(0)}constructPoint(t,e){this.assignVertexDescription(t.getDescription()),this.mergeVertexDescription(e.getDescription()),this.setStart(t),this.setEnd(e)}getGeometryType(){return r.type}queryEnvelope(t){if(t.m_EnvelopeType===4){t.setEmpty(),t.assignVertexDescription(this.m_description);let e=V.constructEmpty();this.queryEnvelope(e),t.setEnvelope(e);for(let s=1,n=this.m_description.getAttributeCount();s<n;s++){let i=this.m_description.getSemantics(s);for(let o=0,a=fo.getComponentCount(i);s<a;s++){let h=this.queryInterval(i,o);t.setIntervalEnvelope(i,o,h)}}}else t.m_EnvelopeType===2?t.setCoords({xmin:this.m_XStart,ymin:this.m_YStart,xmax:this.m_XEnd,ymax:this.m_YEnd}):t.m_EnvelopeType===3?(t.setEmpty(),t.mergeCoords(this.m_XStart,this.m_YStart,Ds(this,0,1,0)),t.mergeCoords(this.m_XEnd,this.m_YEnd,Ds(this,1,1,0))):ft("env type not impl")}applyTransformation(t){w(t instanceof ct);let e=new y;e.x=this.m_XStart,e.y=this.m_YStart,t.transformInPlace(e),this.m_XStart=e.x,this.m_YStart=e.y,e.x=this.m_XEnd,e.y=this.m_YEnd,t.transformInPlace(e),this.m_XEnd=e.x,this.m_YEnd=e.y}createInstance(){return new r({vd:this.m_description})}calculateLength2D(){return Math.sqrt(Sh(this))}calculateLength3D(t){return w(0),0}changeEndPoints2D(t,e){this.setStartXY(t),this.setEndXY(e),this.normalizeAfterEndpointChange()}queryCoord2D(t,e){return Re(this,t,e)}queryCoord3D(t,e){w(0)}getCoordZ(t){return pp(this,t)}queryCoord2DE(t,e){$c(this,t,e)}getCoordX(t){return ao(this,t)}getCoordY(t){return lh(this,t)}cut(t,e,s){let n=new et;return this.queryCut(t,e,n,s),n.releaseSegment()}queryCut(t,e,s,n){let i=s.createLine();n&&i.assignVertexDescription(this.m_description);let o=y.getNAN();if(Re(this,t,o),i.setStartXYCoords(o.x,o.y),Re(this,e,o),i.setEndXYCoords(o.x,o.y),!n)for(let a=1,h=this.m_description.getAttributeCount();a<h;a++){let m=this.m_description.getSemantics(a),l=fo.getComponentCount(m);for(let u=0;u<l;u++){let c=this.getAttributeAsDbl(t,m,u);i.setStartAttribute(m,u,c);let g=this.getAttributeAsDbl(e,m,u);i.setEndAttribute(m,u,g)}}}queryDerivative(t,e){fp(this,t,e)}getClosestCoordinate(t,e){return y.getClosestCoordinate(this.getStartXY(),this.getEndXY(),t,e)}getClosestCoordinateOnInterval(t,e,s=-1){let n=new y;this.queryCoord2D(e.vmin,n);let i=new y;this.queryCoord2D(e.vmax,i);let o=y.getClosestCoordinate(n,i,t,!1);return br.recalculateParentT(e.vmin,e.vmax,o)}intersectionOfYMonotonicWithAxisX(t,e){let s=this.m_YEnd-this.m_YStart;if(!s)return t===this.m_YEnd?e:Number.NaN;let n=(t-this.m_YStart)/s,i=ao(this,n);return n===1&&(i=this.m_XEnd),i}isCurve(){return!1}isMonotoneQuickAndDirty(){return!0}isDegenerate(t){let e=this.m_XStart-this.m_XEnd,s=this.m_YStart-this.m_YEnd;return Math.sqrt(e*e+s*s)<=t}isDegenerate3D(t,e){return w(0),!1}queryLooseEnvelope(t){this.queryEnvelope(t)}clone(t){let e=new r;return this.copyTo(e),e}tToLength(t){return t*this.calculateLength2D()}lengthToT(t){let e=this.calculateLength2D();return e!==0?t/e:0}calculateWeightedAreaCentroid2D(t){let e=new y;return e.setCoords(0,0),e}calculateWeightedCentroid2D(){return this.getCoord2D(.5).mul(this.calculateLength2D())}getTangent(t){let e=y.getNAN();return e.setSub(this.getEndXY(),this.getStartXY()),e}getDerivative(t){let e=new y;return e.setSub(this.getEndXY(),this.getStartXY()),e}getCurvature(t){return 0}isIntersectingPoint(t,e,s){return ri(this,t,e,s)>=0}isIntersectingPoint3D(t,e,s,n,i=1){return w(0),!1}getYMonotonicParts(t,e){return 0}getMonotonicParts(t,e){return 0}getMonotonicPartParams(t,e){return e&&(t<2&&U(""),e[0]=0,e[1]=1),2}intersectionWithAxis2D(t,e,s,n){if(t){let i=this.m_YEnd-this.m_YStart;if(!i)return e===this.m_YEnd?-1:0;let o=(e-this.m_YStart)/i;return o<0||o>1?0:(s&&(s[0]=ao(this,o)),n&&(n[0]=o),1)}{let i=this.m_XEnd-this.m_XStart;if(!i)return e===this.m_XEnd?-1:0;let o=(e-this.m_XStart)/i;return o<0||o>1?0:(s&&(s[0]=lh(this,o)),n&&(n[0]=o),1)}}calculateUpperLength2D(){return this.calculateLength2D()}calculateLowerLength2D(){return this.calculateLength2D()}normalizeAfterEndpointChange(){return!1}queryLooseEnvelopeOnInterval(t,e){if(e.m_EnvelopeType===2){let s=Tt(t.vmin,0,1),n=new y;return this.queryCoord2D(s,n),e.setCoords({pt:n}),s=Tt(t.vmax,0,1),this.queryCoord2D(s,n),void e.mergeNe(n)}ft("3d dst not impl")}orientBottomUp(){cm(this)}isLine(){return!0}isDegenerateToLineHelper(t){return!0}copyIgnoreAttributes(t){t.setStartXY(this.getStartXY()),t.setEndXY(this.getEndXY()),t.normalizeAfterEndpointChange()}calculateArea2DHelper(){return 0}absNormXYZ(t){return xp(this,t)}absNorm(){return this.getStartXY().norm(1)+this.getEndXY().norm(1)}queryEnvelopeW(t,e){e.setCoords(this.getCoord2D(t.vmin)),e.mergeNe(this.getCoord2D(t.vmax))}setSegmentFromCoords(t,e){Qu(this,t[0],t[e-1])}writeInBufferStream(t,e){return w(0),0}readFromBufferStream(t,e){w(0)}snapControlPoints(t){return!1}needsSnapControlPoints(t){return!1}calculateSpecialPointsForCracking(t,e){return 0}ensureXYMonotone(){return!1}setCoordsForIntersector(t,e,s){Qu(this,t,e)}static isIntersectingLineLine(t,e,s,n){return Eh(t,e,s,n)}static isIntersectingLineLine_(t,e,s,n){return Eh(t,e,s,n)}copyToImpl(t){}reverseImpl(){}equalsImpl(t){return!0}equalsImplTol(t,e){return!0}swapImpl(t){}afterCompletedModification(){}endPointModified(){}clearEndPointModified(){}intersect(t,e,s,n,i){return Pn(!1,this,t,e,s,n,i)}intersectPoint(t,e,s){e.length<1&&xt("");let n=ri(this,t,s,!1);return n>=0?(e&&(e[0]=n),1):0}isIntersecting(t,e,s){return Hn(!1,this,t,e,s)!==0}};nt.type=N.enumLine;var et=class r{constructor(t){this.m_seg=null,this.m_curves=null,this.m_lineBuffer=new nt,this.m_mask=0,this.m_active=0,t!==void 0&&(t.copy?t.copy.copyTo(this,!1):t.move?this.assignMove(t.move):t.segment?this.copyFrom(t.segment,!!t.bIgnoreAttributes):j("bad constructor params"))}assignCopy(t){return t instanceof r?this!==t&&t.copyTo(this,!1):this.copyFrom(t,!1),this}assignMove(t){if(t instanceof r){if(this===t)return this;this.reset(),1&t.m_mask&&(this.m_lineBuffer=t.m_lineBuffer,t.m_lineBuffer=null,this.m_mask=1),this.m_curves=t.m_curves,this.m_mask=t.m_mask,this.m_active=t.m_active,t.reset(),this.m_seg=this.activeSegment(),t.m_seg=null}else{if(this.m_seg===t)return this;this.create(t.getGeometryType()),this.m_seg.swap(t)}return this}activeSegment(){switch(this.m_active){case 0:return null;case 1:return this.line();case 2:return this.arc();case 4:return this.bezier3();case 8:return this.bezier2();case 16:return this.rbezier2();default:j("")}}get(){return this.m_seg}reset(){1&this.m_mask&&(this.m_lineBuffer=null),this.m_mask>1&&(this.m_curves=null),this.m_mask=0,this.m_active=0}empty(){return this.m_seg===null}copyTo(t,e){this!==t&&(this.empty()?t.m_seg=null:t.copyFrom(this.m_seg,e))}copyToWithZ(t,e){w(0)}createImpl(t){switch(t){case N.enumLine:1&this.m_mask||(this.m_lineBuffer=new nt,this.m_mask|=1,this.m_active=1);break;case N.enumEllipticArc:2&this.m_mask||(this.m_curves=new je,this.m_mask=1&this.m_mask|2,this.m_active=2);break;case N.enumBezier:4&this.m_mask||(this.m_curves=new Ge,this.m_mask=1&this.m_mask|4,this.m_active=4);break;case N.enumBezier2:8&this.m_mask||(this.m_curves=new Ls,this.m_mask=1&this.m_mask|8,this.m_active=8);break;case N.enumRationalBezier2:16&this.m_mask||(this.m_curves=new _e,this.m_mask=1&this.m_mask|16,this.m_active=16);break;default:U("")}}create(t){t===N.enumLine?this.createLine():t===N.enumEllipticArc?this.createEllipticArc():t===N.enumBezier?this.createCubicBezier():t===N.enumRationalBezier2?this.createQuadraticRationalBezier():t===N.enumBezier2?this.createQuadraticBezier():U("Segment_buffer.create")}copyFrom(t,e){this.m_seg!==t&&(this.create(t.getGeometryType()),e?t.copyIgnoreAttributes(this.m_seg):t.copyTo(this.m_seg))}copyFromWithZ(t,e){w(0)}line(){return this.m_lineBuffer}arc(){return this.m_curves}bezier3(){return this.m_curves}bezier2(){return this.m_curves}rbezier2(){return this.m_curves}createLine(){return this.createImpl(N.enumLine),this.m_seg=this.line(),this.line()}createEllipticArc(){return this.createImpl(N.enumEllipticArc),this.m_seg=this.arc(),this.arc()}createCubicBezier(){return this.createImpl(N.enumBezier),this.m_seg=this.bezier3(),this.bezier3()}createQuadraticRationalBezier(){return this.createImpl(N.enumRationalBezier2),this.m_seg=this.rbezier2(),this.rbezier2()}createQuadraticBezier(){return this.createImpl(N.enumBezier2),this.m_seg=this.bezier2(),this.bezier2()}releaseSegment(){if(this.m_seg=null,this.m_active===0&&j("releaseSegment"),1&this.m_active){let e=this.line();return this.m_mask-=1,this.m_active=0,this.m_lineBuffer=null,e}let t;return 2&this.m_active?t=this.arc():4&this.m_active?t=this.bezier3():8&this.m_active?t=this.bezier2():16&this.m_active?t=this.rbezier2():j("releaseSegment"),this.m_mask-=this.m_active,this.m_active=0,this.m_curves=null,t}equals(t){return t instanceof r?this===t||(this.empty()?t.empty():!t.empty()&&this.get().equals(t.get())):(ft("seg comparison not yet impl"),!1)}};function St(r,t,e,s,n){return Rg(r,t,null,e,s,n)}function Rg(r,t,e,s,n,i){let o=r.getGeometryType();if(o===N.enumPoint){let l=r.getXY();return t.contains(l)?r:r.createInstance()}if(o===N.enumEnvelope){let l=V.constructEmpty();if(r.queryEnvelope(l),l.intersect(t)){let u=r.clone();return u.setEnvelope(l),u}return r.createInstance()}if(r.isEmpty())return r;if(t.isEmpty())return r.createInstance();let a=t.clone();{let l=new V;if(r.queryLooseEnvelope(l),a.containsEnvelope(l))return r;if(!a.isIntersecting(l))return r.createInstance();n===0&&(l.intersect(a),l.inflate(Math.max(.1*l.maxDimension(),1)),l.intersect(a),a.assign(l))}let h=s;if((e!==null||Number.isNaN(h))&&(h=Wt(e,a,!1).total()),o===N.enumGeometryCollection){let l=r,u=r.createInstance();for(let c=0,g=l.getGeometryCount();c<g;c++){let d=l.getGeometry(c);if(d.isEmpty())continue;let _=St(d,a,h,n,i);_.isEmpty()||(_===d?u.addGeometry(_.clone()):u.addGeometry(_))}return u}Ie(o)||U("Clip: geometry not supported");let m=r.getImpl().getAccelerators();if(m!==null){let l=m.getRasterizedGeometry();w(l===null)}switch(o){case N.enumMultiPoint:{let l=r,u,c=l.getPointCount(),g=l.getImpl().getAttributeStreamRef(0),d=0;for(let _=0;_<c;_++){let p=g.readPoint2D(2*_);a.contains(p)||(d===0&&(u=l.createInstance()),d<_&&u.addPoints(l,d,_),d=_+1)}return d>0&&u.addPoints(l,d,c),d===0?l:(w(u!==null),u)}case N.enumPolygon:case N.enumPolyline:return Zf(r,a,h,n,i);default:j("")}}function Hg(r,t,e,s,n,i){let o=new Ro(t,i),a=new V;return r.queryLooseEnvelope(a),t.containsEnvelope(a)?r:t.isIntersecting(a)?o.clipPolesOut(r,n):r.createInstance()}function Zf(r,t,e,s,n){return new Ro(t,n).clipMultiPath2(r,e,s)}var Ro=class r{constructor(t,e){this.m_shape=new Nt,this.m_geometry=v,this.m_verticesOnExtentIndex=-1,this.m_verticesOnExtent=[],this.m_progressCounter=0,this.m_extent=new V(t),this.m_progressTracker=e}progress_(){}clipMultiPath2(t,e,s){return t.getGeometryType()===N.enumPolygon?this.clipPolygonOrProjectedPolyline2(t,s):this.clipPolyline(t,e)}clipPolygonOrProjectedPolyline2(t,e){let s=t.getGeometryType()===N.enumPolyline;if(this.m_extent.width()===0||this.m_extent.height()===0)return t.createInstance();let n=V.constructEmpty();t.queryLooseEnvelope(n),this.m_geometry=s?this.m_shape.addGeometry(t):this.m_shape.addGeometry(t,this.m_extent);let i=V.constructEmpty(),o=V.constructEmpty(),a=new y,h=new y,m=Z(9,Number.NaN),l=Z(9,Number.NaN),u=k(y,9),c=null,g=new nt,d=[],_=!1;for(let f=0;!_&&f<4;f++){let x=!1,C=!!(1&f),P=0;switch(f){case 0:P=this.m_extent.xmin,x=n.xmin<=P&&n.xmax>=P;break;case 1:P=this.m_extent.ymin,x=n.ymin<=P&&n.ymax>=P;break;case 2:P=this.m_extent.xmax,x=n.xmin<=P&&n.xmax>=P;break;case 3:P=this.m_extent.ymax,x=n.ymin<=P&&n.ymax>=P}if(x){_=!0;for(let E=this.m_shape.getFirstPath(this.m_geometry);E!==v;){let S=!0,I=-1,D=-1,b=this.m_shape.getFirstVertex(E),T=b;do{this.progress_(),c=this.m_shape.getSegment(T);let A=c;if(A===null){let q=this.m_shape.getNextVertex(T);if(q===v){w(s),I===0&&d.push(T);break}this.m_shape.queryXY(T,a),g.setStartXY(a),this.m_shape.queryXY(q,h),g.setEndXY(h),A=g}A.queryLooseEnvelope(i);let G=r.checkSegmentIntersection(i,f,P);A.isCurve()&&G===0&&A.isCurve()&&(g.setStartXY(A.getStartXY()),g.setEndXY(A.getEndXY()),this.m_shape.replaceCurveWithLine(T),A=g,g.queryEnvelope(i),G=r.checkSegmentIntersection(i,f,P));let F=0,M=v;if(G===-1){let q=A.intersectionWithAxis2D(C,P,m,l);if(q>0){let z=null;if(A.isCurve()){z=u,w(q<=9);for(let Y=0;Y<q;Y++)C?u[Y].setCoords(m[Y],P):u[Y].setCoords(P,m[Y]);F=this.m_shape.splitSegmentAxisAware(T,l,q,z,C?1:0)}else F=this.m_shape.splitSegmentAxisAware(T,l,q,null,-1)}else F=0;F+=1;let R=T,X=this.m_shape.getNextVertex(R);A=null;for(let z=0;z<F;z++){this.m_shape.queryXY(R,a),this.m_shape.queryXY(X,h),c=this.m_shape.getSegment(R);let Y=c;Y===null&&(g.setStartXY(a),g.setEndXY(h),Y=g),Y.queryEnvelope(o);let L=r.checkSegmentIntersection(o,f,P);Y.isCurve()&&L===0&&(this.m_shape.replaceCurveWithLine(R),g.setStartXY(a),g.setEndXY(h),Y=g,Y.queryEnvelope(o),L=r.checkSegmentIntersection(o,f,P)),L===-1&&(C?Math.abs(a.y-P)<Math.abs(h.y-P)?(a.y=P,this.m_shape.setXY(R,a)):(h.y=P,this.m_shape.setXY(X,h)):Math.abs(a.x-P)<Math.abs(h.x-P)?(a.x=P,this.m_shape.setXY(R,a)):(h.x=P,this.m_shape.setXY(X,h)),c=this.m_shape.getSegment(R),Y=c,Y===null&&(g.setStartXY(a),g.setEndXY(h),Y=g),Y.queryEnvelope(o),L=r.checkSegmentIntersection(o,f,P),L===-1&&(L=r.checkSegmentIntersectionLoose(o,f,P)));let W=I;I=L,D===-1&&(D=I),W===0&&I===1||W===1&&I===0||W===0&&I===0&&d.push(R),I===1&&(_=!1,S=!1),R=X,M=R,X=this.m_shape.getNextVertex(X)}}if(F===0){let q=I;I=G,D===-1&&(D=I),q===0&&I>=1||q>=1&&I===0||q===0&&I===0&&d.push(T),I===1&&(_=!1,S=!1),M=this.m_shape.getNextVertex(T)}if(T=M,d.length>=256){for(let q=1,R=d.length-1;q<R;q++){let X=d[q];s?this.m_shape.snapVertexForPoleClipping(X,P):this.m_shape.removeVertex(X,!1)}d[1]=d.at(-1),d.length=2}}while(T!==b);if(!S){D!==0||!s&&I!==0&&I!==2||d.push(b);for(let A=0,G=d.length;A<G;A++){let F=d[A];s?this.m_shape.snapVertexForPoleClipping(F,P):this.m_shape.removeVertex(F,!1)}}d.length=0,E=S||this.m_shape.getPathSize(E)===0?this.m_shape.removePath(E):this.m_shape.getNextPath(E)}}}if(_)return t.createInstance();c=null,s?this.removeSpikesAlongPoles():this.resolveBoundaryOverlaps(),e>0&&this.densifyAlongClipExtent(e);let p=this.m_shape.getGeometry(this.m_geometry);return p.getGeometryType()===N.enumPolygon&&p.setFillRule(t.getFillRule()),p}clipPolyline(t,e){let s=V.constructEmpty(),n=V.constructEmpty(),i=Z(9,Number.NaN),o=Z(9,Number.NaN),a=new et,h=t,m=V.constructEmpty();t.queryLooseEnvelope(m);for(let l=0;l<4;l++){let u=!1,c=!!(1&l),g=0;switch(l){case 0:g=this.m_extent.xmin,u=m.xmin<=g&&m.xmax>=g;break;case 1:g=this.m_extent.ymin,u=m.ymin<=g&&m.ymax>=g;break;case 2:g=this.m_extent.xmax,u=m.xmin<=g&&m.xmax>=g;break;case 3:g=this.m_extent.ymax,u=m.ymin<=g&&m.ymax>=g}if(!u)continue;let d=h;h=t.createInstance();let _=d.getImpl().querySegmentIterator();_.resetToFirstPath();let p=new y,f=new y;for(;_.nextPath();){let x=-1,C=!0;for(;_.hasNextSegment();){this.progress_();let P=_.nextSegment(),E=P.isDegenerate(0);P.queryLooseEnvelope(s);let S=r.checkSegmentIntersection(s,l,g);if(S===-1){let I=P.intersectionWithAxis2D(c,g,i,o),D=0;p.assign(P.getStartXY());for(let b=0;b<=I;b++){let T=b<I?o[b]:1;if(D===T)continue;P.queryCut(D,T,a,!1);let A=a.get(),G=!1;if(A.getStartXY().equals(p)||(A.setStartXY(p),G=!0),b<I&&(c?(f.x=i[b],f.y=g):(f.x=g,f.y=i[b]),A.getEndXY().equals(f)||(A.setEndXY(f),G=!0)),G&&A.normalizeAfterEndpointChange(),!E&&A.isDegenerate(0))continue;A.queryEnvelope(n);let F=r.checkSegmentIntersection(n,l,g);if(F===-1){let M=A.getStartXY(),q=A.getEndXY();G=!1,c?Math.abs(M.y-g)<Math.abs(q.y-g)?(M.y=g,A.setStartXY(M),M.equals(A.getStartXY())||(A.setStartXY(M),G=!0)):(q.y=g,q.equals(A.getEndXY())||(A.setEndXY(q),G=!0)):Math.abs(M.x-g)<Math.abs(q.x-g)?(M.x=g,M.equals(A.getStartXY())||(A.setStartXY(M),G=!0)):(q.x=g,q.equals(A.getEndXY())||(A.setEndXY(q),G=!0)),G&&A.normalizeAfterEndpointChange(),A.queryEnvelope(n),F=r.checkSegmentIntersection(n,l,g),F===-1&&(F=r.checkSegmentIntersectionLoose(n,l,g))}p.assign(A.getEndXY()),D=T,x=F,x>=1?(h.addSegment(A,C),C=!1):C=!0}}else x=S,x>=1?(h.addSegment(P,C),C=!1):C=!0}}}return h}static checkSegmentIntersection(t,e,s){switch(e){case 0:return t.xmin<s&&t.xmax<=s?0:t.xmin>=s?t.xmax===s?2:1:-1;case 1:return t.ymin<s&&t.ymax<=s?0:t.ymin>=s?t.ymax===s?2:1:-1;case 2:return t.xmin>=s&&t.xmax>s?0:t.xmax<=s?t.xmin===s?2:1:-1;case 3:return t.ymin>=s&&t.ymax>s?0:t.ymax<=s?t.ymin===s?2:1:-1}return j(""),0}static checkSegmentIntersectionLoose(t,e,s){switch(e){case 0:{let n=Math.abs(t.xmin-s),i=Math.abs(t.xmax-s);return t.xmin<s?n>i?0:1:(j(""),1)}case 1:{let n=Math.abs(t.ymin-s),i=Math.abs(t.ymax-s);return t.ymin<s?n>i?0:1:(j(""),1)}case 2:{let n=Math.abs(t.xmin-s),i=Math.abs(t.xmax-s);return t.xmax>s?n<i?0:1:(j(""),1)}case 3:{let n=Math.abs(t.ymin-s),i=Math.abs(t.ymax-s);return t.ymax>s?n<i?0:1:(j(""),1)}}return j(""),0}resolveBoundaryOverlaps(){this.m_verticesOnExtentIndex=-1,this.splitSegments(!1,this.m_extent.xmin),this.splitSegments(!1,this.m_extent.xmax),this.splitSegments(!0,this.m_extent.ymin),this.splitSegments(!0,this.m_extent.ymax),this.m_verticesOnExtent.length=0,this.m_verticesOnExtentIndex=this.m_shape.createUserIndex();let t=new y;for(let e=this.m_shape.getFirstPath(this.m_geometry);e!==v;e=this.m_shape.getNextPath(e)){let s=this.m_shape.getFirstVertex(e);for(let n=0,i=this.m_shape.getPathSize(e);n<i;n++,s=this.m_shape.getNextVertex(s))this.progress_(),this.m_shape.queryXY(s,t),this.m_extent.xmin!==t.x&&this.m_extent.xmax!==t.x&&this.m_extent.ymin!==t.y&&this.m_extent.ymax!==t.y||(this.m_shape.setUserIndex(s,this.m_verticesOnExtentIndex,this.m_verticesOnExtent.length),this.m_verticesOnExtent.push(s))}this.dbgCheckPathFirst(),this.resolveOverlaps(!1,this.m_extent.xmin),this.dbgCheckPathFirst(),this.resolveOverlaps(!1,this.m_extent.xmax),this.dbgCheckPathFirst(),this.resolveOverlaps(!0,this.m_extent.ymin),this.dbgCheckPathFirst(),this.resolveOverlaps(!0,this.m_extent.ymax),this.fixPaths()}densifyAlongClipExtent(t){let e=new y(0,0),s=new y(0,0),n=Z(2048,Number.NaN);for(let i=this.m_shape.getFirstPath(this.m_geometry);i!==v;i=this.m_shape.getNextPath(i)){let o=this.m_shape.getFirstVertex(i),a=o;do{let h=this.m_shape.getNextVertex(a);this.m_shape.queryXY(a,e);let m=-1;if(e.x===this.m_extent.xmin?(this.m_shape.queryXY(h,s),s.x===this.m_extent.xmin&&(m=1)):e.x===this.m_extent.xmax&&(this.m_shape.queryXY(h,s),s.x===this.m_extent.xmax&&(m=1)),e.y===this.m_extent.ymin?(this.m_shape.queryXY(h,s),s.y===this.m_extent.ymin&&(m=0)):e.y===this.m_extent.ymax&&(this.m_shape.queryXY(h,s),s.y===this.m_extent.ymax&&(m=0)),m===-1){a=h;continue}if(this.isCurve(a)){a=h;continue}let l=e.clone(),u=new y(0,0);if(m){let d=e.y-this.m_extent.ymin;u.y=Mt(s.y-e.y),l.y=t*bs(Math.floor(Math.abs(d)/t),d)+this.m_extent.ymin,u.y<0&&(l.y+=t)}else{let d=e.x-this.m_extent.xmin;u.x=Mt(s.x-e.x),l.x=t*bs(Math.floor(Math.abs(d)/t),d)+this.m_extent.xmin,u.x<0&&(l.x+=t)}let c=m?s.y-e.y:s.x-e.x,g=Math.abs(c);if(g/t>65536&&j(""),g>0){let d=Math.trunc(g/t)+2;n.length<d&&(n.length=d);let _=0;for(let p=0;;p++){let f=l.add(u.mul(p*t)),x=(m?f.y-e.y:f.x-e.x)/c;if(x>=1)break;x<=0||(w(_<=n.length),n[_]=x,_++)}_!==0&&this.m_shape.splitSegment(a,n,_)}a=h}while(a!==o)}}splitSegments(t,e){let s=-1,n=new y,i=[];for(let d=this.m_shape.getFirstPath(this.m_geometry);d!==v;d=this.m_shape.getNextPath(d)){let _=this.m_shape.getFirstVertex(d),p=v;for(let f=0,x=this.m_shape.getPathSize(d);f<x;f++,_=p)if(this.progress_(),p=this.m_shape.getNextVertex(_),this.m_shape.queryXY(_,n),(t?n.y===e:n.x===e)&&(this.m_shape.queryXY(p,n),t?n.y===e:n.x===e)){if(this.isCurve(_))continue;s===-1&&(s=this.m_shape.createUserIndex()),this.m_shape.getUserIndex(_,s)!==1&&(i.push(_),this.m_shape.setUserIndex(_,s,1)),this.m_shape.getUserIndex(p,s)!==1&&(i.push(p),this.m_shape.setUserIndex(p,s,1))}}if(s!==-1&&this.m_shape.removeUserIndex(s),i.length<3)return;i.sort((d,_)=>this.compareVertices(d,_));let o=new y,a=new y,h=new y;a.setNAN();let m=-1,l=[],u=[],c=this.m_shape.createUserIndex(),g=this.m_shape.createUserIndex();for(let d=0,_=i.length;d<_;d++){let p=i[d];if(this.m_shape.queryXY(p,n),!n.isEqualPoint2D(a)){if(m===-1){m=d,a.setCoordsPoint2D(n);continue}for(let x=m;x<d;x++){let C=i[x],P=this.m_shape.getNextVertex(C),E=this.m_shape.getPrevVertex(C),S=!1;this.m_shape.queryXY(P,o),a.compare(o)<0&&(t?o.y===e:o.x===e)&&(this.isCurve(C)||(l.push(C),S=!0,this.m_shape.setUserIndex(C,g,1))),this.m_shape.queryXY(E,o),a.compare(o)<0&&(t?o.y===e:o.x===e)&&(this.isCurve(E)||(S||l.push(C),this.m_shape.setUserIndex(C,c,1)))}for(let x=0,C=l.length;x<C;x++){let P=l[x],E=this.m_shape.getUserIndex(P,c),S=this.m_shape.getUserIndex(P,g);if(E===1){let I=this.m_shape.getPrevVertex(P);this.m_shape.queryXY(I,h);let D=0;if(!h.isEqualPoint2D(n)){let b=y.distance(a,h);D=y.distance(h,n)/b,D===0?D=Number.EPSILON:D===1&&(D=1-Number.EPSILON),this.m_shape.splitSegment(I,[D],1);let T=this.m_shape.getPrevVertex(P);this.m_shape.setXY(T,n),u.push(T),this.m_shape.setUserIndex(T,c,1),this.m_shape.setUserIndex(T,g,-1)}}if(S===1){let I=this.m_shape.getNextVertex(P);this.m_shape.queryXY(I,h);let D=0;if(!h.isEqualPoint2D(n)){let b=y.distance(a,h);D=y.distance(a,n)/b,D===0?D=Number.EPSILON:D===1&&(D=1-Number.EPSILON),this.m_shape.splitSegment(P,[D],1);let T=this.m_shape.getNextVertex(P);this.m_shape.setXY(T,n),u.push(T),this.m_shape.setUserIndex(T,c,-1),this.m_shape.setUserIndex(T,g,1)}}}let f=l;l=u,u=f,u.length=0,m=d,a.setCoordsPoint2D(n)}}this.m_shape.removeUserIndex(c),this.m_shape.removeUserIndex(g)}resolveOverlaps(t,e){let s=new y,n=[],i=-1;for(let m=0,l=this.m_verticesOnExtent.length;m<l;m++){this.progress_();let u=this.m_verticesOnExtent[m];if(u===v)continue;let c=this.m_shape.getNextVertex(u);if(this.m_shape.queryXY(u,s),(t?s.y===e:s.x===e)&&(this.m_shape.queryXY(c,s),t?s.y===e:s.x===e)){if(this.isCurve(u))continue;i===-1&&(i=this.m_shape.createUserIndex()),this.m_shape.getUserIndex(u,i)!==-2&&(n.push(u),this.m_shape.setUserIndex(u,i,-2)),this.m_shape.getUserIndex(c,i)!==-2&&(n.push(c),this.m_shape.setUserIndex(c,i,-2))}}if(n.length===0)return void(i!==-1&&this.m_shape.removeUserIndex(i));w(i!==-1),n.sort((m,l)=>this.compareVertices(m,l));for(let m=0,l=n.length;m<l;m++){let u=n[m];this.m_shape.setUserIndex(u,i,m)}let o=new y,a=new y;a.setNAN();let h=-1;for(let m=0,l=n.length;m<l;m++){this.progress_();let u=n[m];if(u!==v&&(this.m_shape.queryXY(u,s),!s.isEqualPoint2D(a))){if(h!==-1)for(;;){let c=!1,g=m;for(let d=h;d<g;d++){let _=n[d];if(_===v)continue;let p=v,f=this.m_shape.getNextVertex(_);this.m_shape.queryXY(f,o),a.compare(o)<0&&(t?o.y===e:o.x===e)&&(this.isCurve(_)||(p=f));let x=v,C=this.m_shape.getPrevVertex(_);if(this.m_shape.queryXY(C,o),a.compare(o)<0&&(t?o.y===e:o.x===e)&&(this.isCurve(C)||(x=C)),p===v||x===v){if(p!==v||x!==v){for(let P=d+1;P<m;P++){let E=n[P];if(E===v)continue;let S=this.m_shape.getNextVertex(E),I=v;this.m_shape.queryXY(S,o),a.compare(o)<0&&(t?o.y===e:o.x===e)&&(this.isCurve(E)||(I=S));let D=this.m_shape.getPrevVertex(E),b=v;if(this.m_shape.queryXY(D,o),a.compare(o)<0&&(t?o.y===e:o.x===e)&&(this.isCurve(D)||(b=D)),I!==v&&b!==v){this.beforeRemoveVertex(E,n,i),this.m_shape.removeVertex(E,!1),this.beforeRemoveVertex(I,n,i),this.m_shape.removeVertex(I,!1),c=!0;break}if(p!==v&&b!==v){this.removeOverlap(n,_,p,E,b,i),c=!0;break}if(x!==v&&I!==v){this.removeOverlap(n,E,I,_,x,i),c=!0;break}}if(c)break}}else this.beforeRemoveVertex(_,n,i),this.m_shape.removeVertex(_,!1),this.beforeRemoveVertex(p,n,i),this.m_shape.removeVertex(p,!1),c=!0}if(!c)break}h=m,a.setCoordsPoint2D(s)}}this.m_shape.removeUserIndex(i)}beforeRemoveVertex(t,e,s){let n=this.m_shape.getUserIndex(t,s);w(n>=0),e[n]=v,n=this.m_shape.getUserIndex(t,this.m_verticesOnExtentIndex),w(n>=0),this.m_verticesOnExtent[n]=v;let i=this.m_shape.getPathFromVertex(t);i!==v&&this.m_shape.getFirstVertex(i)===t&&(this.m_shape.setFirstVertex(i,v),this.m_shape.setLastVertex(i,v))}removeOverlap(t,e,s,n,i,o){this.m_shape.setNextVertex(e,n),this.m_shape.setPrevVertex(n,e),this.m_shape.setPrevVertex(s,i),this.m_shape.setNextVertex(i,s),this.beforeRemoveVertex(n,t,o),this.m_shape.removeVertexInternal(n,!1),this.beforeRemoveVertex(i,t,o),this.m_shape.removeVertexInternal(i,!0)}removeSpikesAlongPoles(){this.removeSpikesOnPole(this.m_extent.ymin),this.removeSpikesOnPole(this.m_extent.ymax)}removeSpikesOnPole(t){for(let e=this.m_shape.getFirstPath(this.m_geometry);e!==v;e=this.m_shape.getNextPath(e)){let s=this.m_shape.getPathSize(e);if(s<3)continue;let n=this.m_shape.getFirstVertex(e),i=new y;this.m_shape.queryXY(n,i);let o=i.y===t&&!this.isCurve(n);n=this.m_shape.getNextVertex(n);let a=new y;this.m_shape.queryXY(n,a);let h=a.y===t&&!this.isCurve(n);n=this.m_shape.getNextVertex(n);let m=new y;for(let l=0,u=s-2;l<u;l++,n=this.m_shape.getNextVertex(n)){this.progress_(),this.m_shape.queryXY(n,m);let c=m.y===t;if(h&&o&&c&&(a.x-i.x)*(m.x-a.x)<=0){this.m_shape.removeVertex(this.m_shape.getPrevVertex(n),!1),a.setCoordsPoint2D(m),h=c&&!this.isCurve(n);continue}i.setCoordsPoint2D(a),o=h,a.setCoordsPoint2D(m),h=c&&!this.isCurve(n)}}}fixPaths(){for(let i=0,o=this.m_verticesOnExtent.length;i<o;i++){let a=this.m_verticesOnExtent[i];a!==v&&this.m_shape.setPathToVertex(a,v)}let t=this.m_shape.hasCurves(),e=0,s=0;for(let i=this.m_shape.getFirstPath(this.m_geometry);i!==v;){let o=this.m_shape.getFirstVertex(i);if(o===v||i!==this.m_shape.getPathFromVertex(o)){let m=i;i=this.m_shape.getNextPath(i),this.m_shape.setFirstVertex(m,v),this.m_shape.removePathOnly(m);continue}let a=o,h=0;do this.m_shape.setPathToVertex(a,i),h++,a=this.m_shape.getNextVertex(a);while(a!==o);this.m_shape.setRingAreaValid(i,!1),this.m_shape.setLastVertex(i,this.m_shape.getPrevVertex(o)),this.m_shape.setPathSize(i,h),s+=h,e++,i=this.m_shape.getNextPath(i)}for(let i=0,o=this.m_verticesOnExtent.length;i<o;i++){let a=this.m_verticesOnExtent[i];if(a===v)continue;let h=this.m_shape.getPathFromVertex(a);if(h!==v)continue;h=this.m_shape.insertPath(this.m_geometry,v);let m=!1,l=0,u=a;do this.m_shape.setPathToVertex(a,h),l++,t&&l<=2&&(m||=this.isCurve(a)),a=this.m_shape.getNextVertex(a);while(a!==u);if(m?l===0:l<=2){let c=this.m_shape.getUserIndex(u,this.m_verticesOnExtentIndex);w(c>=0),this.m_verticesOnExtent[c]=v;let g=this.m_shape.removeVertex(u,!1);l===2&&(c=this.m_shape.getUserIndex(g,this.m_verticesOnExtentIndex),c>=0&&(this.m_verticesOnExtent[c]=v),this.m_shape.removeVertex(g,!1));let d=h;h=this.m_shape.getNextPath(h),this.m_shape.setFirstVertex(d,v),this.m_shape.removePathOnly(d)}else this.m_shape.setClosedPath(h,!0),this.m_shape.setPathSize(h,l),this.m_shape.setFirstVertex(h,u),this.m_shape.setLastVertex(h,this.m_shape.getPrevVertex(u)),this.m_shape.setRingAreaValid(h,!1),s+=l,e++}this.m_shape.setGeometryPathCount(this.m_geometry,e),this.m_shape.setGeometryVertexCount(this.m_geometry,s);let n=0;for(let i=this.m_shape.getFirstGeometry();i!==v;i=this.m_shape.getNextGeometry(i))n+=this.m_shape.getPointCount(i);this.m_shape.setTotalPointCount(n)}dbgCheckPathFirst(){}isCurve(t){return this.m_shape.getSegment(t)!==null}compareVertices(t,e){let s=new y;this.m_shape.queryXY(t,s);let n=new y;return this.m_shape.queryXY(e,n),s.compare(n)}clipPolesOut(t,e){return this.clipPolygonOrProjectedPolyline2(t,e)}},Js=class{getOperatorType(){return 10004}supportsCurves(){return!0}accelerateGeometry(t,e,s){return!1}canAccelerateGeometry(t){return!1}executeMany(t,e,s,n){return new Tm(t,e,s,n)}execute(t,e,s,n){return Qf(t,e,s,n)}},Tm=class extends ns{constructor(t,e,s,n){super(),this.m_progressTracker=n,this.m_index=-1,t||U(""),this.m_envelope=e,this.m_inputGeometryCursor=t,this.m_spatialRefImpl=s,this.m_tolerance=Wt(s,e,!1).total()}next(){let t;return(t=this.m_inputGeometryCursor.next())?(ds(t),this.m_index=this.m_inputGeometryCursor.getGeometryID(),St(t,this.m_envelope,this.m_tolerance,0,this.m_progressTracker)):null}getGeometryID(){return this.m_index}tock(){return!0}getRank(){return 1}};function Qf(r,t,e,s){return Rg(r,t,e,Number.NaN,0,s)}var Kf=Sr,Nm=class extends ns{constructor(t,e,s,n,i,o){super(),this.m_densificator=new Kf(e,s,n,o,!1,i),this.m_index=-1,this.m_inputGeoms=t}tock(){return!0}getRank(){return 1}next(){let t=null;for(;t=this.m_inputGeoms.next();)return ds(t),this.m_index=this.m_inputGeoms.getGeometryID(),this.densify(t);return null}getGeometryID(){return this.m_index}densify(t){return this.m_densificator.densify(t)}},Bs=class{getOperatorType(){return 10202}accelerateGeometry(t,e,s){return!1}canAccelerateGeometry(t){return!1}supportsCurves(){return!0}executeMany(t,e,s,n,i,o=12e3){return new Nm(t,e,s,n,o,i)}execute(t,e,s,n,i,o=12e3){return Mg(t,e,s,n,i,o)}};var ta=class r{constructor(t){if(this.m_geom=this.m_sr=null,t){if(t.move)return this.m_geom=t.move.m_geom,t.move.m_geom=null,this.m_sr=t.move.m_sr,void(t.move.m_sr=null);if(t.copy)return this.m_geom=t.copy.m_geom?t.copy.m_geom.clone():null,void(this.m_sr=t.copy.m_sr);t.geom&&(this.m_geom=t.geom),t.sr&&(this.m_sr=t.sr)}}getGeometry(){return this.m_geom}getSpatialReference(){return this.m_sr}setGeometry(t){this.m_geom=t}setSpatialReference(t){this.m_sr=t}equals(t,e){let s=t;return!(!this.m_sr&&s.m_sr)&&!(this.m_sr&&!s.m_sr)&&!(!this.m_geom&&s.m_geom)&&!(this.m_geom&&!s.m_geom)&&!(this.m_sr&&s.m_sr&&!this.m_sr.equals(s.m_sr))&&!(this.m_geom&&s.m_geom&&!this.m_geom.equals(s.m_geom,e))}clone(){let t=null;return this.m_geom&&(t=this.m_geom.clone()),new r({geom:t,sr:this.m_sr})}hasGeom(){return!!this.m_geom}},ea=class{constructor(t){this.m_factor=1,this.m_wkid=0,this.m_peUnit=null,t&&(this.m_peUnit=t,this.m_factor=t.getUnitFactor(),this.m_wkid=t.getCode(),this.m_wkid<0&&(this.m_wkid=0))}getName(){return this.m_peUnit.getName()}getID(){return this.m_wkid}getConversionFactor(t){return this.getUnitType()!==t.getUnitType()&&U("unit type mismatch"),this.getUnitToBaseFactor()/t.getUnitToBaseFactor()}getUnitToBaseFactor(){return this.m_factor}getHashCode(){return ne(ps(this.getUnitType()),ps(this.getUnitToBaseFactor()))}equals(t){return!!t&&this.getUnitType()===t.getUnitType()&&this.getUnitToBaseFactor()===t.getUnitToBaseFactor()&&this.getID()===t.getID()&&this.getName()===t.getName()}static isValidWkid(t){return!1}},vt=class{assign(t){this.m_reason=t.m_reason,this.m_vertexIndex1=t.m_vertexIndex1,this.m_vertexIndex2=t.m_vertexIndex2}constructor(t,e,s){t!==void 0?(this.m_reason=t,this.m_vertexIndex1=e,this.m_vertexIndex2=s):(this.m_reason=0,this.m_vertexIndex1=-1,this.m_vertexIndex2=-2)}clear(){this.m_reason=0,this.m_vertexIndex1=-1,this.m_vertexIndex2=-1}},sa={330:104878,500:104879,1300:104899,1450:104986,2230:104988,3800:104978,5e3:104919,6200:104906,8200:104909,9500:104927,9600:104977,1e4:[104911,104936],11e3:104941,11080:104872,11100:104907,12e3:104920,12400:104995,13e3:104948,14e3:[104923,104989],15e3:[104913,104954],15100:104976,16e3:[104926,104931],18e3:[104922,104982],21e3:104947,21500:104877,27e3:[104950,104957],29e3:104964,3e4:104921,31e3:104949,33e3:104946,4e4:[104914,104967],40600:104897,41900:104937,42e3:104951,43100:104993,49300:104924,50100:104939,54e3:104955,58200:104981,59500:104930,74e3:104961,77e3:104956,79e3:104962,83500:104910,85e3:104917,88800:104934,89200:104985,96e3:104997,104e3:104963,106500:104898,11e4:104938,133e3:104932,135e3:104983,17e4:104965,198200:104987,198630:104935,208e3:104966,235800:104952,249400:104929,252100:104980,255e3:104973,47e4:104972,529800:104942,531e3:104996,56e4:104928,561400:104979,578900:104945,584700:104959,593e3:104970,606e3:104999,718e3:104933,745700:104984,761400:104953,763500:104994,764e3:104940,788900:104958,1188300:104998,1195e3:104969,1352600:104968,1560800:104874,1562090:104915,1737400:104903,1821460:104918,1821490:104876,2409300:104912,2410300:104873,2439400:104974,2439700:104900,2575e3:104943,2631200:104875,2632345:104916,3393400:104904,3396190:[104905,104971],6051e3:104901,6051800:104902,637e4:104128,6370997:[4052,37008],6371e3:4035,6371007:4047,6371228:[4053,10346],6376045:[8042,8043],6376523:[4027,4901,4902],6376896:37007,6378135:[4122,4322,4324,4720,4985,4987],6378136:[4740,4923,7678,7680,9474,9475,104017,104018],6378137:[3823,3824,3888,3889,4017,4019,4023,4031,4040,4046,4055,4074,4075,4080,4081,4121,4126,4130,4133,4140,4141,4148,4151,4152,4163,4166,4167,4170,4171,4172,4173,4176,4180,4189,4190,4258,4269,4283,4318,4319,4326,4463,4466,4469,4470,4480,4482,4483,4490,4557,4558,4612,4617,4619,4624,4627,4659,4661,4667,4669,4670,4674,4686,4687,4693,4694,4702,4737,4742,4747,4749,4750,4755,4756,4757,4758,4759,4761,4762,4763,4764,4765,4883,4885,4887,4889,4893,4895,4898,4907,4909,4921,4925,4927,4929,4931,4933,4935,4937,4939,4941,4943,4945,4947,4949,4951,4953,4955,4957,4959,4961,4963,4965,4967,4971,4975,4977,4979,4981,4983,4989,4997,4999,5012,5013,5245,5246,5251,5252,5263,5264,5323,5324,5340,5342,5353,5354,5359,5360,5364,5365,5370,5371,5372,5373,5380,5381,5392,5393,5488,5489,5545,5546,5592,5593,5885,5886,6134,6135,6310,6311,6318,6319,6321,6322,6324,6325,6364,6365,6667,6668,6705,6706,6782,6783,6980,6982,6983,6987,6989,6990,7034,7035,7036,7037,7038,7039,7040,7041,7042,7072,7073,7084,7085,7086,7087,7133,7135,7136,7138,7139,7372,7373,7657,7659,7661,7663,7665,7685,7686,7797,7798,7816,7843,7844,7880,7881,7885,7886,7900,7901,7902,7903,7904,7905,7906,7907,7908,7909,7910,7911,7912,7915,7917,7919,7921,7923,7925,7927,7929,7931,8085,8086,8231,8232,8235,8237,8239,8240,8244,8246,8248,8249,8251,8252,8254,8255,8399,8403,8426,8427,8449,8542,8544,8545,8684,8685,8698,8699,8817,8818,8860,8888,8899,8900,8901,8902,8906,8907,8916,8918,8920,8922,8924,8926,8928,8930,8932,8934,8936,8938,8940,8942,8944,8946,8948,8949,8972,8973,8974,8975,8976,8977,8978,8979,8980,8981,8982,8983,8984,8985,8986,8987,8988,8989,8990,8991,8992,8993,8994,8995,8996,8997,8998,8999,9e3,9002,9003,9005,9006,9008,9009,9011,9012,9013,9014,9016,9017,9018,9019,9053,9054,9055,9056,9057,9059,9060,9061,9062,9063,9064,9065,9066,9067,9068,9069,9071,9072,9074,9075,9139,9140,9147,9148,9152,9153,9183,9184,9293,9294,9299,9308,9309,9332,9333,9364,9372,9379,9380,9384,9453,9469,9470,9546,9547,9695,9696,9701,9702,9739,9754,9755,9758,9763,9776,9777,9778,9779,9781,9782,9783,9784,9866,9871,9939,9964,9969,9974,9989,9990,10175,10177,10178,10185,10191,10196,10204,10209,10214,10219,10224,10229,10237,10272,10277,10283,10284,10298,10299,10300,10304,10305,10307,10309,10310,10311,10312,10327,10328,10413,10414,10468,10474,10475,10570,10571,10605,10606,10623,10628,20033,20040,20041,20045,20046,104009,104010,104011,104012,104013,104014,104015,104016,104019,104020,104021,104022,104024,104027,104028,104050,104100,104107,104108,104110,104111,104114,104115,104116,104117,104118,104119,104120,104121,104122,104123,104124,104129,104133,104134,104137,104141,104142,104143,104144,104145,104179,104180,104181,104182,104183,104184,104185,104186,104199,104223,104257,104258,104259,104260,104286,104287,104602,104613,104644,104645,104646,104647,104653,104804,104896,104991],6378140:4610,6378145:[4025,4276,4760,4891,37001],6378150:37003,6378155:[37004,37207],6378160:[3821,4003,4021,4036,4202,4203,4237,4238,4291,4618,4708,5527,37231,104023,104136],6378166:37002,6378200:[4020,4229,4286,4303,4706],6378245:[4024,4147,4164,4178,4179,4191,4200,4205,4214,4284,4317,4555,4676,4677,4678,4991,4993,5560,5561,37257,104135],6378270:[4732,37005,37229],6378273:[4054,10345],6378300:[4029,4168,4174],6378388:[4022,4123,4153,4154,4158,4159,4160,4161,4165,4181,4182,4183,4184,4185,4192,4194,4195,4196,4199,4204,4207,4208,4215,4218,4221,4224,4225,4230,4231,4233,4235,4236,4247,4248,4249,4254,4255,4259,4264,4265,4271,4272,4274,4285,4287,4288,4292,4297,4309,4311,4313,4316,4472,4475,4611,4614,4615,4616,4621,4622,4623,4625,4626,4628,4629,4630,4631,4632,4633,4636,4637,4639,4641,4642,4643,4644,4645,4646,4658,4660,4662,4663,4664,4665,4668,4672,4673,4684,4688,4689,4690,4691,4692,4698,4704,4705,4707,4709,4710,4711,4712,4714,4715,4716,4718,4719,4721,4722,4724,4725,4727,4728,4729,4730,4733,4734,4735,4739,4741,4753,4754,4802,4803,4806,4809,4810,4823,4824,4900,5524,6883,8428,8430,8431,9248,9251,9253,9403,9893,10158,10249,10252,37201,37204,37205,37212,37213,37214,37215,37216,37217,37218,37219,37221,37222,37224,37226,37227,37230,37232,37233,37234,37235,37237,37238,37241,37242,37245,37246,37247,37249,37250,37251,37253,37259,104104,104106,104125,104126,104127,104130,104138,104248],6378523:104786,24764e3:104960,25559e3:104944,60268e3:104925,71492e3:104908,6957e5:104975,6377397155e-3:[3819,3906,4004,4120,4124,4125,4149,4150,4156,4162,4211,4219,4257,4262,4280,4289,4294,4295,4301,4306,4308,4312,4314,4613,4666,4745,4746,4801,4804,4805,4808,4813,4814,4815,4818,4820,4904,5132,5228,5229,5681,5830,8351,9267,10268,37255,104101,104102,104105,104131,104648,104696,104697,104990,104992],6377563396e-3:[4001,4188,4277,4278,4279],6377340189e-3:[4002,4299,4300],6377492018e-3:[4005,4273,4817],6377483865280418e-9:[4006,4293],6378293645208759e-9:[4007,4157,4302,4738,5464],63782064e-1:[4008,4127,4128,4129,4135,4136,4137,4138,4139,4169,4216,4242,4253,4267,4608,4609,4638,4675,4683,4695,4717,4723,4726,4995,5451,5467,37220,37239,37243,37252,37260,104e3,104109,104112,104113,104132],6378450047e-3:[4009,4268],6378300789e-3:[4010,4281],63782492e-1:[4011,4014,4155,4193,4206,4213,4223,4226,4227,4228,4252,4261,4266,4275,4282,4296,4304,4310,4315,4671,4807,4811,4816,4821,37223,37225,104139,104140,104261,104304],6378249145e-3:[4012,4013,4132,4134,4142,4143,4175,4197,4198,4201,4209,4210,4212,4220,4222,4232,4234,4246,4250,4251,4256,4260,4263,4270,4305,4307,4600,4601,4602,4603,4604,4605,4606,4607,4620,4679,4680,4696,4697,4699,4700,4701,4703,4713,4731,4736,4743,4744,4812,4819,6881,6882,6892,6894,8694,37206,37208,37211,37228,37240,37254,104025,104026,104103,104305],6377276345e-3:[4015,4131,4144,4239,4240,4244,4682,5233,6207,37202,104256,104664,104693],6377298556e-3:[4016,4298],6377304063e-3:[4018,4245],63782983e-1:[4028,4903],63781362e-1:4032,63781363e-1:4033,6378249144808011e-9:[4034,4241],209229318e-1:[4042,4243],6377301243e-3:[4044,4145,37203],6377299151e-3:[4045,4146],637701927e-2:[4657,10256,10260,10265],63783063696e-4:[4748,4752],6377295664e-3:[4751,37006],63781365e-1:[7682,7683],63710087714e-4:104047,6378418941e-3:[104700,104726,104760],6378586581e-3:[104701,104743],6378505809e-3:104702,6378544823e-3:104703,6378490569e-3:104704,6378470757e-3:[104705,104776],6378403701e-3:[104706,104750],6378434181e-3:[104707,104724,104739,104764],6378454907e-3:104708,6378400653e-3:104709,6378567378e-3:104710,6378546957e-3:[104711,104717,104780],6378476853e-3:[104712,104736],6378411321e-3:[104713,104728],6378647541e-3:[104714,104715],6378514953e-3:[104716,104782],6378421989e-3:[104718,104770],6378481425e-3:[104719,104753,104774,104781],6378518001e-3:[104720,104725],6378521049e-3:[104721,104723,104731,104745,104748],6378464661e-3:104722,6378436619e-3:104727,6378574389e-3:[104729,104730],6378472281e-3:[104732,104756],6378498189e-3:[104733,104746],6378449421e-3:[104734,104766],6378525621e-3:[104735,104754],6378466185e-3:104737,6378496665e-3:104738,6378643579e-3:104740,6378559758e-3:104741,6378414369e-3:[104742,104763,104772],6378441801e-3:104744,6378502761e-3:[104747,104759,104773,104775],6378617061e-3:104749,6378624681e-3:[104751,104765],6378468623e-3:104752,6378445763e-3:[104755,104758,104761],6378670401e-3:104757,6378438753e-3:104762,6378543909e-3:104767,6378605783e-3:104768,6378540861e-3:104769,6378443325e-3:[104771,104784],6378548481e-3:104777,6378463746e-3:104778,6378426561e-3:104779,6378453688e-3:104783,6378530193e-3:104785,6378376271e-3:[104800,104828],637847192e-2:104801,6378472931e-3:104802,6378411351e-3:104803,6378380991e-3:104805,637841496e-2:104806,637834509e-2:[104807,104819,104844,104870],6378412542e-3:104808,6378470401e-3:104809,6378376331e-3:104810,6378379031e-3:104811,6378407621e-3:104812,6378376811e-3:[104813,104827],637831392e-2:104814,637841493e-2:104815,6378413021e-3:104816,6378380381e-3:104817,6378530851e-3:104818,6378591521e-3:104820,6378378881e-3:104821,6378408481e-3:[104822,104832],6378375601e-3:[104823,104838],6378408041e-3:104824,6378655071e-3:104825,6378409151e-3:104826,63783157e-1:[104829,104840,104845,104851],637828586e-2:[104830,104835,104859],6378379301e-3:104831,6378560121e-3:104833,6378531821e-3:104834,63785006e-1:104836,6378376041e-3:104837,6378406601e-3:104839,6378438991e-3:104841,637834542e-2:104842,637859386e-2:104843,6378381271e-3:[104846,104847],6378413671e-3:104848,6378344377e-3:104849,6378563891e-3:104850,6378408091e-3:104852,6378377671e-3:104853,6378472751e-3:104854,6378412511e-3:104855,6378407281e-3:104856,6378534451e-3:104857,6378406051e-3:104858,6378532921e-3:104860,6378380091e-3:104861,6378408941e-3:104862,6378624171e-3:104863,6378377411e-3:104864,6378474591e-3:104865,6378407141e-3:104866,6378376871e-3:104867,6378375251e-3:104868,6378405971e-3:104869,6378437651e-3:104871};function $f(){for(let r in sa)delete sa[r]}var On=class extends ea{constructor(t){if(typeof t=="number")return super(),this.m_factor=t,void(this.m_wkid=0);super(t)}getUnitType(){return 1}convertFromRadians(t){return t/this.getUnitToBaseFactor()}convertToRadians(t){return t*this.getUnitToBaseFactor()}};function jE(r){return new Fs}function Jf(r){return r.getType()===tt.PE_TYPE_LINUNIT?new Fs(r):r.getType()===tt.PE_TYPE_ANGUNIT?new On(r):void U("peUnit")}function t1(r){let t=Ni(null);return r.getType()===tt.PE_TYPE_PROJCS||r.getType()===tt.PE_TYPE_GEOGCS?t.reset(r.getUnit()):U("PE_coord_sys"),t.get()||j("cannot create units from coord sys"),Jf(t.get())}var Zm=class r{constructor(t,e,s){t===void 0?(this.x=new H,this.y=new H,this.z=new H):t instanceof ot?(this.x=new H(t.x),this.y=new H(t.y),this.z=new H(t.z)):t instanceof H?(this.x=t.clone(),this.y=e.clone(),this.z=s.clone()):U("EPoint3D constructor")}dotProduct(t){return this.x.mulE(t.x).addE(this.y.mulE(t.y)).addE(this.z.mulE(t.z))}crossProduct(t){return new r(this.y.mulE(t.z).subE(this.z.mulE(t.y)),this.z.mulE(t.x).subE(this.x.mulE(t.z)),this.x.mulE(t.y).subE(this.y.mulE(t.x)))}crossProductVector(t){let e=this.y.mulE(t.z).subE(t.y.mulE(this.z)),s=t.x.mulE(this.z).subE(this.x.mulE(t.z)),n=this.x.mulE(t.y).subE(t.x.mulE(this.y));return new r(e,s,n)}sqrLength(){return this.x.mulE(this.x).addE(this.y.mulE(this.y)).addE(this.z.mulE(this.z))}length(){return this.sqrLength().sqrt()}static distance(t,e){return t.sub(e).length()}negate(){return new r(this.x.negate(),this.y.negate(),this.z.negate())}add(t){return new r(this.x.addE(t.x),this.y.addE(t.y),this.z.addE(t.z))}sub(t){return new r(this.x.subE(t.x),this.y.subE(t.y),this.z.subE(t.z))}subThis(t){return this.x.subThisE(t.x),this.y.subThisE(t.y),this.z.subThisE(t.z),this}addThis(t){return this.x.addThisE(t.x),this.y.addThisE(t.y),this.z.addThisE(t.z),this}mul(t){return new r(this.x.mulE(t),this.y.mulE(t),this.z.mulE(t))}div(t){return new r(this.x.divE(t),this.y.divE(t),this.z.divE(t))}eq(t){return this.x.eq(t.x)&&this.y.eq(t.y)&&this.z.eq(t.z)}isZero(){return this.x.isZero()&&this.y.isZero()&&this.z.isZero()}value(){return ot.construct(this.x.value(),this.y.value(),this.z.value())}},Qm=class{constructor(t){if(this.m_origin=new ot,this.m_normal=new ot,this.m_axisX=new ot,this.m_axisY=new ot,!t)return this.m_origin=new ot,this.m_normal=new ot(0,0,1),this.m_axisX=new ot(1,0,0),void(this.m_axisY=new ot(0,1,0));t.pt0&&t.pt1&&t.pt2?this.setFromPoints(t.pt0,t.pt1,t.pt2):w(0,`unimplemented constructor options ${JSON.stringify(t)}`)}assign(t){return w(0),this}set(t,e,s,n){w(0)}setFromPoints(t,e,s){let n=e.sub(t),i=s.sub(t);this.m_normal=n.crossProductVector(i);let o=!0;if(this.m_normal.isZero()){if(o=!1,n.isZero()&&(n=i),n.isZero())return this.m_normal.setCoords(0,0,1),this.m_axisX.setCoords(1,0,0),this.m_axisY.setCoords(0,1,0),this.m_origin=t,!1;this.m_axisX=n.getUnitVector(),this.m_normal=this.m_axisX.createAPerpendicular()}else this.m_normal.normalizeThis(),this.m_axisX=n.getUnitVector();return this.m_axisY=this.m_normal.crossProductVector(this.m_axisX),this.m_origin=t,o}getCoord(t,e){return w(0),{}}getCoord2D(t){return w(0),{}}getCoordX(t,e){return w(0),0}getCoordY(t,e){return w(0),0}getCoordZ(t,e){return w(0),0}setPreferredAxisX(t){w(0)}getOrigin(){return w(0),{}}getNormal(){return w(0),{}}getAxisX(){return this.m_axisX.clone()}getAxisY(){return this.m_axisY.clone()}setAxisX(t,e=!1){w(0)}setAxisY(t,e=!1){w(0)}recalculateAxisY(){w(0)}setOrigin(t){w(0)}setNormal(t,e){w(0)}intersect(t,e){return w(0),!1}intersectLine(t){return w(0),0}intersectLineEx(t,e){return w(0),0}closestCoordinate(t){let e=t.sub(this.m_origin),s=new y;return s.x=e.dotProduct(this.m_axisX),s.y=e.dotProduct(this.m_axisY),s}projectVector(t){return w(0),{}}signedDistance(t){return w(0),0}distance(t){return w(0),0}};function e1(r,t){return!1}function jd(r,t,e,s,n=100,i=e1){let o,a,h,m,l,u,c,g,d;w(s>0);let _,p,f,x=0,C=0,P=Ri();t>e&&(e=O(t,t=e));let E=r(t),S=r(e);E<S?(o=a=h=t,m=l=u=E):(o=a=h=e,m=l=u=S);let I=0;for(;I<n&&(f=.5*(e-t),d=t+f,_=s*(Math.abs(o)+.25),p=2*_,!(i(o,m)||Math.abs(o-d)<=p-f));++I){if(Math.abs(C)>_){let D=(o-a)*(m-u),b=(o-h)*(m-l),T=(o-h)*b-(o-a)*D;b=2*(b-D),b>0&&(T=-T),b=Math.abs(b);let A=C;C=x,Math.abs(T)>=Math.abs(b*A*.5)||T<=b*(t-o)||T>=b*(e-o)?(C=o>=d?t-o:e-o,x=Ri()*C):(x=T/b,g=o+x,(g-t<p||e-g<p)&&(x=d-o<0?-Math.abs(_):Math.abs(_)))}else C=o>=d?t-o:e-o,x=C*P;g=o+x,c=r(g),c<m?(g>=o?t=o:e=o,h=a,a=o,o=g,u=l,l=m,m=c):(g<o?t=g:e=g,c<=l||a===o?(h=a,a=g,u=l,l=c):(c<=u||h===o||h===a)&&(h=g,u=c))}return Kt(o,m)}function Km(r,t,e){return r>e?r-=Math.ceil((r-e)/Yi)*Yi:r<t&&(r+=Math.ceil((t-r)/Yi)*Yi),r}function ie(r,t,e){return s1(r,t,e,0)}function s1(r,t,e,s){let n=e.x,i=e.y;return Zd(r,t,Math.cos(n),Math.sin(n),Math.cos(i),Math.sin(i),s)}function n1(r,t,e,s,n,i){return Zd(r,t,e,s,n,i,0)}function Zd(r,t,e,s,n,i,o){let a=r/Math.sqrt(1-t*i*i),h=a+o,m=h*n*e,l=h*n*s,u=(a*(1-t)+o)*i;return ot.construct(m,l,u)}function na(r,t,e){let s=new H,n=new H,i=new H,o=new H;s.setCos(e.x),n.setSin(e.x),i.setCos(e.y),o.setSin(e.y);let a=o.negate().mulE(o.mul(t)).add(1).sqrt(),h=new H(r).divE(a),m=h.mulE(i).mulE(s),l=h.mulE(i).mulE(n),u=h.mul(1-t).mulE(o);return new Zm(m,l,u)}function Vr(r,t,e){let s=e.x,n=e.y,i=e.z,o=Math.atan2(n,s),a=Math.sqrt(s*s+n*n),h=Math.atan2(i,(1-t)*a);return y.construct(o,h)}function Gr(r,t,e){let s=1-t,n=r/Math.sqrt(Et(e.x)+Et(e.y)+Et(e.z)/s);return e.mul(n)}function i1(r,t,e,s,n){let i=ie(r,t,e),o=ie(r,t,s);return Vr(r,t,ot.lerp(i,o,n))}function Lg(r,t,e){let s=new ot;return s.setCrossProductVector(t,e),Math.abs(Math.atan2(s.length(),t.dotProduct(e)))*r}function ZE(r,t,e,s,n){let i=e.getUnitVector(),o=s.getUnitVector(),a=t.getUnitVector(),h=new ot;if(h.setCrossProductVector(i,o),!h.isZero()){h.normalizeThis();let u=a.sub(h.mul(h.dotProduct(a)));if(!u.isZero()){u.normalizeThis();let c=i.add(o).mul(.5);if(c.dotProduct(u)>c.dotProduct(i)){let g=Math.abs(h.dotProduct(a)),d=Math.asin(g);return n.assign(u.getUnitVector().mul(r)),d*r}}}let m=Lg(1,i,a),l=Lg(1,o,a);return m<=l?(n.assign(e),m*r):(n.assign(s),l*r)}function r1(r,t,e,s){let n={stack:[],error:void 0,hasError:!1};try{let i=xe(n,new ve,!1);return ts.geodeticDistance(r,t,e.x,e.y,s.x,s.y,i,null,null,tt.PE_LINETYPE_GEODESIC),i.val}catch(i){n.error=i,n.hasError=!0}finally{qs(n)}}function o1(r,t,e,s,n){switch(w(e.isFinite()&&s.isFinite()),n){case 0:return r1(r,t,e,s);case 1:return h1(r,t,e);case 2:case 3:{let i=ie(r,t,e),o=ie(r,t,s);return ot.distance(i,o)}default:ft("")}}function Ho(r,t,e,s,n,i=0,o){if(i===2||i===3)return a1(r,t,e,s,n,i===3,o);let a=Vr(r,t,e),h=l=>{let u=Vr(r,t,ot.lerp(s,n,l));return o1(r,t,a,u,i)},m=ot.distance(s,n);if(m>0){let l=Kd(r,m),{first:u,second:c}=jd(h,0,1,l);return o&&o.assign(Gr(r,t,ot.lerp(s,n,u))),Kt(u,c)}{let l=h(0);return o&&o.assign(s),Kt(.5,l)}}function a1(r,t,e,s,n,i=!1,o){let a=Gr(r,t,e);if(i){let l=new Qm({pt0:new ot(0,0,0),pt1:s,pt2:n}),u=l.closestCoordinate(e),c=l.closestCoordinate(s),g=l.closestCoordinate(n),d=y.getClosestCoordinate(c,g,u),_=Gr(r,t,ot.lerp(s,n,d)),p=ot.distance(_,a);return o&&o.assign(_),Kt(d,p)}let h=l=>{let u=Gr(r,t,ot.lerp(s,n,l));return ot.distance(u,a)},m=ot.distance(s,n);if(m>0){let l=Kd(r,m),{first:u,second:c}=jd(h,0,1,l);return o&&o.assign(Gr(r,t,ot.lerp(s,n,u))),Kt(u,c)}{let l=ot.distance(e,s);return o&&o.assign(e),Kt(.5,l)}}function h1(r,t,e,s){let n={stack:[],error:void 0,hasError:!1};try{let i=xe(n,new ve,!1);return ts.greatEllipticDistance(r,t,e.x,e.y,e.x,e.y,i,null,null),i.val}catch(i){n.error=i,n.hasError=!0}finally{qs(n)}}function m1(r,t,e,s,n){if(Math.abs(e.x-s.x)>Math.PI||Math.abs(e.y)>ut||Math.abs(s.y)>ut||(Math.abs(e.y)===ut||Math.abs(s.y)===ut)&&e.x!==s.x)return Number.NaN;let{first:i,second:o}=cu(e.x,s.x),a=n;if(a=Km(a,i,o),!B.construct(e.x,s.x).containsCoordinate(a))return Number.NaN;let h=$.constructPoint2D(e),m=$.constructPoint2D(s),l=na(1,t,h),u=na(1,t,m),c=l.crossProductVector(u);if(c.z.isZero())return e.y;let g=c.x.divE(c.z.negate()),d=c.y.divE(c.z.negate()),_=g.mulE(g).addE(d.mulE(d)).sqrt();if(_.isZero()||g.isZero()&&d.isZero())return e.y;let p=Math.atan2(d.value(),g.value()),f=Math.atan2(_.value()*Math.cos(p-a),1-t),x=ie(1,t,y.construct(a,f)),C=ot.construct(x.x,x.y,-x.z),P=c.value().dotProduct(x),E=c.value().dotProduct(C);return Math.abs(E)<Math.abs(P)&&(f=-f),f}function Qd(r,t,e,s,n,i){if(i[0]=Number.NaN,i[1]=Number.NaN,Math.abs(e.x-s.x)>Math.PI||Math.abs(e.y)>ut||Math.abs(s.y)>ut||(Math.abs(e.y)===ut||Math.abs(s.y)===ut)&&e.x!==s.x||Math.abs(n)>=ut||e.y>0&&s.y>0&&e.y>n&&s.y>n||e.y<0&&s.y<0&&e.y<n&&s.y<n)return 0;let o=$.constructPoint2D(e),a=$.constructPoint2D(s),h=na(1,t,o),m=na(1,t,a),l=h.crossProductVector(m);if(l.z.isZero())return B.construct(e.y,s.y).containsCoordinate(n)?(i[0]=e.x,1):0;let u=l.x.divE(l.z.negate()),c=l.y.divE(l.z.negate()),g=u.mulE(u).addE(c.mulE(c)).sqrt();if(g.isZero()||u.isZero()&&c.isZero())return n===0?(i[0]=e.x,i[1]=s.x,2):0;let d=(1-t)*Math.tan(n)/g.value();if(Math.abs(d)>1)return 0;let _=Math.acos(d),p=Math.atan2(c.value(),u.value()),f=p-_,x=p+_,C=Math.min(e.x,s.x),P=Math.max(e.x,s.x);Km(f,C,P),n!==0?Km(x,C,P):x=f;let E=0;return C<=f&&f<=P&&(i[E]=f,E++),x!==f&&C<=x&&x<=P&&(i[E]=x,E++),E}function Bg(r,t){t[0]>.5*Math.PI?(r[0]+=Math.PI,t[0]=Math.PI-t[0]):t[0]<.5*-Math.PI&&(r[0]-=Math.PI,t[0]=-Math.PI-t[0]),w(t[0]>=.5*-Math.PI&&t[0]<=.5*Math.PI)}function l1(r,t){return r*Math.sqrt(1-t)}function u1(r){return 1-r}function QE(r,t,e,s,n){s=Tt(s,-ut,ut),n=Tt(n,-ut,ut);let i=ut-.03,o;return o=s>i&&n>i||s<-i&&n<-i?c1(r,s,n):Ug(r,n)-Ug(r,s),.5*(e-t)*o*u1(r)}function c1(r,t,e){let s=1;if(t<0&&(s=-1,t=-t,e=-e),r!==0){let n=r*r,i=n*r,o=[1,(1+11*r)/12,(1+118*r+241*n)/360,(1+1089*r+10419*n+8651*i)/20160,(1+9836*r+318246*n+1027436*i+458881*(i*r))/1814400],a=m=>{let l=0,u=Et(m)/(r-1);for(let c=o.length-1;c>=0;--c)l=o[c]+l*u;return l*=-Et(m/(1-r)),l},h=a(ut-t);return(a(ut-e)-h)*s}{let n=ut-t,i=ut-e,o=-4*Et(Math.sin(n/2));return(-4*Et(Math.sin(i/2))-o)*s}}function Ug(r,t){if(t===0)return 0;let e=Math.sin(t),s=e,n=e;if(r!==0){s/=1-r*e*e;let i=Math.sqrt(r);n=e*uu(i*e)}return s+n}function KE(r,t){return r/Math.sqrt(1-t)}function g1(r,t){return(1-t)*r}function d1(r,t,e){let s=e/(2*g1(r,t)),n=s*s;return e*(1-n*(.16666666666666666-.008333333333333333*n))}function Kd(r,t){if(t!==0){let e=r*Pu()/t;return Math.min(e,1e-10)}return 0}var ia=class r{constructor(t){this.m_currentShift=63n,this.m_currentElt=0n,this.m_iCurrentElt=-1,this.m_parent=t,this.m_aiSetElts=t.m_bits.flatMap((e,s)=>s)}next(){if(this.m_currentShift++,this.m_currentShift===64n){if(this.m_iCurrentElt++,this.m_iCurrentElt===this.m_aiSetElts.length)return r.npos();this.m_currentShift=0n,this.m_currentElt=this.m_parent.m_bits[this.m_aiSetElts[this.m_iCurrentElt]]}for(;this.m_currentShift<63n&&!(this.m_currentElt&1n<<this.m_currentShift);)this.m_currentShift++;return this.m_currentElt&1n<<this.m_currentShift?64*this.m_aiSetElts[this.m_iCurrentElt]+Number(this.m_currentShift):this.next()}static npos(){return Number.MAX_SAFE_INTEGER}};function Am(r){return 1n<<(0x3fn&BigInt(r))}function Mm(r){return r>>6}var ls=class{constructor(t){this.m_bits=[],t!==void 0&&t.copy&&(this.m_bits=t.copy.m_bits.slice())}assignMove(){return this}assignCopy(){return this}hasBit(t){let e=Am(t),s=Mm(t);return this.m_bits[s]!==void 0&&!!(this.m_bits[s]&e)}setBit(t){let e=Am(t),s=Mm(t);this.m_bits[s]===void 0&&(this.m_bits[s]=0n),this.m_bits[s]|=e}clearBit(t){}flipBit(t){let e=Am(t),s=Mm(t);return this.m_bits[s]===void 0&&(this.m_bits[s]=0n),this.m_bits[s]^=e,(this.m_bits[s]&e)!==0n}clear(){this.m_bits.length=0}isZero(){let t=0;return this.m_bits.forEach(e=>{t|=e?2:1}),!(2&t)}equals(t){if(this===t)return!0;if(this.m_bits.length!==t.m_bits.length)return!1;let e=0;return this.m_bits.forEach((s,n)=>{e|=s===t.m_bits[n]?2:1}),!(1&e)&&(t.m_bits.forEach((s,n)=>{e|=s===this.m_bits[n]?2:1}),!(1&e))}notEquals(t){return!this.equals(t)}assignOr(t){return t.m_bits.forEach((e,s)=>{this.m_bits[s]===void 0?this.m_bits[s]=e:this.m_bits[s]|=e}),this}assignSubtract(t){return t.m_bits.forEach((e,s)=>{this.m_bits[s]!==void 0&&(this.m_bits[s]&=~e)}),this}assignAnd(t){return t.m_bits.forEach((e,s)=>{this.m_bits[s]!==void 0&&(this.m_bits[s]&=e)}),this}assignXor(t){return t.m_bits.forEach((e,s)=>{this.m_bits[s]===void 0?this.m_bits[s]=e:this.m_bits[s]^=e}),this}getHashCode(){return this.m_bits.reduce((t,e)=>Su(t,e),ps(0))}getUnorderedBitIterator(){return new ia(this)}},$m=class{constructor(t,e){this.m_map=new Map,this.m_hf=t,this.m_ef=e}add(t){let e=this.m_hf(t);if(!this.m_map.has(e))return this.m_map.set(e,t),this;let s=this.m_map.get(e);return s instanceof Array?s.find(n=>this.m_ef(n,t))||s.push(t):this.m_ef(s,t)||this.m_map.set(e,[s,t]),this}clear(){this.m_map.clear()}delete(t){return!1}has(t){let e=this.m_hf(t);if(!this.m_map.has(e))return!1;let s=this.m_map.get(e);return s instanceof Array?s.find(n=>this.m_ef(n,t))!==void 0:this.m_ef(s,t)}get(t){let e=this.m_hf(t),s=this.m_map.get(e);if(s!==void 0)return s instanceof Array?s.find(n=>this.m_ef(n,t)):s}get size(){let t=0;for(let e of this.m_map.values())t+=e instanceof Array?e.length:1;return t}forEach(t,e){}[Symbol.iterator](){return new Set()[Symbol.iterator]()}entries(){return new Set().entries()}keys(){return new Set().keys()}values(){return new Set().values()}get[Symbol.toStringTag](){return"ValueSet"}},Jm=class extends Gn{constructor(t){super(),this.m_bufferLeft=new et,this.m_bufferRight=new et,this.m_intervalLeft=B.constructEmpty(),this.m_intervalRight=B.constructEmpty(),this.m_yScanline=Number.NaN,this.m_helper=t}compare(t,e,s){let n=e,i=t.getElement(s);this.m_helper.querySegmentXY(n,this.m_bufferLeft),this.m_helper.querySegmentXY(i,this.m_bufferRight);let o=this.m_bufferLeft.get(),a=this.m_bufferRight.get();if(this.m_intervalLeft.setCoords(o.getStartX(),o.getEndX()),this.m_intervalRight.setCoords(a.getStartX(),a.getEndX()),this.m_intervalLeft.vmax<this.m_intervalRight.vmin)return-1;if(this.m_intervalLeft.vmin>this.m_intervalRight.vmax)return 1;let h=o.getStartY()===o.getEndY(),m=a.getStartY()===a.getEndY();if(h||m){if(h&&m)return 0;if(o.getStartY()===a.getStartY()&&o.getStartX()===a.getStartX())return h?1:-1;if(o.getEndY()===a.getEndY()&&o.getEndX()===a.getEndX())return h?-1:1}let l=o.intersectionOfYMonotonicWithAxisX(this.m_yScanline,this.m_intervalLeft.vmin),u=a.intersectionOfYMonotonicWithAxisX(this.m_yScanline,this.m_intervalRight.vmin);if(l===u){let c=o.getEndY(),g=a.getEndY(),d=Math.min(c,g),_=.5*(d+this.m_yScanline);_===this.m_yScanline&&(_=d),l=o.intersectionOfYMonotonicWithAxisX(_,this.m_intervalLeft.vmin),u=a.intersectionOfYMonotonicWithAxisX(_,this.m_intervalRight.vmin)}return l<u?-1:l>u?1:0}setY(t){this.m_yScanline=t}},tl=class{constructor(t){this.m_segmentBuffer=new et,this.m_point=y.getNAN(),this.m_parent=t}setPointXY(t){this.m_point.assign(t)}compare(t,e){let s=t.getElement(e);this.m_parent.querySegmentXY(s,this.m_segmentBuffer);let n=this.m_segmentBuffer.get(),i=new B;if(i.setCoords(n.getStartX(),n.getEndX()),this.m_point.x<i.vmin)return-1;if(this.m_point.x>i.vmax)return 1;let o=n.intersectionOfYMonotonicWithAxisX(this.m_point.y,this.m_point.x);return this.m_point.x<o?-1:this.m_point.x>o?1:0}},be,En;function zg(r,t){return{parentage:r,rank:t}}function _1(r,t){let e=r.length;if(e!==t.length)return!1;let s=r[0].parentage;if(s!==t[0].parentage)return!1;if(s===-1)return!0;for(let n=1;n<e;++n)if(r[n].parentage!==t[n].parentage)return!1;return!0}function Og(r,t,e){e.length=0;let s=!1;{let n=r.getHalfEdgeVertexIterator(t);for(;n!==v;){let i=r.getVertexFromVertexIterator(n),o=r.getShape().getSegmentRank(i),a=r.getShape().getSegmentParentage(i);s||=a>=0,e.push(zg(a,o)),n=r.incrementVertexIterator(n)}}{let n=r.getHalfEdgeVertexIterator(r.getHalfEdgeTwin(t));for(;n!==v;){let i=r.getVertexFromVertexIterator(n),o=r.getShape().getSegmentRank(i),a=r.getShape().getSegmentParentage(i);s||=a>=0,e.push(zg(a,o)),n=r.incrementVertexIterator(n)}}s&&e.sort((n,i)=>n.rank>i.rank?-1:n.rank<i.rank?1:n.parentage<i.parentage?-1:n.parentage>i.parentage?1:0),e[0].parentage===-1&&(e.length=1)}function p1(){return new $m(r=>r.getHashCode(),(r,t)=>r.equals(t))}(function(r){r[r.enumInputModeBuildGraph=0]="enumInputModeBuildGraph",r[r.enumInputModeSimplifyAlternate=1]="enumInputModeSimplifyAlternate",r[r.enumInputModeSimplifyWinding=2]="enumInputModeSimplifyWinding"})(be||(be={})),function(r){r[r.enumSegmentParentageBreakNode=1]="enumSegmentParentageBreakNode",r[r.enumPathBreakNode=2]="enumPathBreakNode"}(En||(En={}));var As=class r{constructor(){this.m_shape=null,this.m_clusterData=new Rt(8),this.m_clusterVertices=new Rt(2),this.m_firstCluster=v,this.m_lastCluster=v,this.m_halfEdgeData=new Rt(8),this.m_chainData=new Rt(8),this.m_chainAreas=null,this.m_chainPerimeters=null,this.m_universeChain=-1,this.m_simplifiedGeometry=-1,this.m_edgeIndices=[],this.m_clusterIndices=[],this.m_chainIndices=[],this.m_bBuildGeometryParentageSets=!1,this.m_chainBitSetIndex=-1,this.m_edgeBitSetIndex=-1,this.m_edgeBitSetIndexLeft=-1,this.m_emptyBitSet=null,this.m_geometryMapID=null,this.m_uniqueBitSets=null,this.m_chainBitSets=[],this.m_edgeBitSets=[],this.m_checkDirtyPlanesweepTolerance=Number.NaN,this.m_geometryIDIndex=-1,this.m_clusterIndex=-1,this.m_halfEdgeIndex=-1,this.m_tmpHalfEdgeParentageIndex=-1,this.m_tmpHalfEdgeParentageIndexLeft=-1,this.m_tmpHalfEdgeWindingNumberIndex=-1,this.m_tmpHalfEdgeOddEvenNumberIndex=-1,this.m_segmentParentageIndex=-1,this.m_segmentIndexHe=-1,this.m_clusterBreakNodeIndex=-1,this.m_universeGeomID=-1,this.m_pointCount=0,this.m_progressCounter=0,this.m_bBuildChains=!0,this.m_bDirtyCheckFailed=!1}setCheckDirtyPlanesweepTolerance(t){this.m_checkDirtyPlanesweepTolerance=t}dirtyCheckFailed(){return this.m_bDirtyCheckFailed}getShape(){return this.m_shape}setEditShape(t,e,s=!0,n=!1){n?this.setEditShapeImpl3D_(t,be.enumInputModeBuildGraph,null,e,!1):this.setEditShapeImpl_(t,be.enumInputModeBuildGraph,null,e,s)}setAndSimplifyEditShapeAlternate(t,e,s=null,n=!1){let i=[];i.push(e),this.m_simplifiedGeometry=e,n?this.setEditShapeImpl3D_(t,be.enumInputModeSimplifyAlternate,i,s,!1):this.setEditShapeImpl_(t,be.enumInputModeSimplifyAlternate,i,s,t.getGeometryType(e)===N.enumPolygon)}setAndSimplifyEditShapeWinding(t,e,s=null){let n=[];n.push(e),this.m_simplifiedGeometry=e,this.setEditShapeImpl_(t,be.enumInputModeSimplifyWinding,n,s,!0)}removeShape(){this.m_shape!==null&&(this.m_geometryIDIndex!==-1&&(this.m_shape.removeGeometryUserIndex(this.m_geometryIDIndex),this.m_geometryIDIndex=-1),this.m_clusterIndex!==-1&&(this.m_shape.removeUserIndex(this.m_clusterIndex),this.m_clusterIndex=-1),this.m_halfEdgeIndex!==-1&&(this.m_shape.removeUserIndex(this.m_halfEdgeIndex),this.m_halfEdgeIndex=-1),this.m_tmpHalfEdgeParentageIndex!==-1&&(this.deleteUserIndexForHalfEdges(this.m_tmpHalfEdgeParentageIndex),this.m_tmpHalfEdgeParentageIndex=-1),this.m_tmpHalfEdgeParentageIndexLeft!==-1&&(this.deleteUserIndexForHalfEdges(this.m_tmpHalfEdgeParentageIndexLeft),this.m_tmpHalfEdgeParentageIndexLeft=-1),this.m_tmpHalfEdgeWindingNumberIndex!==-1&&(this.deleteUserIndexForHalfEdges(this.m_tmpHalfEdgeWindingNumberIndex),this.m_tmpHalfEdgeWindingNumberIndex=-1),this.m_tmpHalfEdgeOddEvenNumberIndex!==-1&&(this.deleteUserIndexForHalfEdges(this.m_tmpHalfEdgeOddEvenNumberIndex),this.m_tmpHalfEdgeOddEvenNumberIndex=-1),this.m_segmentParentageIndex!==-1&&(this.deleteUserIndexForHalfEdges(this.m_segmentParentageIndex),this.m_segmentParentageIndex=-1),this.m_segmentIndexHe!==-1&&(this.deleteUserIndexForHalfEdges(this.m_segmentIndexHe),this.m_segmentIndexHe=-1),this.m_clusterBreakNodeIndex!==-1&&(this.deleteUserIndexForClusters(this.m_clusterBreakNodeIndex),this.m_clusterBreakNodeIndex=-1),this.deleteEdgeBitSets_(),this.deleteChainBitSets_(),this.m_emptyBitSet=null,this.m_geometryMapID=null,this.m_shape=null,this.m_clusterData.deleteAll(!0),this.m_clusterVertices.deleteAll(!0),this.m_firstCluster=v,this.m_lastCluster=v,this.m_halfEdgeData.deleteAll(!0),this.m_edgeIndices.length=0,this.m_clusterIndices.length=0,this.m_chainIndices.length=0,this.m_chainData.deleteAll(!0),this.m_universeChain=v,this.m_chainAreas=null)}getClusterHalfEdge(t){return this.m_clusterData.getField(t,2)}queryXY(t,e){let s=this.getClusterVertexIndex_(t);e.assign(this.m_shape.getXYWithIndex(s))}queryXYZ(t,e){w(0)}getClusterParentage(t){return this.m_clusterData.getField(t,1)}getFirstCluster(){return this.m_firstCluster}getPrevCluster(t){return this.m_clusterData.getField(t,3)}getNextCluster(t){return this.m_clusterData.getField(t,4)}getClusterChain(t){return this.m_clusterData.getField(t,6)}getClusterVertexIterator(t){return this.m_clusterData.getField(t,7)}incrementVertexIterator(t){return this.m_clusterVertices.getField(t,1)}getVertexFromVertexIterator(t){return this.m_clusterVertices.getField(t,0)}getClusterUserIndex(t,e){let s=this.getClusterIndex_(t),n=this.m_clusterIndices[e];return n.size()<=s?-1:n.read(s)}setClusterUserIndex(t,e,s){let n=this.getClusterIndex_(t),i=this.m_clusterIndices[e];i.size()<=n&&i.resize(this.m_clusterData.size(),-1),i.write(n,s)}hasClusterUserIndexFlags(t,e,s){if(e===-1)return!1;let n=this.getClusterUserIndex(t,e);return n!==-1&&!!(s&n)}setClusterUserIndexFlags(t,e,s){let n=this.getClusterIndex_(t),i=this.m_clusterIndices[e];i.size()<=n&&i.resize(this.m_clusterData.size(),-1);let o=i.read(n);o===-1&&(o=0),i.write(n,s|o)}clearClusterUserIndexFlags(t,e,s){let n=this.getClusterIndex_(t),i=this.m_clusterIndices[e];i.size()<=n&&i.resize(this.m_clusterData.size(),-1);let o=i.read(n);o===-1&&(o=0),i.write(n,~s&o)}createUserIndexForClusters(t=-1){let e=new he(this.m_clusterData.capacity(),t);for(let s=0,n=this.m_clusterIndices.length;s<n;s++)if(this.m_clusterIndices[s]===null)return this.m_clusterIndices[s]=e,s;return this.m_clusterIndices.push(e),this.m_clusterIndices.length-1}deleteUserIndexForClusters(t){this.m_clusterIndices[t]=null}getHalfEdgeOrigin(t){return this.m_halfEdgeData.getField(t,1)}getHalfEdgeTo(t){return this.getHalfEdgeOrigin(this.getHalfEdgeTwin(t))}getHalfEdgeTwin(t){return this.m_halfEdgeData.getField(t,4)}getHalfEdgePrev(t){return this.m_halfEdgeData.getField(t,5)}getHalfEdgeNext(t){return this.m_halfEdgeData.getField(t,6)}getHalfEdgeChain(t){return this.m_halfEdgeData.getField(t,2)}getHalfEdgeFaceParentage(t){return this.getChainParentage(this.getHalfEdgeChain(t))}getHalfEdgeVertexIterator(t){return this.m_halfEdgeData.getField(t,7)}getHalfEdgeFromXY(t,e){this.queryXY(this.getHalfEdgeOrigin(t),e)}getHalfEdgeToXY(t,e){this.queryXY(this.getHalfEdgeTo(t),e)}isHalfEdgeCurve(t){return this.m_segmentIndexHe!==-1?this.getHalfEdgeUserIndex(t,this.m_segmentIndexHe)!==-1:!1}getHalfEdgeFromXYZ(t,e){w(0)}getHalfEdgeToXYZ(t,e){w(0)}getHalfEdgeParentage(t){return this.m_halfEdgeData.getField(t,3)&r.c_EdgeParentageMask}getHalfEdgeUserIndex(t,e){let s=this.getHalfEdgeIndex_(t),n=this.m_edgeIndices[e];return n.size()<=s?-1:n.read(s)}setHalfEdgeUserIndex(t,e,s){let n=this.getHalfEdgeIndex_(t),i=this.m_edgeIndices[e];i.size()<=n&&i.resize(this.m_halfEdgeData.size(),-1),i.write(n,s)}createUserIndexForHalfEdges(t){t===void 0&&(t=-1);let e=new he(this.m_halfEdgeData.capacity(),t);for(let n=0,i=this.m_edgeIndices.length;n<i;n++)if(this.m_edgeIndices[n]===null)return this.m_edgeIndices[n]=e,n;this.m_edgeIndices.push(e);let s=this.m_edgeIndices.length-1;return w(s>=0&&s<=Number.MAX_SAFE_INTEGER),s}deleteUserIndexForHalfEdges(t){this.m_edgeIndices[t]=null}deleteEdgesBreakFaces_(t){for(let e=0,s=t.length;e<s;e++){let n=t[e],i=this.getHalfEdgeChain(n),o=this.getHalfEdgeTwin(n),a=this.getHalfEdgeChain(o);this.setChainHalfEdge_(i,v),this.setChainHalfEdge_(a,v),this.updateVertexToHalfEdgeConnection_(n,!0),this.deleteEdgeImpl_(n)}}doesHalfEdgeBelongToAPolygonInterior(t,e){return w(0),!1}doesHalfEdgeBelongToAPolygonExterior(t,e){return w(0),!1}doesHalfEdgeBelongToAPolygonBoundary(t,e){return w(0),!1}doesHalfEdgeBelongToAPolylineInterior(t,e){return w(0),!1}doesHalfEdgeBelongToAPolylineExterior(t,e){return w(0),!1}doesClusterBelongToAPolygonInterior(t,e){return w(0),!1}doesClusterBelongToAPolygonExterior(t,e){return w(0),!1}doesClusterBelongToAPolygonBoundary(t,e){return w(0),!1}getFirstChain(){return this.m_universeChain}getChainHalfEdge(t){return this.m_chainData.getField(t,1)}getChainParentage(t){return this.m_chainData.getField(t,2)}getChainParent(t){return this.m_chainData.getField(t,3)}getChainFirstIsland(t){return this.m_chainData.getField(t,4)}getChainNextInParent(t){return this.m_chainData.getField(t,5)}getChainNext(t){return this.m_chainData.getField(t,7)}getChainArea(t){let e=this.getChainIndex_(t),s=this.m_chainAreas.read(e);return Number.isNaN(s)&&(this.updateChainAreaAndPerimeter_(t),s=this.m_chainAreas.read(e)),s}getChainPerimeter(t){return w(0),0}getChainUserIndex(t,e){let s=this.getChainIndex_(t),n=this.m_chainIndices[e];return n.size()<=s?-1:n.read(s)}setChainUserIndex(t,e,s){let n=this.getChainIndex_(t),i=this.m_chainIndices[e];i.size()<=n&&i.resize(this.m_chainData.size(),-1),i.write(n,s)}createUserIndexForChains(){let t=new he(this.m_chainData.capacity(),-1);for(let e=0,s=this.m_chainIndices.length;e<s;e++)if(this.m_chainIndices[e]===null)return this.m_chainIndices[e]=t,e;return this.m_chainIndices.push(t),this.m_chainIndices.length-1}deleteUserIndexForChains(t){this.m_chainIndices[t]=null}extractPolygonFromChainAndIslands(t,e,s,n){let i=e===v?t.createGeometry(N.enumPolygon):e,o=new et;this.extractPolygonPathFromChain_(t,i,s,n,o);for(let a=this.getChainFirstIsland(s);a!==v;a=this.getChainNextInParent(a))this.extractPolygonPathFromChain_(t,i,a,n,o);return i}getGeometryID(t){let e=this.m_shape.getGeometryUserIndex(t,this.m_geometryIDIndex);return w(e>=0),1<<Math.min(e,31)}getClusterFromVertex(t){return this.m_shape.getUserIndex(t,this.m_clusterIndex)}getHalfEdgeFromVertex(t){return this.m_shape.getUserIndex(t,this.m_halfEdgeIndex)}buildGeometryParentageSets(){this.m_bBuildGeometryParentageSets=!0}getChainBitSet(t){if(w(this.m_bBuildGeometryParentageSets),this.m_chainBitSetIndex===-1)return this.getEmptySet();let e=this.getChainUserIndex(t,this.m_chainBitSetIndex);w(e>=0);let s=this.m_chainBitSets.at(e);return s||(s=this.getEmptySet()),s}getChainBoundaryBitSet(t){w(this.m_bBuildGeometryParentageSets);let e=new ls,s=n=>{let i=this.getChainHalfEdge(n),o=i;do{let a=this.getEdgeBitSet_(o);a!==null&&e.assignOr(a);let h=this.getEdgeBitSet_(this.getHalfEdgeTwin(o));h!==null&&e.assignOr(h),o=this.getHalfEdgeNext(o)}while(o!==i)};s(t);for(let n=this.getChainFirstIsland(t);n!==v;n=this.getChainNextInParent(n))s(t);return e}getChainPolygons(t){return w(0),[]}getGeometriesFromBits(t){if(!this.m_bBuildGeometryParentageSets||t===null)return[];if(this.m_geometryMapID===null){this.m_geometryMapID=new Map;for(let n=this.m_shape.getFirstGeometry();n!==v;n=this.m_shape.getNextGeometry(n))this.m_geometryMapID.set(this.m_shape.getGeometryUserIndex(n,this.m_geometryIDIndex),n)}let e=[],s=t.getUnorderedBitIterator();for(let n=s.next();n!==ia.npos();n=s.next())w(this.m_geometryMapID.has(n)),e.push(this.m_geometryMapID.get(n));return e}getVertexDominant(t,e){if(e===v)return t;let s=this.getClusterFromVertex(t);return this.getVertexDominantFromCluster(s,e)}getVertexDominantFromCluster(t,e){if(e!==v){let s=v;for(let n=this.getClusterVertexIterator(t);n!==v;n=this.incrementVertexIterator(n)){let i=this.getVertexFromVertexIterator(n);s===v&&(s=i);let o=this.m_shape.getPathFromVertex(i);if(this.m_shape.getGeometryFromPath(o)===e){s=i;break}}return s}{let s=this.getClusterVertexIterator(t);return s!==v?this.getVertexFromVertexIterator(s):v}}isBreakNode(t){return this.hasClusterUserIndexFlags(t,this.m_clusterBreakNodeIndex,En.enumSegmentParentageBreakNode)}setBreakNode(t,e){w(this.m_clusterBreakNodeIndex!==-1),e?this.setClusterUserIndexFlags(t,this.m_clusterBreakNodeIndex,En.enumSegmentParentageBreakNode):this.clearClusterUserIndexFlags(t,this.m_clusterBreakNodeIndex,En.enumSegmentParentageBreakNode)}isStrongPathNode(t){return this.hasClusterUserIndexFlags(t,this.m_clusterBreakNodeIndex,En.enumPathBreakNode)}setStrongPathNode(t,e){if(this.m_clusterBreakNodeIndex===-1){if(!e)return;this.m_clusterBreakNodeIndex=this.createUserIndexForClusters()}e?this.setClusterUserIndexFlags(t,this.m_clusterBreakNodeIndex,En.enumPathBreakNode):this.clearClusterUserIndexFlags(t,this.m_clusterBreakNodeIndex,En.enumPathBreakNode)}getSegmentParentage(t){if(this.m_segmentParentageIndex===-1)return-1;let e=this.getHalfEdgeUserIndex(t,this.m_segmentParentageIndex);return e>=0?e:-1}isCrossroadAhead(t){let e=this.getHalfEdgeNext(t);if(this.isStrongPathNode(this.getHalfEdgeOrigin(e)))return!0;let s=this.getHalfEdgeTwin(e),n=this.getHalfEdgeNext(s);return t!==this.getHalfEdgeTwin(n)}isCrossroadBehind(t){return w(0),!1}getHalfEdgeConnector(t,e){let s=this.getClusterHalfEdge(t);if(s===v)return v;let n=s,i=v,o=v;do{if(this.getHalfEdgeTo(n)===e)return n;if(i===v){if(i=this.getClusterHalfEdge(e),i===v)return v;o=i}if(this.getHalfEdgeTo(o)===t)return n=this.getHalfEdgeTwin(o),n;n=this.getHalfEdgeNext(this.getHalfEdgeTwin(n)),o=this.getHalfEdgeNext(this.getHalfEdgeTwin(o))}while(n!==s&&o!==i);return v}querySegmentXY(t,e){if(this.m_segmentIndexHe!==-1){let i=this.getHalfEdgeUserIndex(t,this.m_segmentIndexHe);if(i!==-1){if(i!==-2){let o=this.m_shape.getSegmentFromIndex(i);e.copyFrom(o,!0)}else{i=this.getHalfEdgeUserIndex(this.getHalfEdgeTwin(t),this.m_segmentIndexHe);let o=this.m_shape.getSegmentFromIndex(i);e.copyFrom(o,!0),e.get().reverse()}return}}e.createLine();let s=e.get(),n=y.getNAN();this.getHalfEdgeFromXY(t,n),s.setStartXY(n),this.getHalfEdgeToXY(t,n),s.setEndXY(n)}isCurveEdge(t){return this.m_segmentIndexHe!==-1?this.getHalfEdgeUserIndex(t,this.m_segmentIndexHe)!==-1:!1}compareEdgeAnglesCurveHelper_(t,e,s){let n=new et,i=new et;this.querySegmentXY(t,n),this.querySegmentXY(e,i);let o=n.get(),a=i.get();if(o.equals(a))return 0;let h=new y;this.getHalfEdgeFromXY(t,h);let m=new y;this.getHalfEdgeToXY(t,m);let l=new y;this.getHalfEdgeToXY(e,l),w(!m.isEqualPoint2D(l));let u=o.getTangent(0),c=a.getTangent(0);return y.compareVectors(u,c)}compareEdgeAnglesHelper_(t,e,s){if(t===e)return 0;if(this.isHalfEdgeCurve(t)||this.isHalfEdgeCurve(e))return this.compareEdgeAnglesCurveHelper_(t,e,s);let n=y.getNAN();this.getHalfEdgeToXY(t,n);let i=y.getNAN();if(this.getHalfEdgeToXY(e,i),n.isEqualPoint2D(i))return 0;let o=y.getNAN();this.getHalfEdgeFromXY(t,o);let a=y.getNAN();a.setSub(n,o);let h=y.getNAN();return h.setSub(i,o),!s||h.y>=0&&a.y>0?y.compareVectors(a,h):0}compareEdgeAngles_(t,e){return this.compareEdgeAnglesHelper_(t,e,!1)}compareEdgeAnglesForPair_(t,e){return this.compareEdgeAnglesHelper_(t,e,!0)}compareEdgeAngles3D_(t,e){return w(0),0}compareEdgeAnglesForPair3D_(t,e){return w(0),0}dbgDumpChains_(){}dbgDumpChainToPolygon_(t,e){}deleteEdgeInternal_(t){let e=this.getHalfEdgeChain(t),s=this.getHalfEdgeTwin(t),n=this.getHalfEdgeChain(s);w(n===e),w(t===this.getHalfEdgeNext(s)||s===this.getHalfEdgeNext(t));let i=this.getHalfEdgeNext(t);i===s&&(i=this.getHalfEdgeNext(i),i===t&&(i=v));let o=this.getChainIndex_(e),a=this.m_chainAreas.read(o);Number.isNaN(a)||(this.setChainArea_(e,Number.NaN),this.setChainPerimeter_(e,Number.NaN));let h=this.getChainHalfEdge(e);h!==t&&h!==s||this.setChainHalfEdge_(e,i),this.updateVertexToHalfEdgeConnection_(t,!0),this.deleteEdgeImpl_(t)}getFirstUnvisitedHalfEdgeOnCluster_(t,e,s){let n=e!==v?e:this.getClusterHalfEdge(t);if(n===v)return v;let i=n;for(;;){if(this.getHalfEdgeUserIndex(n,s)!==1)return n;let o=this.getHalfEdgeNext(this.getHalfEdgeTwin(n));if(o===i)return v;n=o}}removeSpikes_(){let t=!1,e=this.createUserIndexForHalfEdges();for(let s=this.getFirstCluster();s!==v;s=this.getNextCluster(s)){let n=v;for(;;){let i=this.getFirstUnvisitedHalfEdgeOnCluster_(s,n,e);if(i===v)break;n=this.getHalfEdgeNext(this.getHalfEdgeTwin(i));let o=i;for(;;){let a=this.getHalfEdgeNext(o),h=this.getHalfEdgePrev(o),m=this.getHalfEdgeTwin(o);if(h===m){if(this.deleteEdgeInternal_(o),t=!0,n!==o&&n!==m||(n=v),o===i||h===i){if(i=a,o===i||h===i)break;o=a;continue}}else this.setHalfEdgeUserIndex(o,e,1);if(o=a,o===i)break}}}return this.deleteUserIndexForHalfEdges(e),t}progress_(t,e=!1){}newCluster_(){let t=this.m_clusterData.newElement();return this.m_clusterData.setField(t,1,0),t}newHalfEdgePair_(){let t=this.m_halfEdgeData.newElement();this.m_halfEdgeData.setField(t,2,0),this.m_halfEdgeData.setField(t,3,0);let e=this.m_halfEdgeData.newElement();return this.m_halfEdgeData.setField(e,2,0),this.m_halfEdgeData.setField(e,3,0),this.setHalfEdgeTwin_(t,e),this.setHalfEdgeTwin_(e,t),t}newChain_(){let t=this.m_chainData.newElement();return this.m_chainData.setField(t,2,0),t}deleteChain_(t){return w(0),0}getClusterIndex_(t){return this.m_clusterData.elementToIndex(t)}setClusterVertexIterator_(t,e){this.m_clusterData.setField(t,7,e)}setClusterHalfEdge_(t,e){this.m_clusterData.setField(t,2,e)}setClusterParentage_(t,e){this.m_clusterData.setField(t,1,e)}setPrevCluster_(t,e){this.m_clusterData.setField(t,3,e)}setNextCluster_(t,e){this.m_clusterData.setField(t,4,e)}setClusterVertexIndex_(t,e){this.m_clusterData.setField(t,5,e)}getClusterVertexIndex_(t){return this.m_clusterData.getField(t,5)}setClusterChain_(t,e){this.m_clusterData.setField(t,6,e)}addClusterToExteriorChain_(t,e){this.setClusterChain_(e,t)}getHalfEdgeIndex_(t){return this.m_halfEdgeData.elementToIndex(t)}setHalfEdgeOrigin_(t,e){this.m_halfEdgeData.setField(t,1,e)}setHalfEdgeTwin_(t,e){this.m_halfEdgeData.setField(t,4,e)}setHalfEdgePrev_(t,e){this.m_halfEdgeData.setField(t,5,e)}setHalfEdgeNext_(t,e){this.m_halfEdgeData.setField(t,6,e)}setHalfEdgeChain_(t,e){this.m_halfEdgeData.setField(t,2,e)}setHalfEdgeParentage_(t,e){this.m_halfEdgeData.setField(t,3,e)}getHalfEdgeParentageMask_(t){return this.m_halfEdgeData.getField(t,3)}setHalfEdgeVertexIterator_(t,e){this.m_halfEdgeData.setField(t,7,e)}updateVertexToHalfEdgeConnectionHelper_(t,e){let s=e?v:t;for(let n=this.getHalfEdgeVertexIterator(t);n!==v;n=this.incrementVertexIterator(n)){let i=this.getVertexFromVertexIterator(n);this.m_shape.setUserIndex(i,this.m_halfEdgeIndex,s)}}updateVertexToHalfEdgeConnection_(t,e){t!==v&&(this.updateVertexToHalfEdgeConnectionHelper_(t,e),this.updateVertexToHalfEdgeConnectionHelper_(this.getHalfEdgeTwin(t),e))}getChainIndex_(t){return this.m_chainData.elementToIndex(t)}setChainHalfEdge_(t,e){this.m_chainData.setField(t,1,e)}setChainParentage_(t,e){this.m_chainData.setField(t,2,e)}setChainParent_(t,e){this.m_chainData.setField(t,3,e);let s=this.getChainFirstIsland(e);this.setChainNextInParent_(t,s),this.setChainFirstIsland_(e,t)}setChainFirstIsland_(t,e){this.m_chainData.setField(t,4,e)}setChainNextInParent_(t,e){this.m_chainData.setField(t,5,e)}setChainPrev_(t,e){this.m_chainData.setField(t,6,e)}setChainNext_(t,e){this.m_chainData.setField(t,7,e)}setChainArea_(t,e){let s=this.getChainIndex_(t);this.m_chainAreas.write(s,e)}setChainPerimeter_(t,e){let s=this.getChainIndex_(t);this.m_chainPerimeters.write(s,e)}updateChainAreaAndPerimeter_(t){let e=this.m_shape.hasCurves(),s=new oe(0),n=new oe(0),i=this.getChainHalfEdge(t),o=y.getNAN(),a=y.getNAN(),h=y.getNAN();this.getHalfEdgeFromXY(i,o),a.setCoordsPoint2D(o);let m=i;do this.getHalfEdgeToXY(m,h),e&&this.isCurveEdge(m)||n.pe(y.distance(a,h)),this.getHalfEdgeChain(this.getHalfEdgeTwin(m))!==t&&s.pe((h.x-o.x-(a.x-o.x))*(h.y-o.y+(a.y-o.y))*.5),a.setCoordsPoint2D(h),m=this.getHalfEdgeNext(m);while(m!==i);if(e){let u=new et;m=i;do{this.getHalfEdgeToXY(m,h);let c=this.isCurveEdge(m);if(c&&(this.querySegmentXY(m,u),n.pe(u.get().calculateLength2D())),this.getHalfEdgeChain(this.getHalfEdgeTwin(m))!==t&&c){let g=u.get().calculateArea2DHelper();s.pe(g)}m=this.getHalfEdgeNext(m)}while(m!==i)}let l=this.getChainIndex_(t);this.m_chainAreas.write(l,s.getResult()),this.m_chainPerimeters.write(l,n.getResult())}getChainTopmostEdge_(t){return w(0),0}planeSweepParentage_(t,e){let s=new Jm(this),n=new Ot;n.setCapacity(Math.trunc(this.m_pointCount/2)),n.setComparator(s);let i=[],o=this.createUserIndexForHalfEdges(),a=null,h=y.getNAN();for(let m=this.getFirstCluster();m!==v;m=this.getNextCluster(m)){this.progress_(e);let l=this.getClusterHalfEdge(m);if(l!==v){if(i.length=0,!this.tryOptimizedInsertion_(n,o,i,m,l)){this.queryXY(m,h),s.setY(h.y);let u=l;do{let c=this.getHalfEdgeUserIndex(u,o);c!==-1&&(n.deleteNode(c),this.setHalfEdgeUserIndex(u,o,Rt.impossibleIndex2())),u=this.getHalfEdgeNext(this.getHalfEdgeTwin(u))}while(l!==u);u=l;do{if(this.getHalfEdgeUserIndex(u,o)===-1){let c=n.addElement(u);i.push(c)}u=this.getHalfEdgeNext(this.getHalfEdgeTwin(u))}while(l!==u)}for(let u=i.length-1;u>=0;u--){let c=i[u],g=n.getElement(c),d=this.getHalfEdgeTwin(g);this.setHalfEdgeUserIndex(d,o,c),this.planeSweepParentagePropagateParentage_(n,c,t)}}else if(this.getClusterChain(m)===v){a===null&&(a=new tl(this)),this.queryXY(m,h),a.setPointXY(h);let u=n.searchLowerBound(a),c=this.m_universeChain;if(u!==-1){let g=n.getElement(u);this.getHalfEdgeChain(g)===this.getHalfEdgeChain(this.getHalfEdgeTwin(g))&&(g=this.getLeftSkipPolylines_(n,u)),g!==v&&(c=this.getHalfEdgeChain(g))}this.addClusterToExteriorChain_(c,m)}}this.deleteUserIndexForHalfEdges(o)}planeSweepParentagePropagateParentage_(t,e,s){let n=t.getElement(e),i=this.getHalfEdgeChain(n);if(this.getChainParent(i)!==v)return;let o=this.getLeftSkipPolylines_(t,e),a=this.getHalfEdgeTwin(n),h=this.getHalfEdgeChain(a),m=this.getChainParent(i),l=this.getChainParent(h);if(o===v)m===v&&(h===i?(this.setChainParent_(h,this.m_universeChain),l=this.m_universeChain,m=l):(l===v&&(this.setChainParent_(h,this.m_universeChain),l=this.m_universeChain),this.setChainParent_(i,h),m=h));else{let u=this.getHalfEdgeChain(o);if(l===v){if(this.getChainArea(u)<=0){let c=this.getChainParent(u);this.setChainParent_(h,c),l=c}else this.setChainParent_(h,u),l=u;h===i&&(m=l)}}m===v&&(this.trySetChainParentFromTwin_(i,h),m=this.getChainParent(i)),w(m!==v),s===be.enumInputModeBuildGraph?this.propagateParentageBuildGraph_(t,e,n,o):s===be.enumInputModeSimplifyWinding?this.propagateParentageWinding_(t,e,n,o,a,i,h):s===be.enumInputModeSimplifyAlternate&&this.propagateParentageAlternate_(t,e,n,o,a,i,h)}propagateParentageBuildGraph_(t,e,s,n){let i,o=e;n===v?(o=t.getNext(o),i=this.getHalfEdgeChain(s)):i=this.getHalfEdgeChain(n);let a=null,h=this.getChainParentage(i);for(this.m_bBuildGeometryParentageSets&&(a=this.getChainBitSet(i));o!==-1;o=t.getNext(o)){let m=t.getElement(o),l=this.getHalfEdgeTwin(m);i=this.getHalfEdgeChain(m);let u=this.getHalfEdgeChain(l);if(this.m_bBuildGeometryParentageSets){let p=this.getChainBitSet(u);p=new ls({copy:p}),p.assignOr(a),this.setChainBitSet_(u,p);let f=this.getChainBitSet(i),x=this.getLeftEdgeBitSet_(m),C=new ls({copy:a});if(C.assignSubtract(x),C.isZero())break;f=new ls({copy:f}),f.assignOr(C),this.setChainBitSet_(i,f),a=f}let c=this.getChainParentage(u),g=c|h;g!==c&&this.setChainParentage_(u,g);let d=this.getChainParentage(i),_=h&~this.getHalfEdgeUserIndex(m,this.m_tmpHalfEdgeParentageIndexLeft);if(_&&(d|=_,this.setChainParentage_(i,d)),_===0)break;h=d}}propagateParentageWinding_(t,e,s,n,i,o,a){if(o===a)return;let h=this.getHalfEdgeUserIndex(s,this.m_tmpHalfEdgeWindingNumberIndex);h+=this.getHalfEdgeUserIndex(i,this.m_tmpHalfEdgeWindingNumberIndex);let m=0,l=[],u=[];u.push(0);for(let c=t.getFirst();c!==e;c=t.getNext(c)){let g=t.getElement(c),d=this.getHalfEdgeTwin(g),_=this.getHalfEdgeChain(g),p=this.getHalfEdgeChain(d);if(_!==p){let f=this.getHalfEdgeUserIndex(g,this.m_tmpHalfEdgeWindingNumberIndex);f+=this.getHalfEdgeUserIndex(d,this.m_tmpHalfEdgeWindingNumberIndex),m+=f;let x=!1;l.length!==0&&l.at(-1)===p&&(u.pop(),l.pop(),x=!0),w(this.getChainParent(p)!==v),x&&this.getChainParent(p)===_||(u.push(m),l.push(_))}}if(m+=h,l.length!==0&&l.at(-1)===a&&(u.pop(),l.pop()),m!==0){if(u.at(-1)===0){let c=this.m_simplifiedGeometry,g=this.getGeometryID(c);this.setChainParentage_(o,g)}}else if(u.at(-1)!==0){let c=this.m_simplifiedGeometry,g=this.getGeometryID(c);this.setChainParentage_(o,g)}}propagateParentageAlternate_(t,e,s,n,i,o,a){let h=this.m_simplifiedGeometry,m=this.getGeometryID(h);if(n===v)this.setChainParentage_(a,this.m_universeGeomID),1&this.getHalfEdgeUserIndex(s,this.m_tmpHalfEdgeOddEvenNumberIndex)?this.setChainParentage_(o,m):this.setChainParentage_(o,this.m_universeGeomID);else{let l=this.getChainParentage(a);if(l===0){let u=this.getHalfEdgeChain(n),c=this.getChainParentage(u);this.setChainParentage_(a,c),1&this.getHalfEdgeUserIndex(s,this.m_tmpHalfEdgeOddEvenNumberIndex)?this.setChainParentage_(o,c===m?this.m_universeGeomID:m):this.setChainParentage_(o,c)}else 1&this.getHalfEdgeUserIndex(s,this.m_tmpHalfEdgeOddEvenNumberIndex)?this.setChainParentage_(o,l===m?this.m_universeGeomID:m):this.setChainParentage_(o,l)}}tryOptimizedInsertion_(t,e,s,n,i){let o=i,a=-1,h=v,m=0;do{if(m===2)return!1;let l=this.getHalfEdgeUserIndex(o,e);if(l!==-1){if(a!==-1)return!1;a=l}else{if(h!==v)return!1;h=o}m++,o=this.getHalfEdgeNext(this.getHalfEdgeTwin(o))}while(i!==o);return h!==v&&a!==-1&&(this.setHalfEdgeUserIndex(t.getElement(a),e,Rt.impossibleIndex2()),t.setElement(a,h),s.push(a),!0)}trySetChainParentFromTwin_(t,e){let s=this.getChainArea(t);if(s===0)return!1;let n=this.getChainArea(e);if(s>0&&n<0||s<0&&n>0)return this.setChainParent_(t,e),!0;{let i=this.getChainParent(e);if(i!==v)return this.setChainParent_(t,i),!0}return!1}createHalfEdges_(t,e){this.m_halfEdgeIndex=this.m_shape.createUserIndex();for(let s=0,n=e.size();s<n;s++){let i=e.read(s),o=this.m_shape.getUserIndex(i,this.m_clusterIndex),a=this.m_shape.getPathFromVertex(i),h=this.m_shape.getGeometryFromPath(a),m=this.m_shape.getGeometryType(h);if(at(m)){let l=this.m_shape.getNextVertex(i);if(l===v)continue;let u=this.m_shape.getUserIndex(l,this.m_clusterIndex);if(o===u)continue;let c=this.newHalfEdgePair_(),g=this.getHalfEdgeTwin(c),d=this.m_clusterVertices.newElement();this.m_clusterVertices.setField(d,0,i),this.m_clusterVertices.setField(d,1,-1),this.setHalfEdgeVertexIterator_(c,d),this.m_shape.setUserIndex(i,this.m_halfEdgeIndex,c),this.setHalfEdgeOrigin_(c,o);let _=this.getClusterHalfEdge(o);if(_===v)this.setClusterHalfEdge_(o,c),this.setHalfEdgePrev_(c,g),this.setHalfEdgeNext_(g,c);else{let C=this.getHalfEdgePrev(_);this.setHalfEdgePrev_(_,g),this.setHalfEdgeNext_(g,_),this.setHalfEdgeNext_(C,c),this.setHalfEdgePrev_(c,C)}this.setHalfEdgeOrigin_(g,u);let p=this.getClusterHalfEdge(u);if(p===v)this.setClusterHalfEdge_(u,g),this.setHalfEdgeNext_(c,g),this.setHalfEdgePrev_(g,c);else{let C=this.getHalfEdgePrev(p);this.setHalfEdgePrev_(p,c),this.setHalfEdgeNext_(c,p),this.setHalfEdgeNext_(C,g),this.setHalfEdgePrev_(g,C)}let f=this.getGeometryID(h);if(t===be.enumInputModeBuildGraph){let C=m===N.enumPolygon?f:0;if(this.setHalfEdgeUserIndex(g,this.m_tmpHalfEdgeParentageIndex,0),this.setHalfEdgeUserIndex(c,this.m_tmpHalfEdgeParentageIndex,C),this.setHalfEdgeUserIndex(g,this.m_tmpHalfEdgeParentageIndexLeft,C),this.setHalfEdgeUserIndex(c,this.m_tmpHalfEdgeParentageIndexLeft,0),this.m_bBuildGeometryParentageSets){let P=new ls,E=this.m_shape.getGeometryUserIndex(h,this.m_geometryIDIndex);P.setBit(E),this.setEdgeBitSet_(c,P),this.setEdgeBitSet_(g,null),this.setLeftEdgeBitSet_(g,P),this.setLeftEdgeBitSet_(c,null)}}else if(t===be.enumInputModeSimplifyWinding){let C=this.m_shape.getXY(i),P=this.m_shape.getXY(l),E=0,S=0;C.compare(P)<0?E=1:S=-1,this.setHalfEdgeUserIndex(c,this.m_tmpHalfEdgeWindingNumberIndex,E),this.setHalfEdgeUserIndex(g,this.m_tmpHalfEdgeWindingNumberIndex,S)}else t===be.enumInputModeSimplifyAlternate&&(this.setHalfEdgeUserIndex(c,this.m_tmpHalfEdgeOddEvenNumberIndex,1),this.setHalfEdgeUserIndex(g,this.m_tmpHalfEdgeOddEvenNumberIndex,1));let x=m===N.enumPolygon?r.c_EdgeBitMask:0;this.setHalfEdgeParentage_(c,f|x),this.setHalfEdgeParentage_(g,f|x)}}if(this.m_shape.hasCurves()){this.m_segmentIndexHe=this.createUserIndexForHalfEdges();for(let s=0,n=e.size();s<n;s++){let i=e.read(s);if(this.m_shape.getSegment(i)){let o=this.m_shape.getUserIndex(i,this.m_halfEdgeIndex);o!==v&&(this.setHalfEdgeUserIndex(o,this.m_segmentIndexHe,this.m_shape.getVertexIndex(i)),this.setHalfEdgeUserIndex(this.getHalfEdgeTwin(o),this.m_segmentIndexHe,-2))}}}}mergeVertexListsOfEdges_(t,e){{let i=this.getHalfEdgeVertexIterator(e);if(i!==v){let o=this.getHalfEdgeVertexIterator(t);this.m_clusterVertices.setField(i,1,o),this.setHalfEdgeVertexIterator_(t,i),this.setHalfEdgeVertexIterator_(e,v)}}let s=this.getHalfEdgeTwin(t),n=this.getHalfEdgeTwin(e);{let i=this.getHalfEdgeVertexIterator(n);if(i!==v){let o=this.getHalfEdgeVertexIterator(s);this.m_clusterVertices.setField(i,1,o),this.setHalfEdgeVertexIterator_(s,i),this.setHalfEdgeVertexIterator_(n,v)}}if(this.m_segmentIndexHe!==-1){let i=this.getHalfEdgeUserIndex(t,this.m_segmentIndexHe);if(i!==-1){if(i===-2){let o=this.getHalfEdgeUserIndex(e,this.m_segmentIndexHe);this.setHalfEdgeUserIndex(t,this.m_segmentIndexHe,o)}if(i=this.getHalfEdgeUserIndex(s,this.m_segmentIndexHe),i===-2){let o=this.getHalfEdgeUserIndex(n,this.m_segmentIndexHe);this.setHalfEdgeUserIndex(s,this.m_segmentIndexHe,o)}}}}sortHalfEdgesByAngle_(t){let e=[];for(let s=this.getFirstCluster();s!==v;s=this.getNextCluster(s)){e.length=0;let n=this.getClusterHalfEdge(s);if(n!==v){let i=n;do e.push(i),i=this.getHalfEdgeNext(this.getHalfEdgeTwin(i));while(i!==n);if(e.length>1){let o=!0;e.length>2?(e.sort((c,g)=>this.compareEdgeAngles_(c,g)),e.push(e[0])):this.compareEdgeAnglesForPair_(e[0],e[1])>0?e[1]=O(e[0],e[0]=e[1]):o=!1;let a=e[0],h=a,m=this.getHalfEdgeTo(h),l=this.getHalfEdgeTwin(h),u=v;for(let c=1,g=e.length;c<g;c++){let d=e[c],_=this.getHalfEdgeTwin(d),p=this.getHalfEdgeOrigin(_);if(p!==m||d===h)this.updateVertexToHalfEdgeConnection_(u,!1),u=v,h=d,m=p,l=_;else{if(t===be.enumInputModeBuildGraph){let f=this.getHalfEdgeParentageMask_(h)|this.getHalfEdgeParentageMask_(d);if(this.setHalfEdgeParentage_(h,f),this.setHalfEdgeParentage_(l,f),this.setHalfEdgeUserIndex(h,this.m_tmpHalfEdgeParentageIndex,this.getHalfEdgeUserIndex(h,this.m_tmpHalfEdgeParentageIndex)|this.getHalfEdgeUserIndex(d,this.m_tmpHalfEdgeParentageIndex)),this.setHalfEdgeUserIndex(l,this.m_tmpHalfEdgeParentageIndex,this.getHalfEdgeUserIndex(l,this.m_tmpHalfEdgeParentageIndex)|this.getHalfEdgeUserIndex(_,this.m_tmpHalfEdgeParentageIndex)),this.setHalfEdgeUserIndex(h,this.m_tmpHalfEdgeParentageIndexLeft,this.getHalfEdgeUserIndex(h,this.m_tmpHalfEdgeParentageIndexLeft)|this.getHalfEdgeUserIndex(d,this.m_tmpHalfEdgeParentageIndexLeft)),this.setHalfEdgeUserIndex(l,this.m_tmpHalfEdgeParentageIndexLeft,this.getHalfEdgeUserIndex(l,this.m_tmpHalfEdgeParentageIndexLeft)|this.getHalfEdgeUserIndex(_,this.m_tmpHalfEdgeParentageIndexLeft)),this.m_bBuildGeometryParentageSets){let x,C,P;x=this.getEdgeBitSet_(h),C=this.getEdgeBitSet_(d),P=new ls({copy:x}),P.assignOr(C),this.setEdgeBitSet_(h,P),x=this.getEdgeBitSet_(l),C=this.getEdgeBitSet_(_),P=new ls({copy:x}),P.assignOr(C),this.setEdgeBitSet_(l,P),x=this.getLeftEdgeBitSet_(h),C=this.getLeftEdgeBitSet_(d),P=new ls({copy:x}),P.assignOr(C),this.setLeftEdgeBitSet_(h,P),x=this.getLeftEdgeBitSet_(l),C=this.getLeftEdgeBitSet_(_),P=new ls({copy:x}),P.assignOr(C),this.setLeftEdgeBitSet_(l,P)}}else if(this.m_tmpHalfEdgeWindingNumberIndex!==-1){let f=this.getHalfEdgeUserIndex(h,this.m_tmpHalfEdgeWindingNumberIndex)+this.getHalfEdgeUserIndex(d,this.m_tmpHalfEdgeWindingNumberIndex),x=this.getHalfEdgeUserIndex(l,this.m_tmpHalfEdgeWindingNumberIndex)+this.getHalfEdgeUserIndex(_,this.m_tmpHalfEdgeWindingNumberIndex);this.setHalfEdgeUserIndex(h,this.m_tmpHalfEdgeWindingNumberIndex,f),this.setHalfEdgeUserIndex(l,this.m_tmpHalfEdgeWindingNumberIndex,x)}else if(this.m_tmpHalfEdgeOddEvenNumberIndex!==-1){let f=this.getHalfEdgeUserIndex(h,this.m_tmpHalfEdgeOddEvenNumberIndex)+this.getHalfEdgeUserIndex(d,this.m_tmpHalfEdgeOddEvenNumberIndex),x=this.getHalfEdgeUserIndex(l,this.m_tmpHalfEdgeOddEvenNumberIndex)+this.getHalfEdgeUserIndex(_,this.m_tmpHalfEdgeOddEvenNumberIndex);this.setHalfEdgeUserIndex(h,this.m_tmpHalfEdgeOddEvenNumberIndex,f),this.setHalfEdgeUserIndex(l,this.m_tmpHalfEdgeOddEvenNumberIndex,x)}this.mergeVertexListsOfEdges_(h,d),this.deleteEdgeImpl_(d),u=h,e[c]=v,d===a&&(e[0]=v,a=v)}}if(this.updateVertexToHalfEdgeConnection_(u,!1),u=v,!o){a=v;for(let c=0,g=e.length;c<g;c++){let d=e[c];if(d!==v){a=d;break}}n!==a&&this.setClusterHalfEdge_(s,a);continue}a=v;for(let c=0,g=e.length;c<g;c++){let d=e[c];if(d===v)continue;if(a===v){a=d,h=a,m=this.getHalfEdgeTo(h),l=this.getHalfEdgeTwin(h);continue}if(d===h)continue;let _=this.getHalfEdgeTwin(d),p=this.getHalfEdgeOrigin(_);this.setHalfEdgeNext_(l,d),this.setHalfEdgePrev_(d,l),h=d,m=p,l=_}this.setClusterHalfEdge_(s,a)}}}}sortHalfEdgesByAngle3D_(t){w(0)}buildChains_(t){this.m_universeChain=this.newChain_(),this.setChainHalfEdge_(this.m_universeChain,v);let e=this.m_universeChain,s=this.createUserIndexForHalfEdges();for(let n=this.getFirstCluster();n!==v;n=this.getNextCluster(n)){let i=this.getClusterHalfEdge(n);if(i!==v){let o=i;do{if(this.getHalfEdgeUserIndex(o,s)!==1){let a=this.newChain_();this.setChainHalfEdge_(a,o),this.setChainPrev_(a,e),this.setChainNext_(e,a);let h=null;this.m_bBuildGeometryParentageSets&&(h=new ls),e=a;let m=0,l=o;do this.m_tmpHalfEdgeParentageIndex!==-1&&(m|=this.getHalfEdgeUserIndex(l,this.m_tmpHalfEdgeParentageIndex)),this.m_bBuildGeometryParentageSets&&h.assignOr(this.getEdgeBitSet_(l)),this.setHalfEdgeChain_(l,a),this.setHalfEdgeUserIndex(l,s,1),l=this.getHalfEdgeNext(l);while(l!==o);this.m_bBuildGeometryParentageSets&&this.setChainBitSet_(a,h),this.setChainParentage_(a,m)}o=this.getHalfEdgeNext(this.getHalfEdgeTwin(o))}while(o!==i)}}this.m_chainAreas=new Ui(this.m_chainData.size(),Number.NaN),this.m_chainPerimeters=new Ui(this.m_chainData.size(),Number.NaN),this.setChainArea_(this.m_universeChain,Number.POSITIVE_INFINITY),this.setChainPerimeter_(this.m_universeChain,Number.POSITIVE_INFINITY),this.deleteUserIndexForHalfEdges(s)}simplify_(t){w(0)}simplifyAlternate_(){w(0)}simplifyWinding_(){w(0)}setEditShapeImpl_(t,e,s,n,i){this.removeShape(),this.m_bBuildChains=i,this.m_shape=t,this.m_geometryIDIndex=this.m_shape.createGeometryUserIndex();let o=this.m_shape.getTotalPointCount();if(s){o=0;for(let g=0,d=s.length;g<d;g++)o+=this.m_shape.getPointCount(s[g])}let a=new he(0),h=0,m=0;{let g=s!=null?s[0]:this.m_shape.getFirstGeometry(),d=1;for(;g!==v;){this.m_shape.setGeometryUserIndex(g,this.m_geometryIDIndex,m++);for(let _=this.m_shape.getFirstPath(g);_!==v;_=this.m_shape.getNextPath(_)){let p=this.m_shape.getFirstVertex(_);for(let f=0,x=this.m_shape.getPathSize(_);f<x;f++)a.add(p),p=this.m_shape.getNextVertex(p)}nn(this.m_shape.getGeometryType(g))||(h+=this.m_shape.getPathCount(g)),s!=null?(g=d<s.length?s[d]:v,d++):g=this.m_shape.getNextGeometry(g)}}this.m_universeGeomID=1<<Math.min(m,31),this.m_pointCount=a.size(),this.m_shape.sortVerticesSimpleByY(a,0,this.m_pointCount),this.m_clusterVertices.setCapacity(this.m_pointCount),this.progress_(n,!0),this.m_clusterData.setCapacity(this.m_pointCount+10),this.m_halfEdgeData.setCapacity(2*this.m_pointCount+32),this.m_chainData.setCapacity(Math.max(32,h)),this.m_clusterIndex=this.m_shape.createUserIndex();let l=y.getNAN(),u=0,c=y.getNAN();for(let g=0;g<=this.m_pointCount;g++){if(g<this.m_pointCount){let d=a.read(g);this.m_shape.queryXY(d,c)}else c.setNAN();if(!l.isEqualPoint2D(c)){if(u<g){let d=this.newCluster_(),_=v,p=-1;for(let f=u;f<g;f++){p=a.read(f),this.m_shape.setUserIndex(p,this.m_clusterIndex,d);let x=this.m_clusterVertices.newElement();this.m_clusterVertices.setField(x,0,p),this.m_clusterVertices.setField(x,1,_),_=x;let C=this.m_shape.getPathFromVertex(p),P=this.m_shape.getGeometryFromPath(C),E=this.getGeometryID(P);this.setClusterParentage_(d,this.getClusterParentage(d)|E)}this.setClusterVertexIterator_(d,_),this.setClusterVertexIndex_(d,this.m_shape.getVertexIndex(p)),this.m_lastCluster!==v&&this.setNextCluster_(this.m_lastCluster,d),this.setPrevCluster_(d,this.m_lastCluster),this.m_lastCluster=d,this.m_firstCluster===v&&(this.m_firstCluster=d)}u=g,l.setCoordsPoint2D(c)}}if(this.m_shape.hasSegmentParentage()){this.m_clusterBreakNodeIndex===-1&&(this.m_clusterBreakNodeIndex=this.createUserIndexForClusters());for(let g=0;g<this.m_pointCount;g++){let d=a.read(g);if(this.m_shape.getSegmentParentageBreakVertex(d)){let _=this.getClusterFromVertex(d);this.setBreakNode(_,!0)}}}this.progress_(n,!0);{let g=s!=null?s[0]:this.m_shape.getFirstGeometry(),d=1;for(;g!==v;){for(let _=this.m_shape.getFirstPath(g);_!==v;_=this.m_shape.getNextPath(_)){if(this.m_shape.isStrongPathStart(_)){let p=this.m_shape.getFirstVertex(_),f=this.getClusterFromVertex(p);this.setStrongPathNode(f,!0)}if(this.m_shape.isStrongPathEnd(_)){let p=this.m_shape.isClosedPath(_)?this.m_shape.getFirstVertex(_):this.m_shape.getLastVertex(_),f=this.getClusterFromVertex(p);this.setStrongPathNode(f,!0)}}s!=null?(g=d<s.length?s[d]:v,d++):g=this.m_shape.getNextGeometry(g)}}if(e===be.enumInputModeBuildGraph&&(this.m_tmpHalfEdgeParentageIndex=this.createUserIndexForHalfEdges(),this.m_tmpHalfEdgeParentageIndexLeft=this.createUserIndexForHalfEdges()),e===be.enumInputModeSimplifyWinding&&(this.m_tmpHalfEdgeWindingNumberIndex=this.createUserIndexForHalfEdges()),e===be.enumInputModeSimplifyAlternate&&(this.m_tmpHalfEdgeOddEvenNumberIndex=this.createUserIndexForHalfEdges()),this.createHalfEdges_(e,a),this.dbgNavigate_(),this.sortHalfEdgesByAngle_(e),!Number.isNaN(this.m_checkDirtyPlanesweepTolerance)&&!this.checkStructureAfterDirtySweep_())return this.m_bDirtyCheckFailed=!0,void this.cleanSetEditShapeImpl_();this.buildChains_(e),this.m_tmpHalfEdgeParentageIndex!==-1&&(this.deleteUserIndexForHalfEdges(this.m_tmpHalfEdgeParentageIndex),this.m_tmpHalfEdgeParentageIndex=-1),this.m_bBuildChains&&this.planeSweepParentage_(e,n),this.m_tmpHalfEdgeParentageIndexLeft!==-1&&(this.deleteUserIndexForHalfEdges(this.m_tmpHalfEdgeParentageIndexLeft),this.m_tmpHalfEdgeParentageIndexLeft=-1),this.dbgChkChainParents_(),this.dbgDumpChains_(),this.mergeSegmentParentage_(),this.dbgNavigate_(),this.dbgDumpChains_(),this.cleanSetEditShapeImpl_()}setEditShapeImpl3D_(t,e,s,n,i){w(0)}cleanSetEditShapeImpl_(){this.m_tmpHalfEdgeParentageIndex!==-1&&(this.deleteUserIndexForHalfEdges(this.m_tmpHalfEdgeParentageIndex),this.m_tmpHalfEdgeParentageIndex=-1),this.m_tmpHalfEdgeParentageIndexLeft!==-1&&(this.deleteUserIndexForHalfEdges(this.m_tmpHalfEdgeParentageIndexLeft),this.m_tmpHalfEdgeParentageIndexLeft=-1),this.m_tmpHalfEdgeWindingNumberIndex!==-1&&(this.deleteUserIndexForHalfEdges(this.m_tmpHalfEdgeWindingNumberIndex),this.m_tmpHalfEdgeWindingNumberIndex=-1),this.m_tmpHalfEdgeOddEvenNumberIndex!==-1&&(this.deleteUserIndexForHalfEdges(this.m_tmpHalfEdgeOddEvenNumberIndex),this.m_tmpHalfEdgeOddEvenNumberIndex=-1)}cleanSetEditShapeImpl3D_(){w(0)}dbgNavigate_(){}dbgChkChainParents_(){}deleteEdgeImpl_(t){let e=this.getHalfEdgeNext(t),s=this.getHalfEdgePrev(t),n=this.getHalfEdgeTwin(t),i=this.getHalfEdgeNext(n),o=this.getHalfEdgePrev(n);e!==n&&(this.setHalfEdgeNext_(o,e),this.setHalfEdgePrev_(e,o)),s!==n&&(this.setHalfEdgeNext_(s,i),this.setHalfEdgePrev_(i,s));let a=this.getHalfEdgeOrigin(t);this.getClusterHalfEdge(a)===t&&(i!==t?this.setClusterHalfEdge_(a,i):this.setClusterHalfEdge_(a,v));let h=this.getHalfEdgeOrigin(n);this.getClusterHalfEdge(h)===n&&(e!==n?this.setClusterHalfEdge_(h,e):this.setClusterHalfEdge_(h,v)),this.m_halfEdgeData.deleteElement(t),this.m_halfEdgeData.deleteElement(n)}getLeftSkipPolylines_(t,e){let s=e;for(;;){if(s=t.getPrev(s),s===-1)return v;{let n=t.getElement(s);if(this.getHalfEdgeChain(n)!==this.getHalfEdgeChain(this.getHalfEdgeTwin(n)))return n}}}checkStructureAfterDirtySweep_(){let t=Et(this.m_checkDirtyPlanesweepTolerance),e=new y,s=new y,n=new y,i=new y,o=new y;for(let a=this.getFirstCluster();a!==v;a=this.getNextCluster(a)){let h=this.getClusterHalfEdge(a);if(h!==v){let m=h;this.getHalfEdgeFromXY(m,e),this.getHalfEdgeToXY(m,s),n.setSub(s,e);let l=n.sqrLength();do{let u=m;if(m=this.getHalfEdgeNext(this.getHalfEdgeTwin(m)),m!==u){this.getHalfEdgeToXY(m,i),o.setSub(i,e);let c=o.sqrLength(),g=o.crossProduct(n),d=g*g/(c*l);if(Math.min(c,l)*d<=t&&o.dotProduct(n)>=0)return!1;n.assign(o),l=c,s.assign(i)}}while(m!==h)}}return!0}extractPolygonPathFromChain_(t,e,s,n,i){let o=this.m_shape.hasSegmentParentage(),a=this.getChainHalfEdge(s),h=a,m=v,l=new st;do{let u=this.getHalfEdgeTwin(h);if(this.getHalfEdgeChain(u)!==s){let c=v,g=this.getHalfEdgeOrigin(h);if(n===v){let _=this.getClusterVertexIterator(g);c=this.getVertexFromVertexIterator(_)}else for(let _=this.getClusterVertexIterator(g);_!==v;_=this.incrementVertexIterator(_)){let p=this.getVertexFromVertexIterator(_);c===v&&(c=p);let f=this.m_shape.getPathFromVertex(p);if(this.m_shape.getGeometryFromPath(f)===n){c=p;break}}let d;if(m===v&&(m=t.insertPath(e,v),t.setClosedPath(m,!0)),this.m_shape===t?d=t.addVertex(m,c):(this.m_shape.queryPoint(c,l),d=t.addPoint(m,l)),this.isHalfEdgeCurve(h)&&(this.querySegmentXY(h,i),t.setSegmentToIndex(t.getVertexIndex(d),i.get().clone())),o){let _=this.getSegmentParentage(h);t.setSegmentParentageAndBreak(d,_,this.isBreakNode(g))}}h=this.getHalfEdgeNext(h)}while(h!==a)}mergeSegmentParentage_(){if(!this.m_shape.hasSegmentParentage())return;w(this.m_clusterBreakNodeIndex!==-1),w(this.m_segmentParentageIndex===-1);for(let n=this.getFirstCluster();n!==v;n=this.getNextCluster(n)){let i=0,o=this.getClusterHalfEdge(n);if(o!==v){let a=o;do i++,a=this.getHalfEdgeNext(this.getHalfEdgeTwin(a));while(a!==o&&i<3)}i!==2&&this.setBreakNode(n,!0)}let t=[],e=[];this.m_segmentParentageIndex=this.createUserIndexForHalfEdges();let s=this.createUserIndexForHalfEdges();for(let n=this.getFirstCluster();n!==v;n=this.getNextCluster(n)){let i=this.getClusterHalfEdge(n);if(i!==v){let o=!1,a=i;do{let h=a;for(;this.getHalfEdgeUserIndex(h,s)===-1;){let m=this.getHalfEdgeNext(h),l=this.getHalfEdgeTwin(h);Og(this,h,e);let u=e.at(-1).parentage;if(!o){let g=this.getHalfEdgeOrigin(h);if(!this.isBreakNode(g)){let d=this.getHalfEdgePrev(h);h!==d&&(Og(this,d,t),o=!0)}}if(o&&!_1(e,t)){let g=this.getHalfEdgeOrigin(h);this.setBreakNode(g,!0)}t=O(e,e=t),o=!0;let c=this.getHalfEdgeOrigin(m);this.isBreakNode(c)&&(o=!1),this.setHalfEdgeUserIndex(h,this.m_segmentParentageIndex,u),this.setHalfEdgeUserIndex(l,this.m_segmentParentageIndex,u),this.setHalfEdgeUserIndex(h,s,1),this.setHalfEdgeUserIndex(l,s,1),h=m}a=this.getHalfEdgeNext(this.getHalfEdgeTwin(a))}while(a!==i)}}this.deleteUserIndexForHalfEdges(s)}registerNewBitSet(t){return this.m_uniqueBitSets===null&&(this.m_uniqueBitSets=p1(),this.m_uniqueBitSets.add(this.getEmptySet())),t===null?this.getEmptySet():this.m_uniqueBitSets.has(t)?this.m_uniqueBitSets.get(t):(this.m_uniqueBitSets.add(t),t)}getLeftEdgeBitSet_(t){let e=this.getHalfEdgeUserIndex(t,this.m_edgeBitSetIndexLeft);return w(e>=0),w(this.m_edgeBitSets.at(e)),this.m_edgeBitSets.at(e)}getEdgeBitSet_(t){let e=this.getHalfEdgeUserIndex(t,this.m_edgeBitSetIndex);return w(e>=0),this.m_edgeBitSets.at(e)}setEdgeBitSet_(t,e){w(this.m_bBuildGeometryParentageSets),e=this.registerNewBitSet(e),this.m_edgeBitSetIndex===-1&&(this.m_edgeBitSetIndex=this.createUserIndexForHalfEdges());let s=this.getHalfEdgeUserIndex(t,this.m_edgeBitSetIndex);s!==-1?this.m_edgeBitSets[s]=e:(this.setHalfEdgeUserIndex(t,this.m_edgeBitSetIndex,this.m_edgeBitSets.length),this.m_edgeBitSets.push(e))}setLeftEdgeBitSet_(t,e){w(this.m_bBuildGeometryParentageSets),e=this.registerNewBitSet(e),this.m_edgeBitSetIndexLeft===-1&&(this.m_edgeBitSetIndexLeft=this.createUserIndexForHalfEdges());let s=this.getHalfEdgeUserIndex(t,this.m_edgeBitSetIndexLeft);s!==-1?this.m_edgeBitSets[s]=e:(this.setHalfEdgeUserIndex(t,this.m_edgeBitSetIndexLeft,this.m_edgeBitSets.length),this.m_edgeBitSets.push(e))}setChainBitSet_(t,e){w(this.m_bBuildGeometryParentageSets),e=this.registerNewBitSet(e),this.m_chainBitSetIndex===-1&&(this.m_chainBitSetIndex=this.createUserIndexForChains());let s=this.getChainUserIndex(t,this.m_chainBitSetIndex);s!==-1?this.m_chainBitSets[s]=e:(this.setChainUserIndex(t,this.m_chainBitSetIndex,this.m_chainBitSets.length),this.m_chainBitSets.push(e))}getEmptySet(){return this.m_emptyBitSet||(this.m_emptyBitSet=new ls),this.m_emptyBitSet}deleteEdgeBitSets_(){this.m_edgeBitSetIndex!==-1&&(this.deleteUserIndexForHalfEdges(this.m_edgeBitSetIndex),this.m_edgeBitSetIndex=-1),this.m_edgeBitSetIndexLeft!==-1&&(this.deleteUserIndexForHalfEdges(this.m_edgeBitSetIndexLeft),this.m_edgeBitSetIndexLeft=-1),this.m_edgeBitSets.length=0,this.m_uniqueBitSets=null}deleteChainBitSets_(){this.m_chainBitSetIndex!==-1&&(this.deleteUserIndexForChains(this.m_chainBitSetIndex),this.m_chainBitSetIndex=-1,this.m_chainBitSets.length=0)}dbgPrintEdge_(t){}dbgVerifyEdgeSegment(t){}};As.c_EdgeParentageMask=~(1<<31),As.c_EdgeBitMask=1<<31;var Jt=class r{freeNode_(t){this.m_listNodes.deleteElement(t)}newNode_(){return this.m_listNodes.newElement()}freeList_(t){this.m_lists.deleteElement(t)}newList_(){return this.m_lists.newElement()}Init_(t){w(0)}constructor(t){this.m_listNodes=new Rt(2),this.m_listOfLists=r.st_nullNode(),this.m_bAllowNavigationBetweenLists=!0,t===void 0&&(t=!0),this.m_bAllowNavigationBetweenLists=t,this.m_lists=new Rt(this.m_bAllowNavigationBetweenLists?4:2)}createList(){let t=this.newList_();return this.m_bAllowNavigationBetweenLists&&(this.m_lists.setField(t,3,this.m_listOfLists),this.m_listOfLists!==r.st_nullNode()&&this.m_lists.setField(this.m_listOfLists,2,t),this.m_listOfLists=t),t}deleteList(t){let e=this.getFirst(t);for(;e!==r.st_nullNode();){let s=e;e=this.getNext(e),this.freeNode_(s)}if(this.m_bAllowNavigationBetweenLists){let s=this.m_lists.getField(t,2),n=this.m_lists.getField(t,3);s!==r.st_nullNode()?this.m_lists.setField(s,3,n):this.m_listOfLists=n,n!==r.st_nullNode()&&this.m_lists.setField(n,2,s)}this.freeList_(t)}reserveLists(t){this.m_lists.setCapacity(t)}addElement(t,e){this.m_lists.getField(t,0);let s=this.m_lists.getField(t,1),n=this.newNode_();return s!==r.st_nullNode()?(this.m_listNodes.setField(s,1,n),this.m_lists.setField(t,1,n)):(this.m_lists.setField(t,0,n),this.m_lists.setField(t,1,n)),this.m_listNodes.setField(n,0,e),n}reserveNodes(t){this.m_listNodes.setCapacity(t)}deleteElementDirect(t,e,s){e!==r.st_nullNode()?(this.m_listNodes.setField(e,1,this.m_listNodes.getField(s,1)),this.m_lists.getField(t,1)===s&&this.m_lists.setField(t,1,e)):(this.m_lists.setField(t,0,this.m_listNodes.getField(s,1)),this.m_lists.getField(t,1)===s&&this.m_lists.setField(t,1,r.st_nullNode())),this.freeNode_(s)}deleteElementSearch(t,e){let s=-1,n=this.getFirst(t);for(;n!==e;)s=n,n=this.getNext(n);this.deleteElementDirect(t,s,e)}concatenateLists(t,e){let s=this.m_lists.getField(t,1),n=this.m_lists.getField(e,0);if(n!==r.st_nullNode()&&(s!==r.st_nullNode()?(this.m_listNodes.setField(s,1,n),this.m_lists.setField(t,1,this.m_lists.getField(e,1))):(this.m_lists.setField(t,0,n),this.m_lists.setField(t,1,this.m_lists.getField(e,1)))),this.m_bAllowNavigationBetweenLists){let i=this.m_lists.getField(e,2),o=this.m_lists.getField(e,3);i!==r.st_nullNode()?this.m_lists.setField(i,3,o):this.m_listOfLists=o,o!==r.st_nullNode()&&this.m_lists.setField(o,2,i)}return this.freeList_(e),t}getElement(t){return this.m_listNodes.getField(t,0)}getData(t){return this.getElement(t)}setElement(t,e){w(0)}getNext(t){return this.m_listNodes.getField(t,1)}getFirst(t){return this.m_lists.getField(t,0)}getFirstElement(t){let e=this.getFirst(t);return this.getElement(e)}static st_nullNode(){return-1}clear(){this.m_listNodes.deleteAll(!0),this.m_lists.deleteAll(!0),this.m_listOfLists=r.st_nullNode()}isEmpty(t){return w(0),!1}getNodeCount(){return this.m_listNodes.size()}getListCount(){return this.m_lists.size()}getFirstList(){return this.m_listOfLists}getNextList(t){return this.m_lists.getField(t,3)}};function Gm(r=-1){return{m_value:r,m_line:new nt,m_segment:null,m_segmentInfo:new _i(-1),m_env:new B(0,0),m_dxdy:55555555,m_bHorizontal:!1,m_bCurve:!1}}var f1=67,ra=class extends Gn{constructor(t,e,s){super(!0),this.m_bIntersectionDetected=!1,this.m_nonSimpleResult=new vt,this.m_tempSimpleEdge1=Gm(),this.m_tempSimpleEdge2=Gm(),this.m_prev1=v,this.m_prev2=v,this.m_vertex1=v,this.m_vertex2=v,this.m_currentNode=-1,this.m_prevX1=Number.NaN,this.m_prevX2=Number.NaN,this.m_prevY=Number.NaN,this.m_prevX=0,this.m_sweepY=Number.NaN,this.m_sweepX=0,this.m_ptSweep=new y,this.m_simpleEdgesCache=[],this.m_simpleEdgesRecycle=[],this.m_cOutstandingConstructedEdges=0,this.m_shape=t,this.m_bShapeHasSegments=this.m_shape.hasCurves(),this.m_tolerance=e,this.m_tolerance10=10*e,this.m_bIsSimple=s;let n=Math.trunc(Math.min(3*t.getTotalPointCount()/2,f1)),i=Math.min(7,n);this.m_simpleEdgesCache.length=i}tryGetCachedEdge_(t){let e=this.m_simpleEdgesCache[(t&We())%this.m_simpleEdgesCache.length];return e&&e.m_value===t?e:null}tryDeleteCachedEdge_(t){let e=(t&We())%this.m_simpleEdgesCache.length,s=this.m_simpleEdgesCache[e];s&&s.m_value===t&&(this.m_simpleEdgesRecycle.push(s),this.m_simpleEdgesCache[e]=null)}tryCreateCachedEdge_(t){let e=(t&We())%this.m_simpleEdgesCache.length,s=this.m_simpleEdgesCache[e];return s?null:(this.m_simpleEdgesRecycle.length===0?(s=Gm(),this.m_cOutstandingConstructedEdges++):s=this.m_simpleEdgesRecycle.pop(),s.m_value=t,this.m_simpleEdgesCache[e]=s,s)}initSimpleEdge_(t,e){this.m_bShapeHasSegments&&this.initSimpleEdgeHelper_(t,e)||t.m_bCurve||(this.m_shape.queryLineConnector(e,t.m_line,!0),t.m_segment=t.m_line,t.m_env.setCoordsNoNAN(t.m_line.getStartX(),t.m_line.getEndX()),t.m_env.vmax+=this.m_tolerance,t.m_line.orientBottomUp(),t.m_bHorizontal=t.m_line.getEndY()===t.m_line.getStartY(),t.m_bHorizontal||(t.m_dxdy=(t.m_line.getEndX()-t.m_line.getStartX())/(t.m_line.getEndY()-t.m_line.getStartY())))}initSimpleEdgeHelper_(t,e){if(t.m_segment=this.m_shape.getSegment(e),t.m_segmentInfo=this.m_shape.getOriginalSegmentInfo(e),t.m_bCurve=t.m_segment!==null,t.m_bCurve){let s=t.m_segment.clone();return s.orientBottomUp(),t.m_segment=s,t.m_env=t.m_segment.queryInterval(0,0),t.m_env.vmax+=this.m_tolerance,!0}return!1}compareTwoSegments_(t,e){let s=t.getStartXY(),n=t.getEndXY(),i=e.getStartXY(),o=e.getEndXY();if(this.m_ptSweep.setCoords(this.m_sweepX,this.m_sweepY),s.isEqualPoint2D(i)&&this.m_sweepY===s.y){this.m_ptSweep.assign(n.compare(o)<0?n:o);let u=t.intersectionOfYMonotonicWithAxisX(this.m_ptSweep.y,this.m_ptSweep.x),c=e.intersectionOfYMonotonicWithAxisX(this.m_ptSweep.y,this.m_ptSweep.x);if(Math.abs(u-c)>this.m_tolerance)return u<c?-1:1}let a=s.compare(i)<0?i:s,h=n.compare(o)<0?n:o,m=0,l=0;for(let u=1;u<5;u++){qt(a,h,u/5,this.m_ptSweep);let c=t.intersectionOfYMonotonicWithAxisX(this.m_ptSweep.y,this.m_ptSweep.x),g=e.intersectionOfYMonotonicWithAxisX(this.m_ptSweep.y,this.m_ptSweep.x),d=Math.abs(c-g);d>m&&(m=d,l=c<g?-1:1)}return l===0?this.errorCracking():l}compareNonHorizontal_(t,e){if(t.m_line.getStartY()===e.m_line.getStartY()&&t.m_line.getStartX()===e.m_line.getStartX())return t.m_line.getEndY()===e.m_line.getEndY()&&t.m_line.getEndX()===e.m_line.getEndX()?this.m_bIsSimple?this.errorCoincident():0:this.compareNonHorizontalUpperEnd_(t,e);if(t.m_line.getEndY()===e.m_line.getEndY()&&t.m_line.getEndX()===e.m_line.getEndX())return this.compareNonHorizontalLowerEnd_(t,e);let s=this.compareNonHorizontalLowerEnd_(t,e),n=this.compareNonHorizontalUpperEnd_(t,e);return s<0&&n<0?-1:s>0&&n>0?1:this.errorCracking()}compareHorizontal1Case1_(t,e){if(t.getEndX()>e.getEndX()){if(e.getEndX()>e.getStartX()&&e.getEndY()-e.getStartY()<2*this.m_tolerance&&t.isIntersectingPoint(e.getEndXY(),this.m_tolerance,!0))return this.errorCracking()}else if((e.getEndY()-e.getStartY())/(e.getEndX()-e.getStartX())*(t.getEndX()-t.getStartX())<this.m_tolerance10&&e.isIntersectingPoint(t.getEndXY(),this.m_tolerance,!0))return this.errorCracking();return 1}compareHorizontal1Case2_(t,e){if(t.getStartX()<e.getStartX()){if(e.getEndX()>e.getStartX()&&e.getEndY()-e.getStartY()<2*this.m_tolerance&&t.isIntersectingPoint(e.getEndXY(),this.m_tolerance,!0))return this.errorCracking()}else if((e.getEndY()-e.getStartY())/(e.getEndX()-e.getStartX())*(t.getStartX()-t.getEndX())<this.m_tolerance10&&e.isIntersectingPoint(t.getStartXY(),this.m_tolerance,!0))return this.errorCracking();return-1}compareHorizontal1Case3_(t,e){let s=y.getNAN();s.setSub(e.getEndXY(),e.getStartXY()),s.rightPerpendicularThis(),s.normalize();let n=y.getNAN();n.setSub(t.getStartXY(),e.getStartXY());let i=y.getNAN();i.setSub(t.getEndXY(),e.getStartXY());let o=n.dotProduct(s),a=i.dotProduct(s),h=Math.abs(o),m=Math.abs(a);if(h<m){if(h<this.m_tolerance10&&e.isIntersectingPoint(t.getStartXY(),this.m_tolerance,!0))return this.errorCracking()}else if(m<this.m_tolerance10&&e.isIntersectingPoint(t.getEndXY(),this.m_tolerance,!0))return this.errorCracking();return o<0&&a<0?-1:o>0&&a>0?1:this.errorCracking()}compareHorizontal1_(t,e){return t.getStartY()===e.getStartY()&&t.getStartX()===e.getStartX()?this.compareHorizontal1Case1_(t,e):t.getEndY()===e.getEndY()&&t.getEndX()===e.getEndX()?this.compareHorizontal1Case2_(t,e):this.compareHorizontal1Case3_(t,e)}compareHorizontal2_(t,e){return t.getEndY()===e.getEndY()&&t.getEndX()===e.getEndX()&&t.getStartY()===e.getStartY()&&t.getStartX()===e.getStartX()?this.m_bIsSimple?this.errorCoincident():0:this.errorCracking()}compareNonHorizontalLowerEnd_(t,e){let s=1;if(t.m_line.getStartY()<e.m_line.getStartY()){s=-1;let m=t;t=e,e=m}let n=t.m_line,i=e.m_line,o=n.getStartX()-i.getStartX(),a=e.m_dxdy*(n.getStartY()-i.getStartY()),h=this.m_tolerance10;return o<a-h?-s:o>a+h?s:i.isIntersectingPoint(n.getStartXY(),this.m_tolerance,!0)?this.errorCracking():o<a?-s:s}compareNonHorizontalUpperEnd_(t,e){let s=1;if(e.m_line.getEndY()<t.m_line.getEndY()){s=-1;let m=t;t=e,e=m}let n=t.m_line,i=e.m_line,o=n.getEndX()-i.getStartX(),a=e.m_dxdy*(n.getEndY()-i.getStartY()),h=this.m_tolerance10;return o<a-h?-s:o>a+h?s:i.isIntersectingPoint(n.getEndXY(),this.m_tolerance,!0)?this.errorCracking():o<a?-s:s}errorCoincident(){this.m_bIntersectionDetected=!0;let t=7;return this.m_nonSimpleResult=new vt(t,this.m_vertex1,this.m_vertex2),-1}errorCracking(){return this.m_bIntersectionDetected=!0,this.m_bIsSimple?this.m_nonSimpleResult=new vt(6,this.m_vertex1,this.m_vertex2):(this.m_prev1=v,this.m_prev2=v,this.m_vertex1=v,this.m_vertex2=v),-1}compareSegments_(t,e,s,n){if(s.m_env.vmax<n.m_env.vmin)return-1;if(n.m_env.vmax<s.m_env.vmin)return 1;if(!s.m_bCurve&&!n.m_bCurve){let m=s.m_bHorizontal?1:0;return m|=n.m_bHorizontal?2:0,m===0?this.compareNonHorizontal_(s,n):m===1?this.compareHorizontal1_(s.m_line,n.m_line):m===2?-1*this.compareHorizontal1_(n.m_line,s.m_line):this.compareHorizontal2_(s.m_line,n.m_line)}if(this.m_bIntersectionDetected)return-1;let i=this.m_prevY===this.m_sweepY&&this.m_prevX===this.m_sweepX,o,a;if(i&&t===this.m_prev1?o=this.m_prevX1:(o=Number.NaN,this.m_prev1=v),i&&e===this.m_prev2?a=this.m_prevX2:(a=Number.NaN,this.m_prev2=v),this.m_prevY=this.m_sweepY,this.m_prevX=this.m_sweepX,Number.isNaN(o)){this.m_prev1=t;let m=s.m_segment.intersectionOfYMonotonicWithAxisX(this.m_sweepY,this.m_sweepX);o=m,this.m_prevX1=m}if(Number.isNaN(a)){this.m_prev2=e;let m=n.m_segment.intersectionOfYMonotonicWithAxisX(this.m_sweepY,this.m_sweepX);a=m,this.m_prevX2=m}let h=Nr(!0,!0,s.m_segment,n.m_segment,this.m_tolerance,!0);return h!==0?h===2?this.m_bIsSimple?this.errorCoincident():s.m_segmentInfo.equals(n.m_segmentInfo)?0:this.errorCracking():this.errorCracking():Math.abs(o-a)<=this.m_tolerance?this.compareTwoSegments_(s.m_segment,n.m_segment):o<a?-1:o>a?1:0}clearIntersectionDetectedFlag(){this.m_bIntersectionDetected=!1}intersectionDetected(){return this.m_bIntersectionDetected}getLastComparedNode(){return this.m_currentNode}getResult(){return this.m_nonSimpleResult}setSweepY(t,e){this.m_sweepY=t,this.m_sweepX=e,this.m_prev1=v,this.m_prev2=v,this.m_vertex1=v,this.m_vertex2=v}compare(t,e,s){if(this.m_bIntersectionDetected)return-1;let n=t.getElement(s),i=e;return this.m_currentNode=s,this.compareSegments(i,i,n,n)}compareSegments(t,e,s,n){let i=this.tryGetCachedEdge_(t);i===null?this.m_vertex1===e?i=this.m_tempSimpleEdge1:(this.m_vertex1=e,i=this.tryCreateCachedEdge_(t),i===null&&(i=this.m_tempSimpleEdge1,this.m_tempSimpleEdge1.m_value=t),this.initSimpleEdge_(i,e)):this.m_vertex1=e;let o=this.tryGetCachedEdge_(s);return o===null?this.m_vertex2===n?o=this.m_tempSimpleEdge2:(this.m_vertex2=n,o=this.tryCreateCachedEdge_(s),o===null&&(o=this.m_tempSimpleEdge2,this.m_tempSimpleEdge2.m_value=s),this.initSimpleEdge_(o,n)):this.m_vertex2=n,this.compareSegments_(e,n,i,o)}onDelete(t){this.tryDeleteCachedEdge_(t)}onSet(t){this.tryDeleteCachedEdge_(t)}onEndSearch(t){this.tryDeleteCachedEdge_(t)}onAddUniqueElementFailed(t){this.tryDeleteCachedEdge_(t)}},oa=class{constructor(t,e){this.m_bIntersectionDetected=!1,this.m_pointOfInterest=y.getNAN(),this.m_line1=new nt,this.m_seg1=null,this.m_env=B.constructEmpty(),this.m_vertex1=-1,this.m_currentNode=-1,this.m_minDist=Number.MAX_VALUE,this.m_shape=t,this.m_tolerance=e}getCurrentNode(){return this.m_currentNode}clearIntersectionDetectedFlag(){this.m_bIntersectionDetected=!1,this.m_minDist=Number.MAX_VALUE}intersectionDetected(){return this.m_bIntersectionDetected}setPoint(t){this.m_pointOfInterest.assign(t)}compare(t,e){let s=t.getElement(e);return this.compareVertex(t,e,s)}compareVertex(t,e,s){let n,i=this.m_shape.getSegment(s),o=!0;if(i==null)this.m_shape.queryLineConnector(s,this.m_line1,!0),this.m_env.setCoordsNoNAN(this.m_line1.getStartX(),this.m_line1.getEndX()),i=this.m_line1,n=this.m_line1.getStartY()===this.m_line1.getEndY();else{let h=V.constructEmpty();i.queryLooseEnvelope(h),h.queryIntervalX(this.m_env),n=h.height()===0,o=!1}if(this.m_pointOfInterest.x+this.m_tolerance<this.m_env.vmin)return-1;if(this.m_pointOfInterest.x-this.m_tolerance>this.m_env.vmax)return 1;if(n)return this.m_currentNode=e,this.m_bIntersectionDetected=!0,0;let a=0;if(o){cm(this.m_line1);let h=this.m_line1.getStartXY(),m=new y;m.setSub(this.m_line1.getEndXY(),h),m.rightPerpendicularThis();let l=new y;l.setSub(this.m_pointOfInterest,h),a=m.dotProduct(l),a/=m.length()}else a=i.intersectionOfYMonotonicWithAxisX(this.m_pointOfInterest.y,this.m_pointOfInterest.x)-this.m_pointOfInterest.x;return a<10*-this.m_tolerance?-1:a>10*this.m_tolerance?1:(i.isIntersectingPoint(this.m_pointOfInterest,this.m_tolerance)&&(Math.abs(a)<this.m_minDist&&(this.m_currentNode=e,this.m_minDist=a),this.m_bIntersectionDetected=!0),a<0?-1:a>0?1:0)}},Ci=class r{constructor(t,e){this.m_lists=new Jt(!1),this.m_hash=e,this.m_hashBuckets=new Int32Array(t),this.m_hashBuckets.fill(r.st_nullNode()),this.m_bitFilter=new Int32Array(10*t+31>>5)}reserveElements(t){this.m_lists.reserveLists(Math.min(this.m_hashBuckets.length,t)),this.m_lists.reserveNodes(t)}addElement(t,e){e===void 0&&(e=this.m_hash.getHash(t));let s=e%(this.m_bitFilter.length<<5);this.m_bitFilter[s>>5]|=1<<(31&s);let n=e%this.m_hashBuckets.length,i=this.m_hashBuckets[n];return i===Jt.st_nullNode()&&(i=this.m_lists.createList(),this.m_hashBuckets[n]=i),this.m_lists.addElement(i,t)}deleteElement(t,e){e===void 0&&(e=this.m_hash.getHash(t));let s=e%this.m_hashBuckets.length,n=this.m_hashBuckets[s];n===Jt.st_nullNode()&&U("");let i=this.m_lists.getFirst(n),o=Jt.st_nullNode();for(;i!==Jt.st_nullNode();){let a=this.m_lists.getData(i),h=this.m_lists.getNext(i);a===t?(this.m_lists.deleteElementDirect(n,o,i),this.m_lists.getFirst(n)===Jt.st_nullNode()&&(this.m_lists.deleteList(n),this.m_hashBuckets[s]=Jt.st_nullNode())):o=i,i=h}}getFirstInBucket(t){let e=t%(this.m_bitFilter.length<<5);if(!(this.m_bitFilter[e>>5]&1<<(31&e)))return Jt.st_nullNode();let s=t%this.m_hashBuckets.length,n=this.m_hashBuckets[s];return n===Jt.st_nullNode()?Jt.st_nullNode():this.m_lists.getFirst(n)}getNextInBucket(t){return this.m_lists.getNext(t)}findNode(t){let e=this.m_hash.getHash(t),s=this.getFirstInBucket(e);for(;s!==Jt.st_nullNode();){let n=this.m_lists.getData(s);if(this.m_hash.equal(n,t))return s;s=this.m_lists.getNext(s)}return Jt.st_nullNode()}deleteNode(t){let e=this.getElement(t),s=this.m_hash.getHash(e)%this.m_hashBuckets.length,n=this.m_hashBuckets[s];n===Jt.st_nullNode()&&U(""),this.m_lists.deleteElementSearch(n,t),this.m_lists.getFirst(n)===Jt.st_nullNode()&&(this.m_lists.deleteList(n),this.m_hashBuckets[s]=Jt.st_nullNode())}getElement(t){return this.m_lists.getData(t)}static st_nullNode(){return Jt.st_nullNode()}clear(){w(0)}size(){return this.m_lists.getNodeCount()}dbgPrintBucketHistogram(){}};function $d(r,t,e,s,n){let i=new ha(n);return i.m_shape=r,i.m_sqrTolerance=t*t,i.m_cellSize=2*t,i.m_invCellSize=1/i.m_cellSize,i.m_geometry=e,i.m_bTrackChanges=s,i.m_bHasSegmentParentage=r.hasSegmentParentage(),i.clusterNonReciprocal()}function Ul(r,t,e,s,n){let i=r-e,o=t-s;return i*i+o*o<=n}function x1(){return{pt:new y,weight:0,rank:0,bMerged:!1}}function Jd(r,t,e,s,n,i){let o=x1(),a=e+n,h=!1,m=r.x;r.x!==t.x&&(s===i&&(m=(r.x*e+t.x*n)/a),h=!0);let l=r.y;return r.y!==t.y&&(s===i&&(l=(r.y*e+t.y*n)/a),h=!0),s!==i?s>i?(o.rank=s,o.weight=e,o.pt=r):(o.rank=i,o.weight=n,o.pt=t):(o.pt.setCoords(m,l),o.weight=a,o.rank=s),o.bMerged=h,o}function y1(r,t,e,s,n,i,o,a,h){let m=r.equals(t);if(s>i)return o.assignCopy(r),h[0]=s,a[0]=e,m;if(i>s)return o=t,h[0]=i,a[0]=n,m;o.assignCopy(r);let l=Jd(r.getXY(),t.getXY(),e,s,n,i);return o.setXY(l.pt),a[0]=l.weight,h[0]=l.rank,m}function P1(r,t,e,s,n){let i=new ha(n);return i.m_shape=r,i.m_sqrTolerance=t*t,i.m_cellSize=2*t,i.m_invCellSize=1/i.m_cellSize,i.m_geometry=e,i.m_bTrackChanges=!1,i.needsClustering()}function t_(r,t){let e=vu(r);return Iu(e,t)}var aa=class{constructor(t,e,s,n,i){this.m_workPt=new y,this.m_shape=t,this.m_sqrTolerance=s,this.m_invCellSize=n,this.m_origin=e.clone(),this.m_hashValues=i}getHash(t){return this.m_shape.getUserIndex(t,this.m_hashValues)}calculateHashFromVertex(t){this.m_shape.queryXY(t,this.m_workPt);let e=this.m_workPt.x-this.m_origin.x,s=Math.trunc(e*this.m_invCellSize+.5),n=this.m_workPt.y-this.m_origin.y;return t_(s,Math.trunc(n*this.m_invCellSize+.5))}equal(t,e){return w(0),!1}},ha=class{constructor(t){this.m_origin=y.getNAN(),this.m_sqrTolerance=0,this.m_cellSize=0,this.m_invCellSize=0,this.m_geometry=v,this.m_bucketArray=Z(4,Number.NaN),this.m_bucketHash=Z(4,Number.NaN),this.m_dbgCandidateCheckCount=0,this.m_nsr=new vt,this.m_hashValues=-1,this.m_newClusters=-1,this.m_bTrackChanges=!1,this.m_bHasSegmentParentage=!1,this.m_shape=null,this.m_clusters=new Jt,this.m_hashFunction=null,this.m_hashTable=null,this.m_progressCounter=0,this.m_progressTracker=t}progress_(){}collectClusterCandidates(t,e){let s=y.getNAN();this.m_shape.queryXY(t,s);let n=(s.x-this.m_origin.x)*this.m_invCellSize,i=(s.y-this.m_origin.y)*this.m_invCellSize,o=Math.trunc(n),a=Math.trunc(i),h=0;for(let m=0;m<=1;m+=1)for(let l=0;l<=1;l+=1){let u=t_(o+m,a+l),c=this.m_hashTable.getFirstInBucket(u);c!==Ci.st_nullNode()&&(this.m_bucketArray[h]=c,this.m_bucketHash[h]=u,h++)}for(let m=h-1;m>=1;m--){let l=this.m_bucketArray[m];for(let u=m-1;u>=0;u--)if(l===this.m_bucketArray[u]){this.m_bucketHash[u]=-1,h--,m!==h&&(this.m_bucketHash[m]=this.m_bucketHash[h],this.m_bucketArray[m]=this.m_bucketArray[h]);break}}for(let m=0;m<h;m++)this.collectNearestNeighbourCandidates(t,this.m_bucketHash[m],s,this.m_bucketArray[m],e)}collectNearestNeighbourCandidates(t,e,s,n,i){let o=y.getNAN();for(let a=n;a!==Ci.st_nullNode();a=this.m_hashTable.getNextInBucket(a)){let h=this.m_hashTable.getElement(a);t===h||e!==-1&&this.m_shape.getUserIndex(h,this.m_hashValues)!==e||(this.m_shape.queryXY(h,o),Ul(s.x,s.y,o.x,o.y,this.m_sqrTolerance)&&i.push(a))}}mergeClusters(t,e,s){let n=this.m_shape.getUserIndex(t,this.m_newClusters),i=this.m_shape.getUserIndex(e,this.m_newClusters);n===-1&&(n=this.m_clusters.createList(),this.m_clusters.addElement(n,t),this.m_shape.setUserIndex(t,this.m_newClusters,n)),i===-1?this.m_clusters.addElement(n,e):this.m_clusters.concatenateLists(n,i),this.m_shape.setUserIndex(e,this.m_newClusters,Rt.impossibleIndex2());let o=this.mergeVertices(t,e);if(s){let a=this.m_hashFunction.calculateHashFromVertex(t);this.m_shape.setUserIndex(t,this.m_hashValues,a)}return o}mergeVertices(t,e){let s=y.getNAN();this.m_shape.queryXY(t,s);let n=y.getNAN();this.m_shape.queryXY(e,n);let i=this.m_shape.getRank(t),o=this.m_shape.getRank(e),a=this.m_shape.getWeight(t),h=this.m_shape.getWeight(e),m,l,u,c,g=!1;if(i===o?(m=i,l=a+h,u=s.x,s.x!==n.x&&(u=(s.x*a+n.x*h)/l,g=!0),c=s.y,s.y!==n.y&&(c=(s.y*a+n.y*h)/l,g=!0)):(i>o?(u=s.x,c=s.y,l=a,m=i):(u=n.x,c=n.y,l=h,m=o),g=!s.equals(n)),g&&(this.m_shape.setXYMonotonic(t,u,c),this.m_bTrackChanges&&this.m_shape.setGeometryModifiedWithVertex(t,!0),this.m_bHasSegmentParentage)){let d=this.m_shape.getSegmentParentageBreakVertex(t)||this.m_shape.getSegmentParentageBreakVertex(e);this.m_shape.setSegmentParentageBreakVertex(t,d),this.m_shape.setSegmentParentageBreakVertex(e,d)}return this.m_shape.setWeight(t,l),this.m_shape.setRank(t,m),g}needsClustering(){let t={stack:[],error:void 0,hasError:!1};try{xe(t,Qa(()=>{this.m_hashTable=null,this.m_hashFunction=null,this.m_shape.removeUserIndex(this.m_hashValues),this.m_shape.removeUserIndex(this.m_newClusters)}),!1);let e=this.m_shape.getSelectedCount(),s=this.m_shape.getEnvelope2D(this.m_progressTracker);this.m_origin.assign(s.getLowerLeft());let n=Math.max(s.height(),s.width())/(Pe()-1);this.m_cellSize<n&&(this.m_cellSize=n,this.m_invCellSize=1/this.m_cellSize),this.m_clusters.clear(),this.m_clusters.reserveLists(this.m_shape.getSelectedCount()/3+1),this.m_clusters.reserveNodes(this.m_shape.getSelectedCount()/3+1),this.m_hashValues=this.m_shape.createUserIndex(),this.m_newClusters=this.m_shape.createUserIndex(),this.m_hashFunction=new aa(this.m_shape,this.m_origin,this.m_sqrTolerance,this.m_invCellSize,this.m_hashValues),this.m_hashTable=new Ci(4*e/3,this.m_hashFunction),this.m_hashTable.reserveElements(this.m_shape.getSelectedCount());let i=!1;for(let o=0;o<2;o++){let a=[],h=this.m_shape.queryVertexIteratorOnSelection(this.m_geometry);for(let m=h.next();m!==v;m=h.next()){if(this.progress_(),o>0&&this.m_shape.getUserIndex(m,this.m_newClusters)===Rt.impossibleIndex2())continue;let l;if(o===0?(l=this.m_hashFunction.calculateHashFromVertex(m),this.m_shape.setUserIndex(m,this.m_hashValues,l)):l=this.m_shape.getUserIndex(m,this.m_hashValues),this.collectClusterCandidates(m,a),a.length!==0){for(let u=0,c=a.length;u<c;u++){this.progress_();let g=a[u],d=this.m_hashTable.getElement(g);if(this.m_hashTable.deleteNode(g),!this.m_shape.isEqualXY(m,d))return this.m_nsr=new vt(5,this.m_shape.getVertexIndex(m),this.m_shape.getVertexIndex(d)),i=!0,i;this.mergeClusters(m,d,!1)}a.length=0}o===0&&this.m_hashTable.addElement(m,l)}}return i}catch(e){t.error=e,t.hasError=!0}finally{qs(t)}}clusterNonReciprocal(){let t=this.m_shape.getSelectedCount(),e=this.m_shape.getEnvelope2D(this.m_progressTracker);this.m_origin=e.getLowerLeft();let s=Math.max(e.height(),e.width())/(Pe()-1);this.m_cellSize<s&&(this.m_cellSize=s,this.m_invCellSize=1/this.m_cellSize),this.m_clusters.clear(),this.m_clusters.reserveLists(Math.trunc(this.m_shape.getSelectedCount()/3+1)),this.m_clusters.reserveNodes(Math.trunc(this.m_shape.getSelectedCount()/3+1)),this.m_hashValues=this.m_shape.createUserIndex(),this.m_newClusters=this.m_shape.createUserIndex(),this.m_hashFunction=new aa(this.m_shape,this.m_origin,this.m_sqrTolerance,this.m_invCellSize,this.m_hashValues),this.m_hashTable=new Ci(Math.trunc(4*t/3),this.m_hashFunction),this.m_hashTable.reserveElements(this.m_shape.getSelectedCount());let n=!1;{let i=this.m_shape.queryVertexIteratorOnSelection(this.m_geometry);for(let o=i.next();o!==v;o=i.next()){this.progress_();let a=this.m_hashFunction.calculateHashFromVertex(o);this.m_shape.setUserIndex(o,this.m_hashValues,a),this.m_hashTable.addElement(o,a)}}{let i=[],o=this.m_shape.queryVertexIteratorOnSelection(this.m_geometry);for(let a=o.next();a!==v;a=o.next()){if(this.m_shape.getUserIndex(a,this.m_newClusters)===Rt.impossibleIndex2())continue;let h=this.m_shape.getUserIndex(a,this.m_hashValues);this.m_hashTable.deleteElement(a,h);let m=!1;for(;this.collectClusterCandidates(a,i),i.length!==0;){let l=0;for(let u=0,c=i.length;u<c;u++){this.progress_();let g=i[u],d=this.m_hashTable.getElement(g);this.m_hashTable.deleteNode(g);let _=u+1===c;l|=this.mergeClusters(a,d,_)?1:0}if(m||=l!==0,n||=l!==0,i.length=0,!l)break}m&&(h=this.m_shape.getUserIndex(a,this.m_hashValues)),this.m_hashTable.addElement(a,h)}i.length=0}return n&&this.applyClusterPositions_(),this.m_hashTable=null,this.m_hashFunction=null,this.m_shape.removeUserIndex(this.m_hashValues),this.m_shape.removeUserIndex(this.m_newClusters),n}applyClusterPositions_(){let t=y.getNAN();for(let e=this.m_clusters.getFirstList();e!==Jt.st_nullNode();e=this.m_clusters.getNextList(e)){let s=this.m_clusters.getFirst(e),n=this.m_clusters.getElement(s);this.m_shape.queryXY(n,t);let i=this.m_shape.getRank(n),o=this.m_shape.getWeight(n);for(s=this.m_clusters.getNext(s);s!==Jt.st_nullNode();s=this.m_clusters.getNext(s)){let a=this.m_clusters.getElement(s);if(this.m_bTrackChanges?this.m_shape.isEqualXYPoint2D(a,t)||(this.m_shape.setXYMonotonicPoint2D(a,t),this.m_shape.setGeometryModifiedWithVertex(a,!0)):this.m_shape.setXYMonotonicPoint2D(a,t),this.m_bHasSegmentParentage){let h=this.m_shape.getSegmentParentageBreakVertex(n)||this.m_shape.getSegmentParentageBreakVertex(a);this.m_shape.setSegmentParentageBreakVertex(n,h),this.m_shape.setSegmentParentageBreakVertex(a,h)}this.m_shape.setWeight(a,o),this.m_shape.setRank(a,i)}}}},$e=class r{constructor(){this.m_inputParts=[],this.m_resultParts1=[],this.m_resultParts2=[],this.m_resultSegments=[],this.m_freeSegments=[],this.m_inputSegments=[],this.m_param1=[],this.m_param2=[],this.m_tolerance=0,this.m_toleranceZ=0,this.m_point=new st,this.m_pointWeight=1,this.m_maxDensifyLimit=0,this.m_pointRank=0,this.m_changed1=!1,this.m_changed2=!1,this.m_adaptiveDensify=!1}clear(){this.freeAllResultSegments(),this.m_inputSegments.length=0,this.m_inputParts.length=0,this.m_resultParts1.length=0,this.m_resultParts2.length=0,this.m_param1.length=0,this.m_param2.length=0,this.m_adaptiveDensify=!1,this.m_changed1=!1,this.m_changed2=!1}newIntersectionPart_(t,e,s,n,i,o,a,h,m,l){return E1(t,e,s,n,i,o,a,h,m,l)}pushSegment(t,e,s,n,i,o,a,h,m,l){return this.m_inputParts.push(this.newIntersectionPart_(this.m_inputSegments.length,e,s,n,i,o,a,h,m,l)),this.m_inputSegments.push(t),this.m_inputParts.length-1}getResultSegmentCount(t){return this.m_adaptiveDensify?t===0?this.m_param1.length-1:this.m_param2.length-1:t===0?this.m_resultParts1.length:this.m_resultParts2.length}getResultPart_(t,e){return t===0?this.m_resultParts1[e]:this.m_resultParts2[e]}getResultSegment(t,e){return this.m_resultSegments[this.getResultPart_(t,e).segmentIndex].get()}getSegmentChanged(t){return t===0?this.m_changed1:this.m_changed2}getResultSegmentStartPointWeight(t,e){return this.getResultPart_(t,e).weightStart}getResultSegmentStartPointRank(t,e){return this.getResultPart_(t,e).rankStart}getResultSegmentSegmentParentage(t,e){return this.getResultPart_(t,e).segmentParentage}getResultSegmentStartPointIsBreak(t,e){return this.getResultPart_(t,e).u.bBreakStart}getResultSegmentEndPointWeight(t,e){return this.getResultPart_(t,e).weightEnd}getResultSegmentEndPointRank(t,e){return this.getResultPart_(t,e).rankEnd}getResultSegmentEndPointIsBreak(t,e){return this.getResultPart_(t,e).u.bBreakEnd}getResultSegmentInteriorRank(t,e){return this.getResultPart_(t,e).rankInterior}getResultSegmentInteriorWeight(t,e){return this.getResultPart_(t,e).weightInterior}getResultPoint(){return this.m_point}getResultPointWeight(){return this.m_pointWeight}getResultPointRank(){return this.m_pointRank}getResultPointChanged(){return this.m_changed2}intersectLines(t,e){this.m_inputSegments.length!==2&&j(""),this.m_changed1=!1,this.m_changed2=!1,this.m_tolerance=t;let s=Et(t*r.c_smallToleranceFactor),n=!1,i=this.m_inputParts[0],o=this.m_inputParts[1],a=this.m_inputSegments[i.segmentIndex],h=this.m_inputSegments[o.segmentIndex];if(e||5&Hn(!0,a,h,t,!0)){let m=Pn(!0,a,h,null,this.m_param1,this.m_param2,t);m===0&&j("");let l=new Array(m);for(let S=0;S<m;++S)l[S]=y.getNAN();let u=new Float64Array(m),c=new Int32Array(m),g=new Array(m),d=new Array(m);for(let S=0;S<m;++S)g[S]=ma(),d[S]=ma();for(let S=0;S<m;S++){let I=this.m_param1[S],D=this.m_param2[S],b,T=i.rankInterior,A=i.weightInterior;I===0?(T=i.rankStart,A=i.weightStart,b=i.u.bBreakStart):I===1?(T=i.rankEnd,A=i.weightEnd,b=i.u.bBreakEnd):(this.m_changed1=!0,b=!1);let G,F=o.rankInterior,M=o.weightInterior;D===0?(F=o.rankStart,M=o.weightStart,G=o.u.bBreakStart):D===1?(F=o.rankEnd,M=o.weightEnd,G=o.u.bBreakEnd):(this.m_changed2=!0,G=!1);let q=T,R=F,X=1,z=0,Y=y.getNAN();if(q===R){let L=a.getCoord2D(I),W=h.getCoord2D(D);X=A+M,z=T,qt(L,W,M/X,Y);let K=y.sqrDistance(Y,L),yt=y.sqrDistance(Y,W);g[S].bBigMove=K>s,d[S].bBigMove=yt>s,this.m_changed1||L.equals(Y)||(this.m_changed1=!0),this.m_changed2||W.equals(Y)||(this.m_changed2=!0)}else if(q>R){Y=a.getCoord2D(I);let L=h.getCoord2D(D);X=A,z=T;let W=y.sqrDistance(Y,L);g[S].bBigMove=!1,d[S].bBigMove=W>s,this.m_changed2||L.equals(Y)||(this.m_changed2=!0)}else{Y=h.getCoord2D(D),X=M,z=F;let L=a.getCoord2D(I),W=y.sqrDistance(Y,L);g[S].bBigMove=W>s,d[S].bBigMove=!1,this.m_changed1||L.equals(Y)||(this.m_changed1=!0)}l[S].assign(Y),u[S]=X,c[S]=z,g[S].bIsBreak=b||G,d[S].bIsBreak=b||G,n||=g[S].bBigMove||d[S].bBigMove}let _=i.rankInterior,p=i.weightInterior,f=0,x=-1;for(let S=0;S<=m;S++){let I=S<m?this.m_param1[S]:1;if(I!==f){let D=this.allocResultSegment(),b=this.m_resultSegments[D],T,A,G,F;a.queryCut(f,I,b,!1),b.get().snapControlPoints(t*t);let M=!1,q=!1,R=!1,X=!1,z=!1,Y=y.getNAN(),L=y.getNAN();x!==-1?(A=c[x],T=u[x],M=g[x].bBigMove,Y.assign(l[x]),R=g[x].bIsBreak,z=!0):(T=i.weightStart,A=i.rankStart,Y=b.get().getStartXY(),R=i.u.bBreakStart),S<m?(F=c[S],G=u[S],q=g[S].bBigMove,L.assign(l[S]),X=g[S].bIsBreak,z=!0):(G=i.weightEnd,F=i.rankEnd,L=b.get().getEndXY(),X=i.u.bBreakEnd),z&&b.get().setCoordsForIntersector(Y,L,!0),this.m_resultParts1.push(this.newIntersectionPart_(D,T,A,G,F,p,_,R,X,i.segmentParentage));let W=this.m_resultParts1.at(-1);W.u.bBigMoveStart=M,W.u.bBigMoveEnd=q,f=I,x=S}else x===-1&&(x=S)}let C=Z(m,0);for(let S=0;S<m;S++)C[S]=S;m>2?(C.sort((S,I)=>this.m_param2[S]<this.m_param2[I]?-1:this.m_param2[S]>this.m_param2[I]?1:0),Nn(this.m_param2)):m===2&&this.m_param2[0]>this.m_param2[1]&&(this.m_param2[1]=O(this.m_param2[0],this.m_param2[0]=this.m_param2[1]),C[1]=O(C[0],C[0]=C[1]));let P=o.rankInterior,E=o.weightInterior;f=0,x=-1;for(let S=0;S<=m;S++){let I=S<m?this.m_param2[S]:1;if(I!==f){let D=this.allocResultSegment(),b=this.m_resultSegments[D],T,A,G,F;h.queryCut(f,I,b,!1),b.get().snapControlPoints(t*t);let M=y.getNAN(),q=y.getNAN(),R=!1,X=!1,z=!1,Y=!1,L=!1;if(x!==-1){let K=C[x];T=u[K],A=c[K],M.assign(l[K]),z=d[K].bBigMove,R=d[K].bIsBreak,L=!0}else T=o.weightStart,A=o.rankStart,M=b.get().getStartXY(),R=o.u.bBreakStart;if(S!==m){let K=C[S];G=u[K],F=c[K],q.assign(l[K]),Y=d[K].bBigMove,X=d[K].bIsBreak,L=!0}else G=o.weightEnd,F=o.rankEnd,q=b.get().getEndXY(),X=o.u.bBreakEnd;L&&b.get().setCoordsForIntersector(M,q,!0),this.m_resultParts2.push(this.newIntersectionPart_(D,T,A,G,F,E,P,R,X,o.segmentParentage));let W=this.m_resultParts2.at(-1);W.u.bBigMoveStart=z,W.u.bBigMoveEnd=Y,f=I,x=S}else x===-1&&(x=S)}return n?3:2}return 0}intersectLines3D(t,e,s,n){return w(0),1}intersect2D(t,e){let s=this.m_inputParts[0],n=this.m_inputParts[1],i=this.m_inputSegments[s.segmentIndex].getGeometryType(),o=this.m_inputSegments[n.segmentIndex].getGeometryType();return i!==N.enumLine||o!==N.enumLine?new el(this).intersectCurves(t,e):this.intersectLines(t,e)}intersect2DEx(t,e,s,n,i){this.m_point.assignCopy(e),this.m_inputSegments.length!==1&&j(""),this.m_tolerance=t,this.m_changed1=!1,this.m_changed2=!1;let o=Et(t*r.c_smallToleranceFactor),a=!1,h=this.m_inputParts[0],m=this.m_inputSegments[h.segmentIndex];if(i||m.isIntersectingPoint(e.getXY(),t,!0)){this.m_param1=Z(16,Number.NaN);let l=m.getClosestCoordinate(e.getXY(),!1);this.m_param1[0]=l;let u=h.rankInterior,c=h.weightInterior;l===0?(u=h.rankStart,c=h.weightStart):l===1?(u=h.rankEnd,c=h.weightEnd):this.m_changed1=!0;let g=u,d=s,_=n;g===d&&m.isCurve()&&(g=d+1);let p=1,f=0,x=new y;if(g===d){let S=m.getCoord2D(l),I=e.getXY();p=c+_,f=u,qt(S,I,_/p,x),this.m_changed1||S.equals(x)||(this.m_changed1=!0),this.m_changed2||I.equals(x)||(this.m_changed2=!0),a=y.sqrDistance(x,S)>o}else g>d?(x.assign(m.getCoord2D(l)),p=c,f=u,this.m_changed2||x.equals(e.getXY())||(this.m_changed2=!0)):(x.assign(m.getCoord2D(l)),p=_,f=d,this.m_changed1||x.equals(e.getXY())||(this.m_changed1=!0),a=y.sqrDistance(x,e.getXY())>o);let C=0,P=-1,E=1;for(let S=0;S<=E;S++){let I=S<E?this.m_param1[0]:1;if(I!==C){let D=this.allocResultSegment(),b=this.m_resultSegments[D];m.queryCut(C,I,b),b.get().snapControlPoints(t*t);let T=h.weightStart,A=h.weightEnd,G=h.rankStart,F=h.rankEnd,M=h.rankInterior,q=h.weightInterior,R=h.u.bBreakStart,X=h.u.bBreakEnd;P!==-1&&(T=p,G=f,R=!0,b.get().setCoordsForIntersector(x,b.get().getEndXY(),!0)),S!==E&&(A=p,F=f,X=!0,b.get().setCoordsForIntersector(b.get().getStartXY(),x,!0)),C=I,this.m_resultParts1.push(this.newIntersectionPart_(D,T,G,A,F,q,M,R,X,h.segmentParentage))}P=S}return this.m_point.setXY(x),this.m_pointWeight=p,this.m_pointRank=f,a?3:2}return 0}intersect3D(t,e,s,n){return w(0),1}intersect3DEx(t,e,s,n,i,o,a){return w(0),1}getTolerance(){return this.m_tolerance}freeAllResultSegments(){this.m_resultSegments.length=0,this.m_freeSegments.length=0}freeResultSegment(t){this.m_freeSegments.push(t)}allocResultSegment(){if(this.m_freeSegments.length)return this.m_freeSegments.pop();let t=new et,e=this.m_resultSegments.length;return this.m_resultSegments.push(t),e}allocResultSegmentFromBuffer(t){if(this.m_freeSegments.length)return this.m_freeSegments.pop();let e=new et({copy:t}),s=this.m_resultSegments.length;return this.m_resultSegments.push(e),s}allocResultSegmentFromSegment(t){if(this.m_freeSegments.length)return this.m_freeSegments.pop();let e=new et({segment:t}),s=this.m_resultSegments.length;return this.m_resultSegments.push(e),s}};function C1(r,t){return{bBigMoveStart:!1,bBigMoveEnd:!1,bBreakStart:r,bBreakEnd:t}}function E1(r,t,e,s,n,i,o,a,h,m){return{segmentIndex:r,weightStart:t,rankStart:e,weightEnd:s,rankEnd:n,weightInterior:i,rankInterior:o,segmentParentage:m,u:C1(a,h)}}function ma(){return{bBigMove:!1,bIsBreak:!1}}$e.maxWeight=.1*Number.MAX_VALUE,$e.c_smallToleranceFactor=.01,$e.c_maxGeometryTypeToRankDelta=8;var Wg=class{constructor(){this.start=null,this.end=null,this.equalEdge=null,this.segmentIndex=-1,this.segmentParentage=-1,this.weight=0,this.rank=0}hasSegment(){return this.segmentIndex>=0}transferAttributes(r,t,e){if(t.getDescription().getAttributeCount()===1)return;let s=r.parent.m_resultSegments[this.segmentIndex].get().getStartXY(),n=r.parent.m_resultSegments[this.segmentIndex].get().getEndXY(),i=new st;t.queryStart(i),e?(i.setXY(s),r.parent.m_resultSegments[this.segmentIndex].get().setStart(i)):(i.setXY(n),r.parent.m_resultSegments[this.segmentIndex].get().setEnd(i)),t.queryEnd(i),e?(i.setXY(n),r.parent.m_resultSegments[this.segmentIndex].get().setEnd(i)):(i.setXY(s),r.parent.m_resultSegments[this.segmentIndex].get().setStart(i))}copyFromWhenOverlap(r,t,e){this.equalEdge=t,t.equalEdge=this,this.segmentIndex=r.parent.allocResultSegmentFromBuffer(r.parent.m_resultSegments[t.segmentIndex]),this.segmentParentage=t.segmentParentage,this.weight=t.weight,this.rank=t.rank,e?(this.start.copyFrom(t.start),this.end.copyFrom(t.end)):(this.start.copyFrom(t.end),this.end.copyFrom(t.start),r.parent.m_resultSegments[this.segmentIndex].get().reverse())}getEnd(){return this.end}getNextInChain(){return this.end.nextInChain}getPrevInChain(){return this.start.prevInChain}},la=class{constructor(){this.hash=0,this.pt=new y,this.prevInChain=null,this.nextInChain=null,this.prevInHash=null,this.nextInHash=null,this.prevEqual=null,this.nextEqual=null,this.weight=0,this.rank=0,this.bBigMove=!1,this.bIsBreak=!1}copyFrom(t){this.pt.assign(t.pt),this.weight=t.weight,this.rank=t.rank,this.bBigMove=t.bBigMove,this.bIsBreak=t.bIsBreak}nextNode(){return this.nextInChain?this.nextInChain.end:null}prevNode(){return this.prevInChain?this.prevInChain.start:null}equalListHead(){let t=this;for(;t.prevEqual!==null;t=t.prevEqual);return t}};function Cn(r,t,e,s){return{edge1:r,edge2:t,recursion:e,bIsIntersecting:s}}var el=class{constructor(t){this.m_pairs=[],this.m_chainOrigin1=null,this.m_chainOrigin2=null,this.m_newNodes=[],this.m_hashTableOfEquals=[],this.m_hashTableOfEqualsSize=0,this.m_origin=new y,this.m_cell=new y,this.parent=t}addSegment(t,e,s,n,i,o,a,h,m,l,u){let c=this.newNode(this.parent.m_resultSegments[t].get().getStartXY(),s,n,m),g=this.newNode(this.parent.m_resultSegments[t].get().getEndXY(),i,o,l);this.newEdge(c,g,t,a,h,u),this.m_chainOrigin1===null?this.m_chainOrigin1=c:this.m_chainOrigin2===null?this.m_chainOrigin2=c:w(0)}intersectCurvesHelper(t,e,s,n,i){let o=this.getSegment(t).get(),a=this.getSegment(e).get();if(o.isDegenerate(0)||a.isDegenerate(0))return 0;let h=this.tryOverlapIntersectCurves(t,e,s,n);if(h!==0)return h;let m=Et(.01*s),l=!1,u=this.processSharpCorners(o,a,s,i>4),c=u>0;if(!c){if(!(n||5&Nr(!0,!1,o,a,s,!0)))return 0;u=Pn(!0,o,a,null,this.parent.m_param1,this.parent.m_param2,s)}u===0&&j("");let g=o.getGeometryType(),d=a.getGeometryType(),_=k(y,u),p=k(y,u),f=Z(u,Number.NaN),x=Z(u,Number.NaN),C=Z(u,Number.NaN),P=Z(u,Number.NaN),E=$a(ma,u),S=$a(ma,u),I=!1,D=!1;for(let Y=0;Y<u;Y++){let L=this.parent.m_param1[Y],W=this.parent.m_param2[Y],K=t.rank,yt=t.weight,rt=!0,Q=!1;L===0?(K=t.start.rank,yt=t.start.weight,Q=t.start.bIsBreak):L===1?(K=t.end.rank,yt=t.end.weight,Q=t.end.bIsBreak):(I=!0,rt=!1);let ht=e.rank,it=e.weight,mt=!1,De=!0;W===0?(ht=e.start.rank,it=e.start.weight,mt=e.start.bIsBreak):W===1?(ht=e.end.rank,it=e.end.weight,mt=e.end.bIsBreak):(D=!0,De=!1);let ue=K,ce=ht;if(ue===ce&&(ue*=$e.c_maxGeometryTypeToRankDelta,ce*=$e.c_maxGeometryTypeToRankDelta,ue+=xi(g,o,!1),ce+=xi(d,a,!1)),rt&&De&&ce===ue){let Vs=o.getCoord2D(L),Ai=a.getCoord2D(W);Vs.equals(Ai)&&(ce=ue-1)}let Vt=1,Xe=0,Zt=1,gs=0,Bt=new y,fe=new y,es=o.getCoord2D(L),ss=a.getCoord2D(W);if(c&&y.distance(es,ss)>s)Bt.setCoordsPoint2D(es),fe.setCoordsPoint2D(ss),Vt=yt,Zt=it,Xe=K,gs=ht,E[Y].bBigMove=!1,S[Y].bBigMove=!1,Q=!0,mt=!0;else if(ue===ce){Zt=Vt=yt+it,gs=Xe=K,qt(es,ss,it/Vt,Bt),fe.setCoordsPoint2D(Bt);let Vs=y.sqrDistance(Bt,es),Ai=y.sqrDistance(Bt,ss);E[Y].bBigMove=Vs>m,S[Y].bBigMove=Ai>m,I||es.equals(Bt)||(I=!0),D||ss.equals(fe)||(D=!0)}else if(ue>ce){Bt.setCoordsPoint2D(es),fe.setCoordsPoint2D(Bt),Zt=Vt=yt,gs=Xe=K;let Vs=y.sqrDistance(Bt,ss);E[Y].bBigMove=!1,S[Y].bBigMove=Vs>m,D||ss.equals(fe)||(D=!0)}else{fe.setCoordsPoint2D(ss),Bt.setCoordsPoint2D(fe),Zt=Vt=it,gs=Xe=ht;let Vs=y.sqrDistance(Bt,es);E[Y].bBigMove=Vs>m,S[Y].bBigMove=!1,I||es.equals(Bt)||(I=!0)}_[Y].assign(Bt),p[Y].assign(fe),f[Y]=Vt,x[Y]=Zt,C[Y]=Xe,P[Y]=gs,E[Y].bIsBreak=Q||mt,S[Y].bIsBreak=Q||mt,l||=E[Y].bBigMove||S[Y].bBigMove,Y>0&&(L!==this.parent.m_param1[Y-1]&&W!==this.parent.m_param2[Y-1]||(C[Y]<=C[Y-1]?(_[Y].assign(p[Y-1]),f[Y]=x[Y-1],C[Y]=P[Y-1],p[Y].assign(p[Y-1]),x[Y]=x[Y-1],P[Y]=P[Y-1],E[Y].bBigMove||=E[Y-1].bBigMove,S[Y].bBigMove||=S[Y-1].bBigMove,E[Y].bIsBreak||=E[Y-1].bIsBreak,S[Y].bIsBreak||=S[Y-1].bIsBreak):(_[Y-1].assign(_[Y]),f[Y-1]=f[Y],C[Y-1]=C[Y],p[Y-1].assign(p[Y]),x[Y-1]=x[Y],P[Y-1]=P[Y],E[Y-1].bBigMove||=E[Y].bBigMove,S[Y-1].bBigMove||=S[Y].bBigMove,E[Y-1].bIsBreak||=E[Y].bIsBreak,S[Y-1].bIsBreak||=S[Y].bIsBreak)))}if(!(I||D||u!==2||g===N.enumLine&&d===N.enumLine)){if(this.processDoublyConnectedEdges(t,e,i+1,s))return this.parent.m_changed1=!0,this.parent.m_changed2=!0,2;w(0)}this.parent.m_changed1||=I,this.parent.m_changed2||=D;let b=t,T=t.end.weight,A=t.end.rank,G=t.end.bBigMove,F=t.end.bIsBreak,M=0,q=-1;for(let Y=0;Y<=u;Y++){let L=Y<u?this.parent.m_param1[Y]:1;if(L!==M){let W=this.parent.allocResultSegment(),K=this.parent.m_resultSegments[W],yt,rt,Q,ht;o.queryCut(M,L,K,!1),K.get().snapControlPoints(s*s);let it=!1,mt=!1,De=!1,ue=!1,ce=new y,Vt=new y;q!==-1?(rt=C[q],yt=f[q],De=E[q].bBigMove,it=E[q].bIsBreak,ce.assign(_[q])):(yt=t.start.weight,rt=t.start.rank,De=t.start.bBigMove,it=t.start.bIsBreak,ce.assign(K.get().getStartXY())),Y<u?(ht=C[Y],Q=f[Y],ue=E[Y].bBigMove,mt=E[Y].bIsBreak,Vt.assign(_[Y])):(Q=T,ht=A,ue=G,mt=F,Vt.assign(K.get().getEndXY()));let Xe=b;L<1&&(this.splitEdgeInPlace(b),Xe=b.getNextInChain()),this.updateSegmentOnly(b,W),b.start.hash===0||b.start.pt.equals(ce)||(this.m_newNodes.push(b.start),this.removeNodeFromHash(b.start),b.start.hash=0),b.end.hash===0||b.end.pt.equals(Vt)||(this.m_newNodes.push(b.end),this.removeNodeFromHash(b.end),b.end.hash=0),b.start.pt.assign(ce),b.end.pt.assign(Vt),b.start.bBigMove||=De,b.end.bBigMove||=ue,b.start.bIsBreak||=it,b.end.bIsBreak||=mt,b.start.weight=yt,b.start.rank=rt,b.end.weight=Q,b.end.rank=ht,b=Xe,M=L,q=Y}else q===-1&&(q=Y)}let R=b.getNextInChain(),X=[];X.length=u;for(let Y=0;Y<u;Y++)X[Y]=Y;u>2?(X.sort((Y,L)=>_s(this.parent.m_param2[Y],this.parent.m_param2[L])),this.parent.m_param2.sort(_s)):u===2&&this.parent.m_param2[0]>this.parent.m_param2[1]&&(this.parent.m_param2[1]=O(this.parent.m_param2[0],this.parent.m_param2[0]=this.parent.m_param2[1]),X[1]=O(X[0],X[0]=X[1])),b=e,T=e.end.weight,A=e.end.rank,G=e.end.bBigMove,F=e.end.bIsBreak,M=0,q=-1;for(let Y=0;Y<=u;Y++){let L=Y<u?this.parent.m_param2[Y]:1;if(L!==M){let W=this.parent.allocResultSegment(),K=this.parent.m_resultSegments[W],yt,rt,Q,ht;a.queryCut(M,L,K,!1),K.get().snapControlPoints(s*s);let it=new y,mt=new y,De=!1,ue=!1,ce=!1,Vt=!1;if(q!==-1){let Zt=X[q];yt=x[Zt],rt=P[Zt],it.assign(p[Zt]),ce=S[Zt].bBigMove,De=S[Zt].bIsBreak}else yt=e.start.weight,rt=e.start.rank,ce=e.start.bBigMove,De=e.start.bIsBreak,it.assign(K.get().getStartXY());if(Y!==u){let Zt=X[Y];Q=x[Zt],ht=P[Zt],mt.assign(p[Zt]),Vt=S[Zt].bBigMove,ue=S[Zt].bIsBreak}else Q=T,ht=A,Vt=G,ue=F,mt.assign(K.get().getEndXY());let Xe=b;L<1&&(this.splitEdgeInPlace(b),Xe=b.getNextInChain()),this.updateSegmentOnly(b,W),b.start.hash===0||b.start.pt.equals(it)||(this.m_newNodes.push(b.start),this.removeNodeFromHash(b.start),b.start.hash=0),b.end.hash===0||b.end.pt.equals(mt)||(this.m_newNodes.push(b.end),this.removeNodeFromHash(b.end),b.end.hash=0),b.start.pt.assign(it),b.end.pt.assign(mt),b.start.bBigMove||=ce,b.end.bBigMove||=Vt,b.start.bIsBreak||=De,b.end.bIsBreak||=ue,b.start.weight=yt,b.start.rank=rt,b.end.weight=Q,b.end.rank=ht,b=Xe,M=L,q=Y}else q===-1&&(q=Y)}let z=b.getNextInChain();return this.postProcessResultPartsForCurves(t,R,e,z,i+1),l?3:2}intersectCurves(t,e){this.parent.m_inputSegments.length!==2&&j(""),this.parent.m_changed1=!1,this.parent.m_changed2=!1,this.parent.m_tolerance=t,this.m_hashTableOfEqualsSize=0,this.m_hashTableOfEquals=ti(16);let s=V.constructEmpty();for(let o=0;o<2;o++){let a=this.parent.allocResultSegmentFromSegment(this.parent.m_inputSegments[this.parent.m_inputParts[o].segmentIndex]),h=V.constructEmpty();this.parent.m_inputSegments[this.parent.m_inputParts[o].segmentIndex].queryLooseEnvelope(h),s.mergeEnvelope2D(h);let m=this.parent.m_inputParts[o];this.addSegment(a,0,m.weightStart,m.rankStart,m.weightEnd,m.rankEnd,m.weightInterior,m.rankInterior,m.u.bBreakStart,m.u.bBreakEnd,m.segmentParentage)}s.inflateCoords(100*t,100*t),this.m_origin.assign(s.getLowerLeft()),this.m_cell.setCoords(2*t,2*t),this.m_pairs.push(Cn(this.m_chainOrigin1.nextInChain,this.m_chainOrigin2.nextInChain,0,e));let n=0,i=!0;for(;this.m_pairs.length;){let o=this.m_pairs.at(-1);this.m_pairs.pop(),w(o.recursion>=0),w(o.recursion<=256),this.clusterNodes(t);let a=this.intersectCurvesHelper(o.edge1,o.edge2,t,o.bIsIntersecting,o.recursion);i&&(i=!1,n=a)}for(let o=0;o<2;o++){let a=o===0?this.parent.m_resultParts1:this.parent.m_resultParts2;for(let h=(o===0?this.m_chainOrigin1:this.m_chainOrigin2).nextInChain;h!=null;h=h.getNextInChain())a.push(this.parent.newIntersectionPart_(h.segmentIndex,h.start.weight,h.start.rank,h.end.weight,h.end.rank,h.weight,h.rank,h.start.bIsBreak,h.end.bIsBreak,h.segmentParentage)),a.at(-1).u.bBigMoveStart=h.start.bBigMove,a.at(-1).u.bBigMoveEnd=h.end.bBigMove}return n}tryOverlapIntersectCurves(t,e,s,n){let i=this.parent.m_resultSegments[t.segmentIndex].get(),o=this.parent.m_resultSegments[e.segmentIndex].get(),a=i.getStartXY().equals(o.getStartXY())&&i.getEndXY().equals(o.getEndXY()),h=i.getStartXY().equals(o.getEndXY())&&i.getEndXY().equals(o.getStartXY());if(!a&&!h)return 0;let m=Ve(i,o,!0);if(m!==0&&Dm(i,o)&&t.segmentParentage===e.segmentParentage){let d=!1;if(m>0)d=i.equals(o);else{w(m===-1);let _=new et({segment:o});_.get().reverse(),d=i.equals(_.get())}if(d)return 1}let l=s*$e.c_smallToleranceFactor,u=!1;if(m===0){let d=[.5,.25,.75,.125,.375,.625,.875,.5625,.3125];for(let _=0,p=d.length;_<p;++_){let f=d[_],x=new y;i.queryCoord2D(f,x);let C=o.getClosestCoordinate(x,!1),P=new y;o.queryCoord2D(C,P);let E=y.distance(x,P);if(E>s)return 0;u||=E>l}for(let _=0,p=d.length;_<p;++_){let f=d[_],x=new y;o.queryCoord2D(f,x);let C=i.getClosestCoordinate(x,!1),P=new y;i.queryCoord2D(C,P);let E=y.distance(x,P);if(E>s)return 0;u||=E>l}}let c=t.rank,g=e.rank;return c===g&&(c*=$e.c_maxGeometryTypeToRankDelta,g*=$e.c_maxGeometryTypeToRankDelta,c+=xi(i.getGeometryType(),i,!0),g+=xi(o.getGeometryType(),o,!0)),c>g?(e.copyFromWhenOverlap(this,t,a),e.transferAttributes(this,i,a)):g>c?(t.copyFromWhenOverlap(this,e,a),t.transferAttributes(this,o,a)):t.segmentParentage<=e.segmentParentage?(t.weight=t.weight+e.weight,e.copyFromWhenOverlap(this,t,a),e.transferAttributes(this,i,a)):(e.weight=t.weight+e.weight,t.copyFromWhenOverlap(this,e,a),t.transferAttributes(this,o,a)),u?3:2}postProcessResultPartsForCurves(t,e,s,n,i){i===th()&&j("curve_helper");for(let o=t;o!==e;o=o.getNextInChain())this.updateSegmentToNodes(o);for(let o=s;o!==n;o=o.getNextInChain())this.updateSegmentToNodes(o);for(let o=t;o!==e;o=o.getNextInChain()){let a=o.end.pt.sub(o.start.pt);for(let h=s;h!==n;h=h.getNextInChain()){let m=0;if(o.start.pt.equals(h.start.pt)&&o.end.pt.equals(h.end.pt)?m=1:o.start.pt.equals(h.end.pt)&&o.end.pt.equals(h.start.pt)&&(m=-1),!m){let _=o.start.pt.equals(h.start.pt)?1:0;if(_||(_=o.end.pt.equals(h.end.pt)?2:0,_||(_=o.end.pt.equals(h.start.pt)?3:0,_||(_=o.start.pt.equals(h.end.pt)?4:0))),_){let p=h.end.pt.sub(h.start.pt),f=a.dotProduct(p),x;switch(_){case 1:case 2:x=f>0;break;case 3:case 4:x=f<0;break;default:j("post_process_result_parts_for_curves_")}x&&this.m_pairs.push(Cn(o,h,i,!1))}continue}let l=this.parent.m_resultSegments[o.segmentIndex],u=this.parent.m_resultSegments[h.segmentIndex],c=[.5,.25,.75];for(let _=0,p=c.length;_<p;++_){let f=c[_],x=new y;l.get().queryCoord2D(f,x);let C=u.get().getClosestCoordinate(x,!1),P=new y;if(u.get().queryCoord2D(C,P),y.distance(x,P)>this.parent.m_tolerance){m=0;break}}if(!m){this.m_pairs.push(Cn(o,h,i,!1));continue}for(let _=0,p=c.length;_<p;++_){let f=c[_],x=new y;u.get().queryCoord2D(f,x);let C=l.get().getClosestCoordinate(x,!1),P=new y;if(l.get().queryCoord2D(C,P),y.distance(x,P)>this.parent.m_tolerance){m=0;break}}if(!m){this.m_pairs.push(Cn(o,h,i,!1));continue}o.equalEdge=h,h.equalEdge=o;let g=o.rank,d=h.rank;g===d&&(g*=$e.c_maxGeometryTypeToRankDelta,d*=$e.c_maxGeometryTypeToRankDelta,g+=xi(l.get().getGeometryType(),l.get(),!0),d+=xi(u.get().getGeometryType(),u.get(),!0)),g>d||g===d&&o.segmentParentage<=h.segmentParentage?(l.copyTo(u,!1),h.segmentParentage=o.segmentParentage,m===-1&&u.get().reverse()):(u.copyTo(l,!1),o.segmentParentage=h.segmentParentage,m===-1&&l.get().reverse());break}}this.updateAttachedEdgesAfterNodeChange(t.start),e&&this.updateAttachedEdgesAfterNodeChange(e.start),this.updateAttachedEdgesAfterNodeChange(s.start),n&&this.updateAttachedEdgesAfterNodeChange(n.start)}processDoublyConnectedEdges(t,e,s,n){s===th()&&j("curve_helper");let i=this.getSegment(t).get(),o=this.getSegment(e).get(),a=i.getStartXY().equals(o.getStartXY())&&i.getEndXY().equals(o.getEndXY())?1:i.getEndXY().equals(o.getStartXY())&&i.getStartXY().equals(o.getEndXY())?-1:0;if(a!==0){let h=new et;i.queryCut(0,.5,h),h.get().snapControlPoints(n*n);let m=new et;i.queryCut(.5,1,m),m.get().snapControlPoints(n*n),this.splitEdgeInPlace(t),t.end.pt=h.get().getEndXY(),t.segmentIndex=this.parent.allocResultSegmentFromBuffer(h),t.getNextInChain().segmentIndex=this.parent.allocResultSegmentFromBuffer(m);let l=o.getClosestCoordinate(t.end.pt,!1);return Math.abs(l-.5)>.2&&(l=.5),o.queryCut(0,l,h),h.get().snapControlPoints(n*n),o.queryCut(l,1,m),m.get().snapControlPoints(n*n),this.splitEdgeInPlace(e),e.end.pt=h.get().getEndXY(),e.segmentIndex=this.parent.allocResultSegmentFromBuffer(h),e.getNextInChain().segmentIndex=this.parent.allocResultSegmentFromBuffer(m),a>0?(this.m_pairs.push(Cn(t,e,s,!1)),this.m_pairs.push(Cn(t.getNextInChain(),e.getNextInChain(),s,!1))):(this.m_pairs.push(Cn(t,e.getNextInChain(),s,!1)),this.m_pairs.push(Cn(t.getNextInChain(),e,s,!1))),!0}return!1}newNode(t,e,s,n){let i=new la;return this.m_newNodes.push(i),i.pt=t,i.rank=s,i.weight=e,i.bIsBreak=n,i}newEdge(t,e,s,n,i,o){let a=new Wg;return a.start=t,a.end=e,t.nextInChain=a,e.prevInChain=a,a.segmentIndex=s,a.segmentParentage=o,a.rank=i,a.weight=n,a}splitEdgeInPlace(t){t.segmentIndex=-1;let e=new Wg,s=new la;this.m_newNodes.push(s),s.pt.setNAN(),s.nextInChain=e,s.prevInChain=t,s.prevInHash=null,s.nextInHash=null,s.prevEqual=null,s.nextEqual=null,s.weight=t.weight,s.rank=t.rank,s.bIsBreak=!1,s.bBigMove=!1,e.start=s,e.segmentIndex=-1,e.end=t.end,e.end.prevInChain=e,e.rank=t.rank,e.weight=t.weight,e.segmentParentage=t.segmentParentage,t.end=s,t.equalEdge&&(t.equalEdge.equalEdge=null),t.equalEdge=null}updateSegmentOnly(t,e){t.segmentIndex=e}updateAttachedEdgesAfterNodeChange(t){for(let e=t.equalListHead();e!==null;e=e.nextEqual)this.updateAttachedEdgesAfterNodeChangeImpl(e)}updateAttachedEdgesAfterNodeChangeImpl(t){let e=t.prevInChain;if(e&&e.hasSegment()){let n=this.getSegment(e).get();t.pt.equals(n.getEndXY())||(n.setCoordsForIntersector(e.start.pt,e.end.pt,!1),n.ensureXYMonotone())}let s=t.nextInChain;if(s&&s.hasSegment()){let n=this.getSegment(s).get();t.pt.equals(n.getStartXY())||(n.setCoordsForIntersector(s.start.pt,s.end.pt,!1),n.ensureXYMonotone())}}updateSegmentToNodes(t){let e=this.getSegment(t).get();t.start.pt.equals(e.getStartXY())&&t.end.pt.equals(e.getEndXY())||(e.setCoordsForIntersector(t.start.pt,t.end.pt,!1),e.ensureXYMonotone()),this.updateAttachedEdgesAfterNodeChange(t.start),this.updateAttachedEdgesAfterNodeChange(t.end)}getSegment(t){return this.parent.m_resultSegments[t.segmentIndex]}clusterNodes(t){let e=!1,s=[],n=[],i=[];for(let o=0,a=this.m_newNodes.length;o<a;o++){let h=this.m_newNodes[o];if(h===null)continue;let m=h;for(let l=o+1;l<a;l++){let u=this.m_newNodes[l];u!==null&&h.pt.equals(u.pt)&&(m.nextInHash=u,u.prevInHash=m,m=u,this.m_newNodes[l]=null)}}for(let o=0,a=this.m_newNodes.length;o<a;o++){let h=this.m_newNodes[o];if(h==null)continue;for(h.hash=this.calculateHash(h.pt);;){let g=ti(4),d=this.hashTableBinsToCheck(h,g);for(let p=0;p<d;p++)if(g[p]!==null)for(let f=g[p];f!==null;){let x=f.nextInHash;y.distance(h.pt,f.pt)<=t&&(s.push(f),this.removeNodeFromHash(f),f.hash=0,i.push(f),n.push(f)),f=x}let _=!1;for(let p of s)if(!h.pt.equals(p.pt)){let f=Jd(h.pt,p.pt,h.weight,h.rank,p.weight,p.rank);h.pt.assign(f.pt),h.weight=f.weight,h.rank=f.rank,_=!0,e=!0}if(s.length=0,!_)break;h.hash=this.calculateHash(h.pt)}i.push(h),n.push(h);for(let g=h.nextInHash;g!==null;){g.prevInHash=null;let d=g.nextInHash;g.nextInHash=null,i.push(g),n.push(g),g=d}let m=h.hash,l=null,u=null;for(let g of n)h!==g&&(g.hash=m,g.pt.assign(h.pt),g.rank=h.rank,g.weight=h.weight),g.prevInHash=l,l&&(l.nextInHash=g),g.prevEqual=u,g.nextEqual=null,u&&(u.nextEqual=g),u=g,l=g;let c=m%this.m_hashTableOfEquals.length;l.nextInHash=this.m_hashTableOfEquals[c],this.m_hashTableOfEquals[c]!==null&&(this.m_hashTableOfEquals[c].prevInHash=l),this.m_hashTableOfEquals[c]=n[0],this.m_hashTableOfEqualsSize+=n.length,n.length=0,this.rehashIfNeeded()}if(this.m_newNodes.length=0,e)for(let o of i)this.updateAttachedEdgesAfterNodeChange(o)}rehashIfNeeded(){if(2*this.m_hashTableOfEqualsSize>this.m_hashTableOfEquals.length){let t=this.m_hashTableOfEquals;this.m_hashTableOfEquals=ti(2*t.length),this.m_hashTableOfEqualsSize=0;for(let e of t){let s=e;for(;s;){let n=s.nextInHash;s.nextInHash=null,s.prevInHash=null,this.addNodeToHashImpl(s),s=n}}}}addNodeToHashImpl(t){let e=t.hash%this.m_hashTableOfEquals.length,s=this.m_hashTableOfEquals[e];t.nextInHash=s,s!==null&&(s.prevInHash=t),this.m_hashTableOfEquals[e]=t,this.m_hashTableOfEqualsSize++}removeNodeFromHash(t){let e=t.hash%this.m_hashTableOfEquals.length,s=t.prevInHash,n=t.nextInHash;s?s.nextInHash=n:this.m_hashTableOfEquals[e]=n,n&&(n.prevInHash=s),this.m_hashTableOfEqualsSize--,t.prevInHash=null,t.nextInHash=null}hashTableBinsToCheck(t,e){let s=(t.pt.x-this.m_origin.x)/this.m_cell.x,n=(t.pt.y-this.m_origin.y)/this.m_cell.y,i=Pe()-1,o=Math.round(Tt(s,-2147483646,i)),a=Math.round(Tt(n,-2147483646,i)),h=o|a<<32;h=ps(h),e[0]=this.m_hashTableOfEquals[h%this.m_hashTableOfEquals.length];let m=o+1|a<<32;m=ps(m);let l=1;e[1]=this.m_hashTableOfEquals[m%this.m_hashTableOfEquals.length],e[1]!==e[0]&&(l=2);let u=o+1|a+1<<32;u=ps(u),e[l]=this.m_hashTableOfEquals[u%this.m_hashTableOfEquals.length];for(let g=0;g<l;g++)if(e[l]===e[g]){l--;break}l++;let c=o|a+1<<32;c=ps(c),e[l]=this.m_hashTableOfEquals[c%this.m_hashTableOfEquals.length];for(let g=0;g<l;g++)if(e[l]===e[g]){l--;break}return l++,l}calculateHash(t){let e=(t.x-this.m_origin.x)/this.m_cell.x,s=(t.y-this.m_origin.y)/this.m_cell.y,n=Pe()-1,i=Math.round(Tt(e,-2147483646,n))|Math.round(Tt(s,-2147483646,n))<<32;return i=ps(i),i===0&&(i=1),i}processSharpCorners(t,e,s,n){if(this.parent.m_param1.length=0,this.parent.m_param2.length=0,t.getStartXY().equals(e.getStartXY())){let i=[0,0],o=[0,0],a=Ar(t,e,0,0,s,2,i,o,n);if(a){this.parent.m_param1.push(0),this.parent.m_param2.push(0);for(let h=0;h<a;h++)this.parent.m_param1.push(i[h]),this.parent.m_param2.push(o[h]);return a+1}}if(t.getEndXY().equals(e.getEndXY())){let i=[0,0],o=[0,0],a=Ar(t,e,1,1,s,2,i,o,n);if(a){for(let h=0;h<a;h++)this.parent.m_param1.push(i[h]),this.parent.m_param2.push(o[h]);return this.parent.m_param1.push(1),this.parent.m_param2.push(1),a+1}}if(t.getStartXY().equals(e.getEndXY())){let i=[0,0],o=[0,0],a=Ar(t,e,0,1,s,2,i,o,n);if(a){this.parent.m_param1.push(0),this.parent.m_param2.push(1);for(let h=0;h<a;h++)this.parent.m_param1.push(i[h]),this.parent.m_param2.push(o[h]);return a+1}}if(t.getEndXY().equals(e.getStartXY())){let i=[0,0],o=[0,0],a=Ar(t,e,1,0,s,2,i,o,n);if(a){for(let h=0;h<a;h++)this.parent.m_param1.push(i[h]),this.parent.m_param2.push(o[h]);return this.parent.m_param1.push(1),this.parent.m_param2.push(0),a+1}}return 0}};function xi(r,t,e){let s=0;switch(r){case N.enumLine:s=0;break;case N.enumBezier:s=2;break;case N.enumRationalBezier2:s=3;break;case N.enumBezier2:s=1;break;case N.enumEllipticArc:s=t.projectionBehavior()===0?5:4;break;default:j("")}return e?5-s:s}var sl=class extends ra{constructor(t){super(t.m_shape,t.m_tolerance,!1),this.m_parent=t}compare(t,e,s){if(this.m_bIntersectionDetected)return-1;let n=t.getElement(s),i=this.m_parent.getEdgeOriginVertices(e),o=this.m_parent.m_edgeVertices.getFirstElement(i),a=this.m_parent.getEdgeOriginVertices(n),h=this.m_parent.m_edgeVertices.getFirstElement(a);return this.m_currentNode=s,this.compareSegments(e,o,n,h)}},nl=class extends oa{constructor(t){super(t.m_shape,t.m_tolerance),this.m_parent=t}compare(t,e){if(this.m_bIntersectionDetected)return-1;let s=t.getElement(e),n=this.m_parent.getEdgeOriginVertices(s),i=this.m_parent.m_edgeVertices.getFirstElement(n);return this.m_currentNode=e,this.compareVertex(t,e,i)}},il=class extends Gn{constructor(t){super(),this.pt1=y.getNAN(),this.pt2=y.getNAN(),this.m_shape=t}compare(t,e,s){this.m_shape.queryXY(e,this.pt1);let n=t.getElement(s);return this.m_shape.queryXY(n,this.pt2),this.pt1.compare(this.pt2)}},rl=class{constructor(t){this.m_point=y.getNAN(),this.m_pt=y.getNAN(),this.m_shape=t}setPoint(t){this.m_point.setCoordsPoint2D(t)}compare(t,e){let s=t.getElement(e);return this.m_shape.queryXY(s,this.m_pt),this.m_point.compare(this.m_pt)}},qr=class{constructor(t,e){this.m_shape=null,this.m_progressTracker=null,this.m_edges=new Rt(8),this.m_clusters=new Rt(5),this.m_clusterVertices=new Jt(!1),this.m_edgeVertices=new Jt(!1),this.m_helperPoint=new st,this.m_eventQ=new Ot,this.m_sweepStructure=new Ot,this.m_bComplications=!1,this.m_sweepComparator=null,this.m_tempEdgeBuffer=[],this.m_modifiedClusters=[],this.m_edgesToInsertInSweepStructure=[],this.m_prevNeighbour=-1,this.m_nextNeighbour=-1,this.m_bContinuingSegmentChainOptimization=!1,this.m_progressCounter=0,this.m_segmentIntersector=new $e,this.m_segBuf1=new et,this.m_segBuf2=new et,this.m_sweepPoint=new y(0,0),this.m_tolerance=0,this.m_toleranceSqr=0,this.m_sweepPointCluster=-1,this.m_vertexClusterIndex=-1,this.m_bCracked=!1,this.m_bSweepPointClusterWasModified=!1,this.m_progressTracker=t,this.m_bTrackChanges=e}hadComplications(){return this.m_bComplications}sweep(t,e){let s=new ct;s.setSwapCoordinates(),t.applyTransformation(s),this.setEditShape_(t),this.m_bCracked=!1,this.m_tolerance=e,this.m_toleranceSqr=e*e;let n=this.sweepImpl_();return t.applyTransformation(s),n||(this.fillEventQueuePass2(),n=this.sweepImpl_()||n),this.m_shape.removeUserIndex(this.m_vertexClusterIndex),this.m_shape=null,this.m_bCracked}sweepVertical(t,e){this.setEditShape_(t),this.m_bCracked=!1,this.m_tolerance=e,this.m_toleranceSqr=e*e,this.m_bComplications=!1;let s=this.sweepImpl_();if(!this.m_bComplications){let n=t.filterClosePoints(e,!0,!1,this.m_bTrackChanges,v);this.m_bComplications=n===1,s||=n===1}return this.m_vertexClusterIndex!==-1&&(this.m_shape.removeUserIndex(this.m_vertexClusterIndex),this.m_vertexClusterIndex=-1),this.m_shape=null,s}getEdgeCluster(t,e){return this.m_edges.getField(t,0+e)}setEdgeCluster_(t,e,s){this.m_edges.setField(t,0+e,s)}getEdgeOriginVertices(t){return this.m_edges.getField(t,2)}setEdgeOriginVertices_(t,e){this.m_edges.setField(t,2,e)}getNextEdgeEx(t,e){return this.m_edges.getField(t,3+e)}setNextEdgeEx_(t,e,s){this.m_edges.setField(t,3+e,s)}getEdgeSweepNode(t){return this.m_edges.getField(t,7)}setEdgeSweepNode_(t,e){this.m_edges.setField(t,7,e)}getNextEdge(t,e){let s=this.getEdgeEnd(t,e);return this.m_edges.getField(t,3+s)}setNextEdge_(t,e,s){let n=this.getEdgeEnd(t,e);this.m_edges.setField(t,3+n,s)}getPrevEdge(t,e){let s=this.getEdgeEnd(t,e);return this.m_edges.getField(t,5+s)}setPrevEdge_(t,e,s){let n=this.getEdgeEnd(t,e);this.m_edges.setField(t,5+n,s)}getClusterVertices(t){return this.m_clusters.getField(t,0)}setClusterVertices_(t,e){this.m_clusters.setField(t,0,e)}getClusterSweepEdgeList(t){return this.m_clusters.getField(t,2)}setClusterSweepEdgeList_(t,e){this.m_clusters.setField(t,2,e)}getClusterFirstEdge(t){return this.m_clusters.getField(t,1)}setClusterFirstEdge_(t,e){this.m_clusters.setField(t,1,e)}getClusterEventQNode(t){return this.m_clusters.getField(t,3)}setClusterEventQNode_(t,e){this.m_clusters.setField(t,3,e)}newCluster_(t){let e=this.m_clusters.newElement(),s=this.m_clusterVertices.createList();return this.setClusterVertices_(e,s),t!==v&&(this.m_clusterVertices.addElement(s,t),this.m_shape.setUserIndex(t,this.m_vertexClusterIndex,e)),e}deleteCluster_(t){this.m_clusters.deleteElement(t)}addVertexToCluster_(t,e){let s=this.getClusterVertices(t);this.m_clusterVertices.addElement(s,e),this.m_shape.setUserIndex(e,this.m_vertexClusterIndex,t)}newEdge_(t){let e=this.m_edges.newElement(),s=this.m_edgeVertices.createList();return this.setEdgeOriginVertices_(e,s),t!==-1&&this.m_edgeVertices.addElement(s,t),e}addVertexToEdge_(t,e){let s=this.getEdgeOriginVertices(t);this.m_edgeVertices.addElement(s,e)}deleteEdge_(t){this.m_edges.deleteElement(t);let e=this.m_edgesToInsertInSweepStructure.findIndex(s=>s===t);e>=0&&pu(this.m_edgesToInsertInSweepStructure,e)}addEdgeToCluster(t,e){this.getEdgeCluster(t,0)===-1?this.setEdgeCluster_(t,0,e):this.getEdgeCluster(t,1)===-1?this.setEdgeCluster_(t,1,e):j(""),this.addEdgeToClusterImpl_(t,e)}addEdgeToClusterImpl_(t,e){let s=this.getClusterFirstEdge(e);if(s!==-1){let n=this.getNextEdge(s,e);this.setPrevEdge_(n,e,t),this.setNextEdge_(t,e,n),this.setNextEdge_(s,e,t),this.setPrevEdge_(t,e,s)}else this.setPrevEdge_(t,e,t),this.setNextEdge_(t,e,t),this.setClusterFirstEdge_(e,t)}getEdgeEnd(t,e){return this.getEdgeCluster(t,0)===e?0:1}mergeClusters_(t,e){this.dbgCheckCluster_(t),this.dbgCheckCluster_(e);let s=this.getClusterEventQNode(e);s!==-1&&(this.m_eventQ.deleteNode(s),this.setClusterEventQNode_(e,-1));let n=this.getClusterFirstEdge(t),i=this.getClusterFirstEdge(e);if(i!==-1){let h=i,m=i,l=!1;do{this.dbgCheckEdge_(h),l=!1;let u=this.getEdgeEnd(h,e),c=this.getNextEdgeEx(h,u);if(this.getEdgeCluster(h,u+1&1)===t){this.disconnectEdge_(h);let g=this.getEdgeOriginVertices(h);if(this.m_edgeVertices.deleteList(g),this.deleteEdge_(h),h===c){i=-1;break}i===h&&(i=this.getClusterFirstEdge(e),m=c,l=!0)}h=c}while(h!==m||l);if(i!==-1){do{let u=this.getEdgeEnd(h,e),c=this.getNextEdgeEx(h,u);this.setEdgeCluster_(h,u,t),h=c}while(h!==m);if(n=this.getClusterFirstEdge(t),n!==-1){let u=this.getNextEdge(n,t),c=this.getNextEdge(i,t);u===n?(this.setClusterFirstEdge_(t,i),this.addEdgeToClusterImpl_(n,t),this.setClusterFirstEdge_(t,n)):c===i&&this.addEdgeToClusterImpl_(i,t),this.setNextEdge_(i,t,u),this.setPrevEdge_(u,t,i),this.setNextEdge_(n,t,c),this.setPrevEdge_(c,t,n)}else this.setClusterFirstEdge_(t,i)}}let o=this.getClusterVertices(t),a=this.getClusterVertices(e);for(let h=this.m_clusterVertices.getFirst(a);h!==-1;h=this.m_clusterVertices.getNext(h)){let m=this.m_clusterVertices.getElement(h);this.m_shape.setUserIndex(m,this.m_vertexClusterIndex,t)}this.m_clusterVertices.concatenateLists(o,a),this.deleteCluster_(e),this.dbgCheckCluster_(t)}mergeEdges_(t,e){this.dbgCheckEdge_(t),this.dbgCheckEdge_(e);let s=this.getEdgeCluster(t,0),n=this.getEdgeCluster(t,1),i=this.getEdgeCluster(e,0),o=this.getEdgeCluster(e,1),a=this.getEdgeOriginVertices(t),h=this.getEdgeOriginVertices(e);if(this.m_edgeVertices.concatenateLists(a,h),e===this.getClusterFirstEdge(s)&&this.setClusterFirstEdge_(s,t),e===this.getClusterFirstEdge(n)&&this.setClusterFirstEdge_(n,t),this.disconnectEdge_(e),this.deleteEdge_(e),!(s===i&&n===o||n===i&&s===o)){let m=this.getClusterXY(s),l=this.getClusterXY(i);m.isEqualPoint2D(l)?(s!==i&&this.mergeClusters_(s,i),n!==o&&this.mergeClusters_(n,o)):(n!==i&&this.mergeClusters_(n,i),s!==o&&this.mergeClusters_(s,o))}this.dbgCheckEdge_(t)}disconnectEdge_(t){let e=this.getEdgeCluster(t,0),s=this.getEdgeCluster(t,1);this.disconnectEdgeFromCluster_(t,e),this.disconnectEdgeFromCluster_(t,s)}disconnectEdgeFromCluster_(t,e){let s=this.getNextEdge(t,e),n=this.getPrevEdge(t,e),i=this.getClusterFirstEdge(e);s!==t?(this.setNextEdge_(n,e,s),this.setPrevEdge_(s,e,n),i===t&&this.setClusterFirstEdge_(e,s)):this.setClusterFirstEdge_(e,-1)}applyIntersectorToEditShape_(t,e,s){let n=this.m_edgeVertices.getFirst(t),i=this.m_edgeVertices.getElement(n),o=this.getClusterFromVertex(i),a=this.m_shape.getNextVertex(i),h=this.getClusterFromVertex(a),m=this.m_shape.getXY(i),l=this.m_shape.getXY(a),u=!1,c=!1,g=e.getResultSegment(s,0).getStartXY(),d=e.getResultSegment(s,e.getResultSegmentCount(s)-1).getEndXY();m.equals(g)||(u=!0),l.equals(d)||(c=!0),this.m_shape.splitSegmentWithIntersector(i,e,s,!0,!0);let _=this.m_bTrackChanges&&e.getSegmentChanged(s);for(_&&this.m_shape.setGeometryModifiedWithVertex(i,!0),n=this.m_edgeVertices.getNext(n);n!==-1;n=this.m_edgeVertices.getNext(n)){let p=this.m_edgeVertices.getElement(n),f=this.getClusterFromVertex(p)===o;this.m_shape.splitSegmentWithIntersector(p,e,s,f,!0),_&&this.m_shape.setGeometryModifiedWithVertex(p,!0)}if(u&&this.updateClusterXY(!0,o,g,e.getResultSegmentStartPointWeight(s,0),e.getResultSegmentStartPointRank(s,0)),c){let p=e.getResultSegmentCount(s)-1;this.updateClusterXY(!0,h,d,e.getResultSegmentEndPointWeight(s,p),e.getResultSegmentEndPointRank(s,p))}}createEdgesAndClustersFromSplitEdge_(t,e,s){this.dbgCheckNewEdgesArray_();let n=this.getEdgeOriginVertices(t),i=this.getEdgeCluster(t,0),o=this.getEdgeCluster(t,1),a=this.newEdge_(-1);this.m_edgesToInsertInSweepStructure.push(a);let h=Rt.impossibleIndex3();this.setEdgeSweepNode_(a,h),this.m_tempEdgeBuffer.push(a),this.addEdgeToCluster(a,i);let m=e.getResultSegmentCount(s);for(let l=1;l<m;l++){let u=this.newCluster_(-1);this.m_modifiedClusters.push(u),this.m_tempEdgeBuffer.push(u),this.addEdgeToCluster(a,u);let c=this.newEdge_(-1);this.m_edgesToInsertInSweepStructure.push(c),this.setEdgeSweepNode_(c,h),this.m_tempEdgeBuffer.push(c),this.addEdgeToCluster(c,u),a=c}this.addEdgeToCluster(a,o);for(let l=this.m_edgeVertices.getFirst(n);l!==-1;l=this.m_edgeVertices.getNext(l)){let u=this.m_edgeVertices.getElement(l);if(this.getClusterFromVertex(u)===i){let c=0,g=this.m_tempEdgeBuffer.length;do{if(c>0){let _=this.m_tempEdgeBuffer[c-1];this.addVertexToCluster_(_,u)}let d=this.m_tempEdgeBuffer[c];c+=2,this.addVertexToEdge_(d,u),u=this.m_shape.getNextVertex(u)}while(c<g)}else{let c=this.m_tempEdgeBuffer.length-1;do{if(c<this.m_tempEdgeBuffer.length-2){let d=this.m_tempEdgeBuffer[c+1];this.addVertexToCluster_(d,u)}let g=this.m_tempEdgeBuffer[c];c-=2,this.addVertexToEdge_(g,u),u=this.m_shape.getNextVertex(u)}while(c>=0)}}this.m_tempEdgeBuffer.length=0,this.dbgCheckNewEdgesArray_()}getVertexFromClusterIndex(t){let e=this.getClusterVertices(t);return this.m_clusterVertices.getFirstElement(e)}getClusterFromVertex(t){return this.m_shape.getUserIndex(t,this.m_vertexClusterIndex)}processSplitHelper1_(t,e,s){let n=this.getEdgeCluster(e,0),i=this.getClusterXY(n),o=this.getEdgeCluster(e,1),a=this.getClusterXY(o),h=s.getResultSegmentCount(t),m=s.getResultSegment(t,0),l=m.getStartXY();if(i.isEqualPoint2D(l)||(this.m_bComplications||i.compare(this.m_sweepPoint)*l.compare(this.m_sweepPoint)<0&&(this.m_bComplications=!0),this.getAffectedEdges(n,this.m_tempEdgeBuffer),this.m_modifiedClusters.push(n)),!this.m_bComplications&&h>1){let c=i.compare(a),g=m.getEndXY();(i.compare(g)!==c||g.compare(a)!==c||g.compare(this.m_sweepPoint)<0)&&(this.m_bComplications=!0)}m=s.getResultSegment(t,h-1);let u=m.getEndXY();a.isEqualPoint2D(u)||(this.m_bComplications||a.compare(this.m_sweepPoint)*u.compare(this.m_sweepPoint)<0&&(this.m_bComplications=!0),this.getAffectedEdges(o,this.m_tempEdgeBuffer),this.m_modifiedClusters.push(o)),this.m_tempEdgeBuffer.push(e);for(let c=0,g=this.m_tempEdgeBuffer.length;c<g;c++){let d=this.m_tempEdgeBuffer[c],_=this.getEdgeSweepNode(d);Rt.isValidElement(_)&&(this.m_sweepStructure.deleteNode(_),this.setEdgeSweepNode_(d,-1));let p=Rt.impossibleIndex3();d!==e&&this.getEdgeSweepNode(d)!==p&&(this.m_edgesToInsertInSweepStructure.push(d),this.setEdgeSweepNode_(d,p))}this.m_tempEdgeBuffer.length=0}checkAndFixIntersection_(t,e){let s=this.m_sweepStructure.getElement(t);return this.m_sweepComparator.compare(this.m_sweepStructure,s,e),!!this.m_sweepComparator.intersectionDetected()&&(this.m_sweepComparator.clearIntersectionDetectedFlag(),this.fixIntersection_(t,e),!0)}fixIntersection_(t,e){this.m_bCracked=!0;let s=this.m_sweepStructure.getElement(t),n=this.m_sweepStructure.getElement(e),i=null,o=null,a=this.getEdgeOriginVertices(s),h=this.m_edgeVertices.getFirstElement(a),m=this.getEdgeOriginVertices(n),l=this.m_edgeVertices.getFirstElement(m),u=this.m_shape.querySegment(h,this.m_segBuf1,!1,!1);w(u),i=this.m_segBuf1.get();let c=this.m_shape.getNextVertex(h),g=this.m_shape.getWeight(h),d=this.m_shape.getSegmentParentageBreakVertex(h),_=this.m_shape.getWeight(c),p=this.m_shape.getSegmentParentageBreakVertex(c),f=this.m_shape.getSegmentWeight(h),x=this.m_shape.getRank(h),C=this.m_shape.getRank(c),P=this.m_shape.getSegmentRank(h),E=this.m_shape.getSegmentParentage(h),S=this.m_shape.querySegment(l,this.m_segBuf2,!1,!1);w(S),o=this.m_segBuf2.get();let I=this.m_shape.getNextVertex(l),D=this.m_shape.getWeight(l),b=this.m_shape.getSegmentParentageBreakVertex(l),T=this.m_shape.getWeight(I),A=this.m_shape.getSegmentParentageBreakVertex(I),G=this.m_shape.getSegmentWeight(l),F=this.m_shape.getRank(l),M=this.m_shape.getRank(I),q=this.m_shape.getSegmentRank(l),R=this.m_shape.getSegmentParentage(l);this.m_segmentIntersector.pushSegment(i,g,x,_,C,f,P,d,p,E),this.m_segmentIntersector.pushSegment(o,D,F,T,M,G,q,b,A,R),this.m_segmentIntersector.intersect2D(this.m_tolerance,!0)===3&&(this.m_bComplications=!0),this.splitEdge_(s,n,-1,this.m_segmentIntersector),this.m_segmentIntersector.clear()}fixIntersectionPointSegment_(t,e){this.m_bCracked=!0;let s=this.m_sweepStructure.getElement(e),n=null,i=this.getEdgeOriginVertices(s),o=this.m_edgeVertices.getFirstElement(i),a=this.m_shape.querySegment(o,this.m_segBuf1,!1,!1);w(a),n=this.m_segBuf1.get();let h=this.m_shape.getNextVertex(o),m=this.m_shape.getWeight(o),l=this.m_shape.getSegmentParentageBreakVertex(o),u=this.m_shape.getWeight(h),c=this.m_shape.getSegmentParentageBreakVertex(h),g=this.m_shape.getSegmentWeight(o),d=this.m_shape.getRank(o),_=this.m_shape.getRank(h),p=this.m_shape.getSegmentRank(o),f=this.m_shape.getSegmentParentage(o),x=this.getClusterFirstVertex(t);this.m_segmentIntersector.pushSegment(n,m,d,u,_,g,p,l,c,f),this.m_shape.queryPoint(x,this.m_helperPoint);let C=this.m_shape.getWeight(x),P=this.m_shape.getRank(x);this.m_segmentIntersector.intersect2DEx(this.m_tolerance,this.m_helperPoint,P,C,!0),this.splitEdge_(s,-1,t,this.m_segmentIntersector),this.m_segmentIntersector.clear()}insertNewEdges_(){if(this.m_edgesToInsertInSweepStructure.length===0)return!0;this.dbgCheckNewEdgesArray_();let t=!0,e=0,s=this.m_edgesToInsertInSweepStructure.length,n=Math.max(2*s+200,this.m_sweepStructure.size()+200);for(;this.m_edgesToInsertInSweepStructure.length;){if(this.m_edgesToInsertInSweepStructure.length>Math.max(100,this.m_shape.getTotalPointCount())||e>n){this.m_edgesToInsertInSweepStructure.length=0,this.m_bComplications=!0,t=!1;break}let i=this.m_edgesToInsertInSweepStructure.at(-1);this.m_edgesToInsertInSweepStructure.pop(),this.setEdgeSweepNode_(i,-1);let o=this.isEdgeOnSweepLine_(i);Rt.isValidElement(o)?(this.insertNewEdgeToSweepStructure_(i,o),e++):o!==Rt.impossibleIndex2()&&(t=!1),this.m_bContinuingSegmentChainOptimization=!1}return t}insertNewEdgeToSweepStructure_(t,e){let s;if(this.m_bContinuingSegmentChainOptimization?(s=this.m_sweepStructure.addElementAtPosition(this.m_prevNeighbour,this.m_nextNeighbour,t,!0,!0),this.m_bContinuingSegmentChainOptimization=!1):s=this.m_sweepStructure.addUniqueElement(t),s===-1){let n=this.m_sweepStructure.getDuplicateElement(),i=this.m_sweepStructure.getElement(n);return this.mergeEdges_(i,t),!1}if(this.setEdgeSweepNode_(t,s),this.m_sweepComparator.intersectionDetected()){this.m_sweepComparator.clearIntersectionDetectedFlag();let n=this.m_sweepComparator.getLastComparedNode();return this.m_prevNeighbour===n&&(this.m_prevNeighbour=-1),this.m_nextNeighbour===n&&(this.m_nextNeighbour=-1),this.fixIntersection_(n,s),!0}return!1}isEdgeOnSweepLine_(t){let e=this.getEdgeCluster(t,0),s=this.getEdgeCluster(t,1),n=this.getClusterXY(e),i=this.getClusterXY(s);if(y.sqrDistance(n,i)<=this.m_toleranceSqr)return this.m_bComplications=!0,-1;let o=n.compare(this.m_sweepPoint),a=i.compare(this.m_sweepPoint);return o<=0&&a>0?s:a<=0&&o>0?e:o>0&&a>0?Rt.impossibleIndex2():-1}fillEventQueue(){let t=new he(0),e=this.m_shape.queryVertexIteratorOnSelection();for(let i=e.next();i!==v;i=e.next())this.m_shape.getUserIndex(i,this.m_vertexClusterIndex)!==-1&&t.add(i);this.m_shape.sortVerticesSimpleByY(t,0,t.size()),this.progress_(!0),this.m_eventQ.clear(),this.m_eventQ.setCapacity(t.size()),this.m_eventQ.setComparator(new il(this.m_shape));let s=y.getNAN();s.setNAN();let n=-1;for(let i=0,o=t.size();i<o;i++){let a=t.read(i);if(this.m_shape.getXY(a).isEqualPoint2D(s)){let m=this.m_shape.getUserIndex(a,this.m_vertexClusterIndex);this.mergeClusters_(n,m);continue}n=this.getClusterFromVertex(a),this.m_shape.queryXY(a,s);let h=this.m_eventQ.addBiggestElement(a);this.setClusterEventQNode_(n,h)}}fillEventQueuePass2(){let t=new he(0);for(let e=this.m_eventQ.getFirst();e!==-1;e=this.m_eventQ.getNext(e)){let s=this.m_eventQ.getElement(e);t.add(s)}this.m_eventQ.clear(),this.m_shape.sortVerticesSimpleByY(t,0,t.size()),this.progress_(!0);for(let e=0,s=t.size();e<s;e++){let n=t.read(e),i=this.getClusterFromVertex(n),o=this.m_eventQ.addBiggestElement(n);this.setClusterEventQNode_(i,o)}}getAffectedEdges(t,e){let s=this.getClusterFirstEdge(t);if(s===-1)return;let n=s;do{let i=this.getEdgeSweepNode(n);Rt.isValidElement(i)&&e.push(n),n=this.getNextEdge(n,t)}while(n!==s)}updateClusterXY(t,e,s,n,i){let o=this.getClusterVertices(e);for(let a=this.m_clusterVertices.getFirst(o);a!==-1;a=this.m_clusterVertices.getNext(a)){let h=this.m_clusterVertices.getElement(a);this.m_shape.setXYMonotonicPoint2D(h,s),this.m_shape.setWeight(h,n),this.m_shape.setRank(h,i),t&&this.m_bTrackChanges&&this.m_shape.setGeometryModifiedWithVertex(h,!0),this.m_shape.setSegmentParentageBreakVertex(h,!0)}}splitEdge_(t,e,s,n){this.dbgCheckEdge_(t),e!==-1&&this.dbgCheckEdge_(e),this.disconnectEdge_(t),e!==-1&&this.disconnectEdge_(e),this.processSplitHelper1_(0,t,n),e!==-1&&this.processSplitHelper1_(1,e,n),s!==-1&&n.getResultPointChanged()&&this.m_modifiedClusters.push(s);for(let a=0,h=this.m_modifiedClusters.length;a<h;a++){let m=this.m_modifiedClusters[a],l=this.getClusterEventQNode(m);l!==-1&&(this.m_eventQ.deleteNode(l),this.setClusterEventQNode_(m,-1))}let i=this.getEdgeOriginVertices(t),o=e!==-1?this.getEdgeOriginVertices(e):-1;if(this.applyIntersectorToEditShape_(i,n,0),o!==-1)this.applyIntersectorToEditShape_(o,n,1);else{let a=n.getResultPoint().getXY();this.updateClusterXY(n.getResultPointChanged(),s,a,n.getResultPointWeight(),n.getResultPointRank())}this.createEdgesAndClustersFromSplitEdge_(t,n,0),e!==-1&&this.createEdgesAndClustersFromSplitEdge_(e,n,1),this.m_edgeVertices.deleteList(i),this.deleteEdge_(t),e!==-1&&(this.m_edgeVertices.deleteList(o),this.deleteEdge_(e));for(let a=0,h=this.m_modifiedClusters.length;a<h;a++){let m=this.m_modifiedClusters[a];m===this.m_sweepPointCluster&&(this.m_bSweepPointClusterWasModified=!0);let l=this.getClusterEventQNode(m);if(l===-1){let u=this.getClusterFirstVertex(m);if(l=this.m_eventQ.addUniqueElement(u),l===-1){let c=this.m_eventQ.getDuplicateElement(),g=this.m_eventQ.getElement(c),d=this.getClusterFromVertex(g);this.mergeClusters_(d,m)}else this.setClusterEventQNode_(m,l)}}this.m_modifiedClusters.length=0}getClusterXY(t){let e=this.getClusterFirstVertex(t);return this.m_shape.getXY(e)}getClusterFirstVertex(t){let e=this.getClusterVertices(t);return this.m_clusterVertices.getFirstElement(e)}dbgCheckEdge_(t){}dbgCheckCluster_(t){}dbgCheckNewEdgesArray_(){}dbgSaveSweepStructure_(t){}sweepImpl_(){this.progress_(!0),this.m_bSweepPointClusterWasModified=!1,this.m_sweepPointCluster=-1,this.m_sweepComparator===null&&(this.m_sweepStructure.disableBalancing(),this.m_sweepComparator=new sl(this),this.m_sweepStructure.setComparator(this.m_sweepComparator));let t=[],e=null,s=null;this.m_prevNeighbour=-1,this.m_nextNeighbour=-1,this.m_bContinuingSegmentChainOptimization=!1;let n=Rt.impossibleIndex2(),i=Rt.impossibleIndex3();for(let o=this.m_eventQ.getFirst();o!==-1;){this.progress_(),this.dbgCheckSweepStructure_(),this.m_bContinuingSegmentChainOptimization=!1,this.m_prevNeighbour=-1,this.m_nextNeighbour=-1;let a=this.m_eventQ.getElement(o);this.m_sweepPointCluster=this.getClusterFromVertex(a),this.m_shape.queryXY(a,this.m_sweepPoint),this.m_sweepComparator.setSweepY(this.m_sweepPoint.y,this.m_sweepPoint.x);let h=!1;{let l=this.getClusterFirstEdge(this.m_sweepPointCluster);if(h=l===-1,!h){let u=l;do{let c=this.getEdgeSweepNode(u);c===-1?(this.m_edgesToInsertInSweepStructure.push(u),this.setEdgeSweepNode_(u,i)):c!==i&&t.push(c),u=this.getNextEdge(u,this.m_sweepPointCluster)}while(u!==l)}}if(!this.m_sweepStructure.isAutoBalancing()&&(this.m_sweepStructure.getMaxDepthEver()>4||this.m_edgesToInsertInSweepStructure.length>10)&&this.m_sweepStructure.enableBalancing(),t.length>0){this.m_bContinuingSegmentChainOptimization=t.length===1&&this.m_edgesToInsertInSweepStructure.length===1;for(let c=0,g=t.length;c<g;c++){let d=this.m_sweepStructure.getElement(t[c]);this.setEdgeSweepNode_(d,n)}let l=n,u=n;for(let c=0,g=t.length;c<g;c++){let d=t[c];if(l===n){let _=this.m_sweepStructure.getPrev(d);if(_!==-1){let p=this.m_sweepStructure.getElement(_);this.getEdgeSweepNode(p)!==n&&(l=_)}else l=-1}if(u===n){let _=this.m_sweepStructure.getNext(d);if(_!==-1){let p=this.m_sweepStructure.getElement(_);this.getEdgeSweepNode(p)!==n&&(u=_)}else u=-1}if(l!==n&&u!==n)break}for(let c=0,g=t.length;c<g;c++){let d=t[c],_=this.m_sweepStructure.getElement(d);this.m_sweepStructure.deleteNode(d),this.setEdgeSweepNode_(_,-1)}t.length=0,this.m_prevNeighbour=l,this.m_nextNeighbour=u,l!==-1&&u!==-1?this.m_bContinuingSegmentChainOptimization||this.checkAndFixIntersection_(l,u):l===-1&&u===-1&&(this.m_bContinuingSegmentChainOptimization=!1)}else h&&(e===null&&(e=new nl(this)),e.setPoint(this.m_sweepPoint),this.m_sweepStructure.searchUpperBound(e),e.intersectionDetected()&&(e.clearIntersectionDetectedFlag(),this.fixIntersectionPointSegment_(this.m_sweepPointCluster,e.getCurrentNode())));let m=this.m_bContinuingSegmentChainOptimization;!this.insertNewEdges_()&&m&&this.m_prevNeighbour!==-1&&this.m_nextNeighbour!==-1&&this.checkAndFixIntersection_(this.m_prevNeighbour,this.m_nextNeighbour),this.m_bSweepPointClusterWasModified?(this.m_bSweepPointClusterWasModified=!1,s===null&&(s=new rl(this.m_shape)),s.setPoint(this.m_sweepPoint),o=this.m_eventQ.searchUpperBound(s)):o=this.m_eventQ.getNext(o)}return this.m_bCracked}setEditShape_(t){this.m_shape=t,this.m_vertexClusterIndex=this.m_shape.createUserIndex(),this.m_edges.setCapacity(t.getSelectedCount()+32),this.m_clusters.setCapacity(t.getSelectedCount()),this.m_clusterVertices.reserveLists(t.getSelectedCount()),this.m_clusterVertices.reserveNodes(t.getSelectedCount()),this.m_edgeVertices.reserveLists(t.getSelectedCount()+32),this.m_edgeVertices.reserveNodes(t.getSelectedCount()+32);for(let e=this.m_shape.getFirstGeometry();e!==v;e=this.m_shape.getNextGeometry(e))if(at(this.m_shape.getGeometryType(e)))for(let s=this.m_shape.getFirstPath(e);s!==v;s=this.m_shape.getNextPath(s)){let n=this.m_shape.getPathSize(s),i=this.m_shape.getFirstVertex(s);if(i===v)continue;let o=this.m_shape.getNextVertex(i);if(o===v||o===i)continue;let a=-1;t.selected(i)&&(a=this.newCluster_(i));let h=-1;a!==-1&&t.selected(o)&&(h=this.newEdge_(i),this.addEdgeToCluster(h,a));let m=h;for(let l=0,u=n-2;l<u;l++){let c=this.m_shape.getNextVertex(o),g=-1;if(this.m_shape.selected(o)){let d=this.newCluster_(o);m!==-1&&this.addEdgeToCluster(m,d),this.m_shape.selected(c)&&(g=this.newEdge_(o),this.addEdgeToCluster(g,d))}m=g,o=c}if(this.m_shape.isClosedPath(s)){let l=this.m_shape.getNextVertex(o);if(this.m_shape.selected(o)){let u=this.newCluster_(o);if(m!==-1&&this.addEdgeToCluster(m,u),this.m_shape.selected(l)){let c=this.newEdge_(o);this.addEdgeToCluster(c,u),this.addEdgeToCluster(c,a)}}}else{let l=-1;this.m_shape.selected(o)&&(l=this.newCluster_(o),m!==-1&&this.addEdgeToCluster(m,l))}}else for(let s=this.m_shape.getFirstPath(e);s!==v;s=this.m_shape.getNextPath(s)){let n=this.m_shape.getFirstVertex(s);for(let i=0,o=this.m_shape.getPathSize(s);i<o;i++)this.m_shape.selected(n)&&this.newCluster_(n),n=this.m_shape.getNextVertex(n)}this.fillEventQueue()}progress_(t=!1){}dbgCheckSweepStructure_(){}};function S1(r,t,e,s){e>0&&$d(r,e,t,!1,s),new ol(s).executeImpl_(r,t)}function jg(r,t,e){return{vertex0:r,vertex1:t,dir:e}}var ol=class{constructor(t){this.m_shape=null,this.m_spikes=[],this.m_points=new he(0),this.m_pointsIndex=-1,this.m_dissolvedEdges=0,this.m_progressTracker=t}executeImpl_(t,e){if(this.m_shape=t,t.getPathCount(e)<2&&t.getPointCount(e)<6)return;this.m_points.resize(0);for(let u=t.getFirstPath(e);u!==v;u=t.getNextPath(u)){let c=t.getFirstVertex(u);for(let g=0,d=t.getPathSize(u);g<d;g++,c=t.getNextVertex(c))this.m_points.add(c)}this.m_pointsIndex=t.createUserIndex();for(let u=0,c=this.m_points.size();u<c;++u)t.setUserIndex(this.m_points.read(u),this.m_pointsIndex,u);t.sortVerticesSimpleByY(this.m_points,0,this.m_points.size());let s=this.m_points.read(0),n=t.getXY(s),i=1,o=0,a=[];for(let u=1;u<this.m_points.size();u++){let c=this.m_points.read(u);if(c===v||t.getUserIndex(c,this.m_pointsIndex)===-1)continue;let g=t.getXY(c);if(g.isEqualPoint2D(n))i++;else{if(i>1){for(let d=o;d<u;d++){let _=this.m_points.read(d);if(t.getUserIndex(_,this.m_pointsIndex)===-1)continue;let p=t.getNextVertex(_),f=t.getPrevVertex(_);if(_!==p&&!t.isEqualXYPoint2D(p,n)){let x=jg(_,p,1);a.push(x)}if(_!==f&&f!==p&&!t.isEqualXYPoint2D(f,n)){let x=jg(_,f,-1);a.push(x)}}a.length>0&&this.processBunch_(a,n)}s=c,n.assign(g),i=1,o=u}}if(this.m_dissolvedEdges===0)return t.removeUserIndex(this.m_pointsIndex),void(this.m_pointsIndex=-1);let h=t.getPointCount(e);for(let u=0;u<this.m_points.size();u++){let c=this.m_points.read(u);if(c===v)continue;if(t.getUserIndex(c,this.m_pointsIndex)!==-1){t.setUserIndex(c,this.m_pointsIndex,-1);continue}let g=t.getPathFromVertex(c);t.getFirstVertex(g)===c&&t.setFirstVertex(g,v),t.freeVertex(c),this.m_points.write(u,v),h--}let m=t.createPathUserIndex(),l=t.getPathCount(e);for(let u=0,c=this.m_points.size();u<c;++u){if(this.m_points.read(u)===v)continue;let g=this.m_points.read(u);if(t.getUserIndex(g,this.m_pointsIndex)!==-1)continue;let d=t.getPathFromVertex(g),_=-1;if(t.getPathUserIndex(d,m)===2){d=v;for(let C=t.getNextVertex(g);C!==g;C=t.getNextVertex(C)){let P=t.getPathFromVertex(C);if(t.getPathUserIndex(P,m)!==2){d=P,g=C;break}}d===v&&(d=t.insertPath(e,v),t.setClosedPath(d,!0),l++),w(d!==v)}t.setPathUserIndex(d,m,2),_=t.getFirstVertex(d);let p=0,f=!1,x=g;do{_===x&&(f=!0),t.setUserIndex(x,this.m_pointsIndex,1);let C=t.getPathFromVertex(x);C!==d&&(t.getPathUserIndex(C,m)!==2&&(t.setPathUserIndex(C,m,1),t.setFirstVertex(C,v)),t.setPathToVertex(x,d)),p++,x=t.getNextVertex(x)}while(x!==g);f||t.setFirstVertex(d,g),t.setPathSize(d,p)}for(let u=t.getFirstPath(e);u!==v;){let c=t.getNextPath(u);t.getPathUserIndex(u,m)!==1&&t.getFirstVertex(u)!==v||(t.removePathOnly(u),l--),u=c}t.setGeometryVertexCount(e,h),t.setGeometryPathCount(e,l),t.removePathUserIndex(m),t.removeUserIndex(this.m_pointsIndex),this.m_pointsIndex=-1,t.dbgVerifyVertexCounts(),t.filterClosePoints(0,!0,!1,!1,e)}processBunch_(t,e){t.sort((a,h)=>{let m=this.m_shape.getXY(a.vertex1).sub(e),l=this.m_shape.getXY(h.vertex1).sub(e),u=y.compareVectors(m,l);return u===0?a.dir<h.dir?-1:1:u});let s=0,n=this.m_shape.getXY(t[0].vertex1),i=1,o=this.m_shape.hasCurves();for(let a=1,h=t.length;a<h;a++){let m=this.m_shape.getXY(t[a].vertex1);if(!(m.isEqualPoint2D(n)&&(i++,a+1<h))){if(i===2){let l=t[s],u=t[s+1],c=l.dir;if(c!==u.dir){let g=!0;if(o&&(g=!this.m_shape.isCurve(l.dir===1?l.vertex0:l.vertex1)&&!this.m_shape.isCurve(u.dir===1?u.vertex0:u.vertex1)),g){if(c===1){let d=l.vertex0,_=u.vertex0;this.m_shape.setNextVertex(d,_),this.m_shape.setPrevVertex(_,d),this.m_shape.getPrevVertex(d)===_&&(this.m_shape.setUserIndex(d,this.m_pointsIndex,-1),this.m_shape.setUserIndex(_,this.m_pointsIndex,-1));let p=l.vertex1,f=u.vertex1;this.m_shape.setPrevVertex(p,f),this.m_shape.setNextVertex(f,p),this.m_shape.getNextVertex(p)===f&&(this.m_shape.setUserIndex(p,this.m_pointsIndex,-1),this.m_shape.setUserIndex(f,this.m_pointsIndex,-1))}else{let d=l.vertex0,_=u.vertex0;this.m_shape.setPrevVertex(d,_),this.m_shape.setNextVertex(_,d),this.m_shape.getNextVertex(d)===_&&(this.m_shape.setUserIndex(d,this.m_pointsIndex,-1),this.m_shape.setUserIndex(_,this.m_pointsIndex,-1));let p=l.vertex1,f=u.vertex1;this.m_shape.setNextVertex(p,f),this.m_shape.setPrevVertex(f,p),this.m_shape.getPrevVertex(p)===f&&(this.m_shape.setUserIndex(p,this.m_pointsIndex,-1),this.m_shape.setUserIndex(f,this.m_pointsIndex,-1))}this.m_dissolvedEdges+=2}}}n.assign(m),s=a,i=1}}t.length=0}};function e_(r){for(let t=r.getFirstGeometry();t!==v;t=r.getNextGeometry(t))if(at(r.getGeometryType(t)))return!0;return!1}function v1(r,t,e,s){if(!e_(r))return!1;let n=new Wn(s);n.m_shape=r,n.m_tolerance=t,n.m_bTrackChanges=e;let i=!1,o=r.hasCurves()?5:15;return i=r.getTotalPointCount()<o?n.crackBruteForce_():n.crackerPlaneSweep_(),i}function zl(r,t,e,s,n){if(!e_(t))return!1;let i=new Wn(n);if(i.m_shape=t,i.m_tolerance=e,i.m_bAllowCoincident=r,i.m_bNeedsNonSimpleResult=s!==null,i.needsCrackingImpl_())return s&&s.assign(i.m_nonSimpleResult),!0;let o=new ct;o.setSwapCoordinates(),t.applyTransformation(o),i=new Wn(n),i.m_shape=t,i.m_tolerance=e,i.m_bAllowCoincident=r,i.m_bNeedsNonSimpleResult=s!==null;let a=i.needsCrackingImpl_();return t.applyTransformation(o),!!a&&(s&&s.assign(i.m_nonSimpleResult),!0)}function I1(r,t,e,s){let n=t.getGeometryType();if(at(n))return new Wn(s).crackAWithBMultiPath_(r,t,e);ft("crack_A_with_B")}function Zg(r,t){return{t:r,index:t}}var Wn=class r{crackBruteForce_(){let t=this.crackBruteForceImpl_();if(!t&&this.m_shape.hasCurves()){let e=new ct;e.setSwapCoordinates(),this.m_shape.applyTransformation(e),t=this.crackBruteForceImpl_(),this.m_shape.applyTransformation(e)}return t}crackBruteForceImpl_(){let t=!1,e=new et,s=new et,n=V.constructEmpty(),i=V.constructEmpty(),o=!1,a=new st,h=new $e,m=this.m_shape.getTotalPointCount(),l=m*m*2,u=this.m_shape.queryVertexIteratorOnSelection();for(let c=u.next();c!==v;c=u.next()){let g=this.m_shape.getGeometryType(u.currentGeometry()),d=1,_=1,p=1,f=0,x=0,C=0,P=this.m_shape.getSegmentParentage(c),E=!1,S=!1,I=null,D=!1;if(nn(g))d=this.m_shape.getWeight(c),f=this.m_shape.getRank(c);else{if(I=this.getSegment_(c,e),I===null)continue;let G=this.m_shape.getVertexIndex(c);d=this.m_shape.getWeightWithIndex(G),f=this.m_shape.getRankWithIndex(G),p=this.m_shape.getSegmentWeightWithIndex(G),C=this.m_shape.getSegmentRankWithIndex(G),E=this.m_shape.getSegmentParentageBreakVertex(c);{let F=this.m_shape.getNextVertex(c);_=this.m_shape.getWeight(F),x=this.m_shape.getRank(F),S=this.m_shape.getSegmentParentageBreakVertex(F)}if(I.queryLooseEnvelope(n),n.inflateCoords(this.m_tolerance,this.m_tolerance),I.isDegenerate(this.m_tolerance)){if(!I.isDegenerate(0))continue;D=!0,I=null}}let b=new di({copy:u}),T=b.next();T!==v&&(T=b.next());let A=0;for(;T!==v;T=b.next()){if(A!==0){A--;continue}if(this.m_shape.getTotalPointCount()>l)return t;this.progress_();let G=this.m_shape.getGeometryType(b.currentGeometry()),F=null,M=!1,q=0,R=0,X=0,z=0,Y=0,L=0,W=!1,K=!1,yt=this.m_shape.getSegmentParentage(T);if(nn(G))q=this.m_shape.getWeight(T),z=this.m_shape.getRank(T);else{if(F=this.getSegment_(T,s),F===null)continue;let ht=this.m_shape.getVertexIndex(T);q=this.m_shape.getWeightWithIndex(ht),z=this.m_shape.getRankWithIndex(ht),X=this.m_shape.getSegmentWeightWithIndex(ht),L=this.m_shape.getSegmentRankWithIndex(ht),W=this.m_shape.getSegmentParentageBreakVertex(T);{let it=this.m_shape.getNextVertex(T);R=this.m_shape.getWeight(it),Y=this.m_shape.getRank(it),K=this.m_shape.getSegmentParentageBreakVertex(it)}if(F.queryLooseEnvelope(i),F.isDegenerate(this.m_tolerance)){if(!F.isDegenerate(0))continue;M=!0,F=null}}let rt=0,Q=0;if(I!==null&&F!==null)n.isIntersectingNe(i)&&Nr(!0,!0,I,F,this.m_tolerance,!0)!==0&&(h.pushSegment(I,d,f,_,x,p,C,E,S,P),h.pushSegment(F,q,z,R,Y,X,L,W,K,yt),h.intersect2D(this.m_tolerance,!0),t||=h.getSegmentChanged(0)||h.getSegmentChanged(1),rt=h.getResultSegmentCount(0),Q=h.getResultSegmentCount(1),rt+Q>0&&(this.m_shape.splitSegmentWithIntersector(c,h,0,!0,!0),this.m_shape.splitSegmentWithIntersector(T,h,1,!0,!0),this.m_bTrackChanges&&(h.getSegmentChanged(0)&&this.m_shape.setGeometryModifiedWithVertex(c,!0),h.getSegmentChanged(1)&&this.m_shape.setGeometryModifiedWithVertex(T,!0))),Q>1&&(A+=Q-1),h.clear());else if(I!==null){let ht=this.m_shape.getXY(T);if(n.contains(ht)){if(h.pushSegment(I,d,f,_,x,p,C,E,S,P),this.m_shape.queryPoint(T,a),h.intersect2DEx(this.m_tolerance,a,z,q,o),t||=h.getSegmentChanged(0)||h.getResultPointChanged(),rt=h.getResultSegmentCount(0),rt>0)if(this.m_bTrackChanges&&(h.getSegmentChanged(0)&&this.m_shape.setGeometryModifiedWithVertex(c,!0),h.getSegmentChanged(1)&&this.m_shape.setGeometryModifiedWithVertex(T,!0)),this.m_shape.splitSegmentWithIntersector(c,h,0,!0,!0),M){let it=v;for(let mt=this.m_shape.getNextVertex(T);mt!==v&&mt!==T&&(F=this.getSegment_(mt,s),it=mt,F!=null&&F.isDegenerate(0));mt=this.m_shape.getNextVertex(mt));for(let mt=T;mt!==v&&(this.m_shape.setPoint(mt,h.getResultPoint(),!0),mt!==it);mt=this.m_shape.getNextVertex(mt));}else this.m_shape.setPoint(T,h.getResultPoint(),!0);h.clear()}}else{if(F===null)continue;{let ht=this.m_shape.getXY(c);if(i.inflateCoords(this.m_tolerance,this.m_tolerance),i.contains(ht)){if(h.pushSegment(F,q,z,R,Y,X,L,W,K,yt),this.m_shape.queryPoint(c,a),h.intersect2DEx(this.m_tolerance,a,f,d,o),t||=h.getSegmentChanged(0)||h.getResultPointChanged(),Q=h.getResultSegmentCount(0),Q>0)if(this.m_bTrackChanges&&(h.getSegmentChanged(0)&&this.m_shape.setGeometryModifiedWithVertex(T,!0),h.getSegmentChanged(1)&&this.m_shape.setGeometryModifiedWithVertex(c,!0)),this.m_shape.splitSegmentWithIntersector(T,h,0,!0,!0),A+=Q-1,D){let it=v;for(let mt=this.m_shape.getNextVertex(c);mt!==v&&mt!==c&&(F=this.getSegment_(mt,s),it=mt,F!=null&&F.isDegenerate(0));mt=this.m_shape.getNextVertex(mt));for(let mt=c;mt!==v&&(this.m_shape.setPoint(mt,h.getResultPoint(),!0),mt!==it);mt=this.m_shape.getNextVertex(mt));}else this.m_shape.setPoint(c,h.getResultPoint(),!0);h.clear()}}}if(rt+Q!==0&&rt!==0){let ht=!1;for(;I=this.getSegment_(c,e),I!=null&&(I.queryEnvelope(n),I.isDegenerate(this.m_tolerance));){if(!(rt>1)){ht=!0;break}c=u.next(),rt--,w(c!==v)}if(ht)break}}}return t}crackerPlaneSweep_(){return this.planesweep_()}planesweep_(){return new qr(this.m_progressTracker,this.m_bTrackChanges).sweep(this.m_shape,this.m_tolerance)}needsCrackingImpl_(){let t=!1,e=new he(0);e.resize(this.m_shape.getSelectedCount());let s=this.m_shape.queryVertexIteratorOnSelection();for(let u=0,c=s.next();c!==v;++u,c=s.next())e.write(u,c);this.m_shape.sortVerticesSimpleByY(e,0,e.size()),e.add(v);let n=this.m_shape.createUserIndex(),i=this.m_shape.createUserIndex();this.m_sweepComparator=new ra(this.m_shape,this.m_tolerance,!this.m_bAllowCoincident),this.m_sweepStructure.setComparator(this.m_sweepComparator);let o=null,a=[],h=[],m=0,l=new y;for(let u=e.read(m++);u!==v;){this.m_shape.queryXY(u,l);let c=!1;do{let f=this.m_shape.getNextVertex(u),x=this.m_shape.getPrevVertex(u);c||=f!==v||x!==v,f===v||this.m_shape.selected(f)||(f=v),x===v||this.m_shape.selected(x)||(x=v),f!==v&&this.m_shape.compareVerticesSimpleY(u,f)<0&&(h.push(u),h.push(f)),x!==v&&this.m_shape.compareVerticesSimpleY(u,x)<0&&(h.push(x),h.push(x));let C=this.m_shape.getUserIndex(u,n);C!==-1&&(a.push(C),this.m_shape.setUserIndex(u,n,-1));let P=this.m_shape.getUserIndex(u,i);P!==-1&&(a.push(P),this.m_shape.setUserIndex(u,i,-1)),u=e.read(m++)}while(u!==v&&this.m_shape.isEqualXYPoint2D(u,l));if(!c&&(o===null&&(o=new oa(this.m_shape,this.m_tolerance)),o.setPoint(l),this.m_sweepStructure.searchUpperBound(o),o.intersectionDetected())){t=!0,this.m_bNeedsNonSimpleResult&&(j("needsCrackingIMpl_"),this.m_nonSimpleResult=new vt(6,-1,-1));break}let g=a.length===1&&h.length===2;a.length>32&&Nn(a);let _=-1,p=-1;if(!g)for(let f=0,x=a.length;f<x;f++){let C=a[f],P=this.m_sweepStructure.getPrev(C);if(P!==-1&&a.indexOf(P)===-1)if(_===-1)_=P;else{if(t=!0,!this.m_bNeedsNonSimpleResult)break;this.m_nonSimpleResult=new vt(6,-1,-1)}let E=this.m_sweepStructure.getNext(C);if(E!==-1&&a.indexOf(E)===-1)if(p===-1)p=E;else{if(t=!0,!this.m_bNeedsNonSimpleResult)break;this.m_nonSimpleResult=new vt(6,-1,-1)}if(_!==-1&&p!==-1)break}if(t&&!this.m_bNeedsNonSimpleResult)break;if(this.m_sweepComparator.setSweepY(l.y,l.x),!g){for(let f=0,x=a.length;f<x;f++){let C=a[f];this.m_sweepStructure.deleteNode(C)}a.length=0}if(!g&&_!==-1&&p!==-1&&this.checkForIntersections_(_,p)){t=!0,this.m_bNeedsNonSimpleResult&&(this.m_nonSimpleResult=this.m_sweepComparator.getResult());break}for(let f=0,x=h.length;f<x;f+=2){let C=h[f],P=h[f+1],E;if(g?(E=this.m_sweepStructure.replaceElementAtPosition(a[0],C,!0,!0),a.length=0,g=!1):E=this.m_sweepStructure.addElement(C),this.m_sweepComparator.intersectionDetected()){this.m_bNeedsNonSimpleResult&&(this.m_nonSimpleResult=this.m_sweepComparator.getResult()),t=!0;break}this.m_shape.getUserIndex(P,n)===-1?this.m_shape.setUserIndex(P,n,E):this.m_shape.setUserIndex(P,i,E)}if(t)break;h.length=0}return this.m_shape.removeUserIndex(n),this.m_shape.removeUserIndex(i),t}checkForIntersections_(t,e){let s=this.m_sweepStructure.getElement(t);this.m_sweepComparator.compare(this.m_sweepStructure,s,e);let n=this.m_sweepComparator.intersectionDetected();return this.m_sweepComparator.clearIntersectionDetectedFlag(),n}getSegment_(t,e){return r.st_getSegment(this.m_shape,t,e)}static st_getSegment(t,e,s){return t.querySegment(e,s,!1,!1)?s.get():null}dbgPrintSweepEdge(t){}dbgPrintSweepStructure(){}dbgSaveSweepStructure(t=null){}dbgCheckSweepStructure(){}progress_(t=!1){this.m_progressCounter++}crackAWithBMultiPath_(t,e,s){let n=V.constructEmpty();t.queryLooseEnvelope(n);let i=V.constructEmpty();if(e.queryLooseEnvelope(i),i.inflateCoords(s,s),!i.isIntersecting(n))return t;let o=t.getImpl(),a=o.getAccelerators(),h=null,m=null;a&&(m=a.getQuadTree()),b1(t,Zn(e))&&(h=cn(o,i),m=h);let l=m?m.getIteratorForQT():null,u=e.querySegmentIterator(),c=t.querySegmentIterator(),g=Z(15,Number.NaN),d=[];for(;u.nextPath();)for(;u.hasNextSegment();){let P=u.nextSegment();if(m){l.resetIterator(P,s);for(let E=l.next();E!==-1;E=l.next()){this.progress_();let S=m.getElement(E);if(c.resetToVertex(S,-1),c.hasNextSegment()){let I=c.nextSegment().intersect(P,null,g,null,s);for(let D=0;D<I;D++){let b=g[D];if(b===0||b===1)continue;let T=Zg(b,c.getStartPointIndex());d.push(T)}}}}else{let E=V.constructEmpty();if(P.queryLooseEnvelope(E),E.inflateCoords(s,s),!n.isIntersecting(E))continue;for(c.resetToFirstPath();c.nextPath();)for(;c.hasNextSegment();){let S=c.nextSegment(),I=V.constructEmpty();if(S.queryLooseEnvelope(I),!I.isIntersecting(E))continue;let D=S.intersect(P,null,g,null,s);for(let b=0;b<D;b++){let T=g[b];if(T===0||T===1)continue;let A=Zg(T,c.getStartPointIndex());d.push(A)}}}}if(d.length===0)return t;d.sort((P,E)=>P.index<E.index?-1:P.index>E.index?1:P.t<E.t?-1:P.t>E.t?1:0);let _=t.createInstance();for(_.getGeometryType()===N.enumPolygon&&_.setFillRule(t.getFillRule()),c.resetToFirstPath();c.nextPath()&&!c.hasNextSegment(););w(c.hasNextSegment());let p=c.nextSegment(),f=new et,x=-1;for(let P=0,E=d.length;P<E;){let S=d[P].index,I=P+1;for(;I<E&&d[I].index===S;)++I;for(;c.getStartPointIndex()<S;){this.progress_();let T=c.hasNextSegment(),A=c.getPathIndex();if((T||!c.isClosingSegment()||c.isCurve())&&(w(p!==null),_.addSegment(p,x!==A)),x=A,!T){for(c.isPathClosed();c.nextPath()&&!c.hasNextSegment(););w(c.hasNextSegment())}p=c.nextSegment()}let D=0;for(let T=P;T<I;T++){let A=d[T].t;if(A===D)continue;w(p!==null),p.queryCut(D,A,f),D=A;let G=c.getPathIndex();_.addSegment(f.get(),x!==G),x=G}let b=c.hasNextSegment();if((b||!c.isClosingSegment()||c.isCurve())&&(w(p!=null),p.queryCut(D,1,f),_.addSegment(f.get(),!1)),b)p=c.nextSegment();else{for(;c.nextPath()&&!c.hasNextSegment(););p=c.hasNextSegment()?c.nextSegment():null}P=I}if(p!==null){let P=c.getPathIndex();(c.hasNextSegment()||!c.isClosingSegment()||c.isCurve())&&_.addSegment(p,x!==P),x=P}let C=c.hasNextSegment();for(;;){if(!C){for(;c.nextPath()&&(C=c.hasNextSegment(),!C););if(!C)break}p=c.nextSegment();let P=c.getPathIndex();C=c.hasNextSegment(),(C||!c.isClosingSegment()||c.isCurve())&&_.addSegment(p,x!==P),x=P}return _}constructor(t){this.m_shape=null,this.m_progressTracker=null,this.m_nonSimpleResult=new vt,this.m_tolerance=0,this.m_sweepComparator=null,this.m_progressCounter=0,this.m_bTrackChanges=!1,this.m_bNeedsNonSimpleResult=!1,this.m_bAllowCoincident=!0,this.m_sweepStructure=new Ot,this.m_progressTracker=t}};function b1(r,t){let e=r.getPointCount();return e<16?!1:2*e+1*(Math.log(e)/Math.log(2))*t<1*e*t}Wn.s_bForceBruteForce=!0;var ua=class{constructor(t,e){this.m_monotoneParts=k(et,16),this.m_xOrds=Z(16,Number.NaN),this.m_inputPoint=y.getNAN(),this.m_miny=0,this.m_maxy=0,this.m_windnum=0,this.m_bAlternate=t,this.m_tolerance=e,this.m_toleranceSqr=e*e,this.m_bTestBorder=!!e,this.m_bBreak=!1}_DoOne(t){if(!this.m_bTestBorder&&(this.m_bAlternate&&this.m_inputPoint.equals(t.getStartXY())||this.m_inputPoint.equals(t.getEndXY())))return void(this.m_bBreak=!0);if(t.getStartY()===this.m_inputPoint.y&&t.getStartY()===t.getEndY()){if(this.m_bAlternate&&!this.m_bTestBorder){let n=Math.min(t.getStartX(),t.getEndX()),i=Math.max(t.getStartX(),t.getEndX());this.m_inputPoint.x>n&&this.m_inputPoint.x<i&&(this.m_bBreak=!0)}return}let e=!1,s=Math.max(t.getStartX(),t.getEndX());if(this.m_inputPoint.x>s)e=!0;else if(this.m_inputPoint.x>=Math.min(t.getStartX(),t.getEndX())){let n=t.intersectionOfYMonotonicWithAxisX(this.m_inputPoint.y,s);e=!Number.isNaN(n)&&n<=this.m_inputPoint.x}if(e){if(this.m_inputPoint.y===t.getStartY()){if(this.m_inputPoint.y<t.getEndY())return}else if(this.m_inputPoint.y===t.getEndY()&&this.m_inputPoint.y<t.getStartY())return;this.m_bAlternate?this.m_windnum^=1:this.m_windnum+=t.getStartY()>t.getEndY()?1:-1}}_Result(){return!!this.m_windnum}testBorder(t){let e=t.getClosestCoordinate(this.m_inputPoint,!1),s=t.getCoord2D(e);return y.sqrDistance(s,this.m_inputPoint)<=this.m_toleranceSqr}setInputPoint(t){this.m_inputPoint.setCoordsPoint2D(t),this.m_miny=t.y-this.m_tolerance,this.m_maxy=t.y+this.m_tolerance}processSegment(t){let e=t.queryInterval(0,1);if(e.vmin>this.m_maxy||e.vmax<this.m_miny)return!1;if(this.m_bTestBorder&&this.testBorder(t))return!0;if(e.vmin>this.m_inputPoint.y||e.vmax<this.m_inputPoint.y)return!1;let s=0;if(t.isCurve()&&(this.m_monotoneParts.length===0&&(this.m_monotoneParts.length=128),s=t.getMonotonicParts(this.m_monotoneParts,!0),w(this.m_monotoneParts.length>=s)),s>0)for(let n=0;n<s;n++){let i=this.m_monotoneParts[n].get(),o=B.construct(i.getStartY(),i.getEndY());if(!(o.vmin>this.m_inputPoint.y||o.vmax<this.m_inputPoint.y)&&(this._DoOne(i),this.m_bBreak))return!0}else if(this._DoOne(t),this.m_bBreak)return!0;return!1}result(){return w(0),2}};function w1(r,t,e,s){let n=new V;r.queryLooseEnvelope(n),n.inflateCoords(s,s);let i=r.getFillRule()===0,o=new ua(i,s);o.setInputPoint(e);let a=n.clone();a.xmax=e.x+s,a.ymin=e.y-s,a.ymax=e.y+s;let h=r.getImpl().querySegmentIterator(),m=t.getIterator(a,s);for(let l=m.next();l!==-1;l=m.next())if(h.resetToVertex(t.getElement(l),-1),h.hasNextSegment()){let u=h.nextSegment();if(o.processSegment(u))return-1}return o._Result()?1:0}function D1(r,t,e){let s=r.getFillRule()===0,n=new ua(s,e);n.setInputPoint(t);let i=r.getImpl().querySegmentIterator();for(;i.nextPath();)for(;i.hasNextSegment();){let o=i.nextSegment();if(n.processSegment(o))return-1}return n._Result()?1:0}function T1(r,t,e){return t.isEmpty()?0:ca(r,t.getXY(),e)}function ca(r,t,e){if(r.isEmpty())return 0;let s=V.constructEmpty();if(r.queryLooseEnvelope(s),s.inflateCoords(e,e),!s.contains(t))return 0;let n=r.getImpl().getAccelerators();if(n){n.getRasterizedGeometry()&&w(0);let i=n.getQuadTree();if(i)return w1(r,i,t,e)}return D1(r,t,e)}function bn(r,t){let e=r.getPointCount();return e<16?!1:2*e+1*(Math.log(e)/Math.log(2))*t<1*e*t}function N1(r,t,e,s,n){let i=new da(n);return i.m_shape=r,i.m_geometry=t,i.m_sortedVertices=e,i.m_bFixSelfTangency=s,i.fixRingOrientation_()}function $E(r,t,e){let s=new da(e);return s.m_shape=r,s.m_geometry=t,s.m_sortedVertices=null,s.m_bFixSelfTangency=!1,s.fixRingOrientationForMp2sp_()}var al=class{getDirection_(t){return this.m_shape.getNextVertex(this.getEnd1(t))===this.getEnd2(t)}getEnd_(t){let e=this.getEnd1(t),s=this.getEnd2(t);return this.m_shape.getNextVertex(e)===s?s:e}constructor(t){this.m_end1Nodes=[],this.m_end2Nodes=[],this.m_directions=[],this.m_shape=t,this.m_firstFree=-1}getSegment(t){return this.m_shape.getSegment(this.getStart(t))}isBottomUp(t){let e=this.getEnd1(t),s=this.getEnd2(t);this.m_shape.getPrevVertex(e)===s&&(s=O(e,e=s));let n=y.getNAN(),i=y.getNAN();return this.m_shape.queryXY(e,n),this.m_shape.queryXY(s,i),w(!n.equals(i)),n.y<i.y}getStart(t){let e=this.getEnd1(t),s=this.getEnd2(t);return this.m_shape.getNextVertex(e)===s?e:s}getEnd1(t){return this.m_end1Nodes[t]}getEnd2(t){return this.m_end2Nodes[t]}freeEdge(t){this.m_end1Nodes[t]=this.m_firstFree,this.m_firstFree=t}newEdge(t){if(this.m_firstFree!==-1){let s=this.m_firstFree;return this.m_firstFree=this.m_end1Nodes[s],this.m_end1Nodes[s]=t,this.m_end2Nodes[s]=this.m_shape.getNextVertex(t),s}let e=this.m_end1Nodes.length;return this.m_end1Nodes.push(t),this.m_end2Nodes.push(this.m_shape.getNextVertex(t)),e}getShape(){return this.m_shape}getPath(t){return this.m_shape.getPathFromVertex(this.getEnd1(t))}},A1=class extends Gn{constructor(r){super(),this.m_line1=new nt,this.m_line2=new nt,this.m_leftElm=-1,this.m_leftx=0,this.m_seg1=null,this.m_helper=r}compare(r,t,e){let s=r.getElement(e),n=this.m_helper.m_edges,i;this.m_leftElm===t?i=this.m_leftx:(this.m_seg1=n.getSegment(t),this.m_seg1?i=this.m_seg1.intersectionOfYMonotonicWithAxisX(this.m_helper.m_yScanline,0):(n.getShape().queryLineConnector(n.getStart(t),this.m_line1,!0),this.m_seg1=this.m_line1,i=this.m_line1.intersectionOfYMonotonicWithAxisX(this.m_helper.m_yScanline,0)),this.m_leftx=i,this.m_leftElm=t);let o,a=n.getSegment(s);if(a?o=a.intersectionOfYMonotonicWithAxisX(this.m_helper.m_yScanline,0):(n.getShape().queryLineConnector(n.getStart(s),this.m_line2,!0),a=this.m_line2,o=this.m_line2.intersectionOfYMonotonicWithAxisX(this.m_helper.m_yScanline,0)),i===o){let h=n.isBottomUp(t),m=n.isBottomUp(s),l=h?this.m_seg1.getEndY():this.m_seg1.getStartY(),u=m?a.getEndY():a.getStartY(),c=Math.min(l,u),g=.5*(c+this.m_helper.m_yScanline);g===this.m_helper.m_yScanline&&(g=c),i=this.m_seg1.intersectionOfYMonotonicWithAxisX(g,0),o=a.intersectionOfYMonotonicWithAxisX(g,0),i===o&&Zr("")}return i<o?-1:i>o?1:0}reset(){this.m_leftElm=-1}},ga=class{constructor(t){this.m_node=-1,this.m_index=0,this.m_sortedVertices=t.m_sortedVertices,this.m_sortedVerticesArray=t.m_sortedVerticesArray,this.m_sortedVertices&&(this.m_node=this.m_sortedVertices.getFirst(this.m_sortedVertices.getFirstList()))}next(){if(this.m_sortedVertices){let t=this.m_node;if(t===-1)return v;let e=this.m_sortedVertices.getData(t);return this.m_node=this.m_sortedVertices.getNext(t),e}if(this.m_index<this.m_sortedVerticesArray.size()){let t=this.m_sortedVerticesArray.read(this.m_index);return this.m_index++,t}return v}},da=class{constructor(t){this.m_edges=null,this.m_shape=null,this.m_AET=new Ot,this.m_yScanline=0,this.m_geometry=v,this.m_unknownRingOrientationCount=-1,this.m_sortedVertices=null,this.m_sortedVerticesArray=null,this.m_unknownNodes=[],this.m_node1UserIndex=-1,this.m_node2UserIndex=-1,this.m_pathOrientationIndex=-1,this.m_pathParentageIndex=-1,this.m_pathParentsIndex=-1,this.m_progressCounter=0,this.m_bFixSelfTangency=!1,this.m_progressTracker=t,this.m_AET.disableBalancing(),this.m_sweepComparator=new A1(this),this.m_AET.setComparator(this.m_sweepComparator)}fixRingOrientation_(){let t=this.fixRingOrientationImplMain_();return this.m_pathOrientationIndex===-1||this.fixRingOrientationImplSimplify_(),t}fixRingOrientationForMp2sp_(){return this.fixRingOrientationImplMain_(),this.m_pathOrientationIndex===-1?-1:this.fixRingOrientationImplMp2sp_()}processBunchForRingOrientationTest_(t){return this.processBunchForRingOrientationTestOddEven_(t)}processBunchForRingOrientationTestOddEven_(t){let e=!1;if(this.m_edges||(this.m_edges=new al(this.m_shape)),this.m_unknownNodes.length=0,this.processBunchForRingOrientationRemoveEdges_(t),!this.m_AET.isAutoBalancing()){let s=0;for(let n=0,i=t.length;n<i;n++)t[n]!==-1&&s++;(s>10||this.m_AET.getMaxDepthEver()>4)&&this.m_AET.enableBalancing()}for(let s=0,n=t.length;s<n;s++){let i=t[s];i!==v&&this.insertEdge_(i,-1)}for(let s=0;s<this.m_unknownNodes.length&&this.m_unknownRingOrientationCount>0;s++){let n=this.m_unknownNodes[s],i=this.m_AET.getElement(n),o=this.m_edges.getPath(i),a=this.m_shape.getPathUserIndex(o,this.m_pathOrientationIndex),h=v;if(a===0){let m=this.m_AET.getPrev(n),l=n,u=!1;for(;m!==Ot.st_nullNode();){let c=this.m_AET.getElement(m),g=this.m_edges.getPath(c);if(this.m_shape.getPathUserIndex(g,this.m_pathOrientationIndex)!==0){h=g;break}l=m,m=this.m_AET.getPrev(m)}if(m===Ot.st_nullNode())u=!0,m=l;else{let c=this.m_AET.getElement(m);u=this.m_edges.isBottomUp(c),m=this.m_AET.getNext(m),u=!u}do{let c=this.m_AET.getElement(m),g=this.m_edges.getPath(c);if(this.m_shape.getPathUserIndex(g,this.m_pathOrientationIndex)===0){if(u!==this.m_edges.isBottomUp(c)){let d=this.m_shape.getFirstVertex(g);this.m_shape.reverseRingInternal(d),this.m_shape.setLastVertex(g,this.m_shape.getPrevVertex(d)),e=!0}if(this.m_shape.setPathUserIndex(g,this.m_pathOrientationIndex,u?3:2),!u){let d=this.m_shape.getPathUserIndex(h,this.m_pathOrientationIndex);d===2?(h=this.m_shape.getPathUserIndex(h,this.m_pathParentsIndex),d=this.m_shape.getPathUserIndex(h,this.m_pathOrientationIndex),w(d===3)):w(d===3);let _=this.m_shape.getPathUserIndex(h,this.m_pathParentageIndex);this.m_shape.setPathUserIndex(h,this.m_pathParentageIndex,g),this.m_shape.setPathUserIndex(g,this.m_pathParentageIndex,_),this.m_shape.setPathUserIndex(g,this.m_pathParentsIndex,h)}if(this.m_unknownRingOrientationCount--,!this.m_unknownRingOrientationCount)return e}h=g,l=m,m=this.m_AET.getNext(m),u=!u}while(l!==n)}}return e}processBunchForRingOrientationRemoveEdges_(t){for(let e=0,s=t.length;e<s;e++){let n=t[e],i=this.m_shape.getUserIndex(n,this.m_node1UserIndex),o=this.m_shape.getUserIndex(n,this.m_node2UserIndex);if(i!==-1){let h=this.m_AET.getElement(i);this.m_edges.freeEdge(h),this.m_shape.setUserIndex(n,this.m_node1UserIndex,-1)}if(o!==-1){let h=this.m_AET.getElement(o);this.m_edges.freeEdge(h),this.m_shape.setUserIndex(n,this.m_node2UserIndex,-1)}let a=-1;i!==-1&&o!==-1?(this.m_AET.deleteNode(i),this.m_AET.deleteNode(o),t[e]=v):a=i!==-1?i:o,a!==-1&&(this.insertEdge_(n,a)||this.m_AET.deleteNode(a),t[e]=v)}}dbgVerifyRingOrientation_(){}insertEdge_(t,e){let s=y.getNAN(),n=y.getNAN();this.m_shape.queryXY(t,s);let i=this.m_shape.getNextVertex(t);this.m_shape.queryXY(i,n);let o=!1;if(s.y<n.y){o=!0;let h=this.m_edges.newEdge(t),m;e===-1?m=this.m_AET.addElement(h):(m=e,this.m_AET.setElement(m,h)),this.m_shape.getUserIndex(i,this.m_node1UserIndex)===-1?this.m_shape.setUserIndex(i,this.m_node1UserIndex,m):this.m_shape.setUserIndex(i,this.m_node2UserIndex,m);let l=this.m_shape.getPathFromVertex(t);this.m_shape.getPathUserIndex(l,this.m_pathOrientationIndex)===0&&this.m_unknownNodes.push(m)}let a=this.m_shape.getPrevVertex(t);if(this.m_shape.queryXY(a,n),s.y<n.y){o=!0;let h=this.m_edges.newEdge(a),m;e===-1?m=this.m_AET.addElement(h):(m=e,this.m_AET.setElement(m,h)),this.m_shape.getUserIndex(a,this.m_node1UserIndex)===-1?this.m_shape.setUserIndex(a,this.m_node1UserIndex,m):this.m_shape.setUserIndex(a,this.m_node2UserIndex,m);let l=this.m_shape.getPathFromVertex(t);this.m_shape.getPathUserIndex(l,this.m_pathOrientationIndex)===0&&this.m_unknownNodes.push(m)}return o}fixRingSelfTangency_(){let t=[],e=[],s=-1,n=-1,i=new y,o=v,a=v,h=-1,m=new ga(this);for(let l=m.next();l!==v;l=m.next()){let u=new y;this.m_shape.queryXY(l,u);let c=this.m_shape.getPathFromVertex(l);i.equals(u)&&a===c?(n===-1&&(s=this.m_shape.createPathUserIndex(),this.m_shape.fillPathUserIndexForGeometry(this.m_geometry,s,-1),n=this.m_shape.createUserIndex(),this.m_shape.fillUserIndexForGeometry(this.m_geometry,n,-1)),h===-1&&(h=e.length,this.m_shape.setUserIndex(o,n,h),e.push(1),this.m_shape.getPathUserIndex(c,s)===-1&&(this.m_shape.setPathUserIndex(c,s,o),t.push(c))),this.m_shape.setUserIndex(l,n,h),e[e.length-1]++):(h=-1,i.assign(u)),o=l,a=c}if(t.length===0)return!1;w(s!==-1);for(let l=0,u=t.length;l<u;l++){let c=t[l],g=this.m_shape.getPathUserIndex(c,s),d=this.m_shape.getUserIndex(g,n),_=[],p=[];_.push(g),p.push(d);for(let f=this.m_shape.getNextVertex(g);f!==g;f=this.m_shape.getNextVertex(f)){let x=f,C=this.m_shape.getUserIndex(x,n);if(C!==-1){if(p.length===0){p.push(C),_.push(x);continue}if(p.at(-1)===C){let P=_.at(-1);this.m_shape.peelALoopIntoAPath(P,x),this.m_shape.setUserIndex(f,n,-1),e[C]--,e[C]===1&&(e[C]=0,p.pop(),_.pop()),g=P,f=P}else _.push(f),p.push(C)}}}return this.m_shape.removePathUserIndex(s),this.m_shape.removeUserIndex(n),this.m_shape.dbgVerifyVertexCounts(),!0}progress_(t=!1){}fixRingOrientationImplMain_(){let t={stack:[],error:void 0,hasError:!1};try{let e,s=!1,n=xe(t,Qa(()=>{this.m_sortedVerticesArray=null}),!1);if(this.m_sortedVertices===null){let h=this.m_shape.getPointCount(this.m_geometry);e=new he(0);for(let m=this.m_shape.getFirstPath(this.m_geometry);m!==v;m=this.m_shape.getNextPath(m)){let l=this.m_shape.getFirstVertex(m);for(let u=0,c=this.m_shape.getPathSize(m);u<c;u++)e.add(l),l=this.m_shape.getNextVertex(l)}this.m_shape.sortVerticesSimpleByY(e,0,h),this.progress_(!0),this.m_sortedVerticesArray=e}else n.bForget=!0;if(this.m_bFixSelfTangency&&(s=this.fixRingSelfTangency_()),this.m_shape.getPathCount(this.m_geometry)===1){let h=this.m_shape.getFirstPath(this.m_geometry),m=this.m_shape.getRingArea(h);if(this.m_shape.setExterior(h,!0),m<0){let l=this.m_shape.getFirstVertex(h);return this.m_shape.reverseRingInternal(l),this.m_shape.setLastVertex(h,this.m_shape.getPrevVertex(l)),!0}return!1}this.m_shape.dbgVerifyCurves(),this.m_pathOrientationIndex=this.m_shape.createPathUserIndex(),this.m_pathParentageIndex=this.m_shape.createPathUserIndex(),this.m_pathParentsIndex=this.m_shape.createPathUserIndex();for(let h=this.m_shape.getFirstPath(this.m_geometry);h!==v;h=this.m_shape.getNextPath(h))this.m_shape.setPathUserIndex(h,this.m_pathOrientationIndex,0),this.m_shape.setPathUserIndex(h,this.m_pathParentageIndex,-1),this.m_shape.setPathUserIndex(h,this.m_pathParentsIndex,-1);let i=[];this.m_yScanline=Number.NaN;let o=y.getNAN();this.m_unknownRingOrientationCount=this.m_shape.getPathCount(this.m_geometry),this.m_node1UserIndex=this.m_shape.createUserIndexUninitialized(),this.m_shape.fillUserIndexForGeometry(this.m_geometry,this.m_node1UserIndex,-1),this.m_node2UserIndex=this.m_shape.createUserIndexUninitialized(),this.m_shape.fillUserIndexForGeometry(this.m_geometry,this.m_node2UserIndex,-1);let a=new ga(this);for(let h=a.next();h!==v&&(this.progress_(),this.m_shape.queryXY(h,o),o.y!==this.m_yScanline&&i.length&&(s=this.processBunchForRingOrientationTest_(i)||s,this.m_sweepComparator.reset(),i.length=0),i.push(h),this.m_yScanline=o.y,this.m_unknownRingOrientationCount!==0);h=a.next());return this.m_unknownRingOrientationCount>0&&(s=this.processBunchForRingOrientationTest_(i)||s,i.length=0),this.m_shape.removeUserIndex(this.m_node1UserIndex),this.m_shape.removeUserIndex(this.m_node2UserIndex),this.dbgVerifyRingOrientation_(),s}catch(e){t.error=e,t.hasError=!0}finally{qs(t)}}fixRingOrientationImplSimplify_(){let t=[];for(let e=this.m_shape.getFirstPath(this.m_geometry);e!==v;)if(this.progress_(),this.m_shape.getPathUserIndex(e,this.m_pathOrientationIndex)===3){this.m_shape.setExterior(e,!0);for(let i=this.m_shape.getPathUserIndex(e,this.m_pathParentageIndex);i!==v;){let o=this.m_shape.getPathUserIndex(i,this.m_pathParentageIndex);t.push(i),this.m_shape.setExterior(i,!1),this.m_shape.setPathUserIndex(i,this.m_pathParentageIndex,e),i=o}let s=e,n=t.length;for(let i=this.m_shape.getNextPath(e);n>0&&i!==v;i=this.m_shape.getNextPath(i),--n){if(this.m_shape.getPathUserIndex(i,this.m_pathParentageIndex)!==e){s=v;break}s=i}if(n!==0){s=e;for(let i=0,o=t.length;i<o;i++){let a=t[i];this.m_shape.setPathUserIndex(a,this.m_pathParentageIndex,Mn),this.m_shape.movePath(this.m_geometry,this.m_shape.getNextPath(s),a),s=a}}t.length=0,e=this.m_shape.getNextPath(s)}else e=this.m_shape.getNextPath(e);this.m_shape.removePathUserIndex(this.m_pathOrientationIndex),this.m_shape.removePathUserIndex(this.m_pathParentageIndex),this.m_shape.removePathUserIndex(this.m_pathParentsIndex)}fixRingOrientationImplMp2sp_(){let t=this.m_shape.createPathUserIndex(),e=0,s=[];for(let n=this.m_shape.getFirstPath(this.m_geometry);n!==v;)if(this.progress_(),this.m_shape.getPathUserIndex(n,this.m_pathOrientationIndex)===3){this.m_shape.setExterior(n,!0),this.m_shape.setPathUserIndex(n,t,e),e++;for(let h=this.m_shape.getPathUserIndex(n,this.m_pathParentageIndex);h!==v;){let m=this.m_shape.getPathUserIndex(h,this.m_pathParentageIndex);s.push(h),this.m_shape.setExterior(h,!1),this.m_shape.setPathUserIndex(h,this.m_pathParentageIndex,n),h=m}let i=n,o=s.length,a=e;for(let h=this.m_shape.getNextPath(n);o>0&&h!==v;h=this.m_shape.getNextPath(h),--o){if(this.m_shape.getPathUserIndex(h,this.m_pathParentageIndex)!==n){i=v;break}i=h,this.m_shape.setPathUserIndex(h,t,-a),a++}if(o!==0){i=n,a=e;for(let h=0,m=s.length;h<m;h++){let l=s[h];this.m_shape.setPathUserIndex(l,t,-a),a++,this.m_shape.setPathUserIndex(l,this.m_pathParentageIndex,Mn)}i=n}e=a,s.length=0,n=this.m_shape.getNextPath(i)}else n=this.m_shape.getNextPath(n);return this.m_shape.removePathUserIndex(this.m_pathOrientationIndex),this.m_shape.removePathUserIndex(this.m_pathParentageIndex),this.m_shape.removePathUserIndex(this.m_pathParentsIndex),t}};function vn(r,t,e,s,n,i){let o=new hl(i);return o.m_shape=r,o.m_geometry=t,o.m_knownSimpleResult=e,o.m_bFixSelfTangency=s,o.m_polylineDegeneracies=n,o.m_bHasSegmentParentage=r.hasSegmentParentage(),o.m_bHasSegments=r.hasCurves(),o.simplify_()}var hl=class{constructor(t){this.m_shape=null,this.m_geometry=v,this.m_sortedVertices=new ln,this.m_bunchEdgeEndPoints=[],this.m_bunchEdgeCenterPoints=[],this.m_bunchEdgeIndices=[],this.m_knownSimpleResult=-1,this.m_sortedVerticesListIndex=-1,this.m_polylineDegeneracies=v,this.m_userIndexSortedIndexToVertex=-1,this.m_userIndexSortedAngleIndexToVertex=-1,this.m_nextVertexToProcess=-1,this.m_firstCoincidentVertex=-1,this.m_progressCounter=0,this.m_bFixSelfTangency=!1,this.m_bHasSegmentParentage=!1,this.m_bHasSegments=!1,this.m_progressTracker=t}compareAngles_(t,e){if(this.m_bHasSegments)return this.compareAnglesCurves_(t,e);let s=this.m_bunchEdgeEndPoints[t],n=new y;this.m_shape.queryXY(s,n);let i=new y,o=this.m_bunchEdgeEndPoints[e];if(this.m_shape.queryXY(o,i),n.equals(i))return 0;let a=this.m_bunchEdgeCenterPoints[t],h=new y;this.m_shape.queryXY(a,h);let m=this.m_bunchEdgeCenterPoints[e],l=new y;this.m_shape.queryXY(m,l);let u=new y;u.setSub(n,h);let c=new y;return c.setSub(i,l),(u.isZero()||c.isZero())&&Zr(""),y.compareVectors(u,c)}compareAnglesCurves_(t,e){let s=this.m_bunchEdgeEndPoints[t],n=this.m_bunchEdgeEndPoints[e],i=this.m_bunchEdgeCenterPoints[t],o=this.m_bunchEdgeCenterPoints[e],a=this.m_shape.getNextVertex(i)===s,h=this.m_shape.getNextVertex(o)===n,m=new et,l=new y;a?(this.m_shape.querySegment(i,m,!1,!0),l.assign(m.get().getTangent(0))):(this.m_shape.querySegment(s,m,!1,!0),l.assign(m.get().getTangent(1)),l.negateThis());let u=new y;return h?(this.m_shape.querySegment(o,m,!1,!0),u.assign(m.get().getTangent(0))):(this.m_shape.querySegment(n,m,!1,!0),u.assign(m.get().getTangent(1)),u.negateThis()),(l.isZero()||u.isZero())&&Zr(""),y.compareVectors(l,u)}beforeRemoveVertex_(t,e){let s=this.m_shape.getUserIndex(t,this.m_userIndexSortedIndexToVertex);if(this.m_nextVertexToProcess===s&&(this.m_nextVertexToProcess=this.m_sortedVertices.getNext(this.m_nextVertexToProcess)),this.m_firstCoincidentVertex===s&&(this.m_firstCoincidentVertex=this.m_sortedVertices.getNext(this.m_firstCoincidentVertex)),this.m_sortedVertices.deleteElement(this.m_sortedVerticesListIndex,s),this.removeAngleSortInfo_(t),e){let n=this.m_shape.getPathFromVertex(t);if(n!==v&&this.m_shape.getFirstVertex(n)===t){let i=this.m_shape.getNextVertex(t);if(i!==t){if(this.m_shape.getPathFromVertex(i)===n)return void this.m_shape.setFirstVertex(n,i);{let o=this.m_shape.getPrevVertex(t);if(o!==t&&this.m_shape.getPathFromVertex(o)===n)return void this.m_shape.setFirstVertex(n,o)}}this.m_shape.setFirstVertex(n,v),this.m_shape.setLastVertex(n,v)}}}processBunch_(){let t=!1,e=new y(0,0);for(;;){this.m_bunchEdgeEndPoints.length=0,this.m_bunchEdgeCenterPoints.length=0,this.m_bunchEdgeIndices.length=0;let s=this.m_firstCoincidentVertex,n=0,i=!0;for(;s!==this.m_nextVertexToProcess;){let a=this.m_sortedVertices.getData(s);i&&(this.m_shape.queryXY(a,e),i=!1);let h=this.m_shape.getPrevVertex(a),m=this.m_shape.getNextVertex(a);this.m_shape.getUserIndex(h,this.m_userIndexSortedAngleIndexToVertex)!==Mn&&(this.m_bunchEdgeEndPoints.push(h),this.m_shape.setUserIndex(h,this.m_userIndexSortedAngleIndexToVertex,Mn),this.m_bunchEdgeCenterPoints.push(a),this.m_bunchEdgeIndices.push(n++)),this.m_shape.getUserIndex(m,this.m_userIndexSortedAngleIndexToVertex)!==Mn&&(this.m_bunchEdgeEndPoints.push(m),this.m_shape.setUserIndex(m,this.m_userIndexSortedAngleIndexToVertex,Mn),this.m_bunchEdgeCenterPoints.push(a),this.m_bunchEdgeIndices.push(n++)),s=this.m_sortedVertices.getNext(s)}if(this.m_bunchEdgeEndPoints.length<2){this.m_bunchEdgeEndPoints.length===1&&this.m_shape.setUserIndex(this.m_bunchEdgeEndPoints[0],this.m_userIndexSortedAngleIndexToVertex,-1);break}this.m_bunchEdgeIndices.sort((a,h)=>this.compareAngles_(a,h));for(let a=0,h=this.m_bunchEdgeIndices.length;a<h;a++){let m=this.m_bunchEdgeIndices[a],l=this.m_bunchEdgeEndPoints[m];this.m_shape.setUserIndex(l,this.m_userIndexSortedAngleIndexToVertex,a)}let o=this.processCrossOvers_(e);for(let a=0,h=this.m_bunchEdgeIndices.length;a<h;a++){let m=this.m_bunchEdgeIndices[a];if(m===-1)continue;let l=this.m_bunchEdgeEndPoints[m];this.m_shape.setUserIndex(l,this.m_userIndexSortedAngleIndexToVertex,-1)}if(!o)break;t=!0}return t}processCrossOvers_(t){let e=!1,s=!0;for(;s;){s=!1;let n=0;this.m_bunchEdgeIndices[n]===-1&&(n=this.getNextEdgeIndex_(n));let i=this.getNextEdgeIndex_(n);for(let o=0,a=this.m_bunchEdgeIndices.length;o<a&&n!==-1&&i!==-1&&n!==i;o++){let h=this.m_bunchEdgeIndices[n],m=this.m_bunchEdgeIndices[i],l=this.m_bunchEdgeEndPoints[h],u=this.m_bunchEdgeEndPoints[m],c=this.m_shape.getNextVertex(l),g=!1;this.m_shape.isEqualXYPoint2D(c,t)||(c=this.m_shape.getPrevVertex(l),g=!0);let d=this.m_shape.getNextVertex(u),_=!1;this.m_shape.isEqualXYPoint2D(d,t)||(d=this.m_shape.getPrevVertex(u),_=!0);let p=g?this.m_shape.getPrevVertex(c):this.m_shape.getNextVertex(c),f=_?this.m_shape.getPrevVertex(d):this.m_shape.getNextVertex(d),x=!1;(this.removeSpike_(c)||this.removeSpike_(d)||this.removeSpike_(l)||this.removeSpike_(u)||this.removeSpike_(p)||this.removeSpike_(f))&&(x=!0),c!==d&&(!x&&this.m_shape.isEqualXY(l,u)&&(x=this.resolveOverlap_(g,_,c,l,d,u)),!x&&this.m_shape.isEqualXY(p,f)&&(x=this.resolveOverlap_(!g,!_,c,p,d,f)),!x&&this.m_shape.isEqualXY(l,f)&&(x=this.resolveOverlap_(g,!_,c,l,d,f)),!x&&this.m_shape.isEqualXY(p,u)&&(x=this.resolveOverlap_(!g,_,c,p,d,u))),x&&(e=!0),s||=x,n=x?this.getNextEdgeIndex_(n):i,i=this.getNextEdgeIndex_(n)}}if(!e){let n=0;this.m_bunchEdgeIndices[n]===-1&&(n=this.getNextEdgeIndex_(n));let i=this.getNextEdgeIndex_(n);for(let o=0,a=this.m_bunchEdgeIndices.length;o<a&&n!==-1&&i!==-1&&n!==i;o++){let h=this.m_bunchEdgeIndices[n],m=this.m_bunchEdgeIndices[i],l=this.m_bunchEdgeEndPoints[h],u=this.m_bunchEdgeEndPoints[m],c=this.m_shape.getNextVertex(l);this.m_shape.isEqualXYPoint2D(c,t)||(c=this.m_shape.getPrevVertex(l));let g=this.m_shape.getNextVertex(u);this.m_shape.isEqualXYPoint2D(g,t)||(g=this.m_shape.getPrevVertex(u));let d=this.getDirection_(c,l),_=this.getDirection_(g,u),p=d?this.m_shape.getPrevVertex(c):this.m_shape.getNextVertex(c),f=_?this.m_shape.getPrevVertex(g):this.m_shape.getNextVertex(g),x=this.detectAndResolveCrossOver_(d,_,l,c,p,u,g,f);x!==1?x===0?(n=this.getNextEdgeIndex_(n),i=this.getNextEdgeIndex_(n)):(n=this.getPrevEdgeIndex_(n),i=this.getNextEdgeIndex_(n)):e=!0}}return e}simplify_(){this.m_shape.getGeometryType(this.m_geometry)===N.enumPolygon&&this.m_shape.getFillRule(this.m_geometry)===1&&new Ye(this.m_progressTracker).planarSimplifyNoCrackingAndCluster(this.m_bFixSelfTangency,this.m_shape,this.m_geometry,0);let t=!1;this.m_userIndexSortedIndexToVertex=-1,this.m_userIndexSortedAngleIndexToVertex=-1,this.m_userIndexSortedAngleIndexToVertex=this.m_shape.createUserIndexUninitialized();let e=this.m_shape.getPointCount(this.m_geometry),s=new he(0);this.m_shape.dbgVerifyMonotone();for(let o=this.m_shape.getFirstPath(this.m_geometry);o!==v;o=this.m_shape.getNextPath(o)){let a=this.m_shape.getFirstVertex(o);for(let h=0,m=this.m_shape.getPathSize(o);h<m;h++)this.m_shape.setUserIndex(a,this.m_userIndexSortedAngleIndexToVertex,-1),s.add(a),a=this.m_shape.getNextVertex(a)}this.m_shape.sortVerticesSimpleByY(s,0,e),this.progress_(!0),this.m_userIndexSortedIndexToVertex=this.m_shape.createUserIndexUninitialized(),this.m_sortedVertices.reserveNodes(e),this.m_sortedVerticesListIndex=this.m_sortedVertices.createList(0);for(let o=0;o<e;o++){let a=s.read(o),h=this.m_sortedVertices.addElement(this.m_sortedVerticesListIndex,a);this.m_shape.setUserIndex(a,this.m_userIndexSortedIndexToVertex,h)}this.m_nextVertexToProcess=-1,this.cleanupSpikes_()&&(t=!0);let n=0,i=!1;do{i=!1,this.m_nextVertexToProcess=-1,this.m_firstCoincidentVertex=this.m_sortedVertices.getFirst(this.m_sortedVerticesListIndex);let o=new y(0,0);this.m_firstCoincidentVertex!==ln.st_nullNode()&&this.m_shape.queryXY(this.m_sortedVertices.getData(this.m_firstCoincidentVertex),o);let a=0,h=this.m_firstCoincidentVertex;for(;h!==ln.st_nullNode()&&(h=this.m_sortedVertices.getNext(h),h!==ln.st_nullNode());){this.progress_();let m=this.m_sortedVertices.getData(h),l=y.getNAN();if(this.m_shape.queryXY(m,l),o.equals(l))a++;else{if(a>0){this.m_nextVertexToProcess=h;let u=this.processBunch_();h=this.m_nextVertexToProcess,h!==ln.st_nullNode()&&this.m_shape.queryXY(this.m_sortedVertices.getData(h),l),u&&(i=!0)}o.setCoordsPoint2D(l),this.m_firstCoincidentVertex=h,a=0}}this.m_nextVertexToProcess=-1,a>0&&this.processBunch_()&&(i=!0),n++>10&&j(""),i&&this.fixOrphanVertices_(),this.cleanupSpikes_()&&(i=!0),t||=i}while(i);return this.m_shape.dbgVerifyMonotone(),this.m_shape.dbgVerifyCurves(),this.m_shape.removeUserIndex(this.m_userIndexSortedIndexToVertex),this.m_shape.removeUserIndex(this.m_userIndexSortedAngleIndexToVertex),t=N1(this.m_shape,this.m_geometry,this.m_sortedVertices,this.m_bFixSelfTangency,this.m_progressTracker)||t,this.m_shape.dbgVerifyCurves(),t}getDirection_(t,e){return this.m_shape.getNextVertex(e)!==t}detectAndResolveCrossOver_(t,e,s,n,i,o,a,h){if(n===a)return this.removeAngleSortInfo_(s),this.removeAngleSortInfo_(o),-1;let m=this.m_shape.getUserIndex(s,this.m_userIndexSortedAngleIndexToVertex),l=this.m_shape.getUserIndex(i,this.m_userIndexSortedAngleIndexToVertex),u=this.m_shape.getUserIndex(o,this.m_userIndexSortedAngleIndexToVertex),c=this.m_shape.getUserIndex(h,this.m_userIndexSortedAngleIndexToVertex),g=Z(8,Number.NaN),d=Z(4,Number.NaN);g[0]=0,d[0]=m,g[1]=0,d[1]=l,g[2]=1,d[2]=u,g[3]=1,d[3]=c;for(let p=1;p<4;p++){let f=d[p],x=g[p],C=p-1;for(;C>=0&&d[C]>f;)d[C+1]=d[C],g[C+1]=g[C],C--;d[C+1]=f,g[C+1]=x}let _=0;if(g[0]&&(_|=1),g[1]&&(_|=2),g[2]&&(_|=4),g[3]&&(_|=8),_!==5&&_!==10)return 0;if(t!==e&&(h=O(o,o=h)),t)this.m_shape.setNextVertex(h,n),this.m_shape.setPrevVertex(n,h),this.m_shape.setNextVertex(i,a),this.m_shape.setPrevVertex(a,i),this.m_bHasSegmentParentage&&(this.m_shape.setSegmentParentageBreakVertex(n,!0),this.m_shape.setSegmentParentageBreakVertex(a,!0));else{if(this.m_shape.setPrevVertex(h,n),this.m_shape.setNextVertex(n,h),this.m_shape.setPrevVertex(i,a),this.m_shape.setNextVertex(a,i),this.m_bHasSegmentParentage){let p=this.m_shape.getSegmentParentage(n),f=this.m_shape.getSegmentParentage(a);this.m_shape.setSegmentParentageAndBreak(n,f,!0),this.m_shape.setSegmentParentageAndBreak(a,p,!0)}if(this.m_bHasSegments){let p=this.m_shape.getVertexIndex(n),f=this.m_shape.getVertexIndex(a),x=this.m_shape.getSegmentFromIndex(p);this.m_shape.setSegmentToIndex(p,null);let C=this.m_shape.getSegmentFromIndex(f);this.m_shape.setSegmentToIndex(f,null),this.m_shape.setSegmentToIndex(p,C),this.m_shape.setSegmentToIndex(f,x)}}return 1}resolveOverlap_(t,e,s,n,i,o){return this.resolveOverlapOddEven_(t,e,s,n,i,o)}resolveOverlapOddEven_(t,e,s,n,i,o){if(t!==e){t||(i=O(s,s=i),o=O(n,n=o));let a=this.m_shape.getNextVertex(i),h=this.m_shape.getNextVertex(s);if(this.m_shape.setNextVertex(s,a),this.m_shape.setPrevVertex(a,s),this.m_shape.setNextVertex(i,h),this.m_shape.setPrevVertex(h,i),this.m_bHasSegments){let m=this.m_shape.getVertexIndex(s),l=this.m_shape.getVertexIndex(i),u=this.m_shape.getSegmentFromIndex(m);this.m_shape.setSegmentToIndex(m,null);let c=this.m_shape.getSegmentFromIndex(l);this.m_shape.setSegmentToIndex(l,null),this.m_shape.setSegmentToIndex(m,c),this.m_shape.setSegmentToIndex(l,u)}if(this.m_bHasSegmentParentage){let m=this.m_shape.getSegmentParentage(s),l=this.m_shape.getSegmentParentage(i);this.m_shape.setSegmentParentageAndBreak(s,l,!0),this.m_shape.setSegmentParentageAndBreak(i,m,!0),this.m_shape.setSegmentParentageBreakVertex(n,!0),this.m_shape.setSegmentParentageBreakVertex(o,!0)}this.removeSpike_(i)}else{let a=t?s:n,h=e?i:o,m=t?n:s,l=e?o:i,u=null;if(this.m_bHasSegments){let x=this.m_shape.getVertexIndex(l);u=this.m_shape.getSegmentFromIndex(x),this.m_shape.setSegmentToIndex(x,null);let C=this.m_shape.getVertexIndex(h);this.m_shape.setSegmentToIndex(C,null);let P=this.m_shape.getVertexIndex(a);this.m_shape.setSegmentToIndex(P,null)}let c=-1;this.m_bHasSegmentParentage&&(c=this.m_shape.getSegmentParentage(l));let g=!1;this.m_shape.setNextVertex(a,h),this.m_shape.setNextVertex(h,a),this.m_shape.setPrevVertex(m,l),this.m_shape.setPrevVertex(l,m);let d=l;for(;d!==h;){let x=this.m_shape.getPrevVertex(d),C=this.m_shape.getNextVertex(d);if(this.m_shape.setPrevVertex(d,C),this.m_shape.setNextVertex(d,x),g||=d===a,this.m_bHasSegments&&d!==a){let P=this.m_shape.getVertexIndex(C),E=u;u=this.m_shape.getSegmentFromIndex(P),E!==null&&E.reverse(),this.m_shape.setSegmentToIndex(P,E)}if(this.m_bHasSegmentParentage){let P=this.m_shape.getSegmentParentage(C);this.m_shape.setSegmentParentagePreserveBreak(C,c),c=P}d=C}let _=null;if(!g){let x=this.m_shape.getPrevVertex(h),C=this.m_shape.getNextVertex(h);if(this.m_shape.setPrevVertex(h,C),this.m_shape.setNextVertex(h,x),this.m_bHasSegments){let P=this.m_shape.getVertexIndex(h);_=this.m_shape.getSegmentFromIndex(P),this.m_shape.setSegmentToIndex(P,null)}}let p=-1,f=-1;if(this.m_bHasSegmentParentage&&(p=g?this.m_shape.getSegmentParentage(a):this.m_shape.getSegmentParentage(h),f=this.m_shape.getSegmentParentage(m)),this.transferVertexData_(h,a),this.beforeRemoveVertex_(h,!0),this.m_shape.removeVertexInternal(h,!0),this.removeAngleSortInfo_(a),this.transferVertexData_(l,m),this.beforeRemoveVertex_(l,!0),this.m_shape.removeVertexInternal(l,!0),this.removeAngleSortInfo_(m),this.m_bHasSegmentParentage&&(this.m_shape.setSegmentParentageAndBreak(a,p,!0),this.m_shape.setSegmentParentageAndBreak(m,f,!0)),_){let x=this.m_shape.getVertexIndex(a);this.m_shape.setSegmentToIndex(x,_)}}return!0}cleanupSpikes_(){let t=!1;for(let e=this.m_shape.getFirstPath(this.m_geometry);e!==v;){let s=this.m_shape.getNextPath(e),n=this.m_shape.getFirstVertex(e);for(let i=0,o=this.m_shape.getPathSize(e);i<o&&o>1;){this.progress_();let{v:a,bModified:h}=this.checkAndCleanupSpike_(e,n);if(a===v)break;h?(t=!0,n=a,i=0,o=this.m_shape.getPathSize(e)):(n=a,i++)}e=s}return t}checkAndCleanupSpike_(t,e){let s={v,bModified:!1},n=this.m_shape.getPrevVertex(e),i=this.m_shape.getNextVertex(e),o=v,a=v;for(;this.m_shape.isEqualXY(n,i)&&(o=n,a=i,i!==e);)n=this.m_shape.getPrevVertex(n),i=this.m_shape.getNextVertex(i);if(o===v)return s.v=i,s;s.bModified=!0;for(let h=this.m_shape.getNextVertex(o);this.beforeRemoveVertex_(h,!1),h!==a;h=this.m_shape.getNextVertex(h));if(o===e)return this.m_polylineDegeneracies!==v?this.m_shape.movePath(this.m_polylineDegeneracies,v,t):this.m_shape.removePath(t),s.v=v,s;{let h=this.m_shape.peelALoopIntoAPath(o,a);this.m_polylineDegeneracies!==v?this.m_shape.movePath(this.m_polylineDegeneracies,v,h):this.m_shape.removePath(h)}return s.v=o,s}removeSpike_(t){let e=this.m_shape.getPrevVertex(t),s=this.m_shape.getNextVertex(t),n=v,i=v;for(;this.m_shape.isEqualXY(e,s)&&(n=e,i=s,s!==t);)e=this.m_shape.getPrevVertex(e),s=this.m_shape.getNextVertex(s);if(n===v)return!1;if(this.m_shape.peelALoop(n,i),this.m_bHasSegmentParentage&&(this.m_shape.setSegmentParentageBreakVertex(n,!0),this.m_shape.setSegmentParentageBreakVertex(i,!0)),this.removeAngleSortInfo_(n),this.m_polylineDegeneracies===v)for(let o=this.m_shape.getNextVertex(i);;){let a=this.m_shape.getNextVertex(o);if(this.removeAngleSortInfo_(o),this.beforeRemoveVertex_(o,!0),this.m_shape.setSegmentToIndex(this.m_shape.getVertexIndex(o),null),this.m_shape.removeVertexInternal(o,!1),o===i)break;o=a}else{for(let a=i;;){let h=this.m_shape.getNextVertex(a);if(this.removeAngleSortInfo_(a),this.beforeRemoveVertex_(a,!1),a=h,a===i)break}let o=[!1];this.m_shape.insertClosedPath(this.m_polylineDegeneracies,v,i,i,o)}return!0}fixOrphanVertices_(){let t=0;for(let n=this.m_sortedVertices.getFirst(this.m_sortedVertices.getFirstList());n!==-1;n=this.m_sortedVertices.getNext(n)){let i=this.m_sortedVertices.getData(n);this.m_shape.setPathToVertex(i,v)}let e=0;for(let n=this.m_shape.getFirstPath(this.m_geometry);n!==v;){let i=this.m_shape.getFirstVertex(n);if(i===v||this.m_shape.getPathFromVertex(i)!==v){let a=n;n=this.m_shape.getNextPath(n),this.m_shape.removePathOnly(a);continue}this.m_shape.setPathToVertex(i,n);let o=1;for(let a=this.m_shape.getNextVertex(i);a!==i;a=this.m_shape.getNextVertex(a))this.m_shape.setPathToVertex(a,n),o++;this.m_shape.setRingAreaValid(n,!1),this.m_shape.setPathSize(n,o),this.m_shape.setLastVertex(n,this.m_shape.getPrevVertex(i)),e+=o,t++,n=this.m_shape.getNextPath(n)}for(let n=this.m_sortedVertices.getFirst(this.m_sortedVertices.getFirstList());n!==-1;n=this.m_sortedVertices.getNext(n)){let i=this.m_sortedVertices.getData(n);if(this.m_shape.getPathFromVertex(i)!==v)continue;let o=[!1],a=this.m_shape.insertClosedPath(this.m_geometry,v,i,i,o);e+=this.m_shape.getPathSize(a),t++}this.m_shape.setGeometryPathCount(this.m_geometry,t),this.m_shape.setGeometryVertexCount(this.m_geometry,e);let s=0;for(let n=this.m_shape.getFirstGeometry();n!==v;n=this.m_shape.getNextGeometry(n))s+=this.m_shape.getPointCount(n);this.m_shape.setTotalPointCount(s)}getNextEdgeIndex_(t){if(t===-1)return-1;for(let e=0,s=this.m_bunchEdgeIndices.length-1;e<s;e++)if(t=(t+1)%this.m_bunchEdgeIndices.length,this.m_bunchEdgeIndices[t]!==-1)return t;return-1}getPrevEdgeIndex_(t){if(t===-1)return-1;for(let e=0,s=this.m_bunchEdgeIndices.length-1;e<s;e++)if(t=(this.m_bunchEdgeIndices.length+t-1)%this.m_bunchEdgeIndices.length,this.m_bunchEdgeIndices[t]!==-1)return t;return-1}transferVertexData_(t,e){let s=this.m_shape.getUserIndex(e,this.m_userIndexSortedIndexToVertex),n=this.m_shape.getUserIndex(e,this.m_userIndexSortedAngleIndexToVertex);this.m_shape.transferAllDataToTheVertex(t,e),this.m_shape.setUserIndex(e,this.m_userIndexSortedIndexToVertex,s),this.m_shape.setUserIndex(e,this.m_userIndexSortedAngleIndexToVertex,n)}removeAngleSortInfo_(t){let e=this.m_shape.getUserIndex(t,this.m_userIndexSortedAngleIndexToVertex);e!==-1&&(this.m_bunchEdgeIndices[e]=-1,this.m_shape.setUserIndex(t,this.m_userIndexSortedAngleIndexToVertex,-1))}progress_(t=!1){}};function vs(r,t,e,s,n,i=!0){switch(F1(s)){case 0:break;case 1:U("relation string length has to be 9 characters");break;default:U("relation string")}if(i){let c=R1(s,r.getDimension(),t.getDimension());if(c!==0)return Sn(r,t,e,c,n)}let o=0;if(typeof e=="number")o=e;else{let c=V.constructEmpty();r.queryEnvelope(c);let g=V.constructEmpty();t.queryEnvelope(g);let d=V.constructEmpty();d.setCoords({env2D:c}),d.mergeEnvelope2D(g),o=un(e,d,!1)}let a=sd(r,o),h=sd(t,o);if(a.isEmpty()||h.isEmpty())return k1(a,h,s);let m=a.getGeometryType(),l=h.getGeometryType(),u=!1;switch(m){case N.enumPolygon:switch(l){case N.enumPolygon:u=V1(a,h,o,s,n);break;case N.enumPolyline:u=Qg(a,h,o,s,n);break;case N.enumPoint:u=Jg(a,h,o,s);break;case N.enumMultiPoint:u=Kg(a,h,o,s,n)}break;case N.enumPolyline:switch(l){case N.enumPolygon:u=Qg(h,a,o,yi(s),n);break;case N.enumPolyline:u=q1(a,h,o,s,n);break;case N.enumPoint:u=td(a,h,o,s,n);break;case N.enumMultiPoint:u=$g(a,h,o,s,n)}break;case N.enumPoint:switch(l){case N.enumPolygon:u=Jg(h,a,o,yi(s));break;case N.enumPolyline:u=td(h,a,o,yi(s),n);break;case N.enumPoint:u=X1(a,h,o,s);break;case N.enumMultiPoint:u=ed(h,a,o,yi(s))}break;case N.enumMultiPoint:switch(l){case N.enumPolygon:u=Kg(h,a,o,yi(s),n);break;case N.enumPolyline:u=$g(h,a,o,yi(s),n);break;case N.enumMultiPoint:u=Y1(a,h,o,s,n);break;case N.enumPoint:u=ed(a,h,o,s)}break;default:u=!1}return u}function M1(r,t,e,s){let n=new cs;n.resetMatrix_(),n.setPredicates_("T*****F**"),n.setAreaAreaPredicates_();let i=V.constructEmpty(),o=V.constructEmpty();r.queryEnvelope(i),t.queryEnvelope(o);let a=!1;if(js(i,o,e)&&(n.areaAreaDisjointPredicates_(r,t),a=!0),a||Ct(r,t),a)return we(n.m_matrix,n.m_scl);let h=new Nt,m=h.addGeometry(r),l=h.addGeometry(t),u=null,c=0;if(r.hasNonLinearSegments()||t.hasNonLinearSegments()){u=new Be;let p=us(e,h.getEnvelope2D(s));c=Os(p,0),Ss(h,p,e,12e3,u,null,s)}Us(h,new Ps(e,0).add(c),s,!1,!1);let g=h.getGeometry(l).getBoundary();if(h.filterClosePoints(0,!0,!0,!1,v),vn(h,m,-1,!1,v,s),h.getPointCount(m)===0)return!1;vn(h,l,-1,!1,v,s),n.setEditShape_(h,s);let d=h.getPointCount(l)===0;if(!d){n.computeMatrixTopoGraphHalfEdges_(m,l),n.m_topoGraph.removeShape();let p=we(n.m_matrix,n.m_scl);if(!p)return p}let _=h.getGeometry(m);return h=new Nt,m=h.addGeometry(_),l=h.addGeometry(g),n.setEditShape_(h,s),n.m_predicateCount=0,n.resetMatrix_(),n.setPredicates_(d?"T*****F**":"******F**"),n.setAreaLinePredicates_(),n.computeMatrixTopoGraphHalfEdges_(m,l),n.m_topoGraph.removeShape(),we(n.m_matrix,n.m_scl)}function G1(r,t,e,s){let n=new cs;n.resetMatrix_(),n.setPredicates_("T*****F**"),n.setAreaLinePredicates_();let i=V.constructEmpty(),o=V.constructEmpty();r.queryEnvelope(i),t.queryEnvelope(o);let a=!1;if(js(i,o,e)&&(n.areaLineDisjointPredicates_(r,t),a=!0),a||Ct(r,t),a)return we(n.m_matrix,n.m_scl);let h=new Nt,m=h.addGeometry(r),l=h.addGeometry(t);return n.setEditShapeCrackAndCluster_(h,new Ps(e,0),s),h.getPointCount(m)===0?!1:(n.computeMatrixTopoGraphHalfEdges_(m,l),n.m_topoGraph.removeShape(),we(n.m_matrix,n.m_scl))}function F1(r){if(r.length!==9)return 1;for(let t=0;t<9;t++){let e=r[t];if(e!=="*"&&e!=="T"&&e!=="F"&&e!=="0"&&e!=="1"&&e!=="2")return 2}return 0}function V1(r,t,e,s,n){let i=new cs;i.resetMatrix_(),i.setPredicates_(s),i.setAreaAreaPredicates_();let o=V.constructEmpty(),a=V.constructEmpty();r.queryEnvelope(o),t.queryEnvelope(a);let h=!1;if(js(o,a,e)&&(i.areaAreaDisjointPredicates_(r,t),h=!0),h||Ct(r,t),!h){let m=new Nt,l=m.addGeometry(r),u=m.addGeometry(t);i.setEditShapeCrackAndCluster_(m,new Ps(e,0),n),i.computeMatrixTopoGraphHalfEdges_(l,u),i.m_topoGraph.removeShape()}return we(i.m_matrix,i.m_scl)}function Qg(r,t,e,s,n){let i=new cs;i.resetMatrix_(),i.setPredicates_(s),i.setAreaLinePredicates_();let o=V.constructEmpty(),a=V.constructEmpty();r.queryEnvelope(o),t.queryEnvelope(a);let h=!1;if(js(o,a,e)&&(i.areaLineDisjointPredicates_(r,t),h=!0),h||Ct(r,t),!h){let m=new Nt,l=m.addGeometry(r),u=m.addGeometry(t);i.setEditShapeCrackAndCluster_(m,new Ps(e,0),n),i.m_clusterIndexB=i.m_topoGraph.createUserIndexForClusters(),_a(u,i.m_topoGraph,i.m_clusterIndexB),i.computeMatrixTopoGraphHalfEdges_(l,u),i.m_topoGraph.deleteUserIndexForClusters(i.m_clusterIndexB),i.m_topoGraph.removeShape()}return we(i.m_matrix,i.m_scl)}function Kg(r,t,e,s,n){let i=new cs;i.resetMatrix_(),i.setPredicates_(s),i.setAreaPointPredicates_();let o=V.constructEmpty(),a=V.constructEmpty();r.queryEnvelope(o),t.queryEnvelope(a);let h=!1;if(js(o,a,e)&&(i.areaPointDisjointPredicates_(r),h=!0),h||Ct(r,t),!h){let m=new Nt,l=m.addGeometry(r),u=m.addGeometry(t);i.setEditShapeCrackAndCluster_(m,new Ps(e,0),n),i.computeMatrixTopoGraphClusters_(l,u),i.m_topoGraph.removeShape()}return we(i.m_matrix,i.m_scl)}function q1(r,t,e,s,n){let i=new cs;i.resetMatrix_(),i.setPredicates_(s),i.setLineLinePredicates_();let o=V.constructEmpty(),a=V.constructEmpty();r.queryEnvelope(o),t.queryEnvelope(a);let h=!1;if(js(o,a,e)&&(i.lineLineDisjointPredicates_(r,t),h=!0),h||Ct(r,t),!h){let m=new Nt,l=m.addGeometry(r),u=m.addGeometry(t);i.setEditShapeCrackAndCluster_(m,new Ps(e,0),n),i.m_clusterIndexA=i.m_topoGraph.createUserIndexForClusters(),i.m_clusterIndexB=i.m_topoGraph.createUserIndexForClusters(),_a(l,i.m_topoGraph,i.m_clusterIndexA),_a(u,i.m_topoGraph,i.m_clusterIndexB),i.computeMatrixTopoGraphHalfEdges_(l,u),i.m_topoGraph.deleteUserIndexForClusters(i.m_clusterIndexA),i.m_topoGraph.deleteUserIndexForClusters(i.m_clusterIndexB),i.m_topoGraph.removeShape()}return we(i.m_matrix,i.m_scl)}function $g(r,t,e,s,n){let i=new cs;i.resetMatrix_(),i.setPredicates_(s),i.setLinePointPredicates_();let o=V.constructEmpty(),a=V.constructEmpty();r.queryEnvelope(o),t.queryEnvelope(a);let h=!1;if(js(o,a,e)&&(i.linePointDisjointPredicates_(r),h=!0),h||Ct(r,t),!h){let m=new Nt,l=m.addGeometry(r),u=m.addGeometry(t);i.setEditShapeCrackAndCluster_(m,new Ps(e,0),n),i.m_clusterIndexA=i.m_topoGraph.createUserIndexForClusters(),_a(l,i.m_topoGraph,i.m_clusterIndexA),i.computeMatrixTopoGraphClusters_(l,u),i.m_topoGraph.deleteUserIndexForClusters(i.m_clusterIndexA),i.m_topoGraph.removeShape()}return we(i.m_matrix,i.m_scl)}function Y1(r,t,e,s,n){let i=new cs;i.resetMatrix_(),i.setPredicates_(s),i.setPointPointPredicates_();let o=new V,a=new V;r.queryEnvelope(o),t.queryEnvelope(a);let h=!1;if(js(o,a,e)&&(i.pointPointDisjointPredicates_(),h=!0),!h){let m=new Nt,l=m.addGeometry(r),u=m.addGeometry(t);i.setEditShapeCrackAndCluster_(m,new Ps(e,0),n),i.computeMatrixTopoGraphClusters_(l,u),i.m_topoGraph.removeShape()}return we(i.m_matrix,i.m_scl)}function Jg(r,t,e,s,n){let i=new cs;i.resetMatrix_(),i.setPredicates_(s),i.setAreaPointPredicates_();let o=V.constructEmpty();r.queryEnvelope(o);let a=t.getXY(),h=!1;if(Ta(a,o,e)&&(i.areaPointDisjointPredicates_(r),h=!0),!h){let m=Ue(r,a,e);if(m===1)i.m_matrix[0]=0,i.m_matrix[2]=2,i.m_matrix[3]=-1,i.m_matrix[5]=1,i.m_matrix[6]=-1;else if(m===2)if(i.m_matrix[6]=-1,r.calculateArea2D()!==0)i.m_matrix[0]=-1,i.m_matrix[3]=0,i.m_matrix[2]=2,i.m_matrix[5]=1;else{i.m_matrix[0]=0,i.m_matrix[3]=-1,i.m_matrix[5]=-1;let l=V.constructEmpty();r.queryEnvelope(l),i.m_matrix[2]=l.height()||l.width()?1:-1}else i.areaPointDisjointPredicates_(r)}return we(i.m_matrix,s)}function td(r,t,e,s,n){let i=new cs;i.resetMatrix_(),i.setPredicates_(s),i.setLinePointPredicates_();let o=V.constructEmpty();r.queryEnvelope(o);let a=!1;if(Ta(t.getXY(),o,e)&&(i.linePointDisjointPredicates_(r),a=!0),!a){let h=null,m=!1,l=!1;if((i.m_performPredicates[0]||i.m_performPredicates[6])&&(Sn(r,t,e,4,n)?(i.m_matrix[0]=-1,i.m_matrix[6]=0):(i.m_performPredicates[0]&&(h=Es(r),l=!Sn(h,t,e,4,n),m=!0,i.m_matrix[0]=l?-1:0),i.m_matrix[6]=-1)),i.m_performPredicates[3]&&(h!==null&&h.isEmpty()?i.m_matrix[3]=-1:(m||(h==null&&(h=Es(r)),l=!Sn(h,t,e,4,n),m=!0),i.m_matrix[3]=l?0:-1)),i.m_performPredicates[5])if(h!==null&&h.isEmpty())i.m_matrix[5]=-1;else if(m&&!l)i.m_matrix[5]=0;else{h===null&&(h=Es(r));let u=Sn(h,t,e,3,n);i.m_matrix[5]=u?-1:0}if(i.m_performPredicates[2])if(r.calculateLength2D()!==0)i.m_matrix[2]=1;else{let u=new Lt({vd:r.getDescription()});u.addPoints(r,0,r.getPointCount());let c=Sn(u,t,e,3,n);i.m_matrix[2]=c?-1:0}}return we(i.m_matrix,i.m_scl)}function ed(r,t,e,s,n){let i=new cs;i.resetMatrix_(),i.setPredicates_(s),i.setPointPointPredicates_();let o=V.constructEmpty();r.queryEnvelope(o);let a=t.getXY(),h=new y,m=!1;if(Ta(a,o,e)&&(i.pointPointDisjointPredicates_(),m=!0),!m){let l=!1,u=!0,c=e*e;for(let g=0;g<r.getPointCount()&&(r.queryXY(g,h),y.sqrDistance(h,a)<=c?l=!0:u=!1,!l||u);g++);l?(i.m_matrix[0]=0,i.m_matrix[2]=u?-1:0,i.m_matrix[6]=-1):(i.m_matrix[0]=-1,i.m_matrix[2]=0,i.m_matrix[6]=0)}return we(i.m_matrix,s)}function X1(r,t,e,s,n){let i=r.getXY(),o=t.getXY(),a=Z(9,-1);return y.sqrDistance(i,o)<=e*e?a[0]=0:(a[2]=0,a[6]=0),a[8]=2,we(a,s)}function we(r,t){for(let e=0;e<9;e++)switch(t[e]){case"T":if(r[e]===-1)return!1;break;case"F":if(r[e]!==-1)return!1;break;case"0":if(r[e]!==0)return!1;break;case"1":if(r[e]!==1)return!1;break;case"2":if(r[e]!==2)return!1}return!0}function k1(r,t,e){let s=Z(9,-1);if(r.isEmpty()&&t.isEmpty())return we(s,e);let n,i=!1;r.isEmpty()?(n=t,i=!0):n=r,s[0]=-1,s[1]=-1,s[3]=-1,s[4]=-1,s[6]=-1,s[7]=-1,s[8]=2;let o=n.getGeometryType();if(at(o))if(o===N.enumPolygon)if(n.calculateArea2D()!==0)s[2]=2,s[5]=1;else{s[5]=-1;let a=V.constructEmpty();n.queryEnvelope(a),s[2]=a.height()||a.width()?1:0}else{let a=n.calculateLength2D()!==0;s[2]=a?1:0,s[5]=yn(n)?0:-1}else s[2]=0,s[5]=-1;return i&&s_(s),we(s,e)}function R1(r,t,e){return H1(r)?3:L1(r)?4:B1(r,t,e)?8:U1(r,t,e)?16:O1(r)?64:z1(r)?1:W1(r,t,e)?32:0}function H1(r){return r==="T*F**FFF*"}function L1(r){return r==="FF*FF****"}function B1(r,t,e){return(t!==0||e!==0)&&(t===2&&e===2?r==="F***T****":(t===2||t===1)&&e===0&&r==="F**T*****")}function U1(r,t,e){return t>e?r==="T*****T**":t===1&&e===1&&r==="0********"}function z1(r){return r==="T*****FF*"}function O1(r){return r==="T**FF*FF*"}function W1(r,t,e){return t===e&&(t!==1?r==="T*T***T**":r==="1*T***T**")}function _a(r,t,e){let s=t.getGeometryID(r);for(let n=t.getFirstCluster();n!==v;n=t.getNextCluster(n)){if(!(t.getClusterParentage(n)&s))continue;let i=t.getClusterHalfEdge(n);if(i===v){t.setClusterUserIndex(n,e,0);continue}let o=i,a=0;do{let h=o;t.getHalfEdgeParentage(h)&s&&a++,o=t.getHalfEdgeNext(t.getHalfEdgeTwin(h))}while(o!==i);t.setClusterUserIndex(n,e,a)}}var cs=class{nullFunc(){return j("should not be called"),!1}constructor(){this.m_clusterIndexA=-1,this.m_clusterIndexB=-1,this.m_visitedIndex=-1,this.m_topoGraph=new As,this.m_matrix=Z(9,0),this.m_maxDim=Z(9,0),this.m_performPredicates=Z(9,!1),this.m_scl="",this.m_predicateCount=0,this.m_predicatesHalfEdge=this.nullFunc,this.m_predicatesCluster=this.nullFunc}resetMatrix_(){this.m_matrix.fill(-2),this.m_maxDim.fill(-2)}setPredicates_(t){this.m_scl=t;for(let e=0;e<9;e++)this.m_scl[e]!=="*"?(this.m_performPredicates[e]=!0,this.m_predicateCount++):this.m_performPredicates[e]=!1}setRemainingPredicatesToFalse_(){for(let t=0;t<9;t++)this.m_performPredicates[t]&&this.m_matrix[t]===-2&&(this.m_matrix[t]=-1,this.m_performPredicates[t]=!1)}isPredicateKnown_(t){return this.m_matrix[t]!==-2&&(this.m_matrix[t]===-1?(this.m_performPredicates[t]=!1,this.m_predicateCount--,!0):this.m_scl[t]!=="T"&&this.m_scl[t]!=="F"?!(this.m_matrix[t]<this.m_maxDim[t])&&(this.m_performPredicates[t]=!1,this.m_predicateCount--,!0):(this.m_performPredicates[t]=!1,this.m_predicateCount--,!0))}setAreaAreaPredicates_(){this.m_predicatesHalfEdge=this.areaAreaPredicates_,this.m_maxDim[0]=2,this.m_maxDim[1]=1,this.m_maxDim[2]=2,this.m_maxDim[3]=1,this.m_maxDim[4]=1,this.m_maxDim[5]=1,this.m_maxDim[6]=2,this.m_maxDim[7]=1,this.m_maxDim[8]=2,this.m_performPredicates[8]&&(this.m_matrix[8]=2,this.m_performPredicates[8]=!1,this.m_predicateCount--)}setAreaLinePredicates_(){this.m_predicatesHalfEdge=this.areaLinePredicates_,this.m_predicatesCluster=this.areaPointPredicates_,this.m_maxDim[0]=1,this.m_maxDim[1]=0,this.m_maxDim[2]=2,this.m_maxDim[3]=1,this.m_maxDim[4]=0,this.m_maxDim[5]=1,this.m_maxDim[6]=1,this.m_maxDim[7]=0,this.m_maxDim[8]=2,this.m_performPredicates[8]&&(this.m_matrix[8]=2,this.m_performPredicates[8]=!1,this.m_predicateCount--)}setLineLinePredicates_(){this.m_predicatesHalfEdge=this.lineLinePredicates_,this.m_predicatesCluster=this.linePointPredicates_,this.m_maxDim[0]=1,this.m_maxDim[1]=0,this.m_maxDim[2]=1,this.m_maxDim[3]=0,this.m_maxDim[4]=0,this.m_maxDim[5]=0,this.m_maxDim[6]=1,this.m_maxDim[7]=0,this.m_maxDim[8]=2,this.m_performPredicates[8]&&(this.m_matrix[8]=2,this.m_performPredicates[8]=!1,this.m_predicateCount--)}setAreaPointPredicates_(){this.m_predicatesCluster=this.areaPointPredicates_,this.m_maxDim[0]=0,this.m_maxDim[1]=-1,this.m_maxDim[2]=2,this.m_maxDim[3]=0,this.m_maxDim[4]=-1,this.m_maxDim[5]=1,this.m_maxDim[6]=0,this.m_maxDim[7]=-1,this.m_maxDim[8]=2,this.m_performPredicates[1]&&(this.m_matrix[1]=-1,this.m_performPredicates[1]=!1,this.m_predicateCount--),this.m_performPredicates[4]&&(this.m_matrix[4]=-1,this.m_performPredicates[4]=!1,this.m_predicateCount--),this.m_performPredicates[7]&&(this.m_matrix[7]=-1,this.m_performPredicates[7]=!1,this.m_predicateCount--),this.m_performPredicates[8]&&(this.m_matrix[8]=2,this.m_performPredicates[8]=!1,this.m_predicateCount--)}setLinePointPredicates_(){this.m_predicatesCluster=this.linePointPredicates_,this.m_maxDim[0]=0,this.m_maxDim[1]=-1,this.m_maxDim[2]=1,this.m_maxDim[3]=0,this.m_maxDim[4]=-1,this.m_maxDim[5]=0,this.m_maxDim[6]=0,this.m_maxDim[7]=-1,this.m_maxDim[8]=2,this.m_performPredicates[1]&&(this.m_matrix[1]=-1,this.m_performPredicates[1]=!1,this.m_predicateCount--),this.m_performPredicates[4]&&(this.m_matrix[4]=-1,this.m_performPredicates[4]=!1,this.m_predicateCount--),this.m_performPredicates[7]&&(this.m_matrix[7]=-1,this.m_performPredicates[7]=!1,this.m_predicateCount--),this.m_performPredicates[8]&&(this.m_matrix[8]=2,this.m_performPredicates[8]=!1,this.m_predicateCount--)}setPointPointPredicates_(){this.m_predicatesCluster=this.pointPointPredicates_,this.m_maxDim[0]=0,this.m_maxDim[1]=-1,this.m_maxDim[2]=0,this.m_maxDim[3]=-1,this.m_maxDim[4]=-1,this.m_maxDim[5]=-1,this.m_maxDim[6]=0,this.m_maxDim[7]=-1,this.m_maxDim[8]=2,this.m_performPredicates[1]&&(this.m_matrix[1]=-1,this.m_performPredicates[1]=!1,this.m_predicateCount--),this.m_performPredicates[3]&&(this.m_matrix[3]=-1,this.m_performPredicates[3]=!1,this.m_predicateCount--),this.m_performPredicates[4]&&(this.m_matrix[4]=-1,this.m_performPredicates[4]=!1,this.m_predicateCount--),this.m_performPredicates[5]&&(this.m_matrix[5]=-1,this.m_performPredicates[5]=!1,this.m_predicateCount--),this.m_performPredicates[7]&&(this.m_matrix[7]=-1,this.m_performPredicates[7]=!1,this.m_predicateCount--),this.m_performPredicates[8]&&(this.m_matrix[8]=2,this.m_performPredicates[8]=!1,this.m_predicateCount--)}areaAreaDisjointPredicates_(t,e){this.m_matrix[0]=-1,this.m_matrix[1]=-1,this.m_matrix[3]=-1,this.m_matrix[4]=-1,this.areaGeomContainsOrDisjointPredicates_(t,this.m_performPredicates[2]?2:-1,this.m_scl[2],this.m_performPredicates[5]?5:-1,this.m_scl[5]),this.areaGeomContainsOrDisjointPredicates_(e,this.m_performPredicates[6]?6:-1,this.m_scl[6],this.m_performPredicates[7]?7:-1,this.m_scl[7])}areaGeomContainsOrDisjointPredicates_(t,e,s,n,i){let o=e!==-1,a=n!==-1;if(o||a){if(!(s!=="T"&&s!=="F"&&o||i!=="T"&&i!=="F"&&a)||t.calculateArea2D()!==0)o&&(this.m_matrix[e]=2),a&&(this.m_matrix[n]=1);else if(a&&(this.m_matrix[n]=-1),o){let h=V.constructEmpty();t.queryEnvelope(h),this.m_matrix[e]=h.height()||h.width()?1:0}}}areaAreaContainsPredicates_(t){this.m_matrix[2]=2,this.m_matrix[3]=-1,this.m_matrix[4]=-1,this.m_matrix[5]=1,this.m_matrix[6]=-1,this.m_matrix[7]=-1,this.areaGeomContainsOrDisjointPredicates_(t,this.m_performPredicates[0]?0:-1,this.m_scl[0],this.m_performPredicates[1]?1:-1,this.m_scl[1])}areaAreaWithinPredicates_(t){this.areaAreaContainsPredicates_(t),s_(this.m_matrix)}areaLineDisjointPredicates_(t,e){if(this.m_matrix[0]=-1,this.m_matrix[1]=-1,this.m_matrix[3]=-1,this.m_matrix[4]=-1,this.m_performPredicates[6]){let s=this.m_scl[6],n=s==="T"||s==="F"||e.calculateLength2D()!==0;this.m_matrix[6]=n?1:0}if(this.m_performPredicates[7]){let s=yn(e);this.m_matrix[7]=s?0:-1}this.areaGeomContainsOrDisjointPredicates_(t,this.m_performPredicates[2]?2:-1,this.m_scl[2],this.m_performPredicates[5]?5:-1,this.m_scl[5])}areaLineContainsPredicates_(t,e){if(this.m_performPredicates[0]){let s=this.m_scl[0],n=s==="T"||s==="F"||e.calculateLength2D()!==0;this.m_matrix[0]=n?1:0}if(this.m_performPredicates[1]){let s=yn(e);this.m_matrix[1]=s?0:-1}this.m_matrix[2]=2,this.m_matrix[3]=-1,this.m_matrix[4]=-1,this.m_matrix[5]=1,this.m_matrix[6]=-1,this.m_matrix[7]=-1}areaPointDisjointPredicates_(t){this.m_matrix[0]=-1,this.m_matrix[3]=-1,this.m_matrix[6]=0,this.areaGeomContainsOrDisjointPredicates_(t,this.m_performPredicates[2]?2:-1,this.m_scl[2],this.m_performPredicates[5]?5:-1,this.m_scl[5])}areaPointContainsPredicates_(t){this.m_matrix[0]=0,this.m_matrix[2]=2,this.m_matrix[3]=-1,this.m_matrix[5]=1,this.m_matrix[6]=-1}lineLineDisjointPredicates_(t,e){if(this.m_matrix[0]=-1,this.m_matrix[1]=-1,this.m_matrix[3]=-1,this.m_matrix[4]=-1,this.m_performPredicates[2]){let s=this.m_scl[2],n=s==="T"||s==="F"||t.calculateLength2D()!==0;this.m_matrix[2]=n?1:0}if(this.m_performPredicates[5]){let s=yn(t);this.m_matrix[5]=s?0:-1}if(this.m_performPredicates[6]){let s=this.m_scl[6],n=s==="T"||s==="F"||e.calculateLength2D()!==0;this.m_matrix[6]=n?1:0}if(this.m_performPredicates[7]){let s=yn(e);this.m_matrix[7]=s?0:-1}}linePointDisjointPredicates_(t){if(this.m_matrix[0]=-1,this.m_matrix[3]=-1,this.m_performPredicates[2]){let e=this.m_scl[2],s=e==="T"||e==="F"||t.calculateLength2D()!==0;this.m_matrix[2]=s?1:0}if(this.m_performPredicates[5]){let e=yn(t);this.m_matrix[5]=e?0:-1}this.m_matrix[6]=0}pointPointDisjointPredicates_(){this.m_matrix[0]=-1,this.m_matrix[2]=0,this.m_matrix[6]=0}areaAreaPredicates_(t,e,s){let n=!0;if(this.m_performPredicates[0]){this.interiorAreaInteriorArea_(t,e,s);let i=this.isPredicateKnown_(0);n&&=i}if(this.m_performPredicates[1]){this.interiorAreaBoundaryArea_(t,e,1);let i=this.isPredicateKnown_(1);n&&=i}if(this.m_performPredicates[2]){this.interiorAreaExteriorArea_(t,e,s,2);let i=this.isPredicateKnown_(2);n&&=i}if(this.m_performPredicates[3]){this.interiorAreaBoundaryArea_(t,s,3);let i=this.isPredicateKnown_(3);n&&=i}if(this.m_performPredicates[4]){this.boundaryAreaBoundaryArea_(t,e,s);let i=this.isPredicateKnown_(4);n&&=i}if(this.m_performPredicates[5]){this.boundaryAreaExteriorArea_(t,e,s,5);let i=this.isPredicateKnown_(5);n&&=i}if(this.m_performPredicates[6]){this.interiorAreaExteriorArea_(t,s,e,6);let i=this.isPredicateKnown_(6);n&&=i}if(this.m_performPredicates[7]){this.boundaryAreaExteriorArea_(t,s,e,7);let i=this.isPredicateKnown_(7);n&&=i}return n}areaLinePredicates_(t,e,s){let n=!0;if(this.m_performPredicates[0]){this.interiorAreaInteriorLine_(t,e,s);let i=this.isPredicateKnown_(0);n&&=i}if(this.m_performPredicates[1]){this.interiorAreaBoundaryLine_(t,e,s,this.m_clusterIndexB);let i=this.isPredicateKnown_(1);n&&=i}if(this.m_performPredicates[2]){this.interiorAreaExteriorLine_(t,e,s);let i=this.isPredicateKnown_(2);n&&=i}if(this.m_performPredicates[3]){this.boundaryAreaInteriorLine_(t,e,s,this.m_clusterIndexB);let i=this.isPredicateKnown_(3);n&&=i}if(this.m_performPredicates[4]){this.boundaryAreaBoundaryLine_(t,e,s,this.m_clusterIndexB);let i=this.isPredicateKnown_(4);n&&=i}if(this.m_performPredicates[5]){this.boundaryAreaExteriorLine_(t,e,s);let i=this.isPredicateKnown_(5);n&&=i}if(this.m_performPredicates[6]){this.exteriorAreaInteriorLine_(t,e);let i=this.isPredicateKnown_(6);n&&=i}if(this.m_performPredicates[7]){this.exteriorAreaBoundaryLine_(t,e,s,this.m_clusterIndexB);let i=this.isPredicateKnown_(7);n&&=i}return n}lineLinePredicates_(t,e,s){let n=!0;if(this.m_performPredicates[0]){this.interiorLineInteriorLine_(t,e,s,this.m_clusterIndexA,this.m_clusterIndexB);let i=this.isPredicateKnown_(0);n&&=i}if(this.m_performPredicates[1]){this.interiorLineBoundaryLine_(t,e,s,this.m_clusterIndexA,this.m_clusterIndexB,1);let i=this.isPredicateKnown_(1);n&&=i}if(this.m_performPredicates[2]){this.interiorLineExteriorLine_(t,e,s,2);let i=this.isPredicateKnown_(2);n&&=i}if(this.m_performPredicates[3]){this.interiorLineBoundaryLine_(t,s,e,this.m_clusterIndexB,this.m_clusterIndexA,3);let i=this.isPredicateKnown_(3);n&&=i}if(this.m_performPredicates[4]){this.boundaryLineBoundaryLine_(t,e,s,this.m_clusterIndexA,this.m_clusterIndexB);let i=this.isPredicateKnown_(4);n&&=i}if(this.m_performPredicates[5]){this.boundaryLineExteriorLine_(t,e,s,this.m_clusterIndexA,5);let i=this.isPredicateKnown_(5);n&&=i}if(this.m_performPredicates[6]){this.interiorLineExteriorLine_(t,s,e,6);let i=this.isPredicateKnown_(6);n&&=i}if(this.m_performPredicates[7]){this.boundaryLineExteriorLine_(t,s,e,this.m_clusterIndexB,7);let i=this.isPredicateKnown_(7);n&&=i}return n}areaPointPredicates_(t,e,s){let n=!0;if(this.m_performPredicates[0]){this.interiorAreaInteriorPoint_(t,e);let i=this.isPredicateKnown_(0);n&&=i}if(this.m_performPredicates[2]){this.interiorAreaExteriorPoint_(t,e);let i=this.isPredicateKnown_(2);n&&=i}if(this.m_performPredicates[3]){this.boundaryAreaInteriorPoint_(t,e,s);let i=this.isPredicateKnown_(3);n&&=i}if(this.m_performPredicates[5]){this.boundaryAreaExteriorPoint_(t,e);let i=this.isPredicateKnown_(5);n&&=i}if(this.m_performPredicates[6]){this.exteriorAreaInteriorPoint_(t,e);let i=this.isPredicateKnown_(6);n&&=i}return n}linePointPredicates_(t,e,s){let n=!0;if(this.m_performPredicates[0]){this.interiorLineInteriorPoint_(t,e,s,this.m_clusterIndexA);let i=this.isPredicateKnown_(0);n&&=i}if(this.m_performPredicates[2]){this.interiorLineExteriorPoint_(t,e,s,this.m_clusterIndexA);let i=this.isPredicateKnown_(2);n&&=i}if(this.m_performPredicates[3]){this.boundaryLineInteriorPoint_(t,e,s,this.m_clusterIndexA);let i=this.isPredicateKnown_(3);n&&=i}if(this.m_performPredicates[5]){this.boundaryLineExteriorPoint_(t,e,s,this.m_clusterIndexA);let i=this.isPredicateKnown_(5);n&&=i}if(this.m_performPredicates[6]){this.exteriorLineInteriorPoint_(t,e,s);let i=this.isPredicateKnown_(6);n&&=i}return n}pointPointPredicates_(t,e,s){let n=!0;if(this.m_performPredicates[0]){this.interiorPointInteriorPoint_(t,e,s);let i=this.isPredicateKnown_(0);n&&=i}if(this.m_performPredicates[2]){this.interiorPointExteriorPoint_(t,e,s,2);let i=this.isPredicateKnown_(2);n&&=i}if(this.m_performPredicates[6]){this.interiorPointExteriorPoint_(t,s,e,6);let i=this.isPredicateKnown_(6);n&&=i}return n}interiorAreaInteriorArea_(t,e,s){if(this.m_matrix[0]===2)return;let n=this.m_topoGraph.getHalfEdgeFaceParentage(t);n&e&&n&s&&(this.m_matrix[0]=2)}interiorAreaBoundaryArea_(t,e,s){if(this.m_matrix[s]===1)return;let n=this.m_topoGraph.getHalfEdgeFaceParentage(t),i=this.m_topoGraph.getHalfEdgeFaceParentage(this.m_topoGraph.getHalfEdgeTwin(t));n&e&&i&e&&(this.m_matrix[s]=1)}interiorAreaExteriorArea_(t,e,s,n){if(this.m_matrix[n]===2)return;let i=this.m_topoGraph.getHalfEdgeFaceParentage(t);i&e&&!(i&s)&&(this.m_matrix[n]=2)}boundaryAreaBoundaryArea_(t,e,s){if(this.m_matrix[4]===1)return;let n=this.m_topoGraph.getHalfEdgeParentage(t);if(n&e&&n&s)this.m_matrix[4]=1;else if(this.m_matrix[4]!==0&&this.m_topoGraph.getHalfEdgeUserIndex(this.m_topoGraph.getHalfEdgePrev(this.m_topoGraph.getHalfEdgeTwin(t)),this.m_visitedIndex)!==1){let i=this.m_topoGraph.getHalfEdgeTo(t),o=this.m_topoGraph.getClusterParentage(i);if(o&e&&o&s)return void(this.m_matrix[4]=0)}}boundaryAreaExteriorArea_(t,e,s,n){if(this.m_matrix[n]===1)return;let i=this.m_topoGraph.getHalfEdgeFaceParentage(t),o=this.m_topoGraph.getHalfEdgeFaceParentage(this.m_topoGraph.getHalfEdgeTwin(t));i&s||o&s||(this.m_matrix[n]=1)}interiorAreaInteriorLine_(t,e,s){if(this.m_matrix[0]===1)return;let n=this.m_topoGraph.getHalfEdgeFaceParentage(t),i=this.m_topoGraph.getHalfEdgeFaceParentage(this.m_topoGraph.getHalfEdgeTwin(t));n&e&&i&e&&(this.m_matrix[0]=1)}interiorAreaBoundaryLine_(t,e,s,n){if(this.m_matrix[1]!==0&&this.m_topoGraph.getHalfEdgeUserIndex(this.m_topoGraph.getHalfEdgePrev(this.m_topoGraph.getHalfEdgeTwin(t)),this.m_visitedIndex)!==1){let i=this.m_topoGraph.getHalfEdgeTo(t),o=this.m_topoGraph.getClusterParentage(i);if(!(o&e)&&this.m_topoGraph.getHalfEdgeFaceParentage(t)&e){let a=this.m_topoGraph.getClusterUserIndex(i,n);if(o&s&&a%2!=0)return void(this.m_matrix[1]=0)}}}interiorAreaExteriorLine_(t,e,s){this.m_matrix[2]!==2&&this.m_topoGraph.getHalfEdgeParentage(t)&e&&(this.m_matrix[2]=2)}boundaryAreaInteriorLine_(t,e,s,n){if(this.m_matrix[3]===1)return;let i=this.m_topoGraph.getHalfEdgeParentage(t);if(i&e&&i&s)this.m_matrix[3]=1;else if(this.m_matrix[3]!==0&&this.m_topoGraph.getHalfEdgeUserIndex(this.m_topoGraph.getHalfEdgePrev(this.m_topoGraph.getHalfEdgeTwin(t)),this.m_visitedIndex)!==1){let o=this.m_topoGraph.getHalfEdgeTo(t),a=this.m_topoGraph.getClusterParentage(o);if(a&e){let h=this.m_topoGraph.getClusterUserIndex(o,n);if(a&s&&h%2==0)return void(this.m_matrix[3]=0)}}}boundaryAreaBoundaryLine_(t,e,s,n){if(this.m_matrix[4]!==0&&this.m_topoGraph.getHalfEdgeUserIndex(this.m_topoGraph.getHalfEdgePrev(this.m_topoGraph.getHalfEdgeTwin(t)),this.m_visitedIndex)!==1){let i=this.m_topoGraph.getHalfEdgeTo(t),o=this.m_topoGraph.getClusterParentage(i);if(o&e){let a=this.m_topoGraph.getClusterUserIndex(i,n);if(o&s&&a%2!=0)return void(this.m_matrix[4]=0)}}}boundaryAreaExteriorLine_(t,e,s){if(this.m_matrix[5]===1)return;let n=this.m_topoGraph.getHalfEdgeParentage(t);n&e&&!(n&s)&&(this.m_matrix[5]=1)}exteriorAreaInteriorLine_(t,e){if(this.m_matrix[6]===1)return;let s=this.m_topoGraph.getHalfEdgeFaceParentage(t),n=this.m_topoGraph.getHalfEdgeFaceParentage(this.m_topoGraph.getHalfEdgeTwin(t));s&e||n&e||(this.m_matrix[6]=1)}exteriorAreaBoundaryLine_(t,e,s,n){if(this.m_matrix[7]!==0&&this.m_topoGraph.getHalfEdgeUserIndex(this.m_topoGraph.getHalfEdgePrev(this.m_topoGraph.getHalfEdgeTwin(t)),this.m_visitedIndex)!==1){let i=this.m_topoGraph.getHalfEdgeTo(t),o=this.m_topoGraph.getClusterParentage(i);if(!(o&e)&&!(this.m_topoGraph.getHalfEdgeFaceParentage(t)&e)){let a=this.m_topoGraph.getClusterUserIndex(i,n);if(o&s&&a%2!=0)return void(this.m_matrix[7]=0)}}}interiorLineInteriorLine_(t,e,s,n,i){if(this.m_matrix[0]===1)return;let o=this.m_topoGraph.getHalfEdgeParentage(t);if(o&e&&o&s)this.m_matrix[0]=1;else if(this.m_matrix[0]!==0&&this.m_topoGraph.getHalfEdgeUserIndex(this.m_topoGraph.getHalfEdgePrev(this.m_topoGraph.getHalfEdgeTwin(t)),this.m_visitedIndex)!==1){let a=this.m_topoGraph.getHalfEdgeTo(t),h=this.m_topoGraph.getClusterParentage(a);if(h&e&&h&s){let m=this.m_topoGraph.getClusterUserIndex(a,n),l=this.m_topoGraph.getClusterUserIndex(a,i);if(m%2==0&&l%2==0)return void(this.m_matrix[0]=0)}}}interiorLineBoundaryLine_(t,e,s,n,i,o){if(this.m_matrix[o]!==0&&this.m_topoGraph.getHalfEdgeUserIndex(this.m_topoGraph.getHalfEdgePrev(this.m_topoGraph.getHalfEdgeTwin(t)),this.m_visitedIndex)!==1){let a=this.m_topoGraph.getHalfEdgeTo(t),h=this.m_topoGraph.getClusterParentage(a);if(h&e&&h&s){let m=this.m_topoGraph.getClusterUserIndex(a,n),l=this.m_topoGraph.getClusterUserIndex(a,i);if(m%2==0&&l%2!=0)return void(this.m_matrix[o]=0)}}}interiorLineExteriorLine_(t,e,s,n){if(this.m_matrix[n]===1)return;let i=this.m_topoGraph.getHalfEdgeParentage(t);i&e&&!(i&s)&&(this.m_matrix[n]=1)}boundaryLineBoundaryLine_(t,e,s,n,i){if(this.m_matrix[4]!==0&&this.m_topoGraph.getHalfEdgeUserIndex(this.m_topoGraph.getHalfEdgePrev(this.m_topoGraph.getHalfEdgeTwin(t)),this.m_visitedIndex)!==1){let o=this.m_topoGraph.getHalfEdgeTo(t),a=this.m_topoGraph.getClusterParentage(o);if(a&e&&a&s){let h=this.m_topoGraph.getClusterUserIndex(o,n),m=this.m_topoGraph.getClusterUserIndex(o,i);if(h%2!=0&&m%2!=0)return void(this.m_matrix[4]=0)}}}boundaryLineExteriorLine_(t,e,s,n,i){if(this.m_matrix[i]!==0&&this.m_topoGraph.getHalfEdgeUserIndex(this.m_topoGraph.getHalfEdgePrev(this.m_topoGraph.getHalfEdgeTwin(t)),this.m_visitedIndex)!==1){let o=this.m_topoGraph.getHalfEdgeTo(t);if(!(this.m_topoGraph.getClusterParentage(o)&s)&&this.m_topoGraph.getClusterUserIndex(o,n)%2!=0)return void(this.m_matrix[i]=0)}}interiorAreaInteriorPoint_(t,e){if(this.m_matrix[0]!==0&&!(this.m_topoGraph.getClusterParentage(t)&e)){let s=this.m_topoGraph.getClusterChain(t);if(this.m_topoGraph.getChainParentage(s)&e)return void(this.m_matrix[0]=0)}}interiorAreaExteriorPoint_(t,e){this.m_matrix[2]!==2&&this.m_topoGraph.getClusterParentage(t)&e&&(this.m_matrix[2]=2)}boundaryAreaInteriorPoint_(t,e,s){if(this.m_matrix[3]===0)return;let n=this.m_topoGraph.getClusterParentage(t);n&e&&n&s&&(this.m_matrix[3]=0)}boundaryAreaExteriorPoint_(t,e){this.m_matrix[5]!==1&&this.m_topoGraph.getClusterParentage(t)&e&&(this.m_matrix[5]=1)}exteriorAreaInteriorPoint_(t,e){if(this.m_matrix[6]!==0&&!(this.m_topoGraph.getClusterParentage(t)&e)){let s=this.m_topoGraph.getClusterChain(t);if(!(this.m_topoGraph.getChainParentage(s)&e))return void(this.m_matrix[6]=0)}}interiorLineInteriorPoint_(t,e,s,n){if(this.m_matrix[0]===0)return;let i=this.m_topoGraph.getClusterParentage(t);if(i&e&&i&s&&this.m_topoGraph.getClusterUserIndex(t,n)%2==0)return void(this.m_matrix[0]=0)}interiorLineExteriorPoint_(t,e,s,n){if(this.m_matrix[2]!==1)if(this.m_topoGraph.getClusterHalfEdge(t)===-1){if(this.m_matrix[2]!==0&&!(this.m_topoGraph.getClusterParentage(t)&s))return void(this.m_matrix[2]=0)}else this.m_matrix[2]=1}boundaryLineInteriorPoint_(t,e,s,n){if(this.m_matrix[3]===0)return;let i=this.m_topoGraph.getClusterParentage(t);if(i&e&&i&s&&this.m_topoGraph.getClusterUserIndex(t,n)%2!=0)return void(this.m_matrix[3]=0)}boundaryLineExteriorPoint_(t,e,s,n){if(this.m_matrix[5]===0)return;let i=this.m_topoGraph.getClusterParentage(t);if(i&e&&!(i&s)&&this.m_topoGraph.getClusterUserIndex(t,n)%2!=0)return void(this.m_matrix[5]=0)}exteriorLineInteriorPoint_(t,e,s){if(this.m_matrix[6]===0)return;let n=this.m_topoGraph.getClusterParentage(t);n&e||!(n&s)||(this.m_matrix[6]=0)}interiorPointInteriorPoint_(t,e,s){if(this.m_matrix[0]===0)return;let n=this.m_topoGraph.getClusterParentage(t);n&e&&n&s&&(this.m_matrix[0]=0)}interiorPointExteriorPoint_(t,e,s,n){if(this.m_matrix[n]===0)return;let i=this.m_topoGraph.getClusterParentage(t);!(i&e)||i&s||(this.m_matrix[n]=0)}computeMatrixTopoGraphHalfEdges_(t,e){let s=!1,n=this.m_topoGraph.getGeometryID(t),i=this.m_topoGraph.getGeometryID(e);this.m_visitedIndex=this.m_topoGraph.createUserIndexForHalfEdges();for(let o=this.m_topoGraph.getFirstCluster();o!==v;o=this.m_topoGraph.getNextCluster(o)){let a=this.m_topoGraph.getClusterHalfEdge(o);if(a===v){if(this.m_predicatesCluster!==null&&(s=this.m_predicatesCluster(o,n,i),s))break;continue}let h=a;do{let m=h;if(this.m_topoGraph.getHalfEdgeUserIndex(m,this.m_visitedIndex)!==1)do{if(s=this.m_predicatesHalfEdge(m,n,i),s)break;this.m_topoGraph.setHalfEdgeUserIndex(m,this.m_visitedIndex,1),m=this.m_topoGraph.getHalfEdgeNext(m)}while(m!==h&&!s);if(s)break;h=this.m_topoGraph.getHalfEdgeNext(this.m_topoGraph.getHalfEdgeTwin(m))}while(h!==a);if(s)break}s||this.setRemainingPredicatesToFalse_(),this.m_topoGraph.deleteUserIndexForHalfEdges(this.m_visitedIndex)}computeMatrixTopoGraphClusters_(t,e){let s=!1,n=this.m_topoGraph.getGeometryID(t),i=this.m_topoGraph.getGeometryID(e);for(let o=this.m_topoGraph.getFirstCluster();o!==v&&(s=this.m_predicatesCluster(o,n,i),!s);o=this.m_topoGraph.getNextCluster(o));s||this.setRemainingPredicatesToFalse_()}setEditShape_(t,e){this.m_topoGraph.setEditShape(t,e)}setEditShapeCrackAndCluster_(t,e,s){let n=0;if(t.hasCurves()){let i=new Be,o=t.getEnvelope2D(s),a=us(e.total(),o);n=Os(a,0),Ss(t,a,e.total(),12e3,i,null,s),i.clearStitcher(t)}Us(t,e.add(n),s,!1,!1),t.filterClosePoints(0,!0,!0,!1,v);for(let i=t.getFirstGeometry();i!==v;i=t.getNextGeometry(i))t.getGeometryType(i)===N.enumPolygon&&vn(t,i,-1,!1,v,s);this.setEditShape_(t,s)}};function s_(r){let t=r[1],e=r[2],s=r[5];r[1]=r[3],r[2]=r[6],r[5]=r[7],r[3]=t,r[6]=e,r[7]=s}function sd(r,t,e){let s=r.getGeometryType();if(Qt(s)){let n=new dt({vd:r.getDescription()});return n.addSegment(r,!0),n}if(s===N.enumEnvelope){let n=r,i=V.constructEmpty();if(r.queryEnvelope(i),i.height()<=t&&i.width()<=t){let a=new st({vd:r.getDescription()});return n.getCenter(a),a}if(i.height()<=t||i.width()<=t){let a=new dt({vd:r.getDescription()}),h=new st;return n.queryCornerByVal(0,h),a.startPathPoint(h),n.queryCornerByVal(2,h),a.lineToPoint(h),a}let o=new lt({vd:r.getDescription()});return o.addEnvelope(n,!1),o}return r}function yi(r){return`${r[0]}${r[3]}${r[6]}${r[1]}${r[4]}${r[7]}${r[2]}${r[5]}${r[8]}`}var qe=class{nullFunc(){return j("should not be called"),!1}constructor(t,e,s,n=!1){this.m_bDone=!1,this.m_tolerance=0,this.m_elementHandle=-1,this.m_query=V.constructEmpty(),this.m_envInter=V.constructEmpty(),this.m_quadTree=null,this.m_intersector=null,this.m_function=this.nullFunc;let i=t.getAccelerators(),o=null;i!=null&&(o=n?i.getQuadTreeForPaths():i.getQuadTree());let a=e.getAccelerators(),h=null;if(a!=null&&(h=n?a.getQuadTreeForPaths():a.getQuadTree()),o===null&&h===null&&!n){let m=t.getPointCount(),l=e.getPointCount();if(m>10&&l>10){let u=V.constructEmpty(),c=V.constructEmpty(),g=V.constructEmpty();t.queryLooseEnvelope(u),e.queryLooseEnvelope(c),u.inflateCoords(s,s),c.inflateCoords(s,s),g.setCoords({env2D:u}),g.intersect(c),m>=l?o=at(t.getGeometryType())?cn(t,g):hh(t,g):h=at(e.getGeometryType())?cn(e,g):hh(e,g)}}this.construct_(t,o,e,h,s,n)}next(){if(this.m_bQuadTree){if(this.m_bDone)return!1;for(;this.m_function(););return!this.m_bDone}return!!this.m_intersector&&this.m_intersector.next()}getRedElement(){return this.m_bQuadTree?this.m_bSwapElements?this.m_quadTree.getElement(this.m_elementHandle):at(this.m_queryType)?this.m_bPaths?this.m_pathIndex:this.m_segIter.getStartPointIndex():this.m_pointIndex:this.m_bSwapElements?this.m_intersector.getBlueElement(this.m_intersector.getHandleB()):this.m_intersector.getRedElement(this.m_intersector.getHandleA())}getBlueElement(){return this.m_bQuadTree?this.m_bSwapElements?at(this.m_queryType)?this.m_bPaths?this.m_pathIndex:this.m_segIter.getStartPointIndex():this.m_pointIndex:this.m_quadTree.getElement(this.m_elementHandle):this.m_bSwapElements?this.m_intersector.getRedElement(this.m_intersector.getHandleA()):this.m_intersector.getBlueElement(this.m_intersector.getHandleB())}getRedEnvelope(){return this.m_bPaths||re(""),this.m_bQuadTree?this.m_bSwapElements?this.m_quadTree.getElementExtent(this.m_elementHandle):this.m_query:this.m_bSwapElements?this.m_intersector.getBlueEnvelope(this.m_intersector.getHandleB()):this.m_intersector.getRedEnvelope(this.m_intersector.getHandleA())}getBlueEnvelope(){return this.m_bPaths||re(""),this.m_bQuadTree?this.m_bSwapElements?this.m_query:this.m_quadTree.getElementExtent(this.m_elementHandle):this.m_bSwapElements?this.m_intersector.getRedEnvelope(this.m_intersector.getHandleA()):this.m_intersector.getBlueEnvelope(this.m_intersector.getHandleB())}construct_(t,e,s,n,i,o){let a=V.constructEmpty(),h=V.constructEmpty();t.queryLooseEnvelope(a),s.queryLooseEnvelope(h),a.inflateCoords(i,i),h.inflateCoords(i,i),this.m_envInter.setCoords({env2D:a}),this.m_envInter.intersect(h),this.m_multiVertexImplA=t,this.m_multiVertexImplB=s;let m=t.getGeometryType(),l=s.getGeometryType();this.m_bPaths=o,this.m_pathIndex=-1,this.m_pointIndex=-1,this.m_bSwapElements=!1,this.m_queryType=N.enumUnknown,this.m_bQuadTree=!1,e!==null&&(this.m_bDone=!1,this.m_tolerance=i,this.m_quadTree=e,this.m_qtIter=this.m_quadTree.getIteratorForQT(),this.m_bQuadTree=!0,this.m_bSwapElements=!0,at(l)?(this.m_queryType=l,this.m_function=this.nextPath_,o?this.m_pathIndex=s.getPathCount():this.m_segIter=s.querySegmentIterator()):(this.m_queryType=l,this.m_function=this.nextPoint_,this.m_pointIndex=s.getPointCount())),this.m_bQuadTree||n!==null&&(this.m_bDone=!1,this.m_tolerance=i,this.m_quadTree=n,this.m_qtIter=this.m_quadTree.getIteratorForQT(),this.m_bQuadTree=!0,this.m_bSwapElements=!1,at(m)?(this.m_queryType=m,this.m_function=this.nextPath_,o?this.m_pathIndex=t.getPathCount():this.m_segIter=t.querySegmentIterator()):(this.m_queryType=m,this.m_function=this.nextPoint_,this.m_pointIndex=t.getPointCount())),this.m_bQuadTree||(o&&at(m)&&at(l)?this.m_intersector=Hu(t,s,i):at(m)&&at(l)?(this.m_intersector=Ru(t,s,i),this.m_bSwapElements=!1):at(m)&&!at(l)?(this.m_intersector=ah(t,s,i),this.m_bSwapElements=!1):!at(m)&&at(l)?(this.m_intersector=ah(s,t,i),this.m_bSwapElements=!0):(this.m_intersector=Lu(t,s,i),this.m_bSwapElements=!1))}nextPath_(){return this.m_bPaths?--this.m_pathIndex==-1?(this.m_bDone=!0,!1):(this.m_bSwapElements?this.m_multiVertexImplB.queryPathEnvelope(this.m_pathIndex,this.m_query):this.m_multiVertexImplA.queryPathEnvelope(this.m_pathIndex,this.m_query),this.m_qtIter.resetIterator(this.m_query,this.m_tolerance),this.m_function=this.iterate_,!0):this.m_segIter.nextPath()?(this.m_function=this.nextSegment_,!0):(this.m_bDone=!0,!1)}nextSegment_(){if(!this.m_segIter.hasNextSegment())return this.m_function=this.nextPath_,!0;let t=this.m_segIter.nextSegment(),e=new V;return t.queryLooseEnvelope(e),!e.isIntersecting(this.m_envInter)||(this.m_qtIter.resetIterator(t,this.m_tolerance),this.m_function=this.iterate_,!0)}nextPoint_(){if(--this.m_pointIndex==-1)return this.m_bDone=!0,!1;let t=new y;if(this.m_bSwapElements){let e=this.m_multiVertexImplB.getXY(this.m_pointIndex);t.setCoordsPoint2D(e)}else{let e=this.m_multiVertexImplA.getXY(this.m_pointIndex);t.setCoordsPoint2D(e)}return!this.m_envInter.contains(t)||(this.m_qtIter.resetIterator(V.construct(t.x,t.y,t.x,t.y),this.m_tolerance),this.m_function=this.iterate_,!0)}iterate_(){return this.m_elementHandle=this.m_qtIter.next(),this.m_elementHandle===-1&&(at(this.m_queryType)?(this.m_function=this.m_bPaths?this.nextPath_:this.nextSegment_,!0):(this.m_function=this.nextPoint_,!0))}};function Fm(r){return r===2?1:r===1?2:r===128?64:r===64?128:r}function j1(r,t,e){let s;if(r instanceof sn||r===null){let n=V.constructEmpty();n.setCoords({pt:t}),n.mergeEnvelope2D(e),s=un(r,n,!1)}else s=r;return s}function n_(r,t,e){let s;if(r instanceof sn||r===null){let n=V.constructEmpty();n.setCoords({env2D:t}),n.mergeEnvelope2D(e),s=un(r,n,!1)}else s=r;return s}function Sn(r,t,e,s,n){if(r.isEmpty()||t.isEmpty())return s===4;ds(r),ds(t);let i=r.getGeometryType(),o=t.getGeometryType();if(i===N.enumEnvelope){if(o===N.enumEnvelope)return Z1(r,t,e,s);if(o===N.enumPoint)return nd(t,r,e,Fm(s))}else if(i===N.enumPoint){if(o===N.enumEnvelope)return nd(r,t,e,s);if(o===N.enumPoint)return Q1(r,t,e,s)}let a=V.constructEmpty();r.queryEnvelope(a);let h=V.constructEmpty();t.queryEnvelope(h);let m=n_(e,a,h);if(js(a,h,m))return s===4;let l=!1,u=null,c=null,g=null,d=null;switch(Qt(i)?(u=new dt({vd:r.getDescription()}),u.addSegment(r,!0),g=u,i=N.enumPolyline):g=r,Qt(o)?(c=new dt({vd:t.getDescription()}),c.addSegment(t,!0),d=c,o=N.enumPolyline):d=t,i!==N.enumEnvelope&&o!==N.enumEnvelope?(g.getDimension()<d.getDimension()||i===N.enumPoint&&o===N.enumMultiPoint)&&(s=Fm(s)):i!==N.enumPolygon&&o!==N.enumEnvelope&&(s=Fm(s)),i){case N.enumPolygon:switch(o){case N.enumPolygon:l=K1(g,d,m,s,n);break;case N.enumPolyline:l=id(g,d,m,s,n);break;case N.enumPoint:l=rd(g,d,m,s);break;case N.enumMultiPoint:l=od(g,d,m,s);break;case N.enumEnvelope:l=ad(g,d,m,s,n)}break;case N.enumPolyline:switch(o){case N.enumPolygon:l=id(d,g,m,s,n);break;case N.enumPolyline:l=$1(g,d,m,s,n);break;case N.enumPoint:l=hd(g,d,m,s);break;case N.enumMultiPoint:l=md(g,d,m,s);break;case N.enumEnvelope:l=ld(g,d,m,s,n)}break;case N.enumPoint:switch(o){case N.enumPolygon:l=rd(d,g,m,s);break;case N.enumPolyline:l=hd(d,g,m,s);break;case N.enumMultiPoint:l=ud(d,g,m,s)}break;case N.enumMultiPoint:switch(o){case N.enumPolygon:l=od(d,g,m,s);break;case N.enumPolyline:l=md(d,g,m,s);break;case N.enumMultiPoint:l=J1(g,d,m,s);break;case N.enumPoint:l=ud(g,d,m,s);break;case N.enumEnvelope:l=cd(g,d,m,s)}break;case N.enumEnvelope:switch(o){case N.enumPolygon:l=ad(d,g,m,s,n);break;case N.enumPolyline:l=ld(d,g,m,s,n);break;case N.enumMultiPoint:l=cd(d,g,m,s)}}return l}function Z1(r,t,e,s,n){if(r.isEmpty()||t.isEmpty())return s===4;let i=V.constructEmpty();r.queryEnvelope(i);let o=V.constructEmpty();t.queryEnvelope(o);let a=n_(e,i,o);switch(s){case 4:return js(i,o,a);case 2:return Lo(o,i,a,!1);case 128:return Lo(o,i,a,!0);case 1:return Lo(i,o,a,!1);case 64:return Lo(i,o,a,!0);case 3:return en(i,o,a);case 8:return Ox(i,o,a);case 32:return Wx(i,o,a);case 16:return!1}return!1}function nd(r,t,e,s,n){if(r.isEmpty()||t.isEmpty())return s===4;let i=r.getXY(),o=V.constructEmpty();t.queryEnvelope(o);let a=j1(e,i,o);switch(s){case 4:return Ta(i,o,a);case 2:case 128:return zx(i,o,a);case 1:case 64:return!1;case 3:return Bx(i,o,a);case 8:return Ux(i,o,a)}return!1}function Q1(r,t,e,s,n){if(r.isEmpty()||t.isEmpty())return s===4;let i=r.getXY(),o=t.getXY(),a;if(e instanceof sn||e===null){let h=V.constructEmpty();h.setCoords({pt:i}),h.merge(o),a=un(e,h,!1)}else a=e;switch(s){case 4:return Lx(i,o,a);case 2:case 128:return Ed(o,i,a);case 1:case 64:return Ed(i,o,a);case 3:return h_(i,o,a)}return!1}function js(r,t,e){let s=V.constructEmpty();return s.setCoords({env2D:t}),s.inflateCoords(e,e),!r.isIntersecting(s)}function Ct(r,t,e,s=!1){let n=r.getGeometryType(),i=t.getGeometryType();if(Ie(n)){let o=r.getImpl().getAccelerators();if(o!==null){let a=o.getRasterizedGeometry();w(a===null)}}if(Ie(i)){let o=t.getImpl().getAccelerators();if(o!==null){let a=o.getRasterizedGeometry();w(a===null)}}return 0}function Ta(r,t,e,s){let n=V.constructEmpty();return n.setCoords({env2D:t}),n.inflateCoords(e,e),!n.contains(r)}function K1(r,t,e,s,n){switch(s){case 4:return tx(r,t,e);case 2:return gd(t,r,e,n);case 128:return dd(t,r,e);case 1:return gd(r,t,e,n);case 64:return dd(r,t,e);case 3:return i_(r,t,e,n);case 8:return ex(r,t,e);case 32:return sx(r,t,e,n)}return!1}function id(r,t,e,s,n){switch(s){case 4:return nx(r,t,e);case 1:return rx(r,t,e,n);case 64:return ox(r,t,e);case 8:return r_(r,t,e,n);case 16:return ix(r,t,e)}return!1}function rd(r,t,e,s,n){switch(s){case 4:return ax(r,t,e);case 1:case 64:return mx(r,t,e);case 8:return hx(r,t,e)}return!1}function od(r,t,e,s,n){switch(s){case 4:return lx(r,t,e);case 1:return _d(r,t,e,!1);case 64:return _d(r,t,e,!0);case 8:return ux(r,t,e);case 16:return cx(r,t,e)}return!1}function ad(r,t,e,s,n){if(dx(r,t,e))return s===4;if(s===4)return!1;switch(s){case 2:return pd(r,t,e,!1);case 128:return pd(r,t,e,!0);case 1:return fd(r,t,e,!1,n);case 64:return fd(r,t,e,!0,n);case 3:return gx(r,t,e,n);case 8:return _x(r,t,e,n);case 32:return px(r,t,e,n);case 16:return!1}return!1}function $1(r,t,e,s,n){switch(s){case 4:return xx(r,t,e);case 2:return xd(t,r,e,n);case 128:return yd(t,r,e,n);case 1:return xd(r,t,e,n);case 64:return yd(r,t,e,n);case 3:return fx(r,t,e,n);case 8:return yx(r,t,e,n);case 32:return Cx(r,t,e,n);case 16:return Px(r,t,e,n)}return!1}function hd(r,t,e,s,n){switch(s){case 4:return Ex(r,t,e);case 1:case 64:return vx(r,t,e);case 8:return Sx(r,t,e)}return!1}function md(r,t,e,s,n){switch(s){case 4:return Ix(r,t,e);case 1:case 64:return Dx(r,t,e);case 8:return bx(r,t,e);case 16:return wx(r,t,e)}return!1}function ld(r,t,e,s,n){if(Nx(r,t,e))return s===4;if(s===4)return!1;switch(s){case 2:return Pd(r,t,e,!1);case 128:return Pd(r,t,e,!0);case 1:case 64:case 32:return!1;case 3:return Tx(r,t,e);case 8:return Ax(r,t,e,n);case 16:return Mx(r,t,e)}return!1}function J1(r,t,e,s,n){switch(s){case 4:return Fx(r,t,e);case 2:case 128:return jn(t,r,e);case 1:case 64:return jn(r,t,e);case 3:return Gx(r,t,e);case 32:return Vx(r,t,e)}return!1}function ud(r,t,e,s,n){switch(s){case 4:return a_(r,t,e);case 2:case 128:return qx(r,t,e);case 1:case 64:return Yx(r,t,e);case 3:return o_(r,t,e)}return!1}function cd(r,t,e,s,n){switch(s){case 4:return kx(r,t,e);case 2:return Cd(r,t,e,!1);case 128:return Cd(r,t,e,!0);case 1:case 64:return!1;case 3:return Xx(r,t,e);case 8:return Rx(r,t,e);case 16:return Hx(r,t,e)}return!1}function i_(r,t,e,s){let n=V.constructEmpty(),i=V.constructEmpty();if(r.queryEnvelope(n),t.queryEnvelope(i),!en(n,i,e))return!1;if(Ct(r,t),l_(r,t,e))return!0;let o=r.calculateLength2D(),a=t.calculateLength2D(),h=Math.max(r.getPointCount(),t.getPointCount());return Math.abs(o-a)>4*h*e?!1:r.hasNonLinearSegments()||t.hasNonLinearSegments()?vs(r,t,e,"**F**FFF*",s,!1):u_(r,t,e,!0)}function tx(r,t,e,s){return Ct(r,t,e,!0),Or(r,t,e,!0)===1}function ex(r,t,e,s){return Ct(r,t),p_(r,t,e,null)}function sx(r,t,e,s){return Ct(r,t),f_(r,t,e,s)}function gd(r,t,e,s){let n=V.constructEmpty(),i=V.constructEmpty();return r.queryEnvelope(n),t.queryEnvelope(i),!!ee(n,i,e)&&(Ct(r,t),x_(r,t,e,s))}function dd(r,t,e,s){let n=V.constructEmpty(),i=V.constructEmpty();return r.queryEnvelope(n),t.queryEnvelope(i),!!ee(n,i,e)&&(Ct(r,t),Or(r,t,e,!1)===2)}function nx(r,t,e,s){return Ct(r,t,e,!0),Or(r,t,e,!0)===1}function r_(r,t,e,s){return Ct(r,t),Kx(r,t,e,s)}function ix(r,t,e,s){return Ct(r,t),$x(r,t,e,null)}function rx(r,t,e,s){let n=V.constructEmpty(),i=V.constructEmpty();return r.queryEnvelope(n),t.queryEnvelope(i),!!ee(n,i,e)&&(Ct(r,t),Jx(r,t,e,s))}function ox(r,t,e,s){let n=V.constructEmpty(),i=V.constructEmpty();return r.queryEnvelope(n),t.queryEnvelope(i),!!ee(n,i,e)&&(Ct(r,t),Or(r,t,e,!1)===2)}function ax(r,t,e,s){return C_(r,t,e)===0}function hx(r,t,e,s){return ey(r,t.getXY(),e)}function mx(r,t,e,s){return ty(r,t.getXY(),e)}function lx(r,t,e,s,n){return Ct(r,t),jx(r,t,e)===1}function ux(r,t,e,s){Ct(r,t);let n=V.constructEmpty();r.queryEnvelope(n),n.inflateCoords(e,e);let i=new y,o=!1,a=r.getImpl(),h=new lt,m=r,l=!1;for(let u=0;u<t.getPointCount();u++){if(t.queryXY(u,i),n.contains(i)){let c=Ue(m,i,e);if(c===2)o=!0;else if(c===1)return!1}l||(!bn(r,t.getPointCount()-1)||a.getAccelerators()!==null&&a.getAccelerators().getQuadTree()!==null?m=r:(r.copyTo(h),h.getImpl().buildQuadTreeAccelerator(1),m=h),l=!0)}return!!o}function cx(r,t,e,s){Ct(r,t);let n=new V,i=new V,o=new V;r.queryEnvelope(n),t.queryEnvelope(o),i.setCoords({env2D:n}),i.inflateCoords(e,e);let a=!1,h=!1,m=new y,l=r.getImpl(),u=new lt,c=r,g=!1;for(let d=0;d<t.getPointCount();d++){if(t.queryXY(d,m),i.contains(m)){let _=Ue(c,m,e);_===0?h=!0:_===1&&(a=!0)}else h=!0;if(a&&h)return!0;g||(!bn(r,t.getPointCount()-1)||l.getAccelerators()!==null&&l.getAccelerators().getQuadTree()!==null?c=r:(r.copyTo(u),u.getImpl().buildQuadTreeAccelerator(1),c=u),g=!0)}return!1}function _d(r,t,e,s,n){let i=V.constructEmpty(),o=V.constructEmpty();if(r.queryEnvelope(i),t.queryEnvelope(o),!ee(i,o,e))return!1;Ct(r,t);let a=!1,h=new y,m=r.getImpl(),l=new lt,u=r,c=!1;for(let g=0;g<t.getPointCount();g++){if(t.queryXY(g,h),!i.contains(h))return!1;let d=Ue(u,h,e);if(d===1)a=!0;else if(d===0)return!1;if(s&&d===2)return!1;c||(!bn(r,t.getPointCount()-1)||m.getAccelerators()!==null&&m.getAccelerators().getQuadTree()!==null?u=r:(r.copyTo(l),l.getImpl().buildQuadTreeAccelerator(1),u=l),c=!0)}return a}function gx(r,t,e,s){let n=new V,i=new V;if(r.queryEnvelope(n),t.queryEnvelope(i),!en(n,i,e))return!1;let o=new lt;return o.addEnvelope(t,!1),i_(r,o,e,s)}function dx(r,t,e,s){Ct(r,t);let n=V.constructEmpty(),i=V.constructEmpty();return r.queryEnvelope(n),t.queryEnvelope(i),ee(i,n,e)?!1:Ue(r,i.getLowerLeft(),0)===0&&!i.contains(r.getXY(0))&&!__(r,i,e)}function _x(r,t,e,s){Ct(r,t);let n=new V,i=new V;if(r.queryEnvelope(n),t.queryEnvelope(i),ee(i,n,e)||i.height()<=e||i.width()<=e)return!1;let o=new lt;return o.addEnvelope(t,!1),p_(r,o,e,s)}function px(r,t,e,s){Ct(r,t);let n=new V,i=new V;if(r.queryEnvelope(n),t.queryEnvelope(i),ee(i,n,e)||i.height()<=e||i.width()<=e)return!1;let o=new lt;return o.addEnvelope(t,!1),f_(r,o,e,s)}function pd(r,t,e,s,n){let i=V.constructEmpty(),o=V.constructEmpty();return r.queryEnvelope(i),t.queryEnvelope(o),s?Na(o,i,e):ee(o,i,e)}function fd(r,t,e,s,n){let i=V.constructEmpty(),o=V.constructEmpty();if(r.queryEnvelope(i),t.queryEnvelope(o),!ee(i,o,e))return!1;Ct(r,t);let a=new lt;return a.addEnvelope(t,!1),s?Or(r,a,e,!1)===2:x_(r,a,e,n)}function fx(r,t,e,s){let n=V.constructEmpty(),i=V.constructEmpty();return r.queryEnvelope(n),t.queryEnvelope(i),en(n,i,e)?(Ct(r,t),l_(r,t,e)?!0:r.hasNonLinearSegments()||t.hasNonLinearSegments()?vs(r,t,e,"**F**FFF*",s,!1):u_(r,t,e,!1)):!1}function xx(r,t,e,s){Ct(r,t);let n=r.getImpl(),i=t.getImpl();return!new qe(n,i,e,!0).next()||!c_(r,t,e)}function yx(r,t,e,s){Ct(r,t);let n=[],i=Wl(r,t,e,n);if(i===-2){let m=V.constructEmpty(),l=V.constructEmpty(),u=V.constructEmpty(),c,g;if(r.queryEnvelope(m),t.queryEnvelope(l),m.inflateCoords(1e3*e,1e3*e),l.inflateCoords(1e3*e,1e3*e),u.setCoords({env2D:m}),u.intersect(l),r.getPointCount()>10){if(c=St(r,u,e,0,s),c.isEmpty())return!1}else c=r;if(t.getPointCount()>10){if(g=St(t,u,e,0,s),g.isEmpty())return!1}else g=t;return vs(c,g,e,"F********",s,!1)}if(i!==0)return!1;let o=new Lt;for(let m=0;m<n.length;m+=2){let l=n[m],u=n[m+1];o.addXY(l,u)}let a=r.getBoundary(),h=t.getBoundary();return a.addPoints(h,0,h.getPointCount()),!a.isEmpty()&&jn(a,o,e)}function Px(r,t,e,s){Ct(r,t);let n=[],i=Wl(r,t,e,n);if(i===-2){let m=V.constructEmpty(),l=V.constructEmpty(),u=V.constructEmpty(),c,g;if(r.queryEnvelope(m),t.queryEnvelope(l),m.inflateCoords(1e3*e,1e3*e),l.inflateCoords(1e3*e,1e3*e),u.setCoords({env2D:m}),u.intersect(l),r.getPointCount()>10){if(c=St(r,u,e,0,s),c.isEmpty())return!1}else c=r;if(t.getPointCount()>10){if(g=St(t,u,e,0,s),g.isEmpty())return!1}else g=t;return vs(c,g,e,"0********",s,!1)}if(i!==0)return!1;let o=new Lt;for(let m=0;m<n.length;m+=2){let l=n[m],u=n[m+1];o.addXY(l,u)}let a=r.getBoundary(),h=t.getBoundary();return a.addPoints(h,0,h.getPointCount()),!!a.isEmpty()||!jn(a,o,e)}function Cx(r,t,e,s){Ct(r,t);let n=V.constructEmpty(),i=V.constructEmpty();r.queryEnvelope(n),t.queryEnvelope(i);let o=Yr(n,i,e),a=Yr(i,n,e),h=r.hasNonLinearSegments(),m=t.hasNonLinearSegments(),l=Wl(r,t,e,null);if(l===-1)return!1;if(l===1){if(o&&a)return!0;if(!h&&!m)return o&&!a?!Un(t,r,e,!1):a&&!o?!Un(r,t,e,!1):!Un(r,t,e,!1)&&!Un(t,r,e,!1)}let u=V.constructEmpty(),c=V.constructEmpty(),g=V.constructEmpty(),d,_;u.setCoords({env2D:n}),u.inflateCoords(1e3*e,1e3*e),c.setCoords({env2D:i}),c.inflateCoords(1e3*e,1e3*e),g.setCoords({env2D:u}),g.intersect(c);let p="";if(p+="1*",o){if(t.getPointCount()>10){if(_=St(t,g,e,0,s),_.isEmpty())return!1}else _=t;p+="****"}else _=t,p+="T***";if(a){if(r.getPointCount()>10){if(d=St(r,g,e,0,s),d.isEmpty())return!1}else d=r;p+="***"}else d=r,p+="T**";return vs(d,_,e,p,s,!1)}function xd(r,t,e,s){let n=V.constructEmpty(),i=V.constructEmpty();return r.queryEnvelope(n),t.queryEnvelope(i),ee(n,i,e)?(Ct(r,t),r.hasNonLinearSegments()||t.hasNonLinearSegments()?vs(r,t,e,"******FF*",s,!1):Un(t,r,e,!1)):!1}function yd(r,t,e,s){let n=V.constructEmpty(),i=V.constructEmpty();return r.queryEnvelope(n),t.queryEnvelope(i),ee(n,i,e)?(Ct(r,t),vs(r,t,e,"T**FF*FF*",s,!1)):!1}function Ex(r,t,e,s){return Ct(r,t),!d_(r,t.getXY(),e)}function Sx(r,t,e,s){return Ct(r,t),P_(r,t.getXY(),e)}function vx(r,t,e,s){return Ct(r,t),Qx(r,t.getXY(),e)}function Ix(r,t,e,s){return Ct(r,t),!g_(r,t,e,!1)}function bx(r,t,e,s){Ct(r,t);let n=r.getImpl(),i=t.getImpl(),o=new Lt,a=new qe(n,i,e,!1),h=n.querySegmentIterator(),m=!1;for(;a.next();){let u=a.getRedElement(),c=a.getBlueElement();h.resetToVertex(u,-1);let g=h.nextSegment(),d=i.getXY(c);g.isIntersectingPoint(d,e)&&(m=!0,o.addPoint2D(d))}if(!m)return!1;let l=r.getBoundary();return!l.isEmpty()&&jn(l,o,e)}function wx(r,t,e,s){Ct(r,t);let n=r.getImpl(),i=t.getImpl(),o=i.getPointCount(),a=Z(o,!1),h=new qe(n,i,e,!1),m=n.querySegmentIterator(),l=!1;for(;h.next();){let d=h.getRedElement(),_=h.getBlueElement();m.resetToVertex(d,-1);let p=m.nextSegment(),f=i.getXY(_);p.isIntersectingPoint(f,e)&&(l=!0,a[_]=!0)}if(!l)return!1;let u=!1;for(let d=0;d<o;d++)if(!a[d]){u=!0;break}if(!u)return!1;let c=r.getBoundary();if(c.isEmpty())return!0;let g=new Lt;for(let d=0;d<o;d++)a[d]&&g.addPoint2D(i.getXY(d));return!jn(c,g,e)}function Dx(r,t,e,s,n){let i=V.constructEmpty(),o=V.constructEmpty();if(r.queryEnvelope(i),t.queryEnvelope(o),!ee(i,o,e))return!1;Ct(r,t);let a=g_(r,t,e,!0);if(!a)return a;let h=r.getBoundary();return h.isEmpty()?a:!jn(h,t,e)}function Tx(r,t,e,s){let n=new V,i=new V;return r.queryEnvelope(n),t.queryEnvelope(i),!(i.height()>e&&i.width()>e)&&en(n,i,e)}function Nx(r,t,e,s){let n=V.constructEmpty(),i=V.constructEmpty();r.queryEnvelope(n),t.queryEnvelope(i);let o=sy(i,n,e);return o===0?!__(r,i,e):o===4}function Ax(r,t,e,s){let n=new V,i=new V;if(r.queryEnvelope(n),t.queryEnvelope(i),i.height()<=e||i.width()<=e)return!1;let o=new V,a=new V;if(o.setCoords({env2D:i}),a.setCoords({env2D:i}),o.inflateCoords(e,e),a.inflateCoords(-e,-e),a.containsEnvelope(n)||!n.isIntersecting(o))return!1;let h=r.getImpl().querySegmentIterator();h.stripAttributes();let m=r.getImpl().getAccelerators(),l=null,u=null;m!==null&&(l=m.getQuadTree(),l!==null&&(u=l.getIterator(i,e))),u||h.nextPath()||j("relational_operations");let c=!1,g=null,d=new y,_=new y,p=r.hasNonLinearSegments(),f=!1;for(;;){if(u!==null){let C=u.next();if(C===-1)break;h.resetToVertex(l.getElement(C),-1),g=h.nextSegment()}else{for(;!h.hasNextSegment()&&h.nextPath(););if(!h.hasNextSegment())break;g=h.nextSegment()}if(p&&g.getGeometryType()!==N.enumLine){let C=new V;if(g.queryEnvelope(C),a.containsEnvelope(C))return!1;if(o.isIntersecting(C)){f=!0;break}}else{d.assign(g.getStartXY()),_.assign(g.getEndXY());let C=a.clipLine(d,_);if(C!==0)return!1;c||(C=o.clipLine(d,_),C!==0&&(c=!0))}}if(!f)return c;let x=new lt;return x.addEnvelope(i,!1),r_(x,r,e,s)}function Pd(r,t,e,s,n){let i=V.constructEmpty(),o=V.constructEmpty();if(r.queryEnvelope(i),t.queryEnvelope(o),o.height()<=e||o.width()<=e)return!1;if(s)return Na(o,i,e);if(!ee(o,i,e))return!1;let a=V.constructEmpty();a.setCoords({env2D:o}),a.inflateCoords(-e,-e);let h=V.constructEmpty();if(h.setCoords({env2D:o}),h.inflateCoords(e,e),a.containsEnvelope(i))return!0;let m=r.getImpl().querySegmentIterator();m.stripAttributes(),m.nextPath()||j("relational_operations");let l,u,c,g,d,_,p=!1,f=r.hasNonLinearSegments();for(f&&(c=new nt,g=new nt,d=new nt,_=new nt,a.querySide(0,c),a.querySide(1,g),a.querySide(2,d),a.querySide(3,_));;){for(;!m.hasNextSegment()&&m.nextPath(););if(!m.hasNextSegment())break;let x=m.nextSegment();if(f&&x.getGeometryType()!==N.enumLine){if(x.isIntersecting(c,e)){p=!0;break}if(x.isIntersecting(g,e)){p=!0;break}if(x.isIntersecting(d,e)){p=!0;break}if(x.isIntersecting(_,e)){p=!0;break}}else if(l=x.getStartXY(),u=x.getEndXY(),a.clipLine(l,u)!==0){p=!0;break}}return p}function Mx(r,t,e,s){let n=new V,i=new V;if(r.queryEnvelope(n),t.queryEnvelope(i),i.height()<=e||i.width()<=e)return!1;let o=new V;if(o.setCoords({env2D:i}),o.inflateCoords(e,e),o.containsEnvelope(n))return!1;let a=!0,h=new V;if(h.setCoords({env2D:i}),h.inflateCoords(-e,-e),!h.isIntersecting(n))return!1;let m=r.getImpl().querySegmentIterator();m.stripAttributes();let l=r.getImpl().getAccelerators(),u=null,c=null;if(l!==null&&(u=l.getQuadTree(),u!==null&&(c=u.getIterator(i,e))),!c){let E=m.nextPath();w(E)}let g=!1,d=null,_=new y,p=new y,f=null,x=null,C=null,P=null;for(r.hasNonLinearSegments()&&(f=new nt,x=new nt,C=new nt,P=new nt,h.querySide(0,f),h.querySide(1,x),h.querySide(2,C),h.querySide(3,P));;){if(c!==null){let E=c.next();if(E===-1)break;m.resetToVertex(u.getElement(E),-1),d=m.nextSegment()}else{for(;!m.hasNextSegment()&&m.nextPath(););if(!m.hasNextSegment())break;d=m.nextSegment()}if(d.getGeometryType()===N.enumLine){if(_.assign(d.getStartXY()),p.assign(d.getEndXY()),h.clipLine(_,p)!==0){g=!0;break}}else{if(f.isIntersecting(d,e)){g=!0;break}if(x.isIntersecting(d,e)){g=!0;break}if(C.isIntersecting(d,e)){g=!0;break}if(P.isIntersecting(d,e)){g=!0;break}}}return g&&a}function Gx(r,t,e,s){let n=V.constructEmpty(),i=V.constructEmpty();return r.queryEnvelope(n),t.queryEnvelope(i),!!en(n,i,e)&&(!!Zx(r,t,e)||Ol(r,t,e,!1,!0,!1))}function Fx(r,t,e,s){let n=r,i=t,o=new qe(n,i,e,!1),a=e*e,h=new y,m=new y;for(;o.next();){let l=o.getRedElement(),u=o.getBlueElement();if(n.queryXY(l,h),i.queryXY(u,m),y.sqrDistance(h,m)<=a)return!1}return!0}function Vx(r,t,e,s){return Ol(r,t,e,!1,!1,!0)}function jn(r,t,e,s){let n=V.constructEmpty(),i=V.constructEmpty();return r.queryEnvelope(n),t.queryEnvelope(i),!!ee(n,i,e)&&Ol(t,r,e,!0,!1,!1)}function o_(r,t,e,s){let n=V.constructEmpty(),i=V.constructEmpty();return r.queryEnvelope(n),t.queryEnvelope(i),en(n,i,e)}function a_(r,t,e,s){return y_(r,t.getXY(),e)}function qx(r,t,e,s){return o_(r,t,e)}function Yx(r,t,e,s){return!a_(r,t,e)}function Xx(r,t,e,s){let n=new V,i=new V;return r.queryEnvelope(n),t.queryEnvelope(i),!(i.height()>e||i.width()>e)&&en(n,i,e)}function kx(r,t,e,s){let n=V.constructEmpty(),i=V.constructEmpty();if(r.queryEnvelope(n),t.queryEnvelope(i),ee(i,n,e))return!1;let o=V.constructEmpty();o.setCoords({env2D:i}),o.inflateCoords(e,e);let a=new y;for(let h=0;h<r.getPointCount();h++)if(r.queryXY(h,a),o.contains(a))return!1;return!0}function Rx(r,t,e,s){let n=new V,i=new V,o=new V;if(t.queryEnvelope(n),n.height()<=e||n.width()<=e)return!1;i.setCoords({env2D:n}),o.setCoords({env2D:n}),i.inflateCoords(e,e),o.inflateCoords(-e,-e);let a=new y,h=!1;for(let m=0;m<r.getPointCount();m++)if(r.queryXY(m,a),i.contains(a)){if(o.containsExclusive(a))return!1;h=!0}return h}function Cd(r,t,e,s,n){let i=V.constructEmpty(),o=V.constructEmpty();if(r.queryEnvelope(i),t.queryEnvelope(o),o.height()<=e||o.width()<=e)return!1;if(s)return Na(o,i,e);if(!ee(o,i,e))return!1;let a=!1,h=V.constructEmpty(),m=V.constructEmpty();h.setCoords({env2D:o}),m.setCoords({env2D:o}),h.inflateCoords(-e,-e),m.inflateCoords(e,e);let l=new y;for(let u=0;u<r.getPointCount();u++){if(r.queryXY(u,l),!m.contains(l))return!1;h.containsExclusive(l)&&(a=!0)}return a}function Hx(r,t,e,s){let n=new V,i=new V;if(r.queryEnvelope(n),t.queryEnvelope(i),ee(i,n,e)||i.height()<=e||i.width()<=e)return!1;let o=new V,a=new V;o.setCoords({env2D:i}),o.inflateCoords(-e,-e),a.setCoords({env2D:i}),a.inflateCoords(e,e);let h=new y,m=!1,l=!1;for(let u=0;u<r.getPointCount();u++)if(r.queryXY(u,h),!m&&o.containsExclusive(h)&&(m=!0),l||a.contains(h)||(l=!0),m&&l)return!0;return!1}function h_(r,t,e,s){return y.sqrDistance(r,t)<=e*e}function Lx(r,t,e,s){return y.sqrDistance(r,t)>e*e}function Ed(r,t,e,s){return h_(r,t,e)}function Bx(r,t,e,s){let n=new V;return n.setCoords({pt:r}),en(n,t,e)}function Ux(r,t,e,s){if(t.height()<=e||t.width()<=e)return!1;let n=new V,i=new V;return n.setCoords({env2D:t}),n.inflateCoords(e,e),!!n.contains(r)&&(i.setCoords({env2D:t}),i.inflateCoords(-e,-e),!i.containsExclusive(r))}function zx(r,t,e,s){if(t.height()<=e||t.width()<=e)return!1;let n=V.constructEmpty();return n.setCoords({env2D:t}),n.inflateCoords(-e,-e),n.containsExclusive(r)}function en(r,t,e,s){return ee(r,t,e)&&ee(t,r,e)}function Ox(r,t,e,s){if(r.height()<=e||r.width()<=e||t.height()<=e||t.width()<=e)return!1;let n=new V;return n.setCoords({env2D:r}),n.inflateCoords(-e,-e),n.intersect(t),!(!n.isEmpty()&&n.height()>e&&n.width()>e)&&(n.setCoords({env2D:r}),n.inflateCoords(e,e),n.intersect(t),!n.isEmpty())}function Wx(r,t,e,s){if(r.height()<=e||r.width()<=e||t.height()<=e||t.width()<=e||ee(r,t,e)||ee(t,r,e))return!1;let n=new V;return n.setCoords({env2D:r}),n.inflateCoords(-e,-e),n.intersect(t),!n.isEmpty()&&(n.height()>e||n.width()>e)}function Lo(r,t,e,s,n){if(r.height()<=e||r.width()<=e)return!1;if(s)return Na(r,t,e);if(!ee(r,t,e))return!1;let i=V.constructEmpty();return i.setCoords({env2D:r}),i.inflateCoords(-e,-e),i.intersect(t),!i.isEmpty()}function Or(r,t,e,s,n){let i=new y,o=new y,a=V.constructEmpty(),h=V.constructEmpty(),m=r.getImpl(),l=t.getImpl(),u=l.getGeometryType(),c=new qe(m,l,e,!0);if(!c.next())return 1;if(c_(r,t,e))return s?4:0;let g=new lt,d=r,_=new lt,p=null;u===N.enumPolygon&&(p=t);let f=u===N.enumPolygon?Z(m.getPathCount(),!1):[],x=Z(l.getPathCount(),!1),C=!1,P=!1,E=!1,S=!1,I=!1,D=!1;do{if(E&&I||S&&D||E&&S)break;let b=c.getRedElement(),T=c.getBlueElement();if(!x[T]&&(o.assign(t.getXY(t.getPathStart(T))),a.setCoords({env2D:c.getRedEnvelope()}),a.inflateCoords(e,e),a.contains(o))){if(Ue(d,o,0)!==0){if(S=!0,s)return 4}else D=!0;x[T]=!0}if(u===N.enumPolygon&&!f[b]&&(i.assign(r.getXY(r.getPathStart(b))),h.setCoords({env2D:c.getBlueEnvelope()}),h.inflateCoords(e,e),h.contains(i))){if(Ue(p,i,0)!==0){if(E=!0,s)return 4}else I=!0;f[b]=!0}if(C||(!bn(r,t.getPathCount()-1)||m.getAccelerators()!==null&&m.getAccelerators().getQuadTree()!==null?d=r:(r.copyTo(g),g.getImpl().buildQuadTreeAccelerator(1),d=g),C=!0),u===N.enumPolygon&&!P){let A=t;!bn(A,r.getPathCount()-1)||l.getAccelerators()!==null&&l.getAccelerators().getQuadTree()!==null?p=t:(A.copyTo(_),_.getImpl().buildQuadTreeAccelerator(1),p=_),P=!0}}while(c.next());if(!E&&!S)return 1;if(!I||!D){if(u===N.enumPolygon){for(let b=0,T=m.getPathCount();b<T;b++)if(!f[b]){I=!0;break}}for(let b=0,T=l.getPathCount();b<T;b++)if(!x[b]){D=!0;break}}return E&&I||S&&D||E&&S?4:S?2:3}function jx(r,t,e,s,n){let i=V.constructEmpty();r.queryEnvelope(i),i.inflateCoords(e,e);let o=new y,a=r.getImpl(),h=new lt,m=r,l=!1,u=!1,c=!1;for(let g=0;g<t.getPointCount();g++){if(t.queryXY(g,o),i.contains(o)){let d=Ue(m,o,e);if(d===1)return u=!0,4;if(d===2)return 4;c=!0}else c=!0;l||(!bn(r,t.getPointCount()-1)||a.getAccelerators()!==null&&a.getAccelerators().getQuadTree()!=null?m=r:(r.copyTo(h),h.getImpl().buildQuadTreeAccelerator(1),m=h),l=!0)}return u?c?4:2:1}function m_(r,t,e,s,n){s[0]=!1;let i=r.getImpl(),o=t.getImpl(),a=i.querySegmentIterator(),h=o.querySegmentIterator(),m=[0,0],l=[0,0],u=new qe(i,o,e),c=!1;for(;u.next();){let g=u.getRedElement(),d=u.getBlueElement();a.resetToVertex(g,-1),h.resetToVertex(d,-1);let _=a.nextSegment(),p=h.nextSegment(),f=0;if(Di(_,p)?!c&&p.isIntersecting(_,e)&&(c=!0):f=p.intersect(_,null,l,m,e),f!==0&&(c=!0,f===1)){let x=m[0],C=l[0];if(x>0&&x<1&&C>0&&C<1)return s[0]=!0,!1}}if(!c){s[0]=!0;let g=V.constructEmpty();r.queryEnvelope(g),g.inflateCoords(e,e);let d=new lt,_=r,p=!1;for(let S=0,I=t.getPathCount();S<I;S++)if(t.getPathSize(S)>0){let D=V.constructEmpty();if(t.queryPathEnvelope(S,D),!g.isIntersecting(D))return!1;{let b=ca(_,t.getXY(t.getPathStart(S)),0);if(w(b!==-1),b===0)return!1}p||(!bn(r,t.getPathCount()-1)||i.getAccelerators()!==null&&i.getAccelerators().getQuadTree()!==null?_=r:(r.copyTo(d),d.getImpl().buildQuadTreeAccelerator(1),_=d),p=!0)}if(r.getPathCount()===1||t.getGeometryType()===N.enumPolyline)return!0;let f=t,x=V.constructEmpty();f.queryEnvelope(x),x.inflateCoords(e,e);let C=new lt,P=f,E=!1;for(let S=0,I=r.getPathCount();S<I;S++)if(r.getPathSize(S)>0){let D=V.constructEmpty();if(r.queryPathEnvelope(S,D),x.isIntersecting(D)){let b=ca(P,r.getXY(r.getPathStart(S)),0);if(w(b!==-1),b===1)return!1}E||(!bn(f,r.getPathCount()-1)||o.getAccelerators()!==null&&o.getAccelerators().getQuadTree()!==null?P=f:(f.copyTo(C),C.getImpl().buildQuadTreeAccelerator(1),P=C),E=!0)}return!0}return!1}function ee(r,t,e){let s=V.constructEmpty();return s.setCoords({env2D:r}),s.inflateCoords(e,e),s.containsEnvelope(t)}function Na(r,t,e){let s=V.constructEmpty();return s.setCoords({env2D:t}),s.inflateCoords(e,e),r.containsExclusiveEnvelope(s)}function Yr(r,t,e){let s=V.constructEmpty();return s.setCoords({env2D:t}),s.inflateCoords(e,e),!s.contains(r.getLowerLeft())||!s.contains(r.getLowerRight())||!s.contains(r.getUpperLeft())||!s.contains(r.getUpperRight())}function l_(r,t,e,s){if(r.getPathCount()!==t.getPathCount()||r.getPointCount()!==t.getPointCount())return!1;if(r.hasNonLinearSegments()||t.hasNonLinearSegments())return r.equals(t);let n=new y,i=new y,o=!0,a=e*e;for(let h=0;h<r.getPathCount();h++){if(r.getPathEnd(h)!==t.getPathEnd(h)){o=!1;break}for(let m=r.getPathStart(h);m<t.getPathEnd(h);m++)if(r.queryXY(m,n),t.queryXY(m,i),y.sqrDistance(n,i)>a){o=!1;break}if(!o)break}return!!o}function Zx(r,t,e,s){if(r.getPointCount()!==t.getPointCount())return!1;let n=new y,i=new y,o=!0,a=e*e;for(let h=0;h<r.getPointCount();h++)if(r.queryXY(h,n),t.queryXY(h,i),y.sqrDistance(n,i)>a){o=!1;break}return!!o}function Ol(r,t,e,s,n,i,o){let a=r.getImpl(),h=t.getImpl(),m=a.getPointCount(),l=h.getPointCount(),u=Z(m,!1),c=n||i?Z(l,!1):[],g=e*e,d=new qe(a,h,e);for(;d.next();){let C=d.getRedElement(),P=d.getBlueElement(),E=a.getXY(C),S=h.getXY(P);y.sqrDistance(E,S)<=g&&(u[C]=!0,(n||i)&&(c[P]=!0))}let _=!1,p=!1;for(let C=0;C<m;C++){let P=u[C];if(_||=!P,p||=P,(n||s)&&_)return!1}if(s)return!0;let f=!1,x=!1;for(let C=0;C<l;C++){let P=c[C];if(f||=!P,x||=P,n&&f)return!1}return!!n||_&&p&&f&&x}function u_(r,t,e,s){return Un(r,t,e,s)&&Un(t,r,e,s)}function Un(r,t,e,s){if(rn(r),rn(t),t.isEmpty())return!1;let n=!0,i=Z(2,Number.NaN),o=Z(2,Number.NaN),a=[],h=new ml,m,l=V.constructEmpty(),u=V.constructEmpty(),c=V.constructEmpty();r.queryEnvelope(l),t.queryEnvelope(u),l.inflateCoords(e,e),u.inflateCoords(e,e),c.setCoords({env2D:l}),c.intersect(u);let g=r.getImpl().querySegmentIterator(),d=t.getImpl().querySegmentIterator(),_=t.getImpl().getAccelerators(),p=null,f=null,x=null,C=null;if(_!==null&&(p=_.getQuadTree(),f=_.getQuadTreeForPaths(),f!==null&&(C=f.getIteratorForQT())),p===null){let P=r.getPointCount(),E=t.getPointCount();P>10&&E>10&&(p=cn(t.getImpl(),c))}for(p!==null&&(x=p.getIteratorForQT());g.nextPath();)for(;g.hasNextSegment();){let P=g.nextSegment();if(P.queryEnvelope(l),!l.isIntersecting(c))return n=!1,!1;if(C!==null&&(C.resetIterator(l,e),C.next()===-1))continue;let E=0,S=null;if(x!=null)x.resetIterator(P,e);else if(d.resetToFirstPath(),!d.nextPath())return n=!1,!1;do if(E=0,x!==null){let M=x.next();if(M===-1)return n=!1,!1;d.resetToVertex(p.getElement(M),-1),S=d.nextSegment(),E=P.intersect(S,null,i,o,e)}else{for(;!d.hasNextSegment();)if(!d.nextPath())return n=!1,!1;S=d.nextSegment(),S.queryEnvelope(u),u.inflateCoords(e,e),l.isIntersecting(u)&&(E=P.intersect(S,null,i,o,e))}while(E!==2||i[0]!==0||s&&!(o[0]<=o[1]));let I=Number.NaN,D=!1;do{let M=!1;if(i[1]===1){if(!g.hasNextSegment()){D=!0;break}P=g.nextSegment(),M=!0}if(o[1]===1&&o[0]<=o[1]){if(I===-1||(I=1,!d.hasNextSegment()))break;S=d.nextSegment(),M=!0}if(o[1]===0&&o[0]>o[1]){if(I===1)break;if(Number.isNaN(I)){if(!d.hasPreviousSegment())break;d.previousSegment(),I=-1}if(!d.hasPreviousSegment())break;S=d.previousSegment(),M=!0}if(!M)break;E=P.intersect(S,null,i,o,e)}while(E===2&&(!s||o[0]<=o[1]));if(D)continue;let b=P.calculateLength2D();P.queryEnvelope(l),a.length=0,h.m_overlapEvents.length=0;let T=!1,A=!1,G=0,F=un(null,l,!0);for(x!==null?x.resetIterator(P,e):(d.resetToFirstPath(),d.nextPath()||j("relational_operations"));;){if(E=0,x!==null){let M=x.next();if(M===-1)break;d.resetToVertex(p.getElement(M),-1),S=d.nextSegment(),E=P.intersect(S,null,i,o,e)}else{for(;!d.hasNextSegment()&&d.nextPath(););if(!d.hasNextSegment())break;S=d.nextSegment(),S.queryEnvelope(u),u.inflateCoords(e,e),l.isIntersecting(u)&&(E=P.intersect(S,null,i,o,e))}if(E===2&&(!s||o[0]<=o[1])){let M=g.getStartPointIndex(),q=g.getPathIndex(),R=d.getStartPointIndex(),X=d.getPathIndex();if(m=ny(M,q,i[0],i[1],R,X,o[0],o[1]),h.m_overlapEvents.push(m),a.push(a.length),!(T||m.m_scalarA0<G&&m.m_scalarA1<G)){if(G===0&&b*(m.m_scalarA0-G)>e)T=!0;else if(G!==0&&b*(m.m_scalarA0-G)>F)T=!0;else if(G=m.m_scalarA1,b*(1-G)<=e||G===1){A=!0;break}}}}if(!A){if(!T)return n=!1,!1;a.length>1&&a.sort((M,q)=>h.compareOverlapEvents(M,q)),G=0;for(let M=0;M<h.m_overlapEvents.length;M++)if(m=h.m_overlapEvents[a[M]],!(m.m_scalarA0<G&&m.m_scalarA1<G)){if(G===0&&b*(m.m_scalarA0-G)>e||G!==0&&b*(m.m_scalarA0-G)>F)return n=!1,!1;if(G=m.m_scalarA1,b*(1-G)<=e||G===1)break}if(b*(1-G)>e)return n=!1,!1;a.length=0,h.m_overlapEvents.length=0}}return n}function c_(r,t,e){let s=r.getImpl(),n=t.getImpl(),i=s.querySegmentIterator(),o=n.querySegmentIterator(),a=new qe(s,n,e);for(;a.next();){let h=a.getRedElement(),m=a.getBlueElement();i.resetToVertex(h,-1),o.resetToVertex(m,-1);let l=i.nextSegment();if(o.nextSegment().isIntersecting(l,e))return!0}return!1}function Wl(r,t,e,s){let n=r.getImpl(),i=t.getImpl(),o=n.querySegmentIterator(),a=i.querySegmentIterator(),h=Z(2,Number.NaN),m=new qe(n,i,e),l=!1,u=-1;for(;m.next();){let c=m.getRedElement(),g=m.getBlueElement();o.resetToVertex(c,-1),a.resetToVertex(g,-1);let d=o.nextSegment(),_=a.nextSegment(),p=0;if(Di(d,_)){if(_.isIntersecting(d,e))return-2}else p=d.intersect(_,null,h,null,e);if(p){if(p===2){let f=d.calculateLength2D(),x=h[0];if(f*(h[1]-x)>e)return u=1,u;l=!0}else if(u=0,s){let f=h[0],x=new y;d.queryCoord2D(f,x),s.push(x.x),s.push(x.y)}}}return l?-2:u}function g_(r,t,e,s){let n=r.getImpl(),i=t,o=i.getPointCount(),a=s?Z(o,!1):[],h=new qe(n,i,e,!1),m=n.querySegmentIterator();for(;h.next();){let l=h.getRedElement(),u=h.getBlueElement();m.resetToVertex(l,-1);let c=m.nextSegment(),g=i.getXY(u);if(c.isIntersectingPoint(g,e)){if(!s)return!0;a[u]=!0}}if(!s)return!1;for(let l=0;l<o;l++)if(!a[l])return!1;return!0}function d_(r,t,e){let s=new y,n=e*e,i=r.querySegmentIterator(),o=r.getImpl().getAccelerators();if(o!==null){let h=o.getQuadTree();if(h!==null){let m=V.constructEmpty();m.setCoords({pt:t});let l=h.getIterator(m,e);for(let u=l.next();u!==-1;u=l.next())if(i.resetToVertex(h.getElement(u),-1),i.hasNextSegment()){let c=i.nextSegment(),g=c.getClosestCoordinate(t,!1);if(c.queryCoord2D(g,s),y.sqrDistance(t,s)<=n)return!0}return!1}}let a=V.constructEmpty();for(;i.nextPath();)for(;i.hasNextSegment();){let h=i.nextSegment();if(h.queryEnvelope(a),a.inflateCoords(e,e),!a.contains(t))continue;let m=h.getClosestCoordinate(t,!1);if(h.queryCoord2D(m,s),y.sqrDistance(t,s)<=n)return!0}return!1}function Qx(r,t,e){return d_(r,t,e)&&!P_(r,t,e)}function __(r,t,e,s){let n=r.querySegmentIterator(),i=r.getImpl().getAccelerators(),o=r.hasNonLinearSegments(),a=null,h=null,m=null,l=null;if(i!==null){let u=i.getQuadTree();if(u!==null){let c=u.getIterator(t,e);o&&(a=new nt,h=new nt,m=new nt,l=new nt,t.querySide(0,a),t.querySide(1,h),t.querySide(2,m),t.querySide(3,l));let g=V.constructEmpty();g.setCoords({env2D:t}),g.inflateCoords(e,e);for(let d=c.next();d!==-1;d=c.next())if(n.resetToVertex(u.getElement(d),-1),n.hasNextSegment()){let _=n.nextSegment();if(_.getGeometryType()===N.enumLine){let p=_.getStartXY(),f=_.getEndXY();if(g.clipLine(p,f))return!0;continue}if(t.contains(_.getStartXY())||t.contains(_.getEndXY())||_.isIntersecting(a,e)||_.isIntersecting(h,e)||_.isIntersecting(m,e)||_.isIntersecting(l,e))return!0}return!1}}if(o){a=new nt,h=new nt,m=new nt,l=new nt,t.querySide(0,a),t.querySide(1,h),t.querySide(2,m),t.querySide(3,l);let u=r.querySegmentIterator();for(;u.nextPath();)for(;u.hasNextSegment();){let c=u.nextSegment();if(t.contains(c.getStartXY())||t.contains(c.getEndXY())||c.isIntersecting(a,e)||c.isIntersecting(h,e)||c.isIntersecting(m,e)||c.isIntersecting(l,e))return!0}}else{let u=V.constructEmpty();u.setCoords({env2D:t}),u.inflateCoords(e,e);let c=r.getImpl(),g=c.getAttributeStreamRef(0),d=new y;for(let _=0,p=c.getPathCount();_<p;_++){let f=!0,x=new y,C=new y,P=new y,E=c.getPathStart(_),S=new y;for(let I=E,D=c.getPathEnd(_);I<D;I++)if(f)g.queryPoint2D(2*I,x),S.assign(x),f=!1;else{if(g.queryPoint2D(2*I,d),C.setCoordsPoint2D(x),P.setCoordsPoint2D(d),u.clipLine(C,P))return!0;x.assign(d)}if(c.isClosedPath(_)&&!f&&(C.setCoordsPoint2D(x),P.setCoordsPoint2D(S),u.clipLine(C,P)))return!0}}return!1}function p_(r,t,e,s){let n=r.getImpl(),i=t.getImpl(),o=[0],a=Rs(n.getIsSimple(0,o))&&Rs(i.getIsSimple(0,o)),h=n.querySegmentIterator(),m=i.querySegmentIterator(),l=Z(2,0),u=Z(2,0),c=new qe(n,i,e),g=!1;for(;c.next();){let C=c.getRedElement(),P=c.getBlueElement();h.resetToVertex(C,-1),m.resetToVertex(P,-1);let E=h.nextSegment(),S=m.nextSegment(),I=0;if(Di(E,S)){if(S.isIntersecting(E,e)){g=!0;break}}else I=S.intersect(E,null,u,l,e);if(I===2){let D=l[0],b=l[1],T=E.calculateLength2D();if(a&&(b-D)*T>e)return!1;g=!0}else if(I){let D=l[0],b=u[0];if(D>0&&D<1&&b>0&&b<1)return!1;g=!0}}if(!g)return!1;let d=V.constructEmpty(),_=V.constructEmpty(),p=V.constructEmpty(),f,x;if(r.queryEnvelope(d),t.queryEnvelope(_),d.inflateCoords(1e3*e,1e3*e),_.inflateCoords(1e3*e,1e3*e),p.setCoords({env2D:d}),p.intersect(_),r.getPointCount()>10){if(f=St(r,p,e,0,s),f.isEmpty())return!1}else f=r;if(t.getPointCount()>10){if(x=St(t,p,e,0,s),x.isEmpty())return!1}else x=t;return vs(f,x,e,"F********",s,!1)}function f_(r,t,e,s){let n=r.getImpl(),i=t.getImpl(),o=[0],a=Rs(n.getIsSimple(0,o))&&Rs(i.getIsSimple(0,o)),h=V.constructEmpty(),m=V.constructEmpty(),l=V.constructEmpty();r.queryEnvelope(h),t.queryEnvelope(m);let u=!1,c=Yr(h,m,e),g=Yr(m,h,e),d=n.querySegmentIterator(),_=i.querySegmentIterator(),p=Z(2,Number.NaN),f=Z(2,Number.NaN),x=new qe(n,i,e);for(;x.next();){let D=x.getRedElement(),b=x.getBlueElement();d.resetToVertex(D,-1),_.resetToVertex(b,-1);let T=d.nextSegment(),A=_.nextSegment(),G=0;if(Di(T,A)){if(A.isIntersecting(T,e))break}else G=A.intersect(T,null,f,p,e);if(G===2){let F=p[0],M=p[1],q=T.calculateLength2D();if(a&&(M-F)*q>e&&(u=!0,c&&g))return!0}else if(G){let F=p[0],M=f[0];if(F>0&&F<1&&M>0&&M<1)return!0}}let C=V.constructEmpty(),P=V.constructEmpty(),E,S;C.setCoords({env2D:h}),C.inflateCoords(1e3*e,1e3*e),P.setCoords({env2D:m}),P.inflateCoords(1e3*e,1e3*e),l.setCoords({env2D:C}),l.intersect(P);let I="";if(I+=u?"**":"T*",c){if(t.getPointCount()>10){if(S=St(t,l,e,0,s),S.isEmpty())return!1}else S=t;I+="****"}else S=t,I+="T***";if(g){if(r.getPointCount()>10){if(E=St(r,l,e,0,s),E.isEmpty())return!1}else E=r;I+="***"}else E=r,I+="T**";return vs(E,S,e,I,s,!1)}function x_(r,t,e,s){let n=[!1],i=m_(r,t,e,n);if(n[0])return i;let o=V.constructEmpty(),a;if(t.queryEnvelope(o),o.inflateCoords(1e3*e,1e3*e),r.getPointCount()>10){if(a=St(r,o,e,0,s),a.isEmpty())return!1}else a=r;return M1(a,t,e,s)}function Kx(r,t,e,s){let n=r.getImpl(),i=t.getImpl(),o=n.querySegmentIterator(),a=i.querySegmentIterator(),h=Z(2,Number.NaN),m=Z(2,Number.NaN),l=new qe(n,i,e),u=!1;for(;l.next();){let f=l.getRedElement(),x=l.getBlueElement();o.resetToVertex(f,-1),a.resetToVertex(x,-1);let C=o.nextSegment(),P=a.nextSegment(),E=0;if(Di(C,P)?!u&&P.isIntersecting(C,e)&&(u=!0):E=P.intersect(C,null,m,h,e),E===2)u=!0;else if(E){let S=h[0],I=m[0];if(S>0&&S<1&&I>0&&I<1)return!1;u=!0}}if(!u)return!1;let c=V.constructEmpty(),g=V.constructEmpty(),d=V.constructEmpty(),_,p;if(r.queryEnvelope(c),t.queryEnvelope(g),c.inflateCoords(1e3*e,1e3*e),g.inflateCoords(1e3*e,1e3*e),d.setCoords({env2D:c}),d.intersect(g),r.getPointCount()>10){if(_=St(r,d,e,0,s),_.isEmpty())return!1}else _=r;if(t.getPointCount()>10){if(p=St(t,d,e,0,s),p.isEmpty())return!1}else p=t;return vs(_,p,e,"F********",s,!1)}function $x(r,t,e,s){let n=r.getImpl(),i=t.getImpl(),o=n.querySegmentIterator(),a=i.querySegmentIterator(),h=Z(2,Number.NaN),m=Z(2,Number.NaN),l=new qe(n,i,e),u=!1;for(;l.next();){let f=l.getRedElement(),x=l.getBlueElement();o.resetToVertex(f,-1),a.resetToVertex(x,-1);let C=o.nextSegment(),P=a.nextSegment(),E=0;if(Di(C,P)?!u&&P.isIntersecting(C,e)&&(u=!0):E=P.intersect(C,null,m,h,e),E===2)u=!0;else if(E){let S=h[0],I=m[0];if(S>0&&S<1&&I>0&&I<1)return!0;u=!0}}if(!u)return!1;let c=V.constructEmpty(),g=V.constructEmpty(),d=V.constructEmpty(),_=V.constructEmpty(),p=V.constructEmpty();if(r.queryEnvelope(c),t.queryEnvelope(g),Yr(g,c,e)){let f,x;if(d.setCoords({env2D:c}),d.inflateCoords(1e3*e,1e3*e),_.setCoords({env2D:g}),_.inflateCoords(1e3*e,1e3*e),p.setCoords({env2D:d}),p.intersect(_),r.getPointCount()>10){if(f=St(r,p,e,0,s),f.isEmpty())return!1}else f=r;if(t.getPointCount()>10){if(x=St(t,p,e,0,s),x.isEmpty())return!1}else x=t;return vs(f,x,e,"T********",s,!1)}return vs(r,t,e,"T*****T**",s,!1)}function Jx(r,t,e,s){let n=[!1],i=m_(r,t,e,n);if(n[0])return i;let o=V.constructEmpty(),a;if(t.queryEnvelope(o),o.inflateCoords(1e3*e,1e3*e),r.getPointCount()>10){if(a=St(r,o,e,0,s),a.isEmpty())return!1}else a=r;return G1(a,t,e,s)}function ty(r,t,e,s){return Ue(r,t,e)===1}function ey(r,t,e,s){return Ue(r,t,e)===2}function y_(r,t,e,s){let n=new y,i=e*e;for(let o=0;o<r.getPointCount();o++)if(r.queryXY(o,n),y.sqrDistance(n,t)<=i)return!1;return!0}function P_(r,t,e){let s=r.getBoundary();return!s.isEmpty()&&!y_(s,t,e)}function sy(r,t,e){let s=V.constructEmpty();return s.setCoords({env2D:r}),s.inflateCoords(e,e),s.containsEnvelope(t)?1073741824:s.isIntersecting(t)?r.isIntersecting(t)?r.xmin<t.xmin&&t.xmax<r.xmax?t.ymin<r.ymin&&t.ymax>r.ymax?0:1073741824:r.ymin<t.ymin&&t.ymax<r.ymax?t.xmin<r.xmin&&t.xmax>r.xmax?0:1073741824:0:0:4}function Di(r,t){return r.getGeometryType()!==N.enumLine||t.getGeometryType()!==N.enumLine}function ny(r,t,e,s,n,i,o,a){return{m_ivertexA:r,m_ipathA:t,m_scalarA0:e,m_scalarA1:s,m_ivertexB:n,m_ipathB:i,m_scalarB0:o,m_scalarB1:a}}var ml=class{constructor(){this.m_overlapEvents=[]}compareOverlapEvents(t,e){let s=this.m_overlapEvents[t],n=this.m_overlapEvents[e];return s.m_ipathA<n.m_ipathA||s.m_ipathA===n.m_ipathA&&(s.m_ivertexA<n.m_ivertexA||s.m_ivertexA===n.m_ivertexA&&(s.m_scalarA0<n.m_scalarA0||s.m_scalarA0===n.m_scalarA0&&(s.m_scalarA1<n.m_scalarA1||s.m_scalarA1===n.m_scalarA1&&s.m_ivertexB<n.m_ivertexB)))?-1:1}};function C_(r,t,e){let s=T1(r,t,e);return s?s===1?1:2:0}function Ue(r,t,e){let s=ca(r,t,e);return s?s===1?1:2:0}function iy(r,t,e,s,n){for(let i=0;i<e;i++)n[i]=Ue(r,t[i],s)}function E_(r,t,e,s,n){if(r.getGeometryType()===N.enumPolygon)iy(r,t,e,s,n);else if(r.getGeometryType()===N.enumEnvelope){let i=V.constructEmpty();r.queryEnvelope(i),ry(i,t,e,s,n)}else re("")}function S_(r,t,e,s,n){let i=r.getGeometryType();i===N.enumPolyline?hy(r,t,e,s,n):Qt(i)?ay():re("")}function ry(r,t,e,s,n){if(r.isEmpty()){for(let a=0;a<e;a++)n[a]=0;return}let i=r.clone();i.inflateCoords(.5*-s,.5*-s);let o=r.clone();o.inflateCoords(.5*s,.5*s);for(let a=0;a<e;a++)i.contains(t[a])?n[a]=1:o.contains(t[a])?n[a]=2:n[a]=0}function JE(r){if(r.isEmpty())return 0;switch(r.getGeometryType()){case N.enumMultiPoint:return r.getImpl().getPointCount();case N.enumPolyline:return r.getImpl().getPathCount();case N.enumPolygon:return r.getImpl().getOGCPolygonCount();case N.enumGeometryCollection:return r.getGeometryCount()}return 1}function oy(r,t,e){if(e.reset(),t<3)return;let s=r[0].clone(),n=s.x,i=s.y,o=r[1].clone(),a=new y;for(let h=2;h<t;h++)a.assign(r[h]),e.pe((a.x-s.x)*(o.y-i)),s.assign(o),o.assign(a);e.pe((n-s.x)*(o.y-i))}function ay(r,t,e,s,n){w(0)}function hy(r,t,e,s,n){let i=r.getImpl(),o=i.getAccelerators(),a=null;o&&(a=o.getRasterizedGeometry());let h=e;for(let m=0;m<e;m++)n[m]=1,a&&w(0);if(h){if(o){let l=null;o!==null&&o.getQuadTree()!==null&&(l=o.getQuadTree());let u=i.getPointCount();if(l===null&&u>20&&u*e>4*u+Math.log(u)*e&&(l=cn(i)),l){let c=null,g=i.querySegmentIterator(),d=new V;for(let _=0;_<e&&h;_++)if(n[_]===1){d.setCoords(t[_]),c===null?c=l.getIterator(d,s):c.resetIterator(d,s);let p=-1;for(let f=c.next();f!==-1;f=c.next()){if(g.resetToVertex(l.getElement(f),p),p=g.getPathIndex(),g.nextSegment().isIntersectingPoint(t[_],s)){n[_]=2,h--;break}n[_]=0}}return}}let m=i.querySegmentIterator();for(;m.nextPath()&&h;)for(;m.hasNextSegment()&&h;){let l=m.nextSegment();for(let u=0;u<e&&h;u++)n[u]===1&&l.isIntersectingPoint(t[u],s)&&(n[u]=2,h--)}}for(let m=0;m<e;m++)n[m]===1&&(n[m]=0)}function my(r,t,e,s,n){let i=Ts(t),o=Math.max(4*i,e);return new ll(t,null,o,Number.NaN,n).approximateWithCirclesImpl(r,s)}function ly(){return Number.isNaN(this.radius.value())}function uy(){return{ptStart:new y,ptEnd:new y,center:new $,radius:new H,fcenter:new Dt,fradius2:new J,maxError:Number.NaN,isLine:ly}}var cy=5,gy=1/8;function Mr(r,t,e,s){return{pt:r.clone(),t,err:e,checkCount:s}}var ll=class r{constructor(t,e,s,n,i){this.m_left=t,this.m_tracker=i,this.m_eps=s,this.m_trackerCounter=0,this.m_tolerance=n,this.m_circleCheckCounter=0,this.m_bReversedLeft=!1,this.m_leftArc=uy()}closeToCircularArc(t,e,s,n,i,o){if(this.m_circleCheckCounter++,o.maxError=0,!r.checkSweepAngle(t,e))return!1;if(o.ptStart.setCoordsPoint2D(s),o.ptEnd.setCoordsPoint2D(i),t.isCircular()){let E=t;return o.fradius2=J.constructDouble(E.getSemiMajorAxis()).mulDouble(E.getSemiMajorAxis()),o.radius.set(E.getSemiMajorAxis()),o.fcenter.assignPoint2D(E.getCenter()),o.center.set(E.getCenter()),!0}let a=o.ptEnd.sub(o.ptStart).clone();if(a.leftPerpendicularThis(),a.normalize(),Math.abs(a.dotProduct(n.sub(o.ptStart)))<=this.m_eps)return!!this.confirmIsLine(o,a)&&(o.radius.set(Number.NaN),o.center.setCoords(0,0),!0);{let E=o.ptEnd.sub(o.ptStart),S=n.sub(o.ptStart),I=E.crossProduct(S);if(I===0)return!1;let D=.5*E.sqrLength(),b=.5*S.sqrLength(),T=D*S.y-b*E.y;T/=I;let A=E.x*b-S.x*D;A/=I;let G=Math.sqrt(T*T+A*A);if(4*Number.EPSILON*G>this.m_eps)return!1;let F=T+o.ptStart.x,M=A+o.ptStart.y;o.radius.set(G),o.center.setCoords(F,M);let q=this.maxCircleApproximationError(t,e,o);if(q>this.m_eps)return o.maxError=q,!1}let h=new Dt().assignPoint2D(o.ptStart),m=new Dt().assignPoint2D(o.ptEnd).sub(h),l=new Dt().assignPoint2D(n).sub(h),u=m.crossProduct(l);if(u.isZero())return!1;let c=m.sqrLength().mulDouble(.5),g=l.sqrLength().mulDouble(.5),d=c.mul(l.y).sub(g.mul(m.y)),_=m.x.mul(g).sub(l.x.mul(c)),p=d.mul(d).add(_.mul(_)),f=u.clone();f.invertThis(),o.fradius2=p.mul(f).mul(f),o.fcenter.setCoords(d.mul(f).add(h.x),_.mul(f).add(h.y)),o.center.setWithEps(o.fcenter.asPoint2D()),o.radius.setWithEps(Math.sqrt(o.fradius2.toDouble()));let x=$.constructPoint2D(o.ptStart).subE(o.center),C=$.constructPoint2D(o.ptEnd).subE(o.center);if(!x.dotProduct(C).gt(on))return!1;let P=this.maxCircleApproximationError(t,e,o);return o.maxError=P,P<=this.m_eps}static checkSweepAngle(t,e){if(t.getGeometryType()===N.enumEllipticArc){let s=t,n=as(s,e.vmin),i=as(s,e.vmax);return!(Math.abs(i-n)>.5*ut)}return!0}confirmIsLine(t,e){let s=t.ptEnd.sub(t.ptStart);return!(Math.abs(e.dotProduct(s.mul(.25)))>this.m_eps)&&!(Math.abs(e.dotProduct(s.mul(.75)))>this.m_eps)}maxCircleApproximationError(t,e,s){let n=[.25,.75],i=[.1,.25,.75,.9],o,a;t.getGeometryType()===N.enumEllipticArc?(o=n,a=n.length):(o=i,a=i.length);let h=0;for(let m=0;m<a;++m){let l=new y;t.queryCoord2D(pt(e.vmin,e.vmax,o[m]),l);let u=l.sub(s.center.value()).length(),c=Math.abs(u-s.radius.value());c>h&&(h=c)}return h}approximateWithCirclesImpl(t,e){let s=1;e&&e.push(0);let n=Z(9,Number.NaN),i;t?i=this.m_left.getMonotonicPartParams(n.length,n):(n[0]=0,n[1]=1,i=2);let o=[],a=[],h=new y(0,0);for(let m=1;m<i;m++){let l=new B(n[m-1],n[m]);for(this.m_bReversedLeft=!r.goodOrientation(this.m_left,l),this.m_bReversedLeft?(o.push(Mr(h,l.vmin,0,0)),o.push(Mr(h,l.vmax,0,0))):(o.push(Mr(h,l.vmax,0,0)),o.push(Mr(h,l.vmin,0,0))),o[0].pt=this.m_left.getCoord2D(o[0].t),o[1].pt=this.m_left.getCoord2D(o[1].t);o.length>1;){this.progress_();let u=o.at(-1),c=u.checkCount,g=u.err,d=u.pt.clone(),_=u.t,p=o[o.length-2].t,f=.5*(_+p),x=this.m_left.getCoord2D(f);if(g<=this.m_eps||c>=cy){let C=new B;if(C.setCoords(_,p),this.closeToCircularArc(this.m_left,C,d,x,o[o.length-2].pt,this.m_leftArc)){e&&(this.m_bReversedLeft?a.push(_):e.push(p)),s++,o.pop();continue}c=0,g=this.m_leftArc.maxError}u.t=f,u.pt.setCoordsPoint2D(x),g*=gy,c++,u.err=g,u.checkCount=c,o.push(Mr(d,_,g,c))}this.m_bReversedLeft&&e&&(e.length=e.length+a.length,ye(e,a.reverse(),e.length-a.length,0,a.length),a.length=0),o.length=0}return s}approximateWithCirclesImplPolyline(t){let e=new dt,s=[];if(!this.approximateWithCirclesImpl(!0,s))return e;let n=0,i=this.m_left.getStartXY();e.startPath(i);for(let o=1;o<s.length;++o)if(t)e.lineTo(this.m_left.getCoord2D(s[o]));else{let a=new y;this.m_left.queryCoord2D(s[o],a);let h=new y;this.m_left.queryCoord2D(.5*(s[o]+n),h);let m=new je;m.constructCircularArcThreePoint(i,a,h),e.addSegment(m,!1),i.assign(a),n=s[o]}return e}static goodOrientation(t,e){let s=t.getCoord2D(e.vmin),n=t.getCoord2D(e.vmax);return s.compare(n)<0}progress_(t=!1){}};function Ss(r,t,e,s,n,i,o){dy(r,t,e,n,i,o)}function tS(r,t,e,s){if(!at(r.getGeometryType()))return r;let n=r.getImpl();if(!n.hasNonLinearSegments())return r;let i=r.createInstance();i.getGeometryType()===N.enumPolygon&&i.setFillRule(r.getFillRule()),new Nt;let o=new st,a=new et,h=[],m=[],l=[],u=r.getDescription().getAttributeCount()>1,c=n.querySegmentIterator();for(;c.nextPath();){let g=!0;for(;c.hasNextSegment();){let d=c.isClosingSegment(),_=c.nextSegment();if(!_.isCurve()){i.addSegment(_,g,d),g=!1;continue}let p,f=!1,x=!0,C=!0;switch(_.getGeometryType()){case N.enumEllipticArc:case N.enumRationalBezier2:p=Er(_,t,e,x,C,m,l,h),f=!0;break;default:p=Tr(_,t,e,!0,x,m,h)}let P=f?2:3;m[1].isNAN()?(a.createLine(),a.get().construct(m[0],m[P])):f?(a.createQuadraticRationalBezier(),a.get().constructArrayWeights(m,l)):(a.createCubicBezier(),a.get().constructPoints(m)),u&&g&&(_.queryCoord(h[0],o),a.get().setStart(o)),u&&(_.queryCoord(h[1],o),a.get().setEnd(o)),i.addSegment(a.get(),g,d&&p===1),g=!1;for(let E=1,S=p,I=P;E<S;++E,I+=P)m[I+1].isNAN()?(a.createLine(),a.get().construct(m[I],m[I+P])):f?(a.createQuadraticRationalBezier(),a.get().constructArrayWeights(m.slice(I),l.slice(I))):(a.createCubicBezier(),a.get().constructPoints(m.slice(I))),u&&(_.queryCoord(h[E+1],o),a.get().setEnd(o)),i.addSegment(a.get(),!1,d&&E+1===S)}}return i}function dy(r,t,e,s,n,i){r.hasCurves()?(r.setCurveStitcherPointer(s),s.m_impl=new pa(i,!1,null),s.m_impl.buildMonotonicCurveParentage(r,t,e,n)):s.m_impl=null}function _y(r,t,e,s,n,i,o,a){r.hasCurves()?(r.setCurveStitcherPointer(i),i.m_impl=new pa(a,!0,n),i.m_impl.buildMonotonicCurveParentage(r,t,e,o),Py(r,e,a)):i.m_impl=null}function py(r){if(!r.hasSegmentParentage())return;let t=new he(0),e=r.queryVertexIteratorOnSelection();for(let o=e.next();o!==v;o=e.next())t.add(o);if(t.size()===0)return;r.sortVerticesSimpleByY(t,0,t.size()),t.add(v);let s=y.getNAN();r.queryXY(t.read(0),s);let n=0,i=y.getNAN();for(let o=1,a=t.size();o<a;o++){{let h=t.read(o);h!==v?r.queryXY(h,i):i.setNAN()}if(!i.isEqualPoint2D(s)){let h=!1,m=-2;for(let l=n;l<o;++l){let u=t.read(l);if(r.getSegmentParentageBreakVertex(u)){h=!0;break}let c=r.getSegmentParentage(u),g=r.getPrevVertex(u);if(g!==v){let d=r.getSegmentParentage(g);if(c===-1&&(c=d),d===-1&&(d=c),c!==d){h=!0;break}}if(m!==-2&&c!==m){h=!0;break}m=c}if(h)for(let l=n;l<o;++l)r.setSegmentParentageBreakVertex(t.read(l),!0);s.setCoordsPoint2D(i),n=o}}}function fy(r,t){let e=t.isEmpty()?r:Wt(null,t,!0).total();return e>r&&(e=r),.125*e}function us(r,t){return t||(t=V.constructEmpty()),fy(r,t)}function zs(r,t){return .125*r}function Os(r,t){return 3*r+3*t}var Be=class{constructor(){this.m_impl=null}stitchCurves(t,e,s,n){this.m_impl&&(this.m_impl.stitchCurves(t,e,s),n&&this.clearStitcher(t))}clearStitcher(t){this.m_impl&&(this.m_impl.clearStitcher(t),this.m_impl=null)}getOriginalVertexIndex(t,e){return this.m_impl.getOriginalVertexIndex(t,e)}getOriginalSegmentTypeInfo(t){return this.m_impl.getOriginalSegmentTypeInfo(t)}},pa=class r{constructor(t,e,s){this.m_originalPlanarSegments=[],this.m_progressTracker=null,this.m_nsr=null,this.m_progressTracker=t,this.m_nsr=s,this.m_tolerance=0,this.m_originalVertexIndex=-1,this.m_type=0,this.m_progressCounter=0,this.m_bIsSimple=e}buildMonotonicCurveParentage(t,e,s,n){if(!t.hasCurves())return;w(!t.hasSegmentParentage()),this.m_type=1,this.m_originalPlanarSegments.length=0,this.m_bIsSimple&&(this.m_originalVertexIndex=t.createUserIndex()),this.m_tolerance=s;let a=new st,h=new et,m=[],l=[],u=[];for(let c=t.getFirstGeometry();c!==v;c=t.getNextGeometry(c))for(let g=t.getFirstPath(c);g!==v;g=t.getNextPath(g)){let d=t.getPathSize(g),_=t.getFirstVertex(g),p=0,f=-1;for(let x=0;x<d;x++){let C=t.getNextVertex(_);if(!t.querySegment(_,h,!0,!1)){_=C;continue}if(p===0){f=t.getVertexIndex(_);let b=r.regularizeCurve(t,h.get(),_,s);if(b>=0){this.m_nsr&&this.m_nsr.m_reason===0&&this.m_nsr.assign(new vt(13,f,-1)),p=b,d=t.getPathSize(g),C=t.getNextVertex(_);let T=t.querySegment(_,h,!0,!1);w(T)}}else p--;let P=t.getVertexIndex(_),E;this.m_originalVertexIndex!==-1&&t.setUserIndex(_,this.m_originalVertexIndex,f),t.setSegmentToIndex(P,null);let S=!1;switch(h.get().getGeometryType()){case N.enumEllipticArc:case N.enumRationalBezier2:E=Er(h.get(),e,s,!1,!0,l,u,m),S=!0;break;default:{let b=!this.m_bIsSimple||!h.get().isMonotoneQuickAndDirty();E=Tr(h.get(),e,s,b,!1,l,m)}}let I=this.m_originalPlanarSegments.length;if(t.setSegmentParentageAndBreak(_,I,!0),!l[1].isNAN()){let b=null;b=S?new _e({points:l,weights:u}):new Ge({cp:l}),b.snapControlPoints(s*s),t.setSegmentToIndex(P,b)}let D=S?2:3;for(let b=1,T=E,A=D;b<T;++b,A+=D){h.get().queryCoord(m[b],a);let G=t.insertVertex(g,C,a);if(this.m_originalVertexIndex!==-1&&t.setUserIndex(G,this.m_originalVertexIndex,f),!l[A+1].isNAN())if(S){let F=new _e({points:l.slice(A),weights:u.slice(A)});F.snapControlPoints(s*s),t.setSegmentToIndex(t.getVertexIndex(G),F)}else{let F=new Ge({cp:l.slice(A)});F.snapControlPoints(s*s),t.setSegmentToIndex(t.getVertexIndex(G),F)}t.setSegmentParentageAndBreak(G,I,!1)}E>1&&(x+=E-1,d=t.getPathSize(g)),this.m_originalPlanarSegments.push(h.releaseSegment()),_=C}}}stitchCurves(t,e,s){r.st_stitchCurvesImpl(this,t,e,s,!1)}clearStitcher(t){this.m_originalPlanarSegments.length=0,this.m_originalVertexIndex!==-1&&(t.removeUserIndex(this.m_originalVertexIndex),this.m_originalVertexIndex=-1),t.deleteSegmentParentage()}static st_verifyParentage(t){r.st_stitchCurvesImpl(null,t,v,0,!0)}getOriginalVertexIndex(t,e){return this.m_originalVertexIndex!==-1&&e!==v?t.getUserIndex(e,this.m_originalVertexIndex):-1}getOriginalSegmentTypeInfo(t){if(t!==-1){let e=this.m_originalPlanarSegments[t];switch(e.getGeometryType()){case N.enumEllipticArc:return e.projectionBehavior()===0?0:1;case N.enumBezier:return 2;case N.enumBezier2:return 3;case N.enumLine:return-1;case N.enumRationalBezier2:return 4;default:ft("")}}return-1}progress_(t=!1){this.m_progressCounter++}processSpan_(t,e,s,n,i,o,a){if(e===s&&n===0)return w(t.getNextVertex(e)===v),t.setSegmentToIndex(t.getVertexIndex(e),null),void t.setSegmentParentageAndBreak(e,-1);let h=t.getNextVertex(e);{let u=2;for(let c=h;c!==s;c=t.getNextVertex(c))u++;w(u===n)}if(i===null){t.setSegmentToIndex(t.getVertexIndex(e),null);for(let u=h;u!==s;)u=t.removeVertex(u,!0);return}let m=t.getXY(e),l=t.getXY(s);if(i.isClosed()){if(m.isEqualPoint2D(l)&&m.isEqualPoint2D(i.getStartXY())){let u;if(u=this.verifySegmentFitness(t,e,s,n,i,o,a)){let c=i.clone();return c.dropAllAttributes(),u<0&&c.reverse(),this.removeSpan(t,e,s),void t.setSegmentToIndex(t.getVertexIndex(e),c)}}}else if(m.isEqualPoint2D(i.getStartXY())){if(l.isEqualPoint2D(i.getEndXY())){let u=i.clone();if(u.dropAllAttributes(),this.verifySegmentFitness(t,e,s,n,u,o,a))return this.removeSpan(t,e,s),void t.setSegmentToIndex(t.getVertexIndex(e),u)}}else if(l.isEqualPoint2D(i.getStartXY())&&m.isEqualPoint2D(i.getEndXY())){let u=i.getReversed();if(u.dropAllAttributes(),this.verifySegmentFitness(t,e,s,n,u,o,a))return this.removeSpan(t,e,s),void t.setSegmentToIndex(t.getVertexIndex(e),u)}this.processSpanSplitSegment(t,e,s,n,i,o,a)}processSpanSplitSegment(t,e,s,n,i,o,a){if(i.isLine()||this.fitSegmentToSpan(t,e,s,n,i,o,a))return;let h=a*a,m=n,l=e,u=t.getXY(e),c=i.getClosestCoordinate(u,!1),g=i.getCoord2D(c),d=!1,_=y.sqrDistance(u,g);if(_>h){let I=t.getNextVertex(e);if(this.approximateSpanSection(t,e,i,o,a),I===s)return;l=I,d=!0,m-=1}let p=s,f=t.getXY(s);c=i.getClosestCoordinate(f,!1);let x=i.getCoord2D(c),C=!1,P=y.sqrDistance(f,x);if(P>h){let I=t.getPrevVertex(s);if(this.approximateSpanSection(t,I,i,o,a),I===l)return;p=I,C=!0,m-=1}if((d||C)&&this.fitSegmentToSpan(t,l,p,m,i,o,a))return;let E=!1;if(!d&&_>0){let I=t.getNextVertex(e);if(this.approximateSpanSection(t,e,i,o,a),I===p)return;l=I,d=!0,E=!0,m-=1}if(!C&&P>0){let I=t.getPrevVertex(s);if(this.approximateSpanSection(t,I,i,o,a),I===l)return;p=I,C=!0,E=!0,m-=1}if(E&&this.fitSegmentToSpan(t,l,p,m,i,o,a))return;let S=l;for(;;){let I=t.getNextVertex(S);if(this.approximateSpanSection(t,S,i,o,a),S=I,S===p)return}}fitSegmentToSpan(t,e,s,n,i,o,a){let h=this.m_type===0,m=[];if(m.push(t.getXY(e)),h){let c=e,g=32;if(n>g){let d=BigInt(n-1),_=BigInt(g-1),p=_,f=0n;for(let x=1;x<n;x++,p+=_)if(c=t.getNextVertex(c),p>=f+d){f+=d;let C=t.getXY(c);m.push(C)}w(c===s)}else{for(let d=1;d<n;d++){c=t.getNextVertex(c);let _=t.getXY(c);m.push(_)}w(c===s)}}else{let c=e,g=new et;for(;;){t.querySegment(c,g,!1,!0);let d=[.1,.25,.4,.5,.6,.75,.9,1],_=0;for(let p of d)(n===2||1&_)&&m.push(g.get().getCoord2D(p)),_++;if(c=t.getNextVertex(c),c===s)break}}let l=(()=>{let c=m[0].compare(m.at(-1));if(c===0){let g=new oe(0);oy(m,m.length,g),c=g.getResult()>=0?-1:1}return c>0})();l&&m.reverse();let u=i.clone();if(u.dropAllAttributes(),u.setSegmentFromCoords(m,m.length),l&&u.reverse(),u.snapControlPoints(this.m_tolerance*this.m_tolerance),this.verifySegmentFitness(t,e,s,n,u,o,a)){this.removeSpan(t,e,s);let c=t.getVertexIndex(e);return t.setSegmentToIndex(c,u),!0}return!1}approximateSpanSection(t,e,s,n,i){let o=new et;if(!t.querySegment(e,o,!0,!1))return;let a=s.getGeometryType();if(a!==o.get().getGeometryType()){if(a===N.enumEllipticArc){if(o.get().getGeometryType()!==N.enumRationalBezier2)return;if(s.projectionBehavior()===0){let h=[];my(!1,o.get(),i,h,this.m_progressTracker);let m=t.getNextVertex(e),l=t.getPathFromVertex(e),u=new st,c=e;for(let g=1,d=h.length;g<d;g++){let _=h[g],p=o.get().getCoord2D(h[g-1]),f=o.get().getCoord2D(pt(h[g-1],_,.5));o.get().queryCoord(_,u);let x=u.getXY(),C=new je;C.constructCircularArcThreePoint(p,x,f);let P=v;_<1&&(P=t.insertVertex(l,m,u)),t.setSegmentToIndex(t.getVertexIndex(c),C),c=P}return}{let h=k(y,3);o.get().queryControlPoints(h);let m=[0,0,0];o.get().queryWeights(m);let l=ms(m),u=new je;return Yg(h,l*l,null,!1,u),void t.setSegmentToIndex(t.getVertexIndex(e),u)}}j("approximate_span_section_")}}verifySegmentFitness(t,e,s,n,i,o,a){return this.m_type===0?this.verifySegmentFitnessLines(t,e,s,n,i,o,a):this.verifySegmentFitnessCurves(t,e,s,n,i,o,a)}verifySegmentFitnessCurves(t,e,s,n,i,o,a){let h=t.getXY(e),m=t.getXY(s);if(!h.isEqualPoint2D(i.getStartXY())||!m.isEqualPoint2D(i.getEndXY()))return 0;let l=0;if(i.isClosed()){let x=i.getCoord2D(.1).sub(h);l=i.getCoord2D(.7).sub(h).crossProduct(x)>=0?1:-1}let u=Z(br.s_maxMonotonicPartParams,Number.NaN),c=i.getMonotonicPartParams(u.length,u);c--;let g=new nt,d=[1,.5,.75,.25],_=0,p=e,f=h.clone();for(;;){let x=t.getNextVertex(p),C=t.getSegment(p);C===null&&(t.queryLineConnector(p,g,!0),C=g);for(let P=x===s?1:0;P<d.length;P++){let E=C.getCoord2D(d[P]);if(!i.isCloserThanDistance(E,B.unit(),a))return 0}if(c>1)for(let P=1;P<c;){let E=i.getCoord2D(u[P]);C.isCloserThanDistance(E,B.unit(),a)?(u[c-1]=O(u[P],u[P]=u[c-1]),c--):P++}if(l){let P=C.getCoord2D(.25);_+=P.sub(h).crossProduct(f.sub(h)),f.assign(P),P.assign(C.getCoord2D(.75)),_+=P.sub(h).crossProduct(f.sub(h)),f.assign(P)}if(p=x,p===s)return c>1?0:l?_<0?-l:l:1}}verifySegmentFitnessLines(t,e,s,n,i,o,a){return w(0),0}removeSpan(t,e,s){t.setSegmentToIndex(t.getVertexIndex(e),null);let n=t.getNextVertex(e);n!==s&&t.removeVertices(n,s)}static st_stitchCurvesImpl(t,e,s,n,i){if(e.hasSegmentParentage())return e.hasCurves()?r.st_stitchCurvesFromCurvesImpl(t,e,s,n,i):r.st_stitchCurvesFromLinesImpl(t,e,s,n,i)}static st_stitchCurvesFromLinesImpl(t,e,s,n,i){let o=s===v?e.getFirstGeometry():s;for(;o!==v;){for(let a=e.getFirstPath(o);a!==v;a=e.getNextPath(a)){let h=e.getPathSize(a);e.isClosedPath(a)&&(h+=1);let m=!0,l=!1,u=e.getFirstVertex(a),c=u;for(let g=0;g<h&&c!==v;){let d=e.getSegmentParentage(c);if(d===-1||m){m=!1,g++,c=e.getNextVertex(c),l=!0;continue}let _,p,f=0;if(l?(_=e.getPrevVertex(c),p=c,w(_!==v),w(p!==_),w(e.getSegmentParentage(_)===-1||u===_)):(_=c,p=e.getNextVertex(_),g++,w(p!==v),w(p!==_),d=e.getSegmentParentage(p)),f=2,l=!1,d===-1||e.getSegmentParentageBreakVertex(p)){c=p;continue}let x=e.getNextVertex(p);for(g++;g<h&&x!==v;){p=x,f++;let C=e.getSegmentParentage(x);if(C===-1||e.getSegmentParentageBreakVertex(x))break;w(C===d),g++,x=e.getNextVertex(x)}if(!i){let C=t.m_originalPlanarSegments[d];t.processSpan_(e,_,p,f,C,d,n)}c=p}}if(s!==v)break;o=e.getNextGeometry(o)}}static st_stitchCurvesFromCurvesImpl(t,e,s,n,i){let o=s===v?e.getFirstGeometry():s;for(;o!==v;)if(ou(e.getGeometryType(o))){for(let a=e.getFirstPath(o);a!==v;a=e.getNextPath(a)){let h=e.getPathSize(a),m=e.isClosedPath(a);m&&(h+=1);let l=e.getFirstVertex(a);if(m){if(e.getSegmentParentage(l)!==-1){let c=l;for(let g=0;!e.getSegmentParentageBreakVertex(c);g++){if(g===h){l=e.getFirstVertex(a),e.setSegmentParentageBreakVertex(c,!0);break}c=e.getPrevVertex(c)}}}else w(e.getSegmentParentage(l)===-1||e.getSegmentParentageBreakVertex(l));let u=l;for(let c=0;c<h&&u!==v;){let g=e.getSegmentParentage(u);if(g===-1){c++,u=e.getNextVertex(u);continue}let d=0,_=v,p=u;d=1;let f=e.getNextVertex(p);for(;c<h&&f!==v;){c++,_=f,d++;let x=e.getSegmentParentage(f);if(x===-1||e.getSegmentParentageBreakVertex(f))break;w(x===g),f=e.getNextVertex(f)}if(_===v)break;if(!i){let x=t.m_originalPlanarSegments[g];t.processSpan_(e,p,_,d,x,g,n)}u=_}}if(s!==v)break;o=e.getNextGeometry(o)}else o=s===v?e.getNextGeometry(o):v}static regularizeCurve(t,e,s,n){let i=e.snapControlPoints(n*n);if(i){let o=t.getVertexIndex(s),a=e.clone();t.setSegmentToIndex(o,a)}if(e.getGeometryType()===Ge.type){let o=[],a=e.calculateSpecialPointsForCracking(n,o);if(a>0){t.splitSegment(s,o,a),i=t.snapControlPoints(s,a+1,n*n)||i;for(let h=0;h<a;h++)s=t.getNextVertex(s),t.setSegmentParentageBreakVertex(s,!0);return a}}return i?0:-1}};function Us(r,t,e,s,n){return new fa(r,e,t,s,n).do_()}function xy(r,t,e){let s=ke(r);return Ul(t.getX(),t.getY(),e.getX(),e.getY(),Et(s))}function yy(r,t,e=1,s=1,n=1,i=1){if(s>i)return r;if(i>s)return t;let o=[0],a=[0],h=new st;return y1(r,t,e,s,n,i,h,a,o),h}function eS(r,t,e){let s=ke(t),n=ro(t);return!!P1(r,s,v,null,e)||zl(!0,r,n,null,e)}function Py(r,t,e){return fa.fixCurveTwoPointLoops(r,t,e)}function v_(r){return ke(r)}var fa=class r{constructor(t,e,s,n,i){this.m_shape=t,this.m_progressTracker=e,this.m_tolerance=s,this.m_bFilterDegenerateSegments=n,this.m_bTrackChanges=i,this.m_progressCounter=0}do_(){let t=new Ps(this.m_tolerance.tolerance,this.m_tolerance.resolution),e=1e-5,s=1e-6,n=v_(t),i=ro(t),o=i*(1+e);i*=1+s;let a=!1,h=this.m_shape.getTotalPointCount()+10>30?1e3:(this.m_shape.getTotalPointCount()+10)*(this.m_shape.getTotalPointCount()+10),m=this.m_shape.hasPointFeatures();for(let l=0;;l++){this.m_shape.dbgCheckSelection(),l>h&&j("crack_and_cluster_iteration_exceeded"),this.m_shape.dbgVerifyMonotone();let u=-1;l===0&&(u=this.firstCrack_(),a||=u>0);let c=this.cluster_(n);if(this.m_shape.dbgVerifyMonotone(),a||=c,this.m_bFilterDegenerateSegments){let _=this.m_shape.filterClosePoints(n,!0,!1,this.m_bTrackChanges,v)!==0;a||=_,this.m_shape.dbgVerifyMonotone()}let g=this.m_shape.snapControlPointsOnSelection(o*o);a||=g,this.m_shape.dbgCheckSelection();let d=!1;if((l===0&&u===-1||m||zl(!0,this.m_shape,i,null,this.m_progressTracker))&&(d=this.crack_(o),a||=d,this.m_shape.dbgVerifyMonotone()),!d&&!r.fixCurveTwoPointLoops(this.m_shape,n,this.m_progressTracker)){this.m_shape.dbgVerifyMonotone();break}}return a&&py(this.m_shape),a}cluster_(t){return $d(this.m_shape,t,v,this.m_bTrackChanges,this.m_progressTracker)}crack_(t){return v1(this.m_shape,t,this.m_bTrackChanges,this.m_progressTracker)}static fixCurveTwoPointLoops(t,e,s){if(!t.hasCurves())return!1;t.dbgVerifyCurves();let n=t.createUserIndexUninitialized(),i=new he(0),o=t.queryVertexIteratorOnSelection();for(let u=o.next();u!==v;u=o.next())i.add(u),t.setUserIndex(u,n,-1);if(i.size()===0)return!1;i.add(v),t.sortVerticesSimpleByY(i,0,i.size()-1);let a=0,h=t.getXY(i.read(a)),m=new y(Number.NaN,Number.NaN),l=[];for(let u=1,c=i.size();u<c;++u){let g=i.read(u),d=g!==v?t.getXY(g):m;if(d.equals(h))continue;let _=[];for(let p=a;p<u;p++){let f=i.read(p),x=t.getPrevVertex(f);if(x!==v&&t.getUserIndex(x,n)===-1){let P=Vm(t.getXY(x),t.getSegment(x));y.sqrDistance(h,P.otherPt)!==0&&(P.vert=x,P.dir=-1,_.push(P)),t.setUserIndex(x,n,1)}let C=t.getNextVertex(f);if(C!==v&&t.getUserIndex(f,n)===-1){let P=Vm(t.getXY(C),t.getSegment(f));y.sqrDistance(h,P.otherPt)!==0&&(P.vert=f,P.dir=1,_.push(P)),t.setUserIndex(f,n,1)}}if(_.length>1){_.sort((x,C)=>Sy(x,C));let p=Vm(m.clone(),null);_.push(p);let f=0;for(let x=1,C=_.length;x<C;x++)if(!_[x].otherPt.equals(_[x-1].otherPt)){if(x-f>1&&_[f].seg!==null){let P=!1,E=f;for(let S=f+1;S<x;S++)if(!Cy(_[E],_[S])){P=!0;break}if(P)for(let S=f;S<x&&_[S].seg!==null;S++)l.push(_[S].vert)}f=x}}a=u,h.setCoordsPoint2D(d)}for(let u of l){let c=t.getSegment(u);w(c!==null);let g=t.getXY(u),d=t.getXY(t.getNextVertex(u));if(y.distance(g,d)<3*e)t.setSegmentToIndex(t.getVertexIndex(u),null);else{let _=c.lengthToT(.5*c.calculateLength2D());t.splitSegment(u,[_],1)}}return t.removeUserIndex(n),l.length>0}firstCrack_(){let t=this.m_shape.getEnvelope2D(this.m_progressTracker),e=Wt(null,t,!0).total();if(4*e<this.m_tolerance.total()){let s=!1,n=1.1*e,i=e,o=this.cluster_(n);s||=o;let a=0;this.m_bFilterDegenerateSegments&&(a=this.m_shape.filterClosePoints(0,!0,!1,this.m_bTrackChanges,v));let h=this.crack_(i);return s||=h,s?1:a?2:0}return-1}progress_(t=!1){this.m_progressCounter++,!t&&4095&this.m_progressCounter||(this.m_progressCounter=0)}};function Vm(r,t){return{otherPt:r,seg:t,vert:-1,dir:0}}function Cy(r,t){if(w(r.otherPt.equals(t.otherPt)),r.seg===null)return t.seg===null;if(t.seg===null)return!1;let e=r.seg.getGeometryType();if(e!==t.seg.getGeometryType())return!1;if(e===N.enumBezier){let s=r.seg,n=t.seg,i=s.getControlPoint1(),o=s.getControlPoint2();r.dir===-1&&(o=O(i,i=o));let a=n.getControlPoint1(),h=n.getControlPoint2();return t.dir===-1&&(h=O(a,a=h)),i.equals(a)&&o.equals(h)}if(e===N.enumRationalBezier2){let s=r.seg,n=t.seg,i=s.getControlPoint1(),o=n.getControlPoint1();if(!i.equals(o))return!1;let a=[0,0,0];s.queryWeights(a),r.dir===-1&&(a[2]=O(a[0],a[0]=a[2]));let h=[0,0,0];return n.queryWeights(h),t.dir===-1&&(h[2]=O(h[0],h[0]=h[2])),a[0]===h[0]&&a[1]===h[1]&&a[2]===h[2]}j("")}function Ey(r,t){if(r.seg===null||t.seg===null)return r.seg!==null?-1:t.seg!==null?1:0;let e=r.seg.getGeometryType(),s=t.seg.getGeometryType();return e<s?-1:e>s?1:0}function Sy(r,t){let e=r.otherPt.compare(t.otherPt);return e!==0?e:Ey(r,t)}var Aa=at,vy=Qt,Bo=Te;function sS(r){switch(r){case 1:return 1;case 2:return 2;case 3:return 3;case 4:return 4;case 0:return 0;default:w(0,"unrecognized cut side")}return 3}function Ln(){return{unsplitBehavior:0,allCrossRoadsImpassable:!1,ogcRule:!1}}function nS(r,t,e,s){return new Ye(s).autoCompleteImpl(r,t,e)}function ul(r,t,e,s,n,i,o){let a=new Ye(n);a.m_bOGCOutput=!0;let h=r.getGeometryType()===N.enumPolygon&&r.getFillRule()===1&&!Rs(s);return a.planarSimplifyImpl_(r,t,h,e,s,n,i,o)}function cl(r,t,e,s,n,i,o,a){return new Ye(i).planarSimplifyImpl_(r,t,e,s,n,i,o,a)}function Iy(r,t,e,s){let n=new Ye(s),i=new Nt,o=i.addGeometry(t),a=n.planarSimplifyNoCrackingAndCluster(r,i,o,e);return w(a,"planar_simplify_no_cracking_and_cluster"),i.getGeometry(o)}function by(r,t,e,s,n,i,o){return w(0),{}}function wy(r,t,e,s){return w(0),{}}function Sd(r,t,e){return Fy(r,t,e)}function Dy(r,t,e,s){if(r.isEmpty()||t.isEmpty()||r.getDimension()>t.getDimension())return Je($t(r),r,t,"-");let n=new V;r.queryEnvelope(n);let i=new V;t.queryEnvelope(i);let o=new V;o.setCoords({env2D:n}),o.mergeEnvelope2D(i);let a=Wt(e,o,!0),h=i.clone(),m=ke(a);if(h.inflateCoords(m,m),!n.isIntersecting(h))return Je($t(r),r,t,"-");let l=new Ye(s),u=new Nt,c=u.addGeometry($t(r)),g=u.addGeometry($t(t)),d=0,_=0,p=null;if(u.hasCurves()){p=new Be;let C=u.getEnvelope2D(s);_=zs(a.total());let P=us(a.total(),C);d=Os(P,_),Ss(u,P,a.total(),12e3,p,null,s)}l.setEditShapeCrackAndCluster(u,a.add(d));let f=l.difference(c,g);p!==null&&p.stitchCurves(u,f,_,!0);let x=Je(u.getGeometry(f),r,t,"-");return Aa(x.getGeometryType())&&(x.getImpl().setIsSimple(4,a.total()),x.getGeometryType()===N.enumPolygon&&x.getImpl().updateOGCFlagsProtected()),x}function iS(r,t,e,s){if(r.getDimension()>t.getDimension())return Je($t(r),r,t,"^");if(r.getDimension()<t.getDimension()||r.isEmpty())return Je($t(t),r,t,"^");if(t.isEmpty())return Je($t(r),r,t,"^");let n=new V;r.queryEnvelope(n);let i=new V;t.queryEnvelope(i);let o=new V;o.setCoords({env2D:n}),o.mergeEnvelope2D(i);let a=Wt(e,o,!0),h=new Ye(s),m=new Nt,l=m.addGeometry($t(r)),u=m.addGeometry($t(t)),c=0,g=null;if(m.hasCurves()){g=new Be;let p=m.getEnvelope2D(s);c=zs(a.total()),Ss(m,us(a.total(),p),a.total(),12e3,g,null,s)}h.setEditShapeCrackAndCluster(m,a);let d=h.symmetricDifference(l,u);g!==null&&g.stitchCurves(m,d,c,!0);let _=Je(m.getGeometry(d),r,t,"^");return Aa(_.getGeometryType())&&(_.getImpl().setIsSimple(4,a.total()),_.getGeometryType()===N.enumPolygon&&_.getImpl().updateOGCFlagsProtected()),_}function vd(r,t,e){return Gy(r,t,e,!0)}function Ty(r,t,e){return r.isEmpty()||t.isEmpty()?r.createInstance():xy(e,r,t)?new st({copy:yy(r,t)}):r.createInstance()}function Ny(r,t,e,s){let n=V.constructEmpty();r.queryEnvelope(n);let i=V.constructEmpty();t.queryEnvelope(i);let o=V.constructEmpty();o.setCoords({env2D:n}),o.mergeEnvelope2D(i);let a=Wt(e,o,!0),h=new V(i),m=ke(a);if(h.inflateCoords(m,m),!n.isIntersecting(h)){if(r.getDimension()<=t.getDimension())return Je($t(r.createInstance()),r,t,"&");if(r.getDimension()>t.getDimension())return Je($t(t.createInstance()),r,t,"&")}let l=new Ye(s),u=new Nt,c=u.addGeometry($t(r)),g=u.addGeometry($t(t)),d=0,_=0,p=null;if(u.hasCurves()){p=new Be;let C=u.getEnvelope2D(s);_=zs(a.total());let P=us(a.total(),C);d=Os(P,_),Ss(u,P,a.total(),12e3,p,null,s)}l.setEditShapeCrackAndCluster(u,a.add(d));let f=l.intersection(c,g);p!==null&&p.stitchCurves(u,f,_,!0);let x=Je(u.getGeometry(f),r,t,"&");return Aa(x.getGeometryType())&&(x.getImpl().setIsSimple(4,a.total()),x.getGeometryType()===N.enumPolygon&&x.getImpl().updateOGCFlagsProtected()),x}function Ay(r,t,e,s){let n=new Array(3),i=V.constructEmpty();r.queryEnvelope(i);let o=V.constructEmpty();t.queryEnvelope(o);let a=V.constructEmpty();a.setCoords({env2D:i}),a.mergeEnvelope2D(o);let h=Wt(e,a,!0),m=new V(o),l=ke(h);if(m.inflateCoords(l,l),!i.isIntersecting(m)){if(r.getDimension()<=t.getDimension()){let C=Je($t(r.createInstance()),r,t,"&");return n[C.getDimension()]=C,n}if(r.getDimension()>t.getDimension()){let C=Je($t(t.createInstance()),r,t,"&");return n[C.getDimension()]=C,n}}let u=new Ye(s),c=new Nt,g=c.addGeometry($t(r)),d=c.addGeometry($t(t)),_=0,p=0,f=null;if(c.hasCurves()){f=new Be;let C=c.getEnvelope2D(s);p=zs(h.total());let P=us(h.total(),C);_=Os(P,p),Ss(c,P,h.total(),12e3,f,null,s)}u.setEditShapeCrackAndCluster(c,h.add(_)),c.dbgVerifyCurves();let x=u.intersectionEx(g,d);for(let C of x){f!==null&&f.stitchCurves(c,C,p,!1);let P=Je(c.getGeometry(C),r,t,"&");Aa(P.getGeometryType())&&(P.getImpl().setIsSimple(4,h.total()),P.getGeometryType()===N.enumPolygon&&P.getImpl().updateOGCFlagsProtected()),n[P.getDimension()]=P}return f!==null&&f.clearStitcher(c),n}function qm(r,t,e,s,n,i=!1){t===0&&U("not enough geometries to dissolve");let o=0;for(let d=0,_=t;d<_;d++)o=Math.max(r[d].getDimension(),o);if(o===2||o===1)return new Ye(s).dissolveMultiPaths_(o,!1,r,t,e,n,i);let a=0,h=-1;for(let d=0,_=t;d<_;d++)r[d].getDimension()===o&&(h===-1&&(h=d),r[d].isEmpty()||(h=d,a++));if(a<2)return $t(r[h]);let m=ys.constructEmpty(),l=new Nt,u=v;for(let d=0,_=t;d<_;d++)if(r[d].getDimension()===o&&!r[d].isEmpty()){u===v?u=l.addGeometry($t(r[d])):l.appendGeometry(u,$t(r[d]));let p=ys.constructEmpty();r[d].queryLooseEnvelope(p),m.mergeEnv3D(p)}let c=Wt(e,m.getEnvelope2D(),!0),g=new Ye(s);if(i){let d=Oi(e,m.getEnvelopeZs(),!0);return g.planarSimplify3DImpl_(l,c,d,0,!0)}return g.m_bOGCOutput=!0,g.planarSimplifyMultiPoints(l,c,!1,-1)}function My(r,t,e,s,n,i=!1){t<2&&U("not enough geometries to dissolve");let o=0;for(let _=0,p=t;_<p;_++)o=Math.max(r[_].getDimension(),o);if(o===2||o===1)return new Ye(s).dissolveMultiPaths_(o,!0,r,t,e,n,i);let a=ys.constructEmpty(),h=new Nt,m=v,l=0,u=-1;for(let _=0,p=t;_<p;_++)if(r[_].getDimension()===o&&(u===-1&&(u=_),!r[_].isEmpty())){u=_,m===v?m=h.addGeometry($t(r[_])):h.appendGeometry(m,$t(r[_]));let f=ys.constructEmpty();r[_].queryLooseEnvelope(f),a.mergeEnv3D(f),l++}if(l<2)return $t(r[u]);let c=o===0?e:null,g=Wt(c,a.getEnvelope2D(),!0),d=new Ye(s);if(i){let _=Oi(c,a.getEnvelopeZs(),!0);return d.m_bOGCOutput=!0,d.planarSimplify3DImpl_(h,g,_,0,!0)}return d.planarSimplifyMultiPoints(h,g,!0,-1)}var Ye=class{constructor(t){this.m_topoGraph=null,this.m_maskLookup=[],this.m_dummyPt1=y.getNAN(),this.m_dummyPt2=y.getNAN(),this.m_fromEdgeForPolylines=v,this.m_progressCounter=0,this.m_bOGCOutput=!1,this.m_progressTracker=t}linesToPolygonsImpl(t,e){let s=0,n=0,i=null;if(t.hasCurves()){i=new Be;let m=t.getEnvelope2D(this.m_progressTracker);n=zs(e.total());let l=us(e.total(),m);s=Os(l,n),Ss(t,l,e.total(),12e3,i,null,this.m_progressTracker)}this.setEditShapeCrackAndCluster(t,e.add(s));let o=this.m_topoGraph.createUserIndexForChains(),a=this.m_topoGraph.getFirstChain();this.m_topoGraph.setChainUserIndex(a,o,1);for(let m=this.m_topoGraph.getChainFirstIsland(a);m!==v;m=this.m_topoGraph.getChainNextInParent(m))this.m_topoGraph.setChainUserIndex(m,o,1);let h=[];for(let m=this.m_topoGraph.getFirstChain();m!==v;m=this.m_topoGraph.getChainNext(m)){if(this.m_topoGraph.getChainUserIndex(m,o)===1)continue;this.m_topoGraph.setChainUserIndex(m,o,1);for(let c=this.m_topoGraph.getChainFirstIsland(m);c!==v;c=this.m_topoGraph.getChainNextInParent(c))this.m_topoGraph.setChainUserIndex(c,o,1);if(this.m_topoGraph.getChainArea(m)===0)continue;let l=this.m_topoGraph.extractPolygonFromChainAndIslands(t,v,m,v);i?.stitchCurves(t,l,n,!1);let u=t.getGeometry(l);h.push(u)}return new Ys(h)}autoCompleteImpl(t,e,s){let n=0,i=0,o=null;if(t.hasCurves()){o=new Be;let u=t.getEnvelope2D(this.m_progressTracker);i=zs(s.total());let c=us(s.total(),u);n=Os(c,i),Ss(t,c,s.total(),12e3,o,null,this.m_progressTracker)}this.setEditShapeCrackAndCluster(t,s.add(n));let a=this.m_topoGraph.getGeometryID(e),h=this.m_topoGraph.createUserIndexForChains(),m=this.m_topoGraph.getFirstChain();this.m_topoGraph.setChainUserIndex(m,h,1);for(let u=this.m_topoGraph.getChainFirstIsland(m);u!==v;u=this.m_topoGraph.getChainNextInParent(u))this.m_topoGraph.setChainUserIndex(u,h,1);let l=[];for(let u=this.m_topoGraph.getFirstChain();u!==v;u=this.m_topoGraph.getChainNext(u)){if(this.m_topoGraph.getChainUserIndex(u,h)===1)continue;this.m_topoGraph.setChainUserIndex(u,h,1);for(let f=this.m_topoGraph.getChainFirstIsland(u);f!==v;f=this.m_topoGraph.getChainNextInParent(f))this.m_topoGraph.setChainUserIndex(f,h,1);if(this.m_topoGraph.getChainParentage(u)!==0)continue;let c=this.m_topoGraph.getChainHalfEdge(u),g=c,d=!1;do{let f=this.m_topoGraph.getHalfEdgeTwin(g);if(this.m_topoGraph.getHalfEdgeChain(f)!==u&&this.m_topoGraph.getHalfEdgeParentage(g)&a){d=!0;break}g=this.m_topoGraph.getHalfEdgeNext(g)}while(g!==c);if(!d||this.m_topoGraph.getChainArea(u)===0)continue;let _=this.m_topoGraph.extractPolygonFromChainAndIslands(t,v,u,v);o!==null&&o.stitchCurves(t,_,i,!1);let p=t.getGeometry(_);l.push(p)}return new Ys(l)}setEditShape(t,e=!1){this.m_topoGraph===null&&(this.m_topoGraph=new As),this.m_topoGraph.setEditShape(t,this.m_progressTracker,!0,e)}setEditShapeCrackAndCluster(t,e){Us(t,e,this.m_progressTracker,!0,!1);for(let s=t.getFirstGeometry();s!==v;s=t.getNextGeometry(s))t.getGeometryType(s)===N.enumPolygon&&vn(t,s,-1,this.m_bOGCOutput,v,this.m_progressTracker);this.setEditShape(t)}setHalfEdgeOrientations_(t,e){let s=this.m_topoGraph.getShape();for(let n=s.getFirstGeometry();n!==v;n=s.getNextGeometry(n))if(n===e)for(let i=s.getFirstPath(n);i!==v;i=s.getNextPath(i)){let o=s.getFirstVertex(i);if(o===v)continue;let a=s.getNextVertex(o);for(;a!==v;){let h=this.m_topoGraph.getClusterFromVertex(o),m=this.m_topoGraph.getClusterFromVertex(a),l=this.m_topoGraph.getHalfEdgeConnector(h,m);if(l!==v){let u=this.m_topoGraph.getHalfEdgeTwin(l);this.m_topoGraph.setHalfEdgeUserIndex(l,t,1),this.m_topoGraph.setHalfEdgeUserIndex(u,t,2)}o=a,a=s.getNextVertex(o)}}}flushVertices_(t,e){let s=this.m_topoGraph.getShape(),n=s.hasSegmentParentage(),i=new et,o=s.insertPath(t,v);e.push(e[0]);let a=e.length,h=v;for(let m=0;m<a;m++){let l=e[m];if(h=s.addVertex(o,l),!n)continue;let u=this.m_topoGraph.getClusterFromVertex(l);if(m>0&&this.m_topoGraph.isBreakNode(u)&&s.setSegmentParentageBreakVertex(h,!0),m<a-1){let c=this.m_topoGraph.getHalfEdgeConnector(u,this.m_topoGraph.getClusterFromVertex(e[m+1])),g=this.m_topoGraph.getSegmentParentage(c);s.setSegmentParentageAndBreak(h,g,m>0||this.m_topoGraph.isBreakNode(u)),this.m_topoGraph.isHalfEdgeCurve(c)&&(this.m_topoGraph.querySegmentXY(c,i),s.setSegmentToIndex(s.getVertexIndex(h),i.get().clone()))}}if(n){let m=this.m_topoGraph.getClusterFromVertex(e[a-1]);this.m_topoGraph.isBreakNode(m)&&s.setSegmentParentageBreakVertex(h,!0)}s.setClosedPath(o,!0)}processPolygonCuts_(t,e,s,n){let i=this.m_topoGraph.getGeometryID(s),o=this.m_topoGraph.getGeometryID(n),a=[],h=this.m_topoGraph.getShape(),m=this.m_topoGraph.createUserIndexForHalfEdges();for(let l=this.m_topoGraph.getFirstCluster();l!==v;l=this.m_topoGraph.getNextCluster(l)){let u=this.m_topoGraph.getClusterHalfEdge(l);if(u===v)continue;let c=u;do{if(this.m_topoGraph.getHalfEdgeUserIndex(c,m)!==1){let g=c,d=c,_=!1,p=0;do{if(this.m_topoGraph.setHalfEdgeUserIndex(g,m,1),!_&&this.m_topoGraph.getHalfEdgeParentage(g)&o&&this.m_topoGraph.getHalfEdgeFaceParentage(g)&i&&(d=g,_=!0),_){let f=this.m_topoGraph.getHalfEdgeOrigin(g),x=this.m_topoGraph.getClusterVertexIterator(f),C=this.m_topoGraph.getVertexFromVertexIterator(x);a.push(C),t!==-1&&this.m_topoGraph.getHalfEdgeParentage(g)&o&&(p|=this.m_topoGraph.getHalfEdgeUserIndex(g,t))}g=this.m_topoGraph.getHalfEdgeNext(g)}while(g!==d);if(_&&this.m_topoGraph.getChainArea(this.m_topoGraph.getHalfEdgeChain(d))>0){let f=h.createGeometry(N.enumPolygon);this.flushVertices_(f,a),e!==-1&&h.setGeometryUserIndex(f,e,p)}a.length=0}c=this.m_topoGraph.getHalfEdgeNext(this.m_topoGraph.getHalfEdgeTwin(c))}while(c!==u)}this.m_topoGraph.deleteUserIndexForHalfEdges(m)}cutPolygonPolyline_(t,e,s,n){this.m_topoGraph.removeSpikes_();let i=-1;t!==-1&&(i=this.m_topoGraph.createUserIndexForHalfEdges(),this.setHalfEdgeOrientations_(i,s)),this.processPolygonCuts_(i,t,e,s),i!==-1&&(this.m_topoGraph.deleteUserIndexForHalfEdges(i),i=-1);let o=this.m_topoGraph.getShape();for(let a=o.getFirstGeometry();a!==v;a=o.getNextGeometry(a))a!==e&&a!==s&&n.push(a);n.sort((a,h)=>{let m=o.getFirstPath(a),l=o.getRingArea(m),u=o.getFirstPath(h),c=o.getRingArea(u);return l<c?-1:l>c?1:0})}cut(t,e,s,n,i){let o=this.m_topoGraph.getShape().getGeometryType(s),a=this.m_topoGraph.getShape().getGeometryType(n),h=Te(o),m=Te(a);h!==2||m!==1?h!==1||m!==1?j(""):new gl(this,t,e,s,n,i).Do():this.cutPolygonPolyline_(e,s,n,i)}progress_(t=!1){}isGoodParentage(t){return t>=0&&t<this.m_maskLookup.length&&this.m_maskLookup[t]}normalizeInputGeometry(t){let e=t.getGeometryType();if(e===N.enumEnvelope){let s=new lt({vd:t.getDescription()});return t.isEmpty()||s.addEnvelope(t,!1),s}if(e===N.enumPoint){let s=new Lt({vd:t.getDescription()});return t.isEmpty()||s.add(t),s}if(Qt(e)){let s=new dt({vd:t.getDescription()});return t.isEmpty()||s.addSegment(t,!0),s}return e!==N.enumMultiPoint&&e!==N.enumPolyline&&e!==N.enumPolygon&&U("Unexpected geometry type"),t}dissolveNonSimplePolygons(t,e,s,n){w(e>0);let i=new Nt,o=0,a=-1;for(let h=0,m=e;h<m;h++)t[h].getDimension()===2&&(a===-1&&(a=h),t[h].isEmpty()||(o++,i.addGeometry(t[h])));return o===0?(w(a>=0),this.normalizeInputGeometry(t[a])):this.planarSimplifyPolygons(i,s,!0,!1,-1,!0)}dissolveMultiPaths_(t,e,s,n,i,o,a){w(t>=1&&t<=2),w(n>0);let h=8&o?1:2,m=ys.constructEmpty(),l=0,u=-1,c=!0;for(let M=0,q=n;M<q;M++)if(s[M].getDimension()===t&&(u===-1&&(u=M),!s[M].isEmpty())){u=M,l++;let R=ys.constructEmpty();if(s[M].queryLooseEnvelope(R),m.mergeEnv3D(R),t===2&&c&&s[M].getGeometryType()===N.enumPolygon)if(16&o){let X=[0],z=s[M].getImpl().getIsSimple(0,X),Y=this.m_bOGCOutput?z===5:Qs(z);c&&=Y}else{let X=Yu(s[M],0);c&&=X}}if(l<2&&(w(u>=0),l===0||!(16&o)))return this.normalizeInputGeometry(s[u]);if(!c){let M=Wt(e?null:i,m.getEnvelope2D(),!0);return this.dissolveNonSimplePolygons(s,n,M,o)}let g=s.slice(0,n),d=Wt(i,m.getEnvelope2D(),!0),_=10*ke(d),p=new Ps(0,0);if(a&&(p=Oi(i,m.getEnvelopeZs(),!0)),l===1&&t===1&&h===2&&!e)return a?by():this.m_bOGCOutput?ul(g[u],d,!1,-1,this.m_progressTracker,h,!1):cl(g[u],d,!1,!1,-1,this.m_progressTracker,h,!1);let f=new Fu;f.startConstruction();let x=t===2?3:4,C=0;for(let M=0,q=n;M<q;M++){if(g[M].getDimension()!==t||g[M].isEmpty())continue;let R=g[M].getGeometryType();if(R!==N.enumEnvelope){if(Qt(R)?(g[M]=this.normalizeInputGeometry(g[M]),R=N.enumPolyline):w(at(R)),t===1){w(R===N.enumPolyline);let z=-1;if(a)w(0,"3d not implemented yet");else{let Y=[0];z=g[M].getImpl().getIsSimple(d.total(),Y)}if(this.m_bOGCOutput?z!==5:!Qs(z))if(e)x=-1;else{a?w(0,"3d not implemented yet"):this.m_bOGCOutput?g[M]=ul(g[M],d,!1,-1,this.m_progressTracker,h,!1):g[M]=cl(g[M],d,!1,!1,-1,this.m_progressTracker,h,!1);let Y=[0];w(Qs(g[M].getImpl().getIsSimple(d.total(),Y)))}}else{w(R===N.enumPolygon);let z=[0],Y=g[M].getImpl().getIsSimple(0,z);w(Rs(Y))}let X=g[M].getImpl();for(let z=0,Y=X.getPathCount();z<Y;z++){let L=V.constructEmpty();X.queryLoosePathEnvelope(z,L),L.inflateCoords(_,_),f.addEnvelope(C,L),C++}}else{w(R===N.enumEnvelope);let X=V.constructEmpty();g[M].queryLooseEnvelope(X),X.inflateCoords(_,_),f.addEnvelope(C,X),C++,x=-1}}f.endConstruction();let P=C,E=Z(P,-2147483647),S=Z(P,-1),I=0;u=-1,C=0;for(let M=0,q=n;M<q;M++){if(g[M].getDimension()!==t||(u===-1&&(u=M),g[M].isEmpty()))continue;u=M,I++;let R=g[M].getGeometryType();if(at(R))for(let X=0,z=g[M].getPathCount();X<z;X++)S[C]=M,E[C]=-X-1,C++;else w(R===N.enumEnvelope),S[C]=M,E[C]=-1,C++}if(I<2&&t===2)return w(u>=0),this.normalizeInputGeometry(g[u]);let D=P;for(;f.next()&&D>0;){this.progress_();let M=f.getHandleA(),q=f.getHandleB(),R=f.getElement(M),X=f.getElement(q);S[R]!==S[X]&&(E[R]<0&&(D--,E[R]=-(E[R]+1)),E[X]<0&&(D--,E[X]=-(E[X]+1)))}let b=new Nt,T=!1,A=0;for(let M=0,q=n;M<q;M++){if(g[M].getDimension()!==t||g[M].isEmpty())continue;let R=g[M].getGeometryType(),X=A,z=0,Y=0,L=at(R)?g[M]:null;for(let W=X,K=E.length;W<K&&S[W]===M;W++)E[W]>=0&&(z++,Y+=L?L.getPathSize(E[W]):Zn(g[M])),A++;if(Y>.95*Zn(g[M])){b.addGeometry(this.normalizeInputGeometry(g[M]));for(let W=X;W<A;W++)E[W]<0&&(E[W]=-(E[W]+1))}else{if(z===0){T=!0;continue}{T=!0,w(at(R)),w(L!=null);let W=new lt({vd:g[M].getDescription()}),K=new dt({vd:g[M].getDescription()}),yt=R===N.enumPolygon?W:K;for(let rt=X;rt<A;rt++)E[rt]>=0&&yt.addPath(L,E[rt],!0);b.addGeometry(yt)}}}let G;if(b.getFirstGeometry()!==v){let M=t===2,q=e?Wt(null,m.getEnvelope2D(),!0):d,R=new Ps(0,0);if(a&&(R=e?Oi(null,m.getEnvelopeZs(),!0):p),t===2&&!(2&o)){b.collapseAllGeometriesToFirst();let X=0,z=null;if(b.hasCurves()&&!b.hasSegmentParentage()){z=new Be;let Y=b.getEnvelope2D(this.m_progressTracker);X=zs(q.total()),Ss(b,us(q.total(),Y),q.total(),12e3,z,null,this.m_progressTracker)}S1(b,b.getFirstGeometry(),q.total(),this.m_progressTracker),z!==null&&z.stitchCurves(b,v,X,!0)}if(a)G=this.planarSimplify3DImpl_(b,q,R,h,!0);else if(t===2)G=this.planarSimplifyPolygons(b,q,M,e,-1,!1);else{let X=Ln();X.ogcRule=this.m_bOGCOutput,X.allCrossRoadsImpassable=!0,X.unsplitBehavior=h,G=this.planarSimplifyPolylines(b,q,e,X,-1)}if(!T){let X=[0];x=G.getImpl().getIsSimple(q.total(),X)}}else w(T),w(u>=0),G=t===2?new lt({vd:g[u].getDescription()}):new dt({vd:g[u].getDescription()});if(T){let M=0;for(let q=0,R=E.length;q<R;q++){let X=S[q];if(!(X<0)&&E[q]<0){let z=g[X].getGeometryType(),Y=at(z)?g[X]:null;if(Y){let L=-(E[q]+1);M+=Y.getPathSize(L)}else M+=4}}G.reserve(G.getPointCount()+M);for(let q=0,R=E.length;q<R;q++){let X=S[q];if(!(X<0)&&E[q]<0){let z=g[X].getGeometryType(),Y=at(z)?g[X]:null;if(Y){let L=-(E[q]+1);G.addPath(Y,L,!0)}else z===N.enumEnvelope?G.addEnvelope(g[X],!1):(w(Qt(z)),G.addSegment(g[X],!0))}}}let F=0;if(t===2?x!==-1&&(x=3,F=e?0:d.total()):(w(t===1),e||x===-1||(F=d.total())),a||G.getImpl().setIsSimple(x,F),!e&&T)if(t===2){if(!a)return new Ms().execute(G,i,!1,this.m_progressTracker);w(0,"3d not yet implemented")}else t===1&&h!==1&&(G=a?wy():Iy(this.m_bOGCOutput,G,h,this.m_progressTracker),G.getImpl().setIsSimple(x,F));return G}dissolveTopoGraphCommonEdges_(){let t=this.m_topoGraph.createUserIndexForHalfEdges(),e=[];for(let s=this.m_topoGraph.getFirstCluster();s!==v;s=this.m_topoGraph.getNextCluster(s)){let n=this.m_topoGraph.getClusterHalfEdge(s),i=n;if(n!==v)do{if(this.progress_(),this.m_topoGraph.getHalfEdgeUserIndex(i,t)!==1){let o=this.m_topoGraph.getHalfEdgeTwin(i);this.m_topoGraph.setHalfEdgeUserIndex(o,t,1),this.m_topoGraph.setHalfEdgeUserIndex(i,t,1);let a=this.m_topoGraph.getHalfEdgeFaceParentage(i);if(this.isGoodParentage(a)){let h=this.m_topoGraph.getHalfEdgeFaceParentage(o);this.isGoodParentage(h)&&e.push(i)}}i=this.m_topoGraph.getHalfEdgeNext(this.m_topoGraph.getHalfEdgeTwin(i))}while(i!==n)}this.m_topoGraph.deleteUserIndexForHalfEdges(t),this.m_topoGraph.deleteEdgesBreakFaces_(e)}chooseVertexByOrder(t,e,s,n){let i=We(),o=v;for(let h=this.m_topoGraph.getClusterVertexIterator(t);h!==v;h=this.m_topoGraph.incrementVertexIterator(h)){let m=this.m_topoGraph.getVertexFromVertexIterator(h),l=e.getUserIndex(m,s);l>=0&&l<i&&(i=l,o=m)}w(o!==v);let a=e.getUserIndex(o,n);return a>0&&(e.setUserIndex(o,n,--a),a===0&&e.setUserIndex(o,s,-1)),o}chooseVertexFromCluster_(t,e){return this.m_topoGraph.getVertexDominantFromCluster(t,e)}chooseVertexFromVertexCluster_(t,e){return this.m_topoGraph.getVertexDominant(t,e)}collectPolygonPathsPreservingFrom_(t,e,s,n,i){let o=this.m_topoGraph.getShape();if(o.getGeometryType(t)!==N.enumPolygon)return;let a=o.hasSegmentParentage(),h=new et;for(let m=o.getFirstPath(t);m!==v;m=o.getNextPath(m)){let l=o.getFirstVertex(m);this.m_topoGraph.getClusterFromVertex(l);let u=this.m_topoGraph.getHalfEdgeFromVertex(l);if(u===v)continue;let c=this.m_topoGraph.getHalfEdgeUserIndex(u,s);if(c===1||c===2)continue;let g=this.m_topoGraph.getHalfEdgeFaceParentage(u);if(!this.isGoodParentage(g)){this.m_topoGraph.setHalfEdgeUserIndex(u,s,2);continue}this.m_topoGraph.setHalfEdgeUserIndex(u,s,1);let d=o.insertPath(e,v);o.setClosedPath(d,!0);let _=u,p=l,f=this.m_topoGraph.getClusterFromVertex(p),x=1;do{this.progress_();let C=this.chooseVertexFromVertexCluster_(p,i),P=o.addVertex(d,C);if(this.m_topoGraph.isHalfEdgeCurve(_)&&(this.m_topoGraph.querySegmentXY(_,h),o.setSegmentToIndex(o.getVertexIndex(P),h.get().clone())),a){let D=this.m_topoGraph.getSegmentParentage(_);o.setSegmentParentageAndBreak(P,D,this.m_topoGraph.isBreakNode(f))}let E,S;n!==-1&&this.m_topoGraph.setClusterUserIndex(f,n,1),this.m_topoGraph.setHalfEdgeUserIndex(_,s,1),_=this.m_topoGraph.getHalfEdgeNext(_);do E=x===1?o.getNextVertex(p):o.getPrevVertex(p),S=E!==v?this.m_topoGraph.getClusterFromVertex(E):v;while(S===f);let I=this.m_topoGraph.getHalfEdgeOrigin(_);if(I!==S){do E=x===1?o.getPrevVertex(p):o.getNextVertex(p),S=E!==v?this.m_topoGraph.getClusterFromVertex(E):v;while(S===f);if(I!==S){S=I;let D=this.m_topoGraph.getClusterVertexIterator(S);E=this.m_topoGraph.getVertexFromVertexIterator(D)}else x=-x}f=S,p=E}while(_!==u)}}topoOperationPolygonPolygonHelper_(t,e,s,n,i,o){this.progress_(!0),t!==v&&this.collectPolygonPathsPreservingFrom_(t,s,i,o,n),e!==v&&this.collectPolygonPathsPreservingFrom_(e,s,i,o,n);let a=new et,h=this.m_topoGraph.getShape();h.dbgVerifyCurves();let m=h.hasSegmentParentage();for(let l=this.m_topoGraph.getFirstCluster();l!==v;l=this.m_topoGraph.getNextCluster(l)){let u=this.m_topoGraph.getClusterHalfEdge(l);if(u===v)continue;let c=u;do{this.progress_();let g=this.m_topoGraph.getHalfEdgeUserIndex(c,i);if(g!==1&&g!==2){let d=this.m_topoGraph.getHalfEdgeFaceParentage(c);if(this.isGoodParentage(d)){let _=h.insertPath(s,v);h.setClosedPath(_,!0);let p=c;do{let f=this.m_topoGraph.getHalfEdgeVertexIterator(p),x=v;if(f!==v)x=this.m_topoGraph.getVertexFromVertexIterator(f);else{let E=this.m_topoGraph.getHalfEdgeVertexIterator(this.m_topoGraph.getHalfEdgeTwin(p));x=this.m_topoGraph.getVertexFromVertexIterator(E),x=h.getNextVertex(x)}let C=this.chooseVertexFromVertexCluster_(x,n),P=h.addVertex(_,C);if(m){let E=this.m_topoGraph.getSegmentParentage(p),S=this.m_topoGraph.getHalfEdgeOrigin(p);h.setSegmentParentageAndBreak(P,E,this.m_topoGraph.isBreakNode(S))}if(this.m_topoGraph.isHalfEdgeCurve(p)&&(this.m_topoGraph.querySegmentXY(p,a),h.setSegmentToIndex(h.getVertexIndex(P),a.get().clone())),this.m_topoGraph.setHalfEdgeUserIndex(p,i,1),o!==-1){let E=this.m_topoGraph.getClusterFromVertex(C);this.m_topoGraph.setClusterUserIndex(E,o,1)}p=this.m_topoGraph.getHalfEdgeNext(p)}while(p!==c)}else this.m_topoGraph.setHalfEdgeUserIndex(c,i,2)}c=this.m_topoGraph.getHalfEdgeNext(this.m_topoGraph.getHalfEdgeTwin(c))}while(c!==u)}}topoOperationPolygonPolygon_(t,e,s,n=!1){this.dissolveTopoGraphCommonEdges_();let i=this.m_topoGraph.getShape(),o=i.createGeometry(N.enumPolygon),a=this.m_topoGraph.createUserIndexForHalfEdges();return this.topoOperationPolygonPolygonHelper_(t,e,o,s,a,-1),this.m_topoGraph.deleteUserIndexForHalfEdges(a),n||vn(i,o,3,this.m_bOGCOutput,v,this.m_progressTracker),o}topoOperationPolyline_(t,e){let s=Ln();return s.allCrossRoadsImpassable=!1,s.ogcRule=e,s.unsplitBehavior=0,this.topoOperationPolylineSimplifyOrPolylineTopoHelper_(v,t,!1,s).first}topoOperationMultiPoint_(){let t=this.m_topoGraph.getShape(),e=t.createGeometry(N.enumMultiPoint),s=t.insertPath(e,v);for(let n=this.m_topoGraph.getFirstCluster();n!==v;n=this.m_topoGraph.getNextCluster(n)){let i=this.m_topoGraph.getClusterParentage(n);if(this.isGoodParentage(i)){let o=v;for(let a=this.m_topoGraph.getClusterVertexIterator(n);a!==v;a=this.m_topoGraph.incrementVertexIterator(a)){let h=this.m_topoGraph.getVertexFromVertexIterator(a);o===v&&(o=h);let m=t.getGeometryFromPath(t.getPathFromVertex(h)),l=this.m_topoGraph.getGeometryID(m);if(this.isGoodParentage(l)){o=h;break}}t.addVertex(s,o)}}return e}intersection(t,e){let s=this.m_topoGraph.getShape().getGeometryType(t),n=this.m_topoGraph.getShape().getGeometryType(e),i=Te(s),o=Te(n),a=this.m_topoGraph.getGeometryID(t),h=this.m_topoGraph.getGeometryID(e);w(a>=0),w(h>=0),this.m_maskLookup.length=0,this.m_maskLookup.length=1+(a|h),this.m_maskLookup[a|h]=!0;let m=v;return this.m_topoGraph.getShape().getVertexDescription().getAttributeCount()>1&&(m=t),i===2&&o===2?this.topoOperationPolygonPolygon_(t,e,m):i===1&&o>0||o===1&&i>0?this.topoOperationPolyline_(m,this.m_bOGCOutput):i===0||o===0?this.topoOperationMultiPoint_():void j("")}topoOperationPolygonPolygonEx(t,e,s){let n=this.m_topoGraph.getShape(),i=n.createGeometry(N.enumPolygon),o=n.createGeometry(N.enumPolyline),a=n.createGeometry(N.enumMultiPoint);this.dissolveTopoGraphCommonEdges_();let h=v,m=this.m_topoGraph.createUserIndexForHalfEdges(),l=this.m_topoGraph.createUserIndexForClusters();n.dbgVerifyCurves(),this.topoOperationPolygonPolygonHelper_(t,e,i,s,m,l),n.dbgVerifyCurves();let u=n.hasSegmentParentage(),c=new et;for(let d=this.m_topoGraph.getFirstCluster();d!==v;d=this.m_topoGraph.getNextCluster(d)){let _=this.m_topoGraph.getClusterHalfEdge(d);if(_===v)continue;let p=_;do{let f=this.m_topoGraph.getHalfEdgeUserIndex(p,m),x=this.m_topoGraph.getHalfEdgeUserIndex(this.m_topoGraph.getHalfEdgeTwin(p),m),C=f|x;if(C===2){let P=this.m_topoGraph.getHalfEdgeParentage(p);if(this.isGoodParentage(P)){let E=n.insertPath(o,v),S=p,I=this.chooseVertexFromCluster_(d,s),D=n.addVertex(E,I);if(u){let b=this.m_topoGraph.getSegmentParentage(p),T=this.m_topoGraph.getHalfEdgeOrigin(p);n.setSegmentParentageAndBreak(D,b,this.m_topoGraph.isBreakNode(T))}this.m_topoGraph.isHalfEdgeCurve(p)&&(this.m_topoGraph.querySegmentXY(p,c),n.setSegmentToIndex(n.getVertexIndex(D),c.get().clone())),this.m_topoGraph.setClusterUserIndex(d,l,1);do{this.progress_();let b=this.m_topoGraph.getHalfEdgeTo(S),T=this.chooseVertexFromCluster_(b,s);if(D=n.addVertex(E,T),u){let A=this.m_topoGraph.getSegmentParentage(p),G=this.m_topoGraph.getHalfEdgeOrigin(p);n.setSegmentParentageAndBreak(D,A,this.m_topoGraph.isBreakNode(G))}if(this.m_topoGraph.setHalfEdgeUserIndex(S,m,1),this.m_topoGraph.setHalfEdgeUserIndex(this.m_topoGraph.getHalfEdgeTwin(S),m,1),this.m_topoGraph.setClusterUserIndex(b,l,1),S=this.m_topoGraph.getHalfEdgeNext(S),f=this.m_topoGraph.getHalfEdgeUserIndex(S,m),x=this.m_topoGraph.getHalfEdgeUserIndex(this.m_topoGraph.getHalfEdgeTwin(S),m),C=f|x,C!==2)break;if(P=this.m_topoGraph.getHalfEdgeParentage(S),!this.isGoodParentage(P)){this.m_topoGraph.setHalfEdgeUserIndex(S,m,1),this.m_topoGraph.setHalfEdgeUserIndex(this.m_topoGraph.getHalfEdgeTwin(S),m,1);break}this.m_topoGraph.isHalfEdgeCurve(p)&&S!==p&&(this.m_topoGraph.querySegmentXY(p,c),n.setSegmentToIndex(n.getVertexIndex(D),c.get().clone()))}while(S!==p)}else this.m_topoGraph.setHalfEdgeUserIndex(p,m,1),this.m_topoGraph.setHalfEdgeUserIndex(this.m_topoGraph.getHalfEdgeTwin(p),m,1)}p=this.m_topoGraph.getHalfEdgeNext(this.m_topoGraph.getHalfEdgeTwin(p))}while(p!==_)}for(let d=this.m_topoGraph.getFirstCluster();d!==v;d=this.m_topoGraph.getNextCluster(d)){if(this.progress_(),this.m_topoGraph.getClusterUserIndex(d,l)===1)continue;let _=this.m_topoGraph.getClusterParentage(d);if(this.isGoodParentage(_)){h===v&&(h=n.insertPath(a,v));let p=this.m_topoGraph.getClusterVertexIterator(d),f=v;if(p!==v){f=this.m_topoGraph.getVertexFromVertexIterator(p);let x=this.chooseVertexFromVertexCluster_(f,s);n.addVertex(h,x)}}}this.m_topoGraph.deleteUserIndexForClusters(l),this.m_topoGraph.deleteUserIndexForHalfEdges(m),n.dbgVerifyCurves(),vn(n,i,3,this.m_bOGCOutput,v,this.m_progressTracker);let g=[v,v,v];return g[0]=a,g[1]=o,g[2]=i,g}topoOperationPolylinePolylineOrPolygonEx(t,e){let s=Ln();return s.allCrossRoadsImpassable=!1,s.ogcRule=e,s.unsplitBehavior=0,this.topoOperationPolylineSimplifyOrPolylineTopoHelper_(v,t,!0,s)}topoOperationMultiPoint(){let t=this.m_topoGraph.getShape(),e=t.createGeometry(N.enumMultiPoint),s=t.insertPath(e,v);for(let n=this.m_topoGraph.getFirstCluster();n!==v;n=this.m_topoGraph.getNextCluster(n)){let i=this.m_topoGraph.getClusterParentage(n);if(this.isGoodParentage(i)){let o=v;for(let a=this.m_topoGraph.getClusterVertexIterator(n);a!==v;a=this.m_topoGraph.incrementVertexIterator(a)){let h=this.m_topoGraph.getVertexFromVertexIterator(a);o===v&&(o=h);let m=t.getGeometryFromPath(t.getPathFromVertex(h)),l=this.m_topoGraph.getGeometryID(m);if(this.isGoodParentage(l)){o=h;break}}t.addVertex(s,o)}}return e}intersectionEx(t,e){let s=this.m_topoGraph.getShape().getGeometryType(t),n=this.m_topoGraph.getShape().getGeometryType(e),i=Bo(s),o=Bo(n),a=this.m_topoGraph.getGeometryID(t),h=this.m_topoGraph.getGeometryID(e);w(a>=0),w(h>=0),this.m_maskLookup.length=0,this.m_maskLookup.length=1+(a|h),this.m_maskLookup[a|h]=!0;let m=v;if(this.m_topoGraph.getShape().getVertexDescription().getAttributeCount()>1&&(m=t),i===2&&o===2)return this.topoOperationPolygonPolygonEx(t,e,m);if(i===1&&o>0||o===1&&i>0){let{first:l,second:u}=this.topoOperationPolylinePolylineOrPolygonEx(m,this.m_bOGCOutput);return[u,l]}if(i===0||o===0){let l=[];return l.push(this.topoOperationMultiPoint()),l}j("")}getCombinedHalfEdgeParentage(t){return this.m_topoGraph.getHalfEdgeParentage(t)|this.m_topoGraph.getHalfEdgeFaceParentage(t)|this.m_topoGraph.getHalfEdgeFaceParentage(this.m_topoGraph.getHalfEdgeTwin(t))}prevailingDirection(t,e){let s=this.getCombinedHalfEdgeParentage(e),n=this.m_topoGraph.getHalfEdgeOrigin(e),i=this.m_topoGraph.getHalfEdgeTo(e),o=0,a=0;for(let h=this.m_topoGraph.getClusterVertexIterator(n);h!==v;h=this.m_topoGraph.incrementVertexIterator(h)){let m=this.m_topoGraph.getVertexFromVertexIterator(h),l=t.getPathFromVertex(m),u=t.getGeometryFromPath(l),c=this.m_topoGraph.getGeometryID(u),g=t.getFirstVertex(l),d=!!(c&s);d&&g===m&&(this.m_fromEdgeForPolylines=e);let _=t.getNextVertex(m);if(_!==v&&this.m_topoGraph.getClusterFromVertex(_)===i){if(o++,d){if(this.m_fromEdgeForPolylines===v&&g===_){let p=this.m_topoGraph.getHalfEdgeNext(e);this.isGoodParentage(this.getCombinedHalfEdgeParentage(p))&&(this.m_fromEdgeForPolylines=p)}a++}}else{let p=t.getPrevVertex(m);if(p!==v&&this.m_topoGraph.getClusterFromVertex(p)===i&&(o--,d)){if(this.m_fromEdgeForPolylines===v&&g===p){let f=this.m_topoGraph.getHalfEdgeNext(e);this.isGoodParentage(this.getCombinedHalfEdgeParentage(f))&&(this.m_fromEdgeForPolylines=f)}a--}}}return this.m_topoGraph.queryXY(n,this.m_dummyPt1),this.m_topoGraph.queryXY(i,this.m_dummyPt2),(a!==0?a:o)*y.distance(this.m_dummyPt1,this.m_dummyPt2)}tryMoveThroughCrossroadBackwards(t,e){let s=this.m_topoGraph.getHalfEdgePrev(t),n=this.m_topoGraph.getHalfEdgeTwin(s);if(!e){if(this.m_topoGraph.isStrongPathNode(this.m_topoGraph.getHalfEdgeOrigin(t)))return v;let a=this.m_topoGraph.getHalfEdgeTwin(t);if(n===this.m_topoGraph.getHalfEdgeNext(a))return s}let i=n,o=v;for(;i!==t;){let a=this.getCombinedHalfEdgeParentage(i);if(this.isGoodParentage(a)){if(o!==v)return v;o=this.m_topoGraph.getHalfEdgeTwin(i)}i=this.m_topoGraph.getHalfEdgeTwin(this.m_topoGraph.getHalfEdgePrev(i))}return o}tryMoveThroughCrossroadForward(t,e){let s=this.m_topoGraph.getHalfEdgeNext(t),n=this.m_topoGraph.getHalfEdgeTwin(s);if(!e){let a=this.m_topoGraph.getHalfEdgeTwin(t);if(this.m_topoGraph.isStrongPathNode(this.m_topoGraph.getHalfEdgeOrigin(a)))return v;if(n===this.m_topoGraph.getHalfEdgePrev(a))return s}let i=n,o=v;for(;i!==t;){let a=this.getCombinedHalfEdgeParentage(i);if(this.isGoodParentage(a)){if(o!==v)return v;o=this.m_topoGraph.getHalfEdgeTwin(i)}i=this.m_topoGraph.getHalfEdgeTwin(this.m_topoGraph.getHalfEdgeNext(i))}return o}isOnALoop(t,e){let s=t,n=2*this.m_topoGraph.getShape().getTotalPointCount()+10;for(let i=0;i<n;i++){if(this.m_topoGraph.getHalfEdgeUserIndex(s,e)===1)return!1;let o=this.m_topoGraph.getHalfEdgeNext(s);if(o===this.m_topoGraph.getHalfEdgeTwin(s))return!1;if(s=o,s===t)return!0}j("is_on_a_loop_")}restorePolylineParts(t,e,s,n,i,o,a,h,m,l){w(i===v&&o>=0&&a>=0||o===-1&&a===-1),w(h===-1&&l.unsplitBehavior!==1||h!==-1&&l.unsplitBehavior===1);let u=l.ogcRule,c=l.allCrossRoadsImpassable,g=l.unsplitBehavior===1,d=l.unsplitBehavior===0,_=this.m_topoGraph.getShape(),p=_.hasSegmentParentage(),f=t,x=this.m_topoGraph.getHalfEdgeTwin(f),C=new et;this.m_fromEdgeForPolylines=v;let P=this.prevailingDirection(_,f),E=f,S=v,I=!1,D=!1,b=!1;if(!g)for(;;){let rt=this.m_topoGraph.getHalfEdgePrev(f);if(rt===x){b=!0;break}let Q=this.m_topoGraph.getHalfEdgeNext(x);if(this.m_topoGraph.isStrongPathNode(this.m_topoGraph.getHalfEdgeOrigin(Q))){I=!0;break}if(this.m_topoGraph.getHalfEdgeTwin(rt)!==Q){if(c){I=!0;break}if(f=this.tryMoveThroughCrossroadBackwards(f,!0),f===v){I=!0;break}x=this.m_topoGraph.getHalfEdgeTwin(f)}else f=rt,x=Q;if(this.m_topoGraph.getHalfEdgeUserIndex(f,s)===1){b=!0;break}if(f===t){S=t,D=!0;break}let ht=this.getCombinedHalfEdgeParentage(f);if(!this.isGoodParentage(ht))break;E=f,P+=this.prevailingDirection(_,f)}if(S===v){for(f=t,x=this.m_topoGraph.getHalfEdgeTwin(f),S=f;;){let Q=this.m_topoGraph.getHalfEdgeNext(f),ht=this.m_topoGraph.isStrongPathNode(this.m_topoGraph.getHalfEdgeOrigin(Q));if(ht){I=!0;break}if(Q===x){b=!0;break}if(h!==-1){let De=this.m_topoGraph.getHalfEdgeOrigin(x);if(this.m_topoGraph.getClusterUserIndex(De,h)===1){I=!0;break}}let it=this.m_topoGraph.getHalfEdgePrev(x);if(this.m_topoGraph.getHalfEdgeTwin(Q)!==it){if(ht||c){I=!0;break}if(f=this.tryMoveThroughCrossroadForward(f,!0),f===v){I=!0;break}x=this.m_topoGraph.getHalfEdgeTwin(f)}else f=Q,x=it;if(this.m_topoGraph.getHalfEdgeUserIndex(f,s)===1){b=!0;break}let mt=this.getCombinedHalfEdgeParentage(f);if(!this.isGoodParentage(mt))break;S=f,P+=this.prevailingDirection(_,f)}let rt=this.m_topoGraph.getHalfEdgeOrigin(E);D=this.m_topoGraph.getHalfEdgeTo(S)===rt}else if(this.m_fromEdgeForPolylines!==v){E=t,S=this.tryMoveThroughCrossroadBackwards(E,!1),w(S!==v);let rt=this.m_topoGraph.getHalfEdgeTwin(E);this.m_topoGraph.getHalfEdgeNext(rt)}let T=D;D||b||m&&(T=this.isOnALoop(t,s),T||(T=this.isOnALoop(x,s)));let A=P>=0,G=!1;T&&I&&(D?(G=u,A&&(G||g||d)&&E!==t&&(w(!g),E=t,G=!1)):(g||A&&d)&&(E=t));let F=0;for(f=E;x=this.m_topoGraph.getHalfEdgeTwin(f),this.m_topoGraph.setHalfEdgeUserIndex(f,s,1),this.m_topoGraph.setHalfEdgeUserIndex(x,s,1),F++,f!==S;)f=c?this.m_topoGraph.getHalfEdgeNext(f):this.tryMoveThroughCrossroadForward(f,!1);A||(S=O(E,E=S),S=this.m_topoGraph.getHalfEdgeTwin(S),E=this.m_topoGraph.getHalfEdgeTwin(E));let M=_.insertPath(e,v);f=E;let q=this.m_topoGraph.getHalfEdgeOrigin(E),R;R=o!==-1?this.chooseVertexByOrder(q,_,o,a):this.chooseVertexFromCluster_(q,i),this.m_topoGraph.isStrongPathNode(q)&&_.setStrongPathStart(M,!0);let X=_.addVertex(M,R),z=X;n!==-1&&this.m_topoGraph.setClusterUserIndex(q,n,1);let Y=0,L=G?Math.trunc((F+1)/2):-1,W=v,K=!0,yt=v;for(;;){if(p){let it=this.m_topoGraph.getSegmentParentage(f),mt=this.m_topoGraph.getHalfEdgeOrigin(f);_.setSegmentParentageAndBreak(z,it,K||this.m_topoGraph.isBreakNode(mt))}K=!1,this.m_topoGraph.isHalfEdgeCurve(f)&&(this.m_topoGraph.querySegmentXY(f,C),_.setSegmentToIndex(_.getVertexIndex(z),C.get().clone())),W!==v&&a!==-1&&_.addToUserIndex(W,a,-1);let rt=c?this.m_topoGraph.getHalfEdgeNext(f):this.tryMoveThroughCrossroadForward(f,!1),Q=this.m_topoGraph.getHalfEdgeTo(f),ht;if(ht=o!==-1?this.chooseVertexByOrder(Q,_,o,a):this.chooseVertexFromCluster_(Q,i),X=_.addVertex(M,ht),yt=Q,n!==-1&&this.m_topoGraph.setClusterUserIndex(Q,n,1),p&&this.m_topoGraph.isBreakNode(Q)&&_.setSegmentParentageBreakVertex(X,!0),W=ht,Y++,G&&Y===L&&(M=_.insertPath(e,v),X=_.addVertex(M,ht),K=!0,a!==-1&&_.addToUserIndex(ht,a,-1),W=v),f===S)break;f=rt,z=X}yt!==v&&this.m_topoGraph.isStrongPathNode(yt)&&_.setStrongPathEnd(M,!0)}topoOperationPolylineSimplify_(t,e){return this.topoOperationPolylineSimplifyOrPolylineTopoHelper_(t,v,!1,e).first}topoOperationPolylineSimplifyOrPolylineTopoHelper_(t,e,s,n){w(e===v||t===v);let i=this.m_topoGraph.getShape(),o=d=>d=t===v?d===v?i.getFirstGeometry():i.getNextGeometry(d):d===v?t:v,a=i.createGeometry(N.enumPolyline),h=-1;s&&(h=this.m_topoGraph.createUserIndexForClusters());let m=this.m_topoGraph.createUserIndexForHalfEdges(),l=e===v?i.createUserIndex():-1,u=e===v?i.createUserIndex():-1,c=-1;if(n.unsplitBehavior===1){c=this.m_topoGraph.createUserIndexForClusters();for(let d=o(v);d!==v;d=o(d))for(let _=i.getFirstPath(d);_!==v;_=i.getNextPath(_)){{let p=i.getFirstVertex(_),f=this.m_topoGraph.getClusterFromVertex(p);this.m_topoGraph.setClusterUserIndex(f,c,1)}if(!i.isClosedPath(_)){let p=i.getLastVertex(_),f=this.m_topoGraph.getClusterFromVertex(p);this.m_topoGraph.setClusterUserIndex(f,c,1)}}}if(e===v){let d=0;for(let _=o(v);_!==v;_=o(_))for(let p=i.getFirstPath(_);p!==v;p=i.getNextPath(p))if(i.isClosedPath(p)){let f=i.getFirstVertex(p);for(let x=0,C=i.getPathSize(p);x<C;x++,f=i.getNextVertex(f))i.setUserIndex(f,l,d++),i.setUserIndex(f,u,2)}else{let f=i.getFirstVertex(p);i.setUserIndex(f,l,d++),i.setUserIndex(f,u,1);let x=i.getNextVertex(f);for(let C=1,P=i.getPathSize(p)-1;C<P;++C)i.setUserIndex(x,l,d++),i.setUserIndex(x,u,2),x=i.getNextVertex(x);i.setUserIndex(x,l,d++),i.setUserIndex(x,u,1)}}for(let d=o(v);d!==v;d=o(d))for(let _=i.getFirstPath(d);_!==v;_=i.getNextPath(_)){let p=i.getFirstVertex(_);for(let f=0,x=i.getPathSize(_);f<x;f++,p=i.getNextVertex(p)){let C=this.m_topoGraph.getHalfEdgeFromVertex(p);if(C===v||this.m_topoGraph.getHalfEdgeUserIndex(C,m)===1)continue;let P=this.getCombinedHalfEdgeParentage(C);if(this.isGoodParentage(P)){let E=f===0;this.restorePolylineParts(C,a,m,h,e,l,u,c,E,n)}}}let g=v;if(s){g=i.createGeometry(N.enumMultiPoint);let d=v;for(let _=this.m_topoGraph.getFirstCluster();_!==v;_=this.m_topoGraph.getNextCluster(_))if(this.progress_(),this.m_topoGraph.getClusterUserIndex(_,h)!==1){let p=this.m_topoGraph.getClusterParentage(_);if(this.isGoodParentage(p)){d===v&&(d=i.insertPath(g,v));let f=this.m_topoGraph.getClusterVertexIterator(_);if(f!==v){let x;this.m_topoGraph.getVertexFromVertexIterator(f),x=l!==-1?this.chooseVertexByOrder(_,i,l,u):this.chooseVertexFromCluster_(_,e),i.addVertex(d,x)}}}}return u!==-1&&i.removeUserIndex(u),l!==-1&&i.removeUserIndex(l),h!==-1&&i.removeUserIndex(h),this.m_topoGraph.deleteUserIndexForHalfEdges(m),Kt(a,g)}difference(t,e){let s=this.m_topoGraph.getShape().getGeometryType(t),n=this.m_topoGraph.getShape().getGeometryType(e),i=Te(s),o=Te(n);if(i>o)return t;let a=this.m_topoGraph.getGeometryID(t),h=this.m_topoGraph.getGeometryID(e);if(this.m_maskLookup.length=0,this.m_maskLookup.length=1+(a|h),this.m_maskLookup[a]=!0,i===2&&o===2){let m=v;return this.m_topoGraph.getShape().getVertexDescription().getAttributeCount()>1&&(m=t),this.topoOperationPolygonPolygon_(t,e,m)}if(i===1&&o===2){let m=Ln();return m.allCrossRoadsImpassable=!1,m.ogcRule=this.m_bOGCOutput,m.unsplitBehavior=0,this.topoOperationPolylineSimplifyOrPolylineTopoHelper_(t,v,!1,m).first}if(i===1&&o===1){let m=Ln();return m.allCrossRoadsImpassable=!0,m.ogcRule=this.m_bOGCOutput,m.unsplitBehavior=0,this.topoOperationPolylineSimplifyOrPolylineTopoHelper_(t,v,!1,m).first}if(i===0)return this.topoOperationMultiPoint_();j("")}symmetricDifference(t,e){let s=this.m_topoGraph.getShape().getGeometryType(t),n=this.m_topoGraph.getShape().getGeometryType(e),i=Bo(s),o=Bo(n),a=this.m_topoGraph.getGeometryID(t),h=this.m_topoGraph.getGeometryID(e);return w(a>=0),w(h>=0),this.m_maskLookup.length=0,this.m_maskLookup.length=1+(a|h),this.m_maskLookup[a]=!0,this.m_maskLookup[a]=!0,this.m_maskLookup[h]=!0,i===2&&o===2?this.topoOperationPolygonPolygon_(t,e,v):i===1&&o===1?this.topoOperationPolyline_(v,this.m_bOGCOutput):i===0&&o===0?this.topoOperationMultiPoint():void j("")}planarSimplifyNoCrackingAndCluster(t,e,s,n){this.m_bOGCOutput=t,this.m_topoGraph=new As;let i=e.getFillRule(s),o=e.getGeometryType(s);if(i!==1||o===N.enumMultiPoint?this.m_topoGraph.setAndSimplifyEditShapeAlternate(e,s,this.m_progressTracker):this.m_topoGraph.setAndSimplifyEditShapeWinding(e,s,this.m_progressTracker),this.m_topoGraph.dirtyCheckFailed())return!1;this.m_topoGraph.setCheckDirtyPlanesweepTolerance(Number.NaN);let a=this.m_topoGraph.getGeometryID(s);if(w(a>=0),this.m_maskLookup.length=0,this.m_maskLookup.length=a+1,this.m_maskLookup[a]=!0,e.getGeometryType(s)===N.enumPolygon||i===1&&e.getGeometryType(s)!==N.enumMultiPoint){e.setFillRule(s,0);let h=this.topoOperationPolygonPolygon_(s,v,v);if(e.swapGeometry(h,s),e.removeGeometry(h),i===1&&this.m_bOGCOutput)return this.planarSimplifyNoCrackingAndCluster(t,e,s,n)}else if(e.getGeometryType(s)===N.enumPolyline){let h=Ln();h.ogcRule=this.m_bOGCOutput,h.allCrossRoadsImpassable=!0,h.unsplitBehavior=n;let m=this.topoOperationPolylineSimplify_(e.getFirstGeometry(),h);e.swapGeometry(m,s),e.removeGeometry(m)}else if(e.getGeometryType(s)===N.enumMultiPoint){let h=this.topoOperationMultiPoint_();e.swapGeometry(h,s),e.removeGeometry(h)}else j("");return!0}unsplitPolylineExact(t){return w(0),new dt}planarSimplifyPolylines(t,e,s,n,i){for(let g=t.getFirstGeometry();g!==v;g=t.getNextGeometry(g)){let d=t.getGeometryType(g);w(d===N.enumPolyline)}let o=0,a=0,h=null;if(t.hasCurves()&&!t.hasSegmentParentage()){h=new Be;let g=t.getEnvelope2D(this.m_progressTracker);a=zs(e.total());let d=us(e.total(),g);o=Os(d,a),Ss(t,d,e.total(),12e3,h,null,this.m_progressTracker)}{let g=v_(e.add(o));t.filterClosePoints(g,!1,!1,!1,v)}if(this.m_topoGraph=new As,i!==4&&i!==5)if(h===null&&s){let g=new qr(this.m_progressTracker,!1);g.sweepVertical(t,e.total()),g.hadComplications()?(Us(t,e,this.m_progressTracker,!0,!1),s=!1):this.m_topoGraph.setCheckDirtyPlanesweepTolerance(e.total())}else Us(t,e.add(o),this.m_progressTracker,!0,!1),s=!1;else s=!1;t.removeSelection(),t.collapseAllGeometriesToFirst();let m=t.getFirstGeometry();if(this.m_topoGraph.setAndSimplifyEditShapeAlternate(t,m,this.m_progressTracker),this.m_topoGraph.dirtyCheckFailed())return w(s&&h===null),this.m_topoGraph.removeShape(),this.m_topoGraph=null,this.planarSimplifyPolylines(t,e,!1,n,-1);this.m_topoGraph.setCheckDirtyPlanesweepTolerance(Number.NaN);let l=this.m_topoGraph.getGeometryID(m);w(l>=0),this.m_maskLookup.length=0,this.m_maskLookup.length=l+1,this.m_maskLookup[l]=!0;let u=this.topoOperationPolylineSimplify_(t.getFirstGeometry(),n);h!==null&&h.stitchCurves(t,u,a,!0);let c=t.getGeometry(u);return s||c.getImpl().setIsSimple(4,e.total()),c}planarSimplifyMultiPoints(t,e,s,n){for(let m=t.getFirstGeometry();m!==v;m=t.getNextGeometry(m)){let l=t.getGeometryType(m);w(l===N.enumMultiPoint)}this.m_topoGraph=new As,n!==4&&n!==5&&Us(t,e,this.m_progressTracker,!0,!1),s=!1,t.removeSelection(),t.collapseAllGeometriesToFirst();let i=t.getFirstGeometry();if(this.m_topoGraph.setAndSimplifyEditShapeAlternate(t,i,this.m_progressTracker),this.m_topoGraph.dirtyCheckFailed())return w(s),this.m_topoGraph.removeShape(),this.m_topoGraph=null,this.planarSimplifyMultiPoints(t,e,!1,-1);this.m_topoGraph.setCheckDirtyPlanesweepTolerance(Number.NaN);let o=this.m_topoGraph.getGeometryID(i);w(o>=0),this.m_maskLookup.length=0,this.m_maskLookup.length=o+1,this.m_maskLookup[o]=!0;let a=this.topoOperationMultiPoint(),h=t.getGeometry(a);return s||h.getImpl().setIsSimple(4,e.total()),h}planarSimplifyPolygons(t,e,s,n,i,o){for(let p=t.getFirstGeometry();p!==v;p=t.getNextGeometry(p)){let f=t.getGeometryType(p);w(f===N.enumPolygon||f===N.enumPolyline&&s)}let a=0,h=0,m=null;if(t.hasCurves()&&!t.hasSegmentParentage()){m=new Be;let p=t.getEnvelope2D(this.m_progressTracker);h=zs(e.total());let f=us(e.total(),p);a=Os(f,h),Ss(t,f,e.total(),12e3,m,null,this.m_progressTracker)}if(o){Us(t,e.add(a),this.m_progressTracker,!0,!1);for(let p=t.getFirstGeometry();p!==v;p=t.getNextGeometry(p))t.getGeometryType(p)===N.enumPolygon&&vn(t,p,-1,!1,v,this.m_progressTracker)}if(this.m_topoGraph=new As,o||i===4||i===5)n=!1;else if(m===null&&n){let p=new qr(this.m_progressTracker,!1);p.sweepVertical(t,e.total()),p.hadComplications()?(Us(t,e,this.m_progressTracker,!0,!1),n=!1):this.m_topoGraph.setCheckDirtyPlanesweepTolerance(e.total())}else Us(t,e.add(a),this.m_progressTracker,!0,!1),n=!1;t.removeSelection(),t.collapseAllGeometriesToFirst();let l=t.getFirstGeometry();if(s?this.m_topoGraph.setAndSimplifyEditShapeWinding(t,l,this.m_progressTracker):this.m_topoGraph.setAndSimplifyEditShapeAlternate(t,l,this.m_progressTracker),this.m_topoGraph.dirtyCheckFailed())return w(n&&m===null),this.m_topoGraph.removeShape(),this.m_topoGraph=null,this.planarSimplifyPolygons(t,e,s,!1,-1,!1);this.m_topoGraph.setCheckDirtyPlanesweepTolerance(Number.NaN);let u=this.m_topoGraph.getGeometryID(l);w(u>=0),this.m_maskLookup.length=0,this.m_maskLookup.length=u+1,this.m_maskLookup[u]=!0,t.setFillRule(l,0);let c=this.m_bOGCOutput&&s,g=c,d=this.topoOperationPolygonPolygon_(l,v,v,g);c&&(this.m_topoGraph.removeShape(),this.m_topoGraph=null,t.removeGeometry(l),this.m_topoGraph=new As,this.m_topoGraph.setAndSimplifyEditShapeAlternate(t,d,this.m_progressTracker),d=this.topoOperationPolygonPolygon_(d,v,v,!1)),m!==null&&m.stitchCurves(t,d,h,!0);let _=t.getGeometry(d);return _.setFillRule(0),n?_.getImpl().setIsSimple(3,0):(_.getImpl().setIsSimple(4,e.total()),_.getImpl().updateOGCFlagsProtected()),_}planarSimplify3DImpl_(t,e,s,n,i){return w(0),{}}planarSimplifyImpl_(t,e,s,n,i,o,a,h){if(t.isEmpty())return t.clone();let m=t.getGeometryType(),l=new Nt,u=l.addGeometry(t);if(Rs(i)&&m===N.enumPolygon&&(s=!1,l.setFillRule(u,0)),h&&(t.hasAttribute(1)&&l.replaceNaNs(1,0),l.removeNaNVertices()),m===N.enumPolygon||m===N.enumPolyline&&s)return this.planarSimplifyPolygons(l,e,s,n,i,!1);if(m===dt.type){let c=Ln();return c.allCrossRoadsImpassable=!0,c.ogcRule=this.m_bOGCOutput,c.unsplitBehavior=a,this.planarSimplifyPolylines(l,e,n,c,i)}if(m===N.enumMultiPoint)return this.planarSimplifyMultiPoints(l,e,n,i);j("what else?")}};function Gy(r,t,e,s){if(r.isEmpty())return r.createInstance();if(t.isEmpty())return s?r.createInstance():new st({copy:r});let n=[new y],i=[0],o=t.getDimension()===2;t.getDimension()!==1&&t.getDimension()!==2&&j(""),n[0]=r.getXY(),o?E_(t,n,1,e.total(),i):S_(t,n,1,e.total(),i);let a=i[0]===0;return s||(a=!a),a?r.createInstance():r}function Fy(r,t,e,s){let n=r.createInstance(),i=k(y,100),o=new Array(100),a=r.getPointCount(),h=!0,m=t.getDimension()===2;t.getDimension()!==1&&t.getDimension()!==2&&j("");for(let l=0;l<a;){let u=r.queryCoordinates(i,i.length,l,-1)-l;m?E_(t,i,u,e.total(),o):S_(t,i,u,e.total(),o);let c=0;for(let g=0;g<u;g++)o[g]===0&&(h&&(h=!1,n.addPoints(r,0,l)),c!==g&&n.addPoints(r,l+c,l+g),c=g+1);h||c===u||n.addPoints(r,l+c,l+u),l+=u}return h?r:n}function Je(r,t,e,s){let n=r.getGeometryType();if(n===N.enumEnvelope){let i=new lt({vd:r.getDescription()});return r.isEmpty()||i.addEnvelope(r,!1),i}if(n===N.enumPoint&&(s==="|"||s==="^")){let i=new Lt({vd:r.getDescription()});return r.isEmpty()||i.add(r),i}if(n===N.enumLine){let i=new dt({vd:r.getDescription()});return r.isEmpty()||i.addSegment(r,!0),i}if(n===N.enumMultiPoint&&s==="-"&&t.getGeometryType()===N.enumPoint){let i=new st({vd:r.getDescription()});return r.isEmpty()||r.getPointByVal(0,i),i}if(n===N.enumMultiPoint&&s==="&"&&t.getGeometryType()===N.enumPoint){let i=new st({vd:r.getDescription()});return r.isEmpty()||r.getPointByVal(0,i),i}return r}function $t(r){let t=r.getGeometryType();if(t===N.enumEnvelope){let e=new lt({vd:r.getDescription()});return r.isEmpty()||e.addEnvelope(r,!1),e}if(t===N.enumPoint){let e=new Lt({vd:r.getDescription()});return r.isEmpty()||e.add(r),e}if(vy(t)){let e=new dt({vd:r.getDescription()});return r.isEmpty()||e.addSegment(r,!0),e}return t!==N.enumMultiPoint&&t!==N.enumPolyline&&t!==N.enumPolygon&&U("Unexpected geometry type"),r}function Ym(r,t,e,s){let n=e===v?r.getClusterHalfEdge(t):e,i=n;w(r.getHalfEdgeOrigin(n)===t);do s(i),i=r.getHalfEdgeNext(r.getHalfEdgeTwin(i));while(i!==n)}var gl=class{constructor(t,e,s,n,i,o){this.m_rParent=t,this.m_rTopoGraph=t.m_topoGraph,this.m_rShape=this.m_rTopoGraph.getShape(),this.m_IDCuttee=this.m_rTopoGraph.getGeometryID(n),this.m_IDCutter=this.m_rTopoGraph.getGeometryID(i),this.m_IDBoth=this.m_IDCuttee|this.m_IDCutter,this.m_bConsiderTouch=e,this.m_sideIndex=s,this.m_cuttee=n,this.m_cutter=i,this.m_rCutHandles=o,this.m_cutteeBreadcrumbsIndex=this.m_rShape.createUserIndexUninitialized(),this.m_clusterParentageIndex=this.m_rShape.createUserIndexUninitialized();for(let a=this.m_rShape.getFirstPath(this.m_cuttee);a!==v;a=this.m_rShape.getNextPath(a)){let h=0,m=this.m_rShape.getPathSize(a);for(let l=this.m_rShape.getFirstVertex(a);h<m;h++,l=this.m_rShape.getNextVertex(l))this.m_rShape.setUserIndex(l,this.m_clusterParentageIndex,this.m_rTopoGraph.getClusterParentage(this.m_rTopoGraph.getClusterFromVertex(l)))}}Do(){this.cutPolylinePolyline_(),this.m_rShape.removeUserIndex(this.m_cutteeBreadcrumbsIndex),this.m_rShape.removeUserIndex(this.m_clusterParentageIndex)}setTbd(t){return 8|t}classifyStandardCut(t,e,s,n){let i=this.m_rShape.getPrevVertex(t),o=this.m_rShape.getNextVertex(t),a=i===v?v:this.m_rTopoGraph.getHalfEdgeConnector(e,this.m_rTopoGraph.getClusterFromVertex(i)),h=o===v?v:this.m_rTopoGraph.getHalfEdgeConnector(e,this.m_rTopoGraph.getClusterFromVertex(o)),m=this.m_rTopoGraph.getHalfEdgeConnector(e,this.m_rTopoGraph.getClusterFromVertex(s)),l=this.m_rTopoGraph.getHalfEdgeConnector(e,this.m_rTopoGraph.getClusterFromVertex(n)),u=1,c=32,g=32;if(Ym(this.m_rTopoGraph,e,l,d=>{d===m&&(u=2),d===a&&(c=u),d===h&&(g=u)}),this.m_bConsiderTouch)c!==32&&this.m_rShape.setUserIndex(i,this.m_cutteeBreadcrumbsIndex,this.m_rShape.getUserIndex(i,this.m_cutteeBreadcrumbsIndex)|c),g!==32&&this.m_rShape.setUserIndex(t,this.m_cutteeBreadcrumbsIndex,this.m_rShape.getUserIndex(t,this.m_cutteeBreadcrumbsIndex)|g);else{if(c===32||g===32||c===g&&!(a===m||a===l||h===m||h===l))return 1;this.m_rShape.setUserIndex(i,this.m_cutteeBreadcrumbsIndex,this.m_rShape.getUserIndex(i,this.m_cutteeBreadcrumbsIndex)|c),this.m_rShape.setUserIndex(t,this.m_cutteeBreadcrumbsIndex,this.m_rShape.getUserIndex(t,this.m_cutteeBreadcrumbsIndex)|g)}return 0}classifyTouchCut(t,e,s,n){let i=this.m_rShape.getPrevVertex(t),o=this.m_rShape.getNextVertex(t),a=i===v?v:this.m_rTopoGraph.getHalfEdgeConnector(e,this.m_rTopoGraph.getClusterFromVertex(i)),h=o===v?v:this.m_rTopoGraph.getHalfEdgeConnector(e,this.m_rTopoGraph.getClusterFromVertex(o)),m=s===v?v:this.m_rTopoGraph.getHalfEdgeConnector(e,this.m_rTopoGraph.getClusterFromVertex(s)),l=n===v?v:this.m_rTopoGraph.getHalfEdgeConnector(e,this.m_rTopoGraph.getClusterFromVertex(n));if(!this.m_bConsiderTouch){let u;return(u=m===a||l===a)?this.m_rShape.setUserIndex(t,this.m_cutteeBreadcrumbsIndex,this.setTbd(this.m_rShape.getUserIndex(t,this.m_cutteeBreadcrumbsIndex))):(u=m===h||l===h)&&this.m_rShape.setUserIndex(i,this.m_cutteeBreadcrumbsIndex,this.setTbd(this.m_rShape.getUserIndex(i,this.m_cutteeBreadcrumbsIndex))),u?0:1}if(a===v)return this.m_rShape.setUserIndex(t,this.m_cutteeBreadcrumbsIndex,this.setTbd(this.m_rShape.getUserIndex(t,this.m_cutteeBreadcrumbsIndex))),0;if(h===v)return this.m_rShape.setUserIndex(i,this.m_cutteeBreadcrumbsIndex,this.setTbd(this.m_rShape.getUserIndex(i,this.m_cutteeBreadcrumbsIndex))),0;if(a===h)return this.m_rShape.setUserIndex(i,this.m_cutteeBreadcrumbsIndex,this.setTbd(this.m_rShape.getUserIndex(i,this.m_cutteeBreadcrumbsIndex))),this.m_rShape.setUserIndex(t,this.m_cutteeBreadcrumbsIndex,this.setTbd(this.m_rShape.getUserIndex(t,this.m_cutteeBreadcrumbsIndex))),0;if(l!==v){if(a===l)return this.m_rShape.setUserIndex(t,this.m_cutteeBreadcrumbsIndex,this.setTbd(this.m_rShape.getUserIndex(t,this.m_cutteeBreadcrumbsIndex))),0;if(h===l)return this.m_rShape.setUserIndex(i,this.m_cutteeBreadcrumbsIndex,this.setTbd(this.m_rShape.getUserIndex(i,this.m_cutteeBreadcrumbsIndex))),0;let u=1;Ym(this.m_rTopoGraph,e,l,c=>{if(c===a){let g=this.m_rShape.getUserIndex(i,this.m_cutteeBreadcrumbsIndex)|u;this.m_rShape.setUserIndex(i,this.m_cutteeBreadcrumbsIndex,g),u=2}else if(c===h){let g=this.m_rShape.getUserIndex(t,this.m_cutteeBreadcrumbsIndex)|u;this.m_rShape.setUserIndex(t,this.m_cutteeBreadcrumbsIndex,g),u=2}})}else{if(a===m)return this.m_rShape.setUserIndex(t,this.m_cutteeBreadcrumbsIndex,this.setTbd(this.m_rShape.getUserIndex(t,this.m_cutteeBreadcrumbsIndex))),0;if(h===m)return this.m_rShape.setUserIndex(i,this.m_cutteeBreadcrumbsIndex,this.setTbd(this.m_rShape.getUserIndex(i,this.m_cutteeBreadcrumbsIndex))),0;let u=2;Ym(this.m_rTopoGraph,e,m,c=>{if(c===a){let g=this.m_rShape.getUserIndex(i,this.m_cutteeBreadcrumbsIndex)|u;this.m_rShape.setUserIndex(i,this.m_cutteeBreadcrumbsIndex,g),u=1}else if(c===h){let g=this.m_rShape.getUserIndex(t,this.m_cutteeBreadcrumbsIndex)|u;this.m_rShape.setUserIndex(t,this.m_cutteeBreadcrumbsIndex,g),u=1}})}return 0}classifyCutVertex(t,e){let s=0,n=0;for(let i=this.m_rTopoGraph.getClusterVertexIterator(e);i!==v;i=this.m_rTopoGraph.incrementVertexIterator(i)){let o=this.m_rTopoGraph.getVertexFromVertexIterator(i);if(this.m_rShape.getGeometryFromVertex(o)===this.m_cutter){n++;let a=this.m_rShape.getPrevVertex(o),h=this.m_rShape.getNextVertex(o);s+=a===v||h===v?this.classifyTouchCut(t,e,a,h):this.classifyStandardCut(t,e,a,h)}}n&&s===n&&!this.m_bConsiderTouch&&this.m_rShape.setUserIndex(t,this.m_clusterParentageIndex,this.m_IDCuttee)}cutPolylinePolyline_(){this.m_rShape.getGeometryType(this.m_cuttee),this.m_rShape.getGeometryType(this.m_cutter),this.m_rParent.m_maskLookup.length=0,this.m_rParent.m_maskLookup.length=this.m_IDBoth+1,this.m_rParent.m_maskLookup[this.m_IDBoth]=!0;for(let a=this.m_rShape.getFirstPath(this.m_cuttee);a!==v;a=this.m_rShape.getNextPath(a)){let h=this.m_rShape.getPathSize(a),m=this.m_rShape.getFirstVertex(a);for(let l=0;l<h;++l,m=this.m_rShape.getNextVertex(m))this.m_rShape.setUserIndex(m,this.m_cutteeBreadcrumbsIndex,0);m=this.m_rShape.getFirstVertex(a);for(let l=0;l<h;++l,m=this.m_rShape.getNextVertex(m)){let u=this.m_rTopoGraph.getClusterFromVertex(m);this.m_rTopoGraph.getClusterParentage(u)===this.m_IDBoth&&this.classifyCutVertex(m,u)}}let t=(a,h)=>{let m=this.m_rShape.getUserIndex(a,this.m_cutteeBreadcrumbsIndex),l=this.m_rTopoGraph.getHalfEdgeConnector(this.m_rTopoGraph.getClusterFromVertex(a),this.m_rTopoGraph.getClusterFromVertex(h));return(this.m_rTopoGraph.getHalfEdgeParentage(l)&this.m_IDBoth)===this.m_IDBoth&&(m|=4),m};for(let a=this.m_rShape.getFirstPath(this.m_cuttee);a!==v;a=this.m_rShape.getNextPath(a)){let h=this.m_rShape.getFirstVertex(a),m=this.m_rShape.isClosedPath(a),l=this.m_rShape.getPathSize(a)+(m?1:0),u=1,c=32;for(let d=this.m_rShape.getNextVertex(h);u<l;++u,h=d,d=this.m_rShape.getNextVertex(d)){let _=t(h,d);this.m_rShape.getUserIndex(h,this.m_clusterParentageIndex)===this.m_IDBoth&&(c=_),c!==32&&this.m_rShape.setUserIndex(h,this.m_cutteeBreadcrumbsIndex,c|_)}h=this.m_rShape.getLastVertex(a);let g=32;u=1;for(let d=this.m_rShape.getPrevVertex(h);u<l;++u,h=d,d=this.m_rShape.getPrevVertex(d)){let _=t(d,h);this.m_rShape.getUserIndex(h,this.m_clusterParentageIndex)===this.m_IDBoth&&(g=_),g!==32&&this.m_rShape.setUserIndex(d,this.m_cutteeBreadcrumbsIndex,g|_)}}let e=v,s=v,n=32,i=this.m_rShape.hasSegmentParentage(),o=new et;for(let a=this.m_rShape.getFirstPath(this.m_cuttee);a!==v;a=this.m_rShape.getNextPath(a)){let h=this.m_rShape.isClosedPath(a),m=this.m_rShape.getPathSize(a)+(h?1:0),l=1,u=this.m_rShape.getFirstVertex(a),c=v,g=!0;for(let d=this.m_rShape.getNextVertex(u);l<m;++l,d=this.m_rShape.getNextVertex(d)){let _=this.m_rShape.getUserIndex(u,this.m_cutteeBreadcrumbsIndex);_===8?_=3:(_&=-9,4&_?_=4:3&~_||(_=3)),_!==n?(e!==v&&(c=this.m_rShape.addVertex(s,u),i&&this.m_rTopoGraph.isBreakNode(this.m_rTopoGraph.getClusterFromVertex(u))&&this.m_rShape.setSegmentParentageBreakVertex(c,!0),this.m_rCutHandles.push(e),this.m_rShape.setGeometryUserIndex(e,this.m_sideIndex,n)),e=this.m_rShape.createGeometry(N.enumPolyline),s=this.m_rShape.insertPath(e,v),n=_,g=!0):this.m_rShape.getUserIndex(u,this.m_clusterParentageIndex)===this.m_IDBoth&&_!==4&&(c=this.m_rShape.addVertex(s,u),i&&this.m_rTopoGraph.isBreakNode(this.m_rTopoGraph.getClusterFromVertex(u))&&this.m_rShape.setSegmentParentageBreakVertex(c,!0),s=this.m_rShape.insertPath(e,v),g=!0),c=this.m_rShape.addVertex(s,u);let p=this.m_rTopoGraph.getClusterFromVertex(u);!g&&i&&this.m_rTopoGraph.isBreakNode(p)&&this.m_rShape.setSegmentParentageBreakVertex(c,!0);let f=this.m_rTopoGraph.getHalfEdgeFromVertex(u);if(i){let x=this.m_rTopoGraph.getSegmentParentage(f);this.m_rShape.setSegmentParentageAndBreak(c,x,g||this.m_rTopoGraph.isBreakNode(p))}this.m_rTopoGraph.isHalfEdgeCurve(f)&&(this.m_rTopoGraph.querySegmentXY(f,o),this.m_rShape.setSegmentToIndex(this.m_rShape.getVertexIndex(c),o.get().clone())),u=d,g=!1}c=this.m_rShape.addVertex(s,u),i&&this.m_rTopoGraph.isBreakNode(this.m_rTopoGraph.getClusterFromVertex(u))&&this.m_rShape.setSegmentParentageBreakVertex(c,!0),this.m_rCutHandles.push(e),this.m_rShape.setGeometryUserIndex(e,this.m_sideIndex,n),e=v,s=v,n=32}}};function rS(r,t,e){return new Ye(e).linesToPolygonsImpl(r,t)}function Vy(r,t,e,s,n){if(s&&(s.m_reason=0,s.m_vertexIndex1=-1,s.m_vertexIndex2=-1),r.isEmpty())return 5;let i=r.getGeometryType();if(i===N.enumPoint)return Wr(r,s);let o=Ae(t,r,!1).total();if(i===N.enumEnvelope){let u=r,c=new V;return u.queryEnvelope(c),c.isDegenerate(o)?(s&&(s.m_reason=4,s.m_vertexIndex1=-1,s.m_vertexIndex2=-1),0):5}if(Qt(i)){let u=r,c=new dt({vd:u.getDescription()});return c.addSegment(u,!0),jl(c,t,e,s,n)}let a=[0],h=r.getImpl().getIsSimple(o,a),m=e?-1:h;if(Qs(m)||m===0)return m;let l=new vi(r,t,m,n,!1);return i===N.enumMultiPoint||i===N.enumPolyline||i===N.enumPolygon?m=l.isSimplePlanarImpl():j(""),r.getImpl().setIsSimple(m,o),s&&s.assign(l.m_nonSimpleResult),m}function qy(r,t,e,s,n){if(s&&(s.m_reason=0,s.m_vertexIndex1=-1,s.m_vertexIndex2=-1),r.isEmpty())return 5;let i=r.getGeometryType();if(i===N.enumPoint)return Wr(r,s);let o=Ae(t,r,!1).total();if(i===N.enumEnvelope){let u=r,c=new V;return u.queryEnvelope(c),c.isDegenerate(o)?(s&&(s.m_reason=4,s.m_vertexIndex1=-1,s.m_vertexIndex2=-1),0):5}if(Qt(i)){let u=r,c=new dt({vd:u.getDescription()});return c.addSegment(u,!0),qy(c,t,e,s,n)}Qr(i),Ie(i)||ft("OGC simplify is not implemented for this geometry type");let a=[0],h=r.getImpl().getIsSimple(o,a),m=e?-1:h;if(m===5||m===0)return m;let l=new vi(r,t,m,n,!0);return i===N.enumMultiPoint||i===N.enumPolyline||i===N.enumPolygon?(m=l.isSimplePlanarImpl(),Qs(m)&&(m=5)):j(""),r.getImpl().setIsSimple(m,o),s&&s.assign(l.m_nonSimpleResult),m}function jl(r,t,e,s,n){if(s&&(s.m_reason=0,s.m_vertexIndex1=-1,s.m_vertexIndex2=-1),r.isEmpty())return 5;let i=r.getGeometryType();if(i===N.enumPoint)return Wr(r,s);let o=Ae(t,r,!1).total();if(i===N.enumEnvelope){let u=r,c=V.constructEmpty();return u.queryEnvelope(c),c.isDegenerate(o)?(s&&(s.m_reason=4,s.m_vertexIndex1=-1,s.m_vertexIndex2=-1),0):5}if(Qt(i)){let u=r,c=new dt({vd:u.getDescription()});return c.addSegment(u,!0),jl(c,t,e,s,n)}let a=[0],h=r.getImpl().getIsSimple(o,a),m=e?-1:h;if(m!==-1)return m;let l=new vi(r,t,m,n,!1);return i===N.enumMultiPoint?m=l.multipointIsSimpleAsFeature():i===N.enumPolyline?m=l.polylineIsSimpleAsFeature():i===N.enumPolygon?m=l.polygonIsSimpleAsFeature():j(""),r.getImpl().setIsSimple(m,o),s&&s.assign(l.m_nonSimpleResult),m}function I_(r,t,e,s){if(r.isEmpty())return r;let n=r.getGeometryType();if(n===N.enumPoint){let u=new vt;if(Wr(r,u),u.m_reason===3){let c=r.clone();return c.replaceNaNs(1,0),c}return u.m_reason===2?r.createInstance():r}if(n===N.enumEnvelope){let u=Ae(t,r,!0).total(),c=r,g=V.constructEmpty();return c.queryEnvelope(g),g.isDegenerate(u)?c.createInstance():r}if(Qt(n)){let u=r,c=new dt({vd:u.getDescription()});return c.addSegment(u,!0),I_(c,t,e,s)}Qr(n);let i=Ae(t,r,!1).total(),o=[0],a=r.getImpl().getIsSimple(i,o),h=e?-1:a;if(Qs(h)){if(n===N.enumPolygon&&r.getFillRule()!==0){let u=r.clone();return u.setFillRule(0),u}return r}if((n===N.enumMultiPoint||n===N.enumPolyline)&&h>=1)return r;let m=new vi(r,t,h,s,!1),l;return n===N.enumMultiPoint?l=m.multipointSimplifyAsFeature():n===N.enumPolyline?l=m.polylineSimplifyAsFeature():n===N.enumPolygon?l=m.polygonSimplifyAsFeature():j(""),l}function Yy(r,t,e,s){if(r.isEmpty())return r;let n=r.getGeometryType();if(n===N.enumPoint){let m=new vt;if(Wr(r,m),m.m_reason===3){let l=r.clone();return l.replaceNaNs(1,0),l}return m.m_reason===2?r.createInstance():r}if(n===N.enumEnvelope){let m=r,l=new V;m.queryEnvelope(l);let u=Ae(t,r,!0).total();return l.isDegenerate(u)?m.createInstance():r}if(Qt(n)){let m=r,l=new dt({vd:m.getDescription()});return l.addSegment(m,!0),Yy(l,t,e,s)}Qr(n),Ie(n)||ft("OGC simplify is not implemented for this geometry type");let i=Ae(t,r,!1).total(),o=[0],a=r.getImpl().getIsSimple(i,o),h=e?-1:a;if(h===5){if(n===N.enumPolygon&&r.getFillRule()!==0){let m=r.clone();return m.setFillRule(0),m}return r}return ul(r,Ae(t,r,!0),!1,h,s,0,!0)}function Wr(r,t){let e=r.getX(),s=r.getY();if(!Number.isFinite(e)||!Number.isFinite(s))return t&&(t.m_reason=2,t.m_vertexIndex1=-1,t.m_vertexIndex2=-1),0;if(r.hasAttribute(1)){let n=r.getZ();if(!Number.isFinite(n))return t&&(t.m_reason=Number.isNaN(n)?3:2,t.m_vertexIndex1=-1,t.m_vertexIndex2=-1),0}return 5}var xa=class{constructor(){this.m_segment=null,this.m_vertexIndex=-1,this.m_pathIndex=-1,this.m_flags=0}setReversed(t){this.m_flags&=-2,this.m_flags=this.m_flags|(t?1:0)}getReversed(){return!!(1&this.m_flags)}getRightSide(){return this.getReversed()?0:1}};function Xy(){return{x:-1,y:-1,ipath:-1,ivertex:-1,ipolygon:-1}}function ky(r,t,e,s,n){return{x:r,y:t,ipath:e,ivertex:s,ipolygon:n}}function Ry(r,t){return r.x===t.x&&r.y===t.y&&r.ipath===t.ipath&&r.ivertex===t.ivertex&&r.ipolygon===t.ipolygon}function Hy(r,t){r.x=t.x,r.y=t.y,r.ipath=t.ipath,r.ivertex=t.ivertex,r.ipolygon=t.ipolygon}function Ly(){return{x:-1,y:-1,ipath:-1,ivertex:-1,bBoundary:!1,bEndPoint:!1}}function By(r,t,e,s,n,i){return{x:r,y:t,ipath:e,ivertex:s,bBoundary:n,bEndPoint:i}}function Uy(r,t){r.x=t.x,r.y=t.y,r.ipath=t.ipath,r.ivertex=t.ivertex,r.bBoundary=t.bBoundary,r.bEndPoint=t.bEndPoint}var dl=class extends Gn{constructor(t){super(),this.m_helper=t}compare(t,e,s){let n=t.getElement(s),i=this.m_helper.m_xy.read(2*e)-this.m_helper.m_xy.read(2*n);return i<0?-1:i>0?1:0}},_l=class extends Gn{constructor(t){super(),this.m_helper=t}compare(t,e,s){let n=t.getElement(s),i=this.m_helper.m_edges[e],o=this.m_helper.m_edges[n],a=i.getReversed(),h=o.getReversed(),m=i.m_segment.intersectionOfYMonotonicWithAxisX(this.m_helper.m_yScanline,0),l=o.m_segment.intersectionOfYMonotonicWithAxisX(this.m_helper.m_yScanline,0);if(m===l){let u=a?i.m_segment.getStartY():i.m_segment.getEndY(),c=h?o.m_segment.getStartY():o.m_segment.getEndY(),g=Math.min(u,c),d=.5*(g-this.m_helper.m_yScanline)+this.m_helper.m_yScanline;d===this.m_helper.m_yScanline&&(d=g),m=i.m_segment.intersectionOfYMonotonicWithAxisX(d,0),l=o.m_segment.intersectionOfYMonotonicWithAxisX(d,0)}return m<l?-1:m>l?1:0}},vi=class r{constructor(t,e,s,n,i){this.m_multiVertexGeom=null,this.m_edges=[],this.m_freeEdges=[],this.m_lineEdgesRecycle=[],this.m_newEdges=[],this.m_recycledSegIter=null,this.m_crossOverHelperList=new ln,this.m_progressTracker=null,this.m_progressCounter=0,this.m_AET=new Ot,this.m_xyToNode1=null,this.m_xyToNode2=null,this.m_pathOrientations=null,this.m_pathParentage=null,this.m_xy=null,this.m_pairs=[],this.m_pairIndices=null,this.m_pathsForOGCTests=[],this.m_curveStitcher=null,this.m_editShape=null,this.m_multiPathStitcher=null,this.m_nonSimpleResult=new vt,this.m_progressCounter=0,this.m_progressTracker=n,this.m_geometry=t,this.m_knownSimpleResult=s,this.m_sr=e;let o=Ae(e,t,!1);this.m_toleranceIsSimple=o,this.m_toleranceIsSimpleClustering=ke(o),this.m_toleranceIsSimpleCracking=ro(o),this.m_toleranceSimplify=Ae(e,t,!0),this.m_description=this.m_geometry.getDescription(),this.m_attributeCount=this.m_description.getAttributeCount(),this.m_bOGCRestrictions=i,this.m_bPlanarSimplify=this.m_bOGCRestrictions,this.m_unknownOrientationPathCount=-1,this.m_yScanline=0,this.m_progressCounter=0}isSimplePlanarImpl(){if(this.m_bPlanarSimplify=!0,!this.checkStructure())return 0;let t=this.m_geometry.getGeometryType();return at(t)&&!this.checkDegenerateSegments(!1)?0:this._CheckClustering()?at(t)?this._CheckCracking()?this.m_geometry.getGeometryType()===N.enumPolyline?this.checkSelfIntersectionsPolylinePlanar()?4:0:this._CheckSelfIntersections()?this._CheckValidRingOrientation():0:0:5:0}isSimplePlanarImpl3D(){return w(0),7}generateSortedPairs(t){let e=null;at(t.getGeometryType())&&(e=t);let s=(this.m_bPlanarSimplify||this.m_bOGCRestrictions)&&e!==null,n=t.getPointCount();this.m_xy=t.getAttributeStreamRef(0),this.m_pairs.length=0,this.m_pairIndices=new he(0),s&&(this.m_pathsForOGCTests.length=0);let i=0;for(let h=0;h<n;h++)if(this.m_pairs.push(2*h),this.m_pairs.push(2*h+1),this.m_pairIndices.add(2*h),this.m_pairIndices.add(2*h+1),s){for(;h>=e.getPathEnd(i);)i++;this.m_pathsForOGCTests.push(i)}let o=new ei,a={parent:this,workPt:new y,userSort(h,m,l){l.sort(h,m,(u,c)=>this.parent.compareVerticesForPlanarClustering(u,c,s))},getValue(h){let m=this.parent.m_pairs[h],l=m>>1;return this.parent.m_xy.queryPoint2D(2*l,this.workPt),this.workPt.y+(1&m?this.parent.m_toleranceIsSimpleClustering:-this.parent.m_toleranceIsSimpleClustering)}};o.sort(this.m_pairIndices,0,2*n,a)}_TestToleranceDistancePlanar(t,e){let s=this.m_xy.read(2*t),n=this.m_xy.read(2*t+1),i=this.m_xy.read(2*e),o=this.m_xy.read(2*e+1);return Ul(s,n,i,o,this.m_toleranceIsSimpleClustering*this.m_toleranceIsSimpleClustering)?this.m_geometry.getDimension()===0?!1:s===i&&n===o:!0}checkStructure(){let t=this.m_geometry.getGeometryType();if(at(t)){let e=this.m_geometry.getImpl(),s=this.m_geometry.getGeometryType()===N.enumPolygon?3:2;for(let n=0,i=e.getPathCount();n<i;n++)if(e.getPathSize(n)<s){if(e.hasNonLinearSegments()&&e.hasNonLinearSegmentsPath(n)&&e.getPathSize(n)>0)continue;return this.m_nonSimpleResult=new vt(1,n,0),!1}}if(Ie(t)){let e=this.m_geometry.getImpl(),s=e.getAttributeStreamRef(0);for(let n=0,i=e.getPointCount();n<i;n++)if(!s.readPoint2D(2*n).isFinite())return this.m_nonSimpleResult=new vt(2,n,0),!1;if(this.m_geometry.hasAttribute(1)){let n=e.getAttributeStreamRef(1);for(let i=0,o=e.getPointCount();i<o;i++){let a=n.read(i);if(!Number.isFinite(a))return Number.isNaN(a)?this.m_nonSimpleResult=new vt(3,i,0):this.m_nonSimpleResult=new vt(2,i,0),!1}}}return!0}checkDegenerateSegments(t){let e=this.m_geometry.getImpl(),s=e.querySegmentIterator(),n=e.hasAttribute(1),i=n?oh(this.m_sr,e,!1).total():0,o=e.hasNonLinearSegments(),a=this.m_toleranceIsSimple.total();for(;s.nextPath();)for(;s.hasNextSegment();){let h=s.nextSegment(),m=h.calculateLowerLength2D();if(!(m>a)&&!(o&&h.isCurve()&&(m=h.calculateLength2D(),m>a))){if(t&&n){let l=h.getStartAttributeAsDbl(1,0),u=h.getEndAttributeAsDbl(1,0);if(Math.abs(u-l)>i)continue}return this.m_nonSimpleResult=new vt(4,s.getStartPointIndex(),-1),!1}}return!0}checkDegenerateSegments3D(){return w(0),!1}_CheckClustering(){let t=this.m_geometry.getImpl();this.generateSortedPairs(t);let e=t.getPointCount();this.m_AET.clear(),this.m_AET.setComparator(new dl(this)),this.m_AET.setCapacity(e);for(let s=0,n=2*e;s<n;s++){this.progress_();let i=this.m_pairIndices.read(s),o=this.m_pairs[i],a=o>>1;if(1&o){let h=this.m_AET.search(a),m=this.m_AET.getPrev(h),l=this.m_AET.getNext(h);if(this.m_AET.deleteNode(h),m!==Ot.st_nullNode()&&l!==Ot.st_nullNode()&&!this._TestToleranceDistancePlanar(this.m_AET.getElement(m),this.m_AET.getElement(l)))return this.m_nonSimpleResult=new vt(5,this.m_AET.getElement(m),this.m_AET.getElement(l)),!1}else{let h=this.m_AET.addElement(a),m=this.m_AET.getPrev(h);if(m!==Ot.st_nullNode()&&!this._TestToleranceDistancePlanar(this.m_AET.getElement(m),a))return this.m_nonSimpleResult=new vt(5,a,this.m_AET.getElement(m)),!1;let l=this.m_AET.getNext(h);if(l!==Ot.st_nullNode()&&!this._TestToleranceDistancePlanar(this.m_AET.getElement(l),a))return this.m_nonSimpleResult=new vt(5,a,this.m_AET.getElement(l)),!1}}return!0}_CheckCracking(){let t=this.m_geometry.getImpl(),e=t.getPointCount();return!t.hasNonLinearSegments()&&e<10?this._CheckCrackingBrute():this._CheckCrackingPlanesweep()}_CheckCrackingPlanesweep(){if(this.m_editShape=new Nt,this.m_editShape.addGeometry(this.m_geometry),this.m_editShape.hasCurves()){this.m_curveStitcher=new Be;let e=V.constructEmpty();this.m_geometry.queryEnvelope(e);let s=us(this.m_toleranceSimplify.total(),e),n=new vt;if(_y(this.m_editShape,s,this.m_toleranceSimplify.total(),12e3,n,this.m_curveStitcher,null,this.m_progressTracker),n.m_reason!==0)return this.m_editShape=null,this.m_nonSimpleResult.assign(n),!1}let t=new vt;return zl(!1,this.m_editShape,this.m_toleranceIsSimpleCracking,t,this.m_progressTracker)?(this.m_curveStitcher!=null?(t.m_vertexIndex1=this.m_curveStitcher.getOriginalVertexIndex(this.m_editShape,t.m_vertexIndex1),t.m_vertexIndex2=this.m_curveStitcher.getOriginalVertexIndex(this.m_editShape,t.m_vertexIndex2),this.m_curveStitcher=null):(t.m_vertexIndex1=this.m_editShape.getVertexIndex(t.m_vertexIndex1),t.m_vertexIndex2=this.m_editShape.getVertexIndex(t.m_vertexIndex2)),this.m_editShape=null,this.m_nonSimpleResult.assign(t),!1):(this.m_curveStitcher==null&&(this.m_editShape=null),!0)}_CheckCrackingBrute(){let t=this.m_geometry.getImpl(),e=t.querySegmentIterator(),s=t.querySegmentIterator();for(;e.nextPath();)for(;e.hasNextSegment();){let n=e.nextSegment();if(!e.isLastSegmentInPath()||!e.isLastPath()){s.resetTo(e);do for(;s.hasNextSegment();){let i=s.nextSegment(),o=Hn(!0,n,i,this.m_toleranceIsSimpleCracking,!0);if(o){let a=o===2?7:6;return this.m_nonSimpleResult=new vt(a,e.getStartPointIndex(),s.getStartPointIndex()),!1}}while(s.nextPath())}}return!0}_CheckSelfIntersections(){let t=this.m_geometry.getImpl();this.m_curveStitcher!==null&&(this.m_multiPathStitcher=this.m_editShape.getGeometry(this.m_editShape.getFirstGeometry()),t=this.m_multiPathStitcher.getImpl(),this.generateSortedPairs(t)),this.m_edges.length=0,this.m_lineEdgesRecycle.length=0,this.m_recycledSegIter=t.querySegmentIterator(),this.m_recycledSegIter.setCirculator(!0);let e=[],s=t.getPointCount(),n=Number.NaN,i=0;for(let o=0,a=2*s;o<a;o++){this.progress_();let h=this.m_pairIndices.read(o),m=this.m_pairs[h];if(1&m)continue;let l=m>>1,u=this.m_xy.read(2*l),c=this.m_xy.read(2*l+1);if(e.length&&(u!==n||c!==i)){if(!this.processBunchForSelfIntersectionTest(e))return!1;e.length=0}e.push(l),n=u,i=c}return!!this.processBunchForSelfIntersectionTest(e)}checkSelfIntersectionsPolylinePlanar(){let t=this.m_geometry.getImpl(),e=[];for(let a=0,h=t.getPathCount();a<h;a++)e.push(t.isClosedPathInXYPlane(a));let s=Ly(),n,i,o;{let a=this.m_pairIndices.read(0),h=this.m_pairs[a]>>1,m=this.m_xy.readPoint2D(2*h),l=this.m_pathsForOGCTests[h];n=e[l],i=t.getPathStart(l),o=t.getPathEnd(l)-1,s.bEndPoint=h===i||h===o,this.m_bOGCRestrictions?s.bBoundary=!n&&s.bEndPoint:s.bBoundary=s.bEndPoint,s.ipath=l,s.x=m.x,s.y=m.y,s.ivertex=h}for(let a=1,h=this.m_pairIndices.size();a<h;a++){let m=this.m_pairIndices.read(a),l=this.m_pairs[m];if(1&l)continue;let u=l>>1,c=this.m_xy.readPoint2D(2*u),g=this.m_pathsForOGCTests[u],d;g!==s.ipath&&(n=e[g],i=t.getPathStart(g),o=t.getPathEnd(g)-1);let _=u===i||u===o;d=this.m_bOGCRestrictions?!n&&_:_;let p=By(c.x,c.y,g,u,d,_);if(p.x===s.x&&p.y===s.y){if(this.m_bOGCRestrictions){if(!(p.bBoundary&&s.bBoundary||p.ipath===s.ipath&&p.bEndPoint&&s.bEndPoint))return this.m_nonSimpleResult=new vt(10,p.ivertex,s.ivertex),!1}else if(!p.bEndPoint||!s.bEndPoint)return this.m_nonSimpleResult=new vt(7,p.ivertex,s.ivertex),!1}Uy(s,p)}return!0}checkSelfIntersectionsPolylinePlanar3D(t){return w(0),!1}checkSelfIntersectionsPolygonsOGC(){let t=this.m_geometry.getImpl(),e=[],s=-1,n=!1;for(let u=0,c=t.getPathCount();u<c;u++)t.isExteriorRingOGC(u)&&(n=!1,s++,u<c-1&&(t.isExteriorRingOGC(u+1)||(n=!0))),e.push(n?s:-1);let i=Xy();{let u=this.m_pairIndices.read(0),c=this.m_pairs[u]>>1,g=this.m_xy.readPoint2D(2*c),d=this.m_pathsForOGCTests[c];i.ipath=d,i.x=g.x,i.y=g.y,i.ivertex=c,i.ipolygon=e[d]}let o=[];for(let u=1,c=this.m_pairIndices.size();u<c;u++){let g=this.m_pairIndices.read(u),d=this.m_pairs[g];if(1&d)continue;let _=d>>1,p=this.m_xy.readPoint2D(2*_),f=this.m_pathsForOGCTests[_],x=ky(p.x,p.y,f,_,e[f]);if(x.x===i.x&&x.y===i.y){if(x.ipath===i.ipath)return this.m_nonSimpleResult=new vt(11,x.ivertex,i.ivertex),!1;e[x.ipath]>=0&&e[x.ipath]===e[i.ipath]&&(o.length!==0&&Ry(o.at(-1),i)||o.push(Tn({},i)),o.push(x))}Hy(i,x)}if(o.length===0)return!0;let a=new ln(!0);e.fill(-1);let h=-1,m=new y;for(let u=0,c=o.length;u<c;u++){let g=o[u];g.x===m.x&&g.y===m.y||(h=a.createList(0),m.x=g.x,m.y=g.y);let d=e[g.ipath];d===-1&&(d=a.createList(2),e[g.ipath]=d),a.addElement(d,h),a.addElement(h,d)}let l=[];for(let u=a.getFirstList();u!==-1;u=a.getNextList(u)){let c=a.getListData(u);if(1&c||!(2&c))continue;let g=-1;for(l.push(u),l.push(-1);l.length;){let d=l.at(-1);l.pop();let _=l.at(-1);l.pop();let p=a.getListData(_);if(1&p){g=2&p?_:d;break}a.setListData(_,1|p);for(let f=a.getFirst(_);f!==-1;f=a.getNext(f)){let x=a.getData(f);x!==d&&(l.push(x),l.push(_))}}if(g!==-1){let d=e.indexOf(g);return this.m_nonSimpleResult=new vt(12,d,-1),!1}}return!0}_CheckValidRingOrientation(){let t=this.m_multiPathStitcher!==null?this.m_multiPathStitcher.getImpl():this.m_geometry.getImpl();if(t.calculateArea2D()<=0)return this.m_nonSimpleResult=new vt(8,t.getPathCount()===1?1:-1,-1),0;if(t.getPathCount()===1)return this.m_bOGCRestrictions&&!this.checkSelfIntersectionsPolygonsOGC()?0:4;this.m_pathOrientations=new Gu(t.getPathCount(),0),this.m_pathParentage=new he(t.getPathCount(),-1);let e=-1,s=0;for(let o=0,a=t.getPathCount();o<a;o++){let h=t.calculateRingArea2D(o);if(this.m_pathOrientations.write(o,h<0?0:8),h>0)e=o,s=h;else{if(h===0)return this.m_nonSimpleResult=new vt(8,o,-1),0;if((e<0||s<Math.abs(h))&&(this.m_nonSimpleResult=new vt(9,o,-1),this.m_bOGCRestrictions))return 0;this.m_pathParentage.write(o,e)}}this.m_unknownOrientationPathCount=t.getPathCount(),this.m_newEdges.length=0;let n=t.getPointCount();this.m_yScanline=Number.NaN;let i=[];this.m_xyToNode1=new he(n,Ot.st_nullNode()),this.m_xyToNode2=new he(n,Ot.st_nullNode()),this.m_freeEdges.length=0,this.m_AET.clear(),this.m_AET.setComparator(new _l(this));for(let o=0,a=2*n;this.m_unknownOrientationPathCount>0&&o<a;o++){let h=this.m_pairIndices.read(o),m=this.m_pairs[h];if(1&m)continue;let l=m>>1,u=this.m_xy.read(2*l+1);if(u!==this.m_yScanline&&i.length){if(!this.processBunchForRingOrientationTest(i))return 0;i.length=0}i.push(l),this.m_yScanline=u}return this.m_unknownOrientationPathCount>0&&!this.processBunchForRingOrientationTest(i)?0:this.m_bOGCRestrictions?this.m_nonSimpleResult.m_reason!==0?0:this.checkSelfIntersectionsPolygonsOGC()?5:0:this.m_nonSimpleResult.m_reason===0?4:3}processBunchForSelfIntersectionTest(t){if(t.length===1)return!0;for(let a=0,h=t.length;a<h;a++){let m=t[a];this.m_recycledSegIter.resetToVertex(m,-1);let l=this.m_recycledSegIter.previousSegment();this.m_edges.push(this.createEdge(l,m,this.m_recycledSegIter.getPathIndex(),!0)),this.m_recycledSegIter.nextSegment();let u=this.m_recycledSegIter.nextSegment();this.m_edges.push(this.createEdge(u,m,this.m_recycledSegIter.getPathIndex(),!1))}this.m_edges.sort((a,h)=>this.edgeAngleCompare(a,h));let e=this.m_crossOverHelperList.getFirstList();e===-1&&(e=this.m_crossOverHelperList.createList(0)),this.m_crossOverHelperList.reserveNodes(this.m_edges.length);for(let a=0,h=this.m_edges.length;a<h;a++)this.m_crossOverHelperList.addElement(e,a);let s=!0,n=-1,i=-1;for(;s;){s=!1;let a=this.m_crossOverHelperList.getFirst(e);if(a===-1)break;let h=this.m_crossOverHelperList.getNext(a);for(;h!==-1;){let m=this.m_crossOverHelperList.getData(a),l=this.m_crossOverHelperList.getData(h);if(n=this.m_edges[m].m_vertexIndex,i=this.m_edges[l].m_vertexIndex,n!==i)a=h,h=this.m_crossOverHelperList.getNext(a);else if(s=!0,this.m_crossOverHelperList.deleteElement(e,a),a=this.m_crossOverHelperList.getPrev(h),h=this.m_crossOverHelperList.deleteElement(e,h),h===-1||a===-1)break}}let o=this.m_crossOverHelperList.getListSize(e);if(this.m_crossOverHelperList.clear(e),o>0)return this.m_nonSimpleResult=new vt(7,n,i),!1;for(let a=0,h=t.length;a<h;a++)this.recycleEdge(this.m_edges[a]);return this.m_edges.length=0,!0}processBunchForRingOrientationTest(t){for(let e=0,s=t.length;e<s;e++){let n=t[e],i=this.m_xyToNode1.read(n);if(i!==Ot.st_nullNode()){let o=this.m_AET.getElement(i);this.m_freeEdges.push(o),this.m_AET.deleteNode(i),this.recycleEdge(this.m_edges[o]),this.m_edges[o]=null,this.m_xyToNode1.write(n,Ot.st_nullNode())}if(i=this.m_xyToNode2.read(n),i!==Ot.st_nullNode()){let o=this.m_AET.getElement(i);this.m_freeEdges.push(o),this.m_AET.deleteNode(i),this.recycleEdge(this.m_edges[o]),this.m_edges[o]=null,this.m_xyToNode2.write(n,Ot.st_nullNode())}}for(let e=0,s=t.length;e<s;e++){let n=t[e];this.m_recycledSegIter.resetToVertex(n,-1);let i=this.m_recycledSegIter.previousSegment();if(i.getStartY()>i.getEndY()){let a=this.m_recycledSegIter.getStartPointIndex(),h=this.createEdge(i,n,this.m_recycledSegIter.getPathIndex(),!0),m;this.m_freeEdges.length>0?(m=this.m_freeEdges.at(-1),this.m_freeEdges.pop(),this.m_edges[m]=h):(m=this.m_edges.length,this.m_edges.push(h));let l=this.m_AET.addElement(m);this.m_xyToNode1.read(a)===Ot.st_nullNode()?this.m_xyToNode1.write(a,l):this.m_xyToNode2.write(a,l),3&this.m_pathOrientations.read(this.m_recycledSegIter.getPathIndex())||this.m_newEdges.push(l)}this.m_recycledSegIter.nextSegment();let o=this.m_recycledSegIter.nextSegment();if(o.getStartY()<o.getEndY()){let a=this.m_recycledSegIter.getEndPointIndex(),h=this.createEdge(o,n,this.m_recycledSegIter.getPathIndex(),!1),m;this.m_freeEdges.length>0?(m=this.m_freeEdges.at(-1),this.m_freeEdges.pop(),this.m_edges[m]=h):(m=this.m_edges.length,this.m_edges.push(h));let l=this.m_AET.addElement(m);this.m_xyToNode1.read(a)===Ot.st_nullNode()?this.m_xyToNode1.write(a,l):this.m_xyToNode2.write(a,l),3&this.m_pathOrientations.read(this.m_recycledSegIter.getPathIndex())||this.m_newEdges.push(l)}}for(let e=0,s=this.m_newEdges.length;e<s&&this.m_unknownOrientationPathCount>0;e++){let n=this.m_newEdges[e],i=this.m_AET.getElement(n),o=this.m_edges[i].m_pathIndex;if(!(3&this.m_pathOrientations.read(o))){let a=-1,h=this.m_AET.getPrev(n),m=n,l=0;{let u=-1,c=null,g=-1,d=0;for(;h!==Ot.st_nullNode()&&(u=this.m_AET.getElement(h),c=this.m_edges[u],g=c.m_pathIndex,d=this.m_pathOrientations.read(g),!(3&d));)m=h,h=this.m_AET.getPrev(h);h===Ot.st_nullNode()?(l=1,h=m):(a=(3&d)==1?g:this.m_pathParentage.read(g),l=c.getRightSide()?0:1,h=this.m_AET.getNext(h))}do{let u=this.m_AET.getElement(h),c=this.m_edges[u],g=c.m_pathIndex,d=this.m_pathOrientations.read(g);if(!(3&d)){if(l!==c.getRightSide())return this.m_nonSimpleResult=new vt(8,g,-1),!1;let _=l&&!c.getReversed()?1:2;if(d=-4&d|_,this.m_pathOrientations.write(g,d),_===2&&this.m_nonSimpleResult.m_reason===0){let p=this.m_pathParentage.read(g);if(p!==a&&(this.m_nonSimpleResult=new vt(9,g,p),this.m_bOGCRestrictions))return!1}if(this.m_unknownOrientationPathCount--,!this.m_unknownOrientationPathCount)return!0}a=(3&d)==1?g:this.m_pathParentage.read(g),m=h,h=this.m_AET.getNext(h),l=l?0:1}while(m!==n)}}return this.m_newEdges.length=0,!0}createEdge(t,e,s,n){let i;return t.getGeometryType()===N.enumLine?i=this.createEdgeLine(t):(i=new xa,i.m_segment=t.clone()),i.m_vertexIndex=e,i.m_pathIndex=s,i.m_flags=0,i.setReversed(n),i}createEdgeLine(t){let e;return this.m_lineEdgesRecycle.length>0?(e=this.m_lineEdgesRecycle.at(-1),this.m_lineEdgesRecycle.pop(),t.copyTo(e.m_segment)):(e=new xa,e.m_segment=t.clone()),e}recycleEdge(t){t.m_segment.getGeometryType()===N.enumLine&&this.m_lineEdgesRecycle.push(t)}static isShortSegment(t,e,s,n){let i=t.calculateLowerLength2D();if(i<=s){let o=!0;if(t.isCurve()&&(i=t.calculateLength2D(),o=i<=s),o){if(e){let a=t.getEndAttributeAsDbl(1,0);Number.isNaN(a)&&(a=0);let h=t.getStartAttributeAsDbl(1,0);return Number.isNaN(h)&&(h=0),Math.abs(h-a)<=n}return!0}return!1}return!1}static isShortSegmentPoints(t,e,s,n,i){if(s){let o=t.getXYZ(),a=e.getXYZ();return Xu(o,a,n,i)}{let o=t.getXY(),a=e.getXY();return y.sqrDistance(o,a)<=n*n}}removeDegenerateSegmentsFromCurvedPath(t,e,s,n){let i=t.hasAttribute(1),o=t.querySegmentIterator();o.resetToPath(e),w(o.nextPath());let a=this.m_toleranceSimplify.total(),h=!1,m=!0,l=new st,u=new st,c=new y;for(;o.hasNextSegment();){this.progress_();let _=o.nextSegment();if(r.isShortSegment(_,i,a,s))if(h){if(_.queryEnd(u),r.isShortSegmentPoints(l,u,i,a,s))continue;m&&(n.startPathPoint(l),m=!1),_.queryEnd(l),n.lineToPoint(l),h=!1}else c.assign(_.getStartXY()),_.queryStart(l),h=!0;else if(h)if(_.isCurve()){let p=_.clone();if(p.setCoordsForIntersector(c,_.getEndXY(),!1),p.setStart(l),r.isShortSegment(p,i,a,s))continue;n.addSegment(p,m),m=!1,h=!1}else{if(_.queryEnd(u),r.isShortSegmentPoints(l,u,i,a,s))continue;m&&(n.startPathPoint(l),m=!1),n.lineToPoint(u),h=!1}else n.addSegment(_,m),m=!1}if(m||!h)return;t.isClosedPath(e)?t.getPointByVal(t.getPathStart(e),l):t.getPointByVal(t.getPathEnd(e)-1,l);let g=n.querySegmentIterator();g.resetToLastPath(),g.resetToLastSegment();let d=n.getDescription().getAttributeCount()>1;for(w(g.previousPath());g.hasPreviousSegment();){let _=g.previousSegment();if(_.isCurve()){let p=_.clone();if(p.setCoordsForIntersector(_.getStartXY(),l.getXY(),!1),!r.isShortSegment(p,i,a,s)){d&&p.setEnd(l);let f=g.getEndPointIndex();for(let x=n.getPointCount()-1;x>=f;x--)n.removePoint(x);return void n.addSegment(p,!1)}}else if(_.queryStart(u),!r.isShortSegmentPoints(u,l,i,a,s)){let p=g.getEndPointIndex();for(let f=n.getPointCount()-1;f>=p;f--)n.removePoint(f);return void n.lineToPoint(l)}}n.removePath(n.getPathCount()-1)}multipointIsSimpleAsFeature(){if(!this.checkStructure())return 0;let t=this.m_geometry.getImpl();this.m_multiVertexGeom=t;let e=t.getPointCount(),s=Z(e,0);for(let n=0;n<e;n++)s[n]=n;s.sort((n,i)=>this.compareVerticesMultiPoint(n,i));for(let n=1;n<e;n++)if(this.compareVerticesMultiPoint(s[n-1],s[n])===0)return this.m_nonSimpleResult=new vt(5,s[n-1],s[n]),0;return 1}polylineIsSimpleAsFeature(){return this.checkStructure()&&this.checkDegenerateSegments(!0)?1:0}polygonIsSimpleAsFeature(){return this.isSimplePlanarImpl()}multipointSimplifyAsFeature(){let t=this.m_geometry.getImpl(),e=r.hasNanZs(t),s,n=this.m_geometry;e&&(s=this.m_geometry.clone(),t=s.getImpl(),s.replaceNaNs(1,Ft.getDefaultValue(1)),n=s),this.m_multiVertexGeom=t;let i=t.getPointCount(),o=Z(i,0);for(let c=0;c<i;c++)o[c]=c;o.sort((c,g)=>this.compareVerticesMultiPoint(c,g));let a=new Array(i);a.fill(!1);let h=-1;for(let c=0;c<i;c++){let g=o[c];t.getXY(g).isFinite()&&((h<0||this.compareVerticesMultiPoint(h,g)!==0)&&(a[g]=!0),h=g)}let m=this.m_geometry.createInstance(),l=0,u=0;for(let c=0;c<i;c++)a[c]?u=c+1:(l<u&&m.addPoints(n,l,u),l=c+1);return l<u&&m.addPoints(n,l,u),m.getImpl().setIsSimple(1,this.m_toleranceSimplify.total()),m}polylineSimplifyAsFeature(){let t=this.m_geometry.getImpl(),e=t.querySegmentIterator(),s=t.querySegmentIterator(),n=this.m_geometry.createInstance(),i=this.m_geometry,o=t.hasAttribute(1),a=o?oh(this.m_sr,t,!0).total():0,h=[],m=[],l=null;o&&(l=t.getAttributeStreamRef(1));let u=new st,c=t.hasNonLinearSegments(),g=this.m_toleranceSimplify.total();for(;e.nextPath();){if(s.nextPath(),t.getPathSize(e.getPathIndex())<2)continue;if(c&&t.hasNonLinearSegmentsPath(e.getPathIndex())){this.removeDegenerateSegmentsFromCurvedPath(t,e.getPathIndex(),a,n);continue}s.resetToLastSegment();let d=0,_=0,p=!0,f=!0;for(;e.hasNextSegment();){this.progress_();let x=e.nextSegment(),C=s.previousSegment();if(e.getStartPointIndex()>s.getStartPointIndex())break;if(p){let P=e.getStartPointIndex();t.getXY(P).isNAN()||(p=!1,h.push(P))}if(f){let P=s.getEndPointIndex();t.getXY(P).isNAN()||(m.push(P),f=!1)}if(!p){let P=h.at(-1),E=e.getEndPointIndex();if(E-P>1){let S=new y;S.setSub(t.getXY(P),t.getXY(E)),d=S.length()}else d=x.calculateLength2D();if(d>g)h.push(E),d=0;else if(o){let S=l.read(P);Number.isNaN(S)&&(S=0);let I=l.read(E);Number.isNaN(I)&&(I=0),Math.abs(I-S)>a&&(h.push(E),d=0)}}if(!f){let P=m.at(-1),E=s.getStartPointIndex();if(E-P>1){let S=new y;S.setSub(t.getXY(P),t.getXY(E)),_=S.length()}else _=C.calculateLength2D();if(_>g)m.push(E),_=0;else if(o){let S=l.read(P);Number.isNaN(S)&&(S=0);let I=l.read(E);Number.isNaN(I)&&(I=0),Math.abs(I-S)>a&&(m.push(E),_=0)}}}if(h.length>0&&m.length>0&&(h.at(-1)<m.at(-1)?h.length>m.length?h.pop():m.pop():(h.at(-1)===m.at(-1)||m.pop(),m.pop())),m.length+h.length>=2){let x=!1;for(let C=0,P=h.length;C<P;C++)i.getPointByVal(h[C],u),x?n.lineToPoint(u):(n.startPathPoint(u),x=!0);for(let C=m.length-1;C>0;C--)i.getPointByVal(m[C],u),x?n.lineToPoint(u):(n.startPathPoint(u),x=!0);i.isClosedPath(e.getPathIndex())?n.closePathWithLine():m.length>0&&(i.getPointByVal(m[0],u),n.lineToPoint(u))}h.length=0,m.length=0}return o&&n.replaceNaNs(1,0),n.getImpl().setIsSimple(1,g),n}polygonSimplifyAsFeature(){return this.simplifyPlanar()}simplifyPlanar(){if(this.m_geometry.getFillRule()===1&&!Rs(this.m_knownSimpleResult))return cl(this.m_geometry,this.m_toleranceSimplify,!0,!1,this.m_knownSimpleResult,this.m_progressTracker,0,!0);let t=new Nt;if(t.addGeometry(this.m_geometry),this.m_geometry.hasAttribute(1)&&t.replaceNaNs(1,0),t.removeNaNVertices(),t.getTotalPointCount()!==0){let s=null,n=0,i=0;if(t.hasCurves()){s=new Be;let o=V.constructEmpty();this.m_geometry.queryEnvelope(o);let a=us(this.m_toleranceSimplify.total(),o);n=zs(this.m_toleranceSimplify.total()),i=Os(a,n),Ss(t,a,this.m_toleranceSimplify.total(),12e3,s,null,this.m_progressTracker)}Rs(this.m_knownSimpleResult)||Us(t,this.m_toleranceSimplify.add(i),this.m_progressTracker,!0,!1),this.m_geometry.getGeometryType()===N.enumPolygon&&vn(t,t.getFirstGeometry(),this.m_knownSimpleResult,!1,-1,this.m_progressTracker),s!==null&&s.stitchCurves(t,t.getFirstGeometry(),n,!0)}let e=t.getGeometry(t.getFirstGeometry());return e.getGeometryType()===N.enumPolygon&&(e.getImpl().updateOGCFlagsProtected(),e.setFillRule(0)),e.getImpl().setIsSimple(4,this.m_toleranceSimplify.total()),e}progress_(){}static hasNanZs(t){if(t.hasAttribute(1)){let e=t.getAttributeStreamRef(1);for(let s=0,n=t.getPointCount();s<n;s++){let i=e.read(s);if(Number.isNaN(i))return!0}}return!1}compareVerticesForPlanarClustering(t,e,s){if(t===e)return 0;let n=this.m_pairs[t],i=this.m_pairs[e],o=n>>1,a=i>>1,h=this.m_xy.readPoint2D(2*o);h.y+=1&n?this.m_toleranceIsSimpleClustering:-this.m_toleranceIsSimpleClustering;let m=this.m_xy.readPoint2D(2*a);m.y+=1&i?this.m_toleranceIsSimpleClustering:-this.m_toleranceIsSimpleClustering;let l=h.compare(m);if(l===0&&s){let u=this.m_pathsForOGCTests[o]-this.m_pathsForOGCTests[a];return Mt(u)}return l}compareVerticesMultiPoint(t,e){if(t===e)return 0;let s=this.m_multiVertexGeom.getXY(t),n=this.m_multiVertexGeom.getXY(e),i=!s.isFinite(),o=!n.isFinite();if(i||o)return i<o?-1:i>o?1:0;if(s.y<n.y)return-1;if(s.y>n.y)return 1;if(s.x<n.x)return-1;if(s.x>n.x)return 1;for(let a=1;a<this.m_attributeCount;a++){let h=this.m_description.getSemantics(a),m=Ft.getComponentCount(h);for(let l=0;l<m;l++){let u=this.m_multiVertexGeom.getAttributeAsDbl(h,t,l),c=this.m_multiVertexGeom.getAttributeAsDbl(h,e,l),g=Eu(u,c);if(g!==0)return g}}return 0}edgeAngleCompare(t,e){if(t===e)return 0;let s=t.m_segment.getTangent(t.getReversed()?1:0);t.getReversed()&&s.negateThis();let n=e.m_segment.getTangent(e.getReversed()?1:0);e.getReversed()&&n.negateThis();let i=s.getQuarter(),o=n.getQuarter();if(o===i){let a=s.crossProduct(n);return a<0?1:a>0?-1:0}return i<o?-1:1}},Ms=class{getOperatorType(){return 10103}accelerateGeometry(t,e,s){return!1}canAccelerateGeometry(t){return!1}supportsCurves(){return!0}isSimpleAsFeature(t,e,s,n,i){let o=jl(t,e,s,n,i);return ku(t.getGeometryType(),o)}isSimplePlanarDONOTUSE(t,e,s,n,i){let o=Vy(t,e,s,n,i);return Qs(o)}executeMany(t,e,s,n){return new pl(t,e,s,n)}execute(t,e,s,n){let i=new Ys([t]),o=this.executeMany(i,e,s,n).next();return o||j("null geometry"),o}},pl=class extends ns{constructor(t,e,s,n){super(),this.m_progressTracker=n,this.m_bForceSimplify=s,this.m_index=-1,this.m_inputGeometryCursor=t,this.m_spatialReference=e}next(){let t=this.m_inputGeometryCursor.next();return t?(this.m_index=this.m_inputGeometryCursor.getGeometryID(),this.simplify(t)):null}getGeometryID(){return this.m_index}tock(){return!1}getRank(){return 1}simplify(t){if(t||U(""),t.getGeometryType()===N.enumGeometryCollection){let e=Kc(t,-1),s=new Ms().executeMany(e,this.m_spatialReference,this.m_bForceSimplify,this.m_progressTracker),n=t.createInstance();for(let i=s.next();i!=null;i=s.next())n.addGeometry(i);return n}return I_(t,this.m_spatialReference,this.m_bForceSimplify,this.m_progressTracker)}};function zy(r,t,e){let s=new V;r.queryEnvelope(s);let n=new V;t.queryEnvelope(n);let i=new V(n);if(i.inflate(2*e),!i.isIntersecting(s))return 4;let o=r.getGeometryType(),a=t.getGeometryType();if(o===N.enumEnvelope&&s.containsEnvelope(i))return 1;if(a===N.enumEnvelope){let h=new V(s);if(h.inflate(2*e),n.containsEnvelope(h))return 2}return 0}var Xr=class r{constructor(t,e,s,n){this.m_intersectorGeom=null,this.m_sr=null,this.m_dimensionMask=-1,this.m_progressTracker=null,this.m_intersectorGeomType=N.enumUnknown,this.m_geomIntersectorEmptyGeom=null,this.m_intersectorGeom=t,this.m_sr=e,this.m_dimensionMask=s,this.m_progressTracker=n,this.m_intersectorGeomType=t.getGeometryType()}intersect(t){let e=this.tryFastImplementation(t);if(e!==null)return e;let s=zi(this.m_intersectorGeom,t),n=Wt(this.m_sr,s,!0).total(),i=V.constructEmpty();this.m_intersectorGeom.queryEnvelope(i);let o=V.constructEmpty();t.queryEnvelope(o),i.inflateCoords(2*n,2*n),i.intersect(o),i.inflateCoords(100*n,100*n);let a=0,h=St(this.m_intersectorGeom,i,a,0,this.m_progressTracker),m=St(t,i,a,0,this.m_progressTracker);return t.getDimension()>this.m_intersectorGeom.getDimension()&&(h=O(m,m=h)),Ny(m,h,this.m_sr,this.m_progressTracker)}intersectEx(t){let e=this.tryFastImplementation(t);if(e!==null){let u=[];return u.length=3,u[e.getDimension()]=e,this.prepareVector(t.getDescription(),this.m_dimensionMask,u)}let s=zi(this.m_intersectorGeom,t),n=Wt(this.m_sr,s,!0).total(),i=V.constructEmpty();this.m_intersectorGeom.queryEnvelope(i);let o=V.constructEmpty();t.queryEnvelope(o),i.inflateCoords(2*n,2*n),i.intersect(o),i.inflateCoords(100*n,100*n);let a=0,h=St(this.m_intersectorGeom,i,a,0,this.m_progressTracker),m=St(t,i,a,0,this.m_progressTracker);t.getDimension()>this.m_intersectorGeom.getDimension()&&(h=O(m,m=h));let l=Ay(m,h,this.m_sr,this.m_progressTracker);return this.prepareVector(t.getDescription(),this.m_dimensionMask,l)}init(t,e,s,n=null){w(0)}static intersectPoints(t,e,s){let n=zi(t,e);return Ty(t,e,Wt(s,n,!0))}tryFastImplementation(t){let e=t.getGeometryType();if(this.m_intersectorGeomType===N.enumPoint&&e===N.enumPoint){let h=r.intersectPoints(t,this.m_intersectorGeom,this.m_sr);if(this.m_dimensionMask!==-1){let m=new Lt({vd:h.getDescription()});return h.isEmpty()||m.add(h),m}return h}if(e===N.enumEnvelope&&this.m_intersectorGeomType===N.enumEnvelope&&(this.m_dimensionMask===-1||this.m_dimensionMask===4)){let h=t,m=this.m_intersectorGeom,l=new Me({copy:h});return l.intersect(m),l}let s=zi(t,this.m_intersectorGeom),n=Wt(this.m_sr,s,!0),i=t.isEmpty(),o=this.m_intersectorGeom.isEmpty(),a=i||o;if(!a){let h=zy(this.m_intersectorGeom,t,n.total());if(h===4)a=!0;else{if(2&h)return this.m_intersectorGeom;if(1&h)return t}}if(a){let h=Te(e),m=Te(this.m_intersectorGeomType);return h<m?r.ReturnEmpty(t,i):h>m||h===0&&e===N.enumMultiPoint&&this.m_intersectorGeomType===N.enumPoint?this.ReturnEmptyIntersector():r.ReturnEmpty(t,i)}if(e===N.enumEnvelope&&Te(this.m_intersectorGeomType)===0||this.m_intersectorGeomType===N.enumEnvelope&&Te(e)===0){let h=e===N.enumEnvelope?t:this.m_intersectorGeom,m=e===N.enumEnvelope?this.m_intersectorGeom:t,l=V.constructEmpty();return h.queryEnvelope(l),St(m,l,n.total(),0,this.m_progressTracker)}if(Te(e)===0&&Te(this.m_intersectorGeomType)>0||Te(e)>0&&Te(this.m_intersectorGeomType)===0){if(e===N.enumMultiPoint)return Sd(t,this.m_intersectorGeom,n);if(e===N.enumPoint)return vd(t,this.m_intersectorGeom,n);if(this.m_intersectorGeomType===N.enumMultiPoint)return Sd(this.m_intersectorGeom,t,n);if(this.m_intersectorGeomType===N.enumPoint)return vd(this.m_intersectorGeom,t,n);j("")}return null}ReturnEmptyIntersector(){return this.m_geomIntersectorEmptyGeom===null&&(this.m_geomIntersectorEmptyGeom=this.m_intersectorGeom.createInstance()),this.m_geomIntersectorEmptyGeom}static ReturnEmpty(t,e){return e?t:t.createInstance()}prepareVector(t,e,s){let n=0;return 1&e?(s[0]||(s[0]=new Lt({vd:t})),n++):s.shift(),2&e?(s[n]||(s[n]=new dt({vd:t})),n++):s.splice(n,1),4&e?s[n]||(s[n]=new lt({vd:t})):s.splice(n,1),new Ys(s)}},fl=class extends ns{constructor(t,e,s,n,i){super(),this.m_smallCursor=null,this.m_progressTracker=n,this.m_geomIntersector=e.next(),this.m_intersector=new Xr(this.m_geomIntersector,s,i,n),this.m_index=-1,this.m_inputGeoms=t,this.m_dimensionMask=i,this.m_dimensionMask!==-1&&(this.m_dimensionMask<=0||this.m_dimensionMask>7)&&U("bad dimension mask")}next(){if(!this.m_geomIntersector)return null;let t;if(this.m_smallCursor!==null){if(t=this.m_smallCursor.next(),t)return t;this.m_smallCursor=null}for(;t=this.m_inputGeoms.next();)return ds(t),this.m_index=this.m_inputGeoms.getGeometryID(),this.m_dimensionMask===-1?this.m_intersector.intersect(t):(this.m_smallCursor=this.m_intersector.intersectEx(t),this.m_smallCursor.next());return null}getGeometryID(){return this.m_index}tock(){return!0}getRank(){return 1}},wn=class{getOperatorType(){return 1e4}accelerateGeometry(t,e,s){if(!this.canAccelerateGeometry(t))return!1;Ae(e,t,!0);let n=0;return t.getGeometryType()!==N.enumPolygon&&t.getGeometryType()!==N.enumPolyline||!wr(t)||s===0||(n|=t.getImpl().buildQuadTreeAccelerator(s)?1:0),!!n}canAccelerateGeometry(t){return wr(t)}supportsCurves(){return!0}executeMany(t,e,s,n,i=-1){return new fl(t,e,s,n,i)}execute(t,e,s,n){if(t.getGeometryType()===N.enumPoint&&e.getGeometryType()===N.enumPoint)return Xr.intersectPoints(t,e,s);let i=new Ys([t]),o=new Ys([e]),a=this.executeMany(i,o,s,n,-1).next();return a||j("null output"),a}};function b_(r,t,e){return t.m_projector.project(r,e)}function Oy(r,t,e,s,n){r.m_projector.transformInPlaceZ(t,null,e,s,null,n);let i=s.slice(0,e).filter(o=>!o.isNAN());for(let o=0,a=i.length;o<a;++o)s[o].assign(i[o]);return i.length}function w_(r,t,e,s,n){return r.m_projector.transformInPlaceZ(t,null,e,s,null,n)}function xl(r,t,e,s){if(r&&t&&t.isPannable()||U("fold_into_360_range_geodetic"),r.isEmpty())return r;if(e===4)return ya(r,t,s);let n=r,i=n.getGeometryType();if(at(i)){n=jr(r,t);let o=new V;n.queryEnvelope(o);let a=Wt(t,o,!1).total(),h=t.getPannableExtent(),m=Math.floor((o.xmin-h.xmin)/h.width())*h.width()+h.xmin,l=n;for(;m<o.xmax;)m>o.xmin+a&&m<o.xmax-a&&(l=V_(l,t,e,!0,m)),m+=h.width();n=l}else{if(i===N.enumEnvelope){let o=new lt({vd:n.getDescription()});return o.addEnvelope(n,!1),xl(o,t,e,s)}if(Qt(i)){let o=new dt({vd:n.getDescription()});return o.addSegment(n,!0),xl(o,t,e,s)}}return ya(n,t,s)}function ya(r,t,e){if(r&&t&&t.isPannable()||U(""),r.isEmpty())return r;let s,n=r.getGeometryType();if(n===N.enumEnvelope){let o=new lt({vd:r.getDescription()});o.addEnvelope(r,!1),s=o}else if(Qt(n)){let o=new dt({vd:r.getDescription()});o.addSegment(r,!0),s=o}else s=r;let i=jr(s,t);return i.isEmpty()?i:bi(i,t,0,i!==r,0,e)}function Wy(r,t,e){if(!t.isPannable()||r.isEmpty())return r;let s=t.getPannableExtent().width(),n=.5*s,i=r.queryInterval(0,0);if(i.width()<n||!Ie(r.getGeometryType())){if(Number.isNaN(e))return r;let f=i.getCenter();if(Math.abs(f-e)<=n)return r;{let x=new ct,C=an((e-f)/s)*s;x.setShiftCoords(C,0);let P=r.clone();return P.applyTransformation(x),P}}let o=r.getGeometryType(),a=r,h=a.getAttributeStreamRef(0),m=r.clone(),l=m.getAttributeStreamRef(0),u=0,c=0,g=0,d=at(o)?0:-1,_=B.constructEmpty(),p=!1;for(let f=0,x=a.getPointCount();f<x;f++){let C=h.read(2*f);f===c&&(at(o)?(d===0&&Number.isNaN(e)&&(p=!0),d>0&&Number.isNaN(e)&&(e=_.getCenter(),p=!1),c=a.getPathEnd(d),d++):c=a.getPointCount(),Number.isNaN(e)?g=C:(g=e,u=0));let P=C-g;Math.abs(P)>n&&(P=an(P/s)*s,u-=P,Math.abs(u)<.1*s&&(u=0));let E=C+u;l.write(2*f,E),p&&_.mergeCoordinate(E),g=C}return m.notifyModified(),m}var jy="missing implementation";function Zy(r,t,e,s){let n=t.getCoordinateSystemType();if(n===0){let a=new tn;return t.queryPrecisionDescriptor(a),Id(r,a,t,e)}let i=r;s!==2&&s!==3||!t.isPannable()||(i=ya(i,t,e));let o=new tn;if(t.queryPrecisionDescriptor(o),i=Id(i,o,t,e),s===0||i.isEmpty())return i;if(n===1){if(s===1){let a=new V;i.queryLooseEnvelope(a);let h=t.getPannableExtent(),m=.01*h.width();return h.xmin=a.xmin-m,h.xmax=a.xmax+m,new Js().execute(i,h,t,e)}return i}if(n===2){let a=t.getPCSHorizon();if(s===1||s===2){let h=new wn().execute(i,a,t,e);return h===a?h.clone():h}return i}if(n===3)return i;j(jy)}function Id(r,t,e,s){let n=t.getXYGridRange(),i=r.hasAttribute(1),o=r.hasAttribute(2),a=new B,h=new B;i&&(a=t.getZGridRange()),o&&(h=t.getMGridRange());let m=new Js().execute(r,n,e,s);if(i){let l=m.queryInterval(1,0);a.contains(l)||(r===m&&(m=m.clone()),mh(m,a,1,0))}if(o){let l=m.queryInterval(2,0);h.contains(l)||(r===m&&(m=m.clone()),mh(m,h,2,0))}return m}var yl=class{constructor(t){this.m_inputPCSHorizonClipOption=0,this.m_outputPCSHorizonClipOption=0,this.m_bDontGeonormalizePolygon=!1,this.m_bClipOutCurvedPoles=!1,this.m_bNormalizeOutputGeometry=!1,this.m_bDontHackPolesInGeogToGeog=!1,this.m_centralMeridianOfOutputGCS=0,this.m_densificationStepInput=0,t||U(""),this.m_projTransform=t,this.m_bClipOutCurvedPoles=!1;let e=this.m_projTransform.getExtendedParamsImpl();this.m_bNormalizeOutputGeometry=e.normalizeResultGeometry,this.m_bNormalizeOutputGeometry&&(e.legacyHorizonClipping?this.m_bNormalizeOutputGeometry=!1:this.m_projTransform.getOutputSR().isPannable()||(this.m_bNormalizeOutputGeometry=!1)),e.clipWithInputHorizon?(this.m_inputPCSHorizonClipOption=0,!e.legacyHorizonClipping&&this.m_projTransform.getInputSR().isPannable()&&(this.m_inputPCSHorizonClipOption=this.m_bNormalizeOutputGeometry?4:2)):this.m_inputPCSHorizonClipOption=1,e.clipWithOutputHorizon?(this.m_outputPCSHorizonClipOption=0,!e.legacyHorizonClipping&&this.m_projTransform.getOutputSR().isPannable()&&(this.m_outputPCSHorizonClipOption=this.m_bNormalizeOutputGeometry?4:2)):this.m_outputPCSHorizonClipOption=1,this.m_centralMeridianOfOutputGCS=e.centralMeridianOfOutputGCS,this.m_densificationStepInput=e.densificationStep;let s=this.m_projTransform.getExtendedParamsInternal();this.m_bDontGeonormalizePolygon=s.hasFlag(2147483648),this.m_bDontHackPolesInGeogToGeog=s.hasFlag(1073741824),this.m_bClipOutCurvedPoles=s.hasFlag(536870912)}project(t,e){if(this.m_projTransform.isIdentity()||t.isEmpty())return t;let s=t.getGeometryType();if(s===N.enumPoint)return this.projectPoint(t,e);let n=this.m_projTransform.getInputSR().getCoordinateSystemType(),i=this.m_projTransform.getOutputSR().getCoordinateSystemType(),o=this.m_projTransform.getInputSR(),a=this.m_projTransform.getOutputSR();if(n===0&&n===i){let h=bd(o,a),m=t.clone();return m.applyTransformation(h),m}switch(s){case N.enumPolyline:case N.enumPolygon:return this.projectMultiPath(t,e);case N.enumMultiPoint:return this.projectMultiPoint(t,e);case N.enumEnvelope:return this.projectEnvelope(t,e);case N.enumGeometryCollection:return this.projectGeometryCollection(t,e);default:j("")}}projectPoint(t,e){let s=[t.getXY()],n,i=null;(n=t.hasAttribute(1))&&(i=[t.getZ()]),this.transformInPlaceZ(s,i,1,s,i,null);let o=t.clone();return o.setXY(s[0]),n&&o.setZ(i[0]),o}projectMultiPoint(t,e){let s=new Lt({copy:t}),n=this.m_projTransform.getInputSR(),i=this.m_projTransform.getOutputSR(),o=n.getCoordinateSystemType(),a=i.getCoordinateSystemType();if(o===3&&w(0),s=Rm(s,n,this.m_inputPCSHorizonClipOption,e),s.isEmpty())return s;o===2&&X_(n,0,s),R_(this.m_projTransform,s,!1);let h=0;a===3&&w(0);let m=a===2;return m?h=i.getCentralMeridian():Number.isNaN(this.m_centralMeridianOfOutputGCS)||(h=this.m_centralMeridianOfOutputGCS),m&&this.m_outputPCSHorizonClipOption!==0||(s=bi(s,Jo(i),h,!1,0,e)),m&&(s=Xm(s,i,this.m_outputPCSHorizonClipOption,e),Y_(i,s,this.m_bNormalizeOutputGeometry),s.isEmpty()),s}projectMultiPath(t,e){let s=t.getGeometryType();return s===N.enumPolygon?this.projectPolygon(t,e):s===N.enumPolyline?this.projectPolyline(t,e):void j("project_multi_path_")}projectEnvelope(t,e){this.m_projTransform.getInputSR(),this.m_projTransform.getOutputSR();let s=this.m_projTransform.isVertical()&&t.hasAttribute(1),n=B.constructEmpty();if(s&&(n=t.queryInterval(1,0)),n.width()>0){let i=t.clone();i.setInterval(1,0,n.vmin,n.vmin);let o=this.projectEnvelopeHelper(i,e);i.setInterval(1,0,n.vmax,n.vmax);let a=this.projectEnvelopeHelper(i,e);return o.merge(a),o}return this.projectEnvelopeHelper(t,e)}projectPolygon(t,e){w(t.getGeometryType()===N.enumPolygon),w(!this.m_projTransform.isIdentity()),w(!t.isEmpty());let s=this.m_projTransform.getInputSR(),n=this.m_projTransform.getOutputSR(),i=s.getCoordinateSystemType(),o=n.getCoordinateSystemType(),a=new lt({copy:t});i===3&&w(0),o===3&&w(0);let h=i===2,m=o===2,l=h?s.getGCS():s,u=m?n.getGCS():n,c=!m&&!this.m_bDontHackPolesInGeogToGeog,g=!1,d=Rm(a,s,this.m_inputPCSHorizonClipOption,e);if(d.isEmpty())return d;let _=this.m_densificationStepInput,p=!Number.isNaN(_),f;p&&(d=new Bs().execute(d,_,0,0,e));let x=m?n.getPCSInfo():null,C=Number.NaN;h&&(C=s.getCentralMeridian());let P=n.getGCSSplitLines()!==null;if(this.m_bDontGeonormalizePolygon){let E=d;if(h&&(zo(s,C,E),p)){let S=s.getUnitsPerMillimeter();_*=s.getGCS().getUnitsPerMillimeter()/S}if(Oo(this.m_projTransform,E,c),p){let S=s.getGCS().getUnitsPerMillimeter();_*=n.getGCS().getUnitsPerMillimeter()/S}f=E}else{let E=new dt({vd:d.getDescription()});if(E.addAndExplicitlyOpenAllPaths(d,!1),h){if(zo(s,C,E),p){let b=s.getUnitsPerMillimeter();_*=s.getGCS().getUnitsPerMillimeter()/b}if(this.m_bClipOutCurvedPoles){let b=s.getPCSInfo(),T=b.getSouthPoleGeometry()===le.PE_POLE_LINE_CURVED,A=b.getNorthPoleGeometry()===le.PE_POLE_LINE_CURVED;if(T||A){let G=V.constructEmpty();E.queryLooseEnvelope(G),G.inflateCoords(1,1);let F=89.9999*l.getOneDegreeGCSUnit();T&&(G.ymin=-F),A&&(G.ymax=F),E=Hg(E,G,l,0,0,e)}}}if(Oo(this.m_projTransform,E,c),p){let b=Jo(s).getUnitsPerMillimeter();_*=Jo(n).getUnitsPerMillimeter()/b}let S=Number.NaN;m?(x=n.getPCSInfo(),S=n.getCentralMeridian()):Number.isNaN(this.m_centralMeridianOfOutputGCS)||(S=this.m_centralMeridianOfOutputGCS);let I=Uo(s)|Uo(n),D=10*u.getTolerance(0);this.m_bDontHackPolesInGeogToGeog&&(I=3,D=10*u.getTolerance(0)),f=WP(d,s,E,u,S,e,I,D,this.m_bNormalizeOutputGeometry),I=0}if(P&&(w(!n.isPannable()),f=Xd(f,n,e)),m){if(!g){let E=u.getPannableExtent().width();if(f.queryInterval(0,0).width()>=E-10*u.getTolerance(0)){let S=x.getNorthPoleLocation(),I=x.getSouthPoleLocation(),D=x.getNorthPoleGeometry(),b=x.getSouthPoleGeometry(),T=0;D===le.PE_POLE_POINT&&S!==le.PE_POLE_OUTSIDE_BOUNDARY&&(T=1),b===le.PE_POLE_POINT&&I!==le.PE_POLE_OUTSIDE_BOUNDARY&&(T|=2),g||=T!==0}}f=Xm(f,n,this.m_outputPCSHorizonClipOption,e),p&&(f=new Bs().execute(f,_,0,0,e)),Rd(n,f,this.m_bNormalizeOutputGeometry)}return f.isEmpty()||g&&(f=new Ms().execute(f,n,!1,e)),f}projectPolyline(t,e){w(t.getGeometryType()===N.enumPolyline),w(!this.m_projTransform.isIdentity()),w(!t.isEmpty());let s=this.m_projTransform.getInputSR(),n=this.m_projTransform.getOutputSR(),i=s.getCoordinateSystemType(),o=n.getCoordinateSystemType(),a=new dt({copy:t});i===3&&w(0),o===3&&w(0);let h=i===2,m=o===2;h&&s.getGCS();let l=m?n.getGCS():n,u=!m&&!this.m_bDontHackPolesInGeogToGeog,c=Rm(a,s,this.m_inputPCSHorizonClipOption,e);if(c.isEmpty())return c;let g=Number.NaN;h&&(g=s.getCentralMeridian());let d=n.getGCSSplitLines()!==null,_=this.m_densificationStepInput,p=!Number.isNaN(_),f;if(p&&(c=new Bs().execute(c,_,0,0,e)),this.m_bDontGeonormalizePolygon){if(h&&(zo(s,g,c),p)){let x=s.getUnitsPerMillimeter();_*=s.getGCS().getUnitsPerMillimeter()/x}if(Oo(this.m_projTransform,c,u),p){let x=s.getGCS().getUnitsPerMillimeter();_*=n.getGCS().getUnitsPerMillimeter()/x}f=c}else{let x=new dt({vd:c.getDescription()});if(x.addAndExplicitlyOpenAllPaths(c,!1),h&&(zo(s,g,x),p)){let S=s.getUnitsPerMillimeter();_*=s.getGCS().getUnitsPerMillimeter()/S}if(Oo(this.m_projTransform,x,u),p){let S=s.getGCS().getUnitsPerMillimeter();_*=n.getGCS().getUnitsPerMillimeter()/S}let C=Number.NaN;m?C=n.getCentralMeridian():Number.isNaN(this.m_centralMeridianOfOutputGCS)||(C=this.m_centralMeridianOfOutputGCS);let P=Uo(s)|Uo(n),E=10*l.getTolerance(0);this.m_bDontHackPolesInGeogToGeog&&(P=3,E=0),f=jP(c,s,x,l,C,e,P,E,this.m_bNormalizeOutputGeometry),P=0}return d&&(w(!n.isPannable()),f=Xd(f,n,e)),m&&(f=Xm(f,n,this.m_outputPCSHorizonClipOption,e),p&&(f=new Bs().execute(f,_,0,0,e)),Rd(n,f,this.m_bNormalizeOutputGeometry)),f.isEmpty(),f}projectGeometryCollection(t,e){return w(0),{}}projectEnvelopeHelper(t,e){let s=(t.height()+t.width())/400;if(s!==0){let n=new Bs().execute(t,s,0,0,e),i=this.projectMultiPath(n,e),o=new Me({vd:t.getDescription()});if(i.isEmpty()){let a=Math.min(t.height(),t.width()),h=Ae(this.m_projTransform.getInputSR(),t,!0).total();if(a>100*h){let d=V.constructEmpty(),_=Wt(this.m_projTransform.getOutputSR(),d,!0).total(),p=this.m_projTransform.getInputSR().getOneMeter()/this.m_projTransform.getOutputSR().getOneMeter();if(a>100*Math.max(h,_*p))return o}let m=new dt;m.addAndExplicitlyOpenAllPaths(n,!1),this.projectMultiPath(m,e).queryEnvelope(o);let l=new Lt({vd:t.getDescription()});l.reserve(4);let u=new st;for(let d=0;d<4;d++)t.queryCornerByVal(d,u),l.add(u);let c=this.projectMultiPoint(l,e),g=new Me;return c.queryEnvelope(g),o.merge(g),o}return i.queryEnvelope(o),o}{let n=t.getCenterXY(),i=new st(n),o=this.projectPoint(i,e),a=new Me({vd:t.getDescription()});if(o.isEmpty())a.setEmpty();else{t.copyTo(a);let h=o.getXY();a.setCoords(h.x,h.y,h.x,h.y)}return a}}transformInPlace(t,e,s,n){return w(0),0}transformInPlaceZ(t,e,s,n,i,o){if(this.m_projTransform.isIdentity())return t!==n&&Fi(n,t,s),e!==i&&ye(i,e,0,0,s),s;let a=this.m_projTransform,h=a.getInputSR(),m=a.getOutputSR(),l=h.getCoordinateSystemType(),u=m.getCoordinateSystemType();if(l===0&&l===u)return bd(h,m).transformPoints2D(t,s,n),a.isVertical()&&w(0),s;l===3&&ft("image: transform_in_place_"),u===3&&ft("image: transform_in_place_"),$P(t,s,n,h,this.m_inputPCSHorizonClipOption),i!==e&&ye(i,e,0,0,s),l===2&&Kl(h,0,n,s),wi(this.m_projTransform,n,i,s,!1);let c=0,g=u===2;if(g?c=m.getCentralMeridian():Number.isNaN(this.m_centralMeridianOfOutputGCS)||(c=this.m_centralMeridianOfOutputGCS),g&&this.m_outputPCSHorizonClipOption!==0||F_(n,s,m.getGCS(),c),g){if(!Nl(n,s,m,this.m_outputPCSHorizonClipOption))for(let _=0;_<s;++_)n[_].setNAN();Ql(m,n,s,!1)}let d=s;for(let _=0;_<s;++_)n[_].isNAN()&&(i&&(i[_]=Number.NaN),d--);return d}};function Uo(r){if(r.getCoordinateSystemType()!==2)return 0;let t=0,e=r.getPCSInfo(),s=e.getNorthPoleLocation(),n=e.getSouthPoleLocation(),i=e.getNorthPoleGeometry(),o=e.getSouthPoleGeometry();return i===le.PE_POLE_POINT&&s!==le.PE_POLE_OUTSIDE_BOUNDARY&&(t=1),o===le.PE_POLE_POINT&&n!==le.PE_POLE_OUTSIDE_BOUNDARY&&(t|=2),t}function bd(r,t){let e=r.getHorzUnitFactor(),s=t.getHorzUnitFactor(),n=1,i=1,o=20015077/180;r.getUnit().getUnitType()===1&&(n=o),t.getUnit().getUnitType()===1&&(i=o);let a=e/s*(n!==i?n/i:1),h=new ct;return h.setScaleCoords(a,a),h}var Ws=class{getOperatorType(){return 10300}supportsCurves(){return!0}accelerateGeometry(r,t,e){return!1}canAccelerateGeometry(r){return!1}executeMany(r,t,e){return!t||t.isIdentity()?r:new Pl(r,t,e)}execute(r,t,e){return t.isIdentity()?r:b_(r,t,e)}transform(r,t,e,s,n=!0){return n?Oy(r,t,e,s,null):w_(r,t,e,s,null)}transform3D(r,t,e,s,n=!0){return w(0),0}foldInto360Range(r,t){return ya(r,t,null)}foldInto360RangeGeodetic(r,t,e){return xl(r,t,e,null)}normalizeGeometryEx(r,t,e,s,n=0){return yP(r,t,e,s,n)}normalizeGeometry(r,t,e){return Wy(r,t,e)}clipToSpatialReference(r,t,e,s=0){return Zy(r,t,e,s)}},Pl=class extends ns{constructor(t,e,s){super(),this.m_projTrans=e,this.m_progressTracker=s,this.m_index=-1,t||U(""),this.m_inputGeoms=t}next(){let t=this.m_inputGeoms.next();return t!=null?(rn(t),ds(t),this.m_index=this.m_inputGeoms.getGeometryID(),b_(t,this.m_projTrans,this.m_progressTracker)):null}getGeometryID(){return this.m_index}tock(){return!0}getRank(){return 1}};function wd(r,t,e,s,n,i,o=!1){r||U("Geometry.Geodetic_densify.densify");let a=r.getGeometryType();if(ds(r),r.isEmpty()||nn(a))return r;let h=new Cl;h.m_sr=t,h.m_gcs=t.getGCS(),h.m_transform=h.m_gcs!==t?t.getSRToGCSTransform():null,h.m_progressTracker=i;let m=Ti(),l,u,c;if(h.m_gcs.querySpheroidData(m),h.m_a=m.majorSemiAxis,h.m_eSquared=m.e2,h.m_rpu=h.m_gcs.getUnit().getUnitToBaseFactor(),h.m_gcsTolerance=h.m_gcs.getTolerance(0),h.m_radTolerance=h.m_gcsTolerance*h.m_rpu,h.m_maxLength=s,h.m_maxDeviation=n,h.m_curveType=e,a===N.enumEnvelope){let g=new lt({vd:r.getDescription()});g.addEnvelope(r,!1),l=g,a=N.enumPolygon}else if(Qt(a)){let g=new dt({vd:r.getDescription()});g.addSegment(r,!0),l=g,a=N.enumPolyline}else l=r;if(h.m_curveType!==4){if(w(at(a)),u=h.replaceCurvesWithLinesAndProjectToGCSAsMultiPoint_(l),u.isEmpty())return u;u=Qy(h.m_rpu,u);let g=h.geodeticDensify(u);o||(g=new Ws().foldInto360RangeGeodetic(g,h.m_gcs,h.m_curveType)),c=h.m_transform&&!h.m_transform.isIdentity()?new Ws().execute(g,h.m_transform.getInverse(),i):g}else{let g;if(w(at(a)),t.isPannable())g=jr(l,t);else{let d=t.getPCSHorizon();g=new wn().execute(l,d,t,i),g===d&&(g=d.clone())}if(u=g,u.isEmpty())return u;c=h.shapePreservingDensify(u)}return c}function Qy(r,t){let e=new V;if(t.queryLooseEnvelope(e),e.width()*r<Math.PI)return t;let s=!1,n=t.querySegmentIterator(),i=new y,o=new y;for(;n.nextPath();)for(;n.hasNextSegment();){let d=n.nextSegment();if(i.setCoordsPoint2D(d.getStartXY()),o.setCoordsPoint2D(d.getEndXY()),i.scale(r),o.scale(r),Math.abs(i.x-o.x)>Math.PI){if(!Dd(i,o)){s=!0;break}if(Math.abs(i.x-o.x)>2*Math.PI){s=!0;break}}}if(!s)return t;let a=t.createInstance();a.reserve(t.getPointCount());let h=t.getDescription().getAttributeCount()>1,m=new y,l=new y,u=new y(0,0),c=new y(0,0),g=new st;for(n.resetToFirstPath();n.nextPath();){let d=Number.NaN,_=0;for(;n.hasNextSegment();){let p=n.nextSegment();if(i.setCoordsPoint2D(p.getStartXY()),o.setCoordsPoint2D(p.getEndXY()),i.scale(r),o.scale(r),Number.isNaN(d)?(_=zn(i.x,Number.NaN,_),u.setCoordsPoint2D(i)):u.setCoordsPoint2D(c),d=u.x,Dd(i,o)){if(o.x-i.x>2*Math.PI)for(;o.x-i.x>2*Math.PI;)o.x-=2*Math.PI;else if(o.x-i.x<2*-Math.PI)for(;o.x-i.x<2*-Math.PI;)o.x+=2*Math.PI;_=zn(o.x,Number.NaN,_),c.setCoordsPoint2D(o)}else m.setCoordsPoint2D(o),iP(m),_=zn(m.x,d,_),c.setCoords(_+m.x,m.y);if(Math.abs(c.x-o.x)<.5&&c.setCoordsPoint2D(o),h)p.queryCoord(0,g),l.setCoordsPoint2D(u),l.scale(1/r),g.setXY(l),n.isFirstSegmentInPath()?a.startPathPoint(g):a.lineToPoint(g),n.isLastSegmentInPath()&&!n.isPathClosed()&&(p.queryCoord(1,g),l.setCoordsPoint2D(c),l.scale(1/r),g.setXY(l),a.lineToPoint(g));else{n.isFirstSegmentInPath()&&a.insertPath2D(-1,null,0,0,!0);let f=a.getPathCount()-1;l.setCoordsPoint2D(u),l.scale(1/r),a.insertPoint2D(f,-1,l),n.isLastSegmentInPath()&&!n.isPathClosed()&&(l.setCoordsPoint2D(c),l.scale(1/r),a.insertPoint2D(f,-1,l))}}}return a}function oS(r,t,e,s,n,i,o,a,h,m,l,u){let c=new y,g=new y,d=s.compare(n)>0;T_(d,s,n,c,g);let _=D_(r,t,e,c,g,i,o,a,h,m,null,l,u);return d&&El(h,m,null,l),_}function Dd(r,t){return!(!It(r.y,ut)||!It(t.y,ut))||!(!It(r.y,-ut)||!It(t.y,-ut))}function Ky(r,t){return!(!It(r.y,ut)||It(t.y,ut))||!(!It(r.y,-ut)||It(t.y,-ut))}function $y(r,t){return!(!It(t.y,ut)||It(r.y,ut))||!(!It(t.y,-ut)||It(r.y,-ut))}var Cl=class{constructor(){this.m_sr=null,this.m_gcs=null,this.m_transform=null,this.m_progressTracker=null,this.m_a=0,this.m_eSquared=0,this.m_rpu=0,this.m_gcsTolerance=0,this.m_radTolerance=0,this.m_maxLength=0,this.m_maxDeviation=0,this.m_curveType=0}geodeticDensify(t){let e=t.createInstance(),s=t.querySegmentIterator(),n=[],i=[],o=new et,a=t.getDescription().getAttributeCount()>1;for(;s.nextPath();){let h=[0];for(;s.hasNextSegment();){let m=s.nextSegment(),l=m.getStartXY(),u=m.getEndXY();l.scale(this.m_rpu),u.scale(this.m_rpu);let c=new y,g=new y,d=l.compare(u)>0;T_(d,l,u,c,g),n.length=0,i.length=0,this.m_maxLength>0?D_(this.m_a,this.m_eSquared,this.m_curveType,c,g,this.m_maxLength,this.m_maxDeviation,this.m_radTolerance,null,null,a?i:null,n,h):Jy(),d&&El(null,null,a?i:null,n),n[0].setCoordsPoint2D(m.getStartXY()),n.at(-1).setCoordsPoint2D(m.getEndXY());let _=1/this.m_rpu;for(let p=1,f=n.length-1;p<f;p++)n[p].scale(_);if(a){let p=Md(d,m,o);Nd(s.isFirstSegmentInPath(),s.isLastSegmentInPath()&&!s.isPathClosed(),m,p,i,n,e)}else Td(s.isFirstSegmentInPath(),s.isLastSegmentInPath()&&!s.isPathClosed(),n,e)}}return e}shapePreservingDensify(t){let e=t.createInstance(),s=t.querySegmentIterator(),n=[],i=[],o=new et,a=t.getDescription().getAttributeCount()>1;for(;s.nextPath();)for(;s.hasNextSegment();){let h=s.nextSegment(),m=h.getStartXY(),l=h.getEndXY(),u=m.compare(l)>0,c=Md(u,h,o);n.length=0,i.length=0,sP(this.m_a,this.m_eSquared,this.m_rpu,c,this.m_sr,this.m_maxLength,this.m_maxDeviation,a?i:null,n),u&&El(null,null,a?i:null,n),a?Nd(s.isFirstSegmentInPath(),s.isLastSegmentInPath()&&!s.isPathClosed(),h,c,i,n,e):Td(s.isFirstSegmentInPath(),s.isLastSegmentInPath()&&!s.isPathClosed(),n,e)}return e}replaceCurvesWithLinesAndProjectToGCSAsMultiPoint_(t){let e=t.hasNonLinearSegments();if((!this.m_transform||this.m_transform.isIdentity())&&(t=jr(t,this.m_gcs),!e))return t;let s=t.createInstance();s.reserveParts(t.getPointCount(),t.getPathCount());for(let n=0,i=t.getPathCount();n<i;++n){let o=new Lt,a=t.getPathStart(n),h=t.getPathEnd(n);o.addPoints(t,a,h);let m=t.isClosedPath(n),l=!1;if(m&&h-a==1&&t.hasNonLinearSegmentsPath(n)){let u=new st;t.getPointByVal(a,u),o.add(u),l=!0}if(this.m_transform&&!this.m_transform.isIdentity()){if(m&&!l){let u=new st;t.getPointByVal(a,u),o.add(u)}if(o=new Ws().execute(o,this.m_transform,this.m_progressTracker),m&&o.getPointCount()>1){let u=o.getXY(0),c=o.getXY(o.getPointCount()-1);u.equals(c)&&o.removePoint(o.getPointCount()-1)}}o.getPointCount()>1&&(s.addPathMultiPoint(o,0,-1,!0),m&&s.closePathWithLine())}return s}};function Td(r,t,e,s){r&&s.insertPath2D(-1,null,0,0,!0);let n=s.getPathCount()-1;s.insertPointsFromPoints(n,-1,e,0,e.length-1,!0),t&&s.insertPoint2D(n,-1,e.at(-1))}function Nd(r,t,e,s,n,i,o){o.reserve(o.getPointCount()+i.length-1);let a=new st;if(e.queryStart(a),r?o.startPathPoint(a):o.lineToPoint(a),i.length>2){let h=s.calculateLength2D();for(let m=1;m<i.length-1;m++){let l=s.lengthToT(n[m]*h);s.queryCoord(l,a),a.setXY(i[m]),o.lineToPoint(a)}}t&&(e.queryEnd(a),o.lineToPoint(a))}function D_(r,t,e,s,n,i,o,a,h,m,l,u,c){let g={stack:[],error:void 0,hasError:!1};try{let d=xe(g,new ve,!1),_=xe(g,new ve,!1),p=xe(g,new ve,!1);ts.geodeticDistance(r,t,s.x,s.y,n.x,n.y,p,d,_,e);let f=p.val,x=d.val,C=_.val,P=x,E=C;P<0&&(P+=2*Math.PI),E<0&&(E+=2*Math.PI),h&&(h[0]=P),m&&(m[0]=E);let S=Number.NaN,I=Number.NaN;if(l!==null){let L=Da.q90(r,t),W=Da.q(r,t,s.y);S=(L-W)/f,I=(L+W)/f}let D=Ky(s,n),b=$y(s,n),T=D||b,A=nP(s,n,a),G=xe(g,new xu(new ve,new ve),!1),F=new y,M=new y,q=new y;c[0]=zn(s.x,Number.NaN,c[0]);let R=c[0];if(f<=i)return u.push(s.clone()),c[0]=zn(n.x,Number.NaN,c[0]),l?.push(0),T?(D&&Gd(s,n,l,u),b&&Fd(s,n,l,u)):A?Vd(s,n,x,S,I,l,u):o>0&&(M.setCoords(s.x-R,s.y),F.setCoords(n.x-c[0],n.y),R=Ad()),u.push(n.clone()),f;let X=1+Math.ceil(f/i),z=f/(X-1),Y=new y;u.push(s.clone()),Y.setCoordsPoint2D(s),M.setCoords(s.x-c[0],s.y),l!==null&&l.push(0);for(let L=1;L<X;L++){let W;if(L<X-1){let K=L*z;ts.geodeticCoordinate(r,t,s.x,s.y,K,x,G.at(0),G.at(1),e),F.setCoords(G.at(0).val,G.at(1).val),c[0]=zn(F.x,Y.x,c[0]),q.setCoords(c[0]+F.x,F.y),W=L/(X-1)}else c[0]=zn(n.x,Number.NaN,c[0]),F.setCoords(n.x-c[0],n.y),q.setCoordsPoint2D(n),W=1;T?(L===1&&D&&Gd(s,q,l,u),L===X-1&&b&&Fd(Y,n,l,u)):A?N_(Y,q,a)&&(s.x<n.x?Y.x>q.x&&(c[0]+=2*Math.PI,q.setCoords(c[0]+F.x,F.y)):Y.x<q.x&&(c[0]-=2*Math.PI,q.setCoords(c[0]+F.x,F.y)),Vd(Y,q,x,S,I,l,u)):o>0&&Ad(),u.push(q.clone()),l?.push(W),Y.setCoordsPoint2D(q),M.setCoordsPoint2D(F),R=c[0]}return f}catch(d){g.error=d,g.hasError=!0}finally{qs(g)}}function Jy(r,t,e,s,n,i,o,a,h,m){w(0)}function Ad(r,t,e,s,n,i,o,a,h,m,l,u,c,g,d){return w(0),0}function tP(r,t,e,s){let n=ie(r,t,e),i=ie(r,t,s);return ot.distance(n,i)}function eP(r,t,e,s,n,i,o,a){let h=new Array,m=k(Array,8),l=2,u=n.getCoord2D(i);m[0][0]=u.x,m[0][1]=u.y,u=n.getCoord2D(o),m[1][0]=u.x,m[1][1]=u.y;let c=_=>{if(e!==null){let p=pe.projToGeog(e,_,m);w(p===_)}for(let p of m)p[0]*=s,p[1]*=s};c(2),h.push(ie(r,t,new y(m[0][0],m[0][1]))),h.push(ie(r,t,new y(m[1][0],m[1][1])));let g=ot.distance(h[0],h[1]);if(g>a)return g;let d=0;for(l=3;l<=17;){let _=1/(l-1),p=0;for(let P=1;P<l;++P)if(1&P){let E=pt(i,o,P*_);n.queryCoord2D(E,u),m[p][0]=u.x,m[p][1]=u.y,p++}c(p);let f=1;for(let P=0;P<p;++P)h.splice(f,0,ie(r,t,new y(m[P][0],m[P][1]))),f++;f=0;let x=h[f];f++;let C=0;for(;f!==h.length;++f){let P=h[f];C+=ot.distance(x,P),x=P}if(C>a)return C;if(d=C-g,w(d>=0||Math.abs(d)<1e-14*C),d<0&&(d=0),g=C,C+d<=a)return C+d;l=2*l-1}return g+d}function sP(r,t,e,s,n,i,o,a,h){let m=s.isCurve(),l=l1(r,t)*Math.PI*179/180,u=i;i>0&&!(i>l)||(u=l);let c=o,g=c>0,d=Number.NaN;g&&(d=d1(r,t,c));let _=n.getCoordinateSystemType()===1,p=null;_||(p=n.getPECoordSys());let f=n.getTolerance(0),x=s.getStartXY(),C=s.getEndXY(),P=new y,E=new y;if(_)P.setCoordsPoint2D(x),P.scale(e),E.setCoordsPoint2D(C),E.scale(e);else{let R=[x.x,x.y,C.x,C.y];pe.projToGeog(p,2,R),P.setCoords(R[0],R[1]),P.scale(e),E.setCoords(R[2],R[3]),E.scale(e)}let S=0,I=0,D=[],b=[],T=[];D.push(C.clone()),b.push(E.clone()),T.push(1),h.push(x.clone()),a!==null&&a.push(I);let A=n.isPannable(),G=x.clone(),F=[.5,.33333333333333337,.6666666666666666,.16666666666666669,.8333333333333333],M=5;m||(g?(F[0]=.5,F[1]=.25,F[2]=.75,M=3):M=1),w(u>0);let q=R=>{if(R=R.clone(),p!==null){let X=[R.x,R.y];pe.projToGeog(p,1,X),R.setCoords(X[0],X[1])}return R.scale(e),R};for(;b.length>0;){let R=D.at(-1).clone();E.assign(b.at(-1));let X=T.at(-1),z=!1,Y=Number.NaN,L=eP(r,t,p,e,s,I,X,u),W=u>=L&&Math.abs(P.y-E.y)<.9*Math.PI;_&&W&&(W=Math.abs(P.x-E.x)<.9*Math.PI);let K=new y,yt=new y,rt=!1;if(!g&&W&&W&&(rt=!0),s.calculateSubLength(I,X)<=f&&(rt=!0),!rt)for(let Q=0;Q<M;Q++){let ht=pt(I,X,F[Q]),it=new y;s.queryCoord2D(ht,it);let mt=q(it);if(Q===0&&(Y=ht,K.setCoordsPoint2D(it),yt.setCoordsPoint2D(mt),!W)){z=!0;break}if(w(g),_&&Math.abs(P.x-mt.x)>=Math.PI){z=!0;break}let De=new y,ue=new y;m?(De=y.lerp(G,R,F[Q]),ue=q(De)):(De=it.clone(),ue=mt.clone());let ce=i1(r,t,P,E,F[Q]),Vt=ce.clone();if(_?(Vt.x/=e,Vt.y/=e):(Vt.x/=e,Vt.y/=e,w_(n.getGCSToSRTransform(),[Vt],1,[Vt],null)),Vt.isNAN()){let Xe=ie(r,t,mt),Zt=ie(r,t,P),gs=ie(r,t,E),{first:Bt,second:fe}=Ho(r,t,Xe,Zt,gs,2,null);if(fe>d){z=!0;break}}else{if(A){let Bt=n.getPannableExtent().width(),fe=pt(s.getStartX(),s.getEndX(),.5);for(;Vt.x<fe-.5*Bt;)Vt.x+=Bt;for(;Vt.x>=fe+.5*Bt;)Vt.x-=Bt}let Xe=s.getClosestCoordinateOnInterval(Vt,new B(I,X),-1),Zt=s.getCoord2D(Xe);Zt=q(Zt);let gs=tP(r,t,Zt,ce);if(gs>d){if(gs<4*d){let Bt=ie(r,t,Zt),fe=ie(r,t,P),es=ie(r,t,E),{first:ss,second:Vs}=Ho(r,t,Bt,fe,es,2,null);gs=Vs}if(gs>d){z=!0;break}}else if(m){let Bt=ie(r,t,mt),fe=ie(r,t,P),es=ie(r,t,E),{second:ss}=Ho(r,t,Bt,fe,es,3,null);if(ss<=d){Bt=ie(r,t,ue);let{first:Vs,second:Ai}=Ho(r,t,Bt,fe,es,3,null);ss=Ai}if(ss>d){z=!0;break}}}}z?(D.push(K.clone()),b.push(yt.clone()),T.push(Y)):(D.pop(),b.pop(),T.pop(),h.push(R.clone()),S+=L,a!==null&&a.push(S),G.setCoordsPoint2D(R),P.setCoordsPoint2D(E),I=X)}if(a!==null){let R=1/S;for(let X=0;X<a.length;X++)a[X]*=R}}function El(r,t,e,s){if(s.reverse(),e!==null&&e.reverse(),r){let n=r[0],i=t[0];r[0]=i,t[0]=n}}function T_(r,t,e,s,n){r?(s.setCoordsPoint2D(e),n.setCoordsPoint2D(t)):(s.setCoordsPoint2D(t),n.setCoordsPoint2D(e))}function Md(r,t,e){return r?(e.create(t.getGeometryType()),t.copyTo(e.get()),e.get().reverse(),e.get()):t}function zn(r,t,e){if(Number.isNaN(t)){for(;e-r>Math.PI;)e-=2*Math.PI;for(;r-e>Math.PI;)e+=2*Math.PI;return e}return e+r-t>Math.PI?e-=2*Math.PI:t-(e+r)>Math.PI&&(e+=2*Math.PI),e}function Gd(r,t,e,s){if(r.y>0){let n=new y;n.setCoords(t.x,ut),It(r.x,n.x)||It(t.y,n.y)||(s.push(n),e!==null&&e.push(0))}else{let n=new y;n.setCoords(t.x,-ut),It(r.x,n.x)||It(t.y,n.y)||(s.push(n),e!==null&&e.push(0))}}function Fd(r,t,e,s){if(t.y>0){let n=new y;n.setCoords(r.x,ut),It(t.x,n.x)||It(r.y,n.y)||(s.push(n),e!==null&&e.push(1))}else{let n=new y;n.setCoords(r.x,-ut),It(t.x,n.x)||It(r.y,n.y)||(s.push(n),e!==null&&e.push(1))}}function Vd(r,t,e,s,n,i,o){if($C(e)){if(ut-r.y>0){let a=new y;a.setCoords(r.x,ut),o.push(a),i!==null&&i.push(s)}if(ut-t.y>0){let a=new y;a.setCoords(t.x,ut),o.push(a),i!==null&&i.push(s)}}else{if(ut+r.y>0){let a=new y;a.setCoords(r.x,-ut),o.push(a),i!==null&&i.push(n)}if(ut+t.y>0){let a=new y;a.setCoords(t.x,-ut),o.push(a),i!==null&&i.push(n)}}}function nP(r,t,e){return!(!N_(r,t,e)||It(r.y,ut)||It(r.y,-ut)||It(t.y,ut)||It(t.y,-ut))}function N_(r,t,e){return Math.abs(Math.abs(r.x-t.x)-Math.PI)<=e}function iP(r){if(r.x<-Math.PI)for(;r.x<-Math.PI;)r.x+=2*Math.PI;else if(r.x>Math.PI)for(;r.x>Math.PI;)r.x-=2*Math.PI}function aS(r,t,e,s){let n={stack:[],error:void 0,hasError:!1};try{let i=[e.x],o=[e.y-s],a=[e.x],h=[e.y+s];Bg(i,o),Bg(a,h);let m=xe(n,new ve,!1),l=xe(n,new ve,!1);return ts.greatEllipticDistance(r,t,e.x,e.y,i[0],o[0],m,null,null),ts.greatEllipticDistance(r,t,e.x,e.y,a[0],h[0],l,null,null),Math.min(m.val,l.val)}catch(i){n.error=i,n.hasError=!0}finally{qs(n)}}function rP(r,t,e,s,n){let i=new V;e.queryEnvelope(i);let o=Ae(null,e,!0).total();if(t.xmin-i.xmin<=o&&i.xmax-t.xmax<=o)return e;let a=t.width(),h=0;for(;t.xmin+h*a<i.xmin;)h++;for(;t.xmin+h*a>i.xmin;)h--;let m=h*a,l=new ct;l.setShiftCoords(-m,0);let u=e;u.applyTransformation(l);let c=new V;u.queryEnvelope(c);let g=null;if(c.xmax>t.xmax){let d=0,_=new V;_.setCoords({env2D:t}),_.ymin-=1,_.ymax+=1;let p=u;for(;_.xmin<c.xmax;){c.xmax>_.xmax&&(p=V_(p,r,2,!0,_.xmax));let f=io(p,_),x=Wt(null,f,!0).total(),C=St(p,_,x,Number.NaN,n);g===null?g=C===p?C.clone():C:(l.setShiftCoords(-d*a,0),C.applyTransformation(l),g.add(C,!1)),d++,_.xmin=_.xmax,_.xmax=t.xmax+d*a}}else g=u;return g}var Sl=class{constructor(t,e){this.m_basisX=new ot,this.m_basisY=new ot,this.m_normal=new ot,w(t.getCoordinateSystemType()===1),this.m_gcs=t;let s=Ti();t.querySpheroidData(s),this.m_a=s.majorSemiAxis,this.m_e2=s.e2,this.m_rpu=t.getUnit().getUnitToBaseFactor(),this.m_curvCenterRad=e.mul(this.m_rpu);let n=this.m_curvCenterRad.x,i=this.m_curvCenterRad.y,o=Math.cos(n),a=Math.sin(n),h=Math.cos(i),m=Math.sin(i);this.m_cartCenter3D=n1(this.m_a,this.m_e2,o,a,h,m),this.m_normal.setCoordsPoint3D(this.m_cartCenter3D),this.m_d=this.m_cartCenter3D.length(),this.m_normal.divThis(this.m_d),ot.selectRightHandedBasisFromNormal(this.m_normal,this.m_basisX,this.m_basisY),this.m_northPolePcs=this.projectPoint(y.construct(0,.5*Math.PI/this.m_rpu)),this.m_southPolePcs=this.projectPoint(y.construct(0,.5*-Math.PI/this.m_rpu))}project(t){let e=t.getGeometryType();if(Ie(e)){rn(t);let s=t;return this.projectMultiVertex(s)}U("Gnomonic.project")}unproject(t,e,s){let n=t.getGeometryType();if(Ie(n)){rn(t);let i=t,o=[];if(n===N.enumPolygon){let a=i.getPathCount();for(let h=0;h<a;h++){let m=i.calculateRingArea2D(h);o.push(m)}}return this.unprojectMultiVertex(e,i),at(n)?(dP(this.m_gcs,0,i),oP(o,this.m_gcs,0,i,s)):i=bi(i,this.m_gcs,0,!0,0,s),i}U("Gnomonic.unproject")}projectPoint(t){let e=t.mul(this.m_rpu),s=ie(this.m_a,this.m_e2,e),n=this.m_normal.dotProduct(s);if(n<=0)return y.construct(Number.NaN,Number.NaN);let i=this.m_d/n,o=s.mul(i).sub(this.m_cartCenter3D),a=new y;return a.x=this.m_basisX.dotProduct(o),a.y=this.m_basisY.dotProduct(o),a}unprojectPoint(t){let e=this.m_cartCenter3D.add(this.m_basisX.mul(t.x).add(this.m_basisY.mul(t.y)));return Vr(this.m_a,this.m_e2,e).divide(this.m_rpu)}projectMultiVertex(t){let e=t.getImpl(),s=!0,n=new y,i=new y;for(let o=0,a=e.getPointCount();o<a;o++)e.queryXY(o,n),n.y*this.m_rpu>.5*Math.PI?i.assign(this.m_northPolePcs):n.y*this.m_rpu<.5*-Math.PI?i.assign(this.m_southPolePcs):i.assign(this.projectPoint(n)),e.setXY(o,i),i.isNAN()&&(s=!1);return e.notifyModifiedFlags(2001),s}unprojectMultiVertex(t,e){let s=e.getImpl(),n=t*t,i=!this.m_northPolePcs.isNAN(),o=!this.m_southPolePcs.isNAN();for(let a=0,h=s.getPointCount();a<h;a++){let m=s.getXY(a),l=new y;i&&y.sqrDistance(m,this.m_northPolePcs)<=n?(l.setCoords(this.m_curvCenterRad.x,.5*Math.PI),l.scale(1/this.m_rpu)):o&&y.sqrDistance(m,this.m_southPolePcs)<=n?(l.setCoords(this.m_curvCenterRad.x,.5*-Math.PI),l.scale(1/this.m_rpu)):l=this.unprojectPoint(m),s.setXY(a,l)}s.notifyModifiedFlags(2001)}};function oP(r,t,e,s,n){let i=s.getGeometryType(),o=t.getPannableExtent(),a=s,h=!1,m=!1;if(i===N.enumPolygon){let l=new V,u=y.construct(e,0);l.setCoords({env2D:o}),l.centerAt(u),h=aP(r,t,l,a,n);let c=gP(t,l,a,n);c!==a&&(m=!0),a=c}else a=new Ws().foldInto360RangeGeodetic(a,t,2);i===N.enumPolygon&&(h||m)&&(a=new Ms().execute(a,t,!1,n)),a!==s&&(s.setEmpty(),s.add(a,!1))}function aP(r,t,e,s,n){let i=hP(e,s),o=mP(r,t,e,s,n);return i||o}function hP(r,t){let e=new V;t.queryEnvelope(e);let s=It(r.ymax,e.ymax),n=It(r.ymin,e.ymin),i=s||n;return!!i&&(lP(r,t),i)}function mP(r,t,e,s,n){let i=[],o=[],a=.5*e.width();for(let u=0;u<s.getPathCount();u++){let c=s.getXY(s.getPathStart(u)),g=s.getXY(s.getPathEnd(u)-1),d=r[u]<0;if(Math.abs(c.x-g.x)>a){let _=uP(d,t,e,u,s,n);i.push(_),o.push(u)}else if(!d&&s.calculateRingArea2D(u)<0){let _=cP(t,e,u,s,n);i.push(_),o.push(u)}}if(i.length===0)return!1;let h=new lt({vd:s.getDescription()}),m=0,l=o[m];for(let u=0;u<s.getPathCount();u++)u===l?(h.add(i[m],!1),m++,m<o.length&&(l=o[m])):h.addPath(s,u,!0);return s.setEmpty(),s.add(h,!1),!0}function lP(r,t){let e=new lt,s=new V;for(let n=0;n<t.getPathCount();n++){t.queryPathEnvelope(n,s);let i=It(r.ymax,s.ymax),o=It(r.ymin,s.ymin);if(!(i||o)){e.addPath(t,n,!0);continue}e.insertPath2D(-1,null,0,0,!0);let a=t.getPathStart(n),h=t.getPathEnd(n),m=h-a,l=-1;for(l=a;l<h;l++){let d=t.getXY(l);if(i=It(r.ymax,d.y),o=It(r.ymin,d.y),!i&&!o)break}let u=l,c=!1,g=Number.NaN;do{let d=t.getXY(u);i=It(r.ymax,d.y),o=It(r.ymin,d.y);let _=a+(u+1-a)%m;if(i||o){let p=y.construct(g,d.y);e.insertPoint2D(n,-1,p);let f=t.getXY(_),x=It(r.ymax,f.y),C=It(r.ymin,f.y);x||C||(p=y.construct(f.x,d.y),c?e.setXY(e.getPointCount()-1,p):e.insertPoint2D(n,-1,p)),c=!0}else e.insertPoint2D(n,-1,d),g=d.x,c=!1;u=_}while(u!==l)}t.setEmpty(),t.add(e,!1)}function uP(r,t,e,s,n,i){let o=new lt,a=new lt,h=new ct,m=n.getXY(n.getPathStart(s)),l=n.getXY(n.getPathEnd(s)-1),u=e.width(),c=.5*u,g=new V;n.queryEnvelope(g);let d=Math.ceil(g.width()/u)+1,_,p;m.x>l.x?(_=-u,p=r?e.ymin:e.ymax):(_=u,p=r?e.ymax:e.ymin),h.setShiftCoords(_,0),o.addPath(n,s,!0),a.add(o,!1);let f=new st;for(let M=0;M<d;M++)a.applyTransformation(h),a.getPointByVal(0,f),o.lineToPoint(f),o.addSegmentsFromPath(a,0,0,a.getSegmentCount()-1,!1);let x=o.getXY(0),C=o.getXY(o.getPointCount()-1);x.y=p,C.y=p,o.lineTo(C);let P=new y;for(P.setCoordsPoint2D(C),P.x-=.5*_;Math.abs(P.x-x.x)>c;)o.lineTo(P),P.x-=.5*_;o.lineTo(x);let E=e.getCenter().x,S=new V;o.queryEnvelope(S);let I=0,D=S.getCenter().x;D-E>c?I=-Math.ceil((D-E-c)/u):E-D>c&&(I=Math.ceil((E-D-c)/u)),I!==0&&(h.setShiftCoords(I*u,0),o.applyTransformation(h));let b=new Nt,T=b.addGeometry(o);Hr(b,T,t,0,2,!0,e.xmin),Hr(b,T,t,0,2,!0,e.xmax);let A=b.getGeometry(T),G=io(A,e);G.inflateCoords(0,1);let F=Wt(null,G,!0);return St(A,e,F.total(),Number.NaN,i)}function cP(r,t,e,s,n){let i=t.width(),o=.5*i,a=t.getCenter().x,h=new V;s.queryPathEnvelope(e,h);let m,l=0,u=h.getCenter().x;if(u-a>o?l=-Math.ceil((u-a-o)/i):a-u>o&&(l=Math.ceil((a-u-o)/i)),l!==0){let _=new ct;_.setShiftCoords(l*i,0),s.getImpl().applyTransformationToPath(_,e),s.queryPathEnvelope(e,h),u=h.getCenter().x}let c=new V;t.containsExclusiveEnvelope(h)?(m=!1,c.setCoords({env2D:t})):(m=!0,c.setCoords({env2D:t}),c.xmin-=i,c.xmax+=i);let g=s.createInstance();g.addPathPoint2D(null,0,!0);let d=new y;if(d.setCoords(c.xmin,c.ymin),g.insertPoint2D(0,-1,d),d.setCoords(c.xmin,c.ymax),g.insertPoint2D(0,-1,d),d.setCoords(.5*(c.xmin+c.xmax),c.ymax),g.insertPoint2D(0,-1,d),d.setCoords(c.xmax,c.ymax),g.insertPoint2D(0,-1,d),d.setCoords(c.xmax,c.ymin),g.insertPoint2D(0,-1,d),d.setCoords(.5*(c.xmin+c.xmax),c.ymin),g.insertPoint2D(0,-1,d),m){g.addPath(s,e,!0);let _=new ct;u<a?_.setShiftCoords(i,0):_.setShiftCoords(-i,0),s.getImpl().applyTransformationToPath(_,e),g.addPath(s,e,!0);let p=new Nt,f=p.addGeometry(g);Hr(p,f,r,0,2,!0,t.xmin),Hr(p,f,r,0,2,!0,t.xmax),g=p.getGeometry(f);let x=io(g,t);x.inflateCoords(0,1);let C=Wt(null,x,!0).total();g=St(g,t,C,Number.NaN,n)}else g.addPath(s,e,!0);return g}function gP(r,t,e,s){let n=new V;e.queryEnvelope(n);let i=Ae(null,e,!0).total();if(t.xmin-n.xmin<=i&&n.xmax-t.xmax<=i)return e;let o=e.createInstance(),a=e.createInstance(),h=new V,m=e.getPathCount();for(let l=0;l<m;l++)e.queryPathEnvelope(l,h),t.xmin-h.xmin<=i&&h.xmax-t.xmax<=i?o.addPath(e,l,!0):(a.setEmpty(),a.addPath(e,l,!0),a=rP(r,t,a,!0,s),o.add(a,!0));return o}function dP(r,t,e){let s=r.getPannableExtent(),n=y.construct(t,0);s.centerAt(n);let i=s.width(),o=.5*i,a=new y;a.setNAN();let h=Number.NaN;for(let m=0;m<e.getPathCount();m++)for(let l=e.getPathStart(m);l<e.getPathEnd(m);l++){let u=e.getXY(l),c=It(u.y,s.ymax)||It(s.ymin,u.y);l===e.getPathStart(m)?(a.setNAN(),h=0):a.isNAN()||c||(h=_P(u.x,a.x,o,i,h)),u.x+=h,e.setXY(l,u),c||a.setCoordsPoint2D(u)}e.getImpl().notifyModifiedFlags(2001)}function _P(r,t,e,s,n){return n+r-t>e?n-=s:t-(n+r)>e&&(n+=s),n}function qd(r,t,e,s,n,i){let o=t.getAttributeStreamRef(0),a=t.getPointCount(),h=!1,m=new y;for(let P=0;P<a;++P){if(o.queryPoint2D(2*P,m),1&i&&m.y>=e){h=!0;break}if(2&i&&m.y<=-e){h=!0;break}}if(!h)return!1;let l=!1;r&&(l=t.getImpl().isClosedPathInXYPlane(0));let u=new Nt,c=u.addGeometry(t),g=u.getFirstPath(c),d=-1,_=!0,p=new y,f=new st,x=v,C=A_*n/360;for(let P=u.getFirstVertex(g);P!==v;P=u.getNextVertex(P)){u.queryXY(P,m);let E=1&i&&m.y>=e?1:0;if(E|=2&i&&m.y<=-e?2:0,d>0&&d!==E){if(p.x!==m.x){let S=u.getPrevVertex(P);u.queryPoint(S,f);let I=u.insertVertex(g,P,f);p.x=m.x,u.setXY(I,p)}if(l){let S=x!==v?u.getNextVertex(x):u.getFirstVertex(g),I=u.getPrevVertex(P);for(;S!==I;)S=u.removeVertex(S,!1);if(x!==v){let D=u.getXY(x),b=u.getXY(I);if(Math.abs(D.x-b.x)>C){u.queryPoint(x,f);let T=u.insertVertex(g,I,f);D.x=pt(D.x,b.x,.5),u.setXY(T,D)}}}x=v}if(E&&(m.y=bs(s,m.y),u.setXY(P,m),!_&&d!==E))if(m.x!==p.x){u.queryPoint(P,f);let S=u.insertVertex(g,P,f);u.setXYCoords(S,p.x,m.y),x=S}else x=P;d=E,p.assign(m),_=!1}if(l){if(x!==v){let D=u.getNextVertex(x);for(;D!==v;)D=u.removeVertex(D,!1)}let P=u.getFirstVertex(g),E=u.getLastVertex(g),S=u.getXY(P),I=u.getXY(E);if(!S.equals(I)&&(u.queryPoint(P,f),E=u.insertVertex(g,v,f),Math.abs(S.x-I.x)>C)){let D=u.insertVertex(g,E,f);S.x=pt(S.x,I.x,.5),u.setXY(D,S)}}return t.assignCopy(u.getGeometry(c)),!0}function pP(r,t){let e=new lt({vd:r});e.addEnvelope(t,!1);let s=t.width()/180;return e=new Bs().execute(e,s,0,0,null),e}function fP(r,t){let e=r.getPannableExtent();return Number.isNaN(t)||e.centerAtCoords(t,0),e}function xP(r,t,e){let s=Ti();t.querySpheroidData(s);let n=t.getGCS()!==t?t.getSRToGCSTransform():null,i=k(y,100),o=new ot(0,0,0),a=r.getPointCount(),h=t.getGCS().getUnit().getUnitToBaseFactor();for(let c=0,g=a;c<g;){let d=Math.min(100,g-c);r.queryCoordinates(i,d,c,c+d),n&&new Ws().transform(n,i,d,i,!1);for(let _=0;_<d;_++){if(i[_].isNAN())continue;i[_].scale(h);let p=ie(s.majorSemiAxis,s.e2,i[_]);o.addThis(p)}c+=d}let m=Vr(s.majorSemiAxis,s.e2,o);m.scale(1/h);let l=r;if(!new Sl(t.getGCS(),m).project(l))return 0;e.length=r.getPathCount();let u=l.calculateArea2D()<0;for(let c=0,g=r.getPathCount();c<g;c++){let d=l.calculateRingArea2D(c),_=u?d<0:d>0;e[c]=_}return u?-1:1}function yP(r,t,e,s,n){if(!t.isPannable()||r.isEmpty())return r;let i=r.getGeometryType();i===N.enumGeometryCollection&&ft("not yet impl for geometry collection");let o=t.getPannableExtent();Number.isNaN(e)&&(e=o.getCenterX());let a=o.width(),h=.5*a,m=n>0,l=r.queryInterval(0,0);if(!m&&l.width()<h||!Ie(r.getGeometryType())){let u=l.getCenter();if(Math.abs(u-e)<=h)return r;{let c=new ct,g=an((e-u)/a)*a;c.setShiftCoords(g,0);let d=r.clone();return d.applyTransformation(c),d}}if(i===N.enumPolygon){let u=new dt({vd:r.getDescription()});u.addAndExplicitlyOpenAllPaths(r,!1),m&&(u=wd(u,t,2,n,Number.NaN,null,!0));let c=[];if(!s){{let g=r;m&&(g=new lt,g.add(u,!1));let d=xP(r,t,c);if(d)d<0&&u.reverseAllPaths();else{let _=g.getPathCount();for(let p=0;p<_;p++)c.push(g.calculateRingArea2D(p)>0)}}s=c}return new Ii(null,s,u,null,t,e,3,0,null).geoNormalizePolygonGeometry(!0)}if(i===N.enumPolyline){let u=new dt({vd:r.getDescription()});return u.addAndExplicitlyOpenAllPaths(r,!1),m&&(u=wd(u,t,2,n,Number.NaN,null,!0)),new Ii(null,null,u,null,t,e,3,0,null).geoNormalizePolylineGeometry(!0)}if(i===N.enumMultiPoint){let u=r,c=u.getAttributeStreamRef(0),g,d=null,_=e,p=0,f=.1*a;for(let x=0,C=u.getPointCount();x<C;x++){let P=c.read(2*x),E=P-_;if(Math.abs(E)>h&&(E=an(E/a)*a,p-=E,Math.abs(p)<f&&(p=0)),p!==0){d||(g=r.clone(),d=g.getAttributeStreamRef(0));let S=P+p;d.write(2*x,S)}_=P}return d?(g.notifyModified(),g):r}j("")}var A_=210,Ii=class{constructor(t,e,s,n,i,o,a,h,m){this.m_bAdjustedAtPoles=0,this.m_inputPoly=s,this.m_progressTracker=m,this.m_originalGeometry=t,this.m_originalSR=n,this.m_polygonRingFlags=e,this.m_pannableSR=i,this.m_poleSnappingTolerance=h,this.m_poleFlags=a,this.m_bAdjustedAtPoles=0,this.m_pannableExtent=fP(this.m_pannableSR,o),this.m_centralLongitude=Number.isNaN(o)?this.m_pannableExtent.getCenterX():o,this.m_width360=this.m_pannableExtent.width(),this.m_degree=this.m_width360/360,this.m_GCSLargeDelta=A_*this.m_degree,w(this.m_originalGeometry===null&&this.m_originalSR===null||this.m_originalGeometry!==null&&this.m_originalSR!==null)}geonormalizeRing(t,e,s,n,i,o,a){let h=s,m=new dt({vd:this.m_inputPoly.getDescription()});m.addPath(this.m_inputPoly,t,!0),this.m_poleFlags!==0&&(this.m_bAdjustedAtPoles|=qd(!0,m,this.m_pannableExtent.ymax-this.m_poleSnappingTolerance,this.m_pannableExtent.ymax,this.m_pannableExtent.width(),this.m_poleFlags)?1:0,this.m_bAdjustedAtPoles&&(h=!1));let l=-1;h&&(l=this.m_originalGeometry.getPathStart(t));let u=m.getAttributeStreamRef(0),c=m.getPointCount(),g=0,d=u.read(0),_=0,p=3*this.m_pannableSR.getTolerance(0),f=!1,x=new y,C=new y,P=!1,E=m.hasNonLinearSegments(),S=new y;for(let b=1;b<c;++b){u.queryPoint2D(2*b,S);let T=S.x,A=T+g,G=A-d;if(S.x=A,Math.abs(G)>this.m_GCSLargeDelta){if(h){let F=l+b-1,M=l+(b+1<c?b:0),q=o.read(2*F),R=(o.read(2*M)-q)*n;Math.abs(G-R)>1*this.m_degree&&(h=!1)}h||(g-=bs(this.m_width360,A-d),A=T+g,++_,P=g!==0,S.x=A)}else f||Vu(x,C,S,p)&&(f=!0);P&&(E&&j("error in geonormalize_ring_ for curves"),u.write(2*b,A)),d=A,x.setCoordsPoint2D(C),C.setCoordsPoint2D(S)}_&&m.notifyModified();let I=m.getXY(0),D=m.getXY(c-1);if(y.distance(I,D)<p){let b=this.finalizeGeoNormalizeClosedRing(m,f,i);a.add(b,!1)}else{e<0&&(this.m_originalGeometry!==null?(w(this.m_originalGeometry!==null),e=this.m_originalGeometry.calculateRingArea2D(t)>0?1:0):e=1);let b=this.finalizeGeoNormalizeOpenedRing(e>0,m);a.add(b,!1)}}geoNormalizePolygonGeometry(t){w(this.m_originalSR&&this.m_originalGeometry||!this.m_originalGeometry&&!this.m_originalSR),w(this.m_pannableSR.isPannable());let e=null,s=Number.NaN,n=!!this.m_originalSR&&this.m_originalSR.isPannable();n&&(e=this.m_originalGeometry.getAttributeStreamRef(0),s=this.m_width360/this.m_originalSR.getPannableExtent().width()),this.m_bAdjustedAtPoles=0;let i=new lt({vd:this.m_inputPoly.getDescription()});for(let d=0,_=this.m_inputPoly.getPathCount();d<_;++d){let p=this.m_polygonRingFlags?this.m_polygonRingFlags[d]?1:0:-1;this.geonormalizeRing(d,p,n,s,t,e,i)}let o=this.m_pannableSR.getTolerance(0),a=this.m_pannableExtent.width()/180;Ia(i,this.m_pannableExtent,.1*o,!1);let h=V.constructEmpty();if(h.setCoords({env2D:this.m_pannableExtent}),t){let d=!0;for(let _=0;_<2;_++){d=!0;let p=V.constructEmpty();for(let f=0,x=i.getPathCount();f<x;f++)if(i.queryPathEnvelope(f,p),!(h.xmin<=p.xmin&&h.xmax>=p.xmax||p.xmin>=h.xmax||p.xmax<=h.xmin)){d=!1;break}if(d)break;h.move(.5*this.m_width360,0)}d||h.setCoords({env2D:this.m_pannableExtent})}let m=St(i,h,o,a,this.m_progressTracker),l=i!==m,u=this.m_originalGeometry?this.m_originalGeometry.calculateArea2D():1,c=m.calculateArea2D(),g=0;if(c>0&&u<0)g=1;else if(c<=0&&u>0)if(c===0){if(this.m_originalSR){let d=Number.NaN;this.m_originalSR.getCoordinateSystemType()===2?d=this.m_originalSR.getPCSHorizon().calculateArea2D():this.m_originalSR.getCoordinateSystemType()===1&&(d=this.m_originalSR.getPannableExtent().getArea()),u>.99*d&&(g=-1)}}else g=-1;if(g!==0){let d=pP(m.getDescription(),h);d.add(m,!1),l=!0,m=d}return l&&(m=new Ms().execute(m,this.m_pannableSR,!1,this.m_progressTracker)),m}geoNormalizePolylineGeometry(t){w(this.m_pannableSR.isPannable());let e=null,s=this.m_originalSR&&this.m_originalSR.isPannable(),n=1;s&&(w(this.m_originalGeometry),n=this.m_width360/this.m_originalSR.getPannableExtent().width(),e=this.m_originalGeometry.getAttributeStreamRef(0));let i=this.m_pannableExtent.width(),o=i*kt()*4,a=t,h=Number.NaN,m=B.constructEmpty();this.m_bAdjustedAtPoles=0;let l=new dt({vd:this.m_inputPoly.getDescription()});for(let g=0,d=this.m_inputPoly.getPathCount();g<d;++g){let _=s,p=new dt({vd:this.m_inputPoly.getDescription()});p.addPath(this.m_inputPoly,g,!0);let f=this.m_inputPoly.isClosedPath(g);this.m_poleFlags!==0&&(this.m_bAdjustedAtPoles|=qd(f,p,this.m_pannableExtent.ymax-this.m_poleSnappingTolerance,this.m_pannableExtent.ymax,i,this.m_poleFlags)?1:0,this.m_bAdjustedAtPoles&&(_=!1));let x=-1,C=p.getPointCount(),P=!1;_&&(x=this.m_originalGeometry.getPathStart(g),P=this.m_originalGeometry.isClosedPath(g));let E=p.getAttributeStreamRef(0),S=0,I=E.read(0),D=0,b=new y,T=new y,A=!1,G=p.hasNonLinearSegments(),F=new y;for(let M=1;M<C;++M){E.queryPoint2D(2*M,F);let q=F.x,R=q+S,X=R-I;if(F.x=R,Math.abs(X)>this.m_GCSLargeDelta){if(_){let z=x+M-1,Y=x;(!P||M+1<C)&&(Y+=M);let L=e.read(2*z),W=(e.read(2*Y)-L)*n;Math.abs(X-W)>1*this.m_degree&&(_=!1)}_||(S-=bs(this.m_width360,R-I),R=q+S,++D,A=S!==0,F.x=R)}A&&(G&&j("error in geonormalize_ring_ for curves"),E.write(2*M,R)),I=R,b.setCoordsPoint2D(T),T.setCoordsPoint2D(F)}if(D&&p.notifyModified(),a){let M=!1;if(!p.isEmpty()){let q=V.constructEmpty();if(p.queryEnvelope(q),q.width()>=i||q.ymin<=this.m_pannableExtent.ymin||q.ymax>=this.m_pannableExtent.ymax)M=!0;else{if(Number.isNaN(h)){let X=this.m_centralLongitude-.5*i;h=q.xmin,h+=Math.round((X-q.xmin)/i)*i,h>X&&(h-=i),w(h<=X),h<X&&(h+=i),w(h>=X)}let R=Math.round((h-q.xmin)/i)*i;if(q.xmin+R>h+o&&(R-=i),q.xmin+R<h-o&&(R+=i),m.mergeCoordinate(q.xmin+R),m.mergeCoordinate(q.xmax+R),M=m.width()>=i,!M){let X=new ct;X.setShiftCoords(R,0),p.applyTransformation(X)}}}l.add(p,!1),M&&(l=(()=>{let q=new dt({vd:l.getDescription()});for(let R=0,X=l.getPathCount();R<X;++R){let z=new dt({vd:l.getDescription()});z.addPath(l,R,!0);let Y=bi(z,this.m_pannableSR,this.m_centralLongitude,!0,0,this.m_progressTracker);q.add(Y,!1)}return q})(),a=!1)}else{let M=bi(p,this.m_pannableSR,this.m_centralLongitude,!0,0,this.m_progressTracker);l.add(M,!1)}}if(a)return l;let u=this.m_pannableSR.getTolerance(0),c=this.m_pannableExtent.width()/180;return Ia(l,this.m_pannableExtent,.1*u,!1),St(l,this.m_pannableExtent,u,c,this.m_progressTracker)}finalizeGeoNormalizeOpenedRing(t,e){let s=e.getPointCount(),n=e.getXY(0),i=e.getXY(s-1);{let b=Math.abs(i.x-n.x),T=Math.round(b/this.m_width360)*this.m_width360;w(Math.abs(b-T)<this.m_pannableSR.getTolerance(0))}let o=Mt(i.x-n.x),a=V.constructEmpty();e.queryLooseEnvelope(a);let h=this.m_pannableExtent.getCenterX(),m=0,l=h-this.m_width360,u=h+this.m_width360;if(o>=0){let b=Math.ceil((l-a.xmin)/this.m_width360);for(b*=this.m_width360;l>a.xmin+b;)b+=this.m_width360;for(;l<a.xmax+b;)b-=this.m_width360;for(m=b,a.width()>720&&(u=l+360*Math.ceil(a.width()/360));u<a.xmax;)u+=this.m_width360}else{let b=Math.ceil((u-a.xmax)/this.m_width360);for(b*=this.m_width360;u<a.xmax+b;)b-=this.m_width360;for(;u>a.xmin+b;)b+=this.m_width360;for(m=b,a.width()>720&&(l=u-360*Math.ceil(a.width()/360));l>a.xmin;)l-=this.m_width360}let c=Math.round(Math.abs(i.x-n.x)/this.m_width360)*this.m_width360,g=o*c,d=a.clone();d.move(m,0);let _=new y(0,0),p=new ct;p.setShiftCoords(m,0),e.applyTransformation(p);let f=new dt({vd:e.getDescription()});f.add(e,!1),_.assign(e.getXY(s-1));let x=0,C=f.getXY(0).x;for(;o>0?d.xmax<u:d.xmin>l;)d.move(g,0),p.xd=g,e.applyTransformation(p),C+=g,this.m_pannableExtent.xmin<=C&&this.m_pannableExtent.xmax>=C&&(x=f.getPointCount()-1),e.setXY(0,_),_.assign(e.getXY(s-1)),f.addSegmentsFromPath(e,0,0,s-1,!1);let P=new lt({vd:f.getDescription()});P.add(f,!1);let E=f.getXY(0),S=f.getXY(f.getPointCount()-1),I=o<0?t:!t,D=P.getPointCount()-1;if(I){let b=new y(S.x,this.m_pannableExtent.ymax);P.lineTo(b);let T=new y(this.m_pannableExtent.getCenterX(),this.m_pannableExtent.ymax);P.lineTo(T);let A=new y(E.x,this.m_pannableExtent.ymax);P.lineTo(A)}else{let b=new y(S.x,this.m_pannableExtent.ymin);P.lineTo(b);let T=new y(this.m_pannableExtent.getCenterX(),this.m_pannableExtent.ymin);P.lineTo(T);let A=new y(E.x,this.m_pannableExtent.ymin);P.lineTo(A)}if(P.interpolateAttributesPath(0,D,0),P.getImpl().changeRingStartPoint(x),c>this.m_width360){let b=new lt({copy:P});p.setShiftCoords(this.m_width360,0),b.applyTransformation(p),P.add(b,!1)}return P}finalizeGeoNormalizeClosedRing(t,e,s){let n=new lt({vd:t.getDescription()});n.add(t,!1);let i=()=>{let l=n.getPointCount()-2;return n.getSegmentType(l)!==N.enumLine};if(n.hasNonLinearSegments()&&i()){let l=new et,u=n.getPointCount()-2;n.getSegmentBuffer(u,l,!1),n.removePointFromPath(0,u+1),n.closeLastPathWithSegment(l.get())}else n.removePointFromPath(0,n.getPointCount()-1);let o=V.constructEmpty();n.queryLooseEnvelope(o);let a=Math.ceil((this.m_pannableExtent.xmin-o.xmin)/this.m_width360);for(a*=this.m_width360;this.m_pannableExtent.xmin>o.xmin+a;)a+=this.m_width360;for(;this.m_pannableExtent.xmin<o.xmax+a;)a-=this.m_width360;if(a+=this.m_width360,a!==0){o.move(a,0);let l=new ct;l.setShiftCoords(a,0),n.applyTransformation(l)}if(this.m_pannableExtent.xmin<=o.xmin&&this.m_pannableExtent.xmax>=o.xmax){if(e){let u=n.calculateArea2D(),c=new Ms().execute(n,this.m_pannableSR,!0,this.m_progressTracker);if(c!==n){let g=c.calculateArea2D();Mt(u)!==Mt(g)&&c.reverseAllPaths(),n.assignMove(c)}}let l;if(l=new lt(s?{copy:n}:{move:n}),s)for(;o.xmin<this.m_pannableExtent.xmax;){o.move(this.m_width360,0);let u=new ct;u.setShiftCoords(this.m_width360,0),n.applyTransformation(u),l.add(n,!1)}return l}let h=new lt({vd:t.getDescription()});h.add(n,!1);let m=e||o.width()>this.m_width360-10*this.m_pannableSR.getTolerance(0);for(;o.xmin<this.m_pannableExtent.xmax;){o.move(this.m_width360,0);let l=new ct;l.setShiftCoords(this.m_width360,0),n.applyTransformation(l),h.add(n,!1)}if(m){let l=h.calculateArea2D();h.setFillRule(1),h=new Ms().execute(h,this.m_pannableSR,!0,this.m_progressTracker);let u=h.calculateArea2D();Mt(l)!==Mt(u)&&h.reverseAllPaths()}return h}geonormalize_ring_(t,e,s,n,i,o,a){w(0)}};function Yd(r){w(0);let t=DC(r),e=new vl;return e.setVertProj_(t),e}function PP(r,t=!0){return w(0),{}}function hS(r){return YC()}var vl=class{constructor(){this.m_hashCode=0,this.m_peVertSysVal=null,this.m_verticalUnit=new Fs,this.m_verticalShift=0,this.m_userVerticalWKID=0,this.m_bIsDepth=!1}getType(){return w(0),0}getID(){return w(0),0}getLatestID(){return this.m_peVertSysVal?this.m_peVertSysVal.getLatestID():0}getOldID(){return this.m_peVertSysVal?this.m_peVertSysVal.getOldID():0}getText(){return w(0),""}getTextExtended(t){return w(0),""}getText2(t){return w(0),""}getUnit(){return w(0),{}}equals(t){return w(0),!1}equalForProjection(t){return w(0),!1}getPeVertcsCopy(){return w(0),{}}getOneMeter(){return 1/this.m_verticalUnit.getUnitToBaseFactor()}getUnitToBaseFactor(){return w(0),0}isDepth(){return w(0),!1}getVerticalShift(){return w(0),0}isCustomWkid(){return!!this.m_peVertSysVal&&this.m_peVertSysVal.isCustomWkid()}getHashCode(){return this.m_hashCode}setVertProj_(t){this.m_peVertSysVal=t}getPEVerticalCoordSys(){return this.m_peVertSysVal?this.m_peVertSysVal.m_peVertcs:null}};function Ma(r,t,e,s,n){if(r.equals(t))return!1;if(s){let a=1,h=0,m=1,l=1,u=0,c=1;Number.isNaN(r.m_heightMetersPerUnit)||(a=r.m_heightMetersPerUnit,h=r.m_heightZ0,m=r.m_heightSign,l=t.m_heightMetersPerUnit,u=t.m_heightZ0,c=t.m_heightSign);let g=m*c*a/l;for(let d=0;d<n;d++)s[d]=(s[d]-h)*g+u}let i=1,o=0;if(Number.isNaN(r.m_XYToRadians)||(i=r.m_XYToRadians/t.m_XYToRadians,o=r.m_PrimeMeridianDegrees-t.m_PrimeMeridianDegrees,o!==0&&(o=Em(o),o/=t.m_XYToRadians)),Array.isArray(e)){let a=e;for(let h=0;h<n;h++)a[h][0]=a[h][0]*i+o,a[h][1]=a[h][1]*i}else{let a=e;for(let h=0;h<n;h++){let m=h<<1;a[m]=a[m]*i+o,a[m+1]=a[m+1]*i}}return!0}function Gs(){return{m_heightMetersPerUnit:0,m_heightSign:0,m_heightZ0:0,m_XYToRadians:0,m_PrimeMeridianDegrees:0,assign(r){this.m_heightMetersPerUnit=r.m_heightMetersPerUnit,this.m_heightSign=r.m_heightSign,this.m_heightZ0=r.m_heightZ0,this.m_XYToRadians=r.m_XYToRadians,this.m_PrimeMeridianDegrees=r.m_PrimeMeridianDegrees},equals(r){return Ne(this.m_heightSign,r.m_heightSign)&&Ne(this.m_heightMetersPerUnit,r.m_heightMetersPerUnit)&&Ne(this.m_heightZ0,r.m_heightZ0)&&Ne(this.m_XYToRadians,r.m_XYToRadians)&&Ne(this.m_PrimeMeridianDegrees,r.m_PrimeMeridianDegrees)},initFromGcsAndVcsPe(r,t){this.m_heightSign=1,this.m_heightMetersPerUnit=Number.NaN,this.m_heightZ0=0,this.m_XYToRadians=Number.NaN,this.m_PrimeMeridianDegrees=Number.NaN,t&&w(0),r&&(this.m_XYToRadians=r.getUnit().getUnitFactor(),this.m_PrimeMeridianDegrees=r.getPrimem().getLongitude())},initFromGcsAndVcs(r,t){let e=r?r.getPECoordSys():null,s=t?t.getPEVerticalCoordSys():null;this.initFromGcsAndVcsPe(e,s)},processUnitParams(r){Number.isNaN(this.m_heightMetersPerUnit)&&(this.m_heightMetersPerUnit=r.m_heightMetersPerUnit,this.m_heightSign=r.m_heightSign,this.m_heightZ0=r.m_heightZ0),Number.isNaN(this.m_XYToRadians)&&(this.m_XYToRadians=r.m_XYToRadians,this.m_PrimeMeridianDegrees=r.m_PrimeMeridianDegrees)}}}var Il=class{constructor(t){this.m_constantsLoaded=-1,this.m_isUsable=-1,this.m_inputSR=null,this.m_outputSR=null,this.m_inputSRHorz=null,this.m_outputSRHorz=null,this.m_inputVCS=null,this.m_outputVCS=null,this.m_hashCode=0,this.m_areaOfUse=new Me,this.m_inputUnitParams=Gs(),this.m_outputUnitParams=Gs(),w(t),this.m_geogTran=t,this.m_vertTran=null,this.m_latestID=te.getCode(this.m_geogTran),this.m_latestID<0&&(this.m_latestID=0);let e=this.m_geogTran.getGeogcs1();te.getCode(e);let s=this.m_geogTran.getGeogcs2();te.getCode(s),this.initUnitParams()}getLatestId(){return this.m_latestID}getText(){return this.m_geogTran?this.m_geogTran.toString():(w(0),"")}getGeogtran(){return this.m_geogTran}getVerttran(){return null}loadConstants(t){let e=this.m_constantsLoaded;if(e===-1){if(!t){this.m_geogTran||j("vcs not impl");let s=this.m_geogTran.getParameters();s[tt.PE_PARM_ND]!==null&&(t=s[tt.PE_PARM_ND].getValue()===0)}e=this.m_geogTran.loadConstants()?1:0,this.m_constantsLoaded=e}return e!==0}isUsable(){let t=this.m_isUsable;return t===-1&&(this.m_geogTran?this.m_isUsable=t=this.m_geogTran?1:0:this.m_isUsable=t=this.m_vertTran?1:0),t===1}getInputSr(t){return this.updateSrs(),t?this.m_inputSR:this.m_inputSRHorz}getOutputSr(t){return this.updateSrs(),t?this.m_outputSR:this.m_outputSRHorz}getHashCode(){let t=this.m_hashCode;return t===0&&(t=this.m_latestID>0?ps(this.m_latestID):eh(this.getText()),t===0&&(t=345),this.m_hashCode=t),t}isGeogtran(){return this.m_geogTran!==null}prepareOrThrow(){}getName(){return this.isGeogtran()?this.getGeogtran().getName():(ft("vcs not impl"),"")}updateSrs(){if(this.m_inputSR||this.m_inputVCS)return;let t,e,s,n,i,o;if(this.m_geogTran){let a=this.m_geogTran.getGeogcs1(),h=ba(a),m=this.m_geogTran.getGeogcs2(),l=ba(m),u=-1,c=-1;u=h.getVcsCode(),c=l.getVcsCode(),s=Ur(a,null,null,1),n=Ur(m,null,null,1),u>0&&c>0?(i=Yd(u),o=Yd(c),t=Rl(),e=Rl()):(t=s,e=n)}else w(0);this.m_inputSR||this.m_inputVCS||(this.m_inputSR=t,this.m_outputSR=e,this.m_inputSRHorz=s,this.m_outputSRHorz=n,this.m_inputVCS=i,this.m_outputVCS=o)}initUnitParams(){if(this.m_inputUnitParams.m_heightSign=1,this.m_inputUnitParams.m_heightMetersPerUnit=Number.NaN,this.m_inputUnitParams.m_heightZ0=0,this.m_outputUnitParams.m_heightSign=1,this.m_outputUnitParams.m_heightMetersPerUnit=Number.NaN,this.m_outputUnitParams.m_heightZ0=0,this.m_inputUnitParams.m_XYToRadians=Number.NaN,this.m_inputUnitParams.m_PrimeMeridianDegrees=Number.NaN,this.m_outputUnitParams.m_XYToRadians=Number.NaN,this.m_outputUnitParams.m_PrimeMeridianDegrees=Number.NaN,this.m_vertTran)w(0);else if(this.m_geogTran){let t=this.m_geogTran,e=t.getGeogcs1();this.m_inputUnitParams.m_XYToRadians=e.getUnit().getUnitFactor(),this.m_inputUnitParams.m_PrimeMeridianDegrees=e.getPrimem().getLongitude(),e=t.getGeogcs2(),this.m_outputUnitParams.m_XYToRadians=e.getUnit().getUnitFactor(),this.m_outputUnitParams.m_PrimeMeridianDegrees=e.getPrimem().getLongitude()}}};function M_(r,t,e,s,n,i,o){let a=null;t&&(a=t.getPEVerticalCoordSys());let h=null;r&&(h=r.getPECoordSys());let m=null;s&&(m=s.getPEVerticalCoordSys());let l=null;if(e&&(l=e.getPECoordSys()),!(h||a||l||m))return!1;let u=Gs();u.initFromGcsAndVcsPe(h,a);let c=Gs();return c.initFromGcsAndVcsPe(l,m),Ma(u,c,n,i,o)}function CP(r,t,e,s,n,i,o,a){let h=t,m=r,l=Gs();l.initFromGcsAndVcsPe(m,h),a.assign(s?e.m_outputUnitParams:e.m_inputUnitParams),a.processUnitParams(l),l.processUnitParams(a),o>0&&Ma(l,a,n,i,o)}function EP(r,t,e,s,n,i,o,a){let h=Gs();h.assign(e?t.m_inputUnitParams:t.m_outputUnitParams),h.processUnitParams(r);let m=null,l=null;s&&(l=s.getPECoordSys());let u=Gs();u.initFromGcsAndVcsPe(l,m),u.processUnitParams(h),h.processUnitParams(u),a>0&&Ma(h,u,i,o,a)}function SP(r,t,e,s,n,i,o,a,h){let m=Gs(),l=Gs();m.assign(e?t.m_inputUnitParams:t.m_outputUnitParams),l.assign(n?s.m_outputUnitParams:s.m_inputUnitParams),m.processUnitParams(r),l.processUnitParams(m),m.processUnitParams(l),a>0&&Ma(m,l,i,o,a),h.assign(l)}function vP(r,t,e,s,n,i,o){let a=t.getVerttran(),h=t.getGeogtran();if(o.assign(e?t.m_inputUnitParams:t.m_outputUnitParams),o.processUnitParams(r),i>0){t.prepareOrThrow();let m=e?tt.PE_TRANSFORM_2_TO_1:tt.PE_TRANSFORM_1_TO_2;a?H_():L_(h,i,s,n,m)}}function IP(r,t,e,s,n){let i=r.getVerttran(),o=r.getGeogtran();if(n>0){r.prepareOrThrow();let a=t?tt.PE_TRANSFORM_2_TO_1:tt.PE_TRANSFORM_1_TO_2;i?H_():L_(o,n,e,s,a)}}var Pa=class{supportsCurves(){return!0}accelerateGeometry(t,e,s){return bP(t,e,s)}canAccelerateGeometry(t){return G_(t)}};function bP(r,t,e){if(!G_(r))return!1;si(t,r,!1);let s=0,n=r.getGeometryType();return at(n)&&wr(r)&&e!==0&&(s|=r.getImpl().buildQuadTreeAccelerator(e)?1:0),at(n)&&gm(r)&&e!==0&&(s|=r.getImpl().buildQuadTreeForPathsAccelerator(e)?1:0),s>0}function G_(r){return wr(r)||gm(r)}var bl=class extends Pa{getOperatorType(){return 8}execute(t,e,s,n){return Sn(t,e,s,1,n)}};function wP(r,t,e,s){if(r.isEmpty()||t.isEmpty())return r;let n=r.getDimension(),i=t.getDimension();if(n>i)return r;let o=r.getGeometryType(),a=t.getGeometryType(),h=new V,m=new V,l=new V;r.queryEnvelope(h),t.queryEnvelope(m),l.setCoords({env2D:h}),l.mergeEnvelope2D(m);let u=Wt(e,l,!0),c=ke(u),g=new V;if(g.setCoords({env2D:h}),g.inflateCoords(c,c),!g.isIntersecting(m))return r;if(n===1&&i===2){let _=qP(r,t,a,e,s);if(_)return _}if(o===N.enumPoint){let _;switch(Qt(a)?(_=new dt({vd:t.getDescription()}),_.addSegment(t,!0)):_=t,a){case N.enumPolygon:return DP(r,_,u);case N.enumPolyline:return TP(r,_,u);case N.enumMultiPoint:return NP(r,_,u);case N.enumEnvelope:return AP(r,_,u);case N.enumPoint:return MP(r,_,u);default:U("invalid shape type")}}else if(o===N.enumMultiPoint)switch(a){case N.enumPolygon:return GP(r,t,u);case N.enumEnvelope:return FP(r,t,u);case N.enumPoint:return VP(r,t,u)}let d=new V(h);return d.inflate(100*u.total()),Dy(r,St(t,d,0,0,s),e,s)}var kr=class{getOperatorType(){return 10002}supportsCurves(){return!0}accelerateGeometry(t,e,s){return!1}canAccelerateGeometry(t){return!1}executeMany(t,e,s,n){return new wl(t,e,s,n)}execute(t,e,s,n){return this.executeMany(new Ys([t]),new Ys([e]),s,n).next()}},wl=class extends ns{constructor(t,e,s,n){super(),this.m_progressTracker=n,this.m_index=-1,this.m_inputGeoms=t,this.m_spatialReference=s;let i=e.next();this.m_geomSubtractor=i||new lt}next(){let t=this.m_inputGeoms.next();return t?(ds(t),mu(t),this.m_index=this.m_inputGeoms.getGeometryID(),wP(t,this.m_geomSubtractor,this.m_spatialReference,this.m_progressTracker)):null}getGeometryID(){return this.m_index}tock(){return!0}getRank(){return 1}};function DP(r,t,e,s){return C_(t,r,e.total())===0?r:r.createInstance()}function TP(r,t,e,s){let n=r.getXY(),i=t.querySegmentIterator(),o=ke(e),a=o*o;for(;i.nextPath();)for(;i.hasNextSegment();){let h=i.nextSegment(),m=new V;if(h.queryEnvelope(m),m.inflateCoords(o,o),!m.contains(n))continue;if(h.isIntersectingPoint(n,e.total()))return r.createInstance();let l=h.getStartXY();if(y.sqrDistance(n,l)<=a||(l=h.getEndXY(),y.sqrDistance(n,l)<=a))return r.createInstance()}return r}function NP(r,t,e,s){let n=t.getImpl().getAttributeStreamRef(0),i=t.getPointCount(),o=r.getXY(),a=ke(e),h=a*a,m=new y;for(let l=0;l<i;l++)if(n.queryPoint2D(2*l,m),y.sqrDistance(m,o)<=h)return r.createInstance();return r}function AP(r,t,e,s){let n=new V;t.queryEnvelope(n),n.inflate(e.total());let i=r.getXY();return n.contains(i)?r.createInstance():r}function MP(r,t,e,s){let n=ke(e),i=n*n,o=r.getXY(),a=t.getXY();return y.sqrDistance(o,a)<=i?r.createInstance():r}function GP(r,t,e,s){let n=new V;t.queryEnvelope(n),n.inflate(e.total());let i=r.getPointCount(),o=!1,a=Z(i,!1),h=new y;for(let l=0;l<i;l++)r.queryXY(l,h),n.contains(h)&&Ue(t,h,e.total())!==0&&(o=!0,a[l]=!0);if(!o)return r;let m=r.createInstance();for(let l=0;l<i;l++)a[l]||m.addPoints(r,l,l+1);return m}function FP(r,t,e,s){let n=new V;t.queryEnvelope(n),n.inflate(e.total());let i=r.getPointCount(),o=!1,a=Z(i,!1),h=new y;for(let l=0;l<i;l++)r.queryXY(l,h),n.contains(h)&&(o=!0,a[l]=!0);if(!o)return r;let m=r.createInstance();for(let l=0;l<i;l++)a[l]||m.addPoints(r,l,l+1);return m}function VP(r,t,e,s){let n=r.getImpl().getAttributeStreamRef(0),i=r.getPointCount(),o=t.getXY(),a=!1,h=Z(i,!1),m=ke(e),l=m*m,u=new y;for(let g=0;g<i;g++)n.queryPoint2D(2*g,u),y.sqrDistance(u,o)<=l&&(a=!0,h[g]=!0);if(!a)return r;let c=r.createInstance();for(let g=0;g<i;g++)h[g]||c.addPoints(r,g,g+1);return c}function qP(r,t,e,s,n){let i=new Me;r.queryEnvelope(i);let o=new V;t.queryEnvelope(o),i.merge(o);let a=.1*i.width(),h=.1*i.height();i.inflateCoords(a,h);let m=new lt;m.addEnvelope(i,!1);let l=m.getImpl();if(e===N.enumPolygon){let u=t.getImpl();l.add(u,!0)}else l.addEnvelope(t,!0);return new Xr(m,s,-1,n).tryFastImplementation(r)}var Rr=class{getOperatorType(){return 10001}supportsCurves(){return!0}accelerateGeometry(t,e,s){return!1}canAccelerateGeometry(t){return!1}executeMany(t,e,s,n=0){return new Ca(t,e,s,n)}execute(t,e,s,n){let i=new Ys([t,e]),o=new Ca(i,s,n,0).next();return o||j("null output"),o}};function YP(){return{geom:null,vertexCount:-1,bUnioned:!1,location:new y}}function XP(r,t){return y.compareZorder(r.location,t.location)?-1:r.location.equals(t.location)?0:1}var Dl=class{constructor(){this.binVertexCount=0,this.geometries=[]}addPair(t){this.binVertexCount+=t.vertexCount,this.geometries.push(t)}sort(){this.geometries.sort((t,e)=>XP(t,e))}geomCount(){return this.geometries.length}geomPairs(){return this.geometries}clear(){this.binVertexCount=0,this.geometries.length=0}getBinVertexCount(){return this.binVertexCount}},Ca=class r extends ns{constructor(t,e,s,n,i=!1){super(),this.m_index=-1,this.m_currentDim=-1,this.m_bDone=!1,this.m_unionBins=[],this.m_readyGeoms=ti(4),this.m_dimGeomCounts=Z(4,0),this.m_addedGeoms=0,this.m_maxDimension=-1,this.m_bHadGeometry=Z(4,!1),this.m_complexUnionGeoms=ti(4),this.m_totalNonEmptyGeomCounters=Z(4,0),this.m_progressTracker=s,this.m_bUnionAllDimensions=!!(4&n),this.m_bPreserveAllPathEnds=!!(8&n),this.m_inputGeoms=t,this.m_spatialReference=e,this.m_options=n,this.m_bIs3D=i}next(){if(this.m_bDone&&this.m_currentDim===this.m_maxDimension)return null;for(;!this.step_(););if(this.m_maxDimension===-1)return null;if(this.m_bUnionAllDimensions){if(this.m_currentDim===-1){for(let t=0;t<=this.m_maxDimension;t++)if(this.m_bHadGeometry[t]){this.m_complexUnionGeoms[t]=this.getResultGeometry(t);for(let e=t+1;e<=this.m_maxDimension;e++)this.m_complexUnionGeoms[e]=this.getResultGeometry(e),this.m_bHadGeometry[e]&&!this.m_complexUnionGeoms[e].isEmpty()&&(this.m_bIs3D?w(0):this.m_complexUnionGeoms[t]=new kr().execute(this.m_complexUnionGeoms[t],this.m_complexUnionGeoms[e],this.m_spatialReference,this.m_progressTracker))}}for(;this.m_currentDim++,(this.m_currentDim>this.m_maxDimension||this.m_currentDim<0)&&j(""),!this.m_bHadGeometry[this.m_currentDim];);if(this.m_index++,this.m_currentDim===0&&this.m_complexUnionGeoms[this.m_currentDim].getGeometryType()===N.enumPoint){let t=new Lt({vd:this.m_complexUnionGeoms[this.m_currentDim].getDescription()});return this.m_complexUnionGeoms[this.m_currentDim].isEmpty()||t.add(this.m_complexUnionGeoms[this.m_currentDim]),t}return this.m_complexUnionGeoms[this.m_currentDim]}return this.m_index=0,this.m_currentDim=this.m_maxDimension,this.getResultGeometry(this.m_maxDimension)}getGeometryID(){return this.m_index}getRank(){return 1}tock(){return this.step_()}getResultGeometry(t){return this.m_readyGeoms[t]}finishDim(t,e,s){let n=e;if(!s)return 16&this.m_options&&(n=qm([n],1,this.m_spatialReference,this.m_progressTracker,this.m_options,this.m_bIs3D)),n;if(1&this.m_options)return n;if(t===1)if(!(8&this.m_options)&&(16&this.m_options||this.m_totalNonEmptyGeomCounters[t]>1)){n=qm([n],1,this.m_spatialReference,this.m_progressTracker,16|this.m_options,this.m_bIs3D);let i=[0],o=n.getImpl().getIsSimple(0,i);w(this.m_bIs3D||Qs(o))}else this.m_totalNonEmptyGeomCounters[t]===1&&(this.m_bIs3D?w(0):n=new Ms().execute(n,this.m_spatialReference,!1,this.m_progressTracker));else this.m_bIs3D?w(0):n=new Ms().execute(n,this.m_spatialReference,!1,this.m_progressTracker);if(t===0&&n.getGeometryType()===N.enumPoint){let i=new Lt({vd:n.getDescription()});n.isEmpty()||i.add(n),n=i}return n}static getLevel(t){let s=Zn(t),n=s>0?(Math.log(s)-Math.log(32))/Math.log(4):0;return n<0&&(n=0),Math.floor(n)}step_(){if(this.m_bDone)return!0;let t;if(this.m_inputGeoms?(t=this.m_inputGeoms.next(),t===null?(this.m_bDone=!0,this.m_inputGeoms=null):(this.checkAndThrow(t),t.isEmpty()||this.m_totalNonEmptyGeomCounters[t.getDimension()]++)):t=null,t!==null){let e=t.getDimension();this.m_bHadGeometry[e]=!0,(e>=this.m_maxDimension||this.m_bUnionAllDimensions)&&(this.addGeom(e,!1,t),e>this.m_maxDimension&&!this.m_bUnionAllDimensions&&this.removeAllBinsWithLowerDimension(e))}if(this.m_addedGeoms>0)for(let e=0;e<=this.m_maxDimension;e++){for(;this.m_dimGeomCounts[e]>1;){let s=this.collectGeometriesToUnion(e);if(s===null)break;{let n;n=1&this.m_options?qm(s,s.length,this.m_spatialReference,this.m_progressTracker,this.m_options,this.m_bIs3D):My(s,s.length,this.m_spatialReference,this.m_progressTracker,8|this.m_options,this.m_bIs3D),this.addGeom(e,!0,n)}}if(this.m_bDone&&(w(this.m_dimGeomCounts[e]<=1),this.m_dimGeomCounts[e]!==0)){let s=this.m_unionBins[e].entries().next().value,n=s[1].geomPairs()[0].geom,i=s[1].geomPairs()[0].bUnioned;this.m_unionBins[e].clear(),this.m_readyGeoms[e]=this.finishDim(e,n,i)}}return this.m_bDone}addGeom(t,e,s){let n=YP();n.geom=s;let i=Zn(s);n.vertexCount=i;let o=V.constructEmpty();s.queryEnvelope(o),n.location=i>0?o.getCenter():new y(0,0);let a=r.getLevel(s);if(t+1>this.m_unionBins.length)for(;this.m_unionBins.length<Math.max(2,t+1);)this.m_unionBins.push(new Map);let h=null,m=this.m_unionBins[t].get(a);m&&(h=m),h===null&&(h=new Dl,this.m_unionBins[t].set(a,h)),n.bUnioned=e,h.addPair(n),this.m_dimGeomCounts[t]++,this.m_addedGeoms++,this.m_maxDimension=Math.max(this.m_maxDimension,t)}removeAllBinsWithLowerDimension(t){for(let e=0;e<t;e++)this.m_unionBins[e].clear(),this.m_addedGeoms-=this.m_dimGeomCounts[e],this.m_dimGeomCounts[e]=0}collectGeometriesToUnion(t){if(1&this.m_options&&!this.m_bDone)return null;let e=null,s=[];for(let n of this.m_unionBins[t].keys())s.push(n);Nn(s);for(let n=0;n<s.length;n++){if(s[n]===-1)continue;let i=this.m_unionBins[t].get(s[n]);{let h=i.getBinVertexCount()>5e3&&i.geomCount()>=4;if(this.m_bDone||h){for(let m=0;m<n;m++){if(s[m]===-1)continue;let l=this.m_unionBins[t].get(s[m]);l.sort(),this.m_dimGeomCounts[t]-=l.geomCount(),this.m_addedGeoms-=l.geomCount();for(let u of l.geomPairs())e||(e=new Array),e.push(u.geom);l.clear(),this.m_unionBins[t].delete(s[m]),s[m]=-1}i.sort(),this.m_dimGeomCounts[t]-=i.geomCount(),this.m_addedGeoms-=i.geomCount();for(let m of i.geomPairs())e||(e=new Array),e.push(m.geom);if(i.clear(),this.m_unionBins[t].delete(s[n]),s[n]=-1,!this.m_bDone)break}}}return e}checkAndThrow(t){this.m_bIs3D&&(t.getDimension()>1&&au(),t.hasAttribute(1)||U("Geometry must have Zs")),ds(t)}},Ea=class extends Pa{getOperatorType(){return 3}execute(t,e,s,n=null){return Sn(t,e,s,4,n)}};function Xd(r,t,e){let s=t.getGCSSplitLines();if(s===null)return r;let n=t.getGCS(),i=n.getPannableExtent().width(),o=V.constructEmpty();r.queryLooseEnvelope(o);let a=B.constructEmpty();o.queryIntervalX(a);let h=s.querySegmentIterator(),m=null,l=new ct;for(;h.nextPath();)for(;h.hasNextSegment();){let u=h.nextSegment(),c=u.queryInterval(0,0),g=B.constructEmpty();g.setCoordsFromEnvelope(c);let d=0;for(;g.vmax>a.vmin;)g.move(-i),d--;for(;g.vmin<=a.vmax;){if(g.isIntersecting(a)){m===null&&(m=new dt);let _=new nt({start:u.getStartXY(),end:u.getEndXY()});d!==0&&(l.setShiftCoords(d*i,0),_.applyTransformation(l)),m.addSegment(_,!0)}g.move(i),++d}}if(m!==null){let u=Ae(n,m,!0);return I1(r,m,ke(u),e)}return r}function Zl(r,t,e){let s=r.getName();return tp(s)||(e||t>0?(s=r.toString(tt.PE_STR_NAME_CANON|tt.PE_STR_AUTH_NONE),s=LP(s)):s=r.toString(tt.PE_STR_AUTH_TOP)),s}function kP(r,t,e,s){return w(0),""}function kd(r,t=-1){if((t>1||t<-1)&&U("verbosity"),t===-1)return r.toString();{let e=t===0?tt.PE_STR_AUTH_TOP:tt.PE_STR_AUTH_ALL;return r.toString(e)}}function RP(r,t){(t>1||t<-1)&&U("verbosity");let e=tt.PE_STR_FMT_WKT2;return t!==-1&&(e|=t===0?tt.PE_STR_AUTH_TOP:tt.PE_STR_AUTH_ALL),r.toString(e)}function HP(r){return w(0),""}function LP(r){return r.toLocaleUpperCase("en-US")}function BP(r,t,e){let s=r.getPCSHorizon();if(s.getGeometryType()!==N.enumPolygon)if(s.getGeometryType()!==N.enumEnvelope)U("");else{let n=s;for(let i=0;i<e;i++)n.contains(t[i])||t[i].setNAN()}else{let n=r.getDefaultPrecisionSR().getTolerance(0),i=s;for(let o=0;o<e;o++)Ue(i,t[o],n)!==1&&t[o].setNAN()}}function UP(r,t,e,s){for(let n=0;n<t;n++){if(r[n].y<e.ymin||r[n].y>e.ymax){r[n].setNAN();continue}let i=r[n].x;r[n].x=Bn(i,e,s)}}function Xm(r,t,e,s){if(r.isEmpty()||e===1)return r;let n=r.getGeometryType();if(n===N.enumPoint){let P=r,E=P.getXY();return Nl([E],1,t,e)===0||E.isNAN()?P.setEmpty():P.setXY(E),r}if(n===N.enumMultiPoint){let P=r,E=r.createInstance(),S=P.getPointCount();E.reserve(S);let I=P.getAttributeStreamRef(0),D=P.getDescription().getAttributeCount()>1,b=new st,T=Float64Array.from(I.getArray());if(Nl(T,S,t,e)>0)for(let A=0,G=2*S;A<G;A+=2)Number.isNaN(T[A])||(D?(P.getPointByVal(A>>1,b),b.setXYCoords(T[A],T[A+1]),E.add(b)):E.addXY(T[A],T[A+1]));return E}let i=r,o=t.getOneDegreeGCSUnit(),a=90*o,h=180*o,m=360*o,l=t.getCentralMeridian(),u=.5*o,c=V.constructEmpty();i.queryEnvelope(c);let g=t.getGCSHorizon(),d=t.getGCSHorisonIsInclusive(),_=g.getGeometryType()===N.enumEnvelope,p=V.constructEmpty();g.queryEnvelope(p);let f=t.getGCS();if(e!==2&&e!==4||(p.xmin=l-h,p.xmax=p.xmin+m),e===4){if(!(c.width()>m-o)){let P=V.constructEmpty();P.setCoords({xmin:c.xmin-o,ymin:p.ymin,xmax:c.xmax+o,ymax:p.ymax}),i=new Js().execute(i,P,f,s);let E=Math.floor((l-c.getCenterX())/m);for(c.move(E*m,0);c.xmin>p.xmax;)E-=1,c.move(-m,0);for(;c.xmin<p.xmin;)E+=1,c.move(m,0);if(E!==0){let S=new ct;S.setShiftCoords(E*m,0),i.applyTransformation(S)}return i}e=2}if(e===2&&(p.xmin=l-h,p.xmax=p.xmin+m),c.ymin<-a||c.ymax>a){let P=V.constructEmpty();if(P.setCoords({xmin:c.xmin-o,ymin:-a,xmax:c.xmax+o,ymax:a}),i=new Js().execute(i,P,f,s),i.isEmpty())return i;i.queryEnvelope(c)}if(d&&(p.ymax<c.ymin||p.ymin>c.ymax))return i.createInstance();c.width()>m&&(i=va(i,l-h,m,f,!0,0,!0,s),i.queryEnvelope(c));let x=ZP(c.xmin,c.xmax,p.xmin,p.xmax,m);if(x!==0&&c.move(x,0),c.xmax>p.xmax||c.xmin<p.xmin){if(c.xmax>p.xmax)for(;c.xmin>=p.xmax;)c.move(-m,0),x-=m;for(;c.xmin<p.xmax-m;)c.move(m,0),x+=m}let C=si(f,g,!1);if(x!==0){let P=new ct;P.setShiftCoords(x,0),i.applyTransformation(P),x=0}if(d){if(_&&p.containsEnvelope(c))return i;let P=new Array(2);for(let E=0;E<2;E++){let S;if(_?S=at(n)?St(i,p,C,u,s):St(i,p,C,0,s):(S=new wn().execute(i,g,f,s),S===g&&(S=S.clone())),p.xmin<=c.xmin&&p.xmax>=c.xmax||p.xmin>=c.xmin&&p.xmax<=c.xmax)return S;if(P[E]=S,E===0){c.move(-m,0);let I=new ct;I.setShiftCoords(-m,0),i.applyTransformation(I)}}return at(n)?P[0].add(P[1],!1):j("intersect_with_GCS_horizon: unexpected geometry type"),P[0]}{if(p.ymax<c.ymin||p.ymin>c.ymax)return i;let P=0;for(;!i.isEmpty()&&c.xmax>p.xmin;){if(P!==0){let E=new ct;E.setShiftCoords(P,0),i.applyTransformation(E)}if(new Ea().execute(i,g,f,s)||(i=new kr().execute(i,g,f,s),g===i&&(i=i.clone())),P!==0){let E=new ct;E.setShiftCoords(-P,0),i.applyTransformation(E)}P-=m,c.move(-m,0)}return i}}function zP(r,t,e,s,n,i){let o={stack:[],error:void 0,hasError:!1};try{if(i===2)return m1(r,t,e,s,n);if(Math.abs(e.x-s.x)>=Math.PI||!Hm(e.x,s.x,n))return Number.NaN;e.x>s.x&&(s=O(e,e=s));let a=xe(o,new ve,!1),h=xe(o,new ve,!1),m=xe(o,new ve,!1),l=e.clone();ts.geodeticDistance(r,t,e.x,e.y,s.x,s.y,h,a,null,i);let u=h.val,c=0,g=1;for(;u*(g-c)>1e-12*r;){let d=.5*(c+g);if(ts.geodeticCoordinate(r,t,e.x,e.y,u*d,a.val,h,m,i),l.x=h.val,l.y=m.val,l.x===n)return l.y;if(Hm(e.x,l.x,n))g=d;else{if(!Hm(s.x,l.x,n))return Number.NaN;c=d}}return l.y}catch(a){o.error=a,o.hasError=!0}finally{qs(o)}}function OP(r,t){let e;if(Array.isArray(r)){let s=r;e=new Float64Array(2*t);for(let n=0,i=0;n<t;n++,i+=2)e[i]=s[n].x,e[i+1]=s[n].y}else e=r;return e}function Tl(r,t,e,s){for(let n=0,i=0;n<s;n++,i+=2)t[e+n].x=r[i],t[e+n].y=r[i+1]}function Nl(r,t,e,s){if(t===0||s===1)return t;let n=OP(r,t);if(s===2){let _=e.getPannableExtentInGCS(),p=t;for(let f=0,x=2*t;f<x;f+=2)(n[f+1]>_.ymax||n[f+1]<_.ymin)&&(n[f]=Number.NaN,p--);return p?(Ko(n,t,_.xmin,_.width(),!0),r!==n&&Tl(n,r,0,t),p):0}let i=e.getOneDegreeGCSUnit(),o=90*i,a=180*i,h=360*i,m=t;for(let _=0,p=2*t;_<p;_+=2)(n[_+1]>o||n[_+1]<-o)&&(n[_]=Number.NaN,m--);if(!m)return 0;let l=V.constructEmpty();l.setFromPoints(n,t);let u=e.getGCSHorizon(),c=e.getGCSHorisonIsInclusive(),g=u.getGeometryType()===N.enumEnvelope,d=V.constructEmpty();if(u.queryEnvelope(d),c&&(d.ymax<l.ymin||d.ymin>l.ymax))return 0;if(c)if(Ko(n,t,d.getCenterX()-a,h,!0),m=t,g)for(let _=0,p=2*t;_<p;_+=2)d.containsCoords(n[_],n[_+1])||(n[_]=Number.NaN,m--);else{let _=si(e.getGCS(),u,!1),p=new y;for(let f=0,x=2*t;f<x;f+=2)p.setCoords(n[f],n[f+1]),Ue(u,p,_)!==0||(n[f]=Number.NaN,m--)}else{Ko(n,t,-a,h,!0),m=t;let _=si(e.getGCS(),u,!1),p=new y;for(let f=0,x=2*t;f<x;f+=2){p.setCoords(n[f],n[f+1]),p.isNAN()&&m--;let C=q_(p.x,d.xmin,d.xmax,h);p.x+=C,Ue(u,p,_)!==0&&(n[f]=Number.NaN,m--)}}return m>0&&Array.isArray(r)&&Tl(n,r,0,t),m}function bi(r,t,e,s,n,i){if(t.isPannable()||U("fold_into_360_degree_range"),r.isEmpty())return r;let o,a;if(t.getCoordinateSystemType()===2){let h=t.getPannableExtent();a=h.xmin,o=h.width()}else{let h=t.getOneDegreeGCSUnit();o=360*h,a=e-180*h}return va(r,a,o,t,s,n,!0,i)}function F_(r,t,e,s){let n,i;if(e.getCoordinateSystemType()===2){let o=e.getPannableExtent();n=o.xmin,i=o.width()}else{let o=e.getOneDegreeGCSUnit();i=360*o,n=s-180*o}Ko(r,t,n,i)}function km(r,t){let e=t.width(),s=Xs(r-t.vmin,e);return s<0&&(s+=e),t.snapClip(s+t.vmin)}function Bn(r,t,e){return r>t.xmax&&r-t.xmax<e?t.xmax:r<t.xmin&&t.xmin-r<e?t.xmin:r}function Sa(r,t,e){if(r[0]<t.vmin||r[0]>t.vmax||e&&r[0]===t.vmax){let s=t.width();return r[0]+=Math.ceil((t.vmin-r[0])/s)*s,r[0]=t.snapClip(r[0]),!0}return!1}function WP(r,t,e,s,n,i,o,a,h){return new Ii(r,null,e,t,s,n,o,a,i).geoNormalizePolygonGeometry(h)}function jP(r,t,e,s,n,i,o,a,h){return new Ii(r,null,e,t,s,n,o,a,i).geoNormalizePolylineGeometry(h)}function V_(r,t,e,s,n){let i=new Nt,o=i.addGeometry(r);return Hr(i,o,t,si(t,r,!1),e,s,n),i.getGeometry(o)}function Hr(r,t,e,s,n,i,o){let a={stack:[],error:void 0,hasError:!1};try{w(Is()),e.isPannable()||re("insert_geodetic_points");let h=e.getPannableExtent(),m=e.getGCS(),l=Ti();m.querySpheroidData(l);let u=m.getUnit().getUnitToBaseFactor(),c=l.majorSemiAxis,g=l.e2,d=0,_=new B;h.queryIntervalX(_);let p=null,f=Z(4,Number.NaN);e.getCoordinateSystemType()===2?(p=e.getPECoordSys(),i?(f[0]=km(o,_),f[1]=h.getCenterY(),pe.projToGeog(p,1,f),d=f[0]*u):(f[0]=h.getCenterX(),f[1]=o,pe.projToGeog(p,1,f),d=f[1]*u)):d=o*u,i||d===0||n===2||re("insert_geodetic_points: 1");let x=xe(a,new ve,!1),C=new y,P=new y,E=new y,S=new y,I=new y,D=new y;for(let b=r.getFirstPath(t);b!==v;b=r.getNextPath(b)){let T=r.getFirstVertex(b);r.queryXY(T,E);let A=!1,G=r.getNextVertex(T);for(let F=G;F!==v;F=r.getNextVertex(F)){if(F===G){if(A)break;A=!0}if(r.queryXY(F,S),i&&(s<o-E.x&&S.x-o>s||s<o-S.x&&E.x-o>s)||!i&&(o!==0||s<-E.y&&S.y>s||s<-S.y&&E.y>s))do{if(Math.abs(E.x-S.x)>=.5*_.width())break;e.getCoordinateSystemType()===2?(f[0]=km(E.x,_),f[1]=E.y,f[2]=km(S.x,_),f[3]=S.y,Ga(p,2,f,0),I.x=f[0]*u,I.y=f[1]*u,D.y=f[3]*u):(I.x=E.x*u,I.y=E.y*u,D.y=S.y*u),D.x=(S.x-E.x)*Math.PI*2/_.width()+I.x;let M=0,q=k(y,2);if(i){if(P.x=d,P.y=zP(c,g,I,D,d,n),Number.isNaN(P.y))break;q[0]=P,M=1}else if(n===2){let X=[0,0];if(M=Qd(c,g,I,D,d,X),!M)break;q[0].x=X[0],q[0].y=d,M===2&&(q[1].x=X[1],q[1].y=d)}else{if(P.x=PC(c,g,I,D,n),Number.isNaN(P.x))break;P.y=0,q[0]=P,M=1}let R=-1;for(let X=0;X<M;X++){ts.geodeticDistance(c,g,I.x,I.y,D.x,D.y,x,null,null,n);let z=x.val;ts.geodeticDistance(c,g,I.x,I.y,q[X].x,q[X].y,x,null,null,n);let Y=x.val;e.getCoordinateSystemType()===2?(f[0]=q[X].x/u,f[1]=q[X].y/u,pe.geogToProj(p,1,f),i?(C.y=f[1],C.x=o):(C.x=Ld(f[0],E.x,S.x,_),C.y=o)):i?(C.x=o,C.y=q[X].y/u):(C.x=Ld(q[X].x/u,E.x,S.x,_),C.y=o);let L=z>0?Tt(Y/z,0,1):.5;if(L===0||L===1||R>L)continue;let W=r.getPrevVertex(F);r.splitSegment(W,[L],1);let K=r.getNextVertex(W);r.setXYCoords(K,C.x,C.y),R=L}}while(!1);E.setCoordsPoint2D(S)}}}catch(h){a.error=h,a.hasError=!0}finally{qs(a)}}function jr(r,t){w(t.isPannable());let e=t.getPannableExtent();if(r.getGeometryType()===N.enumPoint){let a=r.getY();return e.ymin<=a&&a<=e.ymax?r:r.createInstance()}let s=V.constructEmpty();r.queryEnvelope(s);let n=V.constructEmpty();n.setCoords({env2D:e}),n.xmin=s.xmin,n.xmax=s.xmax,n.inflateCoords(.01*n.height(),0);let i=un(t,s,!1),o;return o=n.containsEnvelope(s)?r:St(r,n,i,0,null),o}function q_(r,t,e,s){return an((.5*(e+t)-r)/s)*s}function ZP(r,t,e,s,n){return r>=e&&t<=s?0:q_(.5*(t+r),e,s,n)}function va(r,t,e,s,n,i,o,a){let h=r.getGeometryType(),m=B.constructEmpty();m.setCoords(t,t+e);let l=[0];if(h===N.enumPoint){let I=r;if(l[0]=I.getX(),Sa(l,m,o)){let D=n?r:r.clone();return D.setX(l[0]),D}return r}let u=V.constructEmpty();if(r.queryEnvelope(u),u.isEmpty())return r;if(h===N.enumMultiPoint){let I=n?r:r.clone(),D=I.getImpl(),b=D.getAttributeStreamRef(0),T=2*D.getPointCount(),A=!1;for(let G=0;G<T;G+=2)l[0]=b.read(G),Sa(l,m,o)&&(b.write(G,l[0]),A=!0);return A&&D.notifyModifiedFlags(2001),I}let c=B.constructEmpty();if(u.queryIntervalX(c),m.contains(c))return m.vmax,c.vmax,r;let g=V.constructEmpty();if(g.setCoords({env2D:u}),c.width()===0){let I=c.vmin;I+=Math.ceil((m.vmin-I)/e)*e,I=m.snapClip(I);let D=n?r:r.clone();return D.setAttributeBasic(0,0,I),D}if(h===N.enumEnvelope){let I=n?r:r.clone();return u.intersect(g),I.setEnvelope(u),I}let d=.1*Math.max(u.height(),u.width())*1;g.inflateCoords(0,d);let _=r,p=s.getTolerance(0),f=new ct;for(;;){let I=Math.floor((c.vmin-t)/e),D=Math.ceil((c.vmax-t)/e);if(!(D-I>3))break;{let b=Math.floor(.5*(D+I));g.xmin=u.xmin-d,g.xmax=t+e*b;let T=St(_,g,p,i,a);g.xmin=g.xmax,g.xmax=u.xmax+d;let A=St(_,g,p,i,a);f.setShiftCoords((b-D)*e,0),A.applyTransformation(f),h===N.enumPolygon?_=new Rr().execute(T,A,s,a):(_=T,_.add(A,!1)),_.queryEnvelope(u),u.queryIntervalX(c)}}g.xmin=t,g.xmax=t+e;let x=V.constructEmpty();x.setCoords({env2D:g}),x.inflateCoords(p,0);let C=Math.floor((u.xmin-g.xmin)/e)*e,P;C?(g.move(C,0),f.setShiftCoords(-C,0)):f.setIdentity(),P=h===N.enumPolyline?new dt({vd:_.getDescription()}):new lt({vd:_.getDescription()});let E=V.constructEmpty(),S=V.constructEmpty();for(;u.xmax>g.xmin;){let I=St(_,g,p,0,a);I.queryEnvelope(S);let D=!1;D=h===N.enumPolyline?!I.isEmpty()&&(S.width()>p||S.height()>p):!I.isEmpty()&&(h!==N.enumPolygon||S.width()>p),D&&(I.applyTransformation(f),I.queryEnvelope(S),P.queryEnvelope(E),E.inflateCoords(p,p),E.isIntersecting(S)&&h===N.enumPolygon?P=new Rr().execute(P,I,s,a):P.add(I,!1)),g.move(e,0),f.shiftCoords(-e,0)}return P}function Ko(r,t,e,s,n=!0){let i=new B;i.setCoords(e,e+s);let o=[0];if(Array.isArray(r)){let a=r;for(let h=0;h<t;h++)i.containsRightExclusive(a[h].x)||(o[0]=a[h].x,Sa(o,i,n),a[h].x=o[0])}else{let a=r;for(let h=0;h<t;h++){let m=h<<1;i.containsRightExclusive(a[m])||(o[0]=a[m],Sa(o,i,n),a[m]=o[0])}}}function Ia(r,t,e,s=!0){if(r.isEmpty())return;let n=r.getGeometryType();if(!s||n!==N.enumPolygon)if(Ie(n)){let i=!1;if(at(n)&&r.hasNonLinearSegments()){let o=r.getImpl(),a=o.getAttributeStreamRef(0),h=o.getSegmentFlagsStreamRef();w(h!==null);for(let m=0,l=o.getPathCount();m<l;m++){let u=!0,c=o.isClosedPath(m),g=o.getPathEnd(m);c&&o.getPathSize(m)>0&&(u=(31&h.read(g-1))===1);for(let d=o.getPathStart(m);d<g;d++)if((31&h.read(d))===1){if(u){let _=a.read(2*d),p=Bn(_,t,e);p!==_&&(i=!0,a.write(2*d,p))}u=!0}else u=!1}}else{let o=r.getImpl(),a=o.getAttributeStreamRef(0);for(let h=0,m=o.getPointCount();h<m;h++){let l=a.read(2*h),u=Bn(l,t,e);u!==l&&(i=!0,a.write(2*h,u))}}i&&r.getImpl().notifyModifiedFlags(2001)}else if(n===N.enumEnvelope){let i=r,o=V.constructEmpty();i.queryEnvelope(o),o.xmin=Bn(o.xmin,t,e),o.xmax=Bn(o.xmax,t,e),i.setEnvelope(o)}else if(n===N.enumPoint){let i=r;i.setX(Bn(i.getX(),t,e))}else j("")}function QP(r,t,e){let s=new y;return s.x=Bn(r.x,t,e),s.y=r.y,s}function KP(r,t){if(t.isEmpty())return 0;let e=r.getPECoordSys();if(e.getProjection().getCode()===tt.PE_PRJ_AZIMUTHAL_EQUIDISTANT){let s=Ti();r.querySpheroidData(s);let n=e.getParameters();if(n[tt.PE_PARM_LAM0]===null||n[tt.PE_PARM_PHI0]===null)return 0;let i=[n[tt.PE_PARM_LAM0].getValue(),n[tt.PE_PARM_PHI0].getValue()];pe.geogToProj(e,1,i);let o=new y(i[0],i[1]),a=V.constructEmpty();t.queryEnvelope(a);let h=k(y,4);a.queryCorners(h);let m=0,l=r.getOneMeter(),u=Math.max(s.majorSemiAxis,s.minorSemiAxis)*Math.PI,c=Math.min(s.majorSemiAxis,s.minorSemiAxis)*Math.PI;c-=u/180,u*=l,c*=l;for(let g=0;g<4;g++){let d=y.distance(h[g],o);if(d>u)m++;else if(d>c)return-1}if(m===0)return 1;if(m===4){let g=V.constructEmpty();return g.setCoords({center:o,width:u,height:u}),a.isIntersectingNe(g)?-1:0}return-1}return-1}function Rm(r,t,e,s){let n=r.getGeometryType();w(n===N.enumPolygon||n===N.enumPolyline||n===N.enumMultiPoint);let i=t.getCoordinateSystemType();if(i===2){let o=r;if(e===0){let a=KP(t,r);if(a===0)return r.createInstance();if(a===1)return r;let h=t.getPCSHorizon(),m=h.getGeometryType(),l=t.getDefaultPrecisionSR();if(m===N.enumEnvelope){let u=V.constructEmpty();h.queryEnvelope(u);let c=un(l,u,!1);o=St(r,u,c,5e4*t.getOneMeterPCSUnit(),s)}else new bl().execute(h,r,l,s)||(o=new wn().execute(o,h,l,s),o===h&&(o=o.clone()))}else if(t.isPannable()){let a=V.constructEmpty();o.queryEnvelope(a);let h=t.getPannableExtent();h.containsEnvelope(a)||(Ia(o,h,t.getTolerance(0)),e!==2&&e!==4||(o=jr(o,t)),e!==4?o=bi(o,t,0,!0,1e5*t.getOneMeterPCSUnit(),s):n===N.enumPolygon&&a.width()>2*h.width()&&(o=va(o,-2*h.width(),2*h.width(),t,!0,0,!0,s)))}return o}if(w(i===1),n===N.enumMultiPoint)return Ia(r,t.getPannableExtent(),t.getTolerance(0)),r;{let o=V.constructEmpty();r.queryEnvelope(o);let a=r,h=t.getPannableExtent();if(o.ymin<h.ymin||o.ymax>h.ymax){let m=Math.max(1,o.calculateToleranceFromEnvelope()),l=new V(o.xmin-m,h.ymin,o.xmax+m,h.ymax);if(a=new Js().execute(a,l,t,s),a.isEmpty())return a}return n===N.enumPolygon&&o.width()>2*h.width()&&(a=va(a,-2*h.width(),2*h.width(),t,!0,0,!0,s)),a}}function $P(r,t,e,s,n,i){let o=s.getCoordinateSystemType();if(o===2){if(n===0)e!==r&&Fi(e,r,t),BP(s,e,t);else if(e!==r&&Fi(e,r,t),s.isPannable()){let a=s.getTolerance(0);UP(e,t,s.getPannableExtent(),a),F_(e,t,s,0)}}else{w(o===1);let a=s.getTolerance(0),h=s.getPannableExtent();for(let m=0;m<t;m++)e[m].assign(QP(r[m],h,a))}}function mS(r,t){let e=t.getPointCount();if(!e)return;let s=t.getImpl(),n=s.getAttributeStreamRef(0),i=r;pe.geogToProj(i,e,n.getArray()),s.notifyModifiedFlags(2001)}function Ql(r,t,e,s){if(!e)return;let n=r.getPECoordSys();if(e===1){let u=[t[0].x,t[0].y];if(pe.geogToProj(n,1,u),s){let{first:c,second:g}=r.m_peCoordSysVal.getGeogToProjFactors();u[0]=c*(t[0].x-r.getCentralMeridian())+g}return void t[0].setCoords(u[0],u[1])}let i=r.isPannable(),o=i?r.getPannableExtent().width():0,a=179*o/360,h=0;i&&(h=r.getCentralMeridian());let m=256,l=new Float64Array(2*m);for(let u=0;u<e;){for(let g=u;g<e&&t[g].isNAN();++g)u++;let c=Math.min(m,e-u);if(c>0){for(let g=1,d=u+1;g<c;++g,++d)if(t[d].isNAN()){c=g;break}for(let g=0;g<c;++g){let d=g<<1;l[d]=t[u+g].x,l[d+1]=t[u+g].y}if(pe.geogToProj(n,c,l),s){let{first:g,second:d}=r.m_peCoordSysVal.getGeogToProjFactors();for(let _=0;_<c;++_)l[_<<1]=g*(t[u+_].x-h)+d}if(i)for(let g=0,d=u;g<c;g++,d++){let _=g<<1,p=l[_],f=Mt(p),x=t[d].x-h;f*Mt(x)<0&&Math.abs(p)>a&&(l[_]-=f*o)}Tl(l,t,u,c),u+=c}}}function lS(r,t,e,s){let n=r.getSRToGCSTransform();return new Ws().transform(n,t,e,s,!1)}function uS(r,t,e,s){let n=new Lt({vd:t.getDescription()}),i;n.addPoints(t,0,-1),i=new Ws().execute(n,r,s);let o=t.getPointCount();if(e.setEmpty(),r.getInputSR().isPannable()){if(o!==i.getPointCount())return!1;let a=new V;t.queryEnvelope(a);let h=new V;i.queryEnvelope(h);let m=a.width(),l=h.width();if(m!==0&&l!==0){let u=l/m,c=r.getOutputSR().getPannableExtent().width()/r.getInputSR().getPannableExtent().width();if(Math.abs(u/c-1)>1e-10)return!1}else if(m!==0||l!==0)return!1;e.add(t,!1);for(let u=0;u<o;u++){let c=i.getXY(u);e.setXY(u,c)}return!0}return!1}function Y_(r,t,e){w(!e||r.isPannable());let s=t.getPointCount();if(!s)return;let n=t.getImpl(),i=n.getAttributeStreamRef(0),o=r.getPECoordSys(),a=0,h=i.readRange(0,2*s),m=()=>{pe.geogToProj(o,s,h)},l=r.isPannable()&&!e,u=l?r.getPannableExtent().width():0,c=179*u/360;if(r.isPannable()&&(a=r.getCentralMeridian(),e)){let g=r.m_peCoordSysVal.getGeogToProjFactors(),d=g.first,_=g.second;m=()=>{pe.geogToProj(o,s,h);for(let p=0;p<s;p++){let f=p<<1,x=i.read(f),C=d*(x-a)+_;h[f]=C}}}if(m(),l)for(let g=0;g<s;g++){let d=g<<1,_=h[d],p=Mt(_),f=i.read(d)-a;p*Mt(f)<0&&Math.abs(_)>c&&(h[d]+=-p*u)}i.writeRangeFromArray(0,2*s,h,!0,1),n.notifyModifiedFlags(2001)}function JP(r,t,e){switch(t.getGeometryType()){case N.enumLine:return void dC(r,t,e);case N.enumBezier:return void fC(r,t,e);case N.enumEllipticArc:return void _C(r,t,e);case N.enumBezier2:return void xC();case N.enumRationalBezier2:return void yC();default:j("")}}function Rd(r,t,e){if(!t.hasNonLinearSegments())return void Y_(r,t,e);if(w(!e||r.isPannable()),t.isEmpty())return;let s=0,n=r.getPECoordSys(),i=r.isPannable(),o=i?r.getPannableExtent().width():0,a=179*o/360,h=0;i&&(h=r.getCentralMeridian());let m=t.createInstance();m.reserveParts(t.getPointCount(),t.getPathCount());let l=t.getImpl(),u=new et;for(let c=0,g=t.getPathCount();c<g;++c)if(l.hasNonLinearSegmentsPath(c)){let d=!0,_=-1,p=l.getPathStart(c),f=p+l.getSegmentCountPath(c);l.isClosedPath(c)&&(_=f-1);let x=new y;for(let C=p;C<f;++C){if(l.getSegmentBuffer(C,u,!1),JP(r,u.get(),e),!d&&(u.get().getStartXY().equals(x)||u.get().moveTo(x)),C!==_)m.addSegment(u.get(),d);else{if(d){let P=new st;u.get().queryStart(P),m.startPathPoint(P)}m.closeLastPathWithSegment(u.get())}x.assign(u.get().getEndXY()),d=!1}}else{let _,p=l.getPathSize(c),f=Math.min(p,1024);m.insertPath(-1,t,c,!0);let x=l.getAttributeStreamRef(0),C=m.getAttributeStreamRef(0);for(let P=l.getPathStart(c),E=l.getPathEnd(c);P<E;){if(_=x.readRange(P,f),pe.geogToProj(n,f,_),i)for(let S=0;S<f;S++){let I=S<<1,D=_[I],b=Mt(D),T=x.read(2*(s+S))-h;b*Mt(T)<0&&Math.abs(D)>a&&(_[I]+=-b*o)}C.writeRangeFromArray(P,f,_,!0,1),P+=f,p-=f,f=Math.min(p,1024)}}t.assignMove(m)}function X_(r,t,e){let n=e.getPointCount();if(!n)return;let i=e.getImpl(),o=i.getAttributeStreamRef(0),a=Math.min(n,1e3),h=0,m=r.getPECoordSys();Number.isNaN(t)&&(t=0);let l=r.isPannable(),u=r.getOneDegreeGCSUnit(),c=360*u,g=179*u,d;for(;n;){if(d=o.readRange(2*h,2*a),Ga(m,a,d,t),l)for(let _=0;_<a;_++){let p=_<<1,f=d[p]-t,x=Mt(f),C=o.read(2*(h+_));x*Mt(C)<0&&Math.abs(f)>g&&(d[p]+=-x*c)}o.writeRangeFromArray(2*h,2*a,d,!0,1),h+=a,n-=a,a=Math.min(n,1e3)}i.notifyModifiedFlags(2001)}function tC(r,t,e){switch(e.getGeometryType()){case N.enumLine:return void eC(r,t,e);case N.enumBezier:return void iC(r,t,e);case N.enumEllipticArc:return void sC(r,t,e);case N.enumBezier2:return void rC();case N.enumRationalBezier2:return void oC();default:j("")}}function eC(r,t,e){let s=[e.getStartXY(),e.getEndXY()];Kl(r,t,s,2),e.setStartXY(s[0]),e.setEndXY(s[1]),e.normalizeAfterEndpointChange()}function sC(r,t,e){if(e.projectionBehavior()===0)nC(r,t,e);else{let s=e.isClosed()&&e.isMajor(),n=[e.getStartXY(),s?e.getCenter():e.getEndXY()],i=[n[0].clone(),n[1].clone()];Jl(r,t,i,2);let o=new ct;o.initializeFromTwoPointsArray(n,i),e.applyTransformation(o);let a=s?0:1;e.setCoordsForIntersector(i[0],i[a],!1)}}function nC(r,t,e){B_(!1,r,t,e,!1)}function iC(r,t,e){let s=k(y,4);e.queryControlPoints(s),Jl(r,t,s,4),e.setControlPoints(s)}function rC(r,t,e){w(0)}function oC(r,t,e){w(0)}function Ga(r,t,e,s){let n=pe.projToGeogCenter(r,t,e,s);for(let i=0;i<t;++i){let o=i<<1;w(Number.isFinite(e[o]+e[o+1]))}return n}function zo(r,t,e){if(!e.hasNonLinearSegments())return void X_(r,t,e);if(e.isEmpty())return;let s=r.getPECoordSys();Number.isNaN(t)&&(t=0);let n=r.isPannable(),i=r.getOneDegreeGCSUnit(),o=360*i,a=179*i,h=e.createInstance();h.reserveParts(e.getPointCount(),e.getPathCount());let m=e.getImpl(),l=new et;for(let u=0,c=e.getPathCount();u<c;++u)if(m.hasNonLinearSegmentsPath(u)){let g=!0,d=-1,_=m.getPathStart(u),p=_+m.getSegmentCountPath(u);m.isClosedPath(u)&&(d=p-1);let f=new y;for(let x=_;x<p;++x){if(m.getSegmentBuffer(x,l,!1),tC(r,t,l.get()),!g&&(l.get().getStartXY().equals(f)||l.get().moveTo(f)),x!==d)h.addSegment(l.get(),g);else{if(g){let C=new st;l.get().queryStart(C),h.startPathPoint(C)}h.closeLastPathWithSegment(l.get())}f.assign(l.get().getEndXY()),g=!1}}else{let d,_=m.getPathSize(u),p=Math.min(_,1e3);h.insertPath(-1,e,u,!0);let f=m.getAttributeStreamRef(0),x=h.getAttributeStreamRef(0);for(let C=m.getPathStart(u),P=m.getPathEnd(u);C<P;){if(d=f.readRange(2*C,2*p),Ga(s,p,d,t),n)for(let E=0;E<p;E++){let S=E<<1,I=d[S]-t,D=Mt(I),b=f.read(2*C);D*Mt(b)<0&&Math.abs(I)>a&&(d[S]+=-D*o)}x.writeRangeFromArray(2*C,2*p,d,!0,1),C+=p,_-=p,p=Math.min(_,1e3)}}e.assignMove(h)}function Kl(r,t,e,s){let n=r.getPECoordSys();Number.isNaN(t)&&(t=0);let i=r.isPannable(),o=r.getOneDegreeGCSUnit(),a=360*o,h=179*o,m=256,l=new Float64Array(2*m);for(let u=0;u<s;){for(let g=u;g<s&&e[g].isNAN();++g)u++;let c=Math.min(m,s-u);if(c>0){for(let g=1,d=u+1;g<c;++g,++d)if(e[d].isNAN()){c=g;break}for(let g=0;g<c;g++){let d=g<<1;l[d]=e[u+g].x,l[d+1]=e[u+g].y}if(Ga(n,c,l,t),i)for(let g=0,d=u;g<c;++g,++d){let _=g<<1,p=e[d].x,f=l[_]-t,x=Mt(f);x*Mt(p)<0&&Math.abs(f)>h&&(l[_]-=x*a)}for(let g=0;g<c;g++){let d=g<<1;e[u+g].x=l[d],e[u+g].y=l[d+1]}u+=c}}}function k_(r,t,e,s){w(0)}function R_(r,t,e){let s=t.getPointCount();if(!s)return!1;let n=t.getImpl(),i=n.getAttributeStreamRef(0),o=null,a=r.getInputSR(),h=r.getOutputSR();a.getVCS(),h.getVCS();let m=a.getOneDegreeGCSUnit(),l=h.getOneDegreeGCSUnit(),u=r.isVertical();u&&t.hasAttribute(1)&&(o=n.getAttributeStreamRef(1));let c=r.getDatumTransformation(),g=!!c&&c.getType()===1;if(g||o===null||(k_(o.getArray()),o=null),!c||c.count()===0){let T=a.getGcsUnitFactor()/h.getGcsUnitFactor(),A=(a.getPrimeMeridian()-h.getPrimeMeridian())*l,G=-90*m,F=90*m,M=0,q=i.getArray(),R=[0];for(let X=1,z=2*s;X<z;)R[0]=q[X],M|=eo(R,G,F)?1:0,q[X]=R[0],X+=2;if(A!==0||T!==1){M=1;let X=i.getArray();for(let z=0,Y=2*s;z<Y;){let L=X[z];L*=T,L+=A,X[z]=L,X[z+1]*=T,z+=2}}return M!==0&&n.notifyModifiedFlags(2001),!!M}let d=1e3,_=Math.min(s,d),p=Z(_,Number.NaN),f=Z(_,Number.NaN),x=null;o!==null&&(x=new Float64Array(_));let C=0,P=Number.NaN,E=Number.NaN,S=360*l,I=l/m;e&&(E=90*l,P=89.9*m,f.fill(0));let D=!0,b=0;for(;s;){let T=!1,A=i.readRange(2*C,2*_);for(let F=0;F<_;F++)p[F]=A[F<<1];if(e)for(let F=0;F<_;F++){let M=1+(F<<1),q=Math.abs(A[M])-P;if(q>0){let R=A[M];A[M]=bs(P,R),f[F]=bs(q,R),T=!0}}let G=A[0];if(g){let F=c;x&&o.queryRange(C,_,x,!0,1),F.transform(!1,A,x,_),x&&o.writeRangeFromArray(C,_,x,!0,1)}else c.transform(!1,A,_);D&&(b=A[0]-I*G,D=!1);for(let F=0;F<_;F++){let M=F<<1,q=A[M]-p[F]*I-b;Math.abs(q)>200&&(A[M]+=q>0?-S:S)}if(T){for(let F=0;F<_;F++)if(f[F]){let M=1+(F<<1);A[M]+=I*f[F],A[M]>E?A[M]=E:A[M]<-E&&(A[M]=-E)}f.fill(0)}i.writeRangeFromArray(2*C,2*_,A,!0,1),u&&o&&o.writeRangeFromArray(C,_,x,!0,1),C+=_,s-=_,_=Math.min(s,d)}return n.notifyModifiedFlags(2001),!0}function aC(r,t,e){switch(t.getGeometryType()){case N.enumLine:return hC(r,t,e);case N.enumBezier:return uC(r,t,e);case N.enumEllipticArc:return mC(r,t,e);case N.enumBezier2:return cC();case N.enumRationalBezier2:return gC();default:j("")}}function Oo(r,t,e){if(!t.hasNonLinearSegments())return R_(r,t,e);if(t.isEmpty())return!1;let s=t.createInstance();s.reserveParts(t.getPointCount(),t.getPathCount());let n=t.getImpl(),i=new et;for(let o=0,a=t.getPathCount();o<a;++o){let h=!0,m=-1,l=n.getPathStart(o),u=l+n.getSegmentCountPath(o);n.isClosedPath(o)&&(m=u-1);let c=new y;for(let g=l;g<u;++g){if(n.getSegmentBuffer(g,i,!1),aC(r,i.get(),e),!h&&(i.get().getStartXY().equals(c)||i.get().moveTo(c)),g!==m)s.addSegment(i.get(),h);else{if(h){let d=new st;i.get().queryStart(d),s.startPathPoint(d)}s.closeLastPathWithSegment(i.get())}c.assign(i.get().getEndXY()),h=!1}}return t.assignMove(s),!0}function Hd(r,t,e,s,n,i){if(r.isIdentityGeogToGeog()){let G=90*r.getInputSR().getOneDegreeGCSUnit(),F=0,M=[0];for(let q=0;q<s;q++)M[0]=t[q].y,F|=eo(M,-G,G)?1:0,t[q].y=M[0];return F}let o=r.getInputSR(),a=r.getOutputSR(),h=o.getVCS(),m=a.getVCS(),l=o.getOneDegreeGCSUnit(),u=90*l,c=a.getOneDegreeGCSUnit(),g=r.isVertical(),d=r.getDatumTransformation(),_=!!d&&d.getType()===1;if(g||(e=null),!d||d.count()===0){let G=0,F=[0];for(let M=0;M<s;M++)F[0]=t[M].y,G|=eo(F,-u,u)?1:0,t[M].y=F[0];return G|=M_(o.getGCS(),h,a.getGCS(),m,t,e,s)?1:0,G}_||e===null||k_();let p=1024,f=Math.min(s,p),x=Z(f,Number.NaN),C=Z(f,Number.NaN),P=0,E=Number.NaN,S=Number.NaN,I=360*c,D=c/l;n&&(S=90*c,E=89.9*l);let b=!0,T=0,A=s;for(;A;){let G=!1;for(let M=0;M<f;M++)x[M]=t[M+P].x;if(n)for(let M=0;M<f;M++){let q=Math.abs(t[M+P].y)-E;if(q>0){let R=t[M+P].y;t[M+P].y=bs(E,R),C[M]=bs(q,R),G=!0}}let F=t[0].x;_?d.transform(!1,t,e,f):d.transform(!1,t,f),b&&(T=t[0].x-D*F,b=!1);for(let M=0;M<f;M++){let q=t[P+M].x-x[M]*D-T;Math.abs(q)>200&&(q>0?t[P+M].x-=I:t[P+M].x+=I)}if(G){for(let M=0;M<f;M++)C[M]&&(t[P+M].y+=D*C[M],t[P+M].y>S?t[P+M].y=S:t[P+M].y<-S&&(t[P+M].y=-S));C.fill(0,0,f)}P+=f,A-=f,f=Math.min(A,p)}return 1}function H_(r,t,e,s,n){return w(0),0}function L_(r,t,e,s,n){w(s===null),w(t<2147483647);let i=Array.isArray(e),o;o=i?Au(e):e;let a=Hl.geogToGeog(r,t,o,null,n);return i&&Nu(o,e),a}function wi(r,t,e,s,n,i){let o=0,a=!0,h=0;for(let m=0;m<s;++m)t[m].isNAN()?a||(o|=Hd(r,t.slice(h,m-h),e?e.slice(h,m-h):null,m-h,n),h=m,a=!0):a&&(h=m,a=!1);return a||(o|=Hd(r,h===0?t:t.slice(h),e?h===0?e:e.slice(h):null,s-h,n)),o!==0}function hC(r,t,e){let s=[t.getStartXY(),t.getEndXY()],n=[0,0],i=null;t.hasAttribute(1)&&(i=n,i[0]=t.getAttributeAsDbl(0,1,0),i[1]=t.getAttributeAsDbl(1,1,0));let o=wi(r,s,i,2,e);return t.setStartXY(s[0]),t.setEndXY(s[1]),i&&(t.setStartAttribute(1,0,i[0]),t.setEndAttribute(1,0,i[1])),t.normalizeAfterEndpointChange(),o}function mC(r,t,e){if(t.projectionBehavior()===0)return lC(r,t,e);let s=t.getStartXY().equals(t.getEndXY()),n=k(y,3),i=k(y,3),o=[0,0,0],a=null;n[0].assign(t.getStartXY()),n[1].assign(s?t.getCenter():t.getEndXY());let h=!1;t.hasAttribute(1)&&(a=o,a[0]=t.getAttributeAsDbl(0,1,0),a[1]=t.getAttributeAsDbl(1,1,0),a[2]=pt(a[0],a[1],.5),s&&(a[1]=a[2])),i[0].setCoordsPoint2D(n[0]),i[1].setCoordsPoint2D(n[1]);let m=new ct;if(s||t.isDegenerateToLine())h=wi(r,i,a,2,e),m.initializeFromTwoPoints(n[0],n[1],i[0],i[1]);else{let l=new y;t.queryCoord2D(.5,l),n[2].setCoordsPoint2D(l),i[2].setCoordsPoint2D(l),h=wi(r,i,a,3,e),m.setFromTwoTriangles(n,i)}return m.isIdentity()||(t.applyTransformation(m),t.setStartXY(i[0]),t.setEndXY(s?i[0]:i[1]),t.normalizeAfterEndpointChange()),a&&(t.setStartAttribute(1,0,a[0]),t.setEndAttribute(1,0,s?a[0]:a[1])),h}function lC(r,t,e){let s=[t.getStartXY(),t.getEndXY(),t.getInteriorPoint(),t.getCenter()],n=4;t.isDegenerateToLine()&&(n=2);let i=[0,0,0,0],o=null;if(t.hasAttribute(1)){o=i,o[0]=t.getAttributeAsDbl(0,1,0),o[1]=t.getAttributeAsDbl(1,1,0);let m=pt(o[0],o[1],.5);o[2]=m,o[3]=m}let a=t.getStartXY().equals(t.getEndXY())&&!t.isDegenerateToLine(),h=wi(r,s,o,n,e);return a?t.constructCircleCenterAndPoint(s[3],s[0],!t.isClockwise()):t.isDegenerateToLine()?t.constructLineCircularArc(s[0],s[1]):t.constructCircularArcThreePoint(s[0],s[1],s[2]),o&&(t.setStartAttribute(1,0,o[0]),t.setEndAttribute(1,0,o[1])),h}function uC(r,t,e){let s=k(y,4);t.queryControlPoints(s);let n=[0,0,0,0],i=null;t.hasAttribute(1)&&(i=n,i[0]=t.getAttributeAsDbl(0,1,0),i[3]=t.getAttributeAsDbl(1,1,0),i[1]=pt(i[0],i[3],.5),i[2]=i[1]);let o=wi(r,s,i||null,s.length,e);return t.setControlPoints(s),i&&(t.setStartAttribute(1,0,i[0]),t.setEndAttribute(1,0,i[3])),t.normalizeAfterEndpointChange(),o}function cC(r,t,e){return w(0),!1}function gC(r,t,e){return w(0),!1}function dC(r,t,e){let s=[t.getStartXY(),t.getEndXY()];Ql(r,s,2,e),t.setStartXY(s[0]),t.setEndXY(s[1]),t.normalizeAfterEndpointChange()}function $l(r,t,e,s){Ql(r,t,e,s)}function _C(r,t,e){if(t.projectionBehavior()===0)pC(r,t,e);else{let s=t.isClosed()&&t.isMajor(),n=[t.getStartXY(),s?t.getCenter():t.getEndXY()],i=[n[0].clone(),n[1].clone()];$l(r,i,2,e);let o=new ct;o.initializeFromTwoPointsArray(n,i),t.applyTransformation(o);let a=s?0:1;t.setCoordsForIntersector(i[0],i[a],!1)}}function Jl(r,t,e,s){Kl(r,t,e,s);let n=new V;n.setFromPoints(e,s);let i=r.getOneDegreeGCSUnit(),o=360*i,a=180*i;if(n.width()>a){for(let h=0;h<s;h++)for(;e[h].x<t;)e[h].x+=o;if(n.setFromPoints(e,s),n.xmax>a+t)for(let h=0;h<s;h++)e[h].x-=o}}function B_(r,t,e,s,n){let i=k(y,3),o=0,a=!1,h=!1,m=s.isDegenerateToLine();m?(i[0].assign(s.getStartXY()),i[1].assign(s.getEndXY()),i[2].setCoords(0,0),o=2):s.isClosed()&&s.isMajor()?(a=!0,h=!s.isClockwise(),i[0].assign(s.getStartXY()),i[1].assign(s.getCenter()),i[2].setCoords(0,0),o=2):(i[0].assign(s.getStartXY()),i[1].assign(s.getEndXY()),i[2].assign(s.getInteriorPoint()),o=3),r?$l(t,i,o,n):Jl(t,e,i,o),m?s.constructLineCircularArc(i[0],i[1]):a?s.constructCircleCenterAndPoint(i[1],i[0],h):s.constructCircularArcThreePoint(i[0],i[1],i[2])}function pC(r,t,e){B_(!0,r,0,t,e)}function fC(r,t,e){let s=k(y,4);t.queryControlPoints(s),$l(r,s,4,e),t.setControlPoints(s)}function xC(r,t,e){w(0)}function yC(r,t,e){w(0)}function Hm(r,t,e){let s=Dr(r),n=Dr(t),i=Sm(s,n),o=Sm(s,Dr(e));return o===0||i>0&&o>0&&o<=i||i<0&&o<0&&o>=i}function PC(r,t,e,s,n){let i={stack:[],error:void 0,hasError:!1};try{let o=e.clone(),a=s.clone();if(n===2){let p=[0,0];return Qd(r,t,o,a,0,p),p[0]}if(o.y>a.y){let p=new y;p.assign(o),o.assign(a),a.assign(p)}let h=xe(i,new ve,!1),m=xe(i,new ve,!1),l=xe(i,new ve,!1),u=new B;if(u.setCoords(o.y,a.y),!u.containsCoordinate(0)||Math.abs(o.x-a.x)>=Math.PI)return Number.NaN;if(o.x===a.x)return o.x;ts.geodeticDistance(r,t,o.x,o.y,a.x,a.y,m,h,null,n);let c=m.val,g=0,d=1,_=o.clone();for(;c*(d-g)>1e-12*r;){let p=.5*(g+d);if(ts.geodeticCoordinate(r,t,o.x,o.y,c*p,h.val,m,l,n),_.x=m.val,_.y=l.val,u.setCoords(o.y,_.y),_.y===0)return _.x;if(u.containsCoordinate(0))d=p;else{if(u.setCoords(a.y,_.y),!u.containsCoordinate(0))return w(!1),Number.NaN;g=p}}return _.x}catch(o){i.error=o,i.hasError=!0}finally{qs(i)}}function Ld(r,t,e,s){let n=new B;n.setCoords(t,e);let i=s.width(),o=Math.floor((r-t)/i)*i+r,a=n.getCenter();for(;Math.abs(o-a)>Math.abs(o+i-a);)o+=i;return o}var Al=class extends ns{constructor(){super(),this.m_geometryDeque=[],this.m_index=-1}next(){if(this.m_geometryDeque.length>0){this.m_index++;let t=this.m_geometryDeque[0];return this.m_geometryDeque.shift(),t}return null}getGeometryID(){return this.m_index}tick(t){this.m_geometryDeque.push(t)}tock(){return!0}getRank(){return 1}};function CC(r,t){return r===t||r!==null&&t!==null&&r.m_csType===t.m_csType&&(r.m_WKID===0&&t.m_WKID===0?r.m_hashCode===t.m_hashCode&&r.m_canonicalWkt===t.m_canonicalWkt:r.m_WKID===t.m_WKID)}function EC(r,t){return r===t||r!==null&&t!==null&&r.m_csType===t.m_csType&&(r.m_WKID===0&&t.m_WKID===0?r.m_csType===1?r.m_peCoordSys.isEqual(t.m_peCoordSys):r.m_peCoordSys===t.m_peCoordSys:r.m_WKID===t.m_WKID)}var Lr=class{constructor(t,e=!0){this.m_PCSHorizon=null,this.m_GCSHorizon=null,this.m_GCSSplitLines=null,this.m_bGCSHorisonIsInclusive=!1,this.m_oneMeterPCS=0,this.m_oneDegreeGCS=0,this.m_gcsUnitFactor=0,this.m_northPole=y.getNAN(),this.m_southPole=y.getNAN(),this.m_polesUpdated=0,this.m_domain=V.constructEmpty(),this.m_primeMeridian=Number.NaN,this.m_geogToProjFactor=1,this.m_geogToProjOffset=0,this.m_geogToProjFactorsUpdated=0,this.m_oneMillimeter=0,this.m_centralMeridian=0,this.m_pPCSInfoNoDomain=null,this.m_oldWKID=-1973,this.m_vcsWKID=-1,this.m_bIsPannable=!1,this.m_bCached=!1,this.m_pannableExtent=V.constructEmpty(),this.m_pannableExtentGCS=V.constructEmpty(),this.m_areaOfUse=null,this.m_canonicalWkt="",this.m_peCoordSys=t,this.m_WKID=te.getCode(t),this.m_WKID<=0?(this.m_WKID=0,this.m_canonicalWkt=Zl(t,0,!0),this.m_hashCode=eh(this.m_canonicalWkt)):this.m_hashCode=ki(this.m_WKID);let s=this.m_peCoordSys.getType();this.m_csType=s===tt.PE_TYPE_PROJCS?2:1,w(s===tt.PE_TYPE_PROJCS||s===tt.PE_TYPE_GEOGCS),s===tt.PE_TYPE_PROJCS&&(t.loadConstants()||U("PeProjcs.loadConstants failed"));let n=s===tt.PE_TYPE_GEOGCS?this.m_peCoordSys:this.m_peCoordSys.getGeogcs();s!==tt.PE_TYPE_GEOGCS&&te.getCode(n),this.m_unit=t1(t),this.m_primeMeridian=n.getPrimem().getLongitude();{let i=n.getUnit().getUnitFactor();this.m_gcsUnitFactor=i;let o=Math.PI/(180*i);Math.abs(o-1)<1e-10&&(o=1),this.m_oneDegreeGCS=o}if(s===tt.PE_TYPE_PROJCS){let i=this.m_peCoordSys,o=i.getUnit().getUnitFactor();this.m_oneMeterPCS=1/o,this.m_oneMillimeter=.001/o,this.m_pPCSInfoNoDomain=le.generate(i,le.PE_PCSINFO_OPTION_NONE),this.m_pPCSInfoNoDomain||j("cannot create pcs info"),this.m_bIsPannable=this.m_pPCSInfoNoDomain.isPannableRectangle(),this.m_centralMeridian=this.m_pPCSInfoNoDomain.getCentralMeridian()}else{this.m_bIsPannable=!0,this.m_polesUpdated=1,this.m_oneMeterPCS=0;let i=1/n.getUnit().getUnitFactor(),o=n.getDatum().getSpheroid().getAxis();this.m_oneMillimeter=.001/o*i,this.m_centralMeridian=0}this.m_bIsPannable&&(this.updateGCSHorizon(),this.updatePCSHorizon(),this.updatePoles(),this.updateDomain(),this.updatePannableExtent(),this.updatePannableExtentGCS())}[Symbol.dispose](){}getHashCode(){return this.m_hashCode}getPCSHorizonPannable(){return this.m_PCSHorizon}getGCSHorizonPannable(){return this.m_GCSHorizon}getPCSInfo(){return w(this.m_pPCSInfoNoDomain),this.m_pPCSInfoNoDomain}getCentralMeridian(){return this.m_centralMeridian}updateGCSHorizon(){if(this.m_peCoordSys.getType()!==tt.PE_TYPE_PROJCS)return;let t=!0,e=this.m_peCoordSys,s=e.getGeogcs(),n=e.horizonGcsGenerate();if(!n)return;w(n.length>0);let i=n[0].getNump(),o=n[0].getKind(),a,h;t=n[0].getInclusive()>0;let m=this.getOneDegreeGCSUnit(),l=90*m,u=360*m,c=370*m,g=180*m*tt.PE_HORIZON_DELTA/Math.PI,d=V.constructEmpty(),_=null;if(i>1){for(let p=1;p<i;p++)if(n[p].getKind()===tt.PE_HORIZON_LINE){_||(_=new dt);let f=n[p].getCoord();_.startPathCoords(f[0][0],f[0][1]),_.lineToCoords(f[1][0],f[1][1])}}if(o===tt.PE_HORIZON_RECT){let p=n[0].getCoord();if(d.setFromPoints([new y(p[0][0],p[0][1]),new y(p[1][0],p[1][1])],2),Math.abs(d.ymax-l)<1e-7*g&&(d.ymax=l),Math.abs(d.ymin+l)<1e-7*g&&(d.ymin=-l),d.width()>c){let x=-400*m,C=x+5*u;d.setCoords({xmin:x,ymin:d.ymin,xmax:C,ymax:d.ymax})}let f=new Me({env2D:d});this.m_GCSHorizon||(this.m_GCSHorizon=f,this.m_bGCSHorisonIsInclusive=t)}else{let p=this.getPCSInfo().isGcsHorizonMultiOverlap(),f=Ur(s,null,null,1),x=[],C=new B;for(let D=0;D<i;D++){if(n[D].getKind()!==tt.PE_HORIZON_POLY)continue;a=n[D].getSize();let b=n[D].getCoord(),T=V.constructEmpty();T.setFromPoints(An(b),a),x.push(new B(T.xmin,T.xmax)),T.width(),C.merge(x.at(-1))}let P=!1,E=new B;C.width()>u&&x.length>1?(E.vmin=this.getCentralMeridian()-u,E.vmax=E.vmin+2*u,P=!0,p=!0):(E.vmin=C.vmin,E.vmax=E.vmin+u);let S=D=>{let b=0;for(;x[D].vmin+b<E.vmin;)b+=u;for(;x[D].vmax+b-u>E.vmin;)b-=u;return b},I=new lt;if(p){let D=new Al,b=new Rr().executeMany(D,f,null);for(let T=0;T<i;T++){if(n[T].getKind()!==tt.PE_HORIZON_POLY)continue;a=n[T].getSize();let A=n[T].getCoord();h=n[T].getInclusive()>0;let G=new lt;if(G.addPathPoint2D(An(A),a-1,!0),P){let F=S(T),M=x[T].clone();M.move(F);let q=F,R=new ct;do{R.setShiftCoords(q,0);let X=G.clone();X.applyTransformation(R),D.tick(X),D.tock(),q+=u,M.move(u)}while(M.vmin<E.vmax)}else D.tick(G),b.tock()}I=b.next()}else{I=new lt;for(let D=0;D<i;D++){if(n[D].getKind()!==tt.PE_HORIZON_POLY)continue;a=n[D].getSize();let b=n[D].getCoord();if(h=n[D].getInclusive()>0,w(h===t),P){let T=new lt;T.addPathPoint2D(An(b),a-1,!0);let A=S(D),G=x[D].clone();G.move(A);let F=A,M=new ct;do{if(F!==0){M.setShiftCoords(F,0);let q=new lt({copy:T});q.applyTransformation(M),I.addPath(q,0,!0)}else I.addPath(T,0,!0);F+=u,G.move(u)}while(G.vmin<E.vmax)}else I.addPathPoint2D(An(b),a-1,!0)}}P&&(I=new Js().execute(I,new V(E.vmin,-l-m,E.vmax,l+m),f,null)),t?new wn().accelerateGeometry(I,f,1):new kr().accelerateGeometry(I,f,1),new Ea().accelerateGeometry(I,f,1),this.m_GCSHorizon===null&&(this.m_GCSHorizon=I,this.m_bGCSHorisonIsInclusive=t,this.m_GCSSplitLines=_)}}updateAreaOfUse(){return null}updatePCSHorizon(){if(this.m_peCoordSys.getType()!==tt.PE_TYPE_PROJCS)return;let t=this.m_peCoordSys.horizonPcsGenerate();if(!t)return;let e;this.getPCSInfo();let s=t[0].getKind();t[0].getInclusive();let n=V.constructEmpty(),i=t[0].getNump(),o=!1;if(s===tt.PE_HORIZON_RECT){let a=t[0].getCoord();n.setFromPoints(An(a),2),e=new Me({env2D:n})}else{let a=-1;for(let u=0;u<i;u++)t[u].getKind()===tt.PE_HORIZON_POLY&&(a=u);w(a>=0);let h=t[a].getSize()-1,m=t[a].getCoord(),l=new lt;e=l,l.addPathPoint2D(An(m),h,!0),o=!0}if(this.getPCSInfo().isDensificationNeeded()){w(s!==tt.PE_HORIZON_RECT);let a=1e5*this.getOneMeterPCSUnit();e=new Bs().execute(e,a,0,0,null)}if(o){{let a=new Me;e.queryEnvelope(a),e.calculateArea2D(),e.calculateLength2D(),e.getExteriorRingCount()}new wn().accelerateGeometry(e,null,1)}this.m_PCSHorizon===null&&(this.m_PCSHorizon=e)}updatePannableExtent(){let t=this.m_peCoordSys.getType();if(t===tt.PE_TYPE_PROJCS){let e=this.m_peCoordSys,s=this.getPCSInfo().getCentralMeridian(),n=e.getGeogcs();n||j("");let i=[s+1/n.getUnit().getUnitFactor()*Math.PI,0];pe.geogToProj(e,1,i);let o=i[0],a=e.getParameters()[tt.PE_PARM_X0].getValue(),h=this.getPCSHorizon(),m=V.constructEmpty();h.queryEnvelope(m);let l=Math.abs(o-a),u=l+a,c=-1*l+a,g=m.ymax,d=m.ymin;this.m_pannableExtent.setCoords({xmin:c,ymin:d,xmax:u,ymax:g})}else if(t===tt.PE_TYPE_GEOGCS){let e=1/this.m_peCoordSys.getUnit().getUnitFactor()*Math.PI;this.m_pannableExtent.setCoords({xmin:-e,ymin:-e/2,xmax:e,ymax:e/2})}else j("")}updatePannableExtentGCS(){let t=this.m_peCoordSys.getType();if(t===tt.PE_TYPE_PROJCS){let e=this.m_peCoordSys,s=this.m_centralMeridian,n=e.getGeogcs();n||j("");let i=1/n.getUnit().getUnitFactor()*Math.PI,o=this.getGCSHorizon(),a=V.constructEmpty();o.queryEnvelope(a),this.m_pannableExtentGCS.setCoords({xmin:s-i,ymin:a.ymin,xmax:s+i,ymax:a.ymax})}else if(t===tt.PE_TYPE_GEOGCS){let e=1/this.m_peCoordSys.getUnit().getUnitFactor()*Math.PI;this.m_pannableExtentGCS.setCoords({xmin:-e,ymin:-e/2,xmax:e,ymax:e/2})}else j("")}updateDomain(){if(this.m_csType===1){let t=400*this.getOneDegreeGCSUnit();this.m_domain=V.construct(-t,-t,t,t)}else{w(this.m_csType===2);let t=le.generate(this.m_peCoordSys,le.PE_PCSINFO_OPTION_DOMAIN);t||j("generate pcs info failed");let e=new V(t.getDomainMinx(),t.getDomainMiny(),t.getDomainMaxx(),t.getDomainMaxy());this.m_domain.isEmpty()&&this.m_domain.setCoords({env2D:e})}}updatePoles(){if(this.m_peCoordSys.getType()===tt.PE_TYPE_PROJCS){let t=90*this.getOneDegreeGCSUnit(),e=[[0,t],[0,-t]];pe.geogToProj(this.m_peCoordSys,2,e);let s=this.getPCSInfo().getNorthPoleLocation()!==le.PE_POLE_OUTSIDE_BOUNDARY,n=this.getPCSInfo().getSouthPoleLocation()!==le.PE_POLE_OUTSIDE_BOUNDARY;this.m_polesUpdated||(s&&this.m_northPole.setCoords(e[0][0],e[0][1]),n&&this.m_southPole.setCoords(e[1][0],e[1][1]),this.m_polesUpdated=1)}else this.m_polesUpdated=1}updateGeogToProjFactors(){if(this.m_peCoordSys.getType()===tt.PE_TYPE_PROJCS){let t=this.getOneDegreeGCSUnit(),e=this.m_pPCSInfoNoDomain.getCentralMeridian(),s=[0,0,0,0];s[0]=e,s[1]=0,s[2]=e+t,s[3]=0;let n=pe.geogToProj(this.m_peCoordSys,2,s);w(n===2);let i=(s[2]-s[0])/t,o=s[0];this.m_geogToProjFactorsUpdated===0&&(this.m_geogToProjFactor=i,this.m_geogToProjOffset=o,this.m_geogToProjFactorsUpdated=1)}else this.m_geogToProjFactorsUpdated=1}getOneMeterPCSUnit(){return this.m_oneMeterPCS}getOneDegreeGCSUnit(){return this.m_oneDegreeGCS}getGcsUnitFactor(){return this.m_gcsUnitFactor}getUnitsPerMillimeter(){return this.m_oneMillimeter}getGCSSplitLines(){return this.m_bIsPannable?null:(this.m_GCSHorizon||this.updateGCSHorizon(),this.m_GCSSplitLines)}getGCSHorizon(){return this.m_bIsPannable?this.getGCSHorizonPannable():(this.m_GCSHorizon!==null||this.updateGCSHorizon(),this.m_GCSHorizon)}getGCSHorisonIsInclusive(){return this.m_bIsPannable||this.getGCSHorizon(),this.m_bGCSHorisonIsInclusive}getPCSHorizon(){return this.m_bIsPannable?this.getPCSHorizonPannable():(this.m_PCSHorizon!==null||this.updatePCSHorizon(),this.m_PCSHorizon)}getPole(t){return this.m_bIsPannable||this.m_polesUpdated!==0||this.updatePoles(),t?this.m_southPole:this.m_northPole}getGeogToProjFactors(){return this.m_geogToProjFactorsUpdated===0&&this.updateGeogToProjFactors(),Kt(this.m_geogToProjFactor,this.m_geogToProjOffset)}getDomainXY(){if(this.m_bIsPannable)return this.m_domain.clone();let t=!1;return t=this.m_domain.isEmpty(),t&&this.updateDomain(),this.m_domain.clone()}getPrimeMeridian(){return this.m_primeMeridian}getLatestID(){return this.m_WKID}getOldID(){let t=this.m_oldWKID;if(t<0){if(t=0,this.m_WKID>0){let e=[0],s=[0];eE(this.m_peCoordSys.getType(),this.m_WKID,e,s)||j("query_code_change"),t=e[0]}this.m_oldWKID=t}return t}isCustomWkid(){return!1}isPannable(){return this.m_bIsPannable}getPannableExtent(){return this.m_pannableExtent.clone()}getPannableExtentGCS(){return this.m_pannableExtentGCS.clone()}getAreaOfUse(){return this.m_areaOfUse!==null?this.m_areaOfUse:this.updateAreaOfUse()}getVcsCode(){return 0}saveMemory(){}getCSType(){return this.m_csType}getUnit(){return this.m_unit}setCached(){this.m_bCached=!0}getCached(){return this.m_bCached}static equal(t,e){return!1}static equal_for_projection(t,e){return!1}},Ml=class{constructor(t,e=!0){this.m_oneMeter=0,this.m_WKID=-1,this.m_oldWKID=-1,this.m_canonicalWkt="not yet implemented",this.m_model=0,this.m_unit=new Fs,this.m_cached=!1}setCached(t=!0){this.m_cached=t}getCached(){return this.m_cached}getOneMeterUnit(){return 0}getLatestID(){return this.m_WKID}getOldID(){let t=this.m_oldWKID;return t<0&&(t=0,this.m_WKID>0&&(t=this.m_WKID),this.m_oldWKID=t),t}getModel(){return 0}isCustomWkid(){return!1}getVerticalUnit(){return this.m_unit}static equal(t,e){return!1}static equal_for_projection(t,e){return!1}};function SC(r,t,e){return U_(r,t,V.constructEmpty(),e)}function U_(r,t,e,s){return vC(!0,r,t,e,s)}function Ei(r,t,e,s){return z_(!0,r,t,e,s)}function vC(r,t,e,s,n){return Is()||Mi("cannot create projection transformation"),t.hasVCS()&&e.hasVCS()?IC():bC(t,e,s,n)}function z_(r,t,e,s,n,i){return Is()||Mi("cannot create projection transformation"),new tu(r?2:1,t,e,s,n,i)}function O_(r,t,e,s,n,i=!1){if(t&&e||U(""),Is()||Mi("cannot obtain geotransformation list"),r===1&&t.hasVCS()&&e.hasVCS())return ft("hv xform not impl"),[];{let o=op(t,e,s,n,i),a=[];for(let h of o)a.push(h);return a}}function W_(){return{centralMeridianOfOutputGCS:Number.NaN,densificationStep:Number.NaN,clipWithInputHorizon:!0,clipWithOutputHorizon:!0,legacyHorizonClipping:!1,normalizeResultGeometry:!1,equals(r){return Ne(this.centralMeridianOfOutputGCS,r.centralMeridianOfOutputGCS)&&Ne(this.densificationStep,r.densificationStep)&&this.clipWithInputHorizon===r.clipWithInputHorizon&&this.clipWithOutputHorizon===r.clipWithOutputHorizon&&this.legacyHorizonClipping===r.legacyHorizonClipping&&this.normalizeResultGeometry===r.normalizeResultGeometry}}}function IC(r,t,e,s){return w(0),{}}function bC(r,t,e,s){r&&t||U("!inputSR || !outputSR");let n=r.getLatestID(),i=t.getLatestID();if(n===3857&&i===4326){if(r.m_bDefaultDescriptor&&t.m_bDefaultDescriptor)return Q_()}else if(n===4326&&i===3857&&r.m_bDefaultDescriptor&&t.m_bDefaultDescriptor)return GC();let o=V.constructEmpty();o.setCoords({env2D:e});let a=r.getCoordinateSystemType(),h=t.getCoordinateSystemType();if(a===0||h===0)return Wo(r,t);if(s){let g=s.find(0,r.getGCS(),t.getGCS());if(g)return Wo(r,t,g)}let m=r.getGCS().getLatestID(),l=t.getGCS().getLatestID();if(m>0&&m===l)return Wo(r,t);let u=new Vl(r,t,e);{let g=AC(u);if(g)return g}let c=O_(0,r,t,o,1,!0);return MC(u,Wo(r,t,c.length?c[0]:void 0))}function Wo(r,t,e,s,n){return new tu(1,r,t,e,s,n)}function j_(){return{flagsMask:0,setFlag(r,t){t?this.flagsMask|=r:this.flagsMask&=~r},hasFlag(r){return!!(this.flagsMask&r)}}}function Gl(){return{m_extendedParams:W_(),m_extendedParamsInternal:j_()}}function Lm(){return Gl()}var tu=class Z_{constructor(t,e,s,n,i,o){let a,h;this.m_datumTran=null,this.m_bIdentity=!0,this.m_bIdentityGeogToGeog=!0,this.m_bVertical=!1,this.m_bNormalize=!1,e&&s||U("!inputSR || !outputSR"),n&&n.getType()===0&&(n.m_bReadOnly=!0),this.m_bNormalize=!1,t!==1&&(a=e.getVCS(),h=s.getVCS(),this.m_bVertical=a!=null&&h!=null),this.m_inputSR=e,this.m_outputSR=s,this.m_bIdentity=!1,this.m_bIdentityGeogToGeog=!1,w(!this.m_params),i&&(this.m_params=Gl(),this.m_params.m_extendedParams=i),o&&(this.m_params||(this.m_params=Gl()),this.m_params.m_extendedParamsInternal=o);let m=!1,l=n!=null,u=e.getCoordinateSystemType(),c=s.getCoordinateSystemType();if(s.isPannable()&&u!==0&&i){let _=i.centralMeridianOfOutputGCS;if(!Number.isNaN(_)&&s.isPannable()){let p=s.getPannableExtent(),f=p.getCenterX();if(f!==_){let x=Math.ceil(p.width());_+x!==f+x&&(m=!0)}}}let g=i&&i.normalizeResultGeometry;if(e.equals(s))return this.m_bIdentity=!m,this.m_bIdentityGeogToGeog=!0,void this.updateProjector();let d=!l&&e.equalForProjection(s,this.m_bVertical);this.m_bIdentity=d&&!m,this.m_bIdentity?this.m_bIdentityGeogToGeog=!0:u!==0&&c!==0&&(g&&this.m_outputSR.isPannable()&&(this.m_bNormalize=g),this.m_datumTran=n||null,this.m_bIdentityGeogToGeog=(!this.m_datumTran||this.m_datumTran.count()===0)&&this.m_inputSR.getGCS().equalForProjection(this.m_outputSR.getGCS(),this.m_bVertical)),this.updateProjector()}getInputSR(){return this.m_inputSR}getOutputSR(){return this.m_outputSR}getDatumTransformation(){return this.m_datumTran}getInverse(){let t=new Z_(1,this.m_outputSR,this.m_inputSR,this.m_datumTran?.createInverse());return t.m_bIdentity=this.m_bIdentity,t.m_bVertical=this.m_bVertical,t.m_bIdentityGeogToGeog=this.m_bIdentityGeogToGeog,t.updateProjector(),t}isIdentity(){return this.m_bIdentity}getExtendedParams(){return this.m_params?this.m_params.m_extendedParams:Lm().m_extendedParams}equals(t){return w(0),!1}isVertical(){return this.m_bVertical}isMatchingTransformation(t,e){return w(0),!1}getGeographicTransformations(){return this.m_datumTran}getExtendedParamsImpl(){return this.m_params?this.m_params.m_extendedParams:Lm().m_extendedParams}getExtendedParamsInternal(){return this.m_params?this.m_params.m_extendedParamsInternal:Lm().m_extendedParamsInternal}isIdentityGeogToGeog(){return this.m_bIdentityGeogToGeog}normalizeOutput(){return this.m_bNormalize}updateProjector(){this.m_projector=new yl(this)}},eu=new Map,Br=new Map,Fl=new Map;function ba(r){let t=r.getCode();if(t>0)return su(t)||Yl(te.coordsys(t));let e=r.getName();if(Br.has(e)){let s=Br.get(e);if(s&&s.deref()){let n=s.deref();if(n.m_peCoordSys.isEqual(r))return n}}return t=te.getCode(r),Yl(t>0?te.coordsys(t):r)}function wC(r){r<=0&&Kr(r);{let s=su(r);if(s)return s}let t=Ni(te.coordsys(r));t.get()||Kr(r);let e=Yl(t.release());return e.getLatestID()!==r&&eu.set(r,new WeakRef(e)),e}function DC(r){let t=new Ml({},!0);return t.m_WKID=r,t}function TC(r){let t=Ni(te.fromString(tt.PE_TYPE_COORDSYS,r));return t.get()||Ua(r),ba(t.release())}function NC(r){Br.delete(r.m_peCoordSys.getName()),Fl.delete(Zl(r.m_peCoordSys,0,!1))}var Vl=class{constructor(t,e,s){this.m_hashCode=-1,t&&(this.m_inputSR=t,this.m_outputSR=e,this.m_env=s.clone(),this.m_hashCode=this.m_inputSR.getHashCode(),this.m_hashCode=ne(this.m_hashCode,this.m_outputSR.getHashCode()),this.m_env.isEmpty()||(this.m_hashCode=ne(this.m_hashCode,Xi(this.m_env.xmin)),this.m_hashCode=ne(this.m_hashCode,Xi(this.m_env.xmax)),this.m_hashCode=ne(this.m_hashCode,Xi(this.m_env.ymin)),this.m_hashCode=ne(this.m_hashCode,Xi(this.m_env.ymax))))}getHashCode(){return this.m_hashCode}equals(t){return!(this.m_inputSR&&!t.m_inputSR||!this.m_inputSR&&t.m_inputSR)&&this.m_env.equals(t.m_env)&&this.m_inputSR.equals(t.m_inputSR)&&this.m_outputSR.equals(t.m_outputSR)}clear(){this.m_inputSR=void 0,this.m_outputSR=void 0,this.m_hashCode=-1,this.m_env=void 0}},ql=new Map;function AC(r){if(ql.has(r.getHashCode()))return ql.get(r.getHashCode())}function MC(r,t){return ql.set(r.getHashCode(),t),t}var Bm,Um,zm;function Q_(){return Bm||(Bm=Ei(Va(),qa())),Bm}function GC(){return Um||(Um=Q_().getInverse()),Um}function FC(){return zm||(zm=te.unit(9001)),zm}function VC(r){return Ni(te.coordsys(r)).get()!==null}var Om=new Map;function qC(r){if(Om.has(r))return Om.get(r);{let t=VC(r);return Om.set(r,t),t}}function YC(r){return!1}function Yl(r){let t=Ni(r),e=r.getCode();if(e>0){let a=su(e);if(a)return a}let s=r.getName(),n=Br.get(s);if(n){let a=n.deref();if(a&&a.m_peCoordSys.isEqual(r))return a}let i=new Lr(t.release());if(e>0)return i.setCached(),eu.set(e,new WeakRef(i)),Br.set(s,new WeakRef(i)),i;let o=Zl(r,0,!1);if(n=Fl.get(o),n){let a=n.deref();if(a)return a}return i.setCached(),Fl.set(o,new WeakRef(i)),i}function su(r){let t=eu.get(r);if(t)return t.deref()}var Fs=class extends ea{constructor(t){return t===void 0?(super(),this.m_wkid=9001,void(this.m_peUnit=null)):typeof t=="number"?(super(),this.m_factor=t,void(this.m_wkid=0)):(super(t),void(t||(this.m_factor=1,this.m_wkid=9001,this.m_peUnit=FC())))}getUnitType(){return 0}convertFromMeters(t){return t/this.getUnitToBaseFactor()}convertToMeters(t){return t*this.getUnitToBaseFactor()}},XC=["0","1","2","3","4","5","6","7","8","9","b","c","d","e","f","g","h","j","k","m","n","p","q","r","s","t","u","v","w","x","y","z"];function kC(r,t,e){let s=Z(t,"R"),n=0,i=0;for(let o=0;o<t;o++){let a=r[n]>>i&31;if(i+=5,i>31){let m=37-i;a&=(1<<m)-1,i-=32,n++,a|=(r[n]&(1<<i)-1)<<m}let h=XC[a];s[t-1-o]=h}return e>t?s.push(..."0".repeat(e-t)):e<t&&(s.length=e),s.join("")}function Bd(r,t,e,s,n){w(s>>5<n.length);let i=t,o=e;for(let a=s;a>=0;a-=2){let h=31&a,m=.5*(o+i);r>=m?(n[a>>5]|=1<<h,i=m):o=m}}var wa=new Set,Xl=2147483645n,$o=9007199254740990n,Wm="operation is not supported for unknown coordinate systems",Ud;function Ti(){return{majorSemiAxis:0,e2:0,minorSemiAxis:0,flattening:0,isSphere(){return this.e2===0}}}function RC(r,t,e){r.majorSemiAxis=t,r.minorSemiAxis=t*(1-e),r.e2=e*(2-e),r.flattening=e}function HC(r){if(te)return;tE(r);let t=wa;wa=null,t.forEach(e=>{let s=e.deref();s&&s.attachToPe()})}function LC(r){JC(r)}function Is(){return!!te}function nu(){return!!Dn}function Fa(){return!!te||!!Dn}function kl(r,t,e){return w(Fa()),Xa(r,t===void 0?0:t,null,!1)}function K_(r,t){w(Fa());let e=new sn,s;return Is()?(s=TC(r),e.setHorzProj_(s),e.m_vertcs=null,e.m_userWKID=s.getLatestID()):(s=ka(r),e.m_unit=s.isPCS?new Fs(s.metersOrRadiansPerUnit):new On(s.metersOrRadiansPerUnit)),Ya(e.m_precisionDescriptor,s,null,1),e.m_bDefaultDescriptor=!0,e.m_userWKT=r,e.calculateHashCode(),e.initDbgName(),e}function Ur(r,t,e,s,n=!0){let i=null;return t&&(i=PP(t,n)),BC(r,i,e,s,n)}function BC(r,t,e,s,n){r||U("!PE_coord_sys");let i=new sn,o;return o=n?ba(r):new Lr(r,!1),Ya(i.m_precisionDescriptor,o,t,s),i.m_bDefaultDescriptor=!0,i.setHorzProj_(o),i.m_vertcs=t,i.m_userWKID=o.getLatestID(),i.calculateHashCode(),i.initDbgName(),i}function $_(r,t,e=!1){r.getCoordinateSystemType()===3&&U("image spatial reference cannot be altered");let s=new sn,n=r;return s.m_peCoordSysVal=n.m_peCoordSysVal,s.m_vertcs=n.m_vertcs,s.m_unit=n.m_unit,s.m_precisionDescriptor.assign(t),s.m_localZToXYFactor=n.m_localZToXYFactor,(Number.isNaN(s.m_precisionDescriptor.m_falseX)||Number.isNaN(s.m_precisionDescriptor.m_falseY))&&(s.m_precisionDescriptor.m_falseX=n.m_precisionDescriptor.m_falseX,s.m_precisionDescriptor.m_falseY=n.m_precisionDescriptor.m_falseY),s.m_precisionDescriptor.snapPrecision(),s.m_precisionDescriptor.fixTolerance(),s.m_userWKID=n.m_userWKID,s.m_precisionDescriptor.equals(n.m_precisionDescriptor)?s.m_bDefaultDescriptor=n.m_bDefaultDescriptor:s.m_bDefaultDescriptor=!1,e&&(s.m_bDefaultDescriptor=!0),s.calculateHashCode(),s.initDbgName(),s}function Rl(r,t,e){return{}}function UC(r,t,e){t===void 0&&(t=1),(t<=0||!Number.isFinite(t))&&U(""),r||t===1||U("null Unit has to have z_to_xy_factor equal to 1");let s=new sn;s.m_unit=r;let n=r||new Fs(9001);return sp(s.m_precisionDescriptor,n,null,1),s.m_bDefaultDescriptor=!0,Number.isNaN(s.m_precisionDescriptor.m_falseX)&&U("NAN false X/Y are not allowed here"),s.m_localZToXYFactor=t,s.calculateHashCode(),s.initDbgName(),s}function zC(r,t){return r.snapGeometry(t)}function Jo(r){let t=r.getCoordinateSystemType();return t===1?r:(t===3&&w(0),r.getGCS())}function OC(r){return w(Fa()),nu()?sE(r):qC(r)}function WC(r){if(Is())return Ni(te.fromString(tt.PE_TYPE_COORDSYS,r)).get()!==null;try{return ka(r),!0}catch{}return!1}var jm;function J_(){return jm||(jm=(()=>{let r=Math.trunc(Math.random()*Pe()),t=Date.now();return`|abba_000|${r.toString(16)}|${t.toString(16)}|`})()),jm}(function(r){r[r.utmDefault=0]="utmDefault",r[r.utmNorthSouth=1]="utmNorthSouth"})(Ud||(Ud={}));var jC=0;function ZC(r=""){let t=`${J_()}${jC++}`;return r!==""&&(t+=`|${r}`),t}function tp(r){return r.startsWith(J_())}var jo,Zo,Qo,sn=class Fr{destroy(){NC(this.m_peCoordSysVal),this.getCoordinateSystemType()===1||this.getCoordinateSystemType()===2?this.getPECoordSys().destroy():j("SpatialReference.destroy")}constructor(){this.m_vertcs=null,this.m_peCoordSysVal=null,this.m_userWKID=0,this.m_userWKT=null,this.m_geogSpatialReference=null,this.m_srToGcs=null,this.m_gcsToSr=null,this.m_defaultPrecisionSR=null,this.m_localZToXYFactor=-1,this.m_precisionDescriptor=new tn,this.m_hashCode=0,this.m_bDefaultDescriptor=!1,ru(this.m_precisionDescriptor),wa&&wa.add(new WeakRef(this))}attachToPe(){(this.m_userWKID>0?kl(this.m_userWKID):K_(this.m_userWKT)).copyTo(this,!1)}copyTo(t,e=!0){(e||t.m_bDefaultDescriptor)&&(t.m_bDefaultDescriptor=this.m_bDefaultDescriptor,t.m_precisionDescriptor.assign(this.m_precisionDescriptor)),t.m_defaultPrecisionSR=null,t.m_gcsToSr=this.m_gcsToSr,t.m_geogSpatialReference=this.m_geogSpatialReference,t.m_hashCode=this.m_hashCode,t.m_localZToXYFactor=this.m_localZToXYFactor,t.m_peCoordSysVal=this.m_peCoordSysVal,t.m_srToGcs=this.m_srToGcs,t.m_userWKID=this.m_userWKID,t.m_userWKT=this.m_userWKT,t.m_vertcs=this.m_vertcs,t.m_unit=this.m_unit}getHashCode(){return this.m_hashCode}getHashCodeHorizontal(){let t=0;return t=this.m_peCoordSysVal?this.m_peCoordSysVal.getHashCode():this.m_unit?this.m_unit.getHashCode():305419891,t}updateTransform(t){if(this.getCoordinateSystemType()===1)return Ei(this,this,null);let e=t?this.m_srToGcs:this.m_gcsToSr;if(e)return e;let s=this.getGCS(),n=this;e=t?Ei(n,s,null):Ei(s,n,null);let i=e;return(t?this.m_srToGcs:this.m_gcsToSr)||(t?this.m_srToGcs=i:this.m_gcsToSr=i,e)}getHashCodeVertical(){return this.m_vertcs?this.m_vertcs.getHashCode():0}calculateHashCode(){let t=this.getHashCodeHorizontal(),e=this.getHashCodeVertical(),s=this.m_precisionDescriptor.getHashCode();t=ne(t,e),this.m_hashCode=ne(t,s)}initDbgName(){}setHorzProj_(t){this.m_peCoordSysVal=t,this.m_unit=this.m_peCoordSysVal.getUnit()}getTolerance(t=0){return this.m_precisionDescriptor.getTolerance(t)}getResolution(t=0){return this.m_precisionDescriptor.getResolution(t)}getPECoordSys(){return this.m_peCoordSysVal?this.m_peCoordSysVal.m_peCoordSys:null}getPCSInfo(){return this.throwIfNotGCSOrPCS(),w(this.m_peCoordSysVal),this.m_peCoordSysVal.getPCSInfo()}getCentralMeridian(){return this.throwIfNotGCSOrPCS(),this.getCoordinateSystemType()===1?0:this.getPCSInfo().getCentralMeridian()}getCoordinateSystemType(){let t=this.getPECoordSys();if(t)switch(t.getType()){case tt.PE_TYPE_GEOGCS:return 1;case tt.PE_TYPE_PROJCS:return 2;default:return 0}else{if((this.m_userWKID>0||this.m_userWKT)&&this.m_unit instanceof Fs)return 2;if(this.m_unit instanceof On)return 1}return 0}getID(){return this.m_userWKID}getLatestID(){return this.m_peCoordSysVal?this.m_peCoordSysVal.getLatestID():this.m_userWKID}getOldID(){return this.m_peCoordSysVal?this.m_peCoordSysVal.getOldID():this.m_userWKID}getVerticalID(){return ft("vcs not implemented"),0}getLatestVerticalID(){return this.m_vertcs?this.m_vertcs.getLatestID():0}getOldVerticalID(){return ft("vcs not implemented"),0}getPEVerticalCoordSys(){return null}getPole(t){return this.throwIfNotGCSOrPCS(),w(this.m_peCoordSysVal),this.m_peCoordSysVal.getPole(t)}getText(){let t=this.getPECoordSys();return t?kd(t):this.m_userWKT??""}getTextExtended(t){let e=this.getPECoordSys();return e?this.getPEVerticalCoordSys()?kP(null,e,this.getPEVerticalCoordSys()):kd(e,t):this.m_userWKT??""}getText2(t=-1){let e=this.getPECoordSys();return e?RP(e,t):this.m_userWKT??""}getUnit(){return this.m_unit}getUnitsPerMillimeter(){return this.m_peCoordSysVal?this.m_peCoordSysVal.getUnitsPerMillimeter():this.m_unit instanceof Fs?.001/this.m_unit.getUnitToBaseFactor():this.m_unit instanceof On?.001/(ka(this.m_userWKT??this.m_userWKID).semiMajor*this.m_unit.getUnitToBaseFactor()):(re("sr object not in valid state"),0)}getAuthorityName(){return this.getPECoordSys()?HP():""}getVerticalUnit(){return ft("vcs not implemented"),{}}getVCS(){return this.m_vertcs}hasVCS(){return!1}getGCSHorisonIsInclusive(){return this.throwIfNotGCSOrPCS(),w(this.m_peCoordSysVal),this.m_peCoordSysVal.getGCSHorisonIsInclusive()}getGCSHorizon(){return this.throwIfNotGCSOrPCS(),w(this.m_peCoordSysVal),this.m_peCoordSysVal.getGCSHorizon()}getGCS(){let t=this.getCoordinateSystemType();if(t===0)re(Wm);else{if(t===1)return this;t===3&&re("image cs not supported")}if(this.m_geogSpatialReference)return this.m_geogSpatialReference;let e;if(this===Va()||this===iu())e=qa();else{w(this.m_peCoordSysVal);let s=this.m_peCoordSysVal.m_peCoordSys.getGeogcs();s||j(""),e=Ur(s,this.m_vertcs,null,this.m_precisionDescriptor.getPrecision(),this.m_peCoordSysVal.getCached())}return this.m_geogSpatialReference?e=this.m_geogSpatialReference:this.m_geogSpatialReference=e,e}getGCSSplitLines(){return this.throwIfNotGCSOrPCS(),w(this.m_peCoordSysVal),this.m_peCoordSysVal.getGCSSplitLines()}toGCS(t,e){if(t.length===0)return 0;t.length>e.length&&U("coordsSrc.size() > coordsDst.size()");let s=this.getCoordinateSystemType();if(s===0&&re(Wm),s===1)return Fi(e,t,t.length),t.length;w(this.m_peCoordSysVal);let n=this.getSRToGCSTransform();return new Ws().transform(n,t,t.length,e)}toGeohash(t,e=8){let s=t.clone();s.scale(this.getGCS().getUnit().getID()===9102?1:this.getGCS().getUnit().getUnitToBaseFactor()/Math.PI*180),s.x<-180?(s.x=Xs(s.x,360),s.x<-180&&(s.x+=360)):s.x>180&&(s.x=Xs(s.x,360),s.x>180&&(s.x-=360)),s.y>90&&(s.y=90),s.y<-90&&(s.y=-90);let n=5*e,i=new Uint32Array(4);return Bd(s.x,-180,180,n-1,i),Bd(s.y,-90,90,n-2,i),kC(i,e,e)}isPannable(){let t=this.getCoordinateSystemType();return t!==0&&t!==3&&(w(this.m_peCoordSysVal),this.m_peCoordSysVal.isPannable())}getPannableExtent(){return this.isPannable()||U("!is_pannable"),w(this.m_peCoordSysVal),this.m_peCoordSysVal.getPannableExtent()}getPannableExtentInGCS(){return this.isPannable()||U("!is_pannable"),w(this.m_peCoordSysVal),this.m_peCoordSysVal.getPannableExtentGCS()}throwIfNotGCSOrPCS(){let t=this.getCoordinateSystemType();t!==1&&t!==2&&U("Not a GCS or PCS")}getDomainXY(){return this.throwIfNotGCSOrPCS(),w(this.m_peCoordSysVal),this.m_peCoordSysVal.getDomainXY()}getFullWorldExtent(){return this.throwIfNotGCSOrPCS(),this.isPannable()?this.getPannableExtent():this.getDomainXY()}queryPrecisionDescriptor(t){if(t.assign(this.m_precisionDescriptor),Number.isNaN(t.m_falseX))if(Is()||Mi("cannot query precision descriptor"),w(this.m_peCoordSysVal!==null),this.m_precisionDescriptor.m_precision!==2){let e=this.m_peCoordSysVal.getDomainXY();t.m_falseX=e.xmin,t.m_falseY=e.ymin}else t.m_falseX=-Number.MAX_VALUE,t.m_falseY=-Number.MAX_VALUE}queryPrecisionDescriptorWithoutFalseXY(t){t.assign(this.m_precisionDescriptor),t.m_falseX=Number.NaN,t.m_falseY=Number.NaN}queryDefaultPrecisionDescriptorWithoutFalseXY(t){if(this.m_bDefaultDescriptor)t.assign(this.m_precisionDescriptor);else{let e=this.getCoordinateSystemType();e===0?sp(t,this.m_unit,this.m_vertcs,this.m_precisionDescriptor.getPrecision()):e===3?ft("image cs"):Ya(t,this.m_peCoordSysVal,this.m_vertcs,this.m_precisionDescriptor.getPrecision())}t.m_falseX=Number.NaN,t.m_falseY=Number.NaN}horizontalEqual(t){return CC(this.m_peCoordSysVal,t.m_peCoordSysVal)}verticalEqual(t){return this.m_vertcs!==null==(t.m_vertcs!==null)&&(!this.m_vertcs||this.m_vertcs.equals(t.m_vertcs))}equals(t){let e=t;if(this===e)return!0;if(!this.horizontalEqual(e)||!this.verticalEqual(e)||!e.m_peCoordSysVal&&(w(!this.m_peCoordSysVal),this.m_unit!==null!=(e.m_unit!==null)||this.m_unit&&!this.m_unit.equals(e.m_unit)||this.m_localZToXYFactor!==e.m_localZToXYFactor))return!1;if(!this.m_bDefaultDescriptor||!e.m_bDefaultDescriptor){if(this.m_peCoordSysVal){if(!this.m_precisionDescriptor.equalsWithoutFalseXY(e.m_precisionDescriptor))return!1;w(e.m_peCoordSysVal);let s=this.m_precisionDescriptor.m_falseX,n=this.m_precisionDescriptor.m_falseY;if(Number.isNaN(s)){let a=this.m_peCoordSysVal.getDomainXY();s=a.xmin,n=a.ymin}let i=e.m_precisionDescriptor.m_falseX,o=e.m_precisionDescriptor.m_falseY;if(Number.isNaN(i)){let a=e.m_peCoordSysVal.getDomainXY();i=a.xmin,o=a.ymin}return s===i&&n===o}return this.m_precisionDescriptor.equals(e.m_precisionDescriptor)}return!0}equalForProjection(t,e){if(this===t)return!0;let s=this.getCoordinateSystemType(),n=t.getCoordinateSystemType();if(s===0||n===0)return s===0&&n===0?(!e||this.getZToXYFactor()===t.getZToXYFactor())&&(!this.getUnit()||!t.getUnit()||this.getUnit().equals(t.getUnit())):s!==3&&n!==3&&(this.getUnit()===null||t.getUnit()===null||(!e||this.getZToXYFactor()===t.getZToXYFactor())&&this.getUnit().equals(t.getUnit()));if(s!==n)return!1;if(s===3)return this.equals(t);if(EC(this.m_peCoordSysVal,t.m_peCoordSysVal)){if(!e)return!0;if(this.m_vertcs!==null==(t.m_vertcs!==null))return!this.m_vertcs||this.m_vertcs.equalForProjection(t.m_vertcs)}return!1}equalHorizontal(t){return this.horizontalEqual(t)}equalVertical(t){return w(0),!1}equalVerticalVCS(t){return w(0),!1}convergenceAngle(t){return w(0),0}getPeCoordsysCopy(){if(this.m_peCoordSysVal){let t=this.m_peCoordSysVal.m_peCoordSys;return t||j("cannot clone coord sys"),t}return null}getPeVertcsCopy(){return w(0),0}throwIfLocal(){this.getCoordinateSystemType()===0&&U(Wm)}getPrimeMeridian(){return this.throwIfLocal(),w(this.m_peCoordSysVal),this.m_peCoordSysVal.getPrimeMeridian()}getSRToGCSTransform(){return this.updateTransform(!0)}getGCSToSRTransform(){return this.updateTransform(!1)}getOneMeter(){return 1e3*this.getUnitsPerMillimeter()}getOneMeterPCSUnit(){return this.throwIfNotGCSOrPCS(),w(this.m_peCoordSysVal),this.m_peCoordSysVal.getOneMeterPCSUnit()}getDefaultPrecisionSR(){if(this.m_bDefaultDescriptor)return this;if(this.m_defaultPrecisionSR===null){let t=new tn;this.queryDefaultPrecisionDescriptorWithoutFalseXY(t),this.m_defaultPrecisionSR=$_(this,t,!0)}return this.m_defaultPrecisionSR}getPCSHorizon(){return this.throwIfNotGCSOrPCS(),w(this.m_peCoordSysVal),this.m_peCoordSysVal.getPCSHorizon()}getHorzUnitFactor(){return this.m_unit?this.m_unit.getUnitToBaseFactor():1}querySpheroidData(t){this.throwIfNotGCSOrPCS(),w(this.m_peCoordSysVal);let e=this.getGCS().getPECoordSys().getDatum().getSpheroid(),s=e.getFlattening();RC(t,e.getAxis(),s)}getAreaOfUse(){this.getCoordinateSystemType()===0&&re(""),w(this.m_peCoordSysVal);let t=this.m_peCoordSysVal.getAreaOfUse();return t===null?new ta:new ta({geom:t.clone(),sr:kl(4326)})}getZToXYFactor(){return 1}isCustomWkid(){return!1}getOneDegreeGCSUnit(){return this.throwIfNotGCSOrPCS(),w(this.m_peCoordSysVal),this.m_peCoordSysVal.getOneDegreeGCSUnit()}getGcsUnitFactor(){return this.throwIfNotGCSOrPCS(),w(this.m_peCoordSysVal),this.m_peCoordSysVal.getGcsUnitFactor()}snapGeometry(t){if(t.isEmpty()||this.m_precisionDescriptor.getPrecision()===2)return!1;let e=t.getGeometryType();if(Ie(e))return this.snapMultiVertex_(t);if(e===N.enumPoint)return this.snapPoint_(t);if(e===N.enumEnvelope)return this.snapEnvelope_(t);if(Qt(e))return this.snapSegment_(t);if(e===N.enumGeometryCollection){let s=t,n=!1;for(let i=0,o=s.getGeometryCount();i<o;++i)n=this.snapGeometry(s.getGeometry(i))||n;return n}j("what else?")}snapMultiVertex_(t){if(w(!t.isEmpty()),w(this.m_precisionDescriptor.getPrecision()!==2),at(t.getGeometryType())){let i=t;if(i.hasNonLinearSegments())return this.snapGeometryWithCurves_(i)}let e=t.getImpl(),s=e.getDescription(),n=!1;for(let i=0,o=s.getAttributeCount();i<o;i++){let a=s.getSemantics(i),h=e.getAttributeStreamRef(a);n=this.snapAttributes(a,h,0,e.getPointCount())||n}return n&&e.notifyModifiedFlags(2001),n}snapPoint_(t){return!1}snapEnvelope_(t){return!1}snapSegment_(t){w(!t.isEmpty()),w(this.m_precisionDescriptor.getPrecision()!==2);let e=new tn;this.queryPrecisionDescriptor(e);let s=t.getStartXY(),n=new y;n.x=Pi(s.x,e.getFalseX(),e.getGridUnitsXY()),n.y=Pi(s.y,e.getFalseY(),e.getGridUnitsXY());let i=!n.equals(s),o=t.getEndXY(),a=new y;a.x=Pi(o.x,e.getFalseX(),e.getGridUnitsXY()),a.y=Pi(o.y,e.getFalseY(),e.getGridUnitsXY()),i||=!a.equals(o),i&&t.changeEndPoints2D(n,a);let h=(l,u,c)=>{let g=!1;{let d=t.getStartAttributeAsDbl(l,0),_=Pi(d,u,c),p=!Ne(_,d);g||=p,p&&t.setStartAttribute(l,0,_)}{let d=t.getEndAttributeAsDbl(l,0),_=Pi(d,u,c),p=!Ne(_,d);g||=p,p&&t.setEndAttribute(l,0,_)}return g},m=i?1:0;return t.hasAttribute(1)&&(m|=h(1,e.getFalseZ(),e.getGridUnitsZ())?1:0),t.hasAttribute(2)&&(m|=h(2,e.getFalseM(),e.getGridUnitsM())?1:0),!!m}snapGeometryWithCurves_(t){w(!t.isEmpty()),w(this.m_precisionDescriptor.getPrecision()!==2);let e=t.createInstance(),s=new et,n=0;for(let i=0,o=t.getPathCount();i<o;++i){let a=t.getSegmentCountPath(i);if(a===0){if(e.addPath(t,i,!0),e.getPathSize(i)===1){let m=new st;e.getPointByVal(e.getPointCount()-1,m),n|=this.snapGeometry(m)?1:0,e.setPointByVal(e.getPointCount()-1,m)}continue}let h=t.isClosedPath(i);for(let m=0,l=h?a-1:a;m<l;++m)t.getSegmentFromPath(i,m,s,!1),n|=this.snapGeometry(s.get())?1:0,e.addSegment(s.get(),m===0);h&&(t.getSegmentFromPath(i,a-1,s,!1),n|=this.snapGeometry(s.get())?1:0,a===1?e.addPathFromClosedSegment(s.get(),!1):e.closeLastPathWithSegment(s.get()))}return n&&e.copyTo(t),!!n}snapAttributes(t,e,s,n){let i=!1,o=new tn;if(this.queryPrecisionDescriptor(o),t===0){let a=e;for(let h=s;h<n;h++){let m=a.read(2*h),l=Fr.s_SnapValue(m,o.getFalseX(),o.getGridUnitsXY()),u=a.read(2*h+1),c=Fr.s_SnapValue(u,o.getFalseY(),o.getGridUnitsXY());i=i||l!==m||c!==u,i&&(a.write(2*h,l),a.write(2*h+1,c))}}else if(t===1){let a=e;for(let h=s;h<n;h++){let m=a.read(h),l=Fr.s_SnapValue(m,o.getFalseZ(),o.getGridUnitsZ());i=i||!Ne(l,m),i&&a.write(h,l)}}else if(t===2){let a=e;for(let h=s;h<n;h++){let m=a.read(h),l=Fr.s_SnapValue(m,o.getFalseM(),o.getGridUnitsM());i=i||!Ne(l,m),i&&a.write(h,l)}}return i}static s_SnapValue(t,e,s){return an((t-e)*s)/s+e}},tn=class r{constructor(){let t=$o,e=1e-4,s=.001,n=e*Number(t)*.5;this.m_precision=1,this.m_falseX=-n,this.m_falseY=-n,this.m_unitsXY=Number(t)/(2*n),this.m_falseM=-1e5,this.m_unitsM=1/e,this.m_falseZ=-1e5,this.m_unitsZ=1/e,this.m_toleranceXY=s,this.m_toleranceM=s,this.m_toleranceZ=s}getHashCode(){let t=7777,e=7777;return e=ne(e,this.m_falseM),e=ne(e,this.m_unitsM),t=ne(t,this.m_unitsXY),e=ne(e,this.m_toleranceXY),t=ne(t,this.m_falseZ),e=ne(e,this.m_toleranceZ),t=ne(t,this.m_unitsZ),e=ne(e,this.m_toleranceM),t=ne(t,this.m_precision),ne(t,e)}clone(){let t=new r;return t.m_falseX=this.m_falseX,t.m_falseY=this.m_falseY,t.m_unitsXY=this.m_unitsXY,t.m_falseZ=this.m_falseZ,t.m_unitsZ=this.m_unitsZ,t.m_falseM=this.m_falseM,t.m_unitsM=this.m_unitsM,t.m_toleranceXY=this.m_toleranceXY,t.m_toleranceZ=this.m_toleranceZ,t.m_toleranceM=this.m_toleranceM,t.m_precision=this.m_precision,t}assign(t){return this.m_falseX=t.m_falseX,this.m_falseY=t.m_falseY,this.m_unitsXY=t.m_unitsXY,this.m_falseZ=t.m_falseZ,this.m_unitsZ=t.m_unitsZ,this.m_falseM=t.m_falseM,this.m_unitsM=t.m_unitsM,this.m_toleranceXY=t.m_toleranceXY,this.m_toleranceZ=t.m_toleranceZ,this.m_toleranceM=t.m_toleranceM,this.m_precision=t.m_precision,this}initialize2D(t,e){}getTolerance(t){switch(t){case 0:return this.m_toleranceXY;case 1:return this.m_toleranceZ;case 2:return this.m_toleranceM;default:return 0}}getResolution(t){if(this.m_precision===2)return 0;switch(t){case 0:return 1/this.m_unitsXY;case 1:return 1/this.m_unitsZ;case 2:return 1/this.m_unitsM;default:return 0}}getFalseX(){return this.m_falseX}getFalseY(){return this.m_falseY}getFalseZ(){return this.m_falseZ}getFalseM(){return this.m_falseM}getGridUnitsXY(){return this.m_unitsXY}getGridUnitsZ(){return this.m_unitsZ}getGridUnitsM(){return this.m_unitsM}getPrecision(){return this.m_precision}static getLimit32(){return 2147483645}static getLimit64(){return 9007199254740990n}static getLimitFloat(){return 0}getXYGridRange(){let t=new V;switch(this.m_precision){case 0:{let e=r.getLimit32()/this.getGridUnitsXY();t.setCoords({xmin:this.getFalseX(),ymin:this.getFalseY(),xmax:this.getFalseX()+e,ymax:this.getFalseY()+e})}break;case 1:{let e=Number(r.getLimit64())/this.getGridUnitsXY();t.setCoords({xmin:this.getFalseX(),ymin:this.getFalseY(),xmax:this.getFalseX()+e,ymax:this.getFalseY()+e})}break;case 2:t.setCoords({xmin:-Number.MAX_VALUE,ymin:-Number.MAX_VALUE,xmax:Number.MAX_VALUE,ymax:Number.MAX_VALUE});break;default:t.setEmpty(),j("")}return t}getZGridRange(){let t=new B;switch(this.m_precision){case 0:{let e=r.getLimit32()/this.getGridUnitsZ();t.setCoords(this.getFalseZ(),this.getFalseZ()+e)}break;case 1:{let e=Number(r.getLimit64())/this.getGridUnitsZ();t.setCoords(this.getFalseZ(),this.getFalseZ()+e)}break;case 2:t.setCoords(-Number.MAX_VALUE,Number.MAX_VALUE);break;default:t.setEmpty(),j("")}return t}getMGridRange(){let t=new B;switch(this.m_precision){case 0:{let e=r.getLimit32()/this.getGridUnitsM();t.setCoords(this.getFalseM(),this.getFalseM()+e)}break;case 1:{let e=Number(r.getLimit64())/this.getGridUnitsM();t.setCoords(this.getFalseM(),this.getFalseM()+e)}break;case 2:t.setCoords(-Number.MAX_VALUE,Number.MAX_VALUE);break;default:t.setEmpty(),j("")}return t}setTolerance(t,e){switch(e<0&&U("tol < 0"),Number.isFinite(e)||U("tol is not finite"),t){case 0:this.m_toleranceXY=e;break;case 1:this.m_toleranceZ=e;break;case 2:this.m_toleranceM=e;break;default:U("cannot set tolerance for this attribute")}}setGridParams(t,e,s){Number.isFinite(t)&&Number.isFinite(e)&&Number.isFinite(s)||U("grid params are not finite"),s<1&&U("grid units cannot be smaller than 1.0"),this.m_falseX=t,this.m_falseY=e,this.m_unitsXY=s}setZParams(t,e){Number.isFinite(t)&&Number.isFinite(e)||U("grid params are not finite"),e<1&&U("grid units cannot be smaller than 1.0"),this.m_falseZ=t,this.m_unitsZ=e}setMParams(t,e){Number.isFinite(t)&&Number.isFinite(e)||U("grid params are not finite"),e<1&&U("grid units cannot be smaller than 1.0"),this.m_falseM=t,this.m_unitsM=e}setPrecision(t){}equals(t){return this===t||Ne(this.m_falseX,t.m_falseX)&&Ne(this.m_falseY,t.m_falseY)&&this.equalsWithoutFalseXY(t)}snapPrecision(){if(this.m_precision===2)return;let t=(s,n,i,o)=>{if(!Number.isFinite(n)||!Number.isFinite(i))return i;if(i<1)return 1;if(!o)return i;let a=Number(s)/i;return Math.trunc((n+a-n)*i)>s&&(i=s/(n+a-n)),Math.max(1,i)},e=Number(this.m_precision===0?Xl:$o);this.m_unitsXY=t(e,this.m_falseX,this.m_unitsXY,!0),this.m_unitsXY=t(e,this.m_falseY,this.m_unitsXY,!0),this.m_unitsZ=t(e,this.m_falseZ,this.m_unitsZ,!1),this.m_unitsM=t(e,this.m_falseM,this.m_unitsM,!1)}verifyPrecision(){if(this.m_precision===2)return!0;let t=(s,n,i,o)=>{if(i<1||!Number.isFinite(n)||!Number.isFinite(i))return!1;if(!o)return!0;let a=Number(s)/i;return!(BigInt((n+a-n)*i)>s)},e=this.m_precision===0?Xl:$o;return!!t(e,this.m_falseX,this.m_unitsXY,!0)&&!!t(e,this.m_falseY,this.m_unitsXY,!0)&&!!t(e,this.m_falseZ,this.m_unitsZ,!1)&&!!t(e,this.m_falseM,this.m_unitsM,!1)}fixTolerance(){this.m_precision!==2&&(this.m_toleranceXY=Math.max(2/this.m_unitsXY,this.m_toleranceXY),this.m_toleranceZ=Math.max(2/this.m_unitsZ,this.m_toleranceZ),this.m_toleranceM=Math.max(2/this.m_unitsM,this.m_toleranceM),(Number.isNaN(this.m_falseX)||Number.isNaN(this.m_falseY))&&(this.m_falseX=this.m_falseY=Number.NaN))}equalsWithoutFalseXY(t){return this===t||this.m_unitsXY===t.m_unitsXY&&this.m_falseZ===t.m_falseZ&&this.m_unitsZ===t.m_unitsZ&&this.m_falseM===t.m_falseM&&this.m_unitsM===t.m_unitsM&&this.m_toleranceXY===t.m_toleranceXY&&this.m_toleranceZ===t.m_toleranceZ&&this.m_toleranceM===t.m_toleranceM&&this.m_precision===t.m_precision}setBestXyDomainFromEnvelope(t,e){}setBestZDomainFromZRange(t,e,s){}setBestMDomainFromMRange(t,e,s){}};function Va(){return(!jo||Is()&&jo.getPECoordSys()===null)&&(jo=Xa(3857,0,null,!0)),jo}function iu(){return(!Zo||Is()&&Zo.getPECoordSys()===null)&&(Zo=Xa(102100,0,null,!0)),Zo}function qa(){return(!Qo||Is()&&Qo.getPECoordSys()===null)&&(Qo=Xa(4326,0,null,!0)),Qo}function ru(r){r.m_falseX=0,r.m_falseY=0,r.m_unitsXY=1,r.m_falseZ=0,r.m_unitsZ=1,r.m_falseM=0,r.m_unitsM=1,r.m_toleranceXY=100*kt(),r.m_toleranceZ=100*kt(),r.m_toleranceM=100*kt(),r.m_precision=2}function Ya(r,t,e,s){let n=t instanceof Lr;ru(r),r.m_precision=s,r.m_falseX=Number.NaN,r.m_falseY=Number.NaN;let i=1e-4,o=.001,a=n?t.m_csType:t.isPCS?2:1;if(a===1){let l=(s===0?5555555555555555e-22:1e-9)*(n?t.getOneDegreeGCSUnit():Math.PI/t.metersOrRadiansPerUnit/180);r.m_unitsXY=1/l}else if(a===2){let l=(s===0?o:i)*(n?t.getOneMeterPCSUnit():1/t.metersOrRadiansPerUnit);r.m_unitsXY=1/l}else U("unrecognized cs type");r.m_falseM=-1e5,r.m_unitsM=1/(s===0?o:i),r.m_unitsM=Math.max(1,r.m_unitsM),r.m_unitsXY=Math.max(1,r.m_unitsXY);let h=0,m=0;s!==0&&s!==1||(h=2/r.m_unitsXY,m=2/r.m_unitsM),r.m_toleranceXY=Math.max(h,n?t.getUnitsPerMillimeter():a===2?.001/t.metersOrRadiansPerUnit:.001/(t.semiMajor*t.metersOrRadiansPerUnit)),r.m_toleranceM=Math.max(o,m),ep(r,e)}function ep(r,t){if(r.m_falseZ=-1e5,t){let i=(r.m_precision===0?.001:1e-4)*t.getOneMeter();r.m_unitsZ=1/i}else r.m_unitsZ=1/(r.m_precision===0?.001:1e-4);r.m_unitsZ=Math.max(1,r.m_unitsZ);let n=0;r.m_precision!==0&&r.m_precision!==1||(n=2/r.m_unitsZ),r.m_toleranceZ=Math.max(t?t.getOneMeter()*.001:.001,n)}function sp(r,t,e,s){ru(r),r.m_precision=s;let n=s===0?Xl:$o,i=1e-4,o=.001,a=1,h=1,m=.001;t&&(h=t.getUnitToBaseFactor()),t&&t.getUnitType()===1?(a=400*Math.PI/180,m=8983152841195215e-24*Math.PI/180/h):(a=(s===0?o:i)*Number(n)*.5,m=o/h),a/=h,r.m_falseX=-a,r.m_falseY=-a,r.m_unitsXY=Number(n)/(2*a),r.m_falseM=-1e5,r.m_unitsM=1/(s===0?o:i),r.m_unitsM=Math.max(1,r.m_unitsM),r.snapPrecision();let l=0,u=0;r.m_precision!==0&&r.m_precision!==1||(u=2/r.m_unitsM,l=2/r.m_unitsXY),r.m_toleranceXY=Math.max(l,m),r.m_toleranceM=Math.max(o,u),ep(r,e)}function Xa(r,t,e,s){if(!s&&t<=0){if(r===3857)return Va();if(r===102100)return iu();if(r===4326)return qa()}let n=new sn,i,o=null;return Is()?(i=wC(r),t>0?o=null:t=0,n.setHorzProj_(i),n.m_vertcs=o):(i=ka(r),n.m_unit=i.isPCS?new Fs(i.metersOrRadiansPerUnit):new On(i.metersOrRadiansPerUnit)),Ya(n.m_precisionDescriptor,i,o,1),n.m_bDefaultDescriptor=!0,n.m_userWKID=r,n.calculateHashCode(),n.initDbgName(),n}function Pi(r,t,e){return an((r-t)*e)/e+t}var In=null,np=3552713678800501e-30;function QC(r,t,e){return r===t||Math.abs(r-t)<=e*(1+(Math.abs(r)+Math.abs(t))/2)}function It(r,t){return QC(r,t,np)}function KC(r,t){return r===0||Math.abs(r)<=t}function $C(r){return KC(r,np)}var ve,te,tt,pe,Hl,le,Si,zd,ts,Da,Ll;function Ni(r){return{_this:r,get(){return this._this},reset(t){this._this=t},release(){let t=this._this;return this._this=null,t}}}var Dn=null;function ka(r){w(Dn);let t=Dn(r);return t.semiMajor=t.isPCS?Number.NaN:rE(r),t}function JC(r){Dn=r,w(Dn)}function tE(r){let t=r;te=t.PeFactory,w(te),Ll=t.PeGCSExtent,w(Ll),ts=t.PeLineType,w(ts),Da=t.PeMath,w(Da),ve=t.PeDouble,w(ve),tt=t.PeDefs,w(tt),pe=t.PeCSTransformations,w(pe),Hl=t.PeGTTransformations,w(Hl),le=t.PePCSInfo,w(le),Si=t.PeGTlistExtended,w(Si),te.initialize(),zd=t.PeGTlistExtendedEntry,w(zd),tt.PE_TYPE_ANGUNIT=512,tt.PE_STR_AUTH_ALL=2,le.PE_POLE_LINE_STRAIGHT=2,le.PE_POLE_LINE_CURVED=3,tt.PE_PARM_LAM0=2,tt.PE_PARM_PHI0=6,tt.PE_PRJ_AZIMUTHAL_EQUIDISTANT=43032,tt.PE_PRJ_LAMBERT_AZIMUTHAL_EQAREA=43033,tt.PE_PRJ_ALBERS=43007,tt.PE_PRJ_CYLINDRICAL_EQAREA=43034,tt.PE_TYPE_VERTCS=8,tt.PE_LINETYPE_GEODESIC=0,tt.PE_LINETYPE_LOXODROME=1,tt.PE_LINETYPE_GREAT_ELLIPTIC=2,tt.PE_LINETYPE_NORMAL_SECTION=3,Si.PE_GTLIST_OPTS_USABLE=1,Dn=null}function eE(r,t,e,s){return t<=0?(e[0]=0,s[0]=0,!1):(e[0]=t,s[0]=t,!0)}function sE(r){return w(nu()),!!Dn(r).isPCS||nE(r)}function nE(r){return te&&re("pe has been loaded. no-pe methods should not be used at this point."),In||ip(),In.has(r)}var iE=/(?:ELLIPSOID|SPHEROID)\["(?:\w|[-()])+",(\d+\.\d+)/;function rE(r){if(te&&re("pe has been loaded. no-pe methods should not be used at this point."),typeof r=="string"){let t=r.match(iE);t&&t.length===2||U("bad gcs wkt");let e=Number.parseFloat(t[1]);return Number.isFinite(e)||U("bad gcs wkt"),e}return In||ip(),In.has(r)||re("gcs wkid not found"),In.get(r)}function ip(){In=new Map;for(let r in sa){let t=Number.parseFloat(r),e=sa[r];if(Array.isArray(e))for(let s of e)In.set(s,t);else In.set(e,t)}$f()}function oE(r,t){let e=te.geogtran(r);return e||Kr(r),new Ra(e,t)}function aE(r,t){let e=te.fromString(tt.PE_TYPE_GEOGTRAN,r);return e||Ua(r),new Ra(e,t)}function rp(r,t){return new Ra(r,t)}var Od=ps(0),Wd=ps(1),Ra=class Bl{constructor(t,e){if(t instanceof Bl)return this.m_geogTranWrapper=t.m_geogTranWrapper,this.m_bInverted=e?!t.m_bInverted:t.m_bInverted,void(this.m_hashCode=ne(this.m_geogTranWrapper.getHashCode(),this.m_bInverted?Wd:Od));this.m_geogTranWrapper=new Il(t),this.m_bInverted=e,this.m_hashCode=ne(this.m_geogTranWrapper.getHashCode(),this.m_bInverted?Wd:Od)}getID(){return this.m_geogTranWrapper.getLatestId()}getLatestID(){return this.m_geogTranWrapper.getLatestId()}getText(){return this.m_geogTranWrapper.getText()}getTextExtended(t){if(!this.m_geogTranWrapper.getGeogtran())return"";if(t===-1)return this.m_geogTranWrapper.getGeogtran().toString();{let e=t===0?tt.PE_STR_AUTH_TOP:tt.PE_STR_AUTH_ALL;return this.m_geogTranWrapper.getGeogtran().toString(e)}}getText2(t=-1){let e=tt.PE_STR_FMT_WKT2;return t!==-1&&(e|=t===0?tt.PE_STR_AUTH_TOP:tt.PE_STR_AUTH_ALL),this.m_geogTranWrapper.getGeogtran().toString(e)}getName(){return this.m_geogTranWrapper&&this.m_geogTranWrapper.getGeogtran()?this.m_geogTranWrapper.getGeogtran().getName():""}getInputSpatialReference(){return this.m_bInverted?this.m_geogTranWrapper.getOutputSr(!1):this.m_geogTranWrapper.getInputSr(!1)}getOutputSpatialReference(){return this.m_bInverted?this.m_geogTranWrapper.getInputSr(!1):this.m_geogTranWrapper.getOutputSr(!1)}getInverse(){return new Bl(this,!0)}isInverted(){return this.m_bInverted}getHashCode(){return this.m_hashCode}GetPeGeogtran(){return this.m_geogTranWrapper.getGeogtran()}equals(t){let e=t;return e===this||this.m_bInverted===e.m_bInverted&&(this.GetPeGeogtran()===e.GetPeGeogtran()||this.getID()===e.getID()&&!(this.getID()===0&&!this.GetPeGeogtran().isEqual(e.GetPeGeogtran())))}referencesMissingData(){return!!this.m_geogTranWrapper&&!this.m_geogTranWrapper.isUsable()}getWrapper(){return this.m_geogTranWrapper}};function op(r,t,e,s,n){let i=r.getGCS(),o=t.getGCS(),a=i.getPECoordSys(),h=o.getPECoordSys(),m=null;if(!e.isEmpty()){let g=e.clone();if(!g.isEmpty()&&r.getCoordinateSystemType()===2){let d=new Me({env2D:g}),_=Ei(r,i,null);d=new Ws().execute(d,_,null),d.queryEnvelope(g)}if(!g.isEmpty()){let d=a.getPrimem().getLongitude(),_=a.getUnit().getUnitFactor();m=new Ll(g.xmin,g.ymin,g.xmax,g.ymax,d,_)}}let l=s;l>=Pe()&&(l=0);let u=[],c=Si.PE_GTLIST_OPTS_COMMON;n||(c&=~Si.PE_GTLIST_OPTS_USABLE);for(let g=0;g<2;g++){u.length=0;let d=l,_=Si.getGTlist(a,h,2,c,m,d),p=!1;if(_&&_.length>0)for(let f=0,x=_.length;f<x;f++){let C=ap([_[f]]);if(w(C),n&&C.referencesMissingData())p=!0;else if(u.push(C),s>0&&u.length===s)break}if(!p)break;l===0||(l=0)}return m&&m.destroy(),u}function ap(r){w(r!==null);let t=new zr,e=r[0].getSteps();if(e){let s=r[0].getEntries();for(let n=0;n<e;n++){let i=s[n].getDirection()!==0,o=rp(s[n].getGeogtran(),i);t.add(o)}return t.create()}return null}var hp=class{constructor(r,t,e,s){this.m_bReadOnly=!0,this.m_name="",this.m_fastTrack=-1,this.m_bNameIsSet=!1,this.m_transforms=r,t&&(this.m_name=t,this.m_bNameIsSet=!0),this.m_inputSr=e,this.m_outputSr=s}getType(){return 0}getName(){if(this.m_bNameIsSet)return this.m_name;if(this.m_transforms.length===0)return"";let r="";for(let t of this.m_transforms)r.length>0&&(r+=" + "),t.isInverted()&&(r+="~"),r+=t.getName();return r}count(){return this.m_transforms.length}createInverse(){return this.getInverse()}getHashCode(){let r=1973;for(let t=0;t<this.m_transforms.length;t++)r=ne(r,this.m_transforms[t].getHashCode());return r}equals(r){return w(0),!1}referencesMissingData(){if(this.m_transforms.length===0)return!1;for(let r of this.m_transforms)if(r.referencesMissingData())return!0;return!1}isMatchingTransformation(r,t){return w(0),!1}validateTransformation(r,t){return w(0),!1}nameIsSet(){return w(0),!1}getInputSpatialReference(){return this.m_inputSr}getOutputSpatialReference(){return this.m_outputSr}getStep(r){return(r<0||r>this.count())&&xt(""),this.m_transforms[r]}getInverse(){let r=new zr;return r.addSteps(this,!0),r.setInputSpatialReference(this.m_outputSr),r.setOutputSpatialReference(this.m_inputSr),r.create()}transform(r,t,e){if(this.count()===0)return;let s=this.m_inputSr,n=this.m_outputSr;if(r&&(n=O(s,s=n)),this.m_transforms.length===0)return void M_(s,null,n,null,t,null,e);let i=this.m_fastTrack;if(i===1)return void jc(r,this.m_transforms,u=>{IP(u.getWrapper(),r!==u.isInverted(),t,null,e)});let o=Gs();i===-1&&o.initFromGcsAndVcs(s,null);let a=Gs(),h=r?this.m_transforms.length-1:0,m=r?-1:1;for(let u=0,c=this.m_transforms.length;u<c;u++,h+=m){if(u===0){let d=this.m_transforms[h];CP(s.getPECoordSys(),null,d.getWrapper(),r!==d.isInverted(),t,null,e,a),i===-1&&(o.equals(a)||(i=0)),o.assign(a)}else{let d=this.m_transforms[h-m],_=this.m_transforms[h];SP(o,d.getWrapper(),r!==d.isInverted(),_.getWrapper(),r!==_.isInverted(),t,null,e,a),i===-1&&(o.equals(a)||(i=0)),o.assign(a)}let g=this.m_transforms[h];vP(o,g.getWrapper(),r!==g.isInverted(),t,null,e,a),o.assign(a)}let l=this.m_transforms[h-m];EP(o,l.getWrapper(),r!==l.isInverted(),n,null,t,null,e),i===-1&&(a.initFromGcsAndVcs(n,null),o.equals(a)||(i=0)),this.m_fastTrack=i===0?0:1}},zr=class{constructor(){this.m_transforms=[],this.m_inputGCS=null,this.m_outputGCS=null,this.m_name="",this.m_bNameIsSet=!1}getInputSpatialReference(){return this.m_inputGCS!==null?this.m_inputGCS:this.count()>0?this.m_transforms[0].getInputSpatialReference():null}setInputSpatialReference(t){this.m_inputGCS=t?t.getGCS():null}getOutputSpatialReference(){return this.m_outputGCS!==null?this.m_outputGCS:this.count()>0?this.m_transforms.at(-1).getOutputSpatialReference():null}setOutputSpatialReference(t){this.m_outputGCS=t?t.getGCS():null}getName(){if(this.m_bNameIsSet)return this.m_name;if(this.m_transforms.length===0)return"";let t="";for(let e of this.m_transforms)t.length>0&&(t+=" + "),e.isInverted()&&(t+="~"),t+=e.getName();return t}count(){return this.m_transforms.length}getStep(t){return(t<0||t>this.count())&&xt(""),this.m_transforms[t]}setStep(t,e){w(0)}add(t){this.m_transforms.push(t)}addSteps(t,e){if(e)for(let s=t.count()-1;s>=0;--s)this.add(t.getStep(s).getInverse());else for(let s=0;s<t.count();++s)this.add(t.getStep(s))}clear(){this.m_transforms=[],this.m_name="",this.m_bNameIsSet=!1,this.m_inputGCS=null,this.m_outputGCS=null}remove(t){w(0)}create(){let t=this.getInputSpatialReference(),e=this.getOutputSpatialReference(),s=new hp(this.m_transforms,this.m_bNameIsSet?this.m_name:null,t,e);return s.m_bReadOnly=!0,this.clear(),s}},cS=Object.freeze(Object.defineProperty({__proto__:null,SpatialReference:sn,SpatialReferencePrecisionDescriptor:tn,create:kl,createFromWKT:K_,createImplFromPe:Ur,createLocal:UC,createWithNewPrecision:$_,createWithNewVCS:Rl,getGCS:Jo,getTempName:ZC,hasNoPe:nu,hasPe:Is,injectNoPe:LC,injectPe:HC,isInitialized:Fa,isTempName:tp,isValidWkid:OC,isValidWkt:WC,makeSpheroidData:Ti,snapGeometry:zC,webMercator:Va,webMercator102100:iu,wgs84:qa},Symbol.toStringTag,{value:"Module"})),gS=Object.freeze(Object.defineProperty({__proto__:null,OperatorProject:Ws},Symbol.toStringTag,{value:"Module"})),dS=Object.freeze(Object.defineProperty({__proto__:null,CompositeGeographicTransformation:hp,CompositeGeographicTransformationEditor:zr,createImpl:ap,queryGtListImpl:op},Symbol.toStringTag,{value:"Module"})),_S=Object.freeze(Object.defineProperty({__proto__:null,GeographicTransformation:Ra,create:oE,createFromPe:rp,createFromWKT:aE},Symbol.toStringTag,{value:"Module"})),pS=Object.freeze(Object.defineProperty({__proto__:null,ProjectionTransformation:tu,create:SC,createEx:Ei,createFromAoi:U_,createImplEx:z_,makeExtendedParams:W_,makeExtendedParamsInternal:j_,queryTransformationList:O_},Symbol.toStringTag,{value:"Module"}));export{lp as a,dE as b,_E as c,pE as d,Lt as e,Co as f,Kc as g,fE as h,Cs as i,xn as j,Yn as k,hi as l,Ge as m,xg as n,No as o,dt as p,Es as q,Em as r,je as s,xE as t,pf as u,lt as v,Mg as w,yE as x,Sr as y,bf as z,Gf as A,Vg as B,yo as C,v as D,Yt as E,Nt as F,PE as G,CE as H,EE as I,Go as J,nt as K,et as L,St as M,Js as N,Bs as O,ta as P,jE as Q,jd as R,ie as S,Vr as T,Lg as U,ZE as V,Ho as W,QE as X,KE as Y,g1 as Z,ia as _,As as $,Jt as aa,$E as ba,vn as ca,vs as da,F1 as ea,Sn as fa,Ue as ga,E_ as ha,JE as ia,Ss as ja,tS as ka,_y as la,us as ma,zs as na,Os as oa,Be as pa,Us as qa,eS as ra,sS as sa,nS as ta,cl as ua,iS as va,Ye as wa,rS as xa,qy as ya,Yy as za,Ms as Aa,wn as Ba,w_ as Ca,Ws as Da,wd as Ea,Qy as Fa,oS as Ga,Dd as Ha,Ky as Ia,$y as Ja,aS as Ka,rP as La,Sl as Ma,hS as Na,Pa as Oa,bP as Pa,G_ as Qa,bl as Ra,kr as Sa,Rr as Ta,Ea as Ua,Xd as Va,km as Wa,Hr as Xa,jr as Ya,va as Za,Rm as _a,mS as $a,Ql as ab,lS as bb,uS as cb,Kl as db,wi as eb,Al as fb,Ei as gb,z_ as hb,W_ as ib,j_ as jb,Ti as kb,LC as lb,Is as mb,kl as nb,K_ as ob,$_ as pb,UC as qb,zC as rb,OC as sb,WC as tb,ZC as ub,tn as vb,It as wb,ve as xb,te as yb,tt as zb,pe as Ab,ts as Bb,Da as Cb,cS as Db,gS as Eb,dS as Fb,_S as Gb,pS as Hb};
