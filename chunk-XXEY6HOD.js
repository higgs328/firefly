import{a as ye}from"./chunk-KJEG6KH2.js";import{b as we}from"./chunk-26PJXQHD.js";import{a as Ee}from"./chunk-HQEATBCR.js";import{a as Me}from"./chunk-UTNE4PNN.js";import{a as ve}from"./chunk-PQB6SORE.js";import{a as ge}from"./chunk-3YHPJJNR.js";import{b as Z,c as pe,d as de}from"./chunk-5C57S7IZ.js";import{a as ie}from"./chunk-XC2P3GQB.js";import{g as he}from"./chunk-XIZXEWWA.js";import{d as fe,h as ue}from"./chunk-DJW5LMRG.js";import{a as q}from"./chunk-DEH76MSI.js";import{a as G,c as me}from"./chunk-ALWV3RJ2.js";import{G as U,d as W}from"./chunk-6B5XFA6F.js";import{p as L}from"./chunk-DA3SDKGO.js";import{e as le}from"./chunk-PTZYZULI.js";import{H as ne,e as Y}from"./chunk-ZTOZWLEE.js";import{f as d}from"./chunk-BOVYXYHK.js";import{a as ce}from"./chunk-DZFUQCB6.js";import{a as se}from"./chunk-V2JYXY4D.js";import{e as oe}from"./chunk-KVM6SHDX.js";import{a as $}from"./chunk-HX2VGIR2.js";import{i as h,j as F}from"./chunk-EQZWYK27.js";import{c as D}from"./chunk-VIEK2X23.js";import{a as re}from"./chunk-7F5DJLJT.js";import{m as ae}from"./chunk-NJWTSROP.js";import{a as te}from"./chunk-ARRCN5K3.js";import{o as ee}from"./chunk-AUAZP44J.js";import{f as Q}from"./chunk-CCJU4DSH.js";import{O as H,y as _}from"./chunk-4PTIEWMT.js";import{b as S}from"./chunk-YOFFGXOB.js";import{g as b}from"./chunk-XRGPJ3QY.js";import{a as T,b as A,f as m}from"./chunk-VTHXE323.js";var j=[21,36,51,60],it=3.5,ot=["FAR_WEST","FAR_NORTH","FAR_EAST","FAR_SOUTH","WEST","NORTH","EAST","SOUTH","NEAR_WEST","NEAR_NORTH","NEAR_EAST","NEAR_SOUTH"],M=23.937554159486076,w=96.06244584051393,nt={EAST:[M,M,w,M,60,M],NORTH:[M,w,M,M,M,60],SOUTH:[w,M,w,w,w,60],WEST:[w,w,M,w,60,w]},st=-999,ct=100,lt=()=>["after-data-capture-complete","deselect-data-capture-features","select-data-capture-features"],ft="ImageGeometry",ut="OIObjectId";function gt(e){return e?.type==="3d"}function vt(e){return e?.declaredClass==="esri.Graphic"}function Mt(e){return/(tiff|tif|mrf)$/i.test(e??"")}function wt(e){if(!e||!URL.canParse(e))return!1;let{pathname:t}=new URL(e);return/.*\.(tiff|tif|mrf)$/i.test(t??"")}function yt(e){return Math.abs(e)>=135?"WEST":e<-45&&e>-135?"SOUTH":e<=45?"EAST":"NORTH"}function Et(e,t){let a=e/t*j[2];return a<=j[0]?"NEAR":a<=j[1]?"":"FAR"}function Pe(e){return e&&e.url&&e.datasetFormat?e:null}function xt(e){return typeof e=="string"&&e.length?e:Pe(e)}var Ot=e=>t=>t.layer===e;function St(e){return e?.name==="NoAttachmentError"}var Tt=e=>`${e}:missing-property`,At=(e,t)=>`Property ${t} is missing in ${e}`,X=(e="esri.widgets.OrientedImageryViewer",t)=>{throw b.getLogger(e).error(t),t},Rt=(e,t)=>m(void 0,null,function*(){let a=yield ee(e,A(T({},t),{method:"head"})),r=a?.getHeader?.("Content-Type");if(r)return r.split("/")[1]});function Bt(e,t,a){return m(this,null,function*(){if(!t.extent||!t.url)throw X("esri.layer.orientedImagery.transformations",new S("update-elevation:missing-property","both extent and url are required to create a sampler",t));let r=yield B(t);if(!r)throw X("esri.layers.orientedImagery.transformations",new S("update-elevation:elevation-source","could not create a sampler using provided elevation source",t));return be(e,r,a)})}function be(e,t,a){return m(this,null,function*(){yield H(a);let r=Ve(t,a),o=Array.isArray(e)?e:[e];return yield Promise.all(o.map(r))})}var R;(function(e){e[e.DYNAMIC=0]="DYNAMIC",e[e.ELEVATION=1]="ELEVATION",e[e.IMAGE=2]="IMAGE"})(R||(R={}));var B=(e,t)=>m(void 0,null,function*(){let a,{extent:r,rasterFunction:o,url:i,lod:s}=e;try{a=yield Ce(i)}catch(n){if(_(n))return;b.getLogger("esri.layers.orientedImagery.transformations").error("updateElevationUsingElevationSource",n)}switch(a){case R.DYNAMIC:return yield Ne(i,r,o,t);case R.ELEVATION:return yield Le(i,r,s,t);default:return}});function Le(e,t,a,r){return m(this,null,function*(){let o=new Ee(e),i;try{let{tileInfo:s}=yield o.load(),n=(a&&s.lodAt(Math.min(s.lods.length-1,a))?.resolution)??"finest-contiguous";i=yield o.createElevationSampler(t,A(T({},r),{demResolution:n}))}catch(s){if(_(s))return;b.getLogger(o).error(s)}finally{o.destroy()}return i})}function Ne(e,t,a,r){return m(this,null,function*(){let o=a?new ge({functionName:a}):void 0,i=new ve({url:e,rasterFunction:o,format:"lerc"});yield i.load(r);let s,n=512,c=512,l=t.width/t.height;l>1?(c/=l,s=t.height/c):(n*=l,s=t.width/n);let u=yield i.fetchImage(t,n,c,r),f=ce.create({scales:[s],size:512,spatialReference:t.spatialReference}),y=new se(null,0,0,0,oe(t)),g=new Me(u.pixelData.pixelBlock.pixels[0],n,c,0),p=new ye(y,g);return new we(p,f,void 0)})}function Ce(e,t){return m(this,null,function*(){yield H(t);let a=yield ie(e),{tileInfo:r,cacheType:o}=a;if(!a.hasOwnProperty("bandCount")||!a.hasOwnProperty("pixelSizeX"))throw new S("elevation-source:invalid-service-url",`ElevationSource URL expects an elevation 3D image service but given ${e}`);return r?r?.format?.toUpperCase()!=="LERC"||o&&o.toLowerCase()!=="elevation"?R.IMAGE:R.ELEVATION:R.DYNAMIC})}function Ve(e,t){return a=>m(this,null,function*(){let r=a.clone(),o=a.spatialReference.equals(e.spatialReference)?r:yield L(a,e.spatialReference,t),i=e.queryElevation(o);return i&&(r=a.spatialReference.equals(e.spatialReference)?i.clone():yield L(i,a.spatialReference,t)),r.z=r.z??1,r})}function Jt(e,t,a){return m(this,null,function*(){return yield H(a),e.map(r=>(r.z=t,r))})}var ra=new D({x:0,y:0,z:0,spatialReference:re.WebMercator}),K=1e3,ia=114,oa=120,na=50;function ze(e,t,a){let[r,o,i,s]=t,[n,c,l,u]=a;xe(r,o,i,s);let f=xe(n,c,l,u),y=Oe(r,o,i,s),g=Oe(n,c,l,u),p=Y(G(),y),E=ne(G(),p,g),[x,v,I,O]=De(e,E);return[x/O,v/O,f?0:I/O]}function xe(e,t,a,r){return e[2]===0&&t[2]===0&&a[2]===0&&r[2]===0&&(e[2]=t[2]=a[2]=r[2]=1,!0)}function He(e){return e===0?1:e}function De(e,t){let[a,r,o]=e,i=[0,0,0,0];return i[0]=a*t[0]+r*t[1]+o*t[2]+t[3],i[1]=a*t[4]+r*t[5]+o*t[6]+t[7],i[2]=a*t[8]+r*t[9]+o*t[10]+t[11],i[3]=He(a*t[12]+r*t[13]+o*t[14]+t[15]),i}function Oe(e,t,a,r){let o=Ue(le([...r,1]),Y(new Array(16),me(e[0],t[0],a[0],0,e[1],t[1],a[1],0,e[2],t[2],a[2],0,1,1,1,1))),i=o[0],s=o[1],n=o[2],c=G();return c[0]=i*e[0],c[1]=s*t[0],c[2]=n*a[0],c[3]=0,c[4]=i*e[1],c[5]=s*t[1],c[6]=n*a[1],c[7]=0,c[8]=i*e[2],c[9]=s*t[2],c[10]=n*a[2],c[11]=0,c[12]=i,c[13]=s,c[14]=n,c[15]=1,c}function We(e,t,a,r,o=d()){return o[0]=e[0]+t[0]*a,o[1]=e[1]+t[1]*a,o[2]=e[2]+t[2]*(a/r),o}function Se(e,t,a){let r=d();return r[0]=e[0]*t,r[1]=e[1]*t,r[2]=e[2]*(t/a),r}function J(e,t){let[a,r,o]=e,i=d();return i[0]=a*t[0]+r*t[3]+o*t[6],i[1]=a*t[1]+r*t[4]+o*t[7],i[2]=a*t[2]+r*t[5]+o*t[8],i}function Ue(e,t){let[a,r,o,i]=e,s=new Array(4);return s[0]=a*t[0]+r*t[1]+o*t[2]+i*t[3],s[1]=a*t[4]+r*t[5]+o*t[6]+i*t[7],s[2]=a*t[8]+r*t[9]+o*t[10]+i*t[11],s[3]=a*t[12]+r*t[13]+o*t[14]+i*t[15],s}function qe(e,t,a,r=!0){if(!Number.isFinite(e))throw new S("InvalidRotationAngle","Please specify a valid angle for rotation");let o=a*(r?h(e):e),i=Math.cos(o),s=Math.sin(o),n=q();switch(t){case 0:n[4]=i,n[5]=-s,n[7]=s,n[8]=i;break;case 1:n[0]=i,n[2]=s,n[6]=-s,n[8]=i;break;case 2:n[0]=i,n[1]=-s,n[3]=s,n[4]=i;break;default:throw new S("InvalidRotationAxis","Please specify either 0, 1 or 2 for X, Y or Z axis respectively")}return n}var Ie={HPR:[[2,-1],[0,1],[2,-1]],OPK:[[0,1],[1,1],[2,1]]};function Fe(e,t,a=!0){if(e?.length!==3||t?.length!==3)throw new S("InvalidRotationAngles","Please specify three angles with config for rotation");let r=q();for(let o=0;o<3;o++){let[i,s]=t[o],n=qe(e[o],i,s,a);ue(r,n,r)}return r}function Ge(e,t=!0){return Fe(e,Ie.OPK,t)}function Te(e,t=!0){return Fe(e,Ie.HPR,t)}function Ra(e,t,a){let r=Math.sin(h(a)),o=Math.cos(h(a)),i=[[e,0],[e,t],[0,t]];i.forEach((n,c)=>{i[c]=[o*n[0]-r*n[1],r*n[0]+o*n[1]]});let s={xmin:Math.min(0,i[0][0],i[1][0],i[2][0]),xmax:Math.max(0,i[0][0],i[1][0],i[2][0]),ymin:Math.min(0,i[0][1],i[1][1],i[2][1]),ymax:Math.max(0,i[0][1],i[1][1],i[2][1])};return{hfov:Math.abs(s.xmax-s.xmin),vfov:Math.abs(s.ymax-s.ymin)}}function Ia(e,t){let a=Number(e[0]),r=Number(e[1]),o=Number(e[2]),[i,s,n,c]=t,l=h(i),u=h(s),f=n/Math.sqrt(1-c*Math.sin(l)**2),y=a/f,g=r/f,p=o/f,E=Math.cos(l)-Math.sin(l)*g+Math.cos(l)*p,x=Math.sin(l)+Math.cos(l)*g+Math.sin(l)*p,v=Math.sqrt(E**2+y**2),I=c*f*Math.sin(l),O=(C,V=5)=>{if(V===0)return C;let z=O(C,V-1);return Math.atan(x/v-(I-c*(n/Math.sqrt(1-c*Math.sin(z)**2))*Math.sin(z))/(f*v))},P=O(l),N=Math.atan(a/(f*E))+u,k=F(P);return[F(N),k,a/(Math.cos(P)*Math.sin(N-u))-n/Math.sqrt(1-c*Math.sin(P)**2)]}function je(e,t,a){let r=360/t,o=180/a;return{heading:(e.x-t/2)*r,pitch:90-(e.y-a/2)*o}}function Ke(e,t,a,r=K/2){let{heading:o,pitch:i}=_e(e,r);return ke(o,i,t,a)}function ke(e,t,a,r){return{x:a/2+e/(360/a),y:r-t/(180/r),heading:e,pitch:t}}function _e(e,t){let a=F(Math.acos(-e.z/t));return{heading:F(Math.atan2(e.x,e.y)),pitch:a}}function Ye(e,t,a=K/2){return[a*(Math.sin(h(e))*Math.sin(h(t))),a*(Math.cos(h(e))*Math.sin(h(t))),a*Math.cos(h(180-t))]}function Fa(e,t,a,r=K/2){let{heading:o,pitch:i}=je(e,t,a);return Ye(o,i,r)}function Pa(e,t,a){return m(this,null,function*(){let r=yield L(t,e.spatialReference,a),o=F(Math.atan2(r.y-e.y,r.x-e.x));return o=o>=0&&o<=90?90-o:o>90&&o<=180?360-o+90:90+Math.abs(o),o})}function ba(e,t,a){let r=Math.cos(a),o=Math.sin(a),i=[1,0,0,1,0,0],s=i[0]*r+i[2]*o,n=i[1]*r+i[3]*o,c=-i[0]*o+i[2]*r,l=-i[1]*o+i[3]*r;return i[0]=s,i[1]=n,i[2]=c,i[3]=l,[e*i[0]+t*i[2]+i[4],e*i[1]+t*i[3]+i[5]]}var La=e=>e.toArray(),Ae=(...e)=>e.some(t=>t);function Na(e,t){if(Ae(e.length===0,e.some(({x:a,y:r})=>Ae(a==null,r==null)),!t.hasZ))throw new Error("Input pixels must have x, y and camera location must have z value")}function Ca(e,t){if(e.some(a=>a.z==null)||t.z==null)throw new Error("Input points and camera location must have z value")}function Va(e){if(e?.length!==9)throw new Error("Rotation matrix is not provided or is not a valid 3x3 matrix")}function za(e,t){return ae(t)?1/Math.cos(Math.PI/2-2*Math.atan(Math.exp(-1*e/te.radius))):1}var Ha=e=>t=>new D(t,e),Da=e=>e!=null&&"queryExtent"in e;function Wa(e,t,a,r){return[[-t,-t],[+t,-t],[+t,+t],[-t,+t]].map(([o,i])=>ze(he(d(),a,[o,i,0]),r,e))}function $e({a0:e,a1:t,a2:a,b0:r,b1:o,b2:i},s,n,c){let l=[e??s/2-.5,t,a??0,r??n/2-.5,o??0,i].map(Ze);return c!=null&&Xe(l)?{affines:l,focalLength:c}:{affines:[s/2-.5,1,0,n/2-.5,0,-1]}}function Ze(e,t){if(e==null)return null;let a=parseFloat(`${e}`);return isNaN(a)?null:a}function Xe(e){return e[1]!=null&&e[5]!=null}function Ua(e,t,a){let{cameraHeight:r,cameraPitch:o,cameraRoll:i,elevation:s,farDistance:n,horizontalFieldOfView:c,location:l,verticalFieldOfView:u}=e,f=s??(l.z??0)-r;return A(T({},Je(e,t,a)),{averageElevation:f,cameraPitch:o,cameraRoll:i??0,farDistance:n,horizontalFieldOfView:c,verticalFieldOfView:u})}function Be(e,t,a,r){return at(r)?Ge([r.omega,r.phi,r.kappa]):rt(r)?Te([r.heading,r.pitch,r.roll]):Te([e,t,a??0])}function qa(e,t,a){let{cameraHeading:r,cameraHeight:o,elevation:i,farDistance:s,horizontalFieldOfView:n,location:c,verticalFieldOfView:l}=e;return{averageElevation:i??(c.z??0)-o,cameraLocation:c,cameraHeading:r,farDistance:s,horizontalFieldOfView:n,imageHeight:a,imageWidth:t,verticalFieldOfView:l}}function Je(e,t,a){let{a0:r,a1:o,a2:i,b0:s,b1:n,b2:c,cameraHeading:l,cameraOrientation:u,cameraPitch:f,cameraRoll:y,focalLength:g,horizontalFieldOfView:p,location:E,matrix:x,principalX:v,principalY:I,radial:O,tangential:P,verticalFieldOfView:N}=e,{affines:k,focalLength:C}=$e({a0:r,a1:o,a2:i,b0:s,b1:n,b2:c},t,a,g),V=x??Be(l,f,y,u),z=v!=null&&I!=null?[v,I]:void 0;return{affineTransformations:u?.affineTransformations??k,cameraLocation:E.clone(),focalLength:u?.focalLength??C,horizontalFieldOfView:p,imageHeight:a,imageWidth:t,principalOffsetPoint:u?.principalOffsetPoint??z,radialDistortionCoefficients:u?.radialDistortionCoefficients??O,rotationMatrix:V,tangentialDistortionCoefficients:u?.tangentialDistortionCoefficients??P,verticalFieldOfView:N}}var Qe=e=>e!=null&&"elevationSample"in e&&e.elevationSample!=null,et=e=>de(e?.elevationSource)&&e?.extent!=null,tt=e=>pe(e?.elevationSource),Ga=(e,t)=>m(void 0,null,function*(){return t!=null&&(Qe(t)||tt(t))?t:et(t)?{elevationSample:yield B(A(T({},Q.isSerializable(t.elevationSource)?t.elevationSource.toJSON():t.elevationSource),{extent:t.extent})),elevationSource:new Z({constantElevation:e})}:{elevationSource:new Z({constantElevation:e})}}),ja=e=>$(e?.heading)&&$(e?.pitch),Ka=(e,t)=>[[-e,-t],[e,-t],[e,t],[-e,t]];function ka(e){let{cameraLocation:t,farDistance:a,horizontalFieldOfView:r,rotationMatrix:o,scalingFactor:i,verticalFieldOfView:s}=e,n=q();fe(n,o);let c=2*Math.tan(h(s)/2)*a*i,l=2*Math.tan(h(r)/2)*a*i,u=J([0,0,-1],n),f=We([t.x,t.y,t.z],u,e.farDistance*i,i),y=J([0,1,0],n),g=J([1,0,0],n),p=Se(y,c/2,i),E=Se(g,l/2,i),x=U(d(),p,E),v=W(d(),p,E);return[W(d(),f,x),W(d(),f,v),U(d(),f,x),U(d(),f,v)]}var at=e=>e?.type===2,rt=e=>e?.type===1;function _a(e){let t=e%360;return t<-180?t+360:t}function Ya(e,t,a){if(e==="panoramic"){let[r,o]=a;return Ke({x:t.x,y:t.y,z:t.z},r,o)}return{x:t.x+.5,y:.5-t.y}}var Re;(function(e){e[e.CLOCKWISE=-1]="CLOCKWISE",e[e.COUNTERCLOCKWISE=1]="COUNTERCLOCKWISE"})(Re||(Re={}));export{j as a,it as b,ot as c,nt as d,st as e,ct as f,lt as g,ft as h,ut as i,gt as j,vt as k,Mt as l,wt as m,yt as n,Et as o,xt as p,Ot as q,St as r,Tt as s,At as t,X as u,Rt as v,Bt as w,be as x,B as y,Jt as z,ra as A,K as B,ia as C,oa as D,na as E,ze as F,We as G,Se as H,J as I,Te as J,Ra as K,Ia as L,je as M,Ke as N,ke as O,Ye as P,Fa as Q,Pa as R,ba as S,La as T,Ae as U,Na as V,Ca as W,Va as X,za as Y,Ha as Z,Da as _,Wa as $,Ua as aa,qa as ba,Je as ca,Qe as da,et as ea,Ga as fa,ja as ga,Ka as ha,ka as ia,_a as ja,Ya as ka};
