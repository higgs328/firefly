import{h as d}from"./chunk-IHATPE6U.js";import{a as m}from"./chunk-K75TK42V.js";import{a as s,e as c}from"./chunk-TG45K3WR.js";import{a as i}from"./chunk-QGVBCWUY.js";import{H as p}from"./chunk-MYO4NP2N.js";import{e as r}from"./chunk-NFIPKH6V.js";import{l as h}from"./chunk-5QEXLALV.js";import{y as n}from"./chunk-4PTIEWMT.js";var e=class extends m.IdentifiableMixin(p){constructor(t){super(t),this.compatibilityFunction=null,this.error=null,this.state="loading",this.view=null}initialize(){let t=()=>this.refresh();this.addHandles([s(()=>this.basemap?.loadStatus,t),s(()=>this.compatibilityFunction,t),s(()=>this.view&&"basemapTerrain"in this.view&&this.view.basemapTerrain?.tilingScheme,t),s(()=>this.view?.ready,t),s(()=>this.view?.spatialReference,t)]),this.refresh()}destroy(){this._cancelRefresh(),this.basemap=null,this.compatibilityFunction=null,this.view=null}get _spatialReferenceTask(){return d(this.view,this.basemap)}set basemap(t){t&&t.load().catch(()=>{}),this._set("basemap",t)}get spatialReference(){return this._spatialReferenceTask.spatialReference}refresh(){this._cancelRefresh(),this._set("state","loading");let t=this.basemap?.loadStatus;if(t!=="loaded"&&t!=="failed")return;if(!this.compatibilityFunction)return void(t==="loaded"?(this._set("state","ready"),this._set("error",null)):(this._set("state","error"),this._set("error",this.basemap.loadError)));let a=new AbortController,{signal:o}=a;this.compatibilityFunction(this,{signal:o}).then(()=>c(()=>!this._spatialReferenceTask.updating,o)).then(()=>{this._set("state","ready"),this._set("error",null)}).catch(l=>{n(l)||(this._set("state","error"),this._set("error",l))}),this._refreshController=a}_cancelRefresh(){this._refreshController&&(this._refreshController.abort(),this._refreshController=null)}};i([r({readOnly:!0})],e.prototype,"_spatialReferenceTask",null),i([r()],e.prototype,"basemap",null),i([r()],e.prototype,"compatibilityFunction",void 0),i([r({readOnly:!0})],e.prototype,"error",void 0),i([r({readOnly:!0})],e.prototype,"spatialReference",null),i([r({readOnly:!0})],e.prototype,"state",void 0),i([r()],e.prototype,"view",void 0),e=i([h("esri.widgets.BasemapGallery.support.BasemapGalleryItem")],e);var C=e;export{C as a};
