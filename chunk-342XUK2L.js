import{a as C}from"./chunk-JYWKUDYY.js";import{a as V,b}from"./chunk-5LQBOUN5.js";import{a as L,b as x}from"./chunk-SQ44NQCH.js";import{a as F}from"./chunk-FHBFWDFD.js";import{a as E}from"./chunk-AXYQJCCX.js";import{a as n}from"./chunk-5XCFNEYX.js";import{a as D}from"./chunk-GQL2MBZT.js";import{b as $}from"./chunk-EBIFNV2H.js";import{o as G}from"./chunk-FB4M3WPV.js";import{a as I}from"./chunk-TG45K3WR.js";import{f as S}from"./chunk-RAI4DTMT.js";import{a as t}from"./chunk-QGVBCWUY.js";import{B as O,H as B}from"./chunk-MYO4NP2N.js";import{e as i}from"./chunk-NFIPKH6V.js";import{l as _}from"./chunk-5QEXLALV.js";import{b as w}from"./chunk-4PTIEWMT.js";import{y as u}from"./chunk-QBWJMFH5.js";import{c as M,f as v}from"./chunk-VTHXE323.js";var p=class extends B{constructor(e){super(e),this.enabledToggle=!0,this.featureEnabledToggle=!0,this.gridEnabledToggle=!0,this.header=!1,this.layerList=!0,this.gridControls=!0,this.gridControlsElements=new C({gridSnapEnabledToggle:!1,gridEnabledToggle:!1}),this.layerListToggleLayersButton=!0,this.selfEnabledToggle=!0}};t([i({type:Boolean,nonNullable:!0})],p.prototype,"enabledToggle",void 0),t([i({type:Boolean,nonNullable:!0})],p.prototype,"featureEnabledToggle",void 0),t([i({type:Boolean,nonNullable:!0})],p.prototype,"gridEnabledToggle",void 0),t([i({type:Boolean,nonNullable:!0})],p.prototype,"header",void 0),t([i({type:Boolean,nonNullable:!0})],p.prototype,"layerList",void 0),t([i({type:Boolean,nonNullable:!0})],p.prototype,"gridControls",void 0),t([i({type:C,nonNullable:!0})],p.prototype,"gridControlsElements",void 0),t([i({type:Boolean,nonNullable:!0})],p.prototype,"layerListToggleLayersButton",void 0),t([i({type:Boolean,nonNullable:!0})],p.prototype,"selfEnabledToggle",void 0),p=t([_("esri.widgets.support.SnappingControls.VisibleElements")],p);var T=p;var g="esri-snapping-controls",h={base:g,container:`${g}__container`,item:`${g}__item`,toggleBlock:`${g}__toggle-block`,layerListBlock:`${g}__layer-list-block`,layerList:`${g}__layer-list`,layerListFilter:`${g}__layer-list__filter`,layerListButton:`${g}__layer-list__button`,layerListItem:`${g}__layer-list__item`,layerListGroup:`${g}__layer-list__group`,nestedContainer:`${g}__nested-container`},a=class extends D{constructor(e,s){super(e,s),this._defaultViewModel=null,this._layerListFilter=null,this._gridLoadTask=null,this.layerListOpen=!0,this.gridOptionsOpen=!1,this.messages=null,this.messagesCommon=null,this.snappingManager=null,this.visibleElements=new T,this._enableSnappingSwitchChange=o=>{this.snappingOptions.enabled=o},this._featureEnabledSwitchChange=o=>{this.snappingOptions.featureEnabled=o},this._gridEnabledSwitchChange=o=>{this.snappingOptions.gridEnabled=o,o&&this._startLoadGrid()},this._selfEnabledSwitchChange=o=>{this.snappingOptions.selfEnabled=o},this._onToggleLayersButtonClick=o=>{this.viewModel.toggleSnappingForAllLayers(!this.viewModel.allLayersEnabled),G(o.target)};let{snappingOptions:l,view:r,viewModel:d}=e;this.viewModel=d??(this._defaultViewModel=new x({snappingOptions:l,view:r}))}normalizeCtorArgs(e){let o=e,{snappingOptions:s,view:l,viewModel:r}=o;return M(o,["snappingOptions","view","viewModel"])}destroy(){this.viewModel!==this._defaultViewModel&&(this._defaultViewModel=w(this._defaultViewModel))}loadDependencies(){return Promise.all([$({block:()=>import("./chunk-LVVNNI43.js"),button:()=>import("./chunk-K3RCADAN.js"),input:()=>import("./chunk-SS6GQCI6.js"),list:()=>import("./chunk-4MPCQ5DO.js"),"list-item":()=>import("./chunk-MRM6JRFU.js"),checkbox:()=>import("./chunk-NV4IBMC5.js"),loader:()=>import("./chunk-4Z3TWS6O.js")}),V()])}initialize(){this.addHandles(I(()=>this.view?.type==="2d"&&!!this.view.grid,e=>{this.visibleElements.gridControls&&(this.snappingOptions.gridEnabled=e)}))}get _openAndReady(){return this.gridOptionsOpen&&this.snappingOptions.gridEnabled&&this.snappingOptions.enabled}get icon(){return"snap-to-point"}set icon(e){this._overrideIfSome("icon",e)}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get snappingOptions(){return this.viewModel.snappingOptions}set snappingOptions(e){this.viewModel.snappingOptions=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}set viewModel(e){e!==this._get("viewModel")&&(this._defaultViewModel!=null&&this._defaultViewModel===e||(this._defaultViewModel=w(this._defaultViewModel)),this._set("viewModel",e))}render(){let{label:e}=this;return n("div",{"aria-label":e,class:this.classes(h.base,F.widget)},n("div",{class:h.container},this._renderContent()))}_renderContent(){return[this._renderToggles(),this._renderLayerList(),this.view?.type==="2d"&&this.visibleElements.gridControls?this._renderGridOptions():null]}_renderToggles(){let{visibleElements:e,view:s}=this,l=[e.selfEnabledToggle?this._renderSelfEnabledToggle():null,e.featureEnabledToggle?this._renderFeatureEnabledToggle():null,e.gridEnabledToggle&&s?.type==="2d"?this._renderGridEnabledToggle():null].filter(u),r=[e.enabledToggle?this._renderEnabledToggle():null,l.length>0?n("div",{class:h.nestedContainer},l):null].filter(u);return r.length===0?null:n("calcite-block",{class:h.toggleBlock,heading:e.header?this.label:"",key:"toggle-block",label:this.label,open:!0},r)}_renderEnabledToggle(){return n(b,{checked:this.viewModel.snappingOptions.enabled,disabled:this._enabledToggleDisabled,key:`${this.id}__enabled-toggle`,label:this.messages.enableSnapping,onChange:this._enableSnappingSwitchChange})}_renderSelfEnabledToggle(){return n(b,{checked:this.viewModel.snappingOptions.selfEnabled,disabled:this._secondaryElementsDisabled,key:`${this.id}__self-enabled-toggle`,label:this.messages.geometryGuides,onChange:this._selfEnabledSwitchChange})}_renderFeatureEnabledToggle(){return n(b,{checked:this.viewModel.snappingOptions.featureEnabled,disabled:this._secondaryElementsDisabled,key:`${this.id}__feature-enabled-toggle`,label:this.messages.featureToFeature,onChange:this._featureEnabledSwitchChange})}_renderGridEnabledToggle(){return n(b,{checked:this.viewModel.snappingOptions.gridEnabled,disabled:this._secondaryElementsDisabled,key:`${this.id}__grid-enabled-toggle`,label:this.messages.grid,onChange:this._gridEnabledSwitchChange})}_renderLayerList(){if(!this.visibleElements.layerList)return null;let{messages:e,viewModel:s}=this,l=s.layerListViewModel.operationalItems.length>9?n("calcite-input",{class:h.layerListFilter,clearable:!0,placeholder:e?.searchLayers,onCalciteInputInput:({currentTarget:{value:c}})=>{this._layerListFilter=c===""?null:new RegExp(c,"i")}}):null,r=this._secondaryElementsDisabled,d=this.layerListOpen&&!r,o=s.layerListViewModel.operationalItems?.find(c=>!!c.children.length);return n("calcite-block",{class:h.layerListBlock,collapsible:!0,disabled:this._secondaryElementsDisabled,heading:e.snappingLayers,key:"list-block",open:d,onCalciteBlockToggle:c=>this.layerListOpen=c.currentTarget.open},l,this._renderToggleLayersButton(),n("calcite-list",{class:h.layerList,displayMode:o?"nested":"flat",label:e?.snappingLayers,selectionMode:"none"},this._renderLayerListItemCollection(s.layerListViewModel.operationalItems)))}_renderGridOptions(){let{view:e,visibleElements:s,snappingManager:l,snappingOptions:r,_openAndReady:d}=this,{gridEnabled:o,enabled:c}=r;(d||e?.type==="2d"&&e.grid)&&this._startLoadGrid();let m=this._gridLoadTask?.value,y=m&&e?.type==="2d"&&n(m,{snappingManager:l,snappingOptions:r,view:e,visibleElements:s.gridControlsElements});return n("calcite-block",{class:h.layerListBlock,collapsible:!0,disabled:!o||!c,heading:this.messages.gridOptionsHeading,key:"grid-block",open:d,onCalciteBlockClose:()=>this.gridOptionsOpen=!1,onCalciteBlockOpen:()=>this.gridOptionsOpen=!0},y??n("calcite-loader",{label:this.messagesCommon.loading,scale:"s",text:this.messagesCommon.loading}))}_startLoadGrid(){return v(this,null,function*(){!this._gridLoadTask&&this.visibleElements.gridControls&&this.view?.type==="2d"&&(this._gridLoadTask=S(()=>v(this,null,function*(){return(yield import("./chunk-62PPQKH6.js")).default})))})}_renderLayerListItemCollection(e){let s=this._layerListFilter;return e.map(l=>{switch(s?L(l,s):null){case"children":{let r=l.children.filter(d=>L(d,s)!==!1);return this._renderLayerListItemGroup(l,r)}case"self":case null:return this._renderLayerListItemOrGroup(l);case!1:return L(l.parent,s)==="self"?this._renderLayerListItemOrGroup(l):null}}).toArray().filter(u)}_renderToggleLayersButton(){if(!this.visibleElements.layerListToggleLayersButton)return null;let{viewModel:{allLayersEnabled:e},messages:s}=this,l=e?s.disableAllLayers:s.enableAllLayers;return n("calcite-button",{appearance:"transparent",class:h.layerListButton,label:l,name:"layer-toggle",onclick:this._onToggleLayersButtonClick},l)}_renderLayerListItemOrGroup(e){if(e.children.length)return this._renderLayerListItemGroup(e);let{messages:{untitledLayer:s}}=this,l=e.title||s,r=()=>{this.viewModel.toggleSnappingForLayers([e.layer?.id],e.enabled!=="enabled")};return n("calcite-list-item",{class:h.layerListItem,key:`${this.id}-list-item-${e.uid}`,label:l,onCalciteListItemSelect:d=>{d.stopPropagation(),r()}},n("calcite-checkbox",{checked:e.enabled==="enabled",slot:"actions-start",onCalciteCheckboxChange:r}))}_renderLayerListItemGroup(e,s){let{messages:l}=this,{children:r,title:d}=e,o=d||l.untitledLayer,c=d&&d!==""?d:O(),m=!!s?.length,y=s??r,k=()=>{this.viewModel.toggleSnappingForLayers(e.childLayerIds,e.enabled!=="enabled")},N=y?.find(f=>!!f.children.length);return n("calcite-list-item",{class:h.layerListGroup,key:c,label:o,open:m,onCalciteListItemSelect:f=>{f.stopPropagation(),k()}},n("calcite-checkbox",{checked:e.enabled==="enabled",indeterminate:e.enabled==="indeterminate",slot:"actions-start",onCalciteCheckboxChange:k}),n("calcite-list",{displayMode:N?"nested":"flat",label:l?.snappingLayers,selectionMode:"none"},this._renderLayerListItemCollection(y)))}get _enabledToggleDisabled(){let e=this.snappingOptions;return e.enabledToggled||e.forceDisabled}get _secondaryElementsDisabled(){return this._enabledToggleDisabled||!this.snappingOptions.enabled}};t([i()],a.prototype,"_defaultViewModel",void 0),t([i()],a.prototype,"_layerListFilter",void 0),t([i()],a.prototype,"_gridLoadTask",void 0),t([i()],a.prototype,"_openAndReady",null),t([i()],a.prototype,"label",null),t([i({type:Boolean,nonNullable:!0})],a.prototype,"layerListOpen",void 0),t([i({type:Boolean,nonNullable:!0})],a.prototype,"gridOptionsOpen",void 0),t([i(),E("esri/widgets/support/SnappingControls/t9n/SnappingControls")],a.prototype,"messages",void 0),t([i(),E("esri/t9n/common")],a.prototype,"messagesCommon",void 0),t([i()],a.prototype,"snappingOptions",null),t([i()],a.prototype,"snappingManager",void 0),t([i()],a.prototype,"view",null),t([i()],a.prototype,"viewModel",null),t([i({type:T,nonNullable:!0})],a.prototype,"visibleElements",void 0),t([i()],a.prototype,"_enabledToggleDisabled",null),t([i()],a.prototype,"_secondaryElementsDisabled",null),a=t([_("esri.widgets.support.SnappingControls")],a);var me=a;export{T as a,me as b};
