import{a as ot}from"./chunk-AKDISSFR.js";import{a as et}from"./chunk-QW25UBG2.js";import{a as tt,b as T,c as At}from"./chunk-SWT4UIOH.js";import{b as Ct}from"./chunk-E6JHCD7G.js";import{a as X}from"./chunk-EFTNLZSK.js";import{a as Q}from"./chunk-2XCEJBGD.js";import{a as St}from"./chunk-APBBABYM.js";import{a as Mt}from"./chunk-AM4QFKZT.js";import{t as Et}from"./chunk-DT6D5YZT.js";import{a as Tt}from"./chunk-H26LGRNQ.js";import{a as b}from"./chunk-2JW3DUYT.js";import{d as G}from"./chunk-4JIR4MZV.js";import{a as J}from"./chunk-63BBKXWS.js";import{a as Ot}from"./chunk-7XYYDAZO.js";import{e as bt,g as wt,j as Gt}from"./chunk-Z7TBAZRW.js";import{o as ht}from"./chunk-XR5FT7TQ.js";import{c as D}from"./chunk-N3HRYLNW.js";import{a as _t}from"./chunk-O4V2VBSK.js";import{a as ft}from"./chunk-SZMEI3WL.js";import{a as $}from"./chunk-CZ6CGC7I.js";import{a as vt}from"./chunk-BPWNCOXC.js";import{a as gt}from"./chunk-AVMO6LCR.js";import{a as mt}from"./chunk-JQAW4OB5.js";import{b as ct,f as dt,g as ut,q as yt}from"./chunk-DA3SDKGO.js";import{a as B}from"./chunk-7LHOQXZT.js";import{B as lt,d as pt}from"./chunk-NJWTSROP.js";import{a as P,b as nt,c as Y,e as z,k as j}from"./chunk-TG45K3WR.js";import{b as q}from"./chunk-ACP3S2CH.js";import{a as F}from"./chunk-T7DXJKX7.js";import{a as c}from"./chunk-QGVBCWUY.js";import{e as d}from"./chunk-NFIPKH6V.js";import{l as R}from"./chunk-5QEXLALV.js";import{b as I,e as L,o as Z,w as st,z as N}from"./chunk-4PTIEWMT.js";import{c as A}from"./chunk-TG2UTNEO.js";import{b as rt}from"./chunk-YOFFGXOB.js";import{g as it}from"./chunk-XRGPJ3QY.js";import{a as g,b as C,f as v}from"./chunk-VTHXE323.js";function Ht(t){return Ft(t).result}function Ft(t){if(t.graphic&&t.graphic.layer?.type!=="graphics")return{result:T.GRAPHICS_LAYER_MISSING};if(!t.operations)return{result:T.GEOMETRY_MISSING};if(Gt(t.elevationInfo))return{result:T.ELEVATION_MODE_UNSUPPORTED};let e=t.operations.data.type,o=t.operations.data.geometry;return e==="point"||e==="mesh"||e==="polyline"||e==="polygon"?{result:T.SUPPORTED,geometry:o}:{result:T.GEOMETRY_TYPE_UNSUPPORTED}}function kt(t){if(t.layer?.type!=="graphics")return T.GRAPHICS_LAYER_MISSING;if(t.geometry==null)return T.GEOMETRY_MISSING;switch(t.geometry.type){case"point":break;case"polygon":case"polyline":case"multipoint":case"extent":case"mesh":return T.SUPPORTED;default:return T.GEOMETRY_TYPE_UNSUPPORTED}let e=t.symbol!=null&&t.symbol.type==="point-3d"&&t.symbol.symbolLayers;return!e||!e.some(o=>o.type==="object")?T.SYMBOL_TYPE_UNSUPPORTED:bt(t)!=="on-the-ground"&&wt(t)?T.ELEVATION_MODE_UNSUPPORTED:T.SUPPORTED}var E=class extends F.EventedAccessor{constructor(t){super(t),this.cancelled=!1,this.history={undo:[],redo:[]},this.type=null}get tool(){if(!this.activeComponent)return null;switch(this.activeComponent.type){case"graphic-mover":case"move-3d":return"move";case"box":case"transform-3d":return"transform";case"reshape":case"reshape-3d":return"reshape";case"draw-2d":case"draw-3d":return this.activeComponent.geometryType;default:this.activeComponent}return null}addToHistory(t){this.history.redo=[],this.history.undo.push(t)}resetHistory(){this.history.redo=[],this.history.undo=[]}canUndo(){return this.history.undo.length>0}canRedo(){return this.history.redo.length>0}complete(){this._reset(),this.onEnd(),this.emit("complete")}cancel(){this.cancelled=!0,this.complete()}_reset(){this.activeComponent?.reset()}refreshComponent(){let t=this.activeComponent;t&&(t.type!=="box"&&t.type!=="reshape"&&t.type!=="graphic-mover"||t.refresh())}set undo(t){this._set("undo",()=>{this.canUndo()&&t()})}set redo(t){this._set("redo",()=>{this.canRedo()&&t()})}};c([d()],E.prototype,"activeComponent",void 0),c([d()],E.prototype,"cancelled",void 0),c([d()],E.prototype,"history",void 0),c([d()],E.prototype,"tool",null),c([d()],E.prototype,"type",void 0),c([d()],E.prototype,"canUndo",null),c([d()],E.prototype,"canRedo",null),c([d()],E.prototype,"onEnd",void 0),c([d()],E.prototype,"undo",null),c([d()],E.prototype,"redo",null),c([d()],E.prototype,"toggleTool",void 0),c([d()],E.prototype,"addToSelection",void 0),c([d()],E.prototype,"removeFromSelection",void 0),E=c([R("esri.widgets.Sketch.support.OperationHandle")],E);var U=class extends E{};c([d()],U.prototype,"activeComponent",void 0),U=c([R("esri.widgets.Sketch.support.OperationHandle.CreateOperationHandle")],U);var H=class extends E{};c([d()],H.prototype,"activeComponent",void 0),H=c([R("esri.widgets.Sketch.support.OperationHandle.UpdateOperationHandle")],H);function Dt(t,e){return e==="freehandPolygon"||e==="freehandPolyline"?"freehand":t??(e==="rectangle"||e==="circle"?"hybrid":"click")}function It(t){switch(t){case"freehandPolygon":return"polygon";case"freehandPolyline":return"polyline";default:return t}}function ne(t){return!!t&&(t.type==="draw-2d"||t.type==="draw-3d")}var Rt;(function(t){t[t.ForceCollapse=-1]="ForceCollapse",t[t.Low=0]="Low",t[t.Medium=10]="Medium",t[t.High=100]="High",t[t.Max=1e3]="Max"})(Rt||(Rt={}));var Pt={defaultZ:0},x={reshapeOptions:{edgeOperation:"split",shapeOperation:"move",vertexOperation:"move"},enableMoveAllGraphics:!0,enableRotation:!0,enableScaling:!0,multipleSelectionEnabled:!0,preserveAspectRatio:!1,toggleToolOnClick:!0,enableZ:!0,highlightOptions:{enabled:!0},tool:"transform"},f=class extends F.EventedAccessor{constructor(t){super(t),this._defaultSnappingManager=null,this._updatingHandles=new mt,this._internalGraphicsLayer=new Ot({listMode:"hide",internal:!0,title:"SVM Internal"}),this._operationHandle=null,this._viewHandlesKey="viewHandles",this.activeFillSymbol=null,this.activeLineSymbol=null,this.activeVertexSymbol=null,this.allowDeleteKey=!0,this.layer=null,this.pointSymbol=new $({style:"circle",size:6,color:[255,255,255],outline:{color:[50,50,50],width:1}}),this.polygonSymbol=new vt({color:[150,150,150,.2],outline:{color:[50,50,50],width:2}}),this.polylineSymbol=new gt({color:[130,130,130,1],width:2}),this.meshSymbol=new _t({symbolLayers:new q([new ft])}),this.updateGraphics=new q,this.updateOnGraphicClick=!0,this.creationMode="single",this.vertexSymbol=new $({style:"circle",size:6,color:[255,255,255],outline:{color:[50,50,50],width:1}}),this.sketchOptions=new X,this._moduleLoaderAbortController=null,this._viewReadyAbortController=null,this._sketchContinuationFlag=!1,this._originalPopupEnabled=null,this.defaultCreateOptions=Pt,this.defaultUpdateOptions=x,this.snappingOptions=t?.snappingManager?.options??t?.snappingOptions??new Q}initialize(){this.addHandles([Y(()=>this.view?.map?.layers,"change",t=>{t.removed.includes(this.layer)&&this.cancel()}),Y(()=>this.layer?.graphics,"change",t=>{if(this._operationHandle!=null)for(let e of t.removed)this.updateGraphics.includes(e)&&(this.updateGraphics.length>1?this._operationHandle.removeFromSelection(e):this._operationHandle.cancel())}),P(()=>this.layer?.elevationInfo??null,t=>{t!==this._internalGraphicsLayer.elevationInfo&&(this.cancel(),this._internalGraphicsLayer.elevationInfo=t)},j),P(()=>this.view,t=>{this._defaultSnappingManager=I(this._defaultSnappingManager),t&&(this.snappingManager||(this._defaultSnappingManager=new ot({view:t,options:this.snappingOptions})),t.type==="2d"?import("./chunk-ZIXVJSDO.js"):t.type==="3d"&&(import("./chunk-WBAPNUFI.js"),import("./chunk-MOYF6TPQ.js")))},j),P(()=>this.view?.spatialReference,(t,e)=>{t&&e&&!t.equals(e)&&this.cancel()})]),Et(this)}destroy(){this.cancel(),this._removeDefaultLayer(),this._defaultSnappingManager=I(this._defaultSnappingManager),this._set("snappingManager",null),this._set("view",null),this._updatingHandles.destroy(),this.emit("destroy")}get updating(){return this._updatingHandles.updating||this.snappingManager!=null&&this.snappingManager.updating}get activeTool(){return this._operationHandle?.tool??null}get activeCreateToolDrawMode(){return this._operationHandle?.type==="create"&&this._operationHandle.activeComponent&&"mode"in this._operationHandle.activeComponent?this._operationHandle.activeComponent.mode:null}get activeTooltip(){let{activeComponent:t,destroyed:e}=this,o=!e&&t&&"tooltip"in t?t.tooltip:null;return o?.visible?o:null}get activeComponent(){return this._operationHandle?.activeComponent??null}get createGraphic(){return this.activeComponent==null||this.activeComponent.type!=="draw-3d"&&this.activeComponent.type!=="draw-2d"?this._get("createGraphic"):this.activeComponent.graphic}get defaultCreateOptions(){return this._get("defaultCreateOptions")}set defaultCreateOptions(t){this._set("defaultCreateOptions",g(g({},Pt),t))}get defaultUpdateOptions(){return this._get("defaultUpdateOptions")}set defaultUpdateOptions(t){this._set("defaultUpdateOptions",C(g(g({},x),t),{reshapeOptions:g(g({},x.reshapeOptions),t?.reshapeOptions),highlightOptions:g(g({},x.highlightOptions),t?.highlightOptions)}))}get labelOptions(){return this.sketchOptions.labels}set labelOptions(t){this.sketchOptions.labels=t}get snappingOptions(){return this.snappingManager?.options??this._get("snappingOptions")}set snappingOptions(t){this._defaultSnappingManager!=null&&(this._defaultSnappingManager.options=t),this._set("snappingOptions",t)}get snappingManager(){return this._isOverridden("snappingManager")&&this._get("snappingManager"),this._defaultSnappingManager}set snappingManager(t){if(t)this._isOverridden("snappingManager")||(this._defaultSnappingManager=I(this._defaultSnappingManager)),this._override("snappingManager",t);else{let{view:e}=this;!this._defaultSnappingManager&&e&&(this._defaultSnappingManager=new ot({options:this.snappingOptions,view:e})),this._clearOverride("snappingManager")}}get state(){let t=!(!this.view?.ready||!this.layer),e=this._operationHandle;return t&&e?"active":t?"ready":"disabled"}get tooltipOptions(){return this.sketchOptions.tooltips}set tooltipOptions(t){this.sketchOptions.tooltips=t}get valueOptions(){return this.sketchOptions.values}set valueOptions(t){this.sketchOptions.values=t}get view(){return this._get("view")}set view(t){let e=this._get("view");if(e){let{container:a,map:i}=e;a&&(e.cursor=null),i?.remove(this._internalGraphicsLayer),this.removeHandles(this._viewHandlesKey),this.cancel()}let o="view-ready";this.removeHandles(o),t&&this.addHandles(nt(()=>t.ready,a=>{this.removeHandles(this._viewHandlesKey),a&&this.addHandles(this._generateViewHandles(t),this._viewHandlesKey)},j),o),this._set("view",t)}cancel(){this._moduleLoaderAbortController=L(this._moduleLoaderAbortController),this._viewReadyAbortController=L(this._viewReadyAbortController),this._sketchContinuationFlag=!0,this._operationHandle&&this._operationHandle.cancel()}complete(){this._operationHandle&&this._operationHandle.complete()}delete(){let{state:t,updateGraphics:e}=this;if(t==="active"&&e.length){let{activeTool:o,layer:a}=this,i=e.toArray();a.removeMany(i),this.cancel(),this._emitDeleteEvent({graphics:i,tool:o})}}duplicate(){if(this.state==="active"&&this.updateGraphics.length){let t=this.updateGraphics.map(e=>e.clone()).toArray();return this.layer.addMany(t),this.emit("duplicate",{graphics:t,type:"duplicate"}),t}return[]}create(t,e){return v(this,null,function*(){this.cancel(),yield this._waitViewReady();let{view:o,layer:a}=this;if(!o||this.state==="disabled")throw a||this._logMissingLayer(),Z();if(o.activeTool!=null&&(o.activeTool=null),!t)return void this._logError("sketch:missing-parameter","Missing parameter 'tool'.");et(o,this._internalGraphicsLayer);let i=yield this._updatingHandles.addPromise(this._setupCreateOperation(t,e));if(i==null||this.destroyed)return void o.map.remove(this._internalGraphicsLayer);let r=()=>{if(i===this._operationHandle){let l=this.createGraphic,n=this._operationHandle.cancelled;if(this._operationHandle.destroy(),this._operationHandle=null,this._set("createGraphic",null),this.view?.map&&this.view.map.remove(this._internalGraphicsLayer),i.cancelled||l==null||a.add(l),this._sketchContinuationFlag=!1,this.emit("create",{graphic:l,state:n?"cancel":"complete",tool:t,toolEventInfo:null,type:"create"}),n||this._sketchContinuationFlag)return;let{creationMode:p}=this;if(p==="continuous"){if(e?.geometryToPlace)return;this._updatingHandles.addPromise(N(this.create(t,e)))}else p==="update"&&l&&this._updatingHandles.addPromise(N(this.update([l])))}};i.on("complete",r),this._operationHandle=i,o.ready&&o.focus()})}place(t,e){return v(this,null,function*(){return this.create("mesh",g({mode:"click",hasZ:t.hasZ,geometryToPlace:t},e))})}update(t,e){return v(this,null,function*(){this.cancel(),yield this._waitViewReady();let{layer:o,view:a,state:i}=this;if(!a||i==="disabled")throw o||this._logMissingLayer(),Z();a.activeTool!=null&&(a.activeTool=null);let r=Array.isArray(t)?t:[t];if(t==null||!r?.length)return void this._logError("sketch:missing-parameter","Missing parameter 'graphics'.");if(r.some(n=>n.layer!==o?(this._logError("sketch:invalid-parameter","Parameter 'graphics' contains one or more graphics missing from the supplied GraphicsLayer."),!0):n.geometry==null&&(this._logError("sketch:invalid-parameter","Parameter 'graphics' contains one or more graphics with an unsupported geometry."),!0)))return;let l=yield this._updatingHandles.addPromise(this._setupUpdateOperation(r,e));this.destroyed||l==null||O(l)||(et(a,this._internalGraphicsLayer),this._setUpdateOperationHandle(l,e),this.emit("update",{graphics:r,state:"start",aborted:!1,tool:l.tool,toolEventInfo:null,type:"update"}))})}_updateSpatialReference(t){return v(this,null,function*(){let e=this.view;if(e){t=Array.isArray(t)?t:[t];for(let o of t)o.geometry==null||o.geometry.type==="mesh"||pt(o.geometry.spatialReference,e.spatialReference)||(yt(o.geometry.spatialReference,e.spatialReference)||ct()||(yield dt()),o.geometry=ut(o.geometry,e.spatialReference))}else this._logMissingView()})}undo(){this.canUndo()&&this._operationHandle?.undo()}redo(){this.canRedo()&&this._operationHandle?.redo()}canUndo(){return!!this._operationHandle?.canUndo()}canRedo(){return!!this._operationHandle?.canRedo()}toggleUpdateTool(){this._operationHandle?.toggleTool()}_getFirstHit(t){return v(this,null,function*(){let e=this.view;if(!e)return this._logMissingView(),null;if(e.type==="2d"){let i=[];e.map.allLayers.forEach(l=>{l.type!=="vector-tile"&&l.type!=="imagery"||i.push(l)});let r=yield e.hitTest(t,{exclude:i});return Ct(r.results)}let o=[e.map.ground];e.map.allLayers.forEach(i=>{ht(i.type)&&o.push(i)});let a=yield e.hitTest(t,{exclude:o});if(a.results.length>0){let i=a.results[0];if(i!=null&&i.type==="graphic"&&i.graphic&&(!a.ground.mapPoint||e.map.ground.opacity<1||a.ground.distance-(i.distance??0)>-Math.min(3*a.ground.distance,e.viewingMode==="global"?lt(e.renderCoordsHelper.spatialReference).radius/e.renderCoordsHelper.unitInMeters:Number.POSITIVE_INFINITY)))return i}return null})}_generateViewHandles(t){return[t.on("immediate-click",e=>v(this,null,function*(){let o=this.state==="active"&&this._operationHandle?.type==="create";this.state!=="disabled"&&!o&&this.updateOnGraphicClick&&(yield this._updatingHandles.addPromise(this._handleImmediateClick(e)))}),G.WIDGET)]}_handleImmediateClick(t){return v(this,null,function*(){let e=yield t.async(()=>this._getFirstHit(J(t))),o=null;if(e!=null){let a=e.graphic;this.updateGraphics.includes(a)||a.layer===this.layer?(t.stopPropagation(),o=a):this.view?.type!=="2d"||this._isComponentGraphic(a)||this.state!=="active"||this.cancel()}else this.state==="active"&&this.cancel();o==null||this.updateGraphics.includes(o)||(yield this.update([o],C(g({},this.defaultUpdateOptions),{reshapeOptions:g({},this.defaultUpdateOptions.reshapeOptions)})))})}_setupCreateOperation(t,e){return v(this,null,function*(){let o=this.view;if(!o)return this._logMissingView(),null;let a=g(g({hasZ:o.type==="3d"},this.defaultCreateOptions),e),i=yield this._setupDrawGraphicTool(t,o,a);return i==null?null:(o.tools.add(i),o.activeTool=i,this._setupCreateOperationHandle(i))})}_setupDrawGraphicTool(t,e,o){return v(this,null,function*(){if(t==="multipoint"&&e.type==="3d")return this._logError("sketch:create","Multipoint geometries are not supported in SceneView."),null;if(!e)return this._logMissingView(),null;let{cursor:a,defaultZ:i,hasZ:r,geometryToPlace:l,graphicProperties:n,mode:p,preserveAspectRatio:s}=o,u=Dt(p,t),m=It(t),_=o?.optionsPerTool?.has(t)?o.optionsPerTool.get(t):{},y=_?.preserveAspectRatio??s??t!=="rectangle",h=g({centered:t!=="rectangle"&&!(t==="circle"&&!y),cursor:a,defaultZ:i,forceUniformSize:y,graphicProperties:C(g({},n),{attributes:g({},n?.attributes)}),geometryToPlace:l,geometryType:m,mode:u,graphicSymbol:this._getGraphicSymbolFromTool(t),hasZ:r,snappingManager:this.snappingManager,snapToScene:!1,view:e},_);return e.type==="2d"?this._makeDrawGraphicTool2D(h):this._makeDrawGraphicTool3D(h)})}_makeDrawGraphicTool2D(t){return v(this,null,function*(){let e=yield this._requireModule(import("./chunk-ZIXVJSDO.js"));return O(e)||this.destroyed?null:new e.module.DrawGraphicTool2D(C(g({},t),{activeVertexSymbol:this.activeVertexSymbol,regularVerticesSymbol:this.vertexSymbol,activeLineSymbol:this.activeLineSymbol,activeFillSymbol:Vt(t.geometryType)?this.activeFillSymbol:null,sketchOptions:this.sketchOptions}))})}_makeDrawGraphicTool3D(t){return v(this,null,function*(){let e=yield this._requireModule(import("./chunk-WBAPNUFI.js"));if(O(e)||this.destroyed)return null;let{elevationInfo:o}=this.layer;return new e.module.DrawGraphicTool3D(C(g({},t),{elevationInfo:o,snapToScene:!0,sketchOptions:this.sketchOptions}))})}_setupCreateOperationHandle(t){let e=this.view;if(!e)return this._logMissingView(),null;let o=null,a=t.forceUniformSize,i=t.centered,r=[e.on("key-down",n=>{if(n.key===b.pan)n.stopPropagation(),n.repeat||(t.enabled=!1);else if(n.key===b.complete)n.stopPropagation(),t.completeCreateOperation();else if(n.key!==b.vertexAdd||n.repeat)n.key===b.undo?(n.stopPropagation(),l.undo()):n.key===b.redo?(n.stopPropagation(),l.redo()):n.key!==b.constraint||t.geometryType!=="rectangle"&&t.geometryType!=="circle"||n.repeat?n.key===b.center&&(n.repeat||(t.centered=!i,n.stopPropagation())):(t.forceUniformSize=!a,n.stopPropagation());else{let p=t.drawOperation.geometryType;p!=="polyline"&&p!=="polygon"&&p!=="multipoint"||(n.stopPropagation(),t.drawOperation.commitStagedVertex())}},G.WIDGET),e.on("key-up",n=>{n.key===b.pan?t.enabled=!0:n.key!==b.constraint||t.geometryType!=="rectangle"&&t.geometryType!=="circle"?n.key===b.center&&(t.centered=i,n.stopPropagation()):(t.forceUniformSize=a,n.stopPropagation())},G.WIDGET),t.on("vertex-add",n=>{switch(o=o==null?"start":"active",n.operation){case"apply":this.emit("create",{graphic:t.graphic,state:o,tool:this.activeTool,toolEventInfo:n,type:"create"});break;case"undo":this._emitUndoEvent({graphics:[t.graphic],tool:t.geometryType});break;case"redo":this._emitRedoEvent({graphics:[t.graphic],tool:t.geometryType})}}),t.on("cursor-update",n=>{t.drawOperation.numCommittedVertices>0&&this.emit("create",{graphic:t.graphic,state:"active",tool:this.activeTool,toolEventInfo:{coordinates:n.vertices[0].coordinates,type:"cursor-update"},type:"create"})}),t.on("vertex-remove",n=>{switch(n.operation){case"apply":this.emit("create",{graphic:t.graphic,state:"active",tool:this.activeTool,toolEventInfo:n,type:"create"});break;case"undo":this._emitUndoEvent({graphics:[t.graphic],tool:t.geometryType});break;case"redo":this._emitRedoEvent({graphics:[t.graphic],tool:t.geometryType})}}),t.on("complete",n=>{this._set("createGraphic",n.graphic),o="complete",n.aborted?l&&l.cancel():l&&l.complete()}),P(()=>this._getGraphicSymbolFromTool(t.geometryType),n=>{t.graphicSymbol=n})],l=new U({activeComponent:t,tool:t.geometryType,type:"create",onEnd:()=>{A(r),e.tools?.remove(t)},undo:()=>{t.canUndo&&t.undo()},redo:()=>{t.canRedo&&t.redo()},canUndo:()=>t.canUndo,canRedo:()=>t.canRedo});return l}_getGraphicSymbolFromTool(t){switch(t){case"point":case"multipoint":return this.pointSymbol;case"polyline":case"freehandPolyline":return this.polylineSymbol;case"circle":case"rectangle":case"polygon":case"freehandPolygon":return this.polygonSymbol;case"mesh":return this.meshSymbol}}_setupUpdateOperation(t,e){return v(this,null,function*(){let{layer:o,view:a}=this;if(!a)return this._logMissingView(),null;let i=C(g(g({},this.defaultUpdateOptions),e),{reshapeOptions:g(g({},this.defaultUpdateOptions.reshapeOptions),e?.reshapeOptions),highlightOptions:g(g({},this.defaultUpdateOptions.highlightOptions),e?.highlightOptions)}),r=i.tool??x.tool;for(let l of t)o.remove(l),o.add(l);if(a.type==="3d"){if(t.length===0)return null;switch(r){case"move":return this._setupMove3DOperation(t,i,a,r);case"reshape":return t.length>1?(this._logError("sketch:reshape-multiple","Reshape operation does not support multiple graphics."),null):this._setupReshape3DOperation(t[0],i,a);case"transform":return this._setupGraphicTransform3DOperation(t,i,a)}}switch(r){case"move":return this._setupMove2DOperation(t,i,a);case"reshape":return t.length>1?(this._logError("sketch:reshape-multiple","Reshape operation does not support multiple graphics."),null):this._setupTransformOrReshape2DOperation(t,r,i,a);case"transform":if(t.length===1){let l=t[0].geometry?.type;l!=="point"&&l!=="multipoint"||(r="reshape")}return this._setupTransformOrReshape2DOperation(t,r,i,a)}})}_setupMove3DOperation(t,e,o,a,i=!1){return v(this,null,function*(){let r=yield this._requireModule(import("./chunk-WBAPNUFI.js"));if(O(r))return r;let{ManipulatedObject3DGraphic:l,MoveTool3D:n}=r.module,p=new Map,s=()=>{p.forEach(y=>y.destroy()),p.clear()};for(let y of t){let h=new l({view:o,graphic:y}),S=At(h);if(S!==T.SUPPORTED)return s(),this._logError("sketch:move",`Move operation not supported for provided graphic(s) (${tt(S)}).`),null;p.set(y,h)}let u=new n({view:o,enableZ:e.enableZ,snappingManager:this.snappingManager,sketchOptions:this.sketchOptions});o.tools.add(u),u.objects.addMany(Array.from(p.values())),i||this.updateGraphics.addMany(t);let m=[],_=new H({activeComponent:u,tool:a,type:"update",onEnd:()=>{A(m),W(o,u),s()},undo:()=>{xt(this.view,u),V(_,this.updateGraphics.toArray()),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:a})},redo:()=>{K(_,this.updateGraphics.toArray()),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:a})},addToSelection:y=>{this.updateGraphics.push(y);let h=new l({view:o,graphic:y});p.set(y,h),u.objects.push(h),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[y],removed:[],type:"selection-change"},type:"update"})},removeFromSelection:y=>{let h=this.updateGraphics.indexOf(y);if(_.history.undo.forEach(M=>M.updates.splice(h,1)),_.history.redo.forEach(M=>M.updates.splice(h,1)),this.updateGraphics.remove(y),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[y],type:"selection-change"},type:"update"}),this.updateGraphics.length===0)return void _.complete();let S=p.get(y);S&&(u.objects.remove(S),S.destroy(),p.delete(y))},toggleTool:()=>v(this,null,function*(){if(this.updateGraphics.length!==1||e.toggleToolOnClick===!1||a!=="transform")return;let y=this.updateGraphics.at(0),h=yield this._setupReshape3DOperation(y,e,o,!0);h&&!O(h)&&(_.onEnd(),_.destroy(),this._setUpdateOperationHandle(h,e))})});return m.push(...this._getHandlesForComponent(_,e),o.on("immediate-click",y=>this._getCommonUpdateOperationClickHandlers(_,y,e),G.WIDGET),o.on("key-down",y=>{this._getCommonUpdateOperationKeyDownHandlers(_,y)},G.WIDGET)),_})}_setupGraphicTransform3DOperation(t,e,o,a=!1){if(t.length===1&&kt(t[0])===T.SUPPORTED){let i=t[0],r=i.geometry;if(r!=null&&(r.type==="point"||r.type==="mesh"))return this._setupPointTransform3DOperation(i,e,o);if(r!=null&&(r.type==="polygon"||r.type==="polyline"))return this._setupPolyTransform3DOperation(i,e,o,a)}return this._setupMove3DOperation(t,e,o,"transform",a)}_setupPointTransform3DOperation(t,e,o){return v(this,null,function*(){let a="transform",{enableRotation:i,enableScaling:r,enableZ:l}=e,n=yield this._requireModule(import("./chunk-WBAPNUFI.js"));if(O(n))return n;let{TransformTool3D:p,ManipulatedObject3DGraphic:s}=n.module,u=new s({graphic:t,view:o}),m=new p({object:u,view:o,enableRotation:i,enableScaling:r,enableZ:l,snappingManager:this.snappingManager,sketchOptions:this.sketchOptions});o.tools.add(m),this.updateGraphics.add(t);let _=[],y=new H({activeComponent:m,tool:a,type:"update",onEnd:()=>{A(_),W(o,m),u.destroy()},undo:()=>{xt(this.view,m),V(y,this.updateGraphics.toArray()),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:a})},redo:()=>{K(y,this.updateGraphics.toArray()),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:a})},addToSelection:h=>v(this,null,function*(){this.updateGraphics.add(h),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[h],removed:[],type:"selection-change"},type:"update"}),y.onEnd(),y.destroy();let S=yield this._setupMove3DOperation(this.updateGraphics.toArray(),e,o,"transform",!0);O(S)||this._setUpdateOperationHandle(S,e)}),removeFromSelection:h=>{this.updateGraphics.remove(h),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[h],type:"selection-change"},type:"update"}),y.complete()},toggleTool:()=>{}});return _.push(...this._getHandlesForComponent(y,e),o.on("immediate-click",h=>this._getCommonUpdateOperationClickHandlers(y,h,e),G.WIDGET),o.on("key-down",h=>{this._getCommonUpdateOperationKeyDownHandlers(y,h)},G.WIDGET)),y})}_setupPolyTransform3DOperation(t,e,o,a=!1){return v(this,null,function*(){let i="transform",{enableRotation:r,enableScaling:l,enableZ:n,preserveAspectRatio:p}=e,s=yield this._requireModule(import("./chunk-WBAPNUFI.js"));if(O(s))return s;let{ManipulatedObject3DGraphic:u,ExtentTransformTool:m}=s.module,_=this.view?.inputManager?.isModifierKeyDown(b.constraint),y=new u({view:o,graphic:t}),h=new m({object:y,view:o,enableRotation:r,enableScaling:l,enableZ:n,preserveAspectRatio:!!p!=!!_,sketchOptions:this.sketchOptions});o.tools.add(h),a||this.updateGraphics.add(t);let S=[],M=new H({activeComponent:h,tool:i,type:"update",onEnd:()=>{A(S),W(o,h),y.destroy()},canUndo:()=>!h.destroyed&&h.canUndo,undo:()=>{h.destroyed||(h.undo(),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:i}))},canRedo:()=>!h.destroyed&&h.canRedo,redo:()=>{h.destroyed||(h.redo(),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:i}))},addToSelection:w=>v(this,null,function*(){this.updateGraphics.add(w),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[w],removed:[],type:"selection-change"},type:"update"}),M.onEnd(),M.destroy();let at=yield this._setupMove3DOperation(this.updateGraphics.toArray(),e,o,"transform",!0);O(at)||this._setUpdateOperationHandle(at,e)}),removeFromSelection:w=>{this.updateGraphics.remove(w),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[w],type:"selection-change"},type:"update"}),M.complete()},toggleTool:()=>v(this,null,function*(){if(this.updateGraphics.length!==1||e.toggleToolOnClick===!1)return;let w=yield this._setupReshape3DOperation(t,e,o,!0);w&&!O(w)&&(M.onEnd(),M.destroy(),this._setUpdateOperationHandle(w,e))})});return S.push(...this._getHandlesForComponent(M,e),o.on("immediate-click",w=>this._getCommonUpdateOperationClickHandlers(M,w,e),G.WIDGET),o.on("key-down",w=>this._getCommonUpdateOperationKeyDownHandlers(M,w),G.WIDGET),o.on("key-down",w=>{w.key!==b.constraint||w.repeat||(h.preserveAspectRatio=!h.preserveAspectRatio,w.stopPropagation())},G.WIDGET),o.on("key-up",w=>{w.key===b.constraint&&(h.preserveAspectRatio=!h.preserveAspectRatio,w.stopPropagation())},G.WIDGET)),M})}_setupMove2DOperation(t,e,o){return v(this,null,function*(){let a="move";this.updateGraphics.addMany(t),yield this._updatingHandles.addPromise(this._updateSpatialReference(t));let i=yield this._getGraphicMover(t,e,o);if(O(i))return i;let r=new H({activeComponent:i,tool:a,type:"update",onEnd:()=>{this._displayDefaultCursor(),A(p),A(n),i.destroy(),this._internalGraphicsLayer?.removeMany([...this.updateGraphics.toArray()])},undo:()=>{let s=this.updateGraphics.toArray();V(r,s),r.refreshComponent(),this._emitUndoEvent({graphics:s,tool:a})},redo:()=>{let s=this.updateGraphics.toArray();K(r,s),r.refreshComponent(),this._emitRedoEvent({graphics:s,tool:a})},addToSelection:s=>v(this,null,function*(){yield this._updatingHandles.addPromise(this._updateSpatialReference(s)),this.updateGraphics.push(s),i.graphics=this.updateGraphics.toArray(),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[s],removed:[],type:"selection-change"},type:"update"})}),removeFromSelection:s=>{let u=this.updateGraphics.indexOf(s);r.history.undo.forEach(_=>_.updates.splice(u,1)),r.history.redo.forEach(_=>_.updates.splice(u,1)),this.updateGraphics.remove(s);let m=this.updateGraphics.toArray();this.emit("update",{graphics:m,state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[s],type:"selection-change"},type:"update"}),this.updateGraphics.length!==0?i.graphics=m:r.complete()}}),l=!1,n=[o.on("immediate-click",s=>this._getCommonUpdateOperationClickHandlers(r,s,e),G.WIDGET),o.on("key-down",s=>{this._getCommonUpdateOperationKeyDownHandlers(r,s),s.key!==b.constraint||s.repeat||(l=!0,i.enableMoveAllGraphics=!i.enableMoveAllGraphics)},G.WIDGET),o.on("key-up",s=>{s.key===b.constraint&&l&&(l=!1,i.enableMoveAllGraphics=!i.enableMoveAllGraphics)},G.WIDGET)],p=this._getHandlesForComponent(r,e);return r})}_setupReshape3DOperation(t,e,o,a=!1){return v(this,null,function*(){let i="reshape",r=yield this._requireModule(import("./chunk-WBAPNUFI.js"));if(O(r))return r;let{ManipulatedObject3DGraphic:l,ReshapeTool3D:n}=r.module,p=new l({view:o,graphic:t}),s=Ht(p);if(s!==T.SUPPORTED)return p.destroy(),this._logError("sketch:reshape",`Reshape operation not supported for provided graphic(s) (${tt(s)}).`),null;let u=e.reshapeOptions,m=new n({view:o,object:p,enableZVertex:e.enableZ&&u?.vertexOperation==="move",enableZShape:e.enableZ&&u?.shapeOperation==="move",enableMoveObject:u?.shapeOperation==="move"||u?.shapeOperation==="move-xy",enableMidpoints:u?.edgeOperation==="split",enableEdgeOffset:u?.edgeOperation==="offset",snappingManager:this.snappingManager,sketchOptions:this.sketchOptions});o.tools.add(m),a||this.updateGraphics.add(p.graphic);let _=[],y=new H({activeComponent:m,tool:i,type:"update",onEnd:()=>{A(_),W(o,m),p.destroy()},canUndo:()=>!m.destroyed&&m.canUndo,undo:()=>{m.destroyed||(m.undo(),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:i}))},canRedo:()=>!m.destroyed&&m.canRedo,redo:()=>{m.destroyed||(m.redo(),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:i}))},addToSelection:h=>v(this,null,function*(){this.updateGraphics.add(h),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[h],removed:[],type:"selection-change"},type:"update"}),y.onEnd(),y.destroy();let S=yield this._setupMove3DOperation(this.updateGraphics.toArray(),e,o,"transform",!0);O(S)||this._setUpdateOperationHandle(S,e)}),removeFromSelection:h=>{this.updateGraphics.remove(h),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[h],type:"selection-change"},type:"update"}),y.complete()},toggleTool:()=>v(this,null,function*(){if(e.toggleToolOnClick===!1)return;y.onEnd(),y.destroy();let h=yield this._setupGraphicTransform3DOperation(this.updateGraphics.toArray(),e,o,!0);O(h)||this._setUpdateOperationHandle(h,e)})});return _.push(...this._getHandlesForComponent(y,e),o.on("immediate-click",h=>this._getCommonUpdateOperationClickHandlers(y,h,e),G.WIDGET),o.on("key-down",h=>{this._getCommonUpdateOperationKeyDownHandlers(y,h)},G.WIDGET)),y})}_setupTransformOrReshape2DOperation(t,e,o,a){return v(this,null,function*(){this.updateGraphics.addMany(t),yield this._updatingHandles.addPromise(this._updateSpatialReference(t));let i=e==="transform"?yield this._getBox(t,o,a):yield this._getReshape(t,o,a);if(O(i))return i;let r=new H({activeComponent:i,type:"update",onEnd:()=>{A(n),A(l),r.activeComponent&&!r.activeComponent.destroyed&&r.activeComponent.destroy(),this._internalGraphicsLayer.removeMany(this.updateGraphics.toArray())},undo:()=>{V(r,this.updateGraphics.toArray()),r.refreshComponent(),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:r.tool})},redo:()=>{K(r,this.updateGraphics.toArray()),r.refreshComponent(),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:r.tool})},addToSelection:p=>v(this,null,function*(){let s=r.activeComponent;if(s?.type==="reshape"){let u=[...this.updateGraphics,p];this.updateGraphics.removeAll(),r.onEnd(),r.destroy();let m=yield this._setupTransformOrReshape2DOperation(u,"transform",o,a);if(O(m))return;this._setUpdateOperationHandle(m,o)}else this.updateGraphics.add(p),s.graphics=this.updateGraphics.toArray(),s.refresh(),r.resetHistory();this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[p],removed:[],type:"selection-change"},type:"update"})}),removeFromSelection:p=>v(this,null,function*(){let s=this.updateGraphics.indexOf(p);r.history.undo.forEach(m=>m.updates.splice(s,1)),r.history.redo.forEach(m=>m.updates.splice(s,1)),this.updateGraphics.remove(p);let u=this.updateGraphics.toArray();if(u.length===0)r.complete();else{let m=u[0].geometry;u.length!==1||m==null||m.type!=="point"&&m.type!=="multipoint"?r.activeComponent.graphics=u:r.toggleTool()}this.emit("update",{graphics:u,state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[p],type:"selection-change"},type:"update"})}),toggleTool:()=>v(this,null,function*(){if(this.updateGraphics.length>1)return;let p=this.updateGraphics.at(0),s=p.geometry;if(s!=null&&(r.tool==="reshape"&&(s.type==="point"||s.type==="multipoint")||r.tool==="transform"&&s.type==="extent"))return;let u=null;r.tool==="transform"?u=yield this._getReshape([p],o,a):r.tool==="reshape"&&(u=yield this._getBox([p],o,a)),O(u)||(r.activeComponent?.destroy(),r.activeComponent=u,r.activeComponent&&(A(n),n=this._getHandlesForComponent(r,o)))})}),l=[a.on("immediate-click",p=>this._getCommonUpdateOperationClickHandlers(r,p,o),G.WIDGET),a.on("key-down",p=>{if(this._getCommonUpdateOperationKeyDownHandlers(r,p),p.key===b.constraint&&!p.repeat&&r){let s=r.activeComponent;s&&s.type==="box"&&(s.preserveAspectRatio=!s.preserveAspectRatio)}},G.WIDGET),a.on("key-up",p=>{if(p.key===b.constraint&&r){let s=r.activeComponent;s&&s.type==="box"&&(s.preserveAspectRatio=!s.preserveAspectRatio)}},G.WIDGET)],n=this._getHandlesForComponent(r,o);return r})}_getGraphicMover(t,e,o){return v(this,null,function*(){let{enableMoveAllGraphics:a,highlightOptions:i}=e,r=yield this._requireModule(import("./chunk-TVG2UOGR.js"));return O(r)?r:new r.module.default({enableMoveAllGraphics:a,highlightsEnabled:!!i?.enabled,indicatorsEnabled:!1,graphics:t,view:o,callbacks:{onGraphicMoveStart:({dx:l,dy:n,graphic:p})=>{this._displayGrabbingCursor(),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:l,dy:n,mover:p,type:"move-start"},type:"update"})},onGraphicMove:({dx:l,dy:n,graphic:p})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:l,dy:n,mover:p,type:"move"},type:"update"}),onGraphicMoveStop:({dx:l,dy:n,graphic:p})=>{this._displayPointerCursor(),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:l,dy:n,mover:p,type:"move-stop"},type:"update"})},onGraphicPointerOver:()=>this._displayPointerCursor(),onGraphicPointerOut:()=>this._displayDefaultCursor()}})})}_getBox(t,e,o){return v(this,null,function*(){let{enableRotation:a,enableScaling:i,highlightOptions:r,preserveAspectRatio:l}=e,n=yield this._requireModule(import("./chunk-TYLG3NDQ.js"));if(O(n))return n;let p=this.view?.inputManager?.isModifierKeyDown(b.constraint);return new n.module.default({graphics:t,enableRotation:a,enableScaling:i,highlightsEnabled:!!r?.enabled,preserveAspectRatio:!!l!=!!p,layer:this._internalGraphicsLayer,view:o,sketchOptions:this.sketchOptions,callbacks:{onMoveStart:s=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:g({},s),type:"update"}),onMove:s=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:g({},s),type:"update"}),onMoveStop:s=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:g({},s),type:"update"}),onScaleStart:s=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:g({},s),type:"update"}),onScale:s=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:g({},s),type:"update"}),onScaleStop:s=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:g({},s),type:"update"}),onRotateStart:s=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:g({},s),type:"update"}),onRotate:s=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:g({},s),type:"update"}),onRotateStop:s=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:g({},s),type:"update"})}})})}_getReshape(t,e,o){return v(this,null,function*(){let a=e.reshapeOptions?.edgeOperation==="split",i=e.reshapeOptions?.shapeOperation==="move",r=!!e.highlightOptions?.enabled,l=yield this._requireModule(import("./chunk-HA7VOV6N.js"));return O(l)?l:new l.module.default({enableMidpoints:a,enableMovement:i,graphic:t[0],highlightsEnabled:r,layer:this._internalGraphicsLayer,snappingManager:this.snappingManager,sketchOptions:this.sketchOptions,view:o,callbacks:{onReshapeStart:n=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:g({},n),type:"update"}),onReshape:n=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:g({},n),type:"update"}),onReshapeStop:({mover:n,type:p})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:n,type:p},type:"update"}),onMoveStart:({dx:n,dy:p,mover:s,type:u})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:n,dy:p,mover:s,type:u},type:"update"}),onMove:({dx:n,dy:p,mover:s,type:u})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:n,dy:p,mover:s,type:u},type:"update"}),onMoveStop:({dx:n,dy:p,mover:s,type:u})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:n,dy:p,mover:s,type:u},type:"update"}),onVertexAdd:({added:n,type:p,vertices:s})=>{let u=n.map(m=>B(m.geometry));this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:u,vertices:s,type:p},type:"update"})},onVertexRemove:({removed:n,type:p,vertices:s})=>{let u=n.map(m=>B(m.geometry));this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{removed:u,vertices:s,type:p},type:"update"})}}})})}_getHandlesForComponent(t,e){let o=t.activeComponent;if(!o)return[];switch(o.type){case"graphic-mover":return[o.on("graphic-click",({graphic:a,viewEvent:i})=>{i.native?.shiftKey&&(i.stopPropagation(),t.removeFromSelection(a))}),o.on("graphic-move-start",a=>t.addToHistory(k(a.allGraphics)))];case"box":return[o.on("graphic-click",a=>this._onTransformOrReshape2DGraphicClick(t,e,a)),o.on("move-start",a=>t.addToHistory(k(a.graphics))),o.on("rotate-start",a=>t.addToHistory(k(a.graphics))),o.on("scale-start",a=>t.addToHistory(k(a.graphics)))];case"reshape":return[o.on("graphic-click",a=>this._onTransformOrReshape2DGraphicClick(t,e,a)),o.on("move-start",a=>t.addToHistory(k([a.mover]))),o.on("reshape-start",a=>t.addToHistory(k([a.graphic]))),o.on("vertex-add",a=>t.addToHistory(k([a.oldGraphic]))),o.on("vertex-remove",a=>t.addToHistory(k([a.oldGraphic])))];case"move-3d":return[o.events.on("record-undo",({updates:a})=>{t.addToHistory({updates:a})}),o.events.on("move-start",a=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:0,dy:0,mover:a.objects.length>0?a.objects[0].graphic:null,type:"move-start"},type:"update"})}),o.events.on("move",a=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:a.dx,dy:a.dy,mover:a.objects.length>0?a.objects[0].graphic:null,type:"move"},type:"update"})}),o.events.on("move-stop",a=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:0,dy:0,mover:a.objects.length>0?a.objects[0].graphic:null,type:"move-stop"},type:"update"})}),o.events.on("immediate-click",a=>{a.shiftKey?this._toggleSelection([a.object.graphic],t,e):t.toggleTool()})];case"transform-3d":return[o.events.on("record-undo",({updates:a})=>{t.addToHistory({updates:a})}),o.events.on("translate-start",a=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:a.object.graphic,dx:a.dxScreen,dy:a.dyScreen,type:"move-start"},type:"update"})}),o.events.on("translate-stop",a=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:a.object.graphic,dx:a.dxScreen,dy:a.dyScreen,type:"move-stop"},type:"update"})}),o.events.on("rotate-start",a=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:a.object.graphic,angle:a.angle,type:"rotate-start"},type:"update"})}),o.events.on("rotate-stop",a=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:a.object.graphic,angle:a.angle,type:"rotate-stop"},type:"update"})}),o.events.on("scale-start",a=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:a.object.graphic,xScale:a.xScale,yScale:a.yScale,type:"scale-start"},type:"update"})}),o.events.on("scale-stop",a=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:a.object.graphic,xScale:a.xScale,yScale:a.yScale,type:"scale-stop"},type:"update"})}),o.events.on("translate",a=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:a.object.graphic,dx:a.dxScreen,dy:a.dyScreen,type:"move"},type:"update"})}),o.events.on("rotate",a=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:a.object.graphic,angle:a.angle,type:"rotate"},type:"update"})}),o.events.on("scale",a=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:a.object.graphic,xScale:a.xScale,yScale:a.yScale,type:"scale"},type:"update"})}),o.events.on("immediate-click",a=>{a.shiftKey?this._toggleSelection([a.object.graphic],t,e):t.toggleTool()})];case"reshape-3d":return[o.events.on("reshape",a=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:C(g({},a),{mover:a.object.graphic}),type:"update"})}),o.events.on("move",a=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:C(g({},a),{mover:a.object.graphic}),type:"update"})}),o.events.on("vertex-add",a=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:a,type:"update"})}),o.events.on("vertex-remove",a=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:a,type:"update"})}),o.events.on("immediate-click",a=>{a.shiftKey?this._toggleSelection([a.object.graphic],t,e):t.toggleTool()})]}}_onTransformOrReshape2DGraphicClick(t,e,o){let{graphic:a,viewEvent:i}=o;return i.native?.shiftKey&&a.layer===this.layer?(i.stopPropagation(),t.removeFromSelection(a)):e.toggleToolOnClick?(i.stopPropagation(),t.toggleTool()):void 0}_setUpdateOperationHandle(t,e){this._operationHandle=t;let o=this.view?.map;this._disablePopup(e);let a=()=>{if(t===this._operationHandle){let i=this.updateGraphics.toArray(),r=this._operationHandle.tool;this._operationHandle.destroy(),this._operationHandle=null,this._internalGraphicsLayer.removeMany(this.updateGraphics.toArray()),this.updateGraphics.removeAll(),o&&o.remove(this._internalGraphicsLayer),this._restorePopup(e),this.emit("update",{graphics:i,state:"complete",aborted:t.cancelled,tool:r,toolEventInfo:null,type:"update"})}};t.on("complete",a)}_getCommonUpdateOperationClickHandlers(t,e,o){return v(this,null,function*(){let a=J(e),i=yield e.async(()=>this._getFirstHit(a));if(i==null)return void t.complete();if(e.native.shiftKey&&this._toggleSelection([i.graphic],t,o))return void e.stopPropagation();this.updateGraphics.includes(i.graphic)?e.stopPropagation():t.complete()})}_toggleSelection(t,e,o){let a=!!o.multipleSelectionEnabled;return t.some(i=>i!=null&&!(!a||i.layer!==this.layer)&&(this.updateGraphics.includes(i)?e.removeFromSelection(i):e.addToSelection(i),!0))}_getCommonUpdateOperationKeyDownHandlers(t,e){if(!t)return;let o=e.key;o===b.undo&&t.canUndo()?(e.stopPropagation(),t.undo()):o===b.redo&&t.canRedo()?(e.stopPropagation(),t.redo()):o===b.cancel?(e.stopPropagation(),t.cancel()):this.allowDeleteKey&&b.delete.includes(o)&&this._onDeleteKey(e)}_onDeleteKey(t){if(!this._operationHandle||this._operationHandle.type!=="update")return;let e=this.activeComponent,o=this.updateGraphics.toArray();e!=null&&(e.type!=="reshape"||o.length===1&&o[0].geometry?.type==="point")&&(t.stopPropagation(),this.delete())}_removeDefaultLayer(){this._internalGraphicsLayer&&(this.view?.map?.remove(this._internalGraphicsLayer),this._internalGraphicsLayer=I(this._internalGraphicsLayer))}_isComponentGraphic(t){let{activeComponent:e}=this;return!(!t||e==null)&&(t.attributes?.esriSketchTool||e.type==="draw-2d"&&e.graphic===t||(e.type==="box"||e.type==="reshape")&&e.isUIGraphic(t))}_displayPointerCursor(){this.view?.container&&this.view.cursor!=="pointer"&&(this.view.cursor="pointer")}_displayGrabbingCursor(){this.view?.container&&this.view.cursor!=="grabbing"&&(this.view.cursor="grabbing")}_displayDefaultCursor(){this.view?.container&&this.view.cursor!==null&&(this.view.cursor=null)}_logError(t,e,o){it.getLogger(this).error(new rt(t,e,o))}_requireModule(t){return v(this,null,function*(){let e=new AbortController;this._moduleLoaderAbortController=e;let o=yield t;return this._moduleLoaderAbortController!==e||e.signal.aborted?{requireError:"aborted"}:{module:o}})}_emitUndoEvent(t){this.emit("undo",C(g({},t),{type:"undo"}))}_emitRedoEvent(t){this.emit("redo",C(g({},t),{type:"redo"}))}_emitDeleteEvent(t){this.emit("delete",C(g({},t),{type:"delete"}))}get test(){}wait(){return z(()=>!this.updating)}_disablePopupEnabled(t){return this.view?.type!=="3d"||this.updateOnGraphicClick||(t?.toggleToolOnClick??!1)}_disablePopup(t){this._disablePopupEnabled(t)&&this.view&&this._originalPopupEnabled==null&&(this._originalPopupEnabled=this.view.popupEnabled,this.view.popupEnabled=!1)}_restorePopup(t){this._disablePopupEnabled(t)&&this.view&&this._originalPopupEnabled!=null&&(this.view.popupEnabled=this._originalPopupEnabled,this._originalPopupEnabled=null)}_waitViewReady(){return v(this,null,function*(){let t=this.view;t?(L(this._viewReadyAbortController),this._viewReadyAbortController=new AbortController,yield st(z(()=>t?.ready),this._viewReadyAbortController.signal)):this._logMissingView()})}_logMissingView(){this._logError("sketch:missing-property",Ut("view"))}_logMissingLayer(){this._logError(jt,Ut("layer"))}};c([d()],f.prototype,"_defaultSnappingManager",void 0),c([d()],f.prototype,"updating",null),c([d({readOnly:!0})],f.prototype,"_updatingHandles",void 0),c([d()],f.prototype,"_operationHandle",void 0),c([d({readOnly:!0})],f.prototype,"activeTool",null),c([d({readOnly:!0})],f.prototype,"activeCreateToolDrawMode",null),c([d()],f.prototype,"activeTooltip",null),c([d({types:D})],f.prototype,"activeFillSymbol",void 0),c([d()],f.prototype,"activeLineSymbol",void 0),c([d()],f.prototype,"activeVertexSymbol",void 0),c([d()],f.prototype,"allowDeleteKey",void 0),c([d({readOnly:!0})],f.prototype,"createGraphic",null),c([d()],f.prototype,"defaultCreateOptions",null),c([d()],f.prototype,"defaultUpdateOptions",null),c([d({type:Tt,nonNullable:!0})],f.prototype,"labelOptions",null),c([d()],f.prototype,"layer",void 0),c([d({types:D})],f.prototype,"pointSymbol",void 0),c([d({types:D})],f.prototype,"polygonSymbol",void 0),c([d({types:D})],f.prototype,"polylineSymbol",void 0),c([d()],f.prototype,"meshSymbol",void 0),c([d({type:Q,nonNullable:!0})],f.prototype,"snappingOptions",null),c([d()],f.prototype,"snappingManager",null),c([d({readOnly:!0})],f.prototype,"state",null),c([d({type:St,nonNullable:!0})],f.prototype,"tooltipOptions",null),c([d({readOnly:!0})],f.prototype,"updateGraphics",void 0),c([d()],f.prototype,"updateOnGraphicClick",void 0),c([d()],f.prototype,"creationMode",void 0),c([d({type:Mt,nonNullable:!0})],f.prototype,"valueOptions",null),c([d({types:D})],f.prototype,"vertexSymbol",void 0),c([d({value:null})],f.prototype,"view",null),c([d({constructOnly:!0,type:X})],f.prototype,"sketchOptions",void 0),f=c([R("esri.widgets.Sketch.SketchViewModel")],f);var jt="sketch:missing-property",Ut=t=>`Property '${t}' is missing on SketchViewModel.`;function Vt(t){return t==="polygon"||t==="rectangle"||t==="circle"}function V(t,e){Lt("undo",t.history.undo,t.history.redo,e)}function K(t,e){Lt("redo",t.history.redo,t.history.undo,e)}function Lt(t,e,o,a){let i=e.pop();if(!i)return;let r=i.updates,l=[];a.forEach((n,p)=>{let s=r[p];s!=null&&("geometry"in s&&s.geometry!=null&&(l.push({geometry:n.geometry}),n.geometry=s.geometry),"symbol"in s&&s.symbol!=null&&(l.push({symbol:n.symbol}),n.symbol=s.symbol),"undo"in s&&(l.push(s),s[t](n)))}),o.push({updates:l})}function xt(t,e){t!=null&&e.hasGrabbedManipulators&&(t.activeTool=null)}function k(t){return{updates:t.map(({geometry:e})=>e?.type==="mesh"?{geometry:e.cloneShallow()}:{geometry:e})}}function W(t,e){t.tools?.remove(e),e.destroyed||e.destroy()}function O(t){return"requireError"in t&&t.requireError==="aborted"}var Xe=f;export{ne as a,Rt as b,Xe as c};
