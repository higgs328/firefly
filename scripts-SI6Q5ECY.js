(function(xt,nt){typeof exports=="object"&&typeof module<"u"?module.exports=nt():typeof define=="function"&&define.amd?define(nt):(xt=typeof globalThis<"u"?globalThis:xt||self).MapboxDraw=nt()})(this,function(){"use strict";var xt=function(t,e){var n={drag:[],click:[],mousemove:[],mousedown:[],mouseup:[],mouseout:[],keydown:[],keyup:[],touchstart:[],touchmove:[],touchend:[],tap:[]},o={on:function(i,a,l){if(n[i]===void 0)throw new Error("Invalid event type: "+i);n[i].push({selector:a,fn:l})},render:function(i){e.store.featureChanged(i)}},r=function(i,a){for(var l=n[i],d=l.length;d--;){var h=l[d];if(h.selector(a)){h.fn.call(o,a)||e.store.render(),e.ui.updateMapClasses();break}}};return t.start.call(o),{render:t.render,stop:function(){t.stop&&t.stop()},trash:function(){t.trash&&(t.trash(),e.store.render())},combineFeatures:function(){t.combineFeatures&&t.combineFeatures()},uncombineFeatures:function(){t.uncombineFeatures&&t.uncombineFeatures()},drag:function(i){r("drag",i)},click:function(i){r("click",i)},mousemove:function(i){r("mousemove",i)},mousedown:function(i){r("mousedown",i)},mouseup:function(i){r("mouseup",i)},mouseout:function(i){r("mouseout",i)},keydown:function(i){r("keydown",i)},keyup:function(i){r("keyup",i)},touchstart:function(i){r("touchstart",i)},touchmove:function(i){r("touchmove",i)},touchend:function(i){r("touchend",i)},tap:function(i){r("tap",i)}}};function nt(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function Xn(t){if(t.__esModule)return t;var e=t.default;if(typeof e=="function"){var n=function o(){if(this instanceof o){var r=[null];r.push.apply(r,arguments);var i=Function.bind.apply(e,r);return new i}return e.apply(this,arguments)};n.prototype=e.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(t).forEach(function(o){var r=Object.getOwnPropertyDescriptor(t,o);Object.defineProperty(n,o,r.get?r:{enumerable:!0,get:function(){return t[o]}})}),n}var be={},Zn={RADIUS:6378137,FLATTENING:1/298.257223563,POLAR_RADIUS:63567523142e-4},He=Zn;function Xe(t){var e=0;if(t&&t.length>0){e+=Math.abs(Ee(t[0]));for(var n=1;n<t.length;n++)e-=Math.abs(Ee(t[n]))}return e}function Ee(t){var e,n,o,r,i,a,l=0,d=t.length;if(d>2){for(a=0;a<d;a++)a===d-2?(o=d-2,r=d-1,i=0):a===d-1?(o=d-1,r=0,i=1):(o=a,r=a+1,i=a+2),e=t[o],n=t[r],l+=(Te(t[i][0])-Te(e[0]))*Math.sin(Te(n[1]));l=l*He.RADIUS*He.RADIUS/2}return l}function Te(t){return t*Math.PI/180}be.geometry=function t(e){var n,o=0;switch(e.type){case"Polygon":return Xe(e.coordinates);case"MultiPolygon":for(n=0;n<e.coordinates.length;n++)o+=Xe(e.coordinates[n]);return o;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for(n=0;n<e.geometries.length;n++)o+=t(e.geometries[n]);return o}},be.ring=Ee;var q={CONTROL_BASE:"mapboxgl-ctrl",CONTROL_PREFIX:"mapboxgl-ctrl-",CONTROL_BUTTON:"mapbox-gl-draw_ctrl-draw-btn",CONTROL_BUTTON_LINE:"mapbox-gl-draw_line",CONTROL_BUTTON_POLYGON:"mapbox-gl-draw_polygon",CONTROL_BUTTON_POINT:"mapbox-gl-draw_point",CONTROL_BUTTON_TRASH:"mapbox-gl-draw_trash",CONTROL_BUTTON_COMBINE_FEATURES:"mapbox-gl-draw_combine",CONTROL_BUTTON_UNCOMBINE_FEATURES:"mapbox-gl-draw_uncombine",CONTROL_GROUP:"mapboxgl-ctrl-group",ATTRIBUTION:"mapboxgl-ctrl-attrib",ACTIVE_BUTTON:"active",BOX_SELECT:"mapbox-gl-draw_boxselect"},X={HOT:"mapbox-gl-draw-hot",COLD:"mapbox-gl-draw-cold"},N={ADD:"add",MOVE:"move",DRAG:"drag",POINTER:"pointer",NONE:"none"},Y={POLYGON:"polygon",LINE:"line_string",POINT:"point"},m={FEATURE:"Feature",POLYGON:"Polygon",LINE_STRING:"LineString",POINT:"Point",FEATURE_COLLECTION:"FeatureCollection",MULTI_PREFIX:"Multi",MULTI_POINT:"MultiPoint",MULTI_LINE_STRING:"MultiLineString",MULTI_POLYGON:"MultiPolygon"},T={DRAW_LINE_STRING:"draw_line_string",DRAW_POLYGON:"draw_polygon",DRAW_POINT:"draw_point",SIMPLE_SELECT:"simple_select",DIRECT_SELECT:"direct_select",STATIC:"static"},H={CREATE:"draw.create",DELETE:"draw.delete",UPDATE:"draw.update",SELECTION_CHANGE:"draw.selectionchange",MODE_CHANGE:"draw.modechange",ACTIONABLE:"draw.actionable",RENDER:"draw.render",COMBINE_FEATURES:"draw.combine",UNCOMBINE_FEATURES:"draw.uncombine"},Ce={MOVE:"move",CHANGE_COORDINATES:"change_coordinates"},B={FEATURE:"feature",MIDPOINT:"midpoint",VERTEX:"vertex"},j={ACTIVE:"true",INACTIVE:"false"},Ze=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate"],Oe=-85,Wn=Object.freeze({__proto__:null,classes:q,sources:X,cursors:N,types:Y,geojsonTypes:m,modes:T,events:H,updateActions:Ce,meta:B,activeStates:j,interactions:Ze,LAT_MIN:-90,LAT_RENDERED_MIN:Oe,LAT_MAX:90,LAT_RENDERED_MAX:85,LNG_MIN:-270,LNG_MAX:270}),We={Point:0,LineString:1,MultiLineString:1,Polygon:2};function Kn(t,e){var n=We[t.geometry.type]-We[e.geometry.type];return n===0&&t.geometry.type===m.POLYGON?t.area-e.area:n}function Ke(t){return t.map(function(e){return e.geometry.type===m.POLYGON&&(e.area=be.geometry({type:m.FEATURE,property:{},geometry:e.geometry})),e}).sort(Kn).map(function(e){return delete e.area,e})}function Qe(t,e){return e===void 0&&(e=0),[[t.point.x-e,t.point.y-e],[t.point.x+e,t.point.y+e]]}function Z(t){if(this._items={},this._nums={},this._length=t?t.length:0,t)for(var e=0,n=t.length;e<n;e++)this.add(t[e]),t[e]!==void 0&&(typeof t[e]=="string"?this._items[t[e]]=e:this._nums[t[e]]=e)}Z.prototype.add=function(t){return this.has(t)||(this._length++,typeof t=="string"?this._items[t]=this._length:this._nums[t]=this._length),this},Z.prototype.delete=function(t){return this.has(t)===!1||(this._length--,delete this._items[t],delete this._nums[t]),this},Z.prototype.has=function(t){return(typeof t=="string"||typeof t=="number")&&(this._items[t]!==void 0||this._nums[t]!==void 0)},Z.prototype.values=function(){var t=this,e=[];return Object.keys(this._items).forEach(function(n){e.push({k:n,v:t._items[n]})}),Object.keys(this._nums).forEach(function(n){e.push({k:JSON.parse(n),v:t._nums[n]})}),e.sort(function(n,o){return n.v-o.v}).map(function(n){return n.k})},Z.prototype.clear=function(){return this._length=0,this._items={},this._nums={},this};var Qn=[B.FEATURE,B.MIDPOINT,B.VERTEX],Mt={click:function(t,e,n){return tn(t,e,n,n.options.clickBuffer)},touch:function(t,e,n){return tn(t,e,n,n.options.touchBuffer)}};function tn(t,e,n,o){if(n.map===null)return[];var r=t?Qe(t,o):e,i={};n.options.styles&&(i.layers=n.options.styles.map(function(h){return h.id}).filter(function(h){return n.map.getLayer(h)!=null}));var a=n.map.queryRenderedFeatures(r,i).filter(function(h){return Qn.indexOf(h.properties.meta)!==-1}),l=new Z,d=[];return a.forEach(function(h){var g=h.properties.id;l.has(g)||(l.add(g),d.push(h))}),Ke(d)}function zt(t,e){var n=Mt.click(t,null,e),o={mouse:N.NONE};return n[0]&&(o.mouse=n[0].properties.active===j.ACTIVE?N.MOVE:N.POINTER,o.feature=n[0].properties.meta),e.events.currentModeName().indexOf("draw")!==-1&&(o.mouse=N.ADD),e.ui.queueMapClasses(o),e.ui.updateMapClasses(),n[0]}function Se(t,e){var n=t.x-e.x,o=t.y-e.y;return Math.sqrt(n*n+o*o)}function Ie(t,e,n){n===void 0&&(n={});var o=n.fineTolerance!=null?n.fineTolerance:4,r=n.grossTolerance!=null?n.grossTolerance:12,i=n.interval!=null?n.interval:500;t.point=t.point||e.point,t.time=t.time||e.time;var a=Se(t.point,e.point);return a<o||a<r&&e.time-t.time<i}function xe(t,e,n){n===void 0&&(n={});var o=n.tolerance!=null?n.tolerance:25,r=n.interval!=null?n.interval:250;return t.point=t.point||e.point,t.time=t.time||e.time,Se(t.point,e.point)<o&&e.time-t.time<r}var en={exports:{}},Me=en.exports=function(t,e){if(e||(e=16),t===void 0&&(t=128),t<=0)return"0";for(var n=Math.log(Math.pow(2,t))/Math.log(e),o=2;n===1/0;o*=2)n=Math.log(Math.pow(2,t/o))/Math.log(e)*o;var r=n-Math.floor(n),i="";for(o=0;o<Math.floor(n);o++)i=Math.floor(Math.random()*e).toString(e)+i;if(r){var a=Math.pow(e,r);i=Math.floor(Math.random()*a).toString(e)+i}var l=parseInt(i,e);return l!==1/0&&l>=Math.pow(2,t)?Me(t,e):i};Me.rack=function(t,e,n){var o=function(i){var a=0;do{if(a++>10){if(!n)throw new Error("too many ID collisions, use more bits");t+=n}var l=Me(t,e)}while(Object.hasOwnProperty.call(r,l));return r[l]=i,l},r=o.hats={};return o.get=function(i){return o.hats[i]},o.set=function(i,a){return o.hats[i]=a,o},o.bits=t||128,o.base=e||16,o};var Le=nt(en.exports),G=function(t,e){this.ctx=t,this.properties=e.properties||{},this.coordinates=e.geometry.coordinates,this.id=e.id||Le(),this.type=e.geometry.type};G.prototype.changed=function(){this.ctx.store.featureChanged(this.id)},G.prototype.incomingCoords=function(t){this.setCoordinates(t)},G.prototype.setCoordinates=function(t){this.coordinates=t,this.changed()},G.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.coordinates))},G.prototype.setProperty=function(t,e){this.properties[t]=e},G.prototype.toGeoJSON=function(){return JSON.parse(JSON.stringify({id:this.id,type:m.FEATURE,properties:this.properties,geometry:{coordinates:this.getCoordinates(),type:this.type}}))},G.prototype.internal=function(t){var e={id:this.id,meta:B.FEATURE,"meta:type":this.type,active:j.INACTIVE,mode:t};if(this.ctx.options.userProperties)for(var n in this.properties)e["user_"+n]=this.properties[n];return{type:m.FEATURE,properties:e,geometry:{coordinates:this.getCoordinates(),type:this.type}}};var mt=function(t,e){G.call(this,t,e)};(mt.prototype=Object.create(G.prototype)).isValid=function(){return typeof this.coordinates[0]=="number"&&typeof this.coordinates[1]=="number"},mt.prototype.updateCoordinate=function(t,e,n){this.coordinates=arguments.length===3?[e,n]:[t,e],this.changed()},mt.prototype.getCoordinate=function(){return this.getCoordinates()};var at=function(t,e){G.call(this,t,e)};(at.prototype=Object.create(G.prototype)).isValid=function(){return this.coordinates.length>1},at.prototype.addCoordinate=function(t,e,n){this.changed();var o=parseInt(t,10);this.coordinates.splice(o,0,[e,n])},at.prototype.getCoordinate=function(t){var e=parseInt(t,10);return JSON.parse(JSON.stringify(this.coordinates[e]))},at.prototype.removeCoordinate=function(t){this.changed(),this.coordinates.splice(parseInt(t,10),1)},at.prototype.updateCoordinate=function(t,e,n){var o=parseInt(t,10);this.coordinates[o]=[e,n],this.changed()};var W=function(t,e){G.call(this,t,e),this.coordinates=this.coordinates.map(function(n){return n.slice(0,-1)})};(W.prototype=Object.create(G.prototype)).isValid=function(){return this.coordinates.length!==0&&this.coordinates.every(function(t){return t.length>2})},W.prototype.incomingCoords=function(t){this.coordinates=t.map(function(e){return e.slice(0,-1)}),this.changed()},W.prototype.setCoordinates=function(t){this.coordinates=t,this.changed()},W.prototype.addCoordinate=function(t,e,n){this.changed();var o=t.split(".").map(function(r){return parseInt(r,10)});this.coordinates[o[0]].splice(o[1],0,[e,n])},W.prototype.removeCoordinate=function(t){this.changed();var e=t.split(".").map(function(o){return parseInt(o,10)}),n=this.coordinates[e[0]];n&&(n.splice(e[1],1),n.length<3&&this.coordinates.splice(e[0],1))},W.prototype.getCoordinate=function(t){var e=t.split(".").map(function(o){return parseInt(o,10)}),n=this.coordinates[e[0]];return JSON.parse(JSON.stringify(n[e[1]]))},W.prototype.getCoordinates=function(){return this.coordinates.map(function(t){return t.concat([t[0]])})},W.prototype.updateCoordinate=function(t,e,n){this.changed();var o=t.split("."),r=parseInt(o[0],10),i=parseInt(o[1],10);this.coordinates[r]===void 0&&(this.coordinates[r]=[]),this.coordinates[r][i]=[e,n]};var to={MultiPoint:mt,MultiLineString:at,MultiPolygon:W},Yt=function(t,e,n,o,r){var i=n.split("."),a=parseInt(i[0],10),l=i[1]?i.slice(1).join("."):null;return t[a][e](l,o,r)},$=function(t,e){if(G.call(this,t,e),delete this.coordinates,this.model=to[e.geometry.type],this.model===void 0)throw new TypeError(e.geometry.type+" is not a valid type");this.features=this._coordinatesToFeatures(e.geometry.coordinates)};function E(t){this.map=t.map,this.drawConfig=JSON.parse(JSON.stringify(t.options||{})),this._ctx=t}($.prototype=Object.create(G.prototype))._coordinatesToFeatures=function(t){var e=this,n=this.model.bind(this);return t.map(function(o){return new n(e.ctx,{id:Le(),type:m.FEATURE,properties:{},geometry:{coordinates:o,type:e.type.replace("Multi","")}})})},$.prototype.isValid=function(){return this.features.every(function(t){return t.isValid()})},$.prototype.setCoordinates=function(t){this.features=this._coordinatesToFeatures(t),this.changed()},$.prototype.getCoordinate=function(t){return Yt(this.features,"getCoordinate",t)},$.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.features.map(function(t){return t.type===m.POLYGON?t.getCoordinates():t.coordinates})))},$.prototype.updateCoordinate=function(t,e,n){Yt(this.features,"updateCoordinate",t,e,n),this.changed()},$.prototype.addCoordinate=function(t,e,n){Yt(this.features,"addCoordinate",t,e,n),this.changed()},$.prototype.removeCoordinate=function(t){Yt(this.features,"removeCoordinate",t),this.changed()},$.prototype.getFeatures=function(){return this.features},E.prototype.setSelected=function(t){return this._ctx.store.setSelected(t)},E.prototype.setSelectedCoordinates=function(t){var e=this;this._ctx.store.setSelectedCoordinates(t),t.reduce(function(n,o){return n[o.feature_id]===void 0&&(n[o.feature_id]=!0,e._ctx.store.get(o.feature_id).changed()),n},{})},E.prototype.getSelected=function(){return this._ctx.store.getSelected()},E.prototype.getSelectedIds=function(){return this._ctx.store.getSelectedIds()},E.prototype.isSelected=function(t){return this._ctx.store.isSelected(t)},E.prototype.getFeature=function(t){return this._ctx.store.get(t)},E.prototype.select=function(t){return this._ctx.store.select(t)},E.prototype.deselect=function(t){return this._ctx.store.deselect(t)},E.prototype.deleteFeature=function(t,e){return e===void 0&&(e={}),this._ctx.store.delete(t,e)},E.prototype.addFeature=function(t){return this._ctx.store.add(t)},E.prototype.clearSelectedFeatures=function(){return this._ctx.store.clearSelected()},E.prototype.clearSelectedCoordinates=function(){return this._ctx.store.clearSelectedCoordinates()},E.prototype.setActionableState=function(t){t===void 0&&(t={});var e={trash:t.trash||!1,combineFeatures:t.combineFeatures||!1,uncombineFeatures:t.uncombineFeatures||!1};return this._ctx.events.actionable(e)},E.prototype.changeMode=function(t,e,n){return e===void 0&&(e={}),n===void 0&&(n={}),this._ctx.events.changeMode(t,e,n)},E.prototype.updateUIClasses=function(t){return this._ctx.ui.queueMapClasses(t)},E.prototype.activateUIButton=function(t){return this._ctx.ui.setActiveButton(t)},E.prototype.featuresAt=function(t,e,n){if(n===void 0&&(n="click"),n!=="click"&&n!=="touch")throw new Error("invalid buffer type");return Mt[n](t,e,this._ctx)},E.prototype.newFeature=function(t){var e=t.geometry.type;return e===m.POINT?new mt(this._ctx,t):e===m.LINE_STRING?new at(this._ctx,t):e===m.POLYGON?new W(this._ctx,t):new $(this._ctx,t)},E.prototype.isInstanceOf=function(t,e){if(t===m.POINT)return e instanceof mt;if(t===m.LINE_STRING)return e instanceof at;if(t===m.POLYGON)return e instanceof W;if(t==="MultiFeature")return e instanceof $;throw new Error("Unknown feature class: "+t)},E.prototype.doRender=function(t){return this._ctx.store.featureChanged(t)},E.prototype.onSetup=function(){},E.prototype.onDrag=function(){},E.prototype.onClick=function(){},E.prototype.onMouseMove=function(){},E.prototype.onMouseDown=function(){},E.prototype.onMouseUp=function(){},E.prototype.onMouseOut=function(){},E.prototype.onKeyUp=function(){},E.prototype.onKeyDown=function(){},E.prototype.onTouchStart=function(){},E.prototype.onTouchMove=function(){},E.prototype.onTouchEnd=function(){},E.prototype.onTap=function(){},E.prototype.onStop=function(){},E.prototype.onTrash=function(){},E.prototype.onCombineFeature=function(){},E.prototype.onUncombineFeature=function(){},E.prototype.toDisplayFeatures=function(){throw new Error("You must overwrite toDisplayFeatures")};var nn={drag:"onDrag",click:"onClick",mousemove:"onMouseMove",mousedown:"onMouseDown",mouseup:"onMouseUp",mouseout:"onMouseOut",keyup:"onKeyUp",keydown:"onKeyDown",touchstart:"onTouchStart",touchmove:"onTouchMove",touchend:"onTouchEnd",tap:"onTap"},eo=Object.keys(nn);function no(t){var e=Object.keys(t);return function(n,o){o===void 0&&(o={});var r={},i=e.reduce(function(a,l){return a[l]=t[l],a},new E(n));return{start:function(){var a=this;r=i.onSetup(o),eo.forEach(function(l){var d,h=nn[l],g=function(){return!1};t[h]&&(g=function(){return!0}),a.on(l,g,(d=h,function(p){return i[d](r,p)}))})},stop:function(){i.onStop(r)},trash:function(){i.onTrash(r)},combineFeatures:function(){i.onCombineFeatures(r)},uncombineFeatures:function(){i.onUncombineFeatures(r)},render:function(a,l){i.toDisplayFeatures(r,a,l)}}}}function kt(t){return[].concat(t).filter(function(e){return e!==void 0})}function oo(){var t=this;if(!(t.ctx.map&&t.ctx.map.getSource(X.HOT)!==void 0))return d();var e=t.ctx.events.currentModeName();t.ctx.ui.queueMapClasses({mode:e});var n=[],o=[];t.isDirty?o=t.getAllIds():(n=t.getChangedIds().filter(function(h){return t.get(h)!==void 0}),o=t.sources.hot.filter(function(h){return h.properties.id&&n.indexOf(h.properties.id)===-1&&t.get(h.properties.id)!==void 0}).map(function(h){return h.properties.id})),t.sources.hot=[];var r=t.sources.cold.length;t.sources.cold=t.isDirty?[]:t.sources.cold.filter(function(h){var g=h.properties.id||h.properties.parent;return n.indexOf(g)===-1});var i=r!==t.sources.cold.length||o.length>0;function a(h,g){var p=t.get(h).internal(e);t.ctx.events.currentModeRender(p,function(_){t.sources[g].push(_)})}if(n.forEach(function(h){return a(h,"hot")}),o.forEach(function(h){return a(h,"cold")}),i&&t.ctx.map.getSource(X.COLD).setData({type:m.FEATURE_COLLECTION,features:t.sources.cold}),t.ctx.map.getSource(X.HOT).setData({type:m.FEATURE_COLLECTION,features:t.sources.hot}),t._emitSelectionChange&&(t.ctx.map.fire(H.SELECTION_CHANGE,{features:t.getSelected().map(function(h){return h.toGeoJSON()}),points:t.getSelectedCoordinates().map(function(h){return{type:m.FEATURE,properties:{},geometry:{type:m.POINT,coordinates:h.coordinates}}})}),t._emitSelectionChange=!1),t._deletedFeaturesToEmit.length){var l=t._deletedFeaturesToEmit.map(function(h){return h.toGeoJSON()});t._deletedFeaturesToEmit=[],t.ctx.map.fire(H.DELETE,{features:l})}function d(){t.isDirty=!1,t.clearChangedIds()}d(),t.ctx.map.fire(H.RENDER,{})}function x(t){var e,n=this;this._features={},this._featureIds=new Z,this._selectedFeatureIds=new Z,this._selectedCoordinates=[],this._changedFeatureIds=new Z,this._deletedFeaturesToEmit=[],this._emitSelectionChange=!1,this._mapInitialConfig={},this.ctx=t,this.sources={hot:[],cold:[]},this.render=function(){e||(e=requestAnimationFrame(function(){e=null,oo.call(n)}))},this.isDirty=!1}function on(t,e){var n=t._selectedCoordinates.filter(function(o){return t._selectedFeatureIds.has(o.feature_id)});t._selectedCoordinates.length===n.length||e.silent||(t._emitSelectionChange=!0),t._selectedCoordinates=n}x.prototype.createRenderBatch=function(){var t=this,e=this.render,n=0;return this.render=function(){n++},function(){t.render=e,n>0&&t.render()}},x.prototype.setDirty=function(){return this.isDirty=!0,this},x.prototype.featureChanged=function(t){return this._changedFeatureIds.add(t),this},x.prototype.getChangedIds=function(){return this._changedFeatureIds.values()},x.prototype.clearChangedIds=function(){return this._changedFeatureIds.clear(),this},x.prototype.getAllIds=function(){return this._featureIds.values()},x.prototype.add=function(t){return this.featureChanged(t.id),this._features[t.id]=t,this._featureIds.add(t.id),this},x.prototype.delete=function(t,e){var n=this;return e===void 0&&(e={}),kt(t).forEach(function(o){n._featureIds.has(o)&&(n._featureIds.delete(o),n._selectedFeatureIds.delete(o),e.silent||n._deletedFeaturesToEmit.indexOf(n._features[o])===-1&&n._deletedFeaturesToEmit.push(n._features[o]),delete n._features[o],n.isDirty=!0)}),on(this,e),this},x.prototype.get=function(t){return this._features[t]},x.prototype.getAll=function(){var t=this;return Object.keys(this._features).map(function(e){return t._features[e]})},x.prototype.select=function(t,e){var n=this;return e===void 0&&(e={}),kt(t).forEach(function(o){n._selectedFeatureIds.has(o)||(n._selectedFeatureIds.add(o),n._changedFeatureIds.add(o),e.silent||(n._emitSelectionChange=!0))}),this},x.prototype.deselect=function(t,e){var n=this;return e===void 0&&(e={}),kt(t).forEach(function(o){n._selectedFeatureIds.has(o)&&(n._selectedFeatureIds.delete(o),n._changedFeatureIds.add(o),e.silent||(n._emitSelectionChange=!0))}),on(this,e),this},x.prototype.clearSelected=function(t){return t===void 0&&(t={}),this.deselect(this._selectedFeatureIds.values(),{silent:t.silent}),this},x.prototype.setSelected=function(t,e){var n=this;return e===void 0&&(e={}),t=kt(t),this.deselect(this._selectedFeatureIds.values().filter(function(o){return t.indexOf(o)===-1}),{silent:e.silent}),this.select(t.filter(function(o){return!n._selectedFeatureIds.has(o)}),{silent:e.silent}),this},x.prototype.setSelectedCoordinates=function(t){return this._selectedCoordinates=t,this._emitSelectionChange=!0,this},x.prototype.clearSelectedCoordinates=function(){return this._selectedCoordinates=[],this._emitSelectionChange=!0,this},x.prototype.getSelectedIds=function(){return this._selectedFeatureIds.values()},x.prototype.getSelected=function(){var t=this;return this._selectedFeatureIds.values().map(function(e){return t.get(e)})},x.prototype.getSelectedCoordinates=function(){var t=this;return this._selectedCoordinates.map(function(e){return{coordinates:t.get(e.feature_id).getCoordinate(e.coord_path)}})},x.prototype.isSelected=function(t){return this._selectedFeatureIds.has(t)},x.prototype.setFeatureProperty=function(t,e,n){this.get(t).setProperty(e,n),this.featureChanged(t)},x.prototype.storeMapConfig=function(){var t=this;Ze.forEach(function(e){t.ctx.map[e]&&(t._mapInitialConfig[e]=t.ctx.map[e].isEnabled())})},x.prototype.restoreMapConfig=function(){var t=this;Object.keys(this._mapInitialConfig).forEach(function(e){t._mapInitialConfig[e]?t.ctx.map[e].enable():t.ctx.map[e].disable()})},x.prototype.getInitialConfigValue=function(t){return this._mapInitialConfig[t]===void 0||this._mapInitialConfig[t]};var ro=function(){for(var t=arguments,e={},n=0;n<arguments.length;n++){var o=t[n];for(var r in o)io.call(o,r)&&(e[r]=o[r])}return e},io=Object.prototype.hasOwnProperty,pt=nt(ro),ao=["mode","feature","mouse"];function so(t){var e=null,n=null,o={onRemove:function(){return t.map.off("load",o.connect),clearInterval(n),o.removeLayers(),t.store.restoreMapConfig(),t.ui.removeButtons(),t.events.removeEventListeners(),t.ui.clearMapClasses(),t.boxZoomInitial&&t.map.boxZoom.enable(),t.map=null,t.container=null,t.store=null,e&&e.parentNode&&e.parentNode.removeChild(e),e=null,this},connect:function(){t.map.off("load",o.connect),clearInterval(n),o.addLayers(),t.store.storeMapConfig(),t.events.addEventListeners()},onAdd:function(r){var i=r.fire;return r.fire=function(a,l){var d=arguments;return i.length===1&&arguments.length!==1&&(d=[pt({},{type:a},l)]),i.apply(r,d)},t.map=r,t.events=function(a){var l=Object.keys(a.options.modes).reduce(function(c,y){return c[y]=no(a.options.modes[y]),c},{}),d={},h={},g={},p=null,_=null;g.drag=function(c,y){y({point:c.point,time:new Date().getTime()})?(a.ui.queueMapClasses({mouse:N.DRAG}),_.drag(c)):c.originalEvent.stopPropagation()},g.mousedrag=function(c){g.drag(c,function(y){return!Ie(d,y)})},g.touchdrag=function(c){g.drag(c,function(y){return!xe(h,y)})},g.mousemove=function(c){if((c.originalEvent.buttons!==void 0?c.originalEvent.buttons:c.originalEvent.which)===1)return g.mousedrag(c);var y=zt(c,a);c.featureTarget=y,_.mousemove(c)},g.mousedown=function(c){d={time:new Date().getTime(),point:c.point};var y=zt(c,a);c.featureTarget=y,_.mousedown(c)},g.mouseup=function(c){var y=zt(c,a);c.featureTarget=y,Ie(d,{point:c.point,time:new Date().getTime()})?_.click(c):_.mouseup(c)},g.mouseout=function(c){_.mouseout(c)},g.touchstart=function(c){if(a.options.touchEnabled){h={time:new Date().getTime(),point:c.point};var y=Mt.touch(c,null,a)[0];c.featureTarget=y,_.touchstart(c)}},g.touchmove=function(c){if(a.options.touchEnabled)return _.touchmove(c),g.touchdrag(c)},g.touchend=function(c){if(c.originalEvent.preventDefault(),a.options.touchEnabled){var y=Mt.touch(c,null,a)[0];c.featureTarget=y,xe(h,{time:new Date().getTime(),point:c.point})?_.tap(c):_.touchend(c)}};var A=function(c){return!(c===8||c===46||c>=48&&c<=57)};function b(c,y,O){O===void 0&&(O={}),_.stop();var V=l[c];if(V===void 0)throw new Error(c+" is not valid");p=c;var w=V(a,y);_=xt(w,a),O.silent||a.map.fire(H.MODE_CHANGE,{mode:c}),a.store.setDirty(),a.store.render()}g.keydown=function(c){(c.srcElement||c.target).classList.contains("mapboxgl-canvas")&&(c.keyCode!==8&&c.keyCode!==46||!a.options.controls.trash?A(c.keyCode)?_.keydown(c):c.keyCode===49&&a.options.controls.point?b(T.DRAW_POINT):c.keyCode===50&&a.options.controls.line_string?b(T.DRAW_LINE_STRING):c.keyCode===51&&a.options.controls.polygon&&b(T.DRAW_POLYGON):(c.preventDefault(),_.trash()))},g.keyup=function(c){A(c.keyCode)&&_.keyup(c)},g.zoomend=function(){a.store.changeZoom()},g.data=function(c){if(c.dataType==="style"){var y=a.setup,O=a.map,V=a.options,w=a.store;V.styles.some(function(De){return O.getLayer(De.id)})||(y.addLayers(),w.setDirty(),w.render())}};var F={trash:!1,combineFeatures:!1,uncombineFeatures:!1};return{start:function(){p=a.options.defaultMode,_=xt(l[p](a),a)},changeMode:b,actionable:function(c){var y=!1;Object.keys(c).forEach(function(O){if(F[O]===void 0)throw new Error("Invalid action type");F[O]!==c[O]&&(y=!0),F[O]=c[O]}),y&&a.map.fire(H.ACTIONABLE,{actions:F})},currentModeName:function(){return p},currentModeRender:function(c,y){return _.render(c,y)},fire:function(c,y){g[c]&&g[c](y)},addEventListeners:function(){a.map.on("mousemove",g.mousemove),a.map.on("mousedown",g.mousedown),a.map.on("mouseup",g.mouseup),a.map.on("data",g.data),a.map.on("touchmove",g.touchmove),a.map.on("touchstart",g.touchstart),a.map.on("touchend",g.touchend),a.container.addEventListener("mouseout",g.mouseout),a.options.keybindings&&(a.container.addEventListener("keydown",g.keydown),a.container.addEventListener("keyup",g.keyup))},removeEventListeners:function(){a.map.off("mousemove",g.mousemove),a.map.off("mousedown",g.mousedown),a.map.off("mouseup",g.mouseup),a.map.off("data",g.data),a.map.off("touchmove",g.touchmove),a.map.off("touchstart",g.touchstart),a.map.off("touchend",g.touchend),a.container.removeEventListener("mouseout",g.mouseout),a.options.keybindings&&(a.container.removeEventListener("keydown",g.keydown),a.container.removeEventListener("keyup",g.keyup))},trash:function(c){_.trash(c)},combineFeatures:function(){_.combineFeatures()},uncombineFeatures:function(){_.uncombineFeatures()},getMode:function(){return p}}}(t),t.ui=function(a){var l={},d=null,h={mode:null,feature:null,mouse:null},g={mode:null,feature:null,mouse:null};function p(c){g=pt(g,c)}function _(){var c,y;if(a.container){var O=[],V=[];ao.forEach(function(w){g[w]!==h[w]&&(O.push(w+"-"+h[w]),g[w]!==null&&V.push(w+"-"+g[w]))}),O.length>0&&(c=a.container.classList).remove.apply(c,O),V.length>0&&(y=a.container.classList).add.apply(y,V),h=pt(h,g)}}function A(c,y){y===void 0&&(y={});var O=document.createElement("button");return O.className=q.CONTROL_BUTTON+" "+y.className,O.setAttribute("title",y.title),y.container.appendChild(O),O.addEventListener("click",function(V){if(V.preventDefault(),V.stopPropagation(),V.target===d)return b(),void y.onDeactivate();F(c),y.onActivate()},!0),O}function b(){d&&(d.classList.remove(q.ACTIVE_BUTTON),d=null)}function F(c){b();var y=l[c];y&&y&&c!=="trash"&&(y.classList.add(q.ACTIVE_BUTTON),d=y)}return{setActiveButton:F,queueMapClasses:p,updateMapClasses:_,clearMapClasses:function(){p({mode:null,feature:null,mouse:null}),_()},addButtons:function(){var c=a.options.controls,y=document.createElement("div");return y.className=q.CONTROL_GROUP+" "+q.CONTROL_BASE,c&&(c[Y.LINE]&&(l[Y.LINE]=A(Y.LINE,{container:y,className:q.CONTROL_BUTTON_LINE,title:"LineString tool "+(a.options.keybindings?"(l)":""),onActivate:function(){return a.events.changeMode(T.DRAW_LINE_STRING)},onDeactivate:function(){return a.events.trash()}})),c[Y.POLYGON]&&(l[Y.POLYGON]=A(Y.POLYGON,{container:y,className:q.CONTROL_BUTTON_POLYGON,title:"Polygon tool "+(a.options.keybindings?"(p)":""),onActivate:function(){return a.events.changeMode(T.DRAW_POLYGON)},onDeactivate:function(){return a.events.trash()}})),c[Y.POINT]&&(l[Y.POINT]=A(Y.POINT,{container:y,className:q.CONTROL_BUTTON_POINT,title:"Marker tool "+(a.options.keybindings?"(m)":""),onActivate:function(){return a.events.changeMode(T.DRAW_POINT)},onDeactivate:function(){return a.events.trash()}})),c.trash&&(l.trash=A("trash",{container:y,className:q.CONTROL_BUTTON_TRASH,title:"Delete",onActivate:function(){a.events.trash()}})),c.combine_features&&(l.combine_features=A("combineFeatures",{container:y,className:q.CONTROL_BUTTON_COMBINE_FEATURES,title:"Combine",onActivate:function(){a.events.combineFeatures()}})),c.uncombine_features&&(l.uncombine_features=A("uncombineFeatures",{container:y,className:q.CONTROL_BUTTON_UNCOMBINE_FEATURES,title:"Uncombine",onActivate:function(){a.events.uncombineFeatures()}}))),y},removeButtons:function(){Object.keys(l).forEach(function(c){var y=l[c];y.parentNode&&y.parentNode.removeChild(y),delete l[c]})}}}(t),t.container=r.getContainer(),t.store=new x(t),e=t.ui.addButtons(),t.options.boxSelect&&(t.boxZoomInitial=r.boxZoom.isEnabled(),r.boxZoom.disable(),r.dragPan.disable(),r.dragPan.enable()),r.loaded()?o.connect():(r.on("load",o.connect),n=setInterval(function(){r.loaded()&&o.connect()},16)),t.events.start(),e},addLayers:function(){t.map.addSource(X.COLD,{data:{type:m.FEATURE_COLLECTION,features:[]},type:"geojson"}),t.map.addSource(X.HOT,{data:{type:m.FEATURE_COLLECTION,features:[]},type:"geojson"}),t.options.styles.forEach(function(r){t.map.addLayer(r)}),t.store.setDirty(!0),t.store.render()},removeLayers:function(){t.options.styles.forEach(function(r){t.map.getLayer(r.id)&&t.map.removeLayer(r.id)}),t.map.getSource(X.COLD)&&t.map.removeSource(X.COLD),t.map.getSource(X.HOT)&&t.map.removeSource(X.HOT)}};return t.setup=o,o}var rn=[{id:"gl-draw-polygon-fill-inactive",type:"fill",filter:["all",["==","active","false"],["==","$type","Polygon"],["!=","mode","static"]],paint:{"fill-color":"#3bb2d0","fill-outline-color":"#3bb2d0","fill-opacity":.1}},{id:"gl-draw-polygon-fill-active",type:"fill",filter:["all",["==","active","true"],["==","$type","Polygon"]],paint:{"fill-color":"#fbb03b","fill-outline-color":"#fbb03b","fill-opacity":.1}},{id:"gl-draw-polygon-midpoint",type:"circle",filter:["all",["==","$type","Point"],["==","meta","midpoint"]],paint:{"circle-radius":3,"circle-color":"#fbb03b"}},{id:"gl-draw-polygon-stroke-inactive",type:"line",filter:["all",["==","active","false"],["==","$type","Polygon"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#3bb2d0","line-width":2}},{id:"gl-draw-polygon-stroke-active",type:"line",filter:["all",["==","active","true"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#fbb03b","line-dasharray":[.2,2],"line-width":2}},{id:"gl-draw-line-inactive",type:"line",filter:["all",["==","active","false"],["==","$type","LineString"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#3bb2d0","line-width":2}},{id:"gl-draw-line-active",type:"line",filter:["all",["==","$type","LineString"],["==","active","true"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#fbb03b","line-dasharray":[.2,2],"line-width":2}},{id:"gl-draw-polygon-and-line-vertex-stroke-inactive",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":5,"circle-color":"#fff"}},{id:"gl-draw-polygon-and-line-vertex-inactive",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":3,"circle-color":"#fbb03b"}},{id:"gl-draw-point-point-stroke-inactive",type:"circle",filter:["all",["==","active","false"],["==","$type","Point"],["==","meta","feature"],["!=","mode","static"]],paint:{"circle-radius":5,"circle-opacity":1,"circle-color":"#fff"}},{id:"gl-draw-point-inactive",type:"circle",filter:["all",["==","active","false"],["==","$type","Point"],["==","meta","feature"],["!=","mode","static"]],paint:{"circle-radius":3,"circle-color":"#3bb2d0"}},{id:"gl-draw-point-stroke-active",type:"circle",filter:["all",["==","$type","Point"],["==","active","true"],["!=","meta","midpoint"]],paint:{"circle-radius":7,"circle-color":"#fff"}},{id:"gl-draw-point-active",type:"circle",filter:["all",["==","$type","Point"],["!=","meta","midpoint"],["==","active","true"]],paint:{"circle-radius":5,"circle-color":"#fbb03b"}},{id:"gl-draw-polygon-fill-static",type:"fill",filter:["all",["==","mode","static"],["==","$type","Polygon"]],paint:{"fill-color":"#404040","fill-outline-color":"#404040","fill-opacity":.1}},{id:"gl-draw-polygon-stroke-static",type:"line",filter:["all",["==","mode","static"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#404040","line-width":2}},{id:"gl-draw-line-static",type:"line",filter:["all",["==","mode","static"],["==","$type","LineString"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#404040","line-width":2}},{id:"gl-draw-point-static",type:"circle",filter:["all",["==","mode","static"],["==","$type","Point"]],paint:{"circle-radius":5,"circle-color":"#404040"}}];function $t(t){return function(e){var n=e.featureTarget;return!!n&&!!n.properties&&n.properties.meta===t}}function an(t){return!!t.originalEvent&&!!t.originalEvent.shiftKey&&t.originalEvent.button===0}function _t(t){return!!t.featureTarget&&!!t.featureTarget.properties&&t.featureTarget.properties.active===j.ACTIVE&&t.featureTarget.properties.meta===B.FEATURE}function Ne(t){return!!t.featureTarget&&!!t.featureTarget.properties&&t.featureTarget.properties.active===j.INACTIVE&&t.featureTarget.properties.meta===B.FEATURE}function qt(t){return t.featureTarget===void 0}function Ae(t){return!!t.featureTarget&&!!t.featureTarget.properties&&t.featureTarget.properties.meta===B.FEATURE}function Dt(t){var e=t.featureTarget;return!!e&&!!e.properties&&e.properties.meta===B.VERTEX}function Ht(t){return!!t.originalEvent&&t.originalEvent.shiftKey===!0}function Xt(t){return t.keyCode===27}function Zt(t){return t.keyCode===13}var uo=Object.freeze({__proto__:null,isOfMetaType:$t,isShiftMousedown:an,isActiveFeature:_t,isInactiveFeature:Ne,noTarget:qt,isFeature:Ae,isVertex:Dt,isShiftDown:Ht,isEscapeKey:Xt,isEnterKey:Zt,isTrue:function(){return!0}}),co=Lt;function Lt(t,e){this.x=t,this.y=e}Lt.prototype={clone:function(){return new Lt(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,n=t.y-this.y;return e*e+n*n},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[0]*this.x+t[1]*this.y,n=t[2]*this.x+t[3]*this.y;return this.x=e,this.y=n,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),n=Math.sin(t),o=e*this.x-n*this.y,r=n*this.x+e*this.y;return this.x=o,this.y=r,this},_rotateAround:function(t,e){var n=Math.cos(t),o=Math.sin(t),r=e.x+n*(this.x-e.x)-o*(this.y-e.y),i=e.y+o*(this.x-e.x)+n*(this.y-e.y);return this.x=r,this.y=i,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Lt.convert=function(t){return t instanceof Lt?t:Array.isArray(t)?new Lt(t[0],t[1]):t};var lo=nt(co);function Pe(t,e){var n=e.getBoundingClientRect();return new lo(t.clientX-n.left-(e.clientLeft||0),t.clientY-n.top-(e.clientTop||0))}function Nt(t,e,n,o){return{type:m.FEATURE,properties:{meta:B.VERTEX,parent:t,coord_path:n,active:o?j.ACTIVE:j.INACTIVE},geometry:{type:m.POINT,coordinates:e}}}function sn(t,e,n){var o=e.geometry.coordinates,r=n.geometry.coordinates;if(o[1]>85||o[1]<Oe||r[1]>85||r[1]<Oe)return null;var i={lng:(o[0]+r[0])/2,lat:(o[1]+r[1])/2};return{type:m.FEATURE,properties:{meta:B.MIDPOINT,parent:t,lng:i.lng,lat:i.lat,coord_path:n.properties.coord_path},geometry:{type:m.POINT,coordinates:[i.lng,i.lat]}}}function Wt(t,e,n){e===void 0&&(e={}),n===void 0&&(n=null);var o,r=t.geometry,i=r.type,a=r.coordinates,l=t.properties&&t.properties.id,d=[];function h(p,_){var A="",b=null;p.forEach(function(F,c){var y=_!=null?_+"."+c:String(c),O=Nt(l,F,y,g(y));if(e.midpoints&&b){var V=sn(l,b,O);V&&d.push(V)}b=O;var w=JSON.stringify(F);A!==w&&d.push(O),c===0&&(A=w)})}function g(p){return!!e.selectedPaths&&e.selectedPaths.indexOf(p)!==-1}return i===m.POINT?d.push(Nt(l,a,n,g(n))):i===m.POLYGON?a.forEach(function(p,_){h(p,n!==null?n+"."+_:String(_))}):i===m.LINE_STRING?h(a,n):i.indexOf(m.MULTI_PREFIX)===0&&(o=i.replace(m.MULTI_PREFIX,""),a.forEach(function(p,_){var A={type:m.FEATURE,properties:t.properties,geometry:{type:o,coordinates:p}};d=d.concat(Wt(A,e,_))})),d}var tt={enable:function(t){setTimeout(function(){t.map&&t.map.doubleClickZoom&&t._ctx&&t._ctx.store&&t._ctx.store.getInitialConfigValue&&t._ctx.store.getInitialConfigValue("doubleClickZoom")&&t.map.doubleClickZoom.enable()},0)},disable:function(t){setTimeout(function(){t.map&&t.map.doubleClickZoom&&t.map.doubleClickZoom.disable()},0)}},Kt={exports:{}},un=function(t){if(!t||!t.type)return null;var e=po[t.type];if(!e)return null;if(e==="geometry")return{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:t}]};if(e==="feature")return{type:"FeatureCollection",features:[t]};if(e==="featurecollection")return t},po={Point:"geometry",MultiPoint:"geometry",LineString:"geometry",MultiLineString:"geometry",Polygon:"geometry",MultiPolygon:"geometry",GeometryCollection:"geometry",Feature:"feature",FeatureCollection:"featurecollection"},fo=nt(un),ho=Object.freeze({__proto__:null,default:function t(e){switch(e&&e.type||null){case"FeatureCollection":return e.features=e.features.reduce(function(n,o){return n.concat(t(o))},[]),e;case"Feature":return e.geometry?t(e.geometry).map(function(n){var o={type:"Feature",properties:JSON.parse(JSON.stringify(e.properties)),geometry:n};return e.id!==void 0&&(o.id=e.id),o}):[e];case"MultiPoint":return e.coordinates.map(function(n){return{type:"Point",coordinates:n}});case"MultiPolygon":return e.coordinates.map(function(n){return{type:"Polygon",coordinates:n}});case"MultiLineString":return e.coordinates.map(function(n){return{type:"LineString",coordinates:n}});case"GeometryCollection":return e.geometries.map(t).reduce(function(n,o){return n.concat(o)},[]);case"Point":case"Polygon":case"LineString":return[e]}}}),go=un,Qt=Xn(ho),yo=function(t){return function e(n){return Array.isArray(n)&&n.length&&typeof n[0]=="number"?[n]:n.reduce(function(o,r){return Array.isArray(r)&&Array.isArray(r[0])?o.concat(e(r)):(o.push(r),o)},[])}(t)};Qt instanceof Function||(Qt=Qt.default);var cn={exports:{}},vo=cn.exports=function(t){return new K(t)};function K(t){this.value=t}function ln(t,e,n){var o=[],r=[],i=!0;return function a(l){var d=n?dn(l):l,h={},g=!0,p={node:d,node_:l,path:[].concat(o),parent:r[r.length-1],parents:r,key:o.slice(-1)[0],isRoot:o.length===0,level:o.length,circular:null,update:function(b,F){p.isRoot||(p.parent.node[p.key]=b),p.node=b,F&&(g=!1)},delete:function(b){delete p.parent.node[p.key],b&&(g=!1)},remove:function(b){pn(p.parent.node)?p.parent.node.splice(p.key,1):delete p.parent.node[p.key],b&&(g=!1)},keys:null,before:function(b){h.before=b},after:function(b){h.after=b},pre:function(b){h.pre=b},post:function(b){h.post=b},stop:function(){i=!1},block:function(){g=!1}};if(!i)return p;function _(){if(typeof p.node=="object"&&p.node!==null){p.keys&&p.node_===p.node||(p.keys=te(p.node)),p.isLeaf=p.keys.length==0;for(var b=0;b<r.length;b++)if(r[b].node_===l){p.circular=r[b];break}}else p.isLeaf=!0,p.keys=null;p.notLeaf=!p.isLeaf,p.notRoot=!p.isRoot}_();var A=e.call(p,p.node);return A!==void 0&&p.update&&p.update(A),h.before&&h.before.call(p,p.node),g&&(typeof p.node!="object"||p.node===null||p.circular||(r.push(p),_(),ee(p.keys,function(b,F){o.push(b),h.pre&&h.pre.call(p,p.node[b],b);var c=a(p.node[b]);n&&ne.call(p.node,b)&&(p.node[b]=c.node),c.isLast=F==p.keys.length-1,c.isFirst=F==0,h.post&&h.post.call(p,c),o.pop()}),r.pop()),h.after&&h.after.call(p,p.node)),p}(t).node}function dn(t){if(typeof t=="object"&&t!==null){var e;if(pn(t))e=[];else if(At(t)==="[object Date]")e=new Date(t.getTime?t.getTime():t);else if(function(r){return At(r)==="[object RegExp]"}(t))e=new RegExp(t);else if(function(r){return At(r)==="[object Error]"}(t))e={message:t.message};else if(function(r){return At(r)==="[object Boolean]"}(t))e=new Boolean(t);else if(function(r){return At(r)==="[object Number]"}(t))e=new Number(t);else if(function(r){return At(r)==="[object String]"}(t))e=new String(t);else if(Object.create&&Object.getPrototypeOf)e=Object.create(Object.getPrototypeOf(t));else if(t.constructor===Object)e={};else{var n=t.constructor&&t.constructor.prototype||t.__proto__||{},o=function(){};o.prototype=n,e=new o}return ee(te(t),function(r){e[r]=t[r]}),e}return t}K.prototype.get=function(t){for(var e=this.value,n=0;n<t.length;n++){var o=t[n];if(!e||!ne.call(e,o)){e=void 0;break}e=e[o]}return e},K.prototype.has=function(t){for(var e=this.value,n=0;n<t.length;n++){var o=t[n];if(!e||!ne.call(e,o))return!1;e=e[o]}return!0},K.prototype.set=function(t,e){for(var n=this.value,o=0;o<t.length-1;o++){var r=t[o];ne.call(n,r)||(n[r]={}),n=n[r]}return n[t[o]]=e,e},K.prototype.map=function(t){return ln(this.value,t,!0)},K.prototype.forEach=function(t){return this.value=ln(this.value,t,!1),this.value},K.prototype.reduce=function(t,e){var n=arguments.length===1,o=n?this.value:e;return this.forEach(function(r){this.isRoot&&n||(o=t.call(this,o,r))}),o},K.prototype.paths=function(){var t=[];return this.forEach(function(e){t.push(this.path)}),t},K.prototype.nodes=function(){var t=[];return this.forEach(function(e){t.push(this.node)}),t},K.prototype.clone=function(){var t=[],e=[];return function n(o){for(var r=0;r<t.length;r++)if(t[r]===o)return e[r];if(typeof o=="object"&&o!==null){var i=dn(o);return t.push(o),e.push(i),ee(te(o),function(a){i[a]=n(o[a])}),t.pop(),e.pop(),i}return o}(this.value)};var te=Object.keys||function(t){var e=[];for(var n in t)e.push(n);return e};function At(t){return Object.prototype.toString.call(t)}var pn=Array.isArray||function(t){return Object.prototype.toString.call(t)==="[object Array]"},ee=function(t,e){if(t.forEach)return t.forEach(e);for(var n=0;n<t.length;n++)e(t[n],n,t)};ee(te(K.prototype),function(t){vo[t]=function(e){var n=[].slice.call(arguments,1),o=new K(e);return o[t].apply(o,n)}});var ne=Object.hasOwnProperty||function(t,e){return e in t},mo=cn.exports,_o=J;function J(t){if(!(this instanceof J))return new J(t);this._bbox=t||[1/0,1/0,-1/0,-1/0],this._valid=!!t}J.prototype.include=function(t){return this._valid=!0,this._bbox[0]=Math.min(this._bbox[0],t[0]),this._bbox[1]=Math.min(this._bbox[1],t[1]),this._bbox[2]=Math.max(this._bbox[2],t[0]),this._bbox[3]=Math.max(this._bbox[3],t[1]),this},J.prototype.equals=function(t){var e;return e=t instanceof J?t.bbox():t,this._bbox[0]==e[0]&&this._bbox[1]==e[1]&&this._bbox[2]==e[2]&&this._bbox[3]==e[3]},J.prototype.center=function(t){return this._valid?[(this._bbox[0]+this._bbox[2])/2,(this._bbox[1]+this._bbox[3])/2]:null},J.prototype.union=function(t){var e;return this._valid=!0,e=t instanceof J?t.bbox():t,this._bbox[0]=Math.min(this._bbox[0],e[0]),this._bbox[1]=Math.min(this._bbox[1],e[1]),this._bbox[2]=Math.max(this._bbox[2],e[2]),this._bbox[3]=Math.max(this._bbox[3],e[3]),this},J.prototype.bbox=function(){return this._valid?this._bbox:null},J.prototype.contains=function(t){if(!t)return this._fastContains();if(!this._valid)return null;var e=t[0],n=t[1];return this._bbox[0]<=e&&this._bbox[1]<=n&&this._bbox[2]>=e&&this._bbox[3]>=n},J.prototype.intersect=function(t){return this._valid?(e=t instanceof J?t.bbox():t,!(this._bbox[0]>e[2]||this._bbox[2]<e[0]||this._bbox[3]<e[1]||this._bbox[1]>e[3])):null;var e},J.prototype._fastContains=function(){if(!this._valid)return new Function("return null;");var t="return "+this._bbox[0]+"<= ll[0] &&"+this._bbox[1]+"<= ll[1] &&"+this._bbox[2]+">= ll[0] &&"+this._bbox[3]+">= ll[1]";return new Function("ll",t)},J.prototype.polygon=function(){return this._valid?{type:"Polygon",coordinates:[[[this._bbox[0],this._bbox[1]],[this._bbox[2],this._bbox[1]],[this._bbox[2],this._bbox[3]],[this._bbox[0],this._bbox[3]],[this._bbox[0],this._bbox[1]]]]}:null};var bo=function(t){if(!t)return[];var e=Qt(go(t)),n=[];return e.features.forEach(function(o){o.geometry&&(n=n.concat(yo(o.geometry.coordinates)))}),n},Eo=mo,To=_o,fn={features:["FeatureCollection"],coordinates:["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon"],geometry:["Feature"],geometries:["GeometryCollection"]},Co=Object.keys(fn);function Fe(t){for(var e=To(),n=bo(t),o=0;o<n.length;o++)e.include(n[o]);return e}Kt.exports=function(t){return Fe(t).bbox()},Kt.exports.polygon=function(t){return Fe(t).polygon()},Kt.exports.bboxify=function(t){return Eo(t).map(function(e){e&&Co.some(function(n){return!!e[n]&&fn[n].indexOf(e.type)!==-1})&&(e.bbox=Fe(e).bbox(),this.update(e))})};var Oo=nt(Kt.exports),oe=-90;function we(t,e){var n=oe,o=90,r=oe,i=90,a=270,l=-270;t.forEach(function(h){var g=Oo(h),p=g[1],_=g[3],A=g[0],b=g[2];p>n&&(n=p),_<o&&(o=_),_>r&&(r=_),p<i&&(i=p),A<a&&(a=A),b>l&&(l=b)});var d=e;return n+d.lat>85&&(d.lat=85-n),r+d.lat>90&&(d.lat=90-r),o+d.lat<-85&&(d.lat=-85-o),i+d.lat<oe&&(d.lat=oe-i),a+d.lng<=-270&&(d.lng+=360*Math.ceil(Math.abs(d.lng)/360)),l+d.lng>=270&&(d.lng-=360*Math.ceil(Math.abs(d.lng)/360)),d}function Re(t,e){var n=we(t.map(function(o){return o.toGeoJSON()}),e);t.forEach(function(o){var r,i=o.getCoordinates(),a=function(d){var h={lng:d[0]+n.lng,lat:d[1]+n.lat};return[h.lng,h.lat]},l=function(d){return d.map(function(h){return a(h)})};o.type===m.POINT?r=a(i):o.type===m.LINE_STRING||o.type===m.MULTI_POINT?r=i.map(a):o.type===m.POLYGON||o.type===m.MULTI_LINE_STRING?r=i.map(l):o.type===m.MULTI_POLYGON&&(r=i.map(function(d){return d.map(function(h){return l(h)})})),o.incomingCoords(r)})}var k={onSetup:function(t){var e=this,n={dragMoveLocation:null,boxSelectStartLocation:null,boxSelectElement:void 0,boxSelecting:!1,canBoxSelect:!1,dragMoving:!1,canDragMove:!1,initiallySelectedFeatureIds:t.featureIds||[]};return this.setSelected(n.initiallySelectedFeatureIds.filter(function(o){return e.getFeature(o)!==void 0})),this.fireActionable(),this.setActionableState({combineFeatures:!0,uncombineFeatures:!0,trash:!0}),n},fireUpdate:function(){this.map.fire(H.UPDATE,{action:Ce.MOVE,features:this.getSelected().map(function(t){return t.toGeoJSON()})})},fireActionable:function(){var t=this,e=this.getSelected(),n=e.filter(function(l){return t.isInstanceOf("MultiFeature",l)}),o=!1;if(e.length>1){o=!0;var r=e[0].type.replace("Multi","");e.forEach(function(l){l.type.replace("Multi","")!==r&&(o=!1)})}var i=n.length>0,a=e.length>0;this.setActionableState({combineFeatures:o,uncombineFeatures:i,trash:a})},getUniqueIds:function(t){return t.length?t.map(function(e){return e.properties.id}).filter(function(e){return e!==void 0}).reduce(function(e,n){return e.add(n),e},new Z).values():[]},stopExtendedInteractions:function(t){t.boxSelectElement&&(t.boxSelectElement.parentNode&&t.boxSelectElement.parentNode.removeChild(t.boxSelectElement),t.boxSelectElement=null),this.map.dragPan.enable(),t.boxSelecting=!1,t.canBoxSelect=!1,t.dragMoving=!1,t.canDragMove=!1},onStop:function(){tt.enable(this)},onMouseMove:function(t,e){return Ae(e)&&t.dragMoving&&this.fireUpdate(),this.stopExtendedInteractions(t),!0},onMouseOut:function(t){return!t.dragMoving||this.fireUpdate()}};k.onTap=k.onClick=function(t,e){return qt(e)?this.clickAnywhere(t,e):$t(B.VERTEX)(e)?this.clickOnVertex(t,e):Ae(e)?this.clickOnFeature(t,e):void 0},k.clickAnywhere=function(t){var e=this,n=this.getSelectedIds();n.length&&(this.clearSelectedFeatures(),n.forEach(function(o){return e.doRender(o)})),tt.enable(this),this.stopExtendedInteractions(t)},k.clickOnVertex=function(t,e){this.changeMode(T.DIRECT_SELECT,{featureId:e.featureTarget.properties.parent,coordPath:e.featureTarget.properties.coord_path,startPos:e.lngLat}),this.updateUIClasses({mouse:N.MOVE})},k.startOnActiveFeature=function(t,e){this.stopExtendedInteractions(t),this.map.dragPan.disable(),this.doRender(e.featureTarget.properties.id),t.canDragMove=!0,t.dragMoveLocation=e.lngLat},k.clickOnFeature=function(t,e){var n=this;tt.disable(this),this.stopExtendedInteractions(t);var o=Ht(e),r=this.getSelectedIds(),i=e.featureTarget.properties.id,a=this.isSelected(i);if(!o&&a&&this.getFeature(i).type!==m.POINT)return this.changeMode(T.DIRECT_SELECT,{featureId:i});a&&o?(this.deselect(i),this.updateUIClasses({mouse:N.POINTER}),r.length===1&&tt.enable(this)):!a&&o?(this.select(i),this.updateUIClasses({mouse:N.MOVE})):a||o||(r.forEach(function(l){return n.doRender(l)}),this.setSelected(i),this.updateUIClasses({mouse:N.MOVE})),this.doRender(i)},k.onMouseDown=function(t,e){return _t(e)?this.startOnActiveFeature(t,e):this.drawConfig.boxSelect&&an(e)?this.startBoxSelect(t,e):void 0},k.startBoxSelect=function(t,e){this.stopExtendedInteractions(t),this.map.dragPan.disable(),t.boxSelectStartLocation=Pe(e.originalEvent,this.map.getContainer()),t.canBoxSelect=!0},k.onTouchStart=function(t,e){if(_t(e))return this.startOnActiveFeature(t,e)},k.onDrag=function(t,e){return t.canDragMove?this.dragMove(t,e):this.drawConfig.boxSelect&&t.canBoxSelect?this.whileBoxSelect(t,e):void 0},k.whileBoxSelect=function(t,e){t.boxSelecting=!0,this.updateUIClasses({mouse:N.ADD}),t.boxSelectElement||(t.boxSelectElement=document.createElement("div"),t.boxSelectElement.classList.add(q.BOX_SELECT),this.map.getContainer().appendChild(t.boxSelectElement));var n=Pe(e.originalEvent,this.map.getContainer()),o=Math.min(t.boxSelectStartLocation.x,n.x),r=Math.max(t.boxSelectStartLocation.x,n.x),i=Math.min(t.boxSelectStartLocation.y,n.y),a=Math.max(t.boxSelectStartLocation.y,n.y),l="translate("+o+"px, "+i+"px)";t.boxSelectElement.style.transform=l,t.boxSelectElement.style.WebkitTransform=l,t.boxSelectElement.style.width=r-o+"px",t.boxSelectElement.style.height=a-i+"px"},k.dragMove=function(t,e){t.dragMoving=!0,e.originalEvent.stopPropagation();var n={lng:e.lngLat.lng-t.dragMoveLocation.lng,lat:e.lngLat.lat-t.dragMoveLocation.lat};Re(this.getSelected(),n),t.dragMoveLocation=e.lngLat},k.onTouchEnd=k.onMouseUp=function(t,e){var n=this;if(t.dragMoving)this.fireUpdate();else if(t.boxSelecting){var o=[t.boxSelectStartLocation,Pe(e.originalEvent,this.map.getContainer())],r=this.featuresAt(null,o,"click"),i=this.getUniqueIds(r).filter(function(a){return!n.isSelected(a)});i.length&&(this.select(i),i.forEach(function(a){return n.doRender(a)}),this.updateUIClasses({mouse:N.MOVE}))}this.stopExtendedInteractions(t)},k.toDisplayFeatures=function(t,e,n){e.properties.active=this.isSelected(e.properties.id)?j.ACTIVE:j.INACTIVE,n(e),this.fireActionable(),e.properties.active===j.ACTIVE&&e.geometry.type!==m.POINT&&Wt(e).forEach(n)},k.onTrash=function(){this.deleteFeature(this.getSelectedIds()),this.fireActionable()},k.onCombineFeatures=function(){var t=this.getSelected();if(!(t.length===0||t.length<2)){for(var e=[],n=[],o=t[0].type.replace("Multi",""),r=0;r<t.length;r++){var i=t[r];if(i.type.replace("Multi","")!==o)return;i.type.includes("Multi")?i.getCoordinates().forEach(function(l){e.push(l)}):e.push(i.getCoordinates()),n.push(i.toGeoJSON())}if(n.length>1){var a=this.newFeature({type:m.FEATURE,properties:n[0].properties,geometry:{type:"Multi"+o,coordinates:e}});this.addFeature(a),this.deleteFeature(this.getSelectedIds(),{silent:!0}),this.setSelected([a.id]),this.map.fire(H.COMBINE_FEATURES,{createdFeatures:[a.toGeoJSON()],deletedFeatures:n})}this.fireActionable()}},k.onUncombineFeatures=function(){var t=this,e=this.getSelected();if(e.length!==0){for(var n=[],o=[],r=function(a){var l=e[a];t.isInstanceOf("MultiFeature",l)&&(l.getFeatures().forEach(function(d){t.addFeature(d),d.properties=l.properties,n.push(d.toGeoJSON()),t.select([d.id])}),t.deleteFeature(l.id,{silent:!0}),o.push(l.toGeoJSON()))},i=0;i<e.length;i++)r(i);n.length>1&&this.map.fire(H.UNCOMBINE_FEATURES,{createdFeatures:n,deletedFeatures:o}),this.fireActionable()}};var hn=$t(B.VERTEX),gn=$t(B.MIDPOINT),ft={fireUpdate:function(){this.map.fire(H.UPDATE,{action:Ce.CHANGE_COORDINATES,features:this.getSelected().map(function(t){return t.toGeoJSON()})})},fireActionable:function(t){this.setActionableState({combineFeatures:!1,uncombineFeatures:!1,trash:t.selectedCoordPaths.length>0})},startDragging:function(t,e){this.map.dragPan.disable(),t.canDragMove=!0,t.dragMoveLocation=e.lngLat},stopDragging:function(t){this.map.dragPan.enable(),t.dragMoving=!1,t.canDragMove=!1,t.dragMoveLocation=null},onVertex:function(t,e){this.startDragging(t,e);var n=e.featureTarget.properties,o=t.selectedCoordPaths.indexOf(n.coord_path);Ht(e)||o!==-1?Ht(e)&&o===-1&&t.selectedCoordPaths.push(n.coord_path):t.selectedCoordPaths=[n.coord_path];var r=this.pathsToCoordinates(t.featureId,t.selectedCoordPaths);this.setSelectedCoordinates(r)},onMidpoint:function(t,e){this.startDragging(t,e);var n=e.featureTarget.properties;t.feature.addCoordinate(n.coord_path,n.lng,n.lat),this.fireUpdate(),t.selectedCoordPaths=[n.coord_path]},pathsToCoordinates:function(t,e){return e.map(function(n){return{feature_id:t,coord_path:n}})},onFeature:function(t,e){t.selectedCoordPaths.length===0?this.startDragging(t,e):this.stopDragging(t)},dragFeature:function(t,e,n){Re(this.getSelected(),n),t.dragMoveLocation=e.lngLat},dragVertex:function(t,e,n){for(var o=t.selectedCoordPaths.map(function(l){return t.feature.getCoordinate(l)}),r=we(o.map(function(l){return{type:m.FEATURE,properties:{},geometry:{type:m.POINT,coordinates:l}}}),n),i=0;i<o.length;i++){var a=o[i];t.feature.updateCoordinate(t.selectedCoordPaths[i],a[0]+r.lng,a[1]+r.lat)}},clickNoTarget:function(){this.changeMode(T.SIMPLE_SELECT)},clickInactive:function(){this.changeMode(T.SIMPLE_SELECT)},clickActiveFeature:function(t){t.selectedCoordPaths=[],this.clearSelectedCoordinates(),t.feature.changed()},onSetup:function(t){var e=t.featureId,n=this.getFeature(e);if(!n)throw new Error("You must provide a featureId to enter direct_select mode");if(n.type===m.POINT)throw new TypeError("direct_select mode doesn't handle point features");var o={featureId:e,feature:n,dragMoveLocation:t.startPos||null,dragMoving:!1,canDragMove:!1,selectedCoordPaths:t.coordPath?[t.coordPath]:[]};return this.setSelectedCoordinates(this.pathsToCoordinates(e,o.selectedCoordPaths)),this.setSelected(e),tt.disable(this),this.setActionableState({trash:!0}),o},onStop:function(){tt.enable(this),this.clearSelectedCoordinates()},toDisplayFeatures:function(t,e,n){t.featureId===e.properties.id?(e.properties.active=j.ACTIVE,n(e),Wt(e,{map:this.map,midpoints:!0,selectedPaths:t.selectedCoordPaths}).forEach(n)):(e.properties.active=j.INACTIVE,n(e)),this.fireActionable(t)},onTrash:function(t){t.selectedCoordPaths.sort(function(e,n){return n.localeCompare(e,"en",{numeric:!0})}).forEach(function(e){return t.feature.removeCoordinate(e)}),this.fireUpdate(),t.selectedCoordPaths=[],this.clearSelectedCoordinates(),this.fireActionable(t),t.feature.isValid()===!1&&(this.deleteFeature([t.featureId]),this.changeMode(T.SIMPLE_SELECT,{}))},onMouseMove:function(t,e){var n=_t(e),o=hn(e),r=gn(e),i=t.selectedCoordPaths.length===0;return n&&i||o&&!i?this.updateUIClasses({mouse:N.MOVE}):this.updateUIClasses({mouse:N.NONE}),(o||n||r)&&t.dragMoving&&this.fireUpdate(),this.stopDragging(t),!0},onMouseOut:function(t){return t.dragMoving&&this.fireUpdate(),!0}};ft.onTouchStart=ft.onMouseDown=function(t,e){return hn(e)?this.onVertex(t,e):_t(e)?this.onFeature(t,e):gn(e)?this.onMidpoint(t,e):void 0},ft.onDrag=function(t,e){if(t.canDragMove===!0){t.dragMoving=!0,e.originalEvent.stopPropagation();var n={lng:e.lngLat.lng-t.dragMoveLocation.lng,lat:e.lngLat.lat-t.dragMoveLocation.lat};t.selectedCoordPaths.length>0?this.dragVertex(t,e,n):this.dragFeature(t,e,n),t.dragMoveLocation=e.lngLat}},ft.onClick=function(t,e){return qt(e)?this.clickNoTarget(t,e):_t(e)?this.clickActiveFeature(t,e):Ne(e)?this.clickInactive(t,e):void this.stopDragging(t)},ft.onTap=function(t,e){return qt(e)?this.clickNoTarget(t,e):_t(e)?this.clickActiveFeature(t,e):Ne(e)?this.clickInactive(t,e):void 0},ft.onTouchEnd=ft.onMouseUp=function(t){t.dragMoving&&this.fireUpdate(),this.stopDragging(t)};var ot={};function re(t,e){return!!t.lngLat&&t.lngLat.lng===e[0]&&t.lngLat.lat===e[1]}ot.onSetup=function(){var t=this.newFeature({type:m.FEATURE,properties:{},geometry:{type:m.POINT,coordinates:[]}});return this.addFeature(t),this.clearSelectedFeatures(),this.updateUIClasses({mouse:N.ADD}),this.activateUIButton(Y.POINT),this.setActionableState({trash:!0}),{point:t}},ot.stopDrawingAndRemove=function(t){this.deleteFeature([t.point.id],{silent:!0}),this.changeMode(T.SIMPLE_SELECT)},ot.onTap=ot.onClick=function(t,e){this.updateUIClasses({mouse:N.MOVE}),t.point.updateCoordinate("",e.lngLat.lng,e.lngLat.lat),this.map.fire(H.CREATE,{features:[t.point.toGeoJSON()]}),this.changeMode(T.SIMPLE_SELECT,{featureIds:[t.point.id]})},ot.onStop=function(t){this.activateUIButton(),t.point.getCoordinate().length||this.deleteFeature([t.point.id],{silent:!0})},ot.toDisplayFeatures=function(t,e,n){var o=e.properties.id===t.point.id;if(e.properties.active=o?j.ACTIVE:j.INACTIVE,!o)return n(e)},ot.onTrash=ot.stopDrawingAndRemove,ot.onKeyUp=function(t,e){if(Xt(e)||Zt(e))return this.stopDrawingAndRemove(t,e)};var bt={onSetup:function(){var t=this.newFeature({type:m.FEATURE,properties:{},geometry:{type:m.POLYGON,coordinates:[[]]}});return this.addFeature(t),this.clearSelectedFeatures(),tt.disable(this),this.updateUIClasses({mouse:N.ADD}),this.activateUIButton(Y.POLYGON),this.setActionableState({trash:!0}),{polygon:t,currentVertexPosition:0}},clickAnywhere:function(t,e){if(t.currentVertexPosition>0&&re(e,t.polygon.coordinates[0][t.currentVertexPosition-1]))return this.changeMode(T.SIMPLE_SELECT,{featureIds:[t.polygon.id]});this.updateUIClasses({mouse:N.ADD}),t.polygon.updateCoordinate("0."+t.currentVertexPosition,e.lngLat.lng,e.lngLat.lat),t.currentVertexPosition++,t.polygon.updateCoordinate("0."+t.currentVertexPosition,e.lngLat.lng,e.lngLat.lat)},clickOnVertex:function(t){return this.changeMode(T.SIMPLE_SELECT,{featureIds:[t.polygon.id]})},onMouseMove:function(t,e){t.polygon.updateCoordinate("0."+t.currentVertexPosition,e.lngLat.lng,e.lngLat.lat),Dt(e)&&this.updateUIClasses({mouse:N.POINTER})}};bt.onTap=bt.onClick=function(t,e){return Dt(e)?this.clickOnVertex(t,e):this.clickAnywhere(t,e)},bt.onKeyUp=function(t,e){Xt(e)?(this.deleteFeature([t.polygon.id],{silent:!0}),this.changeMode(T.SIMPLE_SELECT)):Zt(e)&&this.changeMode(T.SIMPLE_SELECT,{featureIds:[t.polygon.id]})},bt.onStop=function(t){this.updateUIClasses({mouse:N.NONE}),tt.enable(this),this.activateUIButton(),this.getFeature(t.polygon.id)!==void 0&&(t.polygon.removeCoordinate("0."+t.currentVertexPosition),t.polygon.isValid()?this.map.fire(H.CREATE,{features:[t.polygon.toGeoJSON()]}):(this.deleteFeature([t.polygon.id],{silent:!0}),this.changeMode(T.SIMPLE_SELECT,{},{silent:!0})))},bt.toDisplayFeatures=function(t,e,n){var o=e.properties.id===t.polygon.id;if(e.properties.active=o?j.ACTIVE:j.INACTIVE,!o)return n(e);if(e.geometry.coordinates.length!==0){var r=e.geometry.coordinates[0].length;if(!(r<3)){if(e.properties.meta=B.FEATURE,n(Nt(t.polygon.id,e.geometry.coordinates[0][0],"0.0",!1)),r>3){var i=e.geometry.coordinates[0].length-3;n(Nt(t.polygon.id,e.geometry.coordinates[0][i],"0."+i,!1))}if(r<=4){var a=[[e.geometry.coordinates[0][0][0],e.geometry.coordinates[0][0][1]],[e.geometry.coordinates[0][1][0],e.geometry.coordinates[0][1][1]]];if(n({type:m.FEATURE,properties:e.properties,geometry:{coordinates:a,type:m.LINE_STRING}}),r===3)return}return n(e)}}},bt.onTrash=function(t){this.deleteFeature([t.polygon.id],{silent:!0}),this.changeMode(T.SIMPLE_SELECT)};var Et={onSetup:function(t){var e,n,o=(t=t||{}).featureId,r="forward";if(o){if(!(e=this.getFeature(o)))throw new Error("Could not find a feature with the provided featureId");var i=t.from;if(i&&i.type==="Feature"&&i.geometry&&i.geometry.type==="Point"&&(i=i.geometry),i&&i.type==="Point"&&i.coordinates&&i.coordinates.length===2&&(i=i.coordinates),!i||!Array.isArray(i))throw new Error("Please use the `from` property to indicate which point to continue the line from");var a=e.coordinates.length-1;if(e.coordinates[a][0]===i[0]&&e.coordinates[a][1]===i[1])n=a+1,e.addCoordinate.apply(e,[n].concat(e.coordinates[a]));else{if(e.coordinates[0][0]!==i[0]||e.coordinates[0][1]!==i[1])throw new Error("`from` should match the point at either the start or the end of the provided LineString");r="backwards",n=0,e.addCoordinate.apply(e,[n].concat(e.coordinates[0]))}}else e=this.newFeature({type:m.FEATURE,properties:{},geometry:{type:m.LINE_STRING,coordinates:[]}}),n=0,this.addFeature(e);return this.clearSelectedFeatures(),tt.disable(this),this.updateUIClasses({mouse:N.ADD}),this.activateUIButton(Y.LINE),this.setActionableState({trash:!0}),{line:e,currentVertexPosition:n,direction:r}},clickAnywhere:function(t,e){if(t.currentVertexPosition>0&&re(e,t.line.coordinates[t.currentVertexPosition-1])||t.direction==="backwards"&&re(e,t.line.coordinates[t.currentVertexPosition+1]))return this.changeMode(T.SIMPLE_SELECT,{featureIds:[t.line.id]});this.updateUIClasses({mouse:N.ADD}),t.line.updateCoordinate(t.currentVertexPosition,e.lngLat.lng,e.lngLat.lat),t.direction==="forward"?(t.currentVertexPosition++,t.line.updateCoordinate(t.currentVertexPosition,e.lngLat.lng,e.lngLat.lat)):t.line.addCoordinate(0,e.lngLat.lng,e.lngLat.lat)},clickOnVertex:function(t){return this.changeMode(T.SIMPLE_SELECT,{featureIds:[t.line.id]})},onMouseMove:function(t,e){t.line.updateCoordinate(t.currentVertexPosition,e.lngLat.lng,e.lngLat.lat),Dt(e)&&this.updateUIClasses({mouse:N.POINTER})}};Et.onTap=Et.onClick=function(t,e){if(Dt(e))return this.clickOnVertex(t,e);this.clickAnywhere(t,e)},Et.onKeyUp=function(t,e){Zt(e)?this.changeMode(T.SIMPLE_SELECT,{featureIds:[t.line.id]}):Xt(e)&&(this.deleteFeature([t.line.id],{silent:!0}),this.changeMode(T.SIMPLE_SELECT))},Et.onStop=function(t){tt.enable(this),this.activateUIButton(),this.getFeature(t.line.id)!==void 0&&(t.line.removeCoordinate(""+t.currentVertexPosition),t.line.isValid()?this.map.fire(H.CREATE,{features:[t.line.toGeoJSON()]}):(this.deleteFeature([t.line.id],{silent:!0}),this.changeMode(T.SIMPLE_SELECT,{},{silent:!0})))},Et.onTrash=function(t){this.deleteFeature([t.line.id],{silent:!0}),this.changeMode(T.SIMPLE_SELECT)},Et.toDisplayFeatures=function(t,e,n){var o=e.properties.id===t.line.id;if(e.properties.active=o?j.ACTIVE:j.INACTIVE,!o)return n(e);e.geometry.coordinates.length<2||(e.properties.meta=B.FEATURE,n(Nt(t.line.id,e.geometry.coordinates[t.direction==="forward"?e.geometry.coordinates.length-2:1],""+(t.direction==="forward"?e.geometry.coordinates.length-2:1),!1)),n(e))};var yn={simple_select:k,direct_select:ft,draw_point:ot,draw_polygon:bt,draw_line_string:Et},So={defaultMode:T.SIMPLE_SELECT,keybindings:!0,touchEnabled:!0,clickBuffer:2,touchBuffer:25,boxSelect:!0,displayControlsDefault:!0,styles:rn,modes:yn,controls:{},userProperties:!1},Io={point:!0,line_string:!0,polygon:!0,trash:!0,combine_features:!0,uncombine_features:!0},xo={point:!1,line_string:!1,polygon:!1,trash:!1,combine_features:!1,uncombine_features:!1};function vn(t,e){return t.map(function(n){return n.source?n:pt(n,{id:n.id+"."+e,source:e==="hot"?X.HOT:X.COLD})})}var ke={exports:{}};(function(t,e){var n="__lodash_hash_undefined__",o=9007199254740991,r="[object Arguments]",i="[object Array]",a="[object Boolean]",l="[object Date]",d="[object Error]",h="[object Function]",g="[object Map]",p="[object Number]",_="[object Object]",A="[object Promise]",b="[object RegExp]",F="[object Set]",c="[object String]",y="[object Symbol]",O="[object WeakMap]",V="[object ArrayBuffer]",w="[object DataView]",De=/^\[object .+?Constructor\]$/,Ao=/^(?:0|[1-9]\d*)$/,M={};M["[object Float32Array]"]=M["[object Float64Array]"]=M["[object Int8Array]"]=M["[object Int16Array]"]=M["[object Int32Array]"]=M["[object Uint8Array]"]=M["[object Uint8ClampedArray]"]=M["[object Uint16Array]"]=M["[object Uint32Array]"]=!0,M[r]=M[i]=M[V]=M[a]=M[w]=M[l]=M[d]=M[h]=M[g]=M[p]=M[_]=M[b]=M[F]=M[c]=M[O]=!1;var bn=typeof global=="object"&&global&&global.Object===Object&&global,Po=typeof self=="object"&&self&&self.Object===Object&&self,st=bn||Po||Function("return this")(),En=e&&!e.nodeType&&e,Tn=En&&t&&!t.nodeType&&t,Cn=Tn&&Tn.exports===En,Ue=Cn&&bn.process,On=function(){try{return Ue&&Ue.binding&&Ue.binding("util")}catch{}}(),Sn=On&&On.isTypedArray;function Fo(s,u){for(var f=-1,v=s==null?0:s.length;++f<v;)if(u(s[f],f,s))return!0;return!1}function wo(s){var u=-1,f=Array(s.size);return s.forEach(function(v,L){f[++u]=[L,v]}),f}function Ro(s){var u=-1,f=Array(s.size);return s.forEach(function(v){f[++u]=v}),f}var In,xn,Mn,ko=Array.prototype,Do=Function.prototype,ae=Object.prototype,je=st["__core-js_shared__"],Ln=Do.toString,rt=ae.hasOwnProperty,Nn=(In=/[^.]+$/.exec(je&&je.keys&&je.keys.IE_PROTO||""))?"Symbol(src)_1."+In:"",An=ae.toString,Uo=RegExp("^"+Ln.call(rt).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Pn=Cn?st.Buffer:void 0,se=st.Symbol,Fn=st.Uint8Array,wn=ae.propertyIsEnumerable,jo=ko.splice,Tt=se?se.toStringTag:void 0,Rn=Object.getOwnPropertySymbols,Vo=Pn?Pn.isBuffer:void 0,Bo=(xn=Object.keys,Mn=Object,function(s){return xn(Mn(s))}),Ve=Pt(st,"DataView"),Ut=Pt(st,"Map"),Be=Pt(st,"Promise"),Ge=Pt(st,"Set"),Je=Pt(st,"WeakMap"),jt=Pt(Object,"create"),Go=St(Ve),Jo=St(Ut),zo=St(Be),Yo=St(Ge),$o=St(Je),kn=se?se.prototype:void 0,ze=kn?kn.valueOf:void 0;function Ct(s){var u=-1,f=s==null?0:s.length;for(this.clear();++u<f;){var v=s[u];this.set(v[0],v[1])}}function ut(s){var u=-1,f=s==null?0:s.length;for(this.clear();++u<f;){var v=s[u];this.set(v[0],v[1])}}function Ot(s){var u=-1,f=s==null?0:s.length;for(this.clear();++u<f;){var v=s[u];this.set(v[0],v[1])}}function ue(s){var u=-1,f=s==null?0:s.length;for(this.__data__=new Ot;++u<f;)this.add(s[u])}function ht(s){var u=this.__data__=new ut(s);this.size=u.size}function qo(s,u){var f=de(s),v=!f&&Ko(s),L=!f&&!v&&Ye(s),C=!f&&!v&&!L&&Yn(s),P=f||v||L||C,R=P?function(U,it){for(var ct=-1,z=Array(U);++ct<U;)z[ct]=it(ct);return z}(s.length,String):[],et=R.length;for(var D in s)!u&&!rt.call(s,D)||P&&(D=="length"||L&&(D=="offset"||D=="parent")||C&&(D=="buffer"||D=="byteLength"||D=="byteOffset")||Wo(D,et))||R.push(D);return R}function ce(s,u){for(var f=s.length;f--;)if(Bn(s[f][0],u))return f;return-1}function Vt(s){return s==null?s===void 0?"[object Undefined]":"[object Null]":Tt&&Tt in Object(s)?function(u){var f=rt.call(u,Tt),v=u[Tt];try{u[Tt]=void 0;var L=!0}catch{}var C=An.call(u);return L&&(f?u[Tt]=v:delete u[Tt]),C}(s):function(u){return An.call(u)}(s)}function Dn(s){return Bt(s)&&Vt(s)==r}function Un(s,u,f,v,L){return s===u||(s==null||u==null||!Bt(s)&&!Bt(u)?s!=s&&u!=u:function(C,P,R,et,D,U){var it=de(C),ct=de(P),z=it?i:gt(C),lt=ct?i:gt(P),Ft=(z=z==r?_:z)==_,pe=(lt=lt==r?_:lt)==_,wt=z==lt;if(wt&&Ye(C)){if(!Ye(P))return!1;it=!0,Ft=!1}if(wt&&!Ft)return U||(U=new ht),it||Yn(C)?jn(C,P,R,et,D,U):function(I,S,fe,yt,$e,Q,dt){switch(fe){case w:if(I.byteLength!=S.byteLength||I.byteOffset!=S.byteOffset)return!1;I=I.buffer,S=S.buffer;case V:return!(I.byteLength!=S.byteLength||!Q(new Fn(I),new Fn(S)));case a:case l:case p:return Bn(+I,+S);case d:return I.name==S.name&&I.message==S.message;case b:case c:return I==S+"";case g:var vt=wo;case F:var Jt=1&yt;if(vt||(vt=Ro),I.size!=S.size&&!Jt)return!1;var he=dt.get(I);if(he)return he==S;yt|=2,dt.set(I,S);var Rt=jn(vt(I),vt(S),yt,$e,Q,dt);return dt.delete(I),Rt;case y:if(ze)return ze.call(I)==ze.call(S)}return!1}(C,P,z,R,et,D,U);if(!(1&R)){var Gt=Ft&&rt.call(C,"__wrapped__"),$n=pe&&rt.call(P,"__wrapped__");if(Gt||$n){var tr=Gt?C.value():C,er=$n?P.value():P;return U||(U=new ht),D(tr,er,R,et,U)}}return wt?(U||(U=new ht),function(I,S,fe,yt,$e,Q){var dt=1&fe,vt=Vn(I),Jt=vt.length,he=Vn(S).length;if(Jt!=he&&!dt)return!1;for(var Rt=Jt;Rt--;){var It=vt[Rt];if(!(dt?It in S:rt.call(S,It)))return!1}var qn=Q.get(I);if(qn&&Q.get(S))return qn==S;var ge=!0;Q.set(I,S),Q.set(S,I);for(var qe=dt;++Rt<Jt;){var ye=I[It=vt[Rt]],ve=S[It];if(yt)var Hn=dt?yt(ve,ye,It,S,I,Q):yt(ye,ve,It,I,S,Q);if(!(Hn===void 0?ye===ve||$e(ye,ve,fe,yt,Q):Hn)){ge=!1;break}qe||(qe=It=="constructor")}if(ge&&!qe){var me=I.constructor,_e=S.constructor;me==_e||!("constructor"in I)||!("constructor"in S)||typeof me=="function"&&me instanceof me&&typeof _e=="function"&&_e instanceof _e||(ge=!1)}return Q.delete(I),Q.delete(S),ge}(C,P,R,et,D,U)):!1}(s,u,f,v,Un,L))}function Ho(s){return!(!zn(s)||function(u){return!!Nn&&Nn in u}(s))&&(Gn(s)?Uo:De).test(St(s))}function Xo(s){if(f=(u=s)&&u.constructor,v=typeof f=="function"&&f.prototype||ae,u!==v)return Bo(s);var u,f,v,L=[];for(var C in Object(s))rt.call(s,C)&&C!="constructor"&&L.push(C);return L}function jn(s,u,f,v,L,C){var P=1&f,R=s.length,et=u.length;if(R!=et&&!(P&&et>R))return!1;var D=C.get(s);if(D&&C.get(u))return D==u;var U=-1,it=!0,ct=2&f?new ue:void 0;for(C.set(s,u),C.set(u,s);++U<R;){var z=s[U],lt=u[U];if(v)var Ft=P?v(lt,z,U,u,s,C):v(z,lt,U,s,u,C);if(Ft!==void 0){if(Ft)continue;it=!1;break}if(ct){if(!Fo(u,function(pe,wt){if(Gt=wt,!ct.has(Gt)&&(z===pe||L(z,pe,f,v,C)))return ct.push(wt);var Gt})){it=!1;break}}else if(z!==lt&&!L(z,lt,f,v,C)){it=!1;break}}return C.delete(s),C.delete(u),it}function Vn(s){return function(u,f,v){var L=f(u);return de(u)?L:function(C,P){for(var R=-1,et=P.length,D=C.length;++R<et;)C[D+R]=P[R];return C}(L,v(u))}(s,Qo,Zo)}function le(s,u){var f,v,L=s.__data__;return((v=typeof(f=u))=="string"||v=="number"||v=="symbol"||v=="boolean"?f!=="__proto__":f===null)?L[typeof u=="string"?"string":"hash"]:L.map}function Pt(s,u){var f=function(v,L){return v?.[L]}(s,u);return Ho(f)?f:void 0}Ct.prototype.clear=function(){this.__data__=jt?jt(null):{},this.size=0},Ct.prototype.delete=function(s){var u=this.has(s)&&delete this.__data__[s];return this.size-=u?1:0,u},Ct.prototype.get=function(s){var u=this.__data__;if(jt){var f=u[s];return f===n?void 0:f}return rt.call(u,s)?u[s]:void 0},Ct.prototype.has=function(s){var u=this.__data__;return jt?u[s]!==void 0:rt.call(u,s)},Ct.prototype.set=function(s,u){var f=this.__data__;return this.size+=this.has(s)?0:1,f[s]=jt&&u===void 0?n:u,this},ut.prototype.clear=function(){this.__data__=[],this.size=0},ut.prototype.delete=function(s){var u=this.__data__,f=ce(u,s);return!(f<0)&&(f==u.length-1?u.pop():jo.call(u,f,1),--this.size,!0)},ut.prototype.get=function(s){var u=this.__data__,f=ce(u,s);return f<0?void 0:u[f][1]},ut.prototype.has=function(s){return ce(this.__data__,s)>-1},ut.prototype.set=function(s,u){var f=this.__data__,v=ce(f,s);return v<0?(++this.size,f.push([s,u])):f[v][1]=u,this},Ot.prototype.clear=function(){this.size=0,this.__data__={hash:new Ct,map:new(Ut||ut),string:new Ct}},Ot.prototype.delete=function(s){var u=le(this,s).delete(s);return this.size-=u?1:0,u},Ot.prototype.get=function(s){return le(this,s).get(s)},Ot.prototype.has=function(s){return le(this,s).has(s)},Ot.prototype.set=function(s,u){var f=le(this,s),v=f.size;return f.set(s,u),this.size+=f.size==v?0:1,this},ue.prototype.add=ue.prototype.push=function(s){return this.__data__.set(s,n),this},ue.prototype.has=function(s){return this.__data__.has(s)},ht.prototype.clear=function(){this.__data__=new ut,this.size=0},ht.prototype.delete=function(s){var u=this.__data__,f=u.delete(s);return this.size=u.size,f},ht.prototype.get=function(s){return this.__data__.get(s)},ht.prototype.has=function(s){return this.__data__.has(s)},ht.prototype.set=function(s,u){var f=this.__data__;if(f instanceof ut){var v=f.__data__;if(!Ut||v.length<199)return v.push([s,u]),this.size=++f.size,this;f=this.__data__=new Ot(v)}return f.set(s,u),this.size=f.size,this};var Zo=Rn?function(s){return s==null?[]:(s=Object(s),function(u,f){for(var v=-1,L=u==null?0:u.length,C=0,P=[];++v<L;){var R=u[v];f(R,v,u)&&(P[C++]=R)}return P}(Rn(s),function(u){return wn.call(s,u)}))}:function(){return[]},gt=Vt;function Wo(s,u){return!!(u=u??o)&&(typeof s=="number"||Ao.test(s))&&s>-1&&s%1==0&&s<u}function St(s){if(s!=null){try{return Ln.call(s)}catch{}try{return s+""}catch{}}return""}function Bn(s,u){return s===u||s!=s&&u!=u}(Ve&&gt(new Ve(new ArrayBuffer(1)))!=w||Ut&&gt(new Ut)!=g||Be&&gt(Be.resolve())!=A||Ge&&gt(new Ge)!=F||Je&&gt(new Je)!=O)&&(gt=function(s){var u=Vt(s),f=u==_?s.constructor:void 0,v=f?St(f):"";if(v)switch(v){case Go:return w;case Jo:return g;case zo:return A;case Yo:return F;case $o:return O}return u});var Ko=Dn(function(){return arguments}())?Dn:function(s){return Bt(s)&&rt.call(s,"callee")&&!wn.call(s,"callee")},de=Array.isArray,Ye=Vo||function(){return!1};function Gn(s){if(!zn(s))return!1;var u=Vt(s);return u==h||u=="[object GeneratorFunction]"||u=="[object AsyncFunction]"||u=="[object Proxy]"}function Jn(s){return typeof s=="number"&&s>-1&&s%1==0&&s<=o}function zn(s){var u=typeof s;return s!=null&&(u=="object"||u=="function")}function Bt(s){return s!=null&&typeof s=="object"}var Yn=Sn?function(s){return function(u){return s(u)}}(Sn):function(s){return Bt(s)&&Jn(s.length)&&!!M[Vt(s)]};function Qo(s){return(u=s)!=null&&Jn(u.length)&&!Gn(u)?qo(s):Xo(s);var u}t.exports=function(s,u){return Un(s,u)}})(ke,ke.exports);var mn=nt(ke.exports);function _n(t,e){return t.length===e.length&&JSON.stringify(t.map(function(n){return n}).sort())===JSON.stringify(e.map(function(n){return n}).sort())}var Mo={Polygon:W,LineString:at,Point:mt,MultiPolygon:$,MultiLineString:$,MultiPoint:$},Lo=Object.freeze({__proto__:null,CommonSelectors:uo,constrainFeatureMovement:we,createMidPoint:sn,createSupplementaryPoints:Wt,createVertex:Nt,doubleClickZoom:tt,euclideanDistance:Se,featuresAt:Mt,getFeatureAtAndSetCursors:zt,isClick:Ie,isEventAtCoordinates:re,isTap:xe,mapEventToBoundingBox:Qe,ModeHandler:xt,moveFeatures:Re,sortFeatures:Ke,stringSetsAreEqual:_n,StringSet:Z,theme:rn,toDenseArray:kt}),No=function(t,e){var n={options:t=function(r){r===void 0&&(r={});var i=pt(r);return r.controls||(i.controls={}),r.displayControlsDefault===!1?i.controls=pt(xo,r.controls):i.controls=pt(Io,r.controls),(i=pt(So,i)).styles=vn(i.styles,"cold").concat(vn(i.styles,"hot")),i}(t)};e=function(r,i){return i.modes=T,i.getFeatureIdsAt=function(a){return Mt.click({point:a},null,r).map(function(l){return l.properties.id})},i.getSelectedIds=function(){return r.store.getSelectedIds()},i.getSelected=function(){return{type:m.FEATURE_COLLECTION,features:r.store.getSelectedIds().map(function(a){return r.store.get(a)}).map(function(a){return a.toGeoJSON()})}},i.getSelectedPoints=function(){return{type:m.FEATURE_COLLECTION,features:r.store.getSelectedCoordinates().map(function(a){return{type:m.FEATURE,properties:{},geometry:{type:m.POINT,coordinates:a.coordinates}}})}},i.set=function(a){if(a.type===void 0||a.type!==m.FEATURE_COLLECTION||!Array.isArray(a.features))throw new Error("Invalid FeatureCollection");var l=r.store.createRenderBatch(),d=r.store.getAllIds().slice(),h=i.add(a),g=new Z(h);return(d=d.filter(function(p){return!g.has(p)})).length&&i.delete(d),l(),h},i.add=function(a){var l=JSON.parse(JSON.stringify(fo(a))).features.map(function(d){if(d.id=d.id||Le(),d.geometry===null)throw new Error("Invalid geometry: null");if(r.store.get(d.id)===void 0||r.store.get(d.id).type!==d.geometry.type){var h=Mo[d.geometry.type];if(h===void 0)throw new Error("Invalid geometry type: "+d.geometry.type+".");var g=new h(r,d);r.store.add(g)}else{var p=r.store.get(d.id);p.properties=d.properties,mn(p.properties,d.properties)||r.store.featureChanged(p.id),mn(p.getCoordinates(),d.geometry.coordinates)||p.incomingCoords(d.geometry.coordinates)}return d.id});return r.store.render(),l},i.get=function(a){var l=r.store.get(a);if(l)return l.toGeoJSON()},i.getAll=function(){return{type:m.FEATURE_COLLECTION,features:r.store.getAll().map(function(a){return a.toGeoJSON()})}},i.delete=function(a){return r.store.delete(a,{silent:!0}),i.getMode()!==T.DIRECT_SELECT||r.store.getSelectedIds().length?r.store.render():r.events.changeMode(T.SIMPLE_SELECT,void 0,{silent:!0}),i},i.deleteAll=function(){return r.store.delete(r.store.getAllIds(),{silent:!0}),i.getMode()===T.DIRECT_SELECT?r.events.changeMode(T.SIMPLE_SELECT,void 0,{silent:!0}):r.store.render(),i},i.changeMode=function(a,l){return l===void 0&&(l={}),a===T.SIMPLE_SELECT&&i.getMode()===T.SIMPLE_SELECT?(_n(l.featureIds||[],r.store.getSelectedIds())||(r.store.setSelected(l.featureIds,{silent:!0}),r.store.render()),i):(a===T.DIRECT_SELECT&&i.getMode()===T.DIRECT_SELECT&&l.featureId===r.store.getSelectedIds()[0]||r.events.changeMode(a,l,{silent:!0}),i)},i.getMode=function(){return r.events.getMode()},i.trash=function(){return r.events.trash({silent:!0}),i},i.combineFeatures=function(){return r.events.combineFeatures({silent:!0}),i},i.uncombineFeatures=function(){return r.events.uncombineFeatures({silent:!0}),i},i.setFeatureProperty=function(a,l,d){return r.store.setFeatureProperty(a,l,d),i},i}(n,e),n.api=e;var o=so(n);return e.onAdd=o.onAdd,e.onRemove=o.onRemove,e.types=Y,e.options=t,e};function ie(t){No(t,this)}return ie.modes=yn,ie.constants=Wn,ie.lib=Lo,ie});
