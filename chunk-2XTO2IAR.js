import{a as X}from"./chunk-CQVHC5U2.js";import{c as W}from"./chunk-DQZHSTUF.js";import{a as Q,b as E}from"./chunk-KPT44MCK.js";import{a as k,d as J}from"./chunk-5L2EJ5RT.js";import{a as v}from"./chunk-PDQQY7RQ.js";import{a as T}from"./chunk-RWCIDBNQ.js";import{b as K,d as H}from"./chunk-ALWV3RJ2.js";import{H as q,c as A,d as b,n as O,q as R,x as B,y as V}from"./chunk-6B5XFA6F.js";import{a as P,b as Y,c as G}from"./chunk-BOVYXYHK.js";import{a as F}from"./chunk-AML4XSEF.js";import{G as D,M as U}from"./chunk-QBWJMFH5.js";import{a as N,b as z}from"./chunk-VTHXE323.js";function Z(o){if(o.length<U)return Array.from(o);if(Array.isArray(o))return Float64Array.from(o);if(!("BYTES_PER_ELEMENT"in o))return Array.from(o);switch(o.BYTES_PER_ELEMENT){case 1:return Uint8Array.from(o);case 2:return D(o)?Uint16Array.from(o):Int16Array.from(o);case 4:return Float32Array.from(o);default:return Float64Array.from(o)}}var S=class o{constructor(t,i,n){this.primitiveIndices=t,this._numIndexPerPrimitive=i,this.position=n,this._children=void 0,v(t.length>=1),v(n.size===3||n.size===4);let{data:r,size:a,indices:h}=n;v(h.length%this._numIndexPerPrimitive==0),v(h.length>=t.length*this._numIndexPerPrimitive);let u=t.length,s=a*h[this._numIndexPerPrimitive*t[0]];y.clear(),y.push(s);let c=G(r[s],r[s+1],r[s+2]),e=Y(c);for(let g=0;g<u;++g){let f=this._numIndexPerPrimitive*t[g];for(let _=0;_<this._numIndexPerPrimitive;++_){s=a*h[f+_],y.push(s);let d=r[s];c[0]=Math.min(d,c[0]),e[0]=Math.max(d,e[0]),d=r[s+1],c[1]=Math.min(d,c[1]),e[1]=Math.max(d,e[1]),d=r[s+2],c[2]=Math.min(d,c[2]),e[2]=Math.max(d,e[2])}}this.bbMin=c,this.bbMax=e;let l=B(P(),this.bbMin,this.bbMax,.5);this.radius=.5*Math.max(Math.max(e[0]-c[0],e[1]-c[1]),e[2]-c[2]);let I=this.radius*this.radius;for(let g=0;g<y.length;++g){s=y.at(g);let f=r[s]-l[0],_=r[s+1]-l[1],d=r[s+2]-l[2],M=f*f+_*_+d*d;if(M<=I)continue;let w=Math.sqrt(M),L=.5*(w-this.radius);this.radius=this.radius+L,I=this.radius*this.radius;let C=L/w;l[0]+=f*C,l[1]+=_*C,l[2]+=d*C}this.center=l,y.clear()}getChildren(){if(this._children||R(this.bbMin,this.bbMax)<=1)return this._children;let t=B(P(),this.bbMin,this.bbMax,.5),i=this.primitiveIndices.length,n=new Uint8Array(i),r=new Array(8);for(let e=0;e<8;++e)r[e]=0;let{data:a,size:h,indices:u}=this.position;for(let e=0;e<i;++e){let l=0,I=this._numIndexPerPrimitive*this.primitiveIndices[e],g=h*u[I],f=a[g],_=a[g+1],d=a[g+2];for(let M=1;M<this._numIndexPerPrimitive;++M){g=h*u[I+M];let w=a[g],L=a[g+1],C=a[g+2];w<f&&(f=w),L<_&&(_=L),C<d&&(d=C)}f<t[0]&&(l|=1),_<t[1]&&(l|=2),d<t[2]&&(l|=4),n[e]=l,++r[l]}let s=0;for(let e=0;e<8;++e)r[e]>0&&++s;if(s<2)return;let c=new Array(8);for(let e=0;e<8;++e)c[e]=r[e]>0?new Uint32Array(r[e]):void 0;for(let e=0;e<8;++e)r[e]=0;for(let e=0;e<i;++e){let l=n[e];c[l][r[l]++]=this.primitiveIndices[e]}this._children=new Array;for(let e=0;e<8;++e)c[e]!==void 0&&this._children.push(new o(c[e],this._numIndexPerPrimitive,this.position));return this._children}static prune(){y.prune()}},y=new F({deallocator:null});function $(o,t){if(!o)return!1;let{size:i,data:n,indices:r}=o;A(t,0,0,0),A(p,0,0,0);let a=0,h=0;for(let u=0;u<r.length-2;u+=3){let s=r[u]*i,c=r[u+1]*i,e=r[u+2]*i;A(m,n[s],n[s+1],n[s+2]),A(x,n[c],n[c+1],n[c+2]),A(j,n[e],n[e+1],n[e+2]);let l=W(m,x,j);l?(b(m,m,x),b(m,m,j),O(m,m,1/3*l),b(t,t,m),a+=l):(b(p,p,m),b(p,p,x),b(p,p,j),h+=3)}return(h!==0||a!==0)&&(a!==0?(O(t,t,1/a),!0):h!==0&&(O(t,p,1/h),!0))}function tt(o,t){if(!o)return!1;let{size:i,data:n,indices:r}=o;A(t,0,0,0);let a=-1,h=0;for(let u=0;u<r.length;u++){let s=r[u]*i;a!==s&&(t[0]+=n[s],t[1]+=n[s+1],t[2]+=n[s+2],h++),a=s}return h>1&&O(t,t,1/h),h>0}function it(o,t,i){if(!o)return!1;A(i,0,0,0),A(p,0,0,0);let n=0,r=0,{size:a,data:h,indices:u}=o,s=u.length-1,c=s+(t?2:0);for(let e=0;e<c;e+=2){let l=e<s?e+1:0,I=u[e<s?e:s]*a,g=u[l]*a;m[0]=h[I],m[1]=h[I+1],m[2]=h[I+2],x[0]=h[g],x[1]=h[g+1],x[2]=h[g+2],O(m,b(m,m,x),.5);let f=q(m,x);f>0?(b(i,i,O(m,m,f)),n+=f):n===0&&(b(p,p,m),r++)}return n!==0?(O(i,i,1/n),!0):r!==0&&(O(i,p,1/r),!0)}var m=P(),x=P(),j=P(),p=P();var et=class o extends Q{constructor(t,i,n=null,r=E.Mesh,a=null,h=-1){super(),this.material=t,this.mapPositions=n,this.type=r,this.objectAndLayerIdColor=a,this.edgeIndicesLength=h,this.highlights=new Set,this._highlightOptionsCounts=new Map,this.visible=!0,this._attributes=new Map,this._boundingInfo=null;for(let[u,s]of i)this._attributes.set(u,z(N({},s),{indices:k(s.indices)})),u===T.POSITION&&(this.edgeIndicesLength=this.edgeIndicesLength<0?this._attributes.get(u).indices.length:this.edgeIndicesLength)}instantiate(t={}){let i=new o(t.material||this.material,[],this.mapPositions,this.type,this.objectAndLayerIdColor,this.edgeIndicesLength);return this._attributes.forEach((n,r)=>{n.exclusive=!1,i._attributes.set(r,n)}),i._boundingInfo=this._boundingInfo,i.transformation=t.transformation||this.transformation,i}get attributes(){return this._attributes}getMutableAttribute(t){let i=this._attributes.get(t);return i&&!i.exclusive&&(i=z(N({},i),{exclusive:!0,data:Z(i.data)}),this._attributes.set(t,i)),i}setAttributeData(t,i){let n=this._attributes.get(t);n&&this._attributes.set(t,z(N({},n),{exclusive:!0,data:i}))}get indexCount(){return this._attributes.values().next().value?.indices?.length??0}get faceCount(){return this.indexCount/3}get boundingInfo(){return this._boundingInfo==null&&(this._boundingInfo=this._calculateBoundingInfo()),this._boundingInfo}computeAttachmentOrigin(t){return!!(this.type===E.Mesh?this._computeAttachmentOriginTriangles(t):this.type===E.Line?this._computeAttachmentOriginLines(t):this._computeAttachmentOriginPoints(t))&&(this._transformation!=null&&V(t,t,this._transformation),!0)}_computeAttachmentOriginTriangles(t){let i=this.attributes.get(T.POSITION);return $(i,t)}_computeAttachmentOriginLines(t){let i=this.attributes.get(T.POSITION);return it(i,nt(this.material.parameters,i),t)}_computeAttachmentOriginPoints(t){let i=this.attributes.get(T.POSITION);return tt(i,t)}invalidateBoundingInfo(){this._boundingInfo=null}_calculateBoundingInfo(){let t=this.attributes.get(T.POSITION);if(!t||t.indices.length===0)return null;let i=this.type===E.Mesh?3:1;v(t.indices.length%i==0,"Indexing error: "+t.indices.length+" not divisible by "+i);let n=J(t.indices.length/i);return new S(n,i,t)}get transformation(){return this._transformation??H}set transformation(t){this._transformation=t&&t!==H?K(t):null}get highlightNames(){return this._highlightOptionsCounts}get hasHighlights(){return this._highlightOptionsCounts.size>0}foreachHighlightOptions(t){this._highlightOptionsCounts.forEach((i,n)=>t(n))}allocateIdAndHighlight(t){let i=new X(t);return this.addHighlight(i)}addHighlight(t){this.highlights.add(t);let{highlightName:i}=t,n=(this._highlightOptionsCounts.get(i)??0)+1;return this._highlightOptionsCounts.set(i,n),t}removeHighlight(t){if(this.highlights.delete(t)){let{highlightName:i}=t,n=this._highlightOptionsCounts.get(i)??0;n<=1?this._highlightOptionsCounts.delete(i):this._highlightOptionsCounts.set(i,n-1)}}};function nt(o,t){return!(!("isClosed"in o)||!o.isClosed)&&t.indices.length>2}export{S as a,Z as b,et as c};
