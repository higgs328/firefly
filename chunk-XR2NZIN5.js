import{c as ce,d as ue}from"./chunk-7DIV5AMU.js";import{h as U}from"./chunk-456M7HFK.js";import{a as D}from"./chunk-342NGUMP.js";import{a as F,b as le}from"./chunk-42SGGFLN.js";import{e as ae}from"./chunk-S6VNWKM3.js";import{a as se,b as ie}from"./chunk-Y7XRSFOZ.js";import{b as ne}from"./chunk-2HYVVLKS.js";import{b as oe}from"./chunk-EO2H4LIH.js";import{a as C}from"./chunk-ALWV3RJ2.js";import{b as te,c as re,y as I}from"./chunk-6B5XFA6F.js";import{q as ee}from"./chunk-DA3SDKGO.js";import{f as Y}from"./chunk-ZTOZWLEE.js";import{a as g,b as X}from"./chunk-BOVYXYHK.js";import{C as P,a as x,g as v,v as Q}from"./chunk-KVM6SHDX.js";import{a as A}from"./chunk-7F5DJLJT.js";import{B as J}from"./chunk-NJWTSROP.js";import{o as H}from"./chunk-AUAZP44J.js";import{b as S}from"./chunk-YOFFGXOB.js";import{F as z,H as Z,a as j,n as B,o as $}from"./chunk-QBWJMFH5.js";import{a as V,b as K,f as R}from"./chunk-VTHXE323.js";function pe(e,t,r,o,n){let a=r==="east-north-up"?X(e):ge(e,t,o),s=C();return oe(o,a,s,n),s}var de=1,fe=5-de;function ge(e,t,r){let o=g(),n=e[3],a=2**(Math.ceil(Math.log(n)*Math.LOG2E/fe)*fe+de);if(r.isGeographic){let c=a/J(r).radius*180/Math.PI,l=Math.round(e[1]/c),d=Math.max(-90,Math.min(90,l*c)),f=c/Math.cos((Math.abs(d)-c/2)/180*Math.PI),m=Math.round(e[0]/f)*f;o[0]=m,o[1]=d}else{let c=Math.round(e[0]/a),l=Math.round(e[1]/a);o[0]=c*a,o[1]=l*a}let s=e[2]+t,i=Math.round(s/a);return o[2]=i*a,o}function ye(e){return e?parseInt(e.slice(e.lastIndexOf("/")+1),10):void 0}function ut(e){if(j("disable-feature:i3s-draco")||!e)return!1;for(let t of e)for(let r of t.geometryBuffers)if(r.compressedAttributes?.encoding==="draco")return!0;return!1}function ft(e,t,r,o){r.traverse(t,n=>{let a=n.serviceMbsInIndexSR;return(a!=null&&Se(e,a))!==w.OUTSIDE&&(o(n),!0)})}function pt(e,t,r){let o=0,n=0;for(let a=0;a<t.length&&o<e.length;a++)e[o]===t[a]&&(r(a)&&(e[n]=e[o],n++),o++);e.length=n}function dt(e,t,r){let o=0,n=0;for(;o<r.length;)$(e,r[o])>=0===t&&(r[n]=r[o],n++),o++;r.length=n}function mt(e,t){if(t.rotationScale[1]===0&&t.rotationScale[2]===0&&t.rotationScale[3]===0&&t.rotationScale[5]===0&&t.rotationScale[6]===0&&t.rotationScale[7]===0)return M[0]=(e[0]-t.position[0])/t.rotationScale[0],M[1]=(e[1]-t.position[1])/t.rotationScale[4],M[2]=(e[2]-t.position[0])/t.rotationScale[0],M[3]=(e[3]-t.position[1])/t.rotationScale[4],M}var M=x(),w;function Se(e,t){let r=t[0],o=t[1],n=t[3],a=e[0]-r,s=r-e[2],i=e[1]-o,c=o-e[3],l=Math.max(a,s,0),d=Math.max(i,c,0),f=l*l+d*d;return f>n*n?w.OUTSIDE:f>0?w.INTERSECTS_CENTER_OUTSIDE:-Math.max(a,s,i,c)>n?w.INSIDE:w.INTERSECTS_CENTER_INSIDE}function Ie(e,t,r){let o=[],n=r?.missingFields,a=r?.originalFields;for(let s of e){let i=s.toLowerCase(),c=!1;for(let l of t)if(i===l.name.toLowerCase()){o.push(l.name),c=!0,a&&a.push(s);break}!c&&n&&n.push(s)}return o}function ht(e,t,r,o,n,a){return R(this,null,function*(){if(t.length===0)return[];let s=e.attributeStorageInfo;if(e.associatedLayer!=null)try{return yield Me(e.associatedLayer,t,r,o,a)}catch(i){if(e.associatedLayer.loaded)throw i}if(s){let i=we(t,r,n);if(i==null)throw new S("scenelayer:features-not-loaded","Tried to query attributes for unloaded features");let c=e.parsedUrl.path;return(yield Promise.all(i.map(l=>Te(c,s,l.node,l.indices,o,e.apiKey,e.customParameters,a).then(d=>{for(let f=0;f<l.graphics.length;f++){let m=l.graphics[f],y=d[f];if(m.attributes)for(let u in m.attributes)u in y||(y[u]=m.attributes[u]);m.attributes=y}return l.graphics})))).flat()}throw new S("scenelayer:no-attribute-source","This scene layer does not have a source for attributes available")})}function we(e,t,r){let o=new Map,n=[],a=r();for(let s of e){let i=s.attributes[t];for(let c=0;c<a.length;c++){let l=a[c],d=l.featureIds.indexOf(i);if(d>=0){let f=o.get(l.node);f||(f={node:l.node,indices:[],graphics:[]},n.push(f),o.set(l.node,f)),f.indices.push(d),f.graphics.push(s);for(let m=c;m>0;m--)a[m]=a[m-1];a[0]=l;break}}}return n}function Me(e,t,r,o,n){return R(this,null,function*(){t.sort((l,d)=>l.attributes[r]-d.attributes[r]);let a=t.map(l=>l.attributes[r]),s=[],i=Ie(o,e.fields,{originalFields:s}),c=yield be(e,a,i,n);for(let l=0;l<t.length;l++){let d=t[l],f=c[l],m={};if(d.attributes)for(let y in d.attributes)m[y]=d.attributes[y];for(let y=0;y<s.length;y++)m[s[y]]=f[i[y]];d.attributes=m}return t})}function be(e,t,r,o){let n=e.capabilities.query.maxRecordCount;if(n!=null&&t.length>n){let s=B(t,n);return Promise.all(s.map(i=>be(e,i,r,o))).then(i=>i.flat())}let a=new ne({objectIds:t,outFields:r,orderByFields:[e.objectIdField]});return e.queryFeatures(a,o).then(s=>{if(s&&s.features&&s.features.length===t.length)return s.features.map(i=>i.attributes);throw new S("scenelayer:feature-not-in-associated-layer","Feature not found in associated feature layer")})}function Te(e,t,r,o,n,a,s,i){return Ee(e,t,r.resources.attributes,o,n,a,s,i)}function Ee(e,t,r,o,n,a,s,i){return R(this,null,function*(){let c=[];for(let f of t)if(f&&n.includes(f.name)){let m=`${e}/nodes/${r}/attributes/${f.key}/0`;c.push({url:m,storageInfo:f})}let l=yield Promise.allSettled(c.map(f=>H(f.url,{responseType:"array-buffer",query:K(V({},s),{token:a}),signal:i?.signal}).then(m=>ae(f.storageInfo,m.data)))),d=[];for(let f of o){let m={};for(let y=0;y<l.length;y++){let u=l[y];if(u.status==="fulfilled"){let h=u.value;m[c[y].storageInfo.name]=ve(h,f)}}d.push(m)}return d})}(function(e){e[e.OUTSIDE=0]="OUTSIDE",e[e.INTERSECTS_CENTER_OUTSIDE=1]="INTERSECTS_CENTER_OUTSIDE",e[e.INTERSECTS_CENTER_INSIDE=2]="INTERSECTS_CENTER_INSIDE",e[e.INSIDE=3]="INSIDE"})(w||(w={}));var Re=-32768,xe=-2147483648;function ve(e,t){if(!e)return null;let r=e[t];return z(e)?r===Re?null:r:Z(e)?r===xe?null:r:r!=r?null:r}function Ce(e){let t=e.store,r=t.indexCRS||t.geographicCRS,o=r===void 0?t.indexWKT:void 0;if(o){if(!e.spatialReference)throw new S("layerview:no-store-spatial-reference-wkt-index-and-no-layer-spatial-reference","Found indexWKT in the scene layer store but no layer spatial reference",{});if(o!==e.spatialReference.wkt)throw new S("layerview:store-spatial-reference-wkt-index-incompatible","The indexWKT of the scene layer store does not match the WKT of the layer spatial reference",{})}let n=r?new A(ye(r)):e.spatialReference;return n.equals(e.spatialReference)?e.spatialReference:n}function ke(e){let t=e.store,r=t.vertexCRS||t.projectedCRS,o=r===void 0?t.vertexWKT:void 0;if(o){if(!e.spatialReference)throw new S("layerview:no-store-spatial-reference-wkt-vertex-and-no-layer-spatial-reference","Found vertexWKT in the scene layer store but no layer spatial reference",{});if(o!==e.spatialReference.wkt)throw new S("layerview:store-spatial-reference-wkt-vertex-incompatible","The vertexWKT of the scene layer store does not match the WKT of the layer spatial reference",{})}let n=r?new A(ye(r)):e.spatialReference;return n.equals(e.spatialReference)?e.spatialReference:n}function G(e,t,r){if(!ee(e,t))throw U("scene layer",e?.wkid,t?.wkid);if(r==="local"&&!Ne(e,t))throw U("scene layer",e?.wkid,t?.wkid)}function yt(e,t,r){if(e.serviceUpdateTimeStamp?.lastUpdate!==t.serviceUpdateTimeStamp?.lastUpdate||!r.isEmpty||e.associatedLayer?.url!==t.associatedLayer?.url)throw new S("layerview:recycle-failed")}function Ne(e,t){return e.equals(t)||e.isWGS84&&t.isWebMercator||e.isWebMercator&&t.isWGS84}function We(e,t,r){let o=Ce(e),n=ke(e);G(o,t,r),G(n,t,r)}function Le(e){return(e.geometryType==null||e.geometryType==="triangles")&&(e.topology==null||e.topology==="PerAttributeArray")&&e.vertexAttributes?.position!=null}function bt(e){if(e.store?.defaultGeometrySchema==null||!Le(e.store.defaultGeometrySchema))throw new S("scenelayer:unsupported-geometry-schema","The geometry schema of this scene layer is not supported.",{url:e.parsedUrl.path})}function gt(e,t){We(e,t.spatialReference,t.viewingMode)}function Oe(e){return e.geometryType!=null&&e.geometryType==="points"&&(e.topology==null||e.topology==="PerAttributeArray")&&(e.encoding==null||e.encoding===""||e.encoding==="lepcc-xyz")&&e.vertexAttributes?.position!=null}function St(e){if(e.store?.defaultGeometrySchema==null||!Oe(e.store.defaultGeometrySchema))throw new S("pointcloud:unsupported-geometry-schema","The geometry schema of this point cloud scene layer is not supported.",{})}function It(e,t){G(e.spatialReference,t.spatialReference,t.viewingMode)}function Ae(e){return e.type==="simple"||e.type==="class-breaks"||e.type==="unique-value"}function Pe(e){return e.type==="mesh-3d"}function wt(e){if(e==null||!Ae(e)||(e.type==="unique-value"||e.type==="class-breaks")&&e.defaultSymbol==null)return!0;let t=e.symbols;if(t.length===0)return!0;for(let r of t){if(!Pe(r)||r.symbolLayers.length===0)return!0;for(let o of r.symbolLayers.items)if(o.type!=="fill"||o.material?.color==null||o.material.colorMixMode!=="replace")return!0}return!1}var Mt=ue({color:[0,0,0,0],opacity:0}),q=class{constructor(){this.edgeMaterial=null,this.material=null,this.castShadows=!0}};function Tt(e){let t=new q,r=!1,o=!1;for(let n of e.symbolLayers.items)if(n.type==="fill"&&n.enabled){let a=n.material,s=n.edges;if(a!=null&&!r){let i=a.color,c=le(a.colorMixMode);t.material=i!=null?{color:[i.r/255,i.g/255,i.b/255],alpha:i.a,colorMixMode:c}:{color:[1,1,1],alpha:1,colorMixMode:F.Multiply},t.castShadows=n.castShadows,r=!0}s==null||o||(t.edgeMaterial=ce(s,{}),o=!0)}return t.material||(t.material={color:[1,1,1],alpha:1,colorMixMode:F.Multiply}),t}function Et(e,t){return(0|e)+(0|t)|0}function Rt(e,t,r,o,n,a,s){if(!a||a.length===0||t==null||!e.serviceMbsInIndexSR)return null;let i=pe(e.serviceMbsInIndexSR,n,"none",r,t);Y(N,i);let c=null,l=()=>{if(!c)if(c=De,P(k),e.serviceObbInIndexSR!=null){e.serviceObbInIndexSR.transform(me,r,t,n,s),me.getCorners(c);for(let u of c)I(u,u,N),v(k,u)}else{let u=e.serviceMbsInIndexSR;if(!u)return;let h=u[3];D(u,r,p,t),I(p,p,N),p[2]+=n;for(let b=0;b<8;++b){let T=1&b?h:-h,W=2&b?h:-h,L=4&b?h:-h,E=c[b];te(E,[p[0]+T,p[1]+W,p[2]+L]),v(k,E)}}},d=1/0,f=-1/0,m=u=>{if(u.type!=="replace")return;let h=u.geometry;if(!h?.hasZ)return;P(_);let b=h.spatialReference||o,T=h.rings.reduce((W,L)=>L.reduce((E,O)=>(re(p,O[0],O[1],O[2]),D(p,b,p,t),I(p,p,N),v(_,p),Math.min(p[2],E)),W),1/0);l(),Q(k,_)&&(d=Math.min(d,T),f=Math.max(f,T))};if(a.forEach(u=>m(u)),d===1/0)return null;let y=(u,h,b)=>{I(p,b,i),u[h]=p[0],u[h+1]=p[1],u[h+2]=p[2],h+=24,b[2]=d,I(p,b,i),u[h]=p[0],u[h+1]=p[1],u[h+2]=p[2],h+=24,b[2]=f,I(p,b,i),u[h]=p[0],u[h+1]=p[1],u[h+2]=p[2]};for(let u=0;u<8;++u)y(he.data,3*u,c[u]);return ie(he)}function xt(e){return e[3]>=0}function vt(e){e!=null&&(e[3]=-1)}var De=[g(),g(),g(),g(),g(),g(),g(),g()],_=x(),k=x(),me=new se,p=g(),he={data:new Array(72),size:3,exclusive:!0,stride:3},N=C();export{pe as a,ut as b,ft as c,pt as d,dt as e,mt as f,w as g,Se as h,Ie as i,ht as j,Ee as k,ve as l,Ce as m,ke as n,G as o,yt as p,We as q,bt as r,gt as s,St as t,It as u,wt as v,Mt as w,Tt as x,Et as y,Rt as z,xt as A,vt as B};
