import{a as f,b as S}from"./chunk-N6U6XCUD.js";import{a as Ct}from"./chunk-ZNIU6XIO.js";import"./chunk-GEYV2JMR.js";import"./chunk-IGGGB3TP.js";import"./chunk-JDU4SWWX.js";import"./chunk-HMOFKUIJ.js";import"./chunk-C5TDOKQP.js";import"./chunk-QGGZ7JI7.js";import"./chunk-EMILT3E5.js";import"./chunk-5KY2RG7F.js";import"./chunk-XQ4DD6H6.js";import"./chunk-E3FPV7ZA.js";import"./chunk-IQA3CVAZ.js";import"./chunk-2DH3L3DZ.js";import"./chunk-GPMOZK2F.js";import{d as bt,h as Lt}from"./chunk-CHALI33A.js";import"./chunk-D4ULQQN7.js";import"./chunk-NTU4GX2J.js";import"./chunk-XHCZWFY2.js";import"./chunk-SLOUGIU5.js";import"./chunk-INIILA7E.js";import"./chunk-YLC7GOFS.js";import"./chunk-KCIAXQ4S.js";import"./chunk-BONXCVQE.js";import"./chunk-DKDKCWEH.js";import"./chunk-PI27WDVR.js";import"./chunk-IXA5GG5W.js";import"./chunk-PIIZWXGF.js";import"./chunk-N3W77OHB.js";import"./chunk-CJXY7S42.js";import{a as V}from"./chunk-RFPOPWHB.js";import{a as ut}from"./chunk-5KMJDB5T.js";import{a as re,b as Ee,c as N,d as Pe}from"./chunk-KU6G3BN4.js";import"./chunk-BNJVBYV4.js";import{c as pt}from"./chunk-NPMJUDJ7.js";import{a as se}from"./chunk-NYVDVEEV.js";import{b as gt}from"./chunk-KWYU7DMC.js";import{c as mt}from"./chunk-M6JND3B6.js";import{a as ie,b as Ae,c as ft,d as Ce,e as yt}from"./chunk-WSDIUTRN.js";import"./chunk-UF3HHTD3.js";import"./chunk-6OWZRPJO.js";import{e as M}from"./chunk-67GIWMYL.js";import{a as ae}from"./chunk-HOMK53AL.js";import{a as ht}from"./chunk-3Y3IWJBE.js";import{a as _t,b as vt,c as q}from"./chunk-IHEDDQC4.js";import{a as wt}from"./chunk-W3HCXOXG.js";import"./chunk-AN3DAG6F.js";import"./chunk-K5FFS5P4.js";import"./chunk-3NS6RWJD.js";import"./chunk-6ZTUPVYX.js";import"./chunk-5DVGZXEZ.js";import"./chunk-2I3LIA7G.js";import{b as At}from"./chunk-OLLXJMYP.js";import"./chunk-QIO7OVOF.js";import"./chunk-J3QLC2LP.js";import"./chunk-VBFF4VHB.js";import"./chunk-Q2IUY7EW.js";import"./chunk-6HINJY73.js";import"./chunk-WQKVID54.js";import"./chunk-DBCWR6HP.js";import"./chunk-CISTQZ5X.js";import"./chunk-GUIIGAD3.js";import"./chunk-SFSN6ZUK.js";import"./chunk-NOHUHVCW.js";import"./chunk-H2NTHPNN.js";import"./chunk-Z7TBAZRW.js";import"./chunk-5H7NDIGP.js";import"./chunk-KJFE7WVE.js";import"./chunk-2GLWK7ZW.js";import{n as dt}from"./chunk-QXSQOLB3.js";import"./chunk-BKWQOCBC.js";import"./chunk-XACQ2RJ5.js";import"./chunk-LCFWGHLF.js";import"./chunk-CX3G2QWN.js";import"./chunk-YTAJKLRN.js";import"./chunk-D6N4VI5S.js";import"./chunk-3ZJ4NMBE.js";import"./chunk-4S7THJAS.js";import"./chunk-2XTO2IAR.js";import"./chunk-CQVHC5U2.js";import"./chunk-P7MVFIZJ.js";import{a as be}from"./chunk-FSW536RM.js";import"./chunk-VN5FPMRB.js";import{b as nt}from"./chunk-N7DSOI7B.js";import"./chunk-F4HA2HQL.js";import"./chunk-DQZHSTUF.js";import{a as ct}from"./chunk-CY62WWD7.js";import"./chunk-VDNRZCIE.js";import"./chunk-I2JD5OSI.js";import"./chunk-2MROBW6T.js";import{b as Le}from"./chunk-QAHTJVUZ.js";import"./chunk-XWEUR6F7.js";import"./chunk-PSNQ2KG3.js";import"./chunk-MPI26GZ3.js";import"./chunk-5252J253.js";import"./chunk-7WCQBAQY.js";import"./chunk-VQSLKKYN.js";import"./chunk-JBAMJB5J.js";import"./chunk-VAOSSSLB.js";import"./chunk-AMISFAT3.js";import"./chunk-CUV3BSEW.js";import"./chunk-3ZJU5D2H.js";import"./chunk-2UHZH5L3.js";import"./chunk-DQINVX66.js";import"./chunk-CSFAHB4Y.js";import{a as et,b as rt}from"./chunk-T5UBLAP4.js";import"./chunk-PTXLSCMJ.js";import{k as tt,l as it,m as st}from"./chunk-DA3NC6W4.js";import"./chunk-6L543SC5.js";import"./chunk-FRN24G7D.js";import{d as lt}from"./chunk-FGABE2LC.js";import"./chunk-CU7FHMWW.js";import"./chunk-CZMBPC27.js";import"./chunk-VANM5A4M.js";import"./chunk-VSD74FMI.js";import"./chunk-O2J7LFYY.js";import"./chunk-BIU7ZFAB.js";import"./chunk-6FZTFPIH.js";import{i as at,j as x,k as ot}from"./chunk-J5AEP4US.js";import"./chunk-YHRLMRSO.js";import"./chunk-KPT44MCK.js";import"./chunk-XKFJ6GWH.js";import"./chunk-SFANISLX.js";import"./chunk-UJ7KVQR6.js";import"./chunk-GSXOR3JU.js";import"./chunk-55OTJIMU.js";import"./chunk-EM2AEAFS.js";import"./chunk-YEPHAEAY.js";import"./chunk-TK4PPGQL.js";import"./chunk-ELCBU4NP.js";import"./chunk-GMZFCQJQ.js";import"./chunk-5WDH2LXO.js";import"./chunk-L7NOU4T2.js";import{a as te}from"./chunk-VGAXEXH3.js";import"./chunk-HMNTGQTR.js";import"./chunk-ZLIWNUFM.js";import"./chunk-GVSOJUIP.js";import"./chunk-GWSX6PRO.js";import"./chunk-G2JMPZCN.js";import"./chunk-IRQF7UTO.js";import"./chunk-3KOZOOEP.js";import"./chunk-EG2DTURK.js";import"./chunk-2PJRHNJW.js";import"./chunk-B2RVSTL3.js";import"./chunk-4XEE5PE3.js";import"./chunk-2CKJLDTO.js";import"./chunk-F6TN7E7K.js";import"./chunk-4LDVFWME.js";import"./chunk-HUUJBVXR.js";import"./chunk-7G56KLCZ.js";import"./chunk-L56OBJFS.js";import"./chunk-7HMNN4FJ.js";import"./chunk-UKAGN54W.js";import"./chunk-342NGUMP.js";import"./chunk-NIYDRLW4.js";import"./chunk-PHMJ7KPL.js";import"./chunk-ESSDCWGF.js";import"./chunk-WVKBXQWE.js";import"./chunk-FSWSNKJD.js";import"./chunk-FGEB67EG.js";import{h as we}from"./chunk-YEXMIDOT.js";import"./chunk-T7PUQGWM.js";import"./chunk-GV3ZFCVD.js";import"./chunk-SOEEM7Z7.js";import"./chunk-MVDZB4AK.js";import"./chunk-44A27HB7.js";import"./chunk-47NSYSFY.js";import"./chunk-QXNVQZT7.js";import"./chunk-QSQIQSC6.js";import"./chunk-AYNBEMCC.js";import"./chunk-LNYBTIG7.js";import"./chunk-3WNFY6Z5.js";import"./chunk-VYZHOYXV.js";import"./chunk-ECA5I2I7.js";import"./chunk-XAHD7XBV.js";import"./chunk-Y7XRSFOZ.js";import"./chunk-YQNUGDFH.js";import"./chunk-QCZ3ZIGQ.js";import"./chunk-7SDNM7YV.js";import{b as W}from"./chunk-4NUW747S.js";import"./chunk-T6WMVIUG.js";import"./chunk-ONYJLWAD.js";import"./chunk-UBEQHTGJ.js";import"./chunk-PHODKV66.js";import"./chunk-JPMGMA4B.js";import{h as Ze,i as _e,k as ve,m as fe,o as ye,s as $e}from"./chunk-ZM24RY22.js";import"./chunk-YW3L7OMP.js";import"./chunk-F2BQ2GD6.js";import"./chunk-R3XLNYYB.js";import"./chunk-6F25LG6O.js";import"./chunk-XLL67PCY.js";import"./chunk-MCO7DSFO.js";import"./chunk-IIROCMOY.js";import"./chunk-5LG2P6MT.js";import"./chunk-GJ2QRXGN.js";import"./chunk-6QXEFK4U.js";import"./chunk-5L2EJ5RT.js";import{b as Je}from"./chunk-E2QKN2KY.js";import"./chunk-PDQQY7RQ.js";import"./chunk-W5OI4BJ2.js";import{a as A}from"./chunk-RWCIDBNQ.js";import"./chunk-2NH7HOKA.js";import"./chunk-EM35R6FY.js";import{b as Ke,i as Xe}from"./chunk-HM5RIVQC.js";import"./chunk-HKJZ7WI6.js";import"./chunk-CXOFHVIF.js";import"./chunk-EO2H4LIH.js";import"./chunk-DJW5LMRG.js";import"./chunk-DEH76MSI.js";import{a as Ye}from"./chunk-ALWV3RJ2.js";import"./chunk-2ZFXOJDB.js";import{o as ge}from"./chunk-QXXXCEV5.js";import{G as qe,J as Qe,b as Ne,c as X,d as Be,e as Y,n as Fe,p as We,u as Z,w as $,y as ee}from"./chunk-6B5XFA6F.js";import"./chunk-3JGYBNJA.js";import"./chunk-TQPBYYQ3.js";import"./chunk-DA3SDKGO.js";import"./chunk-ZOEPYNM4.js";import"./chunk-57VFBGF3.js";import"./chunk-GWBRHLNH.js";import"./chunk-BJH4F4SM.js";import"./chunk-Z3RBZHAK.js";import{a as pe,c as K}from"./chunk-PTZYZULI.js";import{a as me}from"./chunk-NMLYCCKN.js";import"./chunk-JAPGPEA6.js";import"./chunk-MIS6QMFE.js";import"./chunk-MDZTV2VL.js";import"./chunk-RNC4P66O.js";import"./chunk-7LHOQXZT.js";import"./chunk-BCREO4Q5.js";import"./chunk-U4QEPZJ3.js";import"./chunk-KJUZWSCL.js";import"./chunk-3WO6D7MU.js";import"./chunk-BUZ3SPLE.js";import"./chunk-K75TK42V.js";import{g as J,h as he}from"./chunk-OLOKUDVI.js";import"./chunk-ZTOZWLEE.js";import"./chunk-RJWOVI3M.js";import"./chunk-RSDQHAJX.js";import{a as y}from"./chunk-BOVYXYHK.js";import"./chunk-KVM6SHDX.js";import"./chunk-HX2VGIR2.js";import{f as Ie,i as ke}from"./chunk-EQZWYK27.js";import"./chunk-DKGGDYJI.js";import"./chunk-5LA3PVK5.js";import"./chunk-IR6XCBC4.js";import"./chunk-C6JPAW54.js";import"./chunk-WD3OPXCN.js";import"./chunk-FA3WGIU4.js";import"./chunk-WWVPA6PE.js";import"./chunk-VU5W7W6Y.js";import"./chunk-ZQIC5NFT.js";import"./chunk-VIEK2X23.js";import"./chunk-XKIFGPJO.js";import"./chunk-PEW2PLAN.js";import"./chunk-Q6Y4JG7Q.js";import"./chunk-7F5DJLJT.js";import"./chunk-CX5IFQZJ.js";import{L as je,R as ue,S as He,V as Ue}from"./chunk-NJWTSROP.js";import"./chunk-D3R25AF2.js";import"./chunk-ARRCN5K3.js";import"./chunk-WGAOVKGR.js";import"./chunk-CFRDSUTM.js";import"./chunk-FB4M3WPV.js";import"./chunk-4N4D2YQX.js";import"./chunk-G4DZJMGT.js";import"./chunk-WTB3O6DJ.js";import"./chunk-7P44K2YD.js";import"./chunk-32OAXCA4.js";import{b as Re}from"./chunk-UST6HCE7.js";import"./chunk-K5T5FD5C.js";import"./chunk-MVHHPJM7.js";import"./chunk-VDO6JJ3Y.js";import{f as xe}from"./chunk-WFKZLI6F.js";import"./chunk-X2B63YVS.js";import"./chunk-BAEF3CT6.js";import"./chunk-AUAZP44J.js";import"./chunk-PVDFCTA4.js";import"./chunk-KNVXE32P.js";import"./chunk-76ATOSLU.js";import"./chunk-CCJU4DSH.js";import{a as L,j as Ge,k as O}from"./chunk-TG45K3WR.js";import"./chunk-RAI4DTMT.js";import"./chunk-ACP3S2CH.js";import"./chunk-HVAXZ2NA.js";import"./chunk-T7DXJKX7.js";import"./chunk-TYYVNQUR.js";import{a}from"./chunk-QGVBCWUY.js";import{H as k}from"./chunk-MYO4NP2N.js";import{e as n}from"./chunk-NFIPKH6V.js";import"./chunk-JPU2PQZC.js";import{l as I}from"./chunk-5QEXLALV.js";import"./chunk-P6QFA5MM.js";import"./chunk-DGTD7Y73.js";import"./chunk-LI2SX4T6.js";import{d as Te}from"./chunk-BWO7LS2H.js";import"./chunk-HEVQSRJ2.js";import"./chunk-OVHPPCBL.js";import"./chunk-SNFOAZZQ.js";import"./chunk-AML4XSEF.js";import{b as w}from"./chunk-4PTIEWMT.js";import"./chunk-TG2UTNEO.js";import"./chunk-YOFFGXOB.js";import{g as De}from"./chunk-XRGPJ3QY.js";import"./chunk-6MRUJ2UW.js";import"./chunk-2LI2GKBQ.js";import"./chunk-QBWJMFH5.js";import{a as E,b as P,f as ze}from"./chunk-VTHXE323.js";var T=class extends k{constructor(t){super(t)}initialize(){this.addHandles([L(()=>({viewData:this.viewData,startPoint:this.analysis.startPoint}),({viewData:t,startPoint:e})=>{t.elevationAlignedStartPoint=this._applyProjectionAndElevationAlignment(e)},O),L(()=>({viewData:this.viewData,endPoint:this.analysis.endPoint}),({viewData:t,endPoint:e})=>{t.elevationAlignedEndPoint=this._applyProjectionAndElevationAlignment(e)},O),L(()=>({result:this._computedResult,viewData:this.viewData}),({result:t,viewData:e})=>{e.result=t},O)])}_applyProjectionAndElevationAlignment(t){if(t==null)return t;let{spatialReference:e,elevationProvider:i}=this.view;return _t(t,e,i)??(vt(this.analysis,t.spatialReference,De.getLogger(this)),null)}get _computedResult(){let{elevationAlignedStartPoint:t,elevationAlignedEndPoint:e,measurementMode:i,unit:s}=this.viewData;if(t==null||e==null)return null;let r=pt(t,e),l=gt(t,e);if(r==null)return null;let u,d;switch(i){case V.Auto:d=l!=null?"geodesic":"euclidean",u=l??r.horizontal;break;case V.Geodesic:if(l==null)return null;d="geodesic",u=l;break;case V.Euclidean:d="euclidean",u=r.horizontal}let c=r.direct,h=r.vertical,o=ue(c.value,c.unit,s),m=ue(u.value,u.unit,s),p=He(h.value,h.unit,s);return c=M(c,o),u=M(u,m),h=M(h,p),{mode:d,directDistance:c,horizontalDistance:u,verticalDistance:h}}};a([n()],T.prototype,"view",void 0),a([n()],T.prototype,"analysis",void 0),a([n()],T.prototype,"viewData",void 0),a([n()],T.prototype,"_computedResult",null),T=a([I("esri.views.3d.analysis.DirectLineMeasurement.DirectLineMeasurementController")],T);var oe=class extends rt{constructor(e,i){super(e,i,new et(At,()=>import("./chunk-VWX4UYIH.js")),Me),this.primitiveType=Ke.TRIANGLE_STRIP}initializePipeline(e){return st({blending:e.transparent?nt(e.oitPass):null,polygonOffset:e.polygonOffsetEnabled?{factor:0,units:-4}:null,depthTest:{func:Xe.LESS},depthWrite:tt,colorWrite:it})}},Me=new Map([[A.POSITION,0],[A.NORMAL,1],[A.UV0,2],[A.LENGTH,3]]);var B=class extends ct{constructor(){super(...arguments),this.polygonOffsetEnabled=!1,this.transparent=!1}};a([Le()],B.prototype,"polygonOffsetEnabled",void 0),a([Le()],B.prototype,"transparent",void 0);var ne=class extends at{constructor(e){super(e,Ve),this._configuration=new B,this.vertexAttributeLocations=Me,this.produces=new Map([[be.OPAQUE_MATERIAL,i=>!this._transparent&&we(i)],[be.TRANSPARENT_MATERIAL_WITHOUT_DEPTH,i=>this._transparent&&we(i)]])}getConfiguration(e,i){return this._configuration.polygonOffsetEnabled=this.parameters.polygonOffset,this._configuration.transparent=this._transparent,this._configuration.oitPass=i.oitPass,this._configuration}get visible(){let{outlineColor:e,stripeEvenColor:i,stripeOddColor:s}=this.parameters;return e[3]>=te||i[3]>=te||s[3]>=te}intersect(){}createGLMaterial(e){return new Oe(e)}createBufferWriter(){return new Se}get _transparent(){let{parameters:e}=this;return e.outlineColor[3]<1||e.stripeEvenColor[3]<1||e.stripeOddColor[3]<1}},Oe=class extends lt{beginSlot(e){return this.getTechnique(oe,e)}},Ve=class extends ot{constructor(){super(...arguments),this.width=32,this.outlineSize=.2,this.outlineColor=K(1,.5,0,1),this.stripeEvenColor=K(1,1,1,1),this.stripeOddColor=K(1,.5,0,1),this.stripeLength=1,this.polygonOffset=!1}},Mt=Je().vec3f(A.POSITION).vec3f(A.NORMAL).vec2f(A.UV0).f32(A.LENGTH),Ot=y(),Vt=y(),St=y(),zt=y(),Dt=y(),Se=class{constructor(){this.vertexBufferLayout=Mt}elementCount(e){return 2*(e.get(A.POSITION).indices.length/2+1)}write(e,i,s,r,l,u){let{data:d,indices:c}=s.get(A.POSITION),h=s.get(A.NORMAL).data,o=d.length/3;c&&c.length!==2*(o-1)&&console.warn("MeasurementArrowMaterial does not support indices");let m=Ot,p=Vt,v=St,C=zt,R=Dt,G=l.position,j=l.normal,z=l.uv0,H=0;for(let b=0;b<o;++b){let F=3*b;if(X(m,d[F],d[F+1],d[F+2]),b<o-1){let U=3*(b+1);X(p,d[U],d[U+1],d[U+2]),X(R,h[U],h[U+1],h[U+2]),Z(R,R),Y(v,p,m),Z(v,v),$(C,R,v),Z(C,C)}let de=We(m,p);e&&i&&(ee(m,m,e),ee(p,p,e),ee(C,C,i));let D=u+2*b,Q=D+1;G.setVec(D,m),G.setVec(Q,m),j.setVec(D,C),j.setVec(Q,C),z.set(D,0,H),z.set(D,1,-1),z.set(Q,0,H),z.set(Q,1,1),b<o-1&&(H+=de)}let ce=l.length;for(let b=0;b<2*o;++b)ce.set(u+b,H)}};var le=class extends wt{constructor(e){super(e),this._arrowWidth=16,this._arrowSubdivisions=128,this._origin=y(),this._originTransform=Ye(),this._arrowCenter=y(),this._renderOccluded=x.OccludeAndTransparent,this._geometry=null,this._stripeLength=1,this._stripesEnabled=!0,this._color=pe(),this._contrastColor=pe(),this.applyProperties(e)}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._arrowMaterial?.setParameters({renderOccluded:e}))}get geometry(){return this._geometry}set geometry(e){this._geometry=e,this._geometryChanged()}get stripeLength(){return this._stripeLength}set stripeLength(e){this._stripeLength=e,this.attached&&this._arrowMaterial.setParameters({stripeLength:this._stripeLength})}get stripesEnabled(){return this._stripesEnabled}set stripesEnabled(e){if(this._stripesEnabled=e,this.attached){let i=this._stripesEnabled?this._contrastColor:this._color;this._arrowMaterial.setParameters({stripeEvenColor:i})}}get color(){return this._color}set color(e){ye(e,this._color)||(me(this._color,e),this._updateArrowColor())}get contrastColor(){return this._contrastColor}set contrastColor(e){ye(e,this._color)||(me(this._contrastColor,e),this._updateArrowColor())}createExternalResources(){let e=this._color,i=this._contrastColor,s=this._stripesEnabled?i:e;this._arrowMaterial=new ne({outlineColor:e,stripeEvenColor:s,stripeOddColor:e,renderOccluded:this.renderOccluded,polygonOffset:!0,isDecoration:this.isDecoration}),this._handles=new Te,this._handles.add(L(()=>this.view.state.camera,()=>{this._viewChanged()}))}destroyExternalResources(){this._arrowMaterial=null,this._handles=w(this._handles)}forEachExternalMaterial(e){e(this._arrowMaterial)}createGeometries(e){if(this._geometry?.startRenderSpace==null||this._geometry.endRenderSpace==null)return;let i=this._createArrowGeometry(this._geometry.startRenderSpace,this._geometry.endRenderSpace,this._origin,this._geometry);i.transformation=this._originTransform,e.addGeometry(i),this._viewChanged()}_createArrowGeometry(e,i,s,r){let l=this.view,u=l.renderCoordsHelper,d=[],c=[],h=(o,m)=>{let p=W.get();Y(p,o,s),d.push(p),c.push(m)};if(r.type==="euclidean"){r.eval(.5,this._arrowCenter);let o=W.get();if(u.worldUpAtPosition(this._arrowCenter,o),Tt(e,i,o)){let{heading:m,tilt:p}=l.camera,{direction:v}=Lt(l,e,m,p,xt);Ne(o,v)}h(e,o),h(i,o)}else{r.eval(.5,this._arrowCenter);let o=this._arrowSubdivisions+1&-2;for(let m=0;m<o;++m){let p=m/(o-1),v=W.get(),C=W.get();r.eval(p,v),u.worldUpAtPosition(v,C),h(v,C)}}return dt(this._arrowMaterial,d,c)}_geometryChanged(){this.recreateGeometry()}_viewChanged(){if(this.view.ready&&this.attached&&this._geometry!=null){let e=this.view.state.camera.computeScreenPixelSizeAt(this._arrowCenter);this._arrowMaterial.setParameters({width:this._arrowWidth*e})}}_updateArrowColor(){if(!this.attached)return;let e=this._color,i=this._contrastColor,s=this._stripesEnabled?i:e,r=e,l=e;this._arrowMaterial.setParameters({stripeEvenColor:s,outlineColor:r,stripeOddColor:l})}};function Tt(t,e,i){let s=qe(Et,e,t),r=$(Et,s,i);return Qe(r)===0}var Et=y(),xt=bt();var _=class extends k{get _parameters(){let t=this.view.effectiveTheme,{accentColor:e,textColor:i}=t,s=fe(e),r=$e(e,.75),l=fe(_e(e)),u=_e(i,Ze.Low);return{accentColor:s,contrastColor:l,translucentAccentColor:r,triangleLineWidth:3,geodesicProjectionLineWidth:2,guideLineWidth:2,guideStippleLengthPixels:3,directLabelFontSize:16,horizontalLabelFontSize:12,verticalLabelFontSize:12,textColor:i,textBackgroundColor:ve(u,.6),textCalloutColor:ve(u,.5)}}get visible(){return this.analysisView.visible}get viewMode(){let{elevationAlignedStartPoint:t,elevationAlignedEndPoint:e}=this.analysisView;if(t==null||e==null||t.equals(e))return f.None;let i=this.analysisView.result;if(i==null)return f.Direct;if(this.actualVisualizedMeasurement==="geodesic")return this._requiresGeodesicGuideAt(this._startPosition)||this._requiresGeodesicGuideAt(this._endPosition)?f.ProjectedGeodesic:f.Direct;let{verticalDistance:s,horizontalDistance:r}=i,l=M(s,"meters").value,u=M(r,"meters").value;return Math.min(l/u,u/l)<this.triangleCollapseRatioThreshold?f.Direct:f.Triangle}get actualVisualizedMeasurement(){let{measurementMode:t,result:e}=this.analysisView;switch(t){case V.Auto:return e!=null&&M(e.horizontalDistance,"meters").value>mt?"geodesic":"euclidean";case V.Euclidean:return"euclidean";case V.Geodesic:return"geodesic"}}get allowVisualElementsOrientationChange(){return this._triangleOrientationOverride==null}set allowVisualElementsOrientationChange(t){this._triangleOrientationOverride==null!==t&&(this._triangleOrientationOverride==null?this._triangleOrientationOverride=this._actualVisualElementsOrientation:this._triangleOrientationOverride=null)}get labels(){return this.actualVisualizedMeasurement==="geodesic"?{direct:null,horizontal:this._segmentLabel,vertical:this._verticalLabel}:{direct:this._segmentLabel,horizontal:this._horizontalLabel,vertical:this._verticalLabel}}constructor(t){super(t),this._segmentVisualElement=null,this._triangleVisualElement=null,this._rightAngleQuad=null,this._projectedGeodesicLine=null,this._geodesicStartHint=null,this._geodesicEndHint=null,this._segmentLabel=null,this._verticalLabel=null,this._horizontalLabel=null,this._startPosition=y(),this._endPosition=y(),this._cornerPosition=y(),this._startPositionAtSeaLevel=y(),this._endPositionAtSeaLevel=y(),this._triangleOrientationOverride=null,this.messages=null,this.loadingMessages=!0,this.visualElementOrientation=S.Auto,this.triangleCollapseRatioThreshold=.03}initialize(){let t=this._parameters,e={attached:!0,view:this.view,isDecoration:!0},{guideLineWidth:i,guideStippleLengthPixels:s,triangleLineWidth:r,geodesicProjectionLineWidth:l,directLabelFontSize:u,verticalLabelFontSize:d,horizontalLabelFontSize:c}=t;this._segmentVisualElement=new le(P(E({},e),{geometry:null,renderOccluded:x.OccludeAndTransparent})),this._triangleVisualElement=new q(P(E({},e),{width:r,renderOccluded:x.OccludeAndTransparent})),this._rightAngleQuad=new Ct(P(E({},e),{renderOccluded:x.OccludeAndTransparent}));let h=P(E({},e),{polygonOffset:!0,renderOccluded:x.OccludeAndTransparent});this._projectedGeodesicLine=new q(P(E({},h),{width:l,stipplePattern:ae(s)})),this._geodesicStartHint=new q(P(E({},h),{width:i,stipplePattern:ae(s)})),this._geodesicEndHint=new q(P(E({},h),{width:i,stipplePattern:ae(s)})),this._segmentLabel=new re(P(E({},e),{fontSize:u})),this._verticalLabel=new re(P(E({},e),{fontSize:d})),this._horizontalLabel=new re(P(E({},e),{fontSize:c})),this.addHandles([L(()=>{let{elevationAlignedStartPoint:o,elevationAlignedEndPoint:m}=this.analysisView,p=this.view;return{view:p,camera:p.state.camera,viewMode:this.viewMode,elevationAlignedStartPoint:o,elevationAlignedEndPoint:m,orientation:this._actualVisualElementsOrientation,visualizedMeasurement:this.actualVisualizedMeasurement,stripeLength:this._measurementArrowStripeLength}},o=>this._updateGeometryAndViewMode(o),O),L(()=>({visible:this.visible,viewMode:this.viewMode}),o=>this._updateVisualElementVisibility(o),O),L(()=>({text:this._labelsText,visualizedMeasurement:this.actualVisualizedMeasurement}),o=>this._updateLabelText(o),O),L(()=>({visible:this.visible,viewMode:this.viewMode}),o=>this._updateLabelVisibility(o),O),L(()=>this._measurementArrowStripeLength,o=>this._updateSegmentStripeLength(o),O),xe(()=>ze(this,null,function*(){return this._updateMessageBundle()})),L(()=>this._parameters,({textBackgroundColor:o,textCalloutColor:m,textColor:p,translucentAccentColor:v,accentColor:C,contrastColor:R})=>{let{_segmentLabel:G,_verticalLabel:j,_horizontalLabel:z,_triangleVisualElement:H,_rightAngleQuad:ce,_projectedGeodesicLine:b,_geodesicStartHint:F,_geodesicEndHint:de,_segmentVisualElement:D}=this;G.backgroundColor=o,G.calloutColor=m,G.textColor=p,j.backgroundColor=o,j.calloutColor=m,j.textColor=p,z.backgroundColor=o,z.calloutColor=m,z.textColor=p,H.color=v,ce.color=v,b.color=v,F.color=v,de.color=v,D.color=C,D.contrastColor=R},Ge)]),this._updateMessageBundle()}destroy(){this._segmentVisualElement=w(this._segmentVisualElement),this._triangleVisualElement=w(this._triangleVisualElement),this._rightAngleQuad=w(this._rightAngleQuad),this._projectedGeodesicLine=w(this._projectedGeodesicLine),this._geodesicStartHint=w(this._geodesicStartHint),this._geodesicEndHint=w(this._geodesicEndHint),this._segmentLabel=w(this._segmentLabel),this._verticalLabel=w(this._verticalLabel),this._horizontalLabel=w(this._horizontalLabel),this.set("view",null)}_updateVisualElementVisibility({visible:t,viewMode:e}){if(this._segmentVisualElement.visible=!1,this._triangleVisualElement.visible=!1,this._rightAngleQuad.visible=!1,this._projectedGeodesicLine.visible=!1,this._geodesicStartHint.visible=!1,this._geodesicEndHint.visible=!1,t)switch(e){case f.None:break;case f.Direct:this._segmentVisualElement.visible=!0;break;case f.Triangle:this._segmentVisualElement.visible=!0,this._triangleVisualElement.visible=!0,this._rightAngleQuad.visible=!0;break;case f.ProjectedGeodesic:this._segmentVisualElement.visible=!0,this._projectedGeodesicLine.visible=!0,this._geodesicStartHint.visible=!0,this._geodesicEndHint.visible=!0}}_updateGeometryAndViewMode({view:t,camera:e,viewMode:i,elevationAlignedStartPoint:s,elevationAlignedEndPoint:r,orientation:l,visualizedMeasurement:u,stripeLength:d}){let c=t.renderCoordsHelper;if(c==null||s==null||r==null||s.equals(r))return;let h=this._startPosition,o=this._endPosition;c.toRenderCoords(s,h),c.toRenderCoords(r,o);let m=l===S.AboveSegment?1:-1,p=m*(c.getAltitude(o)-c.getAltitude(h));p<0&&(h=this._endPosition,o=this._startPosition);let v=u==="geodesic"?new Pe(this._startPosition,this._endPosition,c.spatialReference):new N(this._startPosition,this._endPosition);switch(this._segmentVisualElement.geometry=v,this._updateSegmentStripeLength(d),i){case f.Direct:this._updateSegment(v,l);break;case f.Triangle:this._updateSegmentAndTriangle({view:t,camera:e,segment:v,orientation:l,startPosition:h,endPosition:o,deltaSign:m,altitudeDelta:p});break;case f.ProjectedGeodesic:this._updateSegmentAndProjection({view:t,orientation:l,startPosition:h,endPosition:o})}}_updateSegment(t,e){this._segmentLabel.anchor=e===S.AboveSegment?"top":"bottom",this._segmentLabel.geometry={type:"segment",segment:t,sampleLocation:"center"}}_updateSegmentAndTriangle({view:{renderCoordsHelper:t},camera:e,segment:i,orientation:s,startPosition:r,endPosition:l,deltaSign:u,altitudeDelta:d}){let c=this._cornerPosition;t.worldUpAtPosition(r,c),Fe(c,c,u*Math.abs(d)),Be(c,c,r),this._triangleVisualElement.geometry=[[[r[0],r[1],r[2]],[c[0],c[1],c[2]],[l[0],l[1],l[2]]]],this._rightAngleQuad.geometry={previous:r,center:c,next:l};let h=new N(r,c),o=new N(c,l),m=Rt(r,l,c,s,e);this._segmentLabel.anchor=m.segment,this._segmentLabel.geometry={type:"segment",segment:i,sampleLocation:"center"},this._verticalLabel.geometry={type:"segment",segment:h,sampleLocation:"center"},this._verticalLabel.anchor=m.vertical,this._horizontalLabel.geometry={type:"segment",segment:o,sampleLocation:"center"},this._horizontalLabel.anchor=m.horizontal}_updateSegmentAndProjection({view:{renderCoordsHelper:t},orientation:e,startPosition:i,endPosition:s}){t.setAltitude(this._startPositionAtSeaLevel,0,i),t.setAltitude(this._endPositionAtSeaLevel,0,s);let r=new Pe(this._startPositionAtSeaLevel,this._endPositionAtSeaLevel,t.spatialReference);this._projectedGeodesicLine.setGeometryFromSegment(r),this._geodesicStartHint.setGeometryFromSegment(new N(this._startPositionAtSeaLevel,i)),this._geodesicEndHint.setGeometryFromSegment(new N(this._endPositionAtSeaLevel,s)),this._segmentLabel.geometry={type:"segment",segment:r,sampleLocation:"center"},this._segmentLabel.anchor=e===S.AboveSegment?"top":"bottom"}_updateLabelText({text:t,visualizedMeasurement:e}){t!=null?(this._segmentLabel.text=e==="euclidean"?t.directDistance:t.horizontalDistance,this._horizontalLabel.text=t.horizontalDistance,this._verticalLabel.text=t.verticalDistance):(this._segmentLabel.text=null,this._horizontalLabel.text=null,this._verticalLabel.text=null),this.notifyChange("labels")}_updateLabelVisibility({visible:t,viewMode:e}){let i=this._segmentLabel,s=this._horizontalLabel,r=this._verticalLabel;if(i.visible=!1,s.visible=!1,r.visible=!1,t)switch(e){case f.Direct:i.visible=!0;break;case f.Triangle:i.visible=!0,s.visible=!0,r.visible=!0;break;case f.ProjectedGeodesic:i.visible=!0;case f.None:}}get _labelsText(){if(this.destroyed)return null;let t=this.messages,e=this.analysisView.result;if(e==null||t==null)return null;let{directDistance:i,horizontalDistance:s,verticalDistance:r}=e,l=this.analysisView.unit,u=d=>E({directDistance:"",horizontalDistance:"",verticalDistance:""},d);switch(l){case"metric":return u({directDistance:i&&Ae(t,i),horizontalDistance:s&&Ae(t,s),verticalDistance:r&&ft(t,r)});case"imperial":return u({directDistance:i&&Ce(t,i),horizontalDistance:s&&Ce(t,s),verticalDistance:r&&yt(t,r)});default:return u({directDistance:i&&ie(t,i,l),horizontalDistance:s&&ie(t,s,l),verticalDistance:r&&ie(t,r,l)})}}_updateSegmentStripeLength(t){let e=this._segmentVisualElement;t!=null?(e.stripeLength=t,e.stripesEnabled=!0):e.stripesEnabled=!1}get _actualVisualElementsOrientation(){if(this._triangleOrientationOverride!=null)return this._triangleOrientationOverride;let t=this.visualElementOrientation;return t===S.Auto?this.view.state.camera.aboveGround?S.AboveSegment:S.BelowSegment:t}_requiresGeodesicGuideAt(t){let e=this.view;if(!e?.state)return!1;let i=e.state.camera,s=e.renderCoordsHelper;if(!s)return!1;let r=i.computeScreenPixelSizeAt(t);return s.getAltitude(t)/r>=10}get _measurementArrowStripeLength(){let{result:t,unit:e}=this.analysisView;if(t==null)return null;let i=null,s=t.directDistance;switch(e){case"metric":i=s&&M(s,"meters");break;case"imperial":i=s&&M(s,Ue(s.value,s.unit));break;default:i=s&&M(s,e)}return i==null?null:Ie(i.value/30)*je(1,i.unit,"meters")}_updateMessageBundle(){this.loadingMessages=!0,Re("esri/core/t9n/Units").then(t=>{this.messages=t}).finally(()=>{this.loadingMessages=!1})}get testData(){}};function Rt(t,e,i,s,r){let l=Gt,u=jt;r.projectToRenderScreen(i,l),r.projectToRenderScreen(e,u);let d={segment:"bottom",horizontal:"top",vertical:l[0]<u[0]?"left":"right"};{let c=Ht,h=Ut;if(se(t,i,r,c),se(t,e,r,h),ge(c,h)>=Pt){let o=Math.sign(c[1])===Math.sign(h[1]);d.segment=o?Ee(d.vertical):d.vertical}else{let o=It;se(i,e,r,o),ge(o,h)>=Pt&&(d.segment=Math.sign(o[0])===Math.sign(h[0])?Ee(d.horizontal):d.horizontal)}}if(s===S.BelowSegment){let c=h=>h==="top"?"bottom":"top";d.segment=c(d.segment),d.horizontal=c(d.horizontal),d.vertical=c(d.vertical)}return d}a([n()],_.prototype,"_parameters",null),a([n()],_.prototype,"_triangleOrientationOverride",void 0),a([n()],_.prototype,"messages",void 0),a([n()],_.prototype,"view",void 0),a([n()],_.prototype,"analysis",void 0),a([n()],_.prototype,"analysisView",void 0),a([n()],_.prototype,"loadingMessages",void 0),a([n()],_.prototype,"visible",null),a([n()],_.prototype,"viewMode",null),a([n()],_.prototype,"actualVisualizedMeasurement",null),a([n()],_.prototype,"visualElementOrientation",void 0),a([n()],_.prototype,"triangleCollapseRatioThreshold",void 0),a([n()],_.prototype,"allowVisualElementsOrientationChange",null),a([n()],_.prototype,"labels",null),a([n()],_.prototype,"_labelsText",null),a([n()],_.prototype,"_actualVisualElementsOrientation",null),a([n()],_.prototype,"_measurementArrowStripeLength",null),_=a([I("esri.views.3d.analysis.DirectLineMeasurement.DirectLineMeasurementVisualization")],_);var Pt=Math.cos(ke(12)),Gt=he(),jt=he(),Ht=J(),Ut=J(),It=J();var g=class extends ht(k){constructor(t){super(t),this.type="direct-line-measurement-view-3d",this.analysis=null,this.result=null,this.measurementMode=V.Auto,this.elevationAlignedStartPoint=null,this.elevationAlignedEndPoint=null}initialize(){let t=this.view,e=this.analysis;this._analysisVisualization=new _({view:t,analysis:e,analysisView:this}),this._analysisController=new T({view:t,analysis:e,viewData:this})}destroy(){this._analysisController=w(this._analysisController),this._analysisVisualization=w(this._analysisVisualization)}get updating(){return!!this._analysisVisualization?.loadingMessages}get viewMode(){return this._analysisVisualization.viewMode}get actualVisualizedMeasurement(){return this._analysisVisualization.actualVisualizedMeasurement}get visualElementOrientation(){return this._analysisVisualization.visualElementOrientation}set visualElementOrientation(t){this._analysisVisualization.visualElementOrientation=t}get allowVisualElementsOrientationChange(){return this._analysisVisualization.allowVisualElementsOrientationChange}set allowVisualElementsOrientationChange(t){this._analysisVisualization.allowVisualElementsOrientationChange=t}get triangleCollapseRatioThreshold(){return this._analysisVisualization.triangleCollapseRatioThreshold}set triangleCollapseRatioThreshold(t){this._analysisVisualization.triangleCollapseRatioThreshold=t}get directLabelText(){return this._analysisVisualization.labels.direct?.text??""}get horizontalLabelText(){return this._analysisVisualization.labels.horizontal?.text??""}get verticalLabelText(){return this._analysisVisualization.labels.vertical?.text??""}get unit(){return this.analysis.unit??this._defaultUnit}get testData(){}};a([n()],g.prototype,"updating",null),a([n({readOnly:!0})],g.prototype,"type",void 0),a([n({constructOnly:!0,nonNullable:!0})],g.prototype,"analysis",void 0),a([n()],g.prototype,"result",void 0),a([n()],g.prototype,"measurementMode",void 0),a([n()],g.prototype,"elevationAlignedStartPoint",void 0),a([n()],g.prototype,"elevationAlignedEndPoint",void 0),a([n({readOnly:!0})],g.prototype,"viewMode",null),a([n({readOnly:!0})],g.prototype,"actualVisualizedMeasurement",null),a([n()],g.prototype,"visualElementOrientation",null),a([n()],g.prototype,"allowVisualElementsOrientationChange",null),a([n()],g.prototype,"triangleCollapseRatioThreshold",null),a([n({readOnly:!0})],g.prototype,"directLabelText",null),a([n({readOnly:!0})],g.prototype,"horizontalLabelText",null),a([n({readOnly:!0})],g.prototype,"verticalLabelText",null),a([n()],g.prototype,"_analysisVisualization",void 0),a([n()],g.prototype,"_analysisController",void 0),a([n()],g.prototype,"unit",null),a([n(ut)],g.prototype,"_defaultUnit",void 0),g=a([I("esri.views.3d.analysis.DirectLineMeasurementAnalysisView3D")],g);var Us=g;export{Us as default};
