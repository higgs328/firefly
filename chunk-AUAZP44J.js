import{d as ie}from"./chunk-PVDFCTA4.js";import{d as f}from"./chunk-KNVXE32P.js";import{$ as I,A as ne,B as d,D as _,E as M,R as ae,W,Z as $,c as X,f as Y,h as E,k as q,l as Z,m as H,n as ee,p as re,q as te,u as F,v as U,w as P,x as se,z as oe}from"./chunk-76ATOSLU.js";import{c as J}from"./chunk-P6QFA5MM.js";import{o as x,r as O,u as Q,y as V}from"./chunk-4PTIEWMT.js";import{b as k}from"./chunk-YOFFGXOB.js";import{e as g}from"./chunk-6MRUJ2UW.js";import{b as G}from"./chunk-2LI2GKBQ.js";import{a as b}from"./chunk-QBWJMFH5.js";import{a as v,f as h}from"./chunk-VTHXE323.js";var le={mapserver:"MapServer",imageserver:"ImageServer",featureserver:"FeatureServer",knowledgegraphserver:"KnowledgeGraphServer",sceneserver:"SceneServer",streamserver:"StreamServer",vectortileserver:"VectorTileServer","3dtilesserver":"3DTilesServer",videoserver:"VideoServer"},ue=Object.values(le),ce=new RegExp(`^((?:https?:)?\\/\\/\\S+?\\/rest\\/services\\/(.+?)\\/(${ue.join("|")}))(?:\\/(?:layers\\/)?(\\d+))?`,"i"),Ae=new RegExp(`^((?:https?:)?\\/\\/\\S+?\\/([^/\\n]+)\\/(${ue.join("|")}))(?:\\/(?:layers\\/)?(\\d+))?`,"i"),ke=/(.*?)\/(?:layers\/)?(\d+)\/?$/i;function Be(e){return ce.test(e)}function de(e){if(e==null)return null;let r=q(e),t=r?.path.match(ce)||r?.path.match(Ae);if(!t)return null;let[,s,o,n,l]=t,a=o.indexOf("/");return{title:me(a!==-1?o.slice(a+1):o),serverType:le[n.toLowerCase()],sublayer:l!=null&&l!==""?parseInt(l,10):null,url:{path:s}}}function xe(e){let r=q(e).path.match(ke);return r?{serviceUrl:r[1],sublayerId:Number(r[2])}:null}function me(e){return(e=e.replaceAll(/\s*[/_]+\s*/g," "))[0].toUpperCase()+e.slice(1)}function Ge(e,r){let t=[];if(e){let s=de(e);s!=null&&s.title&&t.push(s.title)}if(r){let s=me(r);t.push(s)}if(t.length===2){if(t[0].toLowerCase().includes(t[1].toLowerCase()))return t[0];if(t[1].toLowerCase().includes(t[0].toLowerCase()))return t[1]}return t.join(" - ")}function K(e){let r=d(e,!0);return!!r&&(r=r.toLowerCase(),r.endsWith(".arcgis.com")&&(r.startsWith("services")||r.startsWith("tiles")||r.startsWith("features")))}function Qe(e,r){return e&&W($(e,r))}function Ve(e){let{url:r}=e;if(!r)return{url:r};r=$(r,e.logger);let t=q(r),s=de(t.path),o;if(s!=null)s.sublayer!=null&&e.layer.layerId==null&&(o=s.sublayer),r=s.url.path;else if(e.nonStandardUrlAllowed){let n=xe(t.path);n!=null&&(r=n.serviceUrl,o=n.sublayerId)}return{url:W(r),layerId:o}}function Je(e,r,t,s,o){ie(r,s,"url",o),s.url&&e.layerId!=null&&(s.url=ne(s.url,t,e.layerId.toString()))}function Xe(e){if(!e)return!1;let r=e.toLowerCase(),t=r.includes("/services/"),s=r.includes("/mapserver/wmsserver"),o=r.includes("/imageserver/wmsserver"),n=r.includes("/wmsserver");return t&&(s||o||n)}function Ye(e){if(!e)return!1;let r=new Y(se(e)),t=r.authority?.toLowerCase();return t==="server.arcgisonline.com"||t==="services.arcgisonline.com"}var Ee=new Set(["elevation3d.arcgis.com","js.arcgis.com","jsdev.arcgis.com","jsqa.arcgis.com","static.arcgis.com"]);function Ue(e){let r=d(e,!0);return!!r&&r.endsWith(".arcgis.com")&&!Ee.has(r)&&!e.endsWith("/sharing/rest/generateToken")}function pe(e,r){return!(!r&&!g.apiKey||!Ue(e))}function he(e,r,t=!1,s){return new Promise((o,n)=>{if(O(s))return void n(fe());let l=()=>{i(),n(new Error(`Unable to load ${r}`))},a=()=>{let m=e;i(),o(m)},u=()=>{if(!e)return;let m=e;i(),m.src="",n(fe())},i=()=>{b("esri-image-decode")||(e.removeEventListener("error",l),e.removeEventListener("load",a)),l=null,a=null,e=null,s?.removeEventListener("abort",u),u=null,t&&URL.revokeObjectURL(r)};s?.addEventListener("abort",u),b("esri-image-decode")?e.decode().then(a,l):(e.addEventListener("error",l),e.addEventListener("load",a))})}function fe(){try{return new DOMException("Aborted","AbortError")}catch{let e=new Error;return e.name="AbortError",e}}var ye="Timeout exceeded";function ge(){return new Error(ye)}function ir(e){return typeof e=="object"&&!!e&&"message"in e&&e.message===ye}function we(e){g.request.crossOriginNoCorsDomains||(g.request.crossOriginNoCorsDomains={});let r=g.request.crossOriginNoCorsDomains;for(let t of e)t=t.toLowerCase(),/^https?:\/\//.test(t)?r[d(t)??""]=0:(r[d("http://"+t)??""]=0,r[d("https://"+t)??""]=0)}function ve(e){let r=g.request.crossOriginNoCorsDomains;if(r){let t=d(e);if(t)return t=t.toLowerCase(),!U(t,E())&&r[t]<Date.now()-36e5}return!1}function be(e){return h(this,null,function*(){let r=q(e);e=r.path,r.query?.f==="json"&&(e+="?f=json");try{yield fetch(e,{mode:"no-cors",credentials:"include"})}catch{}let t=g.request.crossOriginNoCorsDomains,s=d(e);t&&s&&(t[s.toLowerCase()]=Date.now())})}function S(e,r){return h(this,null,function*(){e instanceof URL&&(e=e.toString()),r?.query instanceof URLSearchParams&&(r.query=Z(r.query.toString().replaceAll("+"," ")));let t=M(e),s=_(e);s||t||(e=oe(e));let o={url:e,requestOptions:v({},r)},n=p=>({data:p,getAllHeaders:T,getHeader:T,httpStatus:200,requestOptions:o.requestOptions,url:o.url}),l=F(e,y.internalInterceptors);if(l){let p=yield qe(l,o);if(p!=null)return n(p)}let a=F(e);if(a){let p=yield qe(a,o);if(p!=null)return n(p);a.after||a.error||(a=null)}if(e=o.url,(r=o.requestOptions).responseType==="image"&&(b("host-webworker")||b("host-node")))throw w("request:invalid-parameters",new Error("responseType 'image' is not supported in Web Workers or Node environment"),o);if(r.method==="head"){if(r.body)throw w("request:invalid-parameters",new Error("body parameter cannot be set when method is 'head'"),o);if(t||s)throw w("request:invalid-parameters",new Error("data and blob URLs are not supported for method 'head'"),o)}if(yield je(),R)return R.execute(e,r);let u=new AbortController,i=Q(r,()=>u.abort()),m={controller:u,credential:void 0,credentialToken:void 0,fetchOptions:void 0,hasToken:!1,interceptor:a,params:o,redoRequest:!1,useIdentity:y.useIdentity,useProxy:!1,useSSL:!1,withCredentials:!1},C=r.useRequestQueue?Me(m):B(m),c=yield C.finally(()=>i?.remove());return a?.after?.(c),c})}var R,y=g.request,Ce="FormData"in globalThis,Pe=new Set([499,498,403,401]),Ie=new Set(["COM_0056","COM_0057","SB_0008"]),Re=[/\/arcgis\/tokens/i,/\/sharing(\/rest)?\/generatetoken/i,/\/rest\/info/i],T=()=>null,D=Symbol();function De(e){let r=d(e);r&&!S._corsServers.includes(r)&&S._corsServers.push(r)}function Se(e){let r=d(e);return!r||r.endsWith(".arcgis.com")||S._corsServers.includes(r)||P(r)}function w(e,r,t,s){let o="Error",n={url:t.url,requestOptions:t.requestOptions,getAllHeaders:T,getHeader:T,ssl:!1};if(r instanceof k)return r.details?(r.details=G(r.details),r.details.url=t.url,r.details.requestOptions=t.requestOptions):r.details=n,r;if(r){let l=s&&(()=>Array.from(s.headers)),a=s&&(m=>s.headers.get(m)),u=s?.status,i=r.message;i&&(o=i),l&&a&&(n.getAllHeaders=l,n.getHeader=a),n.httpStatus=(r.httpCode!=null?r.httpCode:r.code)||u||0,n.subCode=r.subcode,n.messageCode=r.messageCode,typeof r.details=="string"?n.messages=[r.details]:n.messages=r.details,n.raw=D in r?r[D]:r}return V(r)?x():new k(e,o,n)}function je(){return h(this,null,function*(){b("host-webworker")&&!R&&(R=yield import("./chunk-DFTBOFFS.js"))})}function z(){return h(this,null,function*(){f||(yield import("./chunk-EVDO6OO6.js"))})}function Ne(e){return h(this,null,function*(){let r=e.params.url,t=e.params.requestOptions,s=e.controller.signal,o=t.body,n=null,l=null;if(Ce&&"HTMLFormElement"in globalThis&&(o instanceof FormData?n=o:o instanceof HTMLFormElement&&(n=new FormData(o))),typeof o=="string"&&(l=o),e.fetchOptions={cache:t.cacheBust?"no-cache":"default",credentials:"same-origin",headers:t.headers||{},method:t.method==="head"?"HEAD":"GET",mode:"cors",priority:y.priority,redirect:"follow",signal:s},(n||l)&&(e.fetchOptions.body=n||l),t.authMode==="anonymous"&&(e.useIdentity=!1),e.hasToken=!!(/token=/i.test(r)||t.query?.token||n?.get("token")),!e.hasToken&&pe(r)&&(t.query||(t.query={}),t.query.token=g.apiKey,e.hasToken=!0),e.useIdentity&&!e.hasToken&&!e.credentialToken&&!Le(r)&&!O(s)){let a;t.authMode==="immediate"?(yield z(),a=yield f.getCredential(r,{signal:s}),e.credential=a):t.authMode==="no-prompt"?(yield z(),a=yield f.getCredential(r,{prompt:!1,signal:s}).catch(()=>{}),e.credential=a):f&&(a=f.findCredential(r)),a&&(e.credentialToken=a.token,e.useSSL=!!a.ssl)}})}function Le(e){return Re.some(r=>r.test(e))}function He(e){return h(this,null,function*(){let r=e.params.url,t=e.params.requestOptions,s=e.fetchOptions??{},o=_(r)||M(r),n=t.responseType||"json",l=o?0:t.timeout!=null?t.timeout:y.timeout,a=!1;if(!o){e.useSSL&&(r=ae(r));let c=v({},t.query);e.credentialToken&&(c.token=e.credentialToken);let p=H(c);b("esri-url-encodes-apostrophe")&&(p=p.replaceAll("'","%27"));let j=r.length+1+p.length,N;a=t.method==="delete"||t.method==="post"||t.method==="put"||!!t.body||j>y.maxUrlLength;let L=t.useProxy||!!te(r);if(L){let A=ee(r);N=A.path,!a&&N.length+1+j>y.maxUrlLength&&(a=!0),A.query&&(c=v(v({},A.query),c))}if(s.method==="HEAD"&&(a||L)){if(a)throw j>y.maxUrlLength?w("request:invalid-parameters",new Error("URL exceeds maximum length"),e.params):w("request:invalid-parameters",new Error("cannot use POST request when method is 'head'"),e.params);if(L)throw w("request:invalid-parameters",new Error("cannot use proxy when method is 'head'"),e.params)}a?(s.method=t.method==="delete"?"DELETE":t.method==="put"?"PUT":"POST",t.body?r=I(r,c):(s.body=H(c),s.headers||(s.headers={}),s.headers["Content-Type"]="application/x-www-form-urlencoded")):r=I(r,c),L&&(e.useProxy=!0,r=`${N}?${r}`),c.token&&Ce&&s.body instanceof FormData&&!X(r)&&s.body.set("token",c.token),t.hasOwnProperty("withCredentials")?e.withCredentials=t.withCredentials:U(r,E())||(P(r)||f&&f.findServerInfo(r)?.webTierAuth)&&(e.withCredentials=!0),e.withCredentials&&(s.credentials="include",ve(r)&&(yield be(a?I(r,c):r)))}let u,i,m=0,C=!1;l>0&&(m=setTimeout(()=>{C=!0,e.controller.abort()},l));try{if(t.responseType==="native-request-init")i=s,i.url=r,t.signal?i.signal=t.signal:delete i.signal;else if(t.responseType!=="image"||s.cache!=="default"||s.method!=="GET"||a||Fe(t.headers)||!o&&!e.useProxy&&y.proxyUrl&&!Se(r)){if(S._beforeFetch&&(yield S._beforeFetch(r,s)),u=yield fetch(r,s),S._afterFetch&&(yield S._afterFetch(u)),e.useProxy||De(r),t.responseType==="native")i=u;else if(s.method!=="HEAD")if(u.ok){switch(n){case"array-buffer":i=yield u.arrayBuffer();break;case"blob":case"image":i=yield u.blob();break;default:i=yield u.text()}if(m&&(clearTimeout(m),m=0),n==="json"||n==="xml"||n==="document")if(i)switch(n){case"json":i=JSON.parse(i);break;case"xml":i=Te(i,"application/xml");break;case"document":i=Te(i,"text/html")}else i=null;if(i){if(n==="array-buffer"||n==="blob"){let c=u.headers.get("Content-Type");if(c&&/application\/json|text\/plain/i.test(c)&&i[n==="blob"?"size":"byteLength"]<=750)try{let p=yield new Response(i).json();p.error&&(i=p)}catch{}}n==="image"&&i instanceof Blob&&(i=yield Oe(URL.createObjectURL(i),e,!0))}}else{i=yield u.text();try{i=JSON.parse(i)}catch{}}}else i=yield Oe(r,e)}catch(c){if(c.name==="AbortError")throw C?ge():x("Request canceled");if(!(!u&&c instanceof TypeError&&y.proxyUrl)||t.body||t.method==="delete"||t.method==="head"||t.method==="post"||t.method==="put"||e.useProxy||Se(r))throw c;e.redoRequest=!0,re({proxyUrl:y.proxyUrl,urlPrefix:d(r)??""})}finally{m&&clearTimeout(m)}return[u,i]})}function qe(e,r){return h(this,null,function*(){if(e.responseData!=null)return e.responseData;if(e.headers&&(r.requestOptions.headers=v(v({},r.requestOptions.headers),e.headers)),e.query&&(r.requestOptions.query=v(v({},r.requestOptions.query),e.query)),e.before){let t,s;try{s=yield e.before(r)}catch(o){t=w("request:interceptor",o,r)}if((s instanceof Error||s instanceof k)&&(t=w("request:interceptor",s,r)),t)throw e.error&&e.error(t),t;return s}})}function Fe(e){if(e){for(let r of Object.getOwnPropertyNames(e))if(e[r])return!0}return!1}function Te(e,r){let t;try{t=new DOMParser().parseFromString(e,r)}catch{}if(!t||t.getElementsByTagName("parsererror").length)throw new SyntaxError("XML Parse error");return t}S._corsServers=["https://server.arcgisonline.com","https://services.arcgisonline.com"],S._beforeFetch=void 0,S._afterFetch=void 0;var _e=new Map;function Me(e){return h(this,null,function*(){let r=$e(e.params.url);if(!r)return B(e);let{QueueProcessor:t}=yield import("./chunk-LI4ZQY6O.js");return J(_e,r.origin,()=>{let o=r.isHosted?b("request-queue-concurrency-hosted"):b("request-queue-concurrency-non-hosted");return new t({concurrency:o,process:n=>{if(O(n.params.requestOptions))throw w("",x("Request canceled"),n.params);return B(n)}})}).push(e)})}function B(e){return h(this,null,function*(){let r,t;yield Ne(e);try{do[r,t]=yield He(e);while(!(yield We(e,r,t)))}catch(n){let l=w("request:server",n,e.params,r);throw l.details.ssl=e.useSSL,e.interceptor?.error&&e.interceptor.error(l),l}let s=e.params.url;if(t&&/\/sharing\/rest\/(accounts|portals)\/self/i.test(s)){if(!e.hasToken&&!e.credentialToken&&t.user?.username&&!P(s)){let n=d(s,!0);n&&y.trustedServers.push(n)}Array.isArray(t.authorizedCrossOriginNoCorsDomains)&&we(t.authorizedCrossOriginNoCorsDomains)}let o=e.credential;if(o&&f){let l=f.findServerInfo(o.server)?.owningSystemUrl;if(l){l=l.replace(/\/?$/,"/sharing");let a=f.findCredential(l,o.userId);a&&f._getIdenticalSvcIdx(l,a)===-1&&a.resources.unshift(l)}}return{data:t,getAllHeaders:r?()=>Array.from(r.headers):T,getHeader:r?n=>r.headers.get(n):T,httpStatus:r?.status??200,requestOptions:e.params.requestOptions,ssl:e.useSSL,url:e.params.url}})}function We(e,r,t){return h(this,null,function*(){if(e.redoRequest)return e.redoRequest=!1,!1;let s=e.params.requestOptions;if(!r||s.responseType==="native"||s.responseType==="native-request-init")return!0;let o,n;if(t&&(t.error&&typeof t.error=="object"?o=t.error:t.status==="error"&&Array.isArray(t.messages)&&(o=v({},t),o[D]=t,o.details=t.messages)),!o&&!r.ok)throw o=new Error(`Unable to load ${r.url} status: ${r.status}`),o[D]=t,o;let l,a=null;o&&(n=Number(o.code),a=o.hasOwnProperty("subcode")?Number(o.subcode):null,l=o.messageCode,l=l?.toUpperCase());let u=s.authMode;if(n===403&&(a===4||o.message?.toLowerCase().includes("ssl")&&!o.message.toLowerCase().includes("permission"))){if(!e.useSSL)return e.useSSL=!0,!1}else if(!e.hasToken&&e.useIdentity&&(u!=="no-prompt"||n===498)&&n!==void 0&&Pe.has(n)&&!Le(e.params.url)&&(n!==403||(!l||!Ie.has(l))&&(a==null||a===2&&e.credentialToken))){yield z();try{let i=yield f.getCredential(e.params.url,{error:w("request:server",o,e.params),prompt:u!=="no-prompt",signal:e.controller.signal,token:e.credentialToken});return e.credential=i,e.credentialToken=i.token,e.useSSL=e.useSSL||i.ssl,!1}catch(i){if(u==="no-prompt")return e.credential=void 0,e.credentialToken=void 0,!1;o=i}}if(o)throw o;return!0})}function Oe(e,r,t=!1){let s=r.controller.signal,o=new Image;return r.withCredentials?o.crossOrigin="use-credentials":o.crossOrigin="anonymous",o.alt="",o.fetchPriority=y.priority,o.src=e,he(o,e,t,s)}function $e(e){let r,t;return typeof e=="string"?(r=d(e,!0),t=K(e)):(r=e.origin,t=K(e.toString())),r==null?null:{origin:r,isHosted:t}}export{Be as a,de as b,xe as c,me as d,Ge as e,K as f,Qe as g,Ve as h,Je as i,Xe as j,Ye as k,pe as l,he as m,ir as n,S as o};
