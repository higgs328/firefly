import{b as Ce}from"./chunk-KPT44MCK.js";import{C as ve,D as xe,d as Se}from"./chunk-GJ2QRXGN.js";import{a as D}from"./chunk-PDQQY7RQ.js";import{a as G}from"./chunk-RWCIDBNQ.js";import{D as qe,a as ze,b as Le,c as Me,d as we,p as Oe}from"./chunk-2ZFXOJDB.js";import{G as ee,b as fe,c as _,u as ge,w as Be}from"./chunk-6B5XFA6F.js";import{F as me,G as ye}from"./chunk-ZTOZWLEE.js";import{a as H}from"./chunk-BOVYXYHK.js";function dt(s,n,o,t=1){let{data:f,indices:e}=s,i=n.typedBuffer,r=n.typedBufferStride,c=e.length;if(o*=r,t===1)for(let l=0;l<c;++l)i[o]=f[e[l]],o+=r;else for(let l=0;l<c;++l){let a=f[e[l]];for(let u=0;u<t;u++)i[o]=a,o+=r}}function De(s,n,o){let{data:t,indices:f}=s,e=n.typedBuffer,i=n.typedBufferStride,r=f.length;o*=i;for(let c=0;c<r;++c){let l=2*f[c];e[o]=t[l],e[o+1]=t[l+1],o+=i}}function Pe(s,n,o,t){let{data:f,indices:e}=s,i=n.typedBuffer,r=n.typedBufferStride,c=e.length;if(o*=r,t==null||t===1)for(let l=0;l<c;++l){let a=3*e[l];i[o]=f[a],i[o+1]=f[a+1],i[o+2]=f[a+2],o+=r}else for(let l=0;l<c;++l){let a=3*e[l];for(let u=0;u<t;++u)i[o]=f[a],i[o+1]=f[a+1],i[o+2]=f[a+2],o+=r}}function ke(s,n,o,t=1){let{data:f,indices:e}=s,i=n.typedBuffer,r=n.typedBufferStride,c=e.length;if(o*=r,t===1)for(let l=0;l<c;++l){let a=4*e[l];i[o]=f[a],i[o+1]=f[a+1],i[o+2]=f[a+2],i[o+3]=f[a+3],o+=r}else for(let l=0;l<c;++l){let a=4*e[l];for(let u=0;u<t;++u)i[o]=f[a],i[o+1]=f[a+1],i[o+2]=f[a+2],i[o+3]=f[a+3],o+=r}}function pt(s,n,o){let t=s.typedBuffer,f=s.typedBufferStride;n*=f;for(let e=0;e<o;++e)t[n]=0,t[n+1]=0,t[n+2]=0,t[n+3]=0,n+=f}function Ge(s,n,o,t,f=1){if(!n)return void Pe(s,o,t,f);let{data:e,indices:i}=s,r=o.typedBuffer,c=o.typedBufferStride,l=i.length,a=n[0],u=n[1],w=n[2],L=n[4],F=n[5],v=n[6],B=n[8],z=n[9],A=n[10],I=n[12],E=n[13],R=n[14];t*=c;let O=0,h=0,p=0,g=ye(n)?m=>{O=e[m]+I,h=e[m+1]+E,p=e[m+2]+R}:m=>{let d=e[m],y=e[m+1],b=e[m+2];O=a*d+L*y+B*b+I,h=u*d+F*y+z*b+E,p=w*d+v*y+A*b+R};if(f===1)for(let m=0;m<l;++m)g(3*i[m]),r[t]=O,r[t+1]=h,r[t+2]=p,t+=c;else for(let m=0;m<l;++m){g(3*i[m]);for(let d=0;d<f;++d)r[t]=O,r[t+1]=h,r[t+2]=p,t+=c}}function We(s,n,o,t,f=1){if(!n)return void Pe(s,o,t,f);let{data:e,indices:i}=s,r=n,c=o.typedBuffer,l=o.typedBufferStride,a=i.length,u=r[0],w=r[1],L=r[2],F=r[4],v=r[5],B=r[6],z=r[8],A=r[9],I=r[10],E=!me(r),R=1e-6,O=1-R;t*=l;let h=0,p=0,g=0,m=ye(r)?d=>{h=e[d],p=e[d+1],g=e[d+2]}:d=>{let y=e[d],b=e[d+1],M=e[d+2];h=u*y+F*b+z*M,p=w*y+v*b+A*M,g=L*y+B*b+I*M};if(f===1)if(E)for(let d=0;d<a;++d){m(3*i[d]);let y=h*h+p*p+g*g;if(y<O&&y>R){let b=1/Math.sqrt(y);c[t]=h*b,c[t+1]=p*b,c[t+2]=g*b}else c[t]=h,c[t+1]=p,c[t+2]=g;t+=l}else for(let d=0;d<a;++d)m(3*i[d]),c[t]=h,c[t+1]=p,c[t+2]=g,t+=l;else for(let d=0;d<a;++d){if(m(3*i[d]),E){let y=h*h+p*p+g*g;if(y<O&&y>R){let b=1/Math.sqrt(y);h*=b,p*=b,g*=b}}for(let y=0;y<f;++y)c[t]=h,c[t+1]=p,c[t+2]=g,t+=l}}function He(s,n,o,t,f=1){if(!n)return void ke(s,o,t,f);let{data:e,indices:i}=s,r=n,c=o.typedBuffer,l=o.typedBufferStride,a=i.length,u=r[0],w=r[1],L=r[2],F=r[4],v=r[5],B=r[6],z=r[8],A=r[9],I=r[10],E=!me(r),R=1e-6,O=1-R;if(t*=l,f===1)for(let h=0;h<a;++h){let p=4*i[h],g=e[p],m=e[p+1],d=e[p+2],y=e[p+3],b=u*g+F*m+z*d,M=w*g+v*m+A*d,V=L*g+B*m+I*d;if(E){let N=b*b+M*M+V*V;if(N<O&&N>R){let T=1/Math.sqrt(N);b*=T,M*=T,V*=T}}c[t]=b,c[t+1]=M,c[t+2]=V,c[t+3]=y,t+=l}else for(let h=0;h<a;++h){let p=4*i[h],g=e[p],m=e[p+1],d=e[p+2],y=e[p+3],b=u*g+F*m+z*d,M=w*g+v*m+A*d,V=L*g+B*m+I*d;if(E){let N=b*b+M*M+V*V;if(N<O&&N>R){let T=1/Math.sqrt(N);b*=T,M*=T,V*=T}}for(let N=0;N<f;++N)c[t]=b,c[t+1]=M,c[t+2]=V,c[t+3]=y,t+=l}}function Je(s,n,o,t,f=1){let{data:e,indices:i}=s,r=o.typedBuffer,c=o.typedBufferStride,l=i.length;if(t*=c,n!==e.length||n!==4)if(f!==1)if(n!==4)for(let a=0;a<l;++a){let u=3*i[a];for(let w=0;w<f;++w)r[t]=e[u],r[t+1]=e[u+1],r[t+2]=e[u+2],r[t+3]=255,t+=c}else for(let a=0;a<l;++a){let u=4*i[a];for(let w=0;w<f;++w)r[t]=e[u],r[t+1]=e[u+1],r[t+2]=e[u+2],r[t+3]=e[u+3],t+=c}else{if(n===4){for(let a=0;a<l;++a){let u=4*i[a];r[t]=e[u],r[t+1]=e[u+1],r[t+2]=e[u+2],r[t+3]=e[u+3],t+=c}return}for(let a=0;a<l;++a){let u=3*i[a];r[t]=e[u],r[t+1]=e[u+1],r[t+2]=e[u+2],r[t+3]=255,t+=c}}else{r[t]=e[0],r[t+1]=e[1],r[t+2]=e[2],r[t+3]=e[3];let a=new Uint32Array(o.typedBuffer.buffer,o.start),u=c/4,w=a[t/=4];t+=u;let L=l*f;for(let F=1;F<L;++F)a[t]=w,t+=u}}function Ke(s,n,o){let{data:t,indices:f}=s,e=n.typedBuffer,i=n.typedBufferStride,r=f.length,c=t[0];o*=i;for(let l=0;l<r;++l)e[o]=c,o+=i}function Xe(s,n,o,t,f=1){let e=n.typedBuffer,i=n.typedBufferStride;if(t*=i,f===1)for(let r=0;r<o;++r)e[t]=s[0],e[t+1]=s[1],e[t+2]=s[2],e[t+3]=s[3],t+=i;else for(let r=0;r<o;++r)for(let c=0;c<f;++c)e[t]=s[0],e[t+1]=s[1],e[t+2]=s[2],e[t+3]=s[3],t+=i}function ht(s,n,o,t,f,e,i){for(let r of o.fields.keys()){let c=s.get(r),l=c?.indices;if(c&&l)Ye(r,c,t,f,e,i);else if(r===G.OBJECTANDLAYERIDCOLOR&&n!=null){let a=s.get(G.POSITION)?.indices;if(a){let u=a.length;Xe(n,e.getField(r,Oe),u,i)}}}}function Ye(s,n,o,t,f,e){switch(s){case G.POSITION:{D(n.size===3);let i=f.getField(s,Me);D(!!i,`No buffer view for ${s}`),i&&Ge(n,o,i,e);break}case G.NORMAL:{D(n.size===3);let i=f.getField(s,Me);D(!!i,`No buffer view for ${s}`),i&&We(n,t,i,e);break}case G.NORMALCOMPRESSED:{D(n.size===2);let i=f.getField(s,qe);D(!!i,`No buffer view for ${s}`),i&&De(n,i,e);break}case G.UV0:{D(n.size===2);let i=f.getField(s,Le);D(!!i,`No buffer view for ${s}`),i&&De(n,i,e);break}case G.COLOR:case G.SYMBOLCOLOR:{let i=f.getField(s,Oe);D(!!i,`No buffer view for ${s}`),D(n.size===3||n.size===4),!i||n.size!==3&&n.size!==4||Je(n,n.size,i,e);break}case G.COLORFEATUREATTRIBUTE:{let i=f.getField(s,ze);D(!!i,`No buffer view for ${s}`),D(n.size===1),i&&n.size===1&&Ke(n,i,e);break}case G.TANGENT:{D(n.size===4);let i=f.getField(s,we);D(!!i,`No buffer view for ${s}`),i&&He(n,o,i,e);break}case G.PROFILERIGHT:case G.PROFILEUP:case G.PROFILEVERTEXANDNORMAL:case G.FEATUREVALUE:{D(n.size===4);let i=f.getField(s,we);D(!!i,`No buffer view for ${s}`),i&&ke(n,i,e)}}}var Te=class{constructor(n=!1,o=!0){this.isVerticalRay=n,this.normalRequired=o}},ce=Se();function Ot(s,n,o,t,f,e){if(!s.visible)return;let i=ee(je,t,o),r=(l,a,u)=>{e(l,u,a,!1)},c=new Te(!1,n.options.normalRequired);if(s.boundingInfo){D(s.type===Ce.Mesh);let l=n.tolerance;Ue(s.boundingInfo,o,i,l,f,c,r)}else{let l=s.attributes.get(G.POSITION),a=l.indices;$e(o,i,0,a.length/3,a,l.data,l.stride,f,c,r)}}var Qe=H();function Ue(s,n,o,t,f,e,i){if(s==null)return;let r=it(o,Qe);if(ve(ce,s.bbMin),xe(ce,s.bbMax),f?.applyToAabb(ce),st(ce,n,r,t)){let{primitiveIndices:c,position:l}=s,a=c?c.length:l.indices.length/3;if(a>ot){let u=s.getChildren();if(u!==void 0){for(let w of u)Ue(w,n,o,t,f,e,i);return}}Ze(n,o,0,a,l.indices,l.data,l.stride,c,f,e,i)}}var te=H();function Tt(s,n,o,t,f,e,i,r,c){let{data:l,stride:a}=e;$e(s,ee(je,n,s),o,t,f,l,a,i,r,c)}function Rt(s,n,o,t,f,e,i,r,c,l=null,a=0){let u=s[0],w=s[1],L=s[2],F=n[0],v=n[1],B=n[2];for(let z=o;z<t;++z){let A=a+(l?l[z]:z),I=3*A,E=i*f[I],R=e[E],O=e[E+1],h=e[E+2],p=i*f[I+1],g=e[p],m=e[p+1],d=e[p+2],y=i*f[I+2],b=g-R,M=m-O,V=d-h,N=e[y]-R,T=e[y+1]-O,C=e[y+2]-h,P=v*C-T*B,k=B*N-C*F,q=F*T-N*v,S=b*P+M*k+V*q;if(Math.abs(S)<=de)continue;let U=u-R,$=w-O,j=L-h,x=U*P+$*k+j*q;if(S>0){if(x<0||x>S)continue}else if(x>0||x<S)continue;let J=$*V-M*j,K=j*b-V*U,X=U*M-b*$,W=F*J+v*K+B*X;if(S>0){if(W<0||x+W>S)continue}else if(W>0||x+W<S)continue;let Y=(N*J+T*K+C*X)/S;Y>=0&&c(Y,A,r?ue(b,M,V,N,T,C,te):null)}}function Vt(s,n,o,t,f,e,i,r){let c=s[0],l=s[1],a=s[2],u=n[0],w=n[1],L=n[2];for(let F=o;F<t;++F){let v=3*F,B=v+1,z=v+2,A=e*v,I=f[A],E=f[A+1],R=f[A+2],O=e*B,h=e*z,p=f[O]-I,g=f[O+1]-E,m=f[O+2]-R,d=f[h]-I,y=f[h+1]-E,b=f[h+2]-R,M=w*b-y*L,V=L*d-b*u,N=u*y-d*w,T=p*M+g*V+m*N;if(Math.abs(T)<=de)continue;let C=c-I,P=l-E,k=a-R,q=C*M+P*V+k*N;if(T>0){if(q<0||q>T)continue}else if(q>0||q<T)continue;let S=P*m-g*k,U=k*p-m*C,$=C*g-p*P,j=u*S+w*U+L*$;if(T>0){if(j<0||q+j>T)continue}else if(j>0||q+j<T)continue;let x=(d*S+y*U+b*$)/T;x>=0&&r(x,F,i?ue(p,g,m,d,y,b,te):null)}}function Nt(s,n,o,t,f,e,i,r,c,l,a,u=null,w=0){let L=s[0],F=s[1],v=s[2],B=n[0],z=n[1],A=n[2];for(let I=o;I<t;++I){let E=w+(u?u[I]:I),R=3*E,O=i*f[R],h=e[O],p=e[O+1],g=e[O+2],m=i*f[R+1],d=e[m],y=e[m+1],b=e[m+2],M=i*f[R+2],V=e[M],N=e[M+1],T=e[M+2],C=g-c,P=r/Math.sqrt(h*h+p*p+C*C),k=h+h*P,q=p+p*P,S=g+C*P,U=b-c,$=r/Math.sqrt(d*d+y*y+U*U),j=d+d*$,x=y+y*$,J=b+U*$,K=T-c,X=r/Math.sqrt(V*V+N*N+K*K),W=j-k,Y=x-q,ne=J-S,ie=V+V*X-k,Q=N+N*X-q,se=T+K*X-S,Re=z*se-Q*A,Ve=A*ie-se*B,Ne=B*Q-ie*z,Z=W*Re+Y*Ve+ne*Ne;if(Math.abs(Z)<=de)continue;let pe=L-k,he=F-q,be=v-S,re=pe*Re+he*Ve+be*Ne;if(Z>0){if(re<0||re>Z)continue}else if(re>0||re<Z)continue;let Ae=he*ne-Y*be,Ie=be*W-ne*pe,Fe=pe*Y-W*he,oe=B*Ae+z*Ie+A*Fe;if(Z>0){if(oe<0||re+oe>Z)continue}else if(oe>0||re+oe<Z)continue;let Ee=(ie*Ae+Q*Ie+se*Fe)/Z;Ee>=0&&a(Ee,E,l?ue(W,Y,ne,ie,Q,se,te):null)}}function Ze(s,n,o,t,f,e,i,r,c,l,a){let u=s[0],w=s[1],L=s[2],F=n[0],v=n[1],B=n[2],{normalRequired:z}=l;for(let A=o;A<t;++A){let I=r[A],E=3*I,R=i*f[E],O=e[R],h=e[R+1],p=e[R+2],g=i*f[E+1],m=e[g],d=e[g+1],y=e[g+2],b=i*f[E+2],M=e[b],V=e[b+1],N=e[b+2];c!=null&&([O,h,p]=c.applyToVertex(O,h,p,A),[m,d,y]=c.applyToVertex(m,d,y,A),[M,V,N]=c.applyToVertex(M,V,N,A));let T=m-O,C=d-h,P=y-p,k=M-O,q=V-h,S=N-p,U=v*S-q*B,$=B*k-S*F,j=F*q-k*v,x=T*U+C*$+P*j;if(Math.abs(x)<=de)continue;let J=u-O,K=w-h,X=L-p,W=J*U+K*$+X*j;if(x>0){if(W<0||W>x)continue}else if(W>0||W<x)continue;let Y=K*P-C*X,ne=X*T-P*J,ie=J*C-T*K,Q=F*Y+v*ne+B*ie;if(x>0){if(Q<0||W+Q>x)continue}else if(Q>0||W+Q<x)continue;let se=(k*Y+q*ne+S*ie)/x;se>=0&&a(se,I,z?ue(T,C,P,k,q,S,te):null)}}function $e(s,n,o,t,f,e,i,r,c,l){let a=n,u=ft,w=Math.abs(a[0]),L=Math.abs(a[1]),F=Math.abs(a[2]),v=w>=L?w>=F?0:2:L>=F?1:2,B=v,z=a[B]<0?2:1,A=(v+z)%3,I=(v+(3-z))%3,E=a[A]/a[B],R=a[I]/a[B],O=1/a[B],h=_e,p=et,g=tt,{normalRequired:m}=c;for(let d=o;d<t;++d){let y=3*d,b=i*f[y];_(u[0],e[b+0],e[b+1],e[b+2]);let M=i*f[y+1];_(u[1],e[M+0],e[M+1],e[M+2]);let V=i*f[y+2];_(u[2],e[V+0],e[V+1],e[V+2]),r&&(fe(u[0],r.applyToVertex(u[0][0],u[0][1],u[0][2],d)),fe(u[1],r.applyToVertex(u[1][0],u[1][1],u[1][2],d)),fe(u[2],r.applyToVertex(u[2][0],u[2][1],u[2][2],d))),ee(h,u[0],s),ee(p,u[1],s),ee(g,u[2],s);let N=h[A]-E*h[B],T=h[I]-R*h[B],C=p[A]-E*p[B],P=p[I]-R*p[B],k=g[A]-E*g[B],q=g[I]-R*g[B],S=k*P-q*C,U=N*q-T*k,$=C*T-P*N;if((S<0||U<0||$<0)&&(S>0||U>0||$>0))continue;let j=S+U+$;if(j===0)continue;let x=S*(O*h[B])+U*(O*p[B])+$*(O*g[B]);if(x*Math.sign(j)<0)continue;let J=x/j;J>=0&&l(J,d,m?nt(u):null)}}var _e=H(),et=H(),tt=H();function ue(s,n,o,t,f,e,i){return _(ae,s,n,o),_(le,t,f,e),Be(i,ae,le),ge(i,i),i}function nt(s){return ee(ae,s[1],s[0]),ee(le,s[2],s[0]),Be(te,ae,le),ge(te,te),te}var ae=H(),le=H();function At(s,n,o){return _(o,1/(n[0]-s[0]),1/(n[1]-s[1]),1/(n[2]-s[2]))}function it(s,n){return _(n,1/s[0],1/s[1],1/s[2])}function st(s,n,o,t){return rt(s,n,o,t,1/0)}function rt(s,n,o,t,f){let e=(s[0]-t-n[0])*o[0],i=(s[3]+t-n[0])*o[0],r=Math.min(e,i),c=Math.max(e,i),l=(s[1]-t-n[1])*o[1],a=(s[4]+t-n[1])*o[1];if(c=Math.min(c,Math.max(l,a)),c<0||(r=Math.max(r,Math.min(l,a)),r>c))return!1;let u=(s[2]-t-n[2])*o[2],w=(s[5]+t-n[2])*o[2];return c=Math.min(c,Math.max(u,w)),!(c<0)&&(r=Math.max(r,Math.min(u,w)),!(r>c)&&r<f)}var ot=1e3,de=1e-7,je=H(),ft=[H(),H(),H()];export{Te as a,Ot as b,Tt as c,Rt as d,Vt as e,Nt as f,At as g,st as h,rt as i,dt as j,ke as k,pt as l,Ge as m,We as n,Je as o,Xe as p,ht as q,Ye as r};
