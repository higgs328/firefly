import{a as I}from"./chunk-Z5Q443PI.js";import{a as h}from"./chunk-LS3HEJD5.js";import{a as N}from"./chunk-EPKVBNFW.js";import{a as E}from"./chunk-FHBFWDFD.js";import{a as w}from"./chunk-AXYQJCCX.js";import{a as n}from"./chunk-5XCFNEYX.js";import{a as x}from"./chunk-GQL2MBZT.js";import{b as T}from"./chunk-EBIFNV2H.js";import{a as R}from"./chunk-7P44K2YD.js";import{a as m,j as v}from"./chunk-TG45K3WR.js";import{a as s}from"./chunk-QGVBCWUY.js";import{e as S}from"./chunk-MYO4NP2N.js";import{e as r}from"./chunk-NFIPKH6V.js";import{l as A}from"./chunk-5QEXLALV.js";import{j as f}from"./chunk-HEVQSRJ2.js";import{b,e as _,y,z as C}from"./chunk-4PTIEWMT.js";import{g as M}from"./chunk-XRGPJ3QY.js";import{f as p}from"./chunk-VTHXE323.js";var g="esri-search",u={base:g,autocomplete:`${g}__autocomplete`,dropdown:`${g}__dropdown`,container:`${g}__container`,form:`${g}__form`};var o=class extends x{constructor(e,t){super(e,t),this._currentLocationValue=`${this.id}-search-use-current-location`,this._autocompleteNode=null,this._focusAbortController=null,this._searchResultRenderer=new I,this._suggestController=null,this._searchController=null,this._lastSearchTerm="",this._locateFailed=!1,this._showNoResults=!1,this.disabled=!1,this.messages=null,this.messagesCommon=null,this.viewModel=new h,this._renderSearchResultsContent=()=>this._searchResultRenderer,this.addHandles([m(()=>this.viewModel,l=>this._searchResultRenderer.viewModel=l,v),m(()=>this.viewModel.results,()=>this._searchResultRenderer.showMoreResultsOpen=!1),m(()=>this.viewModel?.defaultPopupTemplate,l=>{l&&(l.content=this._renderSearchResultsContent)},v)])}loadDependencies(){return T({autocomplete:()=>import("./chunk-WWG3UQIR.js"),"autocomplete-item-group":()=>import("./chunk-OMYVWA2O.js"),"autocomplete-item":()=>import("./chunk-7MFAWXFD.js"),button:()=>import("./chunk-K3RCADAN.js"),dropdown:()=>import("./chunk-F6T2J7EG.js"),"dropdown-group":()=>import("./chunk-KPY43GC2.js"),"dropdown-item":()=>import("./chunk-XJK7VSUG.js"),notice:()=>import("./chunk-PEKK3NZO.js")})}destroy(){this._cancelQueries(),this._searchResultRenderer=b(this._searchResultRenderer),this._focusAbortController?.abort()}get _isDisabled(){let{state:e}=this.viewModel;return e==="disabled"||e==="loading"||this.disabled}get _showCurrentLocation(){return this.locationEnabled&&!this.searchTerm?.trim()}get _effectiveActiveMenu(){let{activeMenu:e}=this;return this._isDisabled?"none":e==="warning"?"suggestion":e}get activeMenu(){return"none"}set activeMenu(e){e==="warning"&&S(M.getLogger(this),"activeMenu","warning",{replacement:"Use the value 'suggestion' instead",version:"4.32",warnOnce:!0}),this._overrideIfSome("activeMenu",e)}get activeSource(){return this.viewModel?.activeSource}get activeSourceIndex(){return this.viewModel.activeSourceIndex}set activeSourceIndex(e){this.viewModel.activeSourceIndex=e}get allPlaceholder(){return this.viewModel.allPlaceholder}set allPlaceholder(e){this.viewModel.allPlaceholder=e}get allSources(){return this.viewModel.allSources}get autoNavigate(){return this.viewModel.autoNavigate}set autoNavigate(e){this.viewModel.autoNavigate=e}get autoSelect(){return this.viewModel.autoSelect}set autoSelect(e){this.viewModel.autoSelect=e}get defaultSources(){return this.viewModel.defaultSources}get goToOverride(){return this.viewModel.goToOverride}set goToOverride(e){this.viewModel.goToOverride=e}get icon(){return"search"}set icon(e){this._overrideIfSome("icon",e)}get includeDefaultSources(){return this.viewModel.includeDefaultSources}set includeDefaultSources(e){this.viewModel.includeDefaultSources=e}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get locationEnabled(){return this.viewModel.locationEnabled}set locationEnabled(e){this.viewModel.locationEnabled=e}get maxResults(){return this.viewModel.maxResults}set maxResults(e){this.viewModel.maxResults=e}get maxSuggestions(){return this.viewModel.maxSuggestions}set maxSuggestions(e){this.viewModel.maxSuggestions=e}get minSuggestCharacters(){return this.viewModel.minSuggestCharacters}set minSuggestCharacters(e){this.viewModel.minSuggestCharacters=e}get popupEnabled(){return this.viewModel.popupEnabled}set popupEnabled(e){this.viewModel.popupEnabled=e}get popupTemplate(){return this.viewModel.popupTemplate}set popupTemplate(e){this.viewModel.popupTemplate=e}get portal(){return this.viewModel?.portal}set portal(e){this.viewModel&&(this.viewModel.portal=e)}get resultGraphic(){return this.viewModel.resultGraphic}set resultGraphic(e){this.viewModel.resultGraphic=e}get resultGraphicEnabled(){return this.viewModel.resultGraphicEnabled}set resultGraphicEnabled(e){this.viewModel.resultGraphicEnabled=e}get results(){return this.viewModel.results}get searchAllEnabled(){return this.viewModel.searchAllEnabled}set searchAllEnabled(e){this.viewModel.searchAllEnabled=e}get searchTerm(){return this.viewModel.searchTerm}set searchTerm(e){this.viewModel.searchTerm=e}get selectedResult(){return this.viewModel.selectedResult}get sources(){return this.viewModel.sources}set sources(e){this.viewModel.sources=e}get suggestions(){return this.viewModel.suggestions}get suggestionsEnabled(){return this.viewModel.suggestionsEnabled}set suggestionsEnabled(e){this.viewModel.suggestionsEnabled=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}clear(){this._locateFailed=!1,this.viewModel.clear()}focus(){this._handleFocus(),this._emitFocus()}blur(){this._autocompleteNode?.blur(),this._emitBlur()}search(e){return p(this,null,function*(){this._cancelQueries();let t=new AbortController,{signal:l}=t;this._searchController=t;try{let i=yield this.viewModel.search(e,{signal:l});return this._searchController!==t?void 0:(i?.numResults||(this._showNoResults=!0,this.activeMenu="suggestion"),this._searchController=null,i)}catch{return this._searchController!==t?void 0:void(this._searchController=null)}})}suggest(e){return p(this,null,function*(){this._cancelSuggest();let t=new AbortController,{signal:l}=t;this._suggestController=t;try{let i=yield this.viewModel.suggest(e,null,{signal:l});return this._suggestController!==t?void 0:(this._suggestController=null,i?.numResults&&(this.activeMenu="suggestion",this._scrollToTopSuggestion()),i)}catch{return this._suggestController!==t||(this._suggestController=null),null}})}render(){return n("div",{class:this.classes(u.base,E.widget)},n("div",{class:u.container},this._renderSourcesMenu(),this._renderForm()))}_handleInputKeydown(e){e.key==="Tab"&&this._cancelSuggest()}_emitFocus(){this.emit("search-focus")}_emitBlur(){this.emit("search-blur")}_handleFocus(){return p(this,null,function*(){this._focusAbortController?.abort(),this._focusAbortController=new AbortController;let e=this._focusAbortController.signal;yield C(f(e)),this._autocompleteNode?.setFocus()})}_renderSourcesMenu(){let{messages:e,_isDisabled:t,_effectiveActiveMenu:l}=this,{allSources:i,searchAllEnabled:a}=this.viewModel;return i.length>1?n("calcite-dropdown",{bind:this,class:u.dropdown,disabled:t,open:l==="source",overlayPositioning:"fixed",onCalciteDropdownClose:this._handleSourceClose,onCalciteDropdownOpen:this._handleSourceOpen,onCalciteDropdownSelect:this._handleSourceSelect},n("calcite-button",{appearance:"outline-fill",iconStart:"caret-down",kind:"neutral",label:e.searchIn,slot:"trigger"}),n("calcite-dropdown-group",{groupTitle:e.searchIn},a?this._renderSource(h.ALL_INDEX):null,i.map((d,c)=>this._renderSource(c)).toArray())):null}_renderUseCurrentLocation(){let{_currentLocationValue:e}=this;return n("calcite-autocomplete-item",{heading:this.messages.useCurrentLocation,iconStart:"gps-on",key:e,value:e})}_handleAutocompleteCreate(e){this._autocompleteNode=e}_handleCalciteAutocompleteTextInput(e){let t=e.target.inputValue;t!==this.viewModel.searchTerm&&(this.viewModel.searchTerm=t,t||this.clear(),this.suggest())}_handleAutocompleteOpen(){this.activeMenu="suggestion"}_handleAutocompleteClose(){this.activeMenu==="suggestion"&&(this.activeMenu="none")}_handleCalciteAutocompleteChange(e){let t=e.target.value;if(t===this._currentLocationValue)return void this._useCurrentLocation();let l=this.viewModel.suggestions?.flatMap(a=>a.results??[]),i=l?.find(a=>`${a.key}`==`${t}`);i&&this.search(i)}_renderAutocomplete(){let{_effectiveActiveMenu:e,messages:t,_isDisabled:l}=this,{maxInputLength:i,placeholder:a,searchTerm:d,state:c}=this.viewModel,L=this.label??t.searchButtonTitle??"";return n("calcite-autocomplete",{afterCreate:this._handleAutocompleteCreate,autocomplete:"off",bind:this,class:u.autocomplete,disabled:l,icon:this.icon,inputValue:d,label:L,loading:c==="searching",maxLength:i,name:this.id,onblur:this._emitBlur,onfocus:this._emitFocus,onkeydown:this._handleInputKeydown,open:e==="suggestion",overlayPositioning:"fixed",placeholder:a,title:d?"":a,onCalciteAutocompleteChange:this._handleCalciteAutocompleteChange,onCalciteAutocompleteClose:this._handleAutocompleteClose,onCalciteAutocompleteOpen:this._handleAutocompleteOpen,onCalciteAutocompleteTextChange:this._handleCalciteAutocompleteTextInput,onCalciteAutocompleteTextInput:this._handleCalciteAutocompleteTextInput},this._renderSuggestions(),this._renderNotices())}_renderForm(){return n("form",{bind:this,class:u.form,disabled:this._isDisabled,key:u.form,onsubmit:this._formSubmit,role:"search"},this._renderAutocomplete())}_renderSuggestGroup(e){return e.results?.map(t=>this._renderSuggestion(t))}_renderSuggestions(){let{suggestions:e}=this.viewModel;return this._showNoResults?null:this._showCurrentLocation?this._renderUseCurrentLocation():e?.map(t=>this._renderSuggestResults(t))}_renderSuggestResults(e){let{allSources:t,activeSourceIndex:l}=this.viewModel,{sourceIndex:i}=e,a=e.results?.length,d=t.length>1&&l===h.ALL_INDEX,c=this._getSourceName(i);return a&&d?n("calcite-autocomplete-item-group",{heading:c,key:`suggestion-group-${c}-${i}`},this._renderSuggestGroup(e)):this._renderSuggestGroup(e)}_renderSuggestion(e){return n("calcite-autocomplete-item",{heading:e.text??this.messages.untitledResult,key:`suggestion_${e.key}`,value:`${e.key}`})}_renderSource(e){let t=this._getSourceName(e);return n("calcite-dropdown-item",{"data-source-index":`${e}`,key:`source-${t}-${e}`,selected:e===this.viewModel.activeSourceIndex},t)}_renderNoResultsWarning(e){let{messages:t}=this,l=e?R(t.noResultsFoundForValue,{value:`"${e}"`}):t.noResultsFound;return n("calcite-notice",{icon:"exclamation-mark-triangle",key:"no-results-warning",kind:"warning",open:!0,slot:"content-bottom"},n("div",{slot:"title"},t.noResults),n("div",{slot:"message"},l))}_renderLocateError(){return n("calcite-notice",{icon:"exclamation-mark-circle",key:"locate-warning",kind:"danger",open:!0,slot:"content-bottom"},n("div",{slot:"message"},this.messages.locateError))}_renderNotices(){return this._locateFailed?this._renderLocateError():this._showNoResults?this._renderNoResultsWarning(this._lastSearchTerm??this.viewModel.searchTerm):null}_useCurrentLocation(){return p(this,null,function*(){this._cancelQueries();let e=new AbortController,{signal:t}=e;this._searchController=e;try{yield this.viewModel.searchNearby({signal:t})}catch(l){y(l)||(this._locateFailed=!0)}finally{this._searchController=null}})}_handleSourceOpen(){this.activeMenu="source"}_handleSourceClose(){this.activeMenu==="source"&&(this.activeMenu="none")}_handleSourceSelect(e){let t=e.target.selectedItems[0].getAttribute("data-source-index");t&&(this.viewModel.activeSourceIndex=parseInt(t,10))}_cancelSuggest(){this.activeMenu="none",this._locateFailed=!1,this._showNoResults=!1,this._suggestController=_(this._suggestController)}_cancelQueries(){this._cancelSuggest(),this._searchController=_(this._searchController)}_scrollToTopSuggestion(){this._autocompleteNode?.scrollContentTo({top:0})}_formSubmit(e){e.preventDefault(),this.activeMenu="none",this._lastSearchTerm=this.searchTerm,this.searchTerm&&this.search()}_getSourceName(e){let{messages:t}=this,{allSources:l}=this.viewModel,i=l.at(e);return e===h.ALL_INDEX?t.all:i?.name||t.untitledSource}};s([r()],o.prototype,"_locateFailed",void 0),s([r()],o.prototype,"_showNoResults",void 0),s([r()],o.prototype,"_isDisabled",null),s([r()],o.prototype,"_showCurrentLocation",null),s([r()],o.prototype,"_effectiveActiveMenu",null),s([r()],o.prototype,"activeMenu",null),s([r({readOnly:!0})],o.prototype,"activeSource",null),s([r()],o.prototype,"activeSourceIndex",null),s([r()],o.prototype,"allPlaceholder",null),s([r({readOnly:!0})],o.prototype,"allSources",null),s([r()],o.prototype,"autoNavigate",null),s([r()],o.prototype,"autoSelect",null),s([r({readOnly:!0})],o.prototype,"defaultSources",null),s([r()],o.prototype,"disabled",void 0),s([r()],o.prototype,"goToOverride",null),s([r()],o.prototype,"icon",null),s([r()],o.prototype,"includeDefaultSources",null),s([r()],o.prototype,"label",null),s([r()],o.prototype,"locationEnabled",null),s([r()],o.prototype,"maxResults",null),s([r()],o.prototype,"maxSuggestions",null),s([r(),w("esri/widgets/Search/t9n/Search")],o.prototype,"messages",void 0),s([r(),w("esri/t9n/common")],o.prototype,"messagesCommon",void 0),s([r()],o.prototype,"minSuggestCharacters",null),s([r()],o.prototype,"popupEnabled",null),s([r()],o.prototype,"popupTemplate",null),s([r()],o.prototype,"portal",null),s([r()],o.prototype,"resultGraphic",null),s([r()],o.prototype,"resultGraphicEnabled",null),s([r({readOnly:!0})],o.prototype,"results",null),s([r()],o.prototype,"searchAllEnabled",null),s([r()],o.prototype,"searchTerm",null),s([r({readOnly:!0})],o.prototype,"selectedResult",null),s([r()],o.prototype,"sources",null),s([r({readOnly:!0})],o.prototype,"suggestions",null),s([r()],o.prototype,"suggestionsEnabled",null),s([r()],o.prototype,"view",null),s([N(["search-complete","search-clear","search-start","select-result","suggest-start","suggest-complete"]),r({type:h})],o.prototype,"viewModel",void 0),o=s([A("esri.widgets.Search")],o);var se=o;export{se as a};
