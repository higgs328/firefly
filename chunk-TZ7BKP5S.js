import{a as Y}from"./chunk-PPBOBNTL.js";import{a as $}from"./chunk-LJHBR43S.js";import{a as _}from"./chunk-735YNPMJ.js";import"./chunk-3MM5N7T7.js";import{a as rr}from"./chunk-WVQFNB4M.js";import{a as tr}from"./chunk-ZO3XYJ6T.js";import{a as X}from"./chunk-JAM5M2OZ.js";import{a as Z}from"./chunk-IUHAUWZW.js";import"./chunk-BKVXSCSA.js";import"./chunk-L245KTSY.js";import{a as z}from"./chunk-GHO4IAJA.js";import{a as L}from"./chunk-VY3DECDW.js";import{a as G}from"./chunk-N7H6JYYU.js";import"./chunk-ZCXB2W4M.js";import{B as W,C as Q,D as U,F as I,N as D,na as V,q as M,s as T,w as C,z as K}from"./chunk-GF36OIHY.js";import"./chunk-EJ2UYJJS.js";import"./chunk-OCNYIIP3.js";import"./chunk-SC4TZEOX.js";import"./chunk-57TARQ4F.js";import"./chunk-6RBQSBA2.js";import{b as B,f as H,g as O}from"./chunk-DA3SDKGO.js";import"./chunk-ZOEPYNM4.js";import"./chunk-57VFBGF3.js";import"./chunk-GWBRHLNH.js";import"./chunk-BJH4F4SM.js";import"./chunk-Z3RBZHAK.js";import"./chunk-ZC6EBRE4.js";import{a as c,b as f}from"./chunk-OUBCFKOM.js";import"./chunk-E7AX56GD.js";import"./chunk-IDVLLREH.js";import"./chunk-DWLSVYOY.js";import"./chunk-PQGCNP5H.js";import"./chunk-UASS7NJI.js";import"./chunk-WZRAC35O.js";import"./chunk-KUYAWYSS.js";import"./chunk-MIS6QMFE.js";import"./chunk-MDZTV2VL.js";import"./chunk-RNC4P66O.js";import"./chunk-7LHOQXZT.js";import"./chunk-BCREO4Q5.js";import"./chunk-U4QEPZJ3.js";import"./chunk-KJUZWSCL.js";import"./chunk-3WO6D7MU.js";import"./chunk-BUZ3SPLE.js";import"./chunk-BOVYXYHK.js";import"./chunk-KVM6SHDX.js";import"./chunk-P33JWG3G.js";import{a as b,d as m,f as S,i as J}from"./chunk-HX2VGIR2.js";import"./chunk-ERDKAICI.js";import"./chunk-EQZWYK27.js";import{a as F}from"./chunk-2GJBUR2F.js";import{a as P}from"./chunk-DKGGDYJI.js";import"./chunk-5LA3PVK5.js";import"./chunk-IR6XCBC4.js";import"./chunk-C6JPAW54.js";import"./chunk-WD3OPXCN.js";import"./chunk-FA3WGIU4.js";import"./chunk-WWVPA6PE.js";import"./chunk-YPMM52MU.js";import"./chunk-BBR7CJCO.js";import"./chunk-ZQIC5NFT.js";import"./chunk-VIEK2X23.js";import{a as v}from"./chunk-XKIFGPJO.js";import"./chunk-PEW2PLAN.js";import{i as N,j as E}from"./chunk-Q6Y4JG7Q.js";import{a as x}from"./chunk-7F5DJLJT.js";import"./chunk-CX5IFQZJ.js";import"./chunk-NJWTSROP.js";import"./chunk-D3R25AF2.js";import"./chunk-ARRCN5K3.js";import"./chunk-4N4D2YQX.js";import"./chunk-G4DZJMGT.js";import"./chunk-VDO6JJ3Y.js";import"./chunk-WFKZLI6F.js";import"./chunk-X2B63YVS.js";import"./chunk-BAEF3CT6.js";import"./chunk-AUAZP44J.js";import"./chunk-PVDFCTA4.js";import"./chunk-KNVXE32P.js";import"./chunk-76ATOSLU.js";import"./chunk-CCJU4DSH.js";import"./chunk-TYYVNQUR.js";import"./chunk-QGVBCWUY.js";import"./chunk-MYO4NP2N.js";import"./chunk-NFIPKH6V.js";import"./chunk-JPU2PQZC.js";import"./chunk-5QEXLALV.js";import"./chunk-P6QFA5MM.js";import"./chunk-DGTD7Y73.js";import"./chunk-LI2SX4T6.js";import"./chunk-BWO7LS2H.js";import"./chunk-HEVQSRJ2.js";import"./chunk-OVHPPCBL.js";import"./chunk-SNFOAZZQ.js";import"./chunk-AML4XSEF.js";import"./chunk-4PTIEWMT.js";import"./chunk-TG2UTNEO.js";import"./chunk-YOFFGXOB.js";import"./chunk-XRGPJ3QY.js";import{e as A}from"./chunk-6MRUJ2UW.js";import"./chunk-2LI2GKBQ.js";import"./chunk-QBWJMFH5.js";import{f as y}from"./chunk-VTHXE323.js";var u=null;function ar(r){return y(this,null,function*(){let t=A.geometryServiceUrl??"";if(!t){B()||(yield H());for(let n of r)n.container[n.indexer]=O(n.container[n.indexer],x.WGS84);return}let e=r.map(n=>n.container[n.indexer]),a=new X({geometries:e,outSpatialReference:x.WGS84}),i=yield Y(t,a);for(let n=0;n<i.length;n++){let o=r[n];o.container[o.indexer]=i[n]}})}function nr(r,t){return y(this,null,function*(){let e=new F({portal:r,id:t});return yield e.load(),u===null&&(u=yield import("./chunk-F3DPEQUV.js")),yield u.fetchKnowledgeGraph(e.url)})}function k(r,t,e,a,i){if(r===null)return null;if(m(r)||b(r))return r;if(W(r)||W(r))return r.toJSDate();if(Q(r))return r.toStorageFormat();if(U(r))return r.toStorageString();if(C(r)){let n={};for(let o of r.keys())n[o]=k(r.field(o),t,e,a,i),n[o]instanceof v&&i.push({container:n,indexer:o});return n}if(S(r)){let n=r.map(o=>k(o,t,e,a,i));for(let o=0;o<n.length;o++)n[o]instanceof v&&i.push({container:n,indexer:o});return n}return T(r)?r.spatialReference.isWGS84?r:r.spatialReference.isWebMercator&&t?E(r):r:void 0}function ir(r,t){if(!r)return r;if(r.spatialReference.isWGS84&&t.spatialReference.isWebMercator)return N(r);if(r.spatialReference.equals(t.spatialReference))return r;throw new f(t,c.WrongSpatialReference,null)}function j(r,t){if(!r)return null;let e={};for(let a in r)e[a]=d(r[a],t);return e}function d(r,t){return r===null?null:S(r)?r.map(e=>d(e,t)):r instanceof Z?{graphTypeName:r.typeName,id:r.id,graphType:"entity",properties:j(r.properties,t)}:r instanceof $?{graphType:"object",properties:j(r.properties,t)}:r instanceof tr?{graphTypeName:r.typeName,id:r.id,graphType:"relationship",originId:r.originId??null,destinationId:r.destinationId??null,properties:j(r.properties,t)}:r instanceof rr?{graphType:"path",path:r.path?r.path.map(e=>d(e,t)):null}:T(r)?ir(r,t):m(r)||b(r)||J(r)?r:null}function Dr(r){r.mode==="async"&&(r.functions.knowledgegraphbyportalitem=function(t,e){return r.standardFunctionAsync(t,e,(a,i,n)=>{if(I(n,2,2,t,e),n[0]===null)throw new f(t,c.PortalRequired,e);if(n[0]instanceof L){let h=D(n[1]),l;return l=t.services?.portal?t.services.portal:P.getDefault(),nr(z(n[0],l),h)}if(m(n[0])===!1)throw new f(t,c.InvalidParameter,e);let o=D(n[0]);return nr(t.services?.portal??P.getDefault(),o)})},r.signatures.push({name:"knowledgegraphbyportalitem",min:2,max:2}),r.functions.querygraph=function(t,e){return r.standardFunctionAsync(t,e,(a,i,n)=>y(this,null,function*(){I(n,2,4,t,e);let o=n[0];if(!K(o))throw new f(t,c.InvalidParameter,e);let h=n[1];if(!m(h))throw new f(t,c.InvalidParameter,e);u===null&&(u=yield import("./chunk-F3DPEQUV.js"));let l=null,g=M(n[2],null);if(!(g instanceof G||g===null))throw new f(t,c.InvalidParameter,e);if(g){let s=[];l=k(g,!0,!1,t,s),s=s.filter(p=>!p.container[p.indexer].spatialReference.isWGS84),s.length>0&&(yield ar(s))}let q=new _({openCypherQuery:h,bindParameters:l});(o?.serviceDefinition?.currentVersion??11.3)>11.2&&(q.outputSpatialReference=t.spatialReference);let er=(yield u.executeQueryStreaming(o,q)).resultRowsStream.getReader(),R=[];try{for(;;){let{done:s,value:p}=yield er.read();if(s)break;if(S(p))for(let w of p)R.push(d(w,t));else{let w=[];for(let or of p)w.push(d(p[or],t));R.push(w)}}}catch(s){throw s}return G.convertJsonToArcade(R,V(t),!1,!0)}))},r.signatures.push({name:"querygraph",min:2,max:4}))}export{Dr as registerFunctions};
