import{d as ge,f as ve}from"./chunk-5AFOYCWC.js";import{f as he}from"./chunk-YB6RTOHR.js";import{a as pe}from"./chunk-GPQCYR3E.js";import{a as ae}from"./chunk-LBB4AU7W.js";import{a as A}from"./chunk-JBFXTI45.js";import{a as se}from"./chunk-7P56QMT7.js";import{a as de}from"./chunk-P4JHTV62.js";import{a as B}from"./chunk-H25DKJGS.js";import{o as re,u as ie}from"./chunk-5A7AFZJT.js";import{b as ye,c as me,e as fe,l as ce,m as be}from"./chunk-PBAMEKFE.js";import{a as ue}from"./chunk-XIZ7IH6M.js";import{b as ne}from"./chunk-KQZGMGWR.js";import{a as oe}from"./chunk-GAVFKWSK.js";import{t as le}from"./chunk-ZM24RY22.js";import{a as te}from"./chunk-PE276TWH.js";import{a as v}from"./chunk-J2AEVBSH.js";import{a as ee}from"./chunk-P2AJD2R2.js";import{a as Z,b as z,c as K}from"./chunk-JXPUHKCT.js";import{a as Y}from"./chunk-7PAP5DT2.js";import{a as X}from"./chunk-DO7UF2F2.js";import{b as J}from"./chunk-2HYVVLKS.js";import{a as W}from"./chunk-3JGYBNJA.js";import{q as P}from"./chunk-KALOJIUA.js";import{a as O}from"./chunk-FXCL7YYQ.js";import{a as H}from"./chunk-K75TK42V.js";import{b as R}from"./chunk-JLPLCY2B.js";import{a as k}from"./chunk-IR6XCBC4.js";import{a as T}from"./chunk-PEW2PLAN.js";import{a as Q}from"./chunk-7F5DJLJT.js";import{a as U}from"./chunk-CX5IFQZJ.js";import{a as n}from"./chunk-QGVBCWUY.js";import{e as o}from"./chunk-NFIPKH6V.js";import{g as N,l as $}from"./chunk-5QEXLALV.js";import{b as L}from"./chunk-4PTIEWMT.js";import{b as I}from"./chunk-YOFFGXOB.js";import{g as E}from"./chunk-XRGPJ3QY.js";import{c as G}from"./chunk-6MRUJ2UW.js";import{b as g}from"./chunk-2LI2GKBQ.js";import{a as _,b as V,f as y}from"./chunk-VTHXE323.js";var D={key:"type",base:ee,errorContext:"renderer",typeMap:{simple:v,"unique-value":te,"class-breaks":oe}},C=N({types:D});function Ge(e,t){let r=e.drawingInfo?.renderer,l=r?C(r,e,t):null;if(l?.type==="simple")return ge(l.symbol,null)?l.symbol.clone():null}var Oe=["#ed5151","#149ece","#a7c636","#9e559c","#fc921f","#ffde3e","#f789d8","#b7814a","#3caf99","#6b6bd6","#b54779","#7f7f7f"];function Le(e,t){return le(Oe,e,{offset:!0,shuffle:!0}).reverse().map(r=>{let l=t.clone();return l.type==="cim"?he(l,r):ve(l,r),new v({symbol:l})})}var we=ae(),je=0;function j(e,t){let r=e.json.write;return typeof r!="object"&&(r=e.json.write={}),r.ignoreOrigin=!0,t?.spatialOnly&&(r.layerContainerTypes=O),e}function m(e){let t={write:{ignoreOrigin:!0}};return e?.name&&(t.name=e.name),typeof t.write=="object"&&(e?.spatialOnly&&(t.write.layerContainerTypes=O),e?.target&&(t.write.target=e.target)),t}function Se(e){return new v({symbol:Ce(e)})}function Ce(e){switch(e){case"point":case"multipoint":return Z.clone();case"polyline":return z.clone();case"polygon":case"multipatch":return K.clone();default:return null}}function xe(e,t){return!!t&&e?.type==="unique-value"&&e.field!=null&&e.field.toLowerCase()===t.toLowerCase()&&!e.field2&&!e.field3&&!e.valueExpression}function Fe(e,t){return e==null?null:t.subtypes?.find(r=>r.code===e)}function qe(e,t){let r=null;switch(t.geometryType){case"esriGeometryPoint":case"esriGeometryMultipoint":r="point";break;case"esriGeometryPolyline":r="line";break;case"esriGeometryPolygon":case"esriGeometryMultiPatch":r="polygon";break;default:t.type,r=null}let l={},s=Fe(e,t);if(s!=null){let{defaultValues:a}=s;for(let p in a)l[p]=a[p]}return l[t.subtypeField]=e,new A({name:"New Feature",drawingTool:r,prototype:{attributes:l}})}var i=class extends B(W.ClonableMixin(H.IdentifiableMixin(k))){constructor(e){super(e),this.attributeTableTemplate=null,this.charts=null,this.editingEnabled=!0,this.fieldOverrides=null,this.fieldsIndex=null,this.formTemplate=null,this.id=`${Date.now().toString(16)}-subtype-sublayer-${je++}`,this.type="subtype-sublayer",this.labelsVisible=!0,this.labelingInfo=null,this.layerType="ArcGISFeatureLayer",this.legendEnabled=!0,this.listMode="show",this.minScale=0,this.maxScale=0,this.opacity=1,this.parent=null,this.popupEnabled=!0,this.popupTemplate=null,this.subtypeCode=null,this.templates=null,this.title=null,this.visible=!0}load(e){return P(this.renderer,this.fieldsIndex),Promise.resolve(this)}get _titleCreator(){let e=this._get("_titleCreator");return L(e),new pe({fieldsIndex:this.fieldsIndex,objectIdField:this.objectIdField,displayField:this.parent?.displayField??"",fields:this.fields,effectivePopupTemplate:this.popupTemplate??this.defaultPopupTemplate})}get capabilities(){return this.parent?.capabilities}get effectiveCapabilities(){return this.parent?.effectiveCapabilities}get effectiveEditingEnabled(){let{parent:e}=this;return e?e.effectiveEditingEnabled&&this.editingEnabled:this.editingEnabled}get elevationInfo(){return this.parent?.elevationInfo}get featureTitleFields(){return[...this._titleCreator.requiredFields]}writeFieldOverrides(e,t,r){let{fields:l,parent:s}=this,a;if(l){a=[];let p=0;l.forEach(({name:f,alias:c,editable:w,visible:F})=>{if(!F)return;let u=s?.fields?.find(x=>x.name===f);if(!u)return;let b={name:f},h=!1;c!==u.alias&&(b.alias=c,h=!0),w!==u.editable&&(b.editable=w,h=!0),a.push(b),h&&p++}),p===0&&a.length===l.length&&(a=null)}else a=g(e);a?.length&&G(r,a,t)}get fields(){let{parent:e,fieldOverrides:t,subtypeCode:r}=this,l=e?.fields;if(!e||!l?.length)return null;let{subtypes:s,subtypeField:a}=e,p=s?.find(F=>F.code===r),f=p?.defaultValues,c=p?.domains,w=[];for(let F of l){let u=F.clone(),{name:b}=u,h=t?.find(S=>S.name===b);if(u.visible=!t?.length||!!h,h){let{alias:S,editable:Te}=h;S&&(u.alias=S),Te===!1&&(u.editable=!1)}let x=f?.[b]??null;u.defaultValue=b===a?r:x;let q=c?.[b]??null;u.domain=b===a?null:q?q.type==="inherited"?u.domain:q.clone():null,w.push(u)}return w}get floorInfo(){return this.parent?.floorInfo}get isTable(){return!!this.parent?.isTable}get geometryType(){return this.parent?.geometryType}get globalIdField(){return this.parent?this.parent.globalIdField:(E.getLogger(this).error(d("globalIdField")),null)}get effectiveScaleRange(){let{minScale:e,maxScale:t}=this;return{minScale:e,maxScale:t}}get objectIdField(){return this.parent||E.getLogger(this).error(d("objectIdField")),this.parent?.objectIdField}get defaultPopupTemplate(){return this.createPopupTemplate()}get relationships(){return this.parent?.relationships}set renderer(e){P(e,this.fieldsIndex),this._override("renderer",e)}get renderer(){if(this._isOverridden("renderer"))return this._get("renderer");let{parent:e}=this;return e&&!e.isTable&&e.geometryType!=="mesh"?Se(e.geometryType):null}readRendererFromService(e,t,r){if(t.type==="Table")return null;let l=t.drawingInfo?.renderer,s=C(l,t,r),a,{subtypeCode:p}=this;if(p!=null&&xe(s,t.subtypeField)){let f=s.uniqueValueInfos?.find(({value:c})=>(c=typeof c=="number"?String(c):c)===String(p));f&&(a=new v({symbol:f.symbol}))}else s?.type!=="simple"||s.visualVariables?.length||(a=s);return a}readRenderer(e,t,r){let l=t?.layerDefinition?.drawingInfo?.renderer;return l?l.visualVariables?.some(a=>a.type!=="rotationInfo")?void 0:C(l,t,r)||void 0:void 0}get spatialReference(){return this.parent?.spatialReference??Q.WGS84}get subtypeField(){return this.parent?.subtypeField}readTemplatesFromService(e,t){return[qe(this.subtypeCode,t)]}readTitleFromService(e,t){let r=Fe(this.subtypeCode,t);return r!=null?r.name:null}get url(){return this.parent?.url}get userHasUpdateItemPrivileges(){return!!this.parent?.userHasUpdateItemPrivileges}addAttachment(e,t){return y(this,null,function*(){let{parent:r}=this;if(!r)throw d("addAttachment");if(e.getAttribute(r.subtypeField)!==this.subtypeCode)throw new I("subtype-sublayer:addAttachment","The feature provided does not belong to this SubtypeSublayer");return r.addAttachment(e,t)})}updateAttachment(e,t,r){return y(this,null,function*(){let{parent:l}=this;if(!l)throw d("updateAttachment");if(e.getAttribute(l.subtypeField)!==this.subtypeCode)throw new I("subtype-sublayer:updateAttachment","The feature provided does not belong to this SubtypeSublayer");return l.updateAttachment(e,t,r)})}deleteAttachments(e,t){return y(this,null,function*(){let{parent:r}=this;if(!r)throw d("deleteAttachments");if(e.getAttribute(r.subtypeField)!==this.subtypeCode)throw new I("subtype-sublayer:deleteAttachments","The feature provided does not belong to this SubtypeSublayer");return r.deleteAttachments(e,t)})}applyEdits(e,t){return y(this,null,function*(){if(!this.parent)throw d("applyEdits");return this.parent.applyEdits(e,t)})}createPopupTemplate(e){let t=this,{parent:r,fields:l,title:s}=this;if(r){let{displayField:a,editFieldsInfo:p,objectIdField:f}=r;t={displayField:a,editFieldsInfo:p,fields:l,objectIdField:f,title:s}}return de(t,e)}createQuery(){if(!this.parent)throw d("createQuery");let e=re(this.parent),t=`${this.parent.subtypeField}=${this.subtypeCode}`;return e.where=R(t,this.parent.definitionExpression),e}getFeatureTitle(e,t={timeZone:"system",fetchMissingFields:!1}){return this._titleCreator.getTitle(this,e,t)}getField(e){return this.fieldsIndex.get(e)}getFieldDomain(e,t){if(!t?.excludeImpliedDomains&&this.parent){let r=ie(this.parent,e);if(r)return r}return this._getLayerDomain(e)}queryAttachments(e,t){return y(this,null,function*(){let r=yield this.load();if(!r.parent)throw d("queryAttachments");let l=e.clone();return l.where=Ie(l.where,r.parent.subtypeField,r.subtypeCode),r.parent.queryAttachments(e,t)})}queryFeatureCount(e,t){return y(this,null,function*(){let r=yield this.load();if(!r.parent)throw d("queryFeatureCount");return r.parent.queryFeatureCount(M(r.parent,r,e),t)})}queryFeatures(e,t){return y(this,null,function*(){let r=yield this.load();if(!r.parent)throw d("queryFeatures");return r.parent.queryFeatures(M(r.parent,r,e),t)})}queryObjectIds(e,t){return y(this,null,function*(){let r=yield this.load();if(!r.parent)throw d("queryObjectIds");return r.parent.queryObjectIds(M(r.parent,r,e),t)})}queryRelatedFeatures(e,t){return y(this,null,function*(){let r=yield this.load();if(!r.parent)throw d("queryRelatedFeatures");return r.parent.queryRelatedFeatures(e,t)})}queryRelatedFeaturesCount(e,t){return y(this,null,function*(){let r=yield this.load();if(!r.parent)throw d("queryRelatedFeaturesCount");return r.parent.queryRelatedFeaturesCount(e,t)})}_getLayerDomain(e){let t=this.fieldsIndex.get(e);return t?t.domain:null}};n([o({clonable:!1,readOnly:!0})],i.prototype,"_titleCreator",null),n([o({type:ue,json:m({name:"attributeTableInfo"})})],i.prototype,"attributeTableTemplate",void 0),n([o({readOnly:!0,json:{read:!1}})],i.prototype,"capabilities",null),n([o({readOnly:!0,json:{read:!1}})],i.prototype,"effectiveCapabilities",null),n([o({json:m()})],i.prototype,"charts",void 0),n([o({type:Boolean,nonNullable:!0,json:m({name:"enableEditing"})})],i.prototype,"editingEnabled",void 0),n([o({type:Boolean,readOnly:!0})],i.prototype,"effectiveEditingEnabled",null),n([o({readOnly:!0,json:{read:!1}})],i.prototype,"elevationInfo",null),n([o({clonable:!1,readOnly:!0})],i.prototype,"featureTitleFields",null),n([o({json:{name:"layerDefinition.fieldOverrides",origins:{service:{read:!1}},write:{ignoreOrigin:!0,allowNull:!0}}})],i.prototype,"fieldOverrides",void 0),n([U("fieldOverrides")],i.prototype,"writeFieldOverrides",null),n([o(V(_({},we.fields),{readOnly:!0,json:{read:!1}}))],i.prototype,"fields",null),n([o(we.fieldsIndex)],i.prototype,"fieldsIndex",void 0),n([o({readOnly:!0,json:{read:!1}})],i.prototype,"floorInfo",null),n([o({type:Y,json:m({name:"formInfo"})})],i.prototype,"formTemplate",void 0),n([o({type:String,clonable:!1,json:{origins:{service:{read:!1},"portal-item":{read:!1}},write:{ignoreOrigin:!0}}})],i.prototype,"id",void 0),n([o({readOnly:!0,json:{read:!1}})],i.prototype,"isTable",null),n([o({readOnly:!0,json:{read:!1}})],i.prototype,"geometryType",null),n([o({readOnly:!0,json:{read:!1}})],i.prototype,"globalIdField",null),n([o({readOnly:!0,json:{read:!1}})],i.prototype,"type",void 0),n([o(j(g(me)))],i.prototype,"labelsVisible",void 0),n([o({type:[ne],json:{name:"layerDefinition.drawingInfo.labelingInfo",origins:{service:{read:!1}},read:{reader:se},write:{ignoreOrigin:!0,layerContainerTypes:O}}})],i.prototype,"labelingInfo",void 0),n([o({type:["ArcGISFeatureLayer"],readOnly:!0,json:{read:!1,write:{ignoreOrigin:!0,layerContainerTypes:O}}})],i.prototype,"layerType",void 0),n([o(j(g(fe)))],i.prototype,"legendEnabled",void 0),n([o({type:["show","hide"]})],i.prototype,"listMode",void 0),n([o((()=>{let e=g(ce);return e.json.origins.service.read=!1,j(e,{spatialOnly:!0})})())],i.prototype,"minScale",void 0),n([o((()=>{let e=g(be);return e.json.origins.service.read=!1,j(e,{spatialOnly:!0})})())],i.prototype,"maxScale",void 0),n([o({readOnly:!0})],i.prototype,"effectiveScaleRange",null),n([o({readOnly:!0,json:{read:!1}})],i.prototype,"objectIdField",null),n([o({type:Number,range:{min:0,max:1},nonNullable:!0,json:m({spatialOnly:!0})})],i.prototype,"opacity",void 0),n([o({clonable:!1})],i.prototype,"parent",void 0),n([o(j(g(ye)))],i.prototype,"popupEnabled",void 0),n([o({type:X,json:m({name:"popupInfo"})})],i.prototype,"popupTemplate",void 0),n([o({readOnly:!0})],i.prototype,"defaultPopupTemplate",null),n([o({readOnly:!0,json:{read:!1}})],i.prototype,"relationships",null),n([o({types:D,json:m({target:"layerDefinition.drawingInfo.renderer",spatialOnly:!0})})],i.prototype,"renderer",null),n([T("service","renderer",["drawingInfo.renderer","subtypeField","type"])],i.prototype,"readRendererFromService",null),n([T("renderer",["layerDefinition.drawingInfo.renderer"])],i.prototype,"readRenderer",null),n([o({readOnly:!0,json:{read:!1}})],i.prototype,"spatialReference",null),n([o({type:Number,json:{origins:{service:{read:!1}},write:{ignoreOrigin:!0}}})],i.prototype,"subtypeCode",void 0),n([o({readOnly:!0,json:{read:!1}})],i.prototype,"subtypeField",null),n([o({type:[A],json:m({name:"layerDefinition.templates"})})],i.prototype,"templates",void 0),n([T("service","templates",["geometryType","subtypeField","subtypes","type"])],i.prototype,"readTemplatesFromService",null),n([o({type:String,json:m()})],i.prototype,"title",void 0),n([T("service","title",["subtypes"])],i.prototype,"readTitleFromService",null),n([o({readOnly:!0,json:{read:!1}})],i.prototype,"url",null),n([o({readOnly:!0})],i.prototype,"userHasUpdateItemPrivileges",null),n([o({type:Boolean,nonNullable:!0,json:m({name:"visibility",spatialOnly:!0})})],i.prototype,"visible",void 0),i=n([$("esri.layers.support.SubtypeSublayer")],i);var M=(e,t,r)=>{if(!r)return t.createQuery();let l=J.from(r);return l.where=Ie(l.where,e.subtypeField,t.subtypeCode),l},Ie=(e,t,r)=>{let l=new RegExp(`${t}\\s*=\\s*\\d+`),s=`${t}=${r}`,a=e??"";return l.test(a)?a.replace(l,s):R(s,a)},d=e=>new I(`This sublayer must have a parent SubtypeGroupLayer in order to use ${e}`),Ft=i;export{Ge as a,Le as b,Ft as c};
