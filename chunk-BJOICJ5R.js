import{a as V,b as h}from"./chunk-2AIDZIZ4.js";import{r as k,t as G,u as b}from"./chunk-Z7TBAZRW.js";import{a as n}from"./chunk-5MERUJUF.js";import{a as m}from"./chunk-IELOBIBC.js";import{a as $}from"./chunk-TFO72JMF.js";import{a as f}from"./chunk-WBU5KVPE.js";import{a as B}from"./chunk-TUUOR3MF.js";import{a as L}from"./chunk-F7UGNZLD.js";import{a as x}from"./chunk-TSG4MDJV.js";import{a as M}from"./chunk-HCW4M77K.js";import{a as j}from"./chunk-QKVTMI24.js";import{a as U}from"./chunk-GGYZRKBV.js";import{a as K}from"./chunk-37PSR6DC.js";import{a as T}from"./chunk-H25DKJGS.js";import{a as F}from"./chunk-7FBNOJXT.js";import{e as R,f as C,g as H,j as N}from"./chunk-PBAMEKFE.js";import{a as P}from"./chunk-VCCMJ6BV.js";import{a as q}from"./chunk-QK56OQGR.js";import{a as c}from"./chunk-PEW2PLAN.js";import{a as A}from"./chunk-7F5DJLJT.js";import{A as O}from"./chunk-76ATOSLU.js";import{b as E}from"./chunk-ACP3S2CH.js";import{a as o}from"./chunk-QGVBCWUY.js";import{e as a}from"./chunk-NFIPKH6V.js";import{l as _}from"./chunk-5QEXLALV.js";import{s as I}from"./chunk-4PTIEWMT.js";import{b as d}from"./chunk-YOFFGXOB.js";import{g as p}from"./chunk-XRGPJ3QY.js";import{b as u}from"./chunk-2LI2GKBQ.js";import{a as S,b as w,f as y}from"./chunk-VTHXE323.js";var z=E.ofType($),J=u(n.sublayersProperty),v=J.json?.origins;v&&(v["web-scene"]={type:[m],write:{enabled:!0,overridePolicy:()=>({enabled:!1})}},v["portal-item"]={type:[m],write:{enabled:!0,overridePolicy:()=>({enabled:!1})}});var s=class extends V(M(U(K(P(T(j(x(q)))))))){constructor(e){super(e),this.operationalLayerType="BuildingSceneLayer",this.allSublayers=new B({getCollections:()=>[this.sublayers],getChildrenFunction:t=>t.type==="building-group"?t.sublayers:null}),this.sublayers=null,this._allSublayerOverrides=null,this.filters=new z,this.activeFilterId=null,this.summaryStatistics=null,this.outFields=null,this.legendEnabled=!0,this.type="building-scene"}normalizeCtorArgs(e){return typeof e=="string"?{url:e}:e??{}}destroy(){this.allSublayers.destroy()}readSublayers(e,t,r){let i=n.readSublayers(e,t,r);return n.forEachSublayer(i,l=>l.layer=this),this._allSublayerOverrides&&(D(i,this._allSublayerOverrides),this._allSublayerOverrides=null),i}write(e,t){return e=super.write(e,t),!t||t.origin!=="web-scene"&&t.origin!=="portal-item"||(this.sublayers?X(this.sublayers,e,t):this._allSublayerOverrides&&Y(this._allSublayerOverrides,e,t)),e}read(e,t){if(super.read(e,t),(t?.origin==="web-scene"||t?.origin==="portal-item")&&Array.isArray(e?.sublayers)){let r=Q(e.sublayers,t);this.sublayers?W(this.sublayers,r):(this._allSublayerOverrides??=new Map,this._allSublayerOverrides.set(t.origin,r))}}readSummaryStatistics(e,t){if(typeof t.statisticsHRef=="string"){let r=O(this.parsedUrl?.path,t.statisticsHRef);return new f({url:r})}return null}set elevationInfo(e){e!=null&&e.mode!=="absolute-height"||this._set("elevationInfo",e),this._validateElevationInfo(e)}load(e){let t=e!=null?e.signal:null,r=this.loadFromPortal({supportedTypes:["Scene Service"]},e).catch(I).then(()=>this._fetchService(t)).then(()=>this._fetchAssociatedFeatureService(t));return this.addResolvingPromise(r),Promise.resolve(this)}loadAll(){return L(this,e=>{n.forEachSublayer(this.sublayers,t=>{t.type!=="building-group"&&e(t)}),this.summaryStatistics&&e(this.summaryStatistics)})}saveAs(e,t){return y(this,null,function*(){return this._debouncedSaveOperations(h.SAVE_AS,w(S({},t),{getTypeKeywords:()=>this._getTypeKeywords(),portalItemLayerType:"building-scene"}),e)})}save(){return y(this,null,function*(){let e={getTypeKeywords:()=>this._getTypeKeywords(),portalItemLayerType:"building-scene"};return this._debouncedSaveOperations(h.SAVE,e)})}validateLayer(e){if(!e.layerType||e.layerType!=="Building")throw new d("buildingscenelayer:layer-type-not-supported","BuildingSceneLayer does not support this layer type",{layerType:e.layerType})}_getTypeKeywords(){return["Building"]}_fetchAssociatedFeatureService(e){return y(this,null,function*(){try{let{portalItem:t}=yield F(`${this.url}/layers/${this.layerId}`,{sceneLayerItem:this.portalItem,customParameters:this.customParameters,apiKey:this.apiKey,signal:e});this.associatedFeatureServiceItem=t}catch(t){p.getLogger(this).warn("Associated feature service item could not be loaded",t)}})}_validateElevationInfo(e){let t="Building scene layers";b(p.getLogger(this),k(t,"absolute-height",e)),b(p.getLogger(this),G(t,e))}};function D(e,t){t.forEach(r=>W(e,r))}function W(e,t){let{overrides:r,context:i}=t;n.forEachSublayer(e,l=>l.read(r.get(l.id),i))}function Q(e,t){let r=new Map;for(let i of e)i!=null&&typeof i=="object"&&typeof i.id=="number"?r.set(i.id,i):t.messages?.push(new d("building-scene-layer:invalid-sublayer-override","Invalid value for sublayer override. Not an object or no id specified.",{value:i}));return{overrides:r,context:t}}function X(e,t,r){let i=[];n.forEachSublayer(e,l=>{let g=l.write({},r);Object.keys(g).length>1&&i.push(g)}),i.length>0&&(t.sublayers=i)}function Y(e,t,r){let i=r?.origin&&e.get(r.origin);i&&(t.sublayers=[],i.overrides.forEach(l=>{t.sublayers.push(u(l))}))}o([a({type:["BuildingSceneLayer"]})],s.prototype,"operationalLayerType",void 0),o([a({readOnly:!0})],s.prototype,"allSublayers",void 0),o([a(J)],s.prototype,"sublayers",void 0),o([c("service","sublayers")],s.prototype,"readSublayers",null),o([a({type:z,nonNullable:!0,json:{write:!0}})],s.prototype,"filters",void 0),o([a({type:String,json:{write:!0}})],s.prototype,"activeFilterId",void 0),o([a({readOnly:!0,type:f})],s.prototype,"summaryStatistics",void 0),o([c("summaryStatistics",["statisticsHRef"])],s.prototype,"readSummaryStatistics",null),o([a({type:[String],json:{read:!1}})],s.prototype,"outFields",void 0),o([a(N)],s.prototype,"fullExtent",void 0),o([a(R)],s.prototype,"legendEnabled",void 0),o([a({type:["show","hide","hide-children"]})],s.prototype,"listMode",void 0),o([a(H(A))],s.prototype,"spatialReference",void 0),o([a(C)],s.prototype,"elevationInfo",null),o([a({json:{read:!1},readOnly:!0})],s.prototype,"type",void 0),o([a()],s.prototype,"associatedFeatureServiceItem",void 0),s=o([_("esri.layers.BuildingSceneLayer")],s);var Fe=s;export{Fe as a};
