import{a as L}from"./chunk-QW25UBG2.js";import{a as C}from"./chunk-7XYYDAZO.js";import{a as v}from"./chunk-LAX5536Z.js";import{a as A}from"./chunk-AVMO6LCR.js";import{a as m}from"./chunk-CLQRQC3Y.js";import{a as k}from"./chunk-JQAW4OB5.js";import{b as g}from"./chunk-UST6HCE7.js";import{f as _}from"./chunk-WFKZLI6F.js";import{a as y}from"./chunk-TG45K3WR.js";import{b as f}from"./chunk-ACP3S2CH.js";import{a as o}from"./chunk-QGVBCWUY.js";import{H as b}from"./chunk-MYO4NP2N.js";import{e as n}from"./chunk-NFIPKH6V.js";import{l as S}from"./chunk-5QEXLALV.js";import{b as p}from"./chunk-YOFFGXOB.js";import{g as d}from"./chunk-XRGPJ3QY.js";import{f as u}from"./chunk-VTHXE323.js";var G={noAssociationTypeSpecified:-2147208504},s=class extends b{constructor(i){super(i),this._internalGraphicsLayerConnectivity=this._createInternalGraphicsLayer("Connectivity Associations (Internal)"),this._internalGraphicsLayerStructuralAttachment=this._createInternalGraphicsLayer("Structural Attachment Associations (Internal)"),this._initialValidationsFinished=!1,this._updatingHandles=new k,this.autoRefreshAssociations=!1,this.connectivityAssociationsLineSymbol=new A({style:"short-dash",width:2,color:[190,159,159,1]}),this.executionError="",this.loadErrors=new f,this.maxAllowableAssociations=250,this.showAssociationsEnabled=!1,this.showArrowsConnectivity=!1,this.showArrowsStructuralAttachment=!1,this.structuralAttachmentAssociationsLineSymbol=new A({style:"short-dash",width:2,color:[159,190,159,1]})}initialize(){let i=()=>u(this,null,function*(){this.messages||(this.messages=yield g("esri/widgets/UtilityNetworkAssociations/t9n/UtilityNetworkAssociations"))});i().then(()=>{this.view||(this.view=null),this.utilityNetwork||(this.utilityNetwork=null),this.addHandles([y(()=>[this.view,this.utilityNetwork],()=>u(this,null,function*(){let{loadErrors:t,messages:{info:{noUtilityNetwork:r,noView:a}}}=this;this._initialValidationsFinished=!1,t.removeAll();let c=!1,e=!1;this.removeAssociations(),this.view?.type==="2d"?(L(this.view,this._internalGraphicsLayerConnectivity),L(this.view,this._internalGraphicsLayerStructuralAttachment),c=!0):(this.loadErrors.push(a),d.getLogger(this).error(new p("utilityNetworkAssociations:missing-property",a))),this.utilityNetwork?.type==="utility"?e=!0:(this.loadErrors.push(r),d.getLogger(this).error(new p("utilityNetworkAssociations:missing-property",r))),c&&e&&this.showAssociationsEnabled&&(yield this.showAssociations()),this._internalGraphicsLayerConnectivity.visible=this.includeConnectivityAssociations,this._internalGraphicsLayerStructuralAttachment.visible=this.includeStructuralAttachmentAssociations,this._initialValidationsFinished=!0}),{initial:!0}),y(()=>[this.view?.stationary,this.showAssociationsEnabled,this.maxAllowableAssociations],()=>u(this,null,function*(){this.view?.stationary&&this.showAssociationsEnabled&&(this.includeConnectivityAssociations||this.includeStructuralAttachmentAssociations)&&(yield this.showAssociations())})),y(()=>[this.showArrowsConnectivity],()=>{let t=this.connectivityAssociationsLineSymbol.clone();t.marker=null,this.showArrowsConnectivity&&(t.marker=new m({color:this.connectivityAssociationsLineSymbol.color,placement:"end",style:"arrow"}));for(let r of this._internalGraphicsLayerConnectivity.graphics)r.symbol=t}),y(()=>[this.showArrowsStructuralAttachment],()=>{let t=this.structuralAttachmentAssociationsLineSymbol.clone();t.marker=null,this.showArrowsStructuralAttachment&&(t.marker=new m({color:this.structuralAttachmentAssociationsLineSymbol.color,placement:"end",style:"arrow"}));for(let r of this._internalGraphicsLayerStructuralAttachment.graphics)r.symbol=t}),y(()=>{let{cap:t,color:r,style:a,width:c,marker:e}=this.connectivityAssociationsLineSymbol;return[t,r,a,c,e]},()=>{let t=this.connectivityAssociationsLineSymbol.clone();for(let r of this._internalGraphicsLayerConnectivity.graphics)r.symbol=t;this.showArrowsConnectivity=!1,t.marker=null,this.connectivityAssociationsLineSymbol.marker&&(this.showArrowsConnectivity=!0,t.marker=new m({color:this.connectivityAssociationsLineSymbol.color,placement:"end",style:"arrow"}))}),y(()=>{let{cap:t,color:r,style:a,width:c,marker:e}=this.structuralAttachmentAssociationsLineSymbol;return[t,r,a,c,e]},()=>{let t=this.structuralAttachmentAssociationsLineSymbol.clone();for(let r of this._internalGraphicsLayerStructuralAttachment.graphics)r.symbol=t;this.showArrowsStructuralAttachment=!1,t.marker=null,this.structuralAttachmentAssociationsLineSymbol.marker&&(this.showArrowsStructuralAttachment=!0,t.marker=new m({color:this.structuralAttachmentAssociationsLineSymbol.color,placement:"end",style:"arrow"}))}),_(i)])})}destroy(){this._updatingHandles.destroy(),this.view=null,this._removeInternalGraphicsLayers()}set includeConnectivityAssociations(i){this._set("includeConnectivityAssociations",i),this._internalGraphicsLayerConnectivity.visible=i}set includeStructuralAttachmentAssociations(i){this._set("includeStructuralAttachmentAssociations",i),this._internalGraphicsLayerStructuralAttachment.visible=i}get state(){return this.loadErrors.length?"disabled":this._updatingHandles.updating?"executing":this.executionError!==""?"warning":this._initialValidationsFinished?"ready":"loading"}get utilityNetwork(){return this.utilityNetwork}set utilityNetwork(i){this._get("utilityNetwork")!==i&&this._set("utilityNetwork",i)}get view(){return this.view}set view(i){this._get("view")!==i&&this._set("view",i)}removeAssociations(){this._internalGraphicsLayerConnectivity.removeAll(),this._internalGraphicsLayerStructuralAttachment.removeAll()}showAssociations(){return u(this,null,function*(){let{messages:{info:{maxAllowableAssociationsExceeded:i,noAssociationsFound:t,noAssociationTypeSpecified:r}},utilityNetwork:a}=this;this._set("executionError","");let c={extent:this.view?.extent,gdbVersion:this.utilityNetwork?.gdbVersion,maxGeometryCount:this.maxAllowableAssociations,moment:this.utilityNetwork?.historicMoment,outSpatialReference:this.view?.spatialReference.clone(),returnConnectivityAssociations:this.includeConnectivityAssociations,returnAttachmentAssociations:this.includeStructuralAttachmentAssociations};this._updatingHandles.addPromise(a?.synthesizeAssociationGeometries(c).then(e=>{let l=[],w=[];return e?.maxGeometryCountExceeded?(this.removeAssociations(),void this._set("executionError",i)):e?.associations.length===0?(this.removeAssociations(),void this._set("executionError",t)):void(e&&(l=e?.associations.filter(({associationType:h})=>h==="connectivity").map(h=>(this.connectivityAssociationsLineSymbol.marker=null,this.showArrowsConnectivity&&(this.connectivityAssociationsLineSymbol.marker=new m({color:this.connectivityAssociationsLineSymbol.color,placement:"end",style:"arrow"})),new v({geometry:h.geometry.clone(),symbol:this.connectivityAssociationsLineSymbol}))),w=e.associations.filter(({associationType:h})=>h==="attachment").map(h=>(this.structuralAttachmentAssociationsLineSymbol.marker=null,this.showArrowsStructuralAttachment&&(this.structuralAttachmentAssociationsLineSymbol.marker=new m({color:this.structuralAttachmentAssociationsLineSymbol.color,placement:"end",style:"arrow"})),new v({geometry:h.geometry.clone(),symbol:this.structuralAttachmentAssociationsLineSymbol}))),this._internalGraphicsLayerConnectivity.removeAll(),l.length>0&&this._internalGraphicsLayerConnectivity.addMany(l),this._internalGraphicsLayerStructuralAttachment.removeAll(),w.length>0&&this._internalGraphicsLayerStructuralAttachment.addMany(w)))},e=>{let l="Error: "+e;e instanceof p&&e.details?.raw&&(e.details.raw.extendedCode===G.noAssociationTypeSpecified?l=r:l=e.details.message),this._set("executionError",l)}))})}_createInternalGraphicsLayer(i){return new C({listMode:"hide",internal:!0,title:i})}_removeInternalGraphicsLayers(){this._internalGraphicsLayerConnectivity&&this._internalGraphicsLayerStructuralAttachment&&this.view?.map&&(this.view.map.remove(this._internalGraphicsLayerConnectivity),this.view.map.remove(this._internalGraphicsLayerStructuralAttachment))}};o([n()],s.prototype,"_initialValidationsFinished",void 0),o([n()],s.prototype,"autoRefreshAssociations",void 0),o([n({type:A,nonNullable:!0})],s.prototype,"connectivityAssociationsLineSymbol",void 0),o([n({readOnly:!0})],s.prototype,"executionError",void 0),o([n({type:Boolean,value:!0})],s.prototype,"includeConnectivityAssociations",null),o([n({type:Boolean,value:!0})],s.prototype,"includeStructuralAttachmentAssociations",null),o([n()],s.prototype,"loadErrors",void 0),o([n()],s.prototype,"maxAllowableAssociations",void 0),o([n()],s.prototype,"messages",void 0),o([n()],s.prototype,"showAssociationsEnabled",void 0),o([n()],s.prototype,"showArrowsConnectivity",void 0),o([n()],s.prototype,"showArrowsStructuralAttachment",void 0),o([n({readOnly:!0})],s.prototype,"state",null),o([n({type:A,nonNullable:!0})],s.prototype,"structuralAttachmentAssociationsLineSymbol",void 0),o([n()],s.prototype,"utilityNetwork",null),o([n()],s.prototype,"view",null),s=o([S("esri.widgets.UtilityNetworkAssociations.UtilityNetworkAssociationsViewModel")],s);var K=s;export{K as a};
