import{a as x}from"./chunk-H7LH42EJ.js";import{a as V}from"./chunk-AI4IPVQP.js";import{b as O}from"./chunk-JK6ANXJE.js";import"./chunk-OC2XJJQU.js";import"./chunk-DT6D5YZT.js";import"./chunk-CSSRRM4C.js";import"./chunk-RVXDLN3U.js";import"./chunk-L5YNB4C4.js";import"./chunk-FM2MN524.js";import{e as _}from"./chunk-XEJVICTW.js";import"./chunk-2JW3DUYT.js";import"./chunk-4JIR4MZV.js";import"./chunk-ZO3S2OWI.js";import"./chunk-Q5KIWWVU.js";import"./chunk-CISTQZ5X.js";import"./chunk-Z7TBAZRW.js";import{a as I}from"./chunk-ULOK73M2.js";import"./chunk-NIYDRLW4.js";import{h as E}from"./chunk-QSQIQSC6.js";import"./chunk-AYNBEMCC.js";import"./chunk-LNYBTIG7.js";import"./chunk-NIRJWS2D.js";import"./chunk-H3ZWZZ2B.js";import"./chunk-7SDNM7YV.js";import"./chunk-4NUW747S.js";import"./chunk-T6WMVIUG.js";import"./chunk-JPMGMA4B.js";import"./chunk-YZJDOXQC.js";import{a as L}from"./chunk-JQAW4OB5.js";import"./chunk-F2BQ2GD6.js";import"./chunk-R3XLNYYB.js";import"./chunk-2HYVVLKS.js";import"./chunk-XRTA5GHC.js";import"./chunk-Y6XW36QP.js";import"./chunk-ZXKU6WBY.js";import"./chunk-BMYVPMAK.js";import"./chunk-ZWMM36OQ.js";import"./chunk-AZH7G4R3.js";import"./chunk-MSDJIYGD.js";import"./chunk-6QXEFK4U.js";import"./chunk-WWVFKY5W.js";import"./chunk-5L2EJ5RT.js";import"./chunk-DLFX7BVG.js";import"./chunk-S52JRLJC.js";import"./chunk-E2QKN2KY.js";import"./chunk-PDQQY7RQ.js";import"./chunk-W5OI4BJ2.js";import"./chunk-RWCIDBNQ.js";import"./chunk-2NH7HOKA.js";import"./chunk-EM35R6FY.js";import"./chunk-HM5RIVQC.js";import"./chunk-DJW5LMRG.js";import"./chunk-DEH76MSI.js";import"./chunk-ALWV3RJ2.js";import"./chunk-2ZFXOJDB.js";import"./chunk-QXXXCEV5.js";import"./chunk-6B5XFA6F.js";import"./chunk-TJ6P6NLD.js";import"./chunk-3JGYBNJA.js";import"./chunk-GWBRHLNH.js";import"./chunk-PTZYZULI.js";import"./chunk-NMLYCCKN.js";import"./chunk-ZC6EBRE4.js";import"./chunk-E7AX56GD.js";import"./chunk-IDVLLREH.js";import"./chunk-DWLSVYOY.js";import"./chunk-PQGCNP5H.js";import"./chunk-UASS7NJI.js";import"./chunk-WZRAC35O.js";import"./chunk-KUYAWYSS.js";import"./chunk-MIS6QMFE.js";import"./chunk-MDZTV2VL.js";import"./chunk-RNC4P66O.js";import"./chunk-7LHOQXZT.js";import"./chunk-BCREO4Q5.js";import"./chunk-U4QEPZJ3.js";import"./chunk-KJUZWSCL.js";import"./chunk-3WO6D7MU.js";import"./chunk-BUZ3SPLE.js";import"./chunk-CELWVZPW.js";import"./chunk-DYTVXYAV.js";import"./chunk-ZTOZWLEE.js";import"./chunk-RSDQHAJX.js";import{a as S}from"./chunk-BOVYXYHK.js";import"./chunk-KVM6SHDX.js";import"./chunk-EQZWYK27.js";import"./chunk-JLPLCY2B.js";import"./chunk-ZQIC5NFT.js";import"./chunk-VIEK2X23.js";import"./chunk-XKIFGPJO.js";import"./chunk-PEW2PLAN.js";import"./chunk-Q6Y4JG7Q.js";import"./chunk-7F5DJLJT.js";import"./chunk-CX5IFQZJ.js";import"./chunk-NJWTSROP.js";import"./chunk-D3R25AF2.js";import"./chunk-ARRCN5K3.js";import"./chunk-O3EGNJTY.js";import"./chunk-WGAOVKGR.js";import"./chunk-G4DZJMGT.js";import"./chunk-WTB3O6DJ.js";import"./chunk-7P44K2YD.js";import"./chunk-32OAXCA4.js";import"./chunk-UST6HCE7.js";import"./chunk-K5T5FD5C.js";import"./chunk-MVHHPJM7.js";import"./chunk-VDO6JJ3Y.js";import"./chunk-WFKZLI6F.js";import"./chunk-X2B63YVS.js";import"./chunk-BAEF3CT6.js";import"./chunk-AUAZP44J.js";import"./chunk-PVDFCTA4.js";import"./chunk-KNVXE32P.js";import"./chunk-76ATOSLU.js";import"./chunk-CCJU4DSH.js";import"./chunk-TG45K3WR.js";import"./chunk-RAI4DTMT.js";import"./chunk-ACP3S2CH.js";import"./chunk-HVAXZ2NA.js";import"./chunk-T7DXJKX7.js";import"./chunk-TYYVNQUR.js";import{a as o}from"./chunk-QGVBCWUY.js";import{H as u}from"./chunk-MYO4NP2N.js";import{e as i}from"./chunk-NFIPKH6V.js";import"./chunk-JPU2PQZC.js";import{l}from"./chunk-5QEXLALV.js";import"./chunk-P6QFA5MM.js";import"./chunk-DGTD7Y73.js";import"./chunk-LI2SX4T6.js";import"./chunk-BWO7LS2H.js";import"./chunk-HEVQSRJ2.js";import"./chunk-OVHPPCBL.js";import"./chunk-SNFOAZZQ.js";import"./chunk-AML4XSEF.js";import{d as b,e as k,p as H,r as C}from"./chunk-4PTIEWMT.js";import{g as f}from"./chunk-TG2UTNEO.js";import"./chunk-YOFFGXOB.js";import"./chunk-XRGPJ3QY.js";import"./chunk-6MRUJ2UW.js";import"./chunk-2LI2GKBQ.js";import{y as v}from"./chunk-QBWJMFH5.js";import{f as s}from"./chunk-VTHXE323.js";var c=class extends u{constructor(e){super(e),this.availability=0,this._ids=new Set}destroy(){this._workerHandle.destroy(),this._workerHandle=null}initialize(){this._workerHandle=new w(this.schedule,{fetchAllEdgeLocations:(e,r)=>this._fetchAllEdgeLocations(e,r)})}fetchCandidates(e,r){return s(this,null,function*(){let t=e.coordinateHelper,{point:a}=e,n=A;this.renderCoordsHelper.toRenderCoords(a,t.spatialReference,n);let m=e.distance,p=typeof m=="number"?m:m.distance,y=yield this._workerHandle.invoke({bounds:E(n[0],n[1],n[2],p),returnEdge:e.returnEdge,returnVertex:e.vertexMode!=="none"},r);return y.candidates.sort((g,W)=>g.distance-W.distance),y.candidates.map(g=>this._convertCandidate(t,g))})}add(e,r){return s(this,null,function*(){this._ids.add(e.id),yield this._workerHandle.invokeMethod("add",e,r)})}remove(e,r){return s(this,null,function*(){this._ids.delete(e.id),yield this._workerHandle.invokeMethod("remove",e,r)})}_convertCandidate(e,r){switch(r.type){case"edge":return new O({objectId:r.objectId,targetPoint:_(this._convertRenderCoordinate(e,r.target)),edgeStart:this._convertRenderCoordinate(e,r.start),edgeEnd:this._convertRenderCoordinate(e,r.end),isDraped:!1});case"vertex":return new V({objectId:r.objectId,targetPoint:_(this._convertRenderCoordinate(e,r.target)),isDraped:!1})}}_convertRenderCoordinate({spatialReference:e},r){let t=S();return this.renderCoordsHelper.fromRenderCoords(r,t,e),t}_fetchAllEdgeLocations(e,r){return s(this,null,function*(){let t=[],a=[];for(let{id:n,uid:m}of e.components)this._ids.has(n)&&t.push(s(this,null,function*(){let p=yield this.fetchEdgeLocations(n,r.signal),y=p.locations.buffer;return a.push(y),{id:n,uid:m,objectIds:p.objectIds,locations:y,origin:p.origin,type:p.type}}));return{result:{components:(yield Promise.all(t)).filter(({id:n})=>this._ids.has(n))},transferList:a}})}};o([i({constructOnly:!0})],c.prototype,"renderCoordsHelper",void 0),o([i({constructOnly:!0})],c.prototype,"fetchEdgeLocations",void 0),o([i({constructOnly:!0})],c.prototype,"schedule",void 0),o([i({readOnly:!0})],c.prototype,"availability",void 0),c=o([l("esri.views.interactive.snapping.featureSources.sceneLayerSource.SceneLayerSnappingSourceWorkerHandle")],c);var w=class extends I{constructor(r,t){super("SceneLayerSnappingSourceWorker","fetchCandidates",{},r,{strategy:"dedicated",client:t})}},A=S();var d=class extends u{get updating(){return this._updatingHandles.updating}constructor(e){super(e),this.availability=1,this._updatingHandles=new L,this._abortController=new AbortController}destroy(){this._tracker=b(this._tracker),this._abortController=k(this._abortController),this._updatingHandles.destroy()}initialize(){let{view:e}=this,r=e.resourceController;this._edgeWorker=new x(R(r)),this._workerHandle=new c({renderCoordsHelper:this.view.renderCoordsHelper,schedule:R(r),fetchEdgeLocations:(t,a)=>s(this,null,function*(){if(this._tracker==null)throw new Error("tracker-not-initialized");return this._tracker.fetchEdgeLocations(t,this._edgeWorker,a)})}),this._updatingHandles.addPromise(this._setupLayerView()),this.addHandles([f(this._workerHandle),f(this._edgeWorker)])}fetchCandidates(e,r){return s(this,null,function*(){return this._workerHandle.fetchCandidates(e,r)})}refresh(){}_setupLayerView(){return s(this,null,function*(){if(this.destroyed)return;let e=this._abortController?.signal,r=yield this.getLayerView();r==null||C(e)||(this._tracker=r.trackSnappingSources({add:(t,a)=>{this._updatingHandles.addPromise(this._workerHandle.add({id:t,bounds:a},e))},remove:t=>{this._updatingHandles.addPromise(this._workerHandle.remove({id:t},e))}}))})}};function R(e){return r=>e.immediate.schedule(r)}o([i({constructOnly:!0})],d.prototype,"getLayerView",void 0),o([i({constructOnly:!0})],d.prototype,"view",void 0),o([i({readOnly:!0})],d.prototype,"updating",null),o([i({readOnly:!0})],d.prototype,"availability",void 0),d=o([l("esri.views.interactive.snapping.featureSources.I3SSnappingSource")],d);var h=class extends u{get updating(){return this._i3sSources.some(e=>e.updating)}constructor(e){super(e),this.availability=1,this._i3sSources=[]}destroy(){this._i3sSources.forEach(e=>e.destroy()),this._i3sSources.length=0}initialize(){let{view:e}=this,r=this.layerSource.layer;this._i3sSources=r.type==="building-scene"?this._getBuildingSceneI3SSources(e,r):[this._getSceneLayerI3SSource(e,r)]}fetchCandidates(e,r){return s(this,null,function*(){let t=yield Promise.all(this._i3sSources.map(a=>a.fetchCandidates(e,r)));return H(r),t.flat()})}refresh(){this._i3sSources.forEach(e=>e.refresh())}_getBuildingSceneI3SSources(e,r){return r.allSublayers.toArray().map(t=>t.type==="building-component"?new d({getLayerView:()=>s(this,null,function*(){return(yield e.whenLayerView(r)).whenSublayerView(t)}),view:e}):null).filter(v)}_getSceneLayerI3SSource(e,r){return new d({getLayerView:()=>s(this,null,function*(){let t=yield e.whenLayerView(r);return t.type==="scene-layer-graphics-3d"?void 0:t}),view:e})}};o([i({constructOnly:!0})],h.prototype,"layerSource",void 0),o([i({constructOnly:!0})],h.prototype,"view",void 0),o([i({readOnly:!0})],h.prototype,"updating",null),o([i({readOnly:!0})],h.prototype,"availability",void 0),h=o([l("esri.views.interactive.snapping.featureSources.SceneLayerSnappingSource")],h);export{h as SceneLayerSnappingSource};
