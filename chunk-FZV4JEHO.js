import{a as p}from"./chunk-OW4BGWW5.js";import{a as E}from"./chunk-QCZ3ZIGQ.js";import{h as st}from"./chunk-T6WMVIUG.js";import{a as lt,c as x}from"./chunk-EM35R6FY.js";import{a as _}from"./chunk-ALWV3RJ2.js";import{a as nt,q as N}from"./chunk-QXXXCEV5.js";import{b as F,c as T,d as at,n as R,u as V,x as u,y as z}from"./chunk-6B5XFA6F.js";import{c as tt,k as L,l as et,m as ot,p as it}from"./chunk-ZTOZWLEE.js";import{a as w,b as $,c as d}from"./chunk-BOVYXYHK.js";import{b as S,g as H}from"./chunk-EQZWYK27.js";var c={local:{altitude:1500,ambientAtNight:.1,ambientAtNoon:.45,ambientAtTwilight:.2,directAtNoon:.65,directAtTwilight:.7},global:{altitude:8e5,ambient:.015,direct:.75},planarDirection:{localAltitude:1e4,globalAltitude:1e6,globalAngles:{azimuth:1.3*Math.PI,altitude:.6*Math.PI}}},M=class{constructor(n,a){this.direct=n,this.ambient=a}};function Ut(o,n,a,t,i,e){T(e.ambient.color,1,1,1),e.ambient.intensity=c.global.ambient,T(e.direct.color,1,1,1),e.direct.intensity=c.global.direct;let m=n[2],r=S((Math.abs(m)-c.local.altitude)/(c.global.altitude-c.local.altitude),0,1),g;if(e.globalFactor=r,o!=null&&(g=p.getTimes(o,n[1],n[0])),r<1){let l;if(o!=null)l=Pt(o,g,t);else{let A=Tt(t);l={direct:{intensity:c.local.directAtNoon*A.direct,color:d(1,1,1)},ambient:{intensity:c.local.ambientAtNoon*A.ambient,color:d(1,1,1)},timeOfDay:"early afternoon"}}u(e.ambient.color,l.ambient.color,e.ambient.color,r),e.ambient.intensity=H(l.ambient.intensity,e.ambient.intensity,r),u(e.direct.color,l.direct.color,e.direct.color,r),e.direct.intensity=H(l.direct.intensity,e.direct.intensity,r),e.specularStrength=t==="rainy"||t==="snowy"||t==="foggy"?0:1,e.environmentStrength=t==="rainy"?.7:t==="snowy"||t==="foggy"?.75:1}e.noonFactor=o!=null?Dt(o,g):1,o!=null?Nt(o,n,a,e.direct.directionToLightSource):Mt(i,a,e.direct.directionToLightSource)}function Mt(o,n,a){n===E.Global?V(k,o.eye):T(k,0,0,1),R(X,o.viewForward,-1);let t=st(X,k),i=Math.max(t-2*Y,0),e=.85*i/(i+1),m=Math.max(Y,t-Y-e);it(wt,-m,o.viewRight),z(a,X,wt),at(a,a,R(St,o.viewRight,zt)),V(a,a)}function Nt(o,n,a,t){let i=Ot,e=tt(xt);if(a===E.Global)p.getPosition(o,0,0,i),T(t,0,0,-1),L(e,e,-i.azimuth),et(e,e,-i.altitude),z(t,t,e);else{let m=c.planarDirection,r=m.globalAngles,g=n[2],l=(Math.abs(g)-m.localAltitude)/(m.globalAltitude-m.localAltitude);l=S(l,0,1),l<1?(p.getPosition(o,n[1],n[0],i),i.azimuth=(1-l)*i.azimuth+l*r.azimuth,i.altitude=(1-l)*i.altitude+l*r.altitude):(i.azimuth=r.azimuth,i.altitude=r.altitude),T(t,0,-1,0),ot(e,e,-i.azimuth),L(e,e,-i.altitude),z(t,t,e)}}function jt(o,n){if(n===E.Global)return!0;let a=c.planarDirection;return Math.abs(o)<a.localAltitude}function kt(o,n,a,t,i){let e=o.getTime(),m=n.getTime()-e,r=Math.floor(m/a)+1,g=new Array(r);for(let l=0;l<r;++l)At.setTime(e+a*l),g[l]=w(),Nt(At,t,i,g[l]);return g}var vt=d(.5773502691896258,-.5773502691896258,.5773502691896258),rt=class{constructor(){this.ambient={color:d(1,1,1),intensity:.55},this.direct={color:d(1,1,1),intensity:.55,directionToLightSource:$(vt)},this.noonFactor=.5,this.globalFactor=0,this.specularStrength=1,this.environmentStrength=1}},xt=_(),Ot={azimuth:0,altitude:0};function Dt(o,n){let a=o.valueOf(),t,i;n.polarException===p.PolarException.MIDNIGHT_SUN?(t=a-60*(o.getHours()+48)*60*1e3-60*o.getMinutes()*1e3,i=t+432e6):n.polarException===p.PolarException.POLAR_NIGHT?(t=a-2,i=a-1):(t=n.sunrise.valueOf(),i=n.sunset.valueOf());let e=t+(i-t)/2;return 1-S(Math.abs(a-e)/432e5,0,1)}function Tt(o){switch(o){case"disabled":case"sunny":case"cloudy":return new M(1,1);case"rainy":return new M(.4,1.2);case"snowy":return new M(.5,1.3);case"foggy":return new M(.2,1.6)}}function ct(o,n){let a=(o[0]+o[1]+o[2])/3;o[0]+=(a-o[0])*n,o[1]+=(a-o[1])*n,o[2]+=(a-o[2])*n}var C=d(.01,.01,.01),Z=d(1,.6,.5),q=d(1,.98,.98),ut=d(1,1,1),U=d(.8,.8,1),B=d(.8,.8,1),J=d(.98,.98,1),mt=d(1,1,1),j=x(.01,c.local.ambientAtNight),K=x(c.local.directAtTwilight,c.local.ambientAtTwilight),Q=x(.9*c.local.directAtNoon,c.local.ambientAtNoon),dt=x(c.local.directAtNoon,c.local.ambientAtNoon),gt=Q,ft=q,ht=J,bt=K,yt=Z,pt=B;function Pt(o,n,a){let t=o.valueOf(),i,e;n.polarException===p.PolarException.MIDNIGHT_SUN?(i=t-60*(o.getHours()+48)*60*1e3-60*o.getMinutes()*1e3,e=i+432e6):n.polarException===p.PolarException.POLAR_NIGHT?(i=t-2,e=t-1):(i=n.sunrise.valueOf(),e=n.sunset.valueOf());let m=e-i,r=i+m/2,g=m/4,l=r-g,A=r+g,O=.06*m,I=i-O/2,D=i+O/2,P=e-O/2,G=e+O/2,f=lt(),h=w(),b=w(),y="";if(t<I||t>G)nt(f,j),F(h,C),F(b,U),y="night";else if(t<D){let s=(t-I)/(D-I);N(f,j,K,s),u(h,C,Z,s),u(b,U,B,s),y="sun rising"}else if(t<l){let s=(t-D)/(l-D);N(f,K,Q,s),u(h,Z,q,s),u(b,B,J,s),y="early morning"}else if(t<r){let s=(t-l)/(r-l);N(f,Q,dt,s),u(h,q,ut,s),u(b,J,mt,s),y="late morning"}else if(t<A){let s=(t-r)/(A-r);N(f,dt,gt,s),u(h,ut,ft,s),u(b,mt,ht,s),y="early afternoon"}else if(t<P){let s=(t-A)/(P-A);N(f,gt,bt,s),u(h,ft,yt,s),u(b,ht,pt,s),y="late afternoon"}else if(t<G){let s=(t-P)/(G-P);N(f,bt,j,s),u(h,yt,C,s),u(b,pt,U,s),y="sun setting"}let v=0;switch(a){case"rainy":case"foggy":v=.8;break;case"snowy":v=.5}v>0&&(ct(h,v),ct(b,v));let W=Tt(a);return{direct:{intensity:f[0]*W.direct,color:h},ambient:{intensity:f[1]*W.ambient,color:b},timeOfDay:y}}var At=new Date(0),wt=_(),k=w(),X=w(),St=w(),Y=.25,zt=.2;export{Ut as a,Mt as b,jt as c,kt as d,rt as e};
