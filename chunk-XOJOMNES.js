import{b as ue}from"./chunk-TTZ4CWZW.js";import{a as de}from"./chunk-C24MSACP.js";import{a as _e,c as fe}from"./chunk-Y533SYIC.js";import{b as pe}from"./chunk-SCVJO5X3.js";import{a as ce}from"./chunk-AN3DAG6F.js";import{a as ae}from"./chunk-2GLWK7ZW.js";import{a as re}from"./chunk-CX3G2QWN.js";import{a as he,b as m}from"./chunk-QAHTJVUZ.js";import{a as A,b as M}from"./chunk-T5UBLAP4.js";import{g as le}from"./chunk-J5AEP4US.js";import{a as ne}from"./chunk-L7NOU4T2.js";import{a as oe}from"./chunk-IRQF7UTO.js";import{b as H}from"./chunk-3KOZOOEP.js";import{a as $,b as ee,c as te,d as ie,l as se}from"./chunk-7HMNN4FJ.js";import{a as T,c as L,d as Y}from"./chunk-UKAGN54W.js";import{c as Z}from"./chunk-AYNBEMCC.js";import{a as y}from"./chunk-QCZ3ZIGQ.js";import{c as n}from"./chunk-ONYJLWAD.js";import{a as j}from"./chunk-GJ2QRXGN.js";import{a as Q}from"./chunk-S52JRLJC.js";import{b as B}from"./chunk-E2QKN2KY.js";import{a}from"./chunk-RWCIDBNQ.js";import{a as O,b as J,r as K}from"./chunk-HM5RIVQC.js";import{b as E,c as v,d as z,e as k}from"./chunk-6B5XFA6F.js";import{a as r,b as U,c as I}from"./chunk-BOVYXYHK.js";import{i as X}from"./chunk-EQZWYK27.js";import{a as l}from"./chunk-QGVBCWUY.js";import{e as D}from"./chunk-NFIPKH6V.js";import{l as F}from"./chunk-5QEXLALV.js";import{c as G}from"./chunk-4PTIEWMT.js";var S=class extends ne{constructor(){super(...arguments),this.innerColor=I(1,1,1),this.innerWidth=1,this.glowColor=I(1,.5,0),this.glowWidth=8,this.glowFalloff=8,this.globalAlpha=.75,this.globalAlphaContrastBoost=2,this.angleCutoff=X(6),this.pointDistanceOrigin=r(),this.pointDistanceTarget=r(),this.lineVerticalPlaneSegment=T(),this.intersectsLineSegment=T(),this.intersectsLineRadius=3,this.heightManifoldTarget=r(),this.lineStartWorld=r(),this.lineEndWorld=r()}},w=class extends M{constructor(e,i){super(e,i,new A(fe,()=>import("./chunk-DMEZ7QJX.js")))}};var x=class extends S{constructor(){super(...arguments),this.origin=r()}},V=class extends M{constructor(e,i){super(e,i,new A(pe,()=>import("./chunk-3DV6KBKQ.js")),N)}},N=new Map([[a.START,0],[a.END,1],[a.EXTRUDE,2],[a.START_UP,3],[a.END_UP,4]]);var C=class{constructor(e){this._renderCoordsHelper=e,this._buffers=null,this._origin=r(),this._dirty=!1,this._count=0,this._vao=null}set vertices(e){let i=j(3*e.length),s=0;for(let h of e)i[s++]=h[0],i[s++]=h[1],i[s++]=h[2];this.buffers=[i]}set buffers(e){if(this._buffers=e,this._buffers.length>0){let i=this._buffers[0],s=3*Math.floor(i.length/3/2);v(this._origin,i[s],i[s+1],i[s+2])}else v(this._origin,0,0,0);this._dirty=!0}get origin(){return this._origin}draw(e){let i=this._ensureVAO(e);i!=null&&(e.bindVAO(i),e.drawArrays(J.TRIANGLES,0,this._count))}dispose(){this._vao!=null&&this._vao.dispose()}get _layout(){return this._renderCoordsHelper.viewingMode===y.Global?Ee:Le}_ensureVAO(e){return this._buffers==null?null:(this._vao??=this._createVAO(e,this._buffers),this._ensureVertexData(this._vao,this._buffers),this._vao)}_createVAO(e,i){let s=this._createDataBuffer(i);return this._dirty=!1,new ae(e,N,new Map([["data",Q(this._layout)]]),new Map([["data",re.createVertex(e,K.STATIC_DRAW,s)]]))}_ensureVertexData(e,i){if(!this._dirty)return;let s=this._createDataBuffer(i);e.vertexBuffers.get("data")?.setData(s),this._dirty=!1}_createDataBuffer(e){let i=e.reduce((u,o)=>u+me(o),0);this._count=i;let s=this._layout.createBuffer(i),h=this._origin,p=0,c=0,d="startUp"in s?this._setUpVectors.bind(this,s):void 0;for(let u of e){for(let o=0;o<u.length;o+=3){let q=v(ge,u[o],u[o+1],u[o+2]);o===0?c=this._renderCoordsHelper.getAltitude(q):this._renderCoordsHelper.setAltitude(q,c);let _=p+2*o;d?.(o,_,u,q);let W=k(ge,q,h);if(o<u.length-3){for(let b=0;b<6;b++)s.start.setVec(_+b,W);s.extrude.setValues(_,0,-1),s.extrude.setValues(_+1,1,-1),s.extrude.setValues(_+2,1,1),s.extrude.setValues(_+3,0,-1),s.extrude.setValues(_+4,1,1),s.extrude.setValues(_+5,0,1)}if(o>0)for(let b=-6;b<0;b++)s.end.setVec(_+b,W)}p+=me(u)}return s.buffer}_setUpVectors(e,i,s,h,p){let c=this._renderCoordsHelper.worldUpAtPosition(p,be);if(i<h.length-3)for(let d=0;d<6;d++)e.startUp.setVec(s+d,c);if(i>0)for(let d=-6;d<0;d++)e.endUp.setVec(s+d,c)}};function me(t){return 3*(2*(t.length/3-1))}var be=r(),ge=r(),Ee=B().vec3f(a.START).vec3f(a.END).vec2f(a.EXTRUDE).vec3f(a.START_UP).vec3f(a.END_UP),Le=B().vec3f(a.START).vec3f(a.END).vec2f(a.EXTRUDE);var f=class extends he{constructor(){super(...arguments),this.contrastControlEnabled=!1,this.spherical=!1}};l([m()],f.prototype,"contrastControlEnabled",void 0),l([m()],f.prototype,"spherical",void 0);var g=class extends f{constructor(){super(...arguments),this.heightManifoldEnabled=!1,this.pointDistanceEnabled=!1,this.lineVerticalPlaneEnabled=!1,this.intersectsLineEnabled=!1}};l([m()],g.prototype,"heightManifoldEnabled",void 0),l([m()],g.prototype,"pointDistanceEnabled",void 0),l([m()],g.prototype,"lineVerticalPlaneEnabled",void 0),l([m()],g.prototype,"intersectsLineEnabled",void 0);var P=class extends oe{constructor(t){super(t),this.produces=H.LASERLINES,this.consumes={required:[H.LASERLINES,"normals"]},this.requireGeometryDepth=!0,this._configuration=new g,this._pathTechniqueConfiguration=new f,this._heightManifoldEnabled=!1,this._pointDistanceEnabled=!1,this._lineVerticalPlaneEnabled=!1,this._intersectsLineEnabled=!1,this._intersectsLineInfinite=!1,this._pathVerticalPlaneEnabled=!1,this._passParameters=new x;let e=t.view._stage.renderView.techniques,i=new f;i.contrastControlEnabled=t.contrastControlEnabled,e.precompile(V,i)}initialize(){this._passParameters.renderCoordsHelper=this.view.renderCoordsHelper,this._pathTechniqueConfiguration.spherical=this.view.state.viewingMode===y.Global,this._pathTechniqueConfiguration.contrastControlEnabled=this.contrastControlEnabled,this._techniques.precompile(V,this._pathTechniqueConfiguration),this._blit=new ue(this._techniques,de.PremultipliedAlpha)}destroy(){this._pathVerticalPlaneData=G(this._pathVerticalPlaneData),this._blit=null}get _techniques(){return this.view._stage.renderView.techniques}get heightManifoldEnabled(){return this._heightManifoldEnabled}set heightManifoldEnabled(t){this._heightManifoldEnabled!==t&&(this._heightManifoldEnabled=t,this.requestRender(n.UPDATE))}get heightManifoldTarget(){return this._passParameters.heightManifoldTarget}set heightManifoldTarget(t){E(this._passParameters.heightManifoldTarget,t),this.requestRender(n.UPDATE)}get pointDistanceEnabled(){return this._pointDistanceEnabled}set pointDistanceEnabled(t){t!==this._pointDistanceEnabled&&(this._pointDistanceEnabled=t,this.requestRender(n.UPDATE))}get pointDistanceTarget(){return this._passParameters.pointDistanceTarget}set pointDistanceTarget(t){E(this._passParameters.pointDistanceTarget,t),this.requestRender(n.UPDATE)}get pointDistanceOrigin(){return this._passParameters.pointDistanceOrigin}set pointDistanceOrigin(t){E(this._passParameters.pointDistanceOrigin,t),this.requestRender(n.UPDATE)}get lineVerticalPlaneEnabled(){return this._lineVerticalPlaneEnabled}set lineVerticalPlaneEnabled(t){t!==this._lineVerticalPlaneEnabled&&(this._lineVerticalPlaneEnabled=t,this.requestRender(n.UPDATE))}get lineVerticalPlaneSegment(){return this._passParameters.lineVerticalPlaneSegment}set lineVerticalPlaneSegment(t){L(t,this._passParameters.lineVerticalPlaneSegment),this.requestRender(n.UPDATE)}get intersectsLineEnabled(){return this._intersectsLineEnabled}set intersectsLineEnabled(t){t!==this._intersectsLineEnabled&&(this._intersectsLineEnabled=t,this.requestRender(n.UPDATE))}get intersectsLineSegment(){return this._passParameters.intersectsLineSegment}set intersectsLineSegment(t){L(t,this._passParameters.intersectsLineSegment),this.requestRender(n.UPDATE)}get intersectsLineInfinite(){return this._intersectsLineInfinite}set intersectsLineInfinite(t){t!==this._intersectsLineInfinite&&(this._intersectsLineInfinite=t,this.requestRender(n.UPDATE))}get pathVerticalPlaneEnabled(){return this._pathVerticalPlaneEnabled}set pathVerticalPlaneEnabled(t){t!==this._pathVerticalPlaneEnabled&&(this._pathVerticalPlaneEnabled=t,this._pathVerticalPlaneData!=null&&this.requestRender(n.UPDATE))}set pathVerticalPlaneVertices(t){this._pathVerticalPlaneData==null&&(this._pathVerticalPlaneData=new C(this._passParameters.renderCoordsHelper)),this._pathVerticalPlaneData.vertices=t,this.pathVerticalPlaneEnabled&&this.requestRender(n.UPDATE)}set pathVerticalPlaneBuffers(t){this._pathVerticalPlaneData==null&&(this._pathVerticalPlaneData=new C(this._passParameters.renderCoordsHelper)),this._pathVerticalPlaneData.buffers=t,this.pathVerticalPlaneEnabled&&this.requestRender(n.UPDATE)}setParameters(t){le(this._passParameters,t)&&this.requestRender(n.UPDATE)}precompile(){this._acquireTechnique()}render(t){let e=t.find(({name:c})=>c===this.produces);if(!this.bindParameters.decorations||this._blit==null)return e;let i=this.renderingContext,s=t.find(({name:c})=>c==="normals");this._passParameters.normals=s?.getTexture();let h=()=>{(this.heightManifoldEnabled||this.pointDistanceEnabled||this.lineVerticalPlaneSegment||this.intersectsLineEnabled)&&this._renderUnified(),this.pathVerticalPlaneEnabled&&this._renderPath()};if(!this.contrastControlEnabled)return i.bindFramebuffer(e.fbo),h(),e;this._passParameters.colors=e.getTexture();let p=this.fboCache.acquire(e.fbo.width,e.fbo.height,"laser lines");return i.bindFramebuffer(p.fbo),i.setClearColor(0,0,0,0),i.clear(O.COLOR|O.DEPTH),h(),i.unbindTexture(e.getTexture()),this._blit.blend(i,p,e,this.bindParameters)||this.requestRender(n.UPDATE),p.release(),e}_acquireTechnique(){return this._configuration.heightManifoldEnabled=this.heightManifoldEnabled,this._configuration.lineVerticalPlaneEnabled=this.lineVerticalPlaneEnabled,this._configuration.pointDistanceEnabled=this.pointDistanceEnabled,this._configuration.intersectsLineEnabled=this.intersectsLineEnabled,this._configuration.contrastControlEnabled=this.contrastControlEnabled,this._configuration.spherical=this.view.state.viewingMode===y.Global,this._techniques.get(w,this._configuration)}_renderUnified(){if(!this._updatePassParameters())return;let t=this._acquireTechnique();if(t.compiled){let e=this.renderingContext;e.bindTechnique(t,this.bindParameters,this._passParameters),e.screen.draw()}else this.requestRender(n.UPDATE)}_renderPath(){if(this._pathVerticalPlaneData==null)return;let t=this._techniques.get(V,this._pathTechniqueConfiguration);if(t.compiled){let e=this.renderingContext;this._passParameters.origin=this._pathVerticalPlaneData.origin,e.bindTechnique(t,this.bindParameters,this._passParameters),this._pathVerticalPlaneData.draw(e)}else this.requestRender(n.UPDATE)}_updatePassParameters(){if(!this._intersectsLineEnabled)return!0;let t=this.bindParameters.camera,e=this._passParameters;if(this._intersectsLineInfinite){if(ee(Z(e.intersectsLineSegment.origin,e.intersectsLineSegment.vector),R),R.c0=-Number.MAX_VALUE,!se(t.frustum,R))return!1;te(R,e.lineStartWorld),ie(R,e.lineEndWorld)}else E(e.lineStartWorld,e.intersectsLineSegment.origin),z(e.lineEndWorld,e.intersectsLineSegment.origin,e.intersectsLineSegment.vector);return!0}get test(){}};l([D({constructOnly:!0})],P.prototype,"contrastControlEnabled",void 0),l([D({constructOnly:!0})],P.prototype,"isDecoration",void 0),l([D()],P.prototype,"produces",void 0),l([D()],P.prototype,"consumes",void 0),P=l([F("esri.views.3d.webgl-engine.effects.laserlines.LaserLineRenderer")],P);var R=$();var Pe=class extends ce{constructor(e){super(e),this._angleCutoff=_e,this._style={},this._heightManifoldTarget=r(),this._heightManifoldEnabled=!1,this._intersectsLine=T(),this._intersectsLineEnabled=!1,this._intersectsLineInfinite=!1,this._lineVerticalPlaneSegment=null,this._pathVerticalPlaneBuffers=null,this._pointDistanceLine=null,this.applyProperties(e)}get testData(){}createResources(){this._ensureRenderer()}destroyResources(){this._disposeRenderer()}updateVisibility(){this._syncRenderer(),this._syncHeightManifold(),this._syncIntersectsLine(),this._syncPathVerticalPlane(),this._syncLineVerticalPlane(),this._syncPointDistance()}get angleCutoff(){return this._angleCutoff}set angleCutoff(e){this._angleCutoff!==e&&(this._angleCutoff=e,this._syncAngleCutoff())}get style(){return this._style}set style(e){this._style=e,this._syncStyle()}get heightManifoldTarget(){return this._heightManifoldEnabled?this._heightManifoldTarget:null}set heightManifoldTarget(e){e!=null?(E(this._heightManifoldTarget,e),this._heightManifoldEnabled=!0):this._heightManifoldEnabled=!1,this._syncRenderer(),this._syncHeightManifold()}set intersectsWorldUpAtLocation(e){if(e==null)return void(this.intersectsLine=null);let i=this.view.renderCoordsHelper.worldUpAtPosition(e,Ve);this.intersectsLine=Y(e,i),this.intersectsLineInfinite=!0}get intersectsLine(){return this._intersectsLineEnabled?this._intersectsLine:null}set intersectsLine(e){e!=null?(L(e,this._intersectsLine),this._intersectsLineEnabled=!0):this._intersectsLineEnabled=!1,this._syncIntersectsLine(),this._syncRenderer()}get intersectsLineInfinite(){return this._intersectsLineInfinite}set intersectsLineInfinite(e){this._intersectsLineInfinite=e,this._syncIntersectsLineInfinite()}get lineVerticalPlaneSegment(){return this._lineVerticalPlaneSegment}set lineVerticalPlaneSegment(e){this._lineVerticalPlaneSegment=e!=null?L(e):null,this._syncLineVerticalPlane(),this._syncRenderer()}get pathVerticalPlane(){return this._pathVerticalPlaneBuffers}set pathVerticalPlane(e){this._pathVerticalPlaneBuffers=e,this._syncPathVerticalPlane(),this._syncLineVerticalPlane(),this._syncPointDistance(),this._syncRenderer()}get pointDistanceLine(){return this._pointDistanceLine}set pointDistanceLine(e){this._pointDistanceLine=e!=null?{origin:U(e.origin),target:e.target?U(e.target):null}:null,this._syncPointDistance(),this._syncRenderer()}_syncRenderer(){this.attached&&this.visible&&(this._intersectsLineEnabled||this._heightManifoldEnabled||this._pointDistanceLine!=null||this._pathVerticalPlaneBuffers!=null)?this._ensureRenderer():this._disposeRenderer()}_ensureRenderer(){this._renderer==null&&(this._renderer=new P({view:this.view,contrastControlEnabled:!0,isDecoration:this.isDecoration}),this._syncStyle(),this._syncHeightManifold(),this._syncIntersectsLine(),this._syncIntersectsLineInfinite(),this._syncPathVerticalPlane(),this._syncLineVerticalPlane(),this._syncPointDistance(),this._syncAngleCutoff())}_syncStyle(){this._renderer!=null&&this._renderer.setParameters(this._style)}_syncAngleCutoff(){this._renderer?.setParameters({angleCutoff:this._angleCutoff})}_syncHeightManifold(){this._renderer!=null&&(this._renderer.heightManifoldEnabled=this._heightManifoldEnabled&&this.visible,this._heightManifoldEnabled&&(this._renderer.heightManifoldTarget=this._heightManifoldTarget))}_syncIntersectsLine(){this._renderer!=null&&(this._renderer.intersectsLineEnabled=this._intersectsLineEnabled&&this.visible,this._intersectsLineEnabled&&(this._renderer.intersectsLineSegment=this._intersectsLine))}_syncIntersectsLineInfinite(){this._renderer!=null&&(this._renderer.intersectsLineInfinite=this._intersectsLineInfinite)}_syncPathVerticalPlane(){this._renderer!=null&&(this._renderer.pathVerticalPlaneEnabled=this._pathVerticalPlaneBuffers!=null&&this.visible,this._pathVerticalPlaneBuffers!=null&&(this._renderer.pathVerticalPlaneBuffers=this._pathVerticalPlaneBuffers))}_syncLineVerticalPlane(){this._renderer!=null&&(this._renderer.lineVerticalPlaneEnabled=this._lineVerticalPlaneSegment!=null&&this.visible,this._lineVerticalPlaneSegment!=null&&(this._renderer.lineVerticalPlaneSegment=this._lineVerticalPlaneSegment))}_syncPointDistance(){if(this._renderer==null)return;let e=this._pointDistanceLine,i=e!=null;this._renderer.pointDistanceEnabled=i&&e.target!=null&&this.visible,i&&(this._renderer.pointDistanceOrigin=e.origin,e.target!=null&&(this._renderer.pointDistanceTarget=e.target))}_disposeRenderer(){this._renderer!=null&&this.view._stage&&(this._renderer.destroy(),this._renderer=null)}},Ve=r();export{Pe as a};
