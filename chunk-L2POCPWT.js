import{a as _}from"./chunk-L56OBJFS.js";import"./chunk-7HMNN4FJ.js";import{a as y,e as j,g as P}from"./chunk-UKAGN54W.js";import{b as v,p as l}from"./chunk-QSQIQSC6.js";import"./chunk-AYNBEMCC.js";import"./chunk-LNYBTIG7.js";import"./chunk-7SDNM7YV.js";import"./chunk-4NUW747S.js";import"./chunk-T6WMVIUG.js";import"./chunk-JPMGMA4B.js";import{g as L}from"./chunk-AZH7G4R3.js";import"./chunk-MSDJIYGD.js";import"./chunk-6QXEFK4U.js";import"./chunk-WWVFKY5W.js";import"./chunk-5L2EJ5RT.js";import"./chunk-DLFX7BVG.js";import"./chunk-S52JRLJC.js";import"./chunk-E2QKN2KY.js";import"./chunk-PDQQY7RQ.js";import"./chunk-W5OI4BJ2.js";import"./chunk-RWCIDBNQ.js";import"./chunk-2NH7HOKA.js";import"./chunk-EM35R6FY.js";import"./chunk-HM5RIVQC.js";import"./chunk-DJW5LMRG.js";import"./chunk-DEH76MSI.js";import"./chunk-ALWV3RJ2.js";import"./chunk-2ZFXOJDB.js";import"./chunk-QXXXCEV5.js";import{d as h,o as f,p as g}from"./chunk-6B5XFA6F.js";import"./chunk-PTZYZULI.js";import"./chunk-NMLYCCKN.js";import"./chunk-BCREO4Q5.js";import"./chunk-ZTOZWLEE.js";import"./chunk-RSDQHAJX.js";import{a as c,b as p}from"./chunk-BOVYXYHK.js";import"./chunk-EQZWYK27.js";import{a as E}from"./chunk-QGVBCWUY.js";import"./chunk-JPU2PQZC.js";import{l as w}from"./chunk-5QEXLALV.js";import"./chunk-P6QFA5MM.js";import"./chunk-LI2SX4T6.js";import"./chunk-OVHPPCBL.js";import"./chunk-AML4XSEF.js";import{p as x}from"./chunk-4PTIEWMT.js";import"./chunk-TG2UTNEO.js";import"./chunk-YOFFGXOB.js";import"./chunk-XRGPJ3QY.js";import"./chunk-6MRUJ2UW.js";import"./chunk-2LI2GKBQ.js";import"./chunk-QBWJMFH5.js";import{f as u}from"./chunk-VTHXE323.js";var I=1e3;function S(t,s,o){let n=v(),e=n;return f(e,e,t,.5),f(e,e,s,.5),n[3]=g(e,t),h(e,e,o),n}var b=class{constructor(){this._idToComponent=new Map,this._components=new _(t=>t.bounds),this._edges=new _(t=>t.bounds),this._tmpLineSegment=y(),this._tmpP1=c(),this._tmpP2=c(),this._tmpP3=c(),this.remoteClient=null}fetchCandidates(t,s){return u(this,null,function*(){yield Promise.resolve(),x(s),yield this._ensureEdgeLocations(t,s);let o=[];return this._edges.forEachNeighbor(n=>(this._addCandidates(t,n,o),o.length<I),t.bounds),{result:{candidates:o}}})}_ensureEdgeLocations(t,s){return u(this,null,function*(){let o=[];if(this._components.forEachNeighbor(i=>{if(i.info==null){let{id:a,uid:r}=i;o.push({id:a,uid:r})}return!0},t.bounds),!o.length)return;let n={components:o},e=yield this.remoteClient.invoke("fetchAllEdgeLocations",n,s??{});for(let i of e.components)this._setFetchEdgeLocations(i)})}add(t){return u(this,null,function*(){let s=new A(t.id,t.bounds);return this._idToComponent.set(s.id,s),this._components.add([s]),{result:{}}})}remove(t){return u(this,null,function*(){let s=this._idToComponent.get(t.id);if(s){let o=[];this._edges.forEachNeighbor(n=>(n.component===s&&o.push(n),!0),s.bounds),this._edges.remove(o),this._components.remove([s]),this._idToComponent.delete(s.id)}return{result:{}}})}_setFetchEdgeLocations(t){let s=this._idToComponent.get(t.id);if(s==null||t.uid!==s.uid)return;let o=L.createView(t.locations),n=new Array(o.count),e=c(),i=c();for(let d=0;d<o.count;d++){o.position0.getVec(d,e),o.position1.getVec(d,i);let m=S(e,i,t.origin),T=new C(s,d,m);n[d]=T}this._edges.add(n);let{objectIds:a,origin:r}=t;s.info={locations:o,objectIds:a,origin:r}}_addCandidates(t,s,o){let{info:n}=s.component,{origin:e,objectIds:i}=n,a=n.locations,r=a.position0.getVec(s.index,this._tmpP1),d=a.position1.getVec(s.index,this._tmpP2);h(r,r,e),h(d,d,e);let m=i[a.componentIndex.get(s.index)];this._addEdgeCandidate(t,m,r,d,o),V(t,m,r,o),V(t,m,d,o)}_addEdgeCandidate(t,s,o,n,e){if(!t.returnEdge)return;let i=t.bounds,a=j(o,n,this._tmpLineSegment),r=P(a,i,this._tmpP3);l(t.bounds,r)&&e.push({type:"edge",objectId:s,target:p(r),distance:g(i,r),start:p(o),end:p(n)})}};b=E([w("esri.views.interactive.snapping.featureSources.sceneLayerSource.SceneLayerSnappingSourceWorker")],b);var Y=b;function V(t,s,o,n){if(!t.returnVertex||!l(t.bounds,o))return;let e=t.bounds;n.push({type:"vertex",objectId:s,target:p(o),distance:g(e,o)})}var A=(()=>{class t{constructor(o,n){this.id=o,this.bounds=n,this.info=null,this.uid=++t.uid}}return t.uid=0,t})(),C=class{constructor(s,o,n){this.component=s,this.index=o,this.bounds=n}};export{Y as default};
