import{a as Ke}from"./chunk-D3HZTFZV.js";import{e as Fe}from"./chunk-F5MZ643P.js";import{a as Ge,b as Oe,c as R,d as te,e as me,f as Pe,g as Be,h as Ue,i as je,j as We,k as He,l as Qe,m as $e,r as Ve}from"./chunk-ZHEBYHJM.js";import"./chunk-C6DX4KYY.js";import"./chunk-7XYYDAZO.js";import"./chunk-DXT3NBO5.js";import{a as ge,b as K}from"./chunk-J4SOMZCO.js";import{a as M,b as Z,c as ee,d as C,e as ze}from"./chunk-WGX2RQVH.js";import"./chunk-5AFOYCWC.js";import"./chunk-Z3MWEX65.js";import"./chunk-YB6RTOHR.js";import{n as _e}from"./chunk-4DLF223B.js";import"./chunk-PAEROXLO.js";import"./chunk-LJHBR43S.js";import"./chunk-PKGWWNKH.js";import"./chunk-5ODT4QWI.js";import"./chunk-RCMLLFN4.js";import"./chunk-N3KJUYQ3.js";import"./chunk-A3OKZXVJ.js";import"./chunk-SWTRFX2P.js";import"./chunk-IL5542KK.js";import"./chunk-ZSWFCIVC.js";import"./chunk-7TSV4K7J.js";import"./chunk-4P2XDT7J.js";import"./chunk-FKDBDTMG.js";import"./chunk-4AFDTGTF.js";import"./chunk-OYMKYJHY.js";import"./chunk-JGDSALA2.js";import"./chunk-QFLALGDP.js";import"./chunk-AKJLP3M7.js";import"./chunk-DB4Z3R2Q.js";import"./chunk-6KWLTABS.js";import"./chunk-BME43EJE.js";import"./chunk-735YNPMJ.js";import"./chunk-3MM5N7T7.js";import"./chunk-WVQFNB4M.js";import"./chunk-ZO3XYJ6T.js";import"./chunk-3O3XXTRY.js";import"./chunk-T4GATEJX.js";import"./chunk-MIAUYZNE.js";import"./chunk-ITDLEL4J.js";import"./chunk-TM5LHTOQ.js";import"./chunk-IUHAUWZW.js";import"./chunk-BKVXSCSA.js";import"./chunk-L245KTSY.js";import"./chunk-Z6CDEQPZ.js";import"./chunk-DKNG2DCF.js";import"./chunk-RZU6EEB3.js";import"./chunk-NIRJWS2D.js";import"./chunk-H3ZWZZ2B.js";import"./chunk-U7BD7DJH.js";import"./chunk-LBB4AU7W.js";import"./chunk-H4IF7PQO.js";import{a as Re}from"./chunk-GGYZRKBV.js";import"./chunk-4KM76TSJ.js";import"./chunk-GNPXNHTO.js";import"./chunk-7P56QMT7.js";import"./chunk-P4JHTV62.js";import{a as xe}from"./chunk-H25DKJGS.js";import"./chunk-QTO4E4UZ.js";import"./chunk-SO3JGF64.js";import"./chunk-TIWKONVC.js";import"./chunk-CHCKIOZR.js";import"./chunk-TUF2Y2FX.js";import"./chunk-KN5AJ2NM.js";import"./chunk-5A7AFZJT.js";import"./chunk-Z5EURZKA.js";import"./chunk-OVX6BGGA.js";import{d as Ae}from"./chunk-PBAMEKFE.js";import"./chunk-XIZ7IH6M.js";import"./chunk-JD66UCS7.js";import"./chunk-FU7RO3AR.js";import"./chunk-4YRY3D3A.js";import"./chunk-ZZ5UYT7M.js";import"./chunk-U4XVPHQU.js";import"./chunk-KLZGQ7M6.js";import"./chunk-N36GL6VL.js";import"./chunk-UX3QUEDM.js";import"./chunk-YZJDOXQC.js";import"./chunk-6ZY36ZHO.js";import"./chunk-6RHGQ4Z5.js";import"./chunk-G23ELQMS.js";import"./chunk-PZOK2JKH.js";import"./chunk-FJUYECJ6.js";import"./chunk-2SXWYVJN.js";import"./chunk-ELUASJOG.js";import"./chunk-KQZGMGWR.js";import"./chunk-66BPZDMW.js";import"./chunk-GAVFKWSK.js";import"./chunk-DK4DGLAO.js";import"./chunk-7Y6S2GNA.js";import"./chunk-VOB6IBIW.js";import"./chunk-63B3IOWG.js";import"./chunk-PE276TWH.js";import"./chunk-BMZ3PE5Y.js";import"./chunk-EHG7JRYJ.js";import"./chunk-FNY6LFKI.js";import"./chunk-IBVI7JQ7.js";import"./chunk-2DFFQEIV.js";import"./chunk-J2AEVBSH.js";import"./chunk-5ODXFRPI.js";import"./chunk-E5QCV5LT.js";import"./chunk-QS3EYJPF.js";import"./chunk-HJJZ2AXH.js";import"./chunk-TPNSUEHH.js";import"./chunk-SMVNQSZ4.js";import"./chunk-Z2QGLRDB.js";import"./chunk-7IDFDPA3.js";import"./chunk-VL2YL74P.js";import"./chunk-P2AJD2R2.js";import"./chunk-UMJIJLDA.js";import"./chunk-E5NFS3KN.js";import"./chunk-HQHD6BMN.js";import"./chunk-AIKKGGPG.js";import"./chunk-RDGG4TVD.js";import"./chunk-3IQFPOUU.js";import"./chunk-I4CY6X6S.js";import"./chunk-VQ4QGNRX.js";import"./chunk-LLWQ5E4P.js";import"./chunk-GNEAU6X4.js";import"./chunk-5RH7OPHX.js";import"./chunk-JFB3F3BC.js";import"./chunk-J4JQLN5L.js";import"./chunk-4KXJ537H.js";import"./chunk-JIRULGDT.js";import"./chunk-QJGOWIJD.js";import"./chunk-QML26MQC.js";import"./chunk-RNZY2XUD.js";import"./chunk-JXPUHKCT.js";import"./chunk-XR5FT7TQ.js";import"./chunk-4YTM754S.js";import"./chunk-LAX5536Z.js";import"./chunk-N3HRYLNW.js";import"./chunk-4DBMALZW.js";import"./chunk-CVWWHM2V.js";import"./chunk-6OQYVEQJ.js";import"./chunk-XNHRPKJK.js";import"./chunk-YOXOWGT6.js";import"./chunk-EFZOSMYP.js";import"./chunk-WI7F4ZKJ.js";import"./chunk-MJ7M24NH.js";import"./chunk-GJH4QFRX.js";import"./chunk-T63F7663.js";import"./chunk-O4V2VBSK.js";import"./chunk-5TKRKB5E.js";import"./chunk-XAGMDNNR.js";import"./chunk-OP2TLIUN.js";import"./chunk-T2THIR6K.js";import"./chunk-LORHDXEB.js";import"./chunk-BBBPJI4H.js";import"./chunk-45BTW5EG.js";import"./chunk-TPFBHGDM.js";import"./chunk-73NLRHJD.js";import"./chunk-PNFEUBDF.js";import"./chunk-6RCCEJDL.js";import"./chunk-PQ2TNDUX.js";import"./chunk-6X6MKRQ3.js";import"./chunk-FQFHMHYU.js";import"./chunk-SZMEI3WL.js";import"./chunk-KKVGD67U.js";import"./chunk-MYOJWRDU.js";import"./chunk-L7UKJKHG.js";import"./chunk-V2IENAEU.js";import"./chunk-QAGQFNF2.js";import"./chunk-SY7JS2VW.js";import"./chunk-WK57SDN6.js";import"./chunk-AG4V3ZUO.js";import"./chunk-YWLMJ26A.js";import"./chunk-QAWNU3UJ.js";import"./chunk-HRQT4R6X.js";import"./chunk-44BHLWQ4.js";import"./chunk-5BPM64SU.js";import"./chunk-PMVHHMQJ.js";import"./chunk-NAFOM5UA.js";import"./chunk-DO7UF2F2.js";import"./chunk-ZTR6OS44.js";import"./chunk-VRTKAD2J.js";import"./chunk-DBLKLHK2.js";import"./chunk-UTE3ASAZ.js";import"./chunk-2AFEAPEX.js";import"./chunk-GNGXUEWV.js";import"./chunk-QBI5NDCA.js";import"./chunk-NOHW2DKR.js";import"./chunk-HVJAAM3A.js";import"./chunk-ACPEJEHK.js";import"./chunk-I7B3LWNP.js";import"./chunk-YP2E5N4E.js";import"./chunk-QLMNLSCT.js";import"./chunk-P55G5ATK.js";import"./chunk-JT3K52KQ.js";import"./chunk-SPLEGG4R.js";import"./chunk-Y4TJDUGP.js";import"./chunk-6PAFOJ4W.js";import"./chunk-74SDGE57.js";import"./chunk-FRXWHX3T.js";import"./chunk-DTDQ5X42.js";import"./chunk-RX2HFR4X.js";import"./chunk-AZW7YPTQ.js";import"./chunk-NJLJX4X6.js";import"./chunk-DZHFTD24.js";import"./chunk-K57Z4J34.js";import"./chunk-VWG3KVOU.js";import"./chunk-JOEUVLAN.js";import"./chunk-JZQDGIDQ.js";import"./chunk-CZ6CGC7I.js";import"./chunk-7B6U3N62.js";import"./chunk-46WDO5LS.js";import"./chunk-G5EYK5KM.js";import"./chunk-YJKJQU3F.js";import"./chunk-OK4K3OQT.js";import"./chunk-BPWNCOXC.js";import"./chunk-VNS4CQ27.js";import"./chunk-AVMO6LCR.js";import"./chunk-TEGPMVWT.js";import"./chunk-CLQRQC3Y.js";import"./chunk-KSNU73LO.js";import"./chunk-FACEVGRE.js";import"./chunk-5XTCPT52.js";import"./chunk-TC77DYTW.js";import"./chunk-F2BQ2GD6.js";import"./chunk-R3XLNYYB.js";import"./chunk-2HYVVLKS.js";import"./chunk-XRTA5GHC.js";import"./chunk-Y6XW36QP.js";import"./chunk-ZXKU6WBY.js";import"./chunk-BMYVPMAK.js";import"./chunk-6F25LG6O.js";import"./chunk-D366LN2H.js";import"./chunk-6KRFVLII.js";import"./chunk-P5ULBNZS.js";import"./chunk-4BZWOF3V.js";import"./chunk-ZRSDAYWS.js";import"./chunk-S7U4DSGB.js";import"./chunk-G27DRLGO.js";import"./chunk-ZGHRJMZW.js";import"./chunk-XLL67PCY.js";import"./chunk-MCO7DSFO.js";import"./chunk-IIROCMOY.js";import"./chunk-K3Z3MI77.js";import"./chunk-EDZQZA57.js";import"./chunk-V6AA2XHK.js";import{m as V}from"./chunk-25WBXAEY.js";import"./chunk-7QY3BMVN.js";import"./chunk-Y7GY5YIF.js";import"./chunk-LMGYHZE3.js";import"./chunk-5LG2P6MT.js";import"./chunk-GJ2QRXGN.js";import"./chunk-CKJDDSAD.js";import"./chunk-DQOFEB5P.js";import"./chunk-TJ6P6NLD.js";import"./chunk-NX5B6XBR.js";import"./chunk-2JABY6DU.js";import"./chunk-MPRKSQLC.js";import"./chunk-57TARQ4F.js";import"./chunk-6RBQSBA2.js";import"./chunk-Z42K5ECK.js";import"./chunk-NVTU6MJO.js";import"./chunk-56M6LBCJ.js";import"./chunk-HZK6UIET.js";import"./chunk-T2RV3ABV.js";import"./chunk-CSNRCIB5.js";import"./chunk-6FW4T2SJ.js";import"./chunk-4ZVBFHBA.js";import"./chunk-3JGYBNJA.js";import"./chunk-DA3SDKGO.js";import"./chunk-ZOEPYNM4.js";import"./chunk-57VFBGF3.js";import"./chunk-GWBRHLNH.js";import"./chunk-BJH4F4SM.js";import"./chunk-Z3RBZHAK.js";import"./chunk-IO35PPBL.js";import"./chunk-F5AJITOA.js";import"./chunk-IHATPE6U.js";import"./chunk-PU4AK46X.js";import"./chunk-3CLJ5OX5.js";import"./chunk-E6C7G5SC.js";import"./chunk-73K3NWCV.js";import"./chunk-SP2CO3KX.js";import"./chunk-PTZYZULI.js";import"./chunk-NMLYCCKN.js";import"./chunk-FYZRIMPP.js";import"./chunk-ZC6EBRE4.js";import"./chunk-ZAZJB7CV.js";import"./chunk-KALOJIUA.js";import"./chunk-KMMTNF7G.js";import"./chunk-E7AX56GD.js";import"./chunk-IDVLLREH.js";import"./chunk-DWLSVYOY.js";import"./chunk-PQGCNP5H.js";import"./chunk-UASS7NJI.js";import"./chunk-WZRAC35O.js";import"./chunk-KUYAWYSS.js";import"./chunk-MIS6QMFE.js";import"./chunk-MDZTV2VL.js";import"./chunk-RNC4P66O.js";import"./chunk-7LHOQXZT.js";import"./chunk-BCREO4Q5.js";import{a as ye}from"./chunk-U4QEPZJ3.js";import"./chunk-KJUZWSCL.js";import"./chunk-3WO6D7MU.js";import"./chunk-BUZ3SPLE.js";import"./chunk-2TX472ZB.js";import{c as Ee}from"./chunk-7QNKS2X6.js";import{a as Se}from"./chunk-VCCMJ6BV.js";import{a as qe}from"./chunk-QK56OQGR.js";import"./chunk-FXCL7YYQ.js";import"./chunk-QKO56XO6.js";import"./chunk-JRGT3GTH.js";import"./chunk-K75TK42V.js";import"./chunk-CELWVZPW.js";import"./chunk-VV5G7VY5.js";import"./chunk-OLOKUDVI.js";import"./chunk-DYTVXYAV.js";import"./chunk-ZTOZWLEE.js";import"./chunk-RJWOVI3M.js";import"./chunk-RSDQHAJX.js";import"./chunk-BOVYXYHK.js";import"./chunk-KVM6SHDX.js";import"./chunk-WATIOYLF.js";import"./chunk-POX73EYJ.js";import"./chunk-NKUXRYJG.js";import"./chunk-33RXTDEX.js";import"./chunk-P33JWG3G.js";import"./chunk-HX2VGIR2.js";import"./chunk-ERDKAICI.js";import"./chunk-EQZWYK27.js";import"./chunk-JLPLCY2B.js";import"./chunk-DKGGDYJI.js";import"./chunk-5LA3PVK5.js";import"./chunk-IR6XCBC4.js";import"./chunk-C6JPAW54.js";import"./chunk-WD3OPXCN.js";import"./chunk-FA3WGIU4.js";import"./chunk-WWVPA6PE.js";import{m as ce}from"./chunk-ZQIC5NFT.js";import{c as oe}from"./chunk-VIEK2X23.js";import"./chunk-XKIFGPJO.js";import"./chunk-PEW2PLAN.js";import"./chunk-Q6Y4JG7Q.js";import"./chunk-7F5DJLJT.js";import"./chunk-CX5IFQZJ.js";import"./chunk-NJWTSROP.js";import"./chunk-D3R25AF2.js";import"./chunk-ARRCN5K3.js";import"./chunk-O3EGNJTY.js";import"./chunk-WGAOVKGR.js";import"./chunk-SLAWDKDA.js";import"./chunk-4N4D2YQX.js";import"./chunk-G4DZJMGT.js";import"./chunk-WTB3O6DJ.js";import"./chunk-7P44K2YD.js";import"./chunk-32OAXCA4.js";import"./chunk-UST6HCE7.js";import"./chunk-K5T5FD5C.js";import"./chunk-MVHHPJM7.js";import"./chunk-VDO6JJ3Y.js";import"./chunk-WFKZLI6F.js";import"./chunk-X2B63YVS.js";import"./chunk-BAEF3CT6.js";import"./chunk-AUAZP44J.js";import"./chunk-PVDFCTA4.js";import"./chunk-KNVXE32P.js";import"./chunk-76ATOSLU.js";import"./chunk-CCJU4DSH.js";import{a as ve,i as Ie}from"./chunk-TG45K3WR.js";import"./chunk-RAI4DTMT.js";import{b as $}from"./chunk-ACP3S2CH.js";import"./chunk-HVAXZ2NA.js";import"./chunk-T7DXJKX7.js";import"./chunk-TYYVNQUR.js";import{a as L}from"./chunk-QGVBCWUY.js";import{h as H,k as Te}from"./chunk-MYO4NP2N.js";import{e as w}from"./chunk-NFIPKH6V.js";import"./chunk-JPU2PQZC.js";import{l as De}from"./chunk-5QEXLALV.js";import{c as j}from"./chunk-P6QFA5MM.js";import"./chunk-DGTD7Y73.js";import"./chunk-LI2SX4T6.js";import"./chunk-BWO7LS2H.js";import"./chunk-HEVQSRJ2.js";import"./chunk-OVHPPCBL.js";import"./chunk-SNFOAZZQ.js";import"./chunk-AML4XSEF.js";import{o as Ne,p as Q,y as ne}from"./chunk-4PTIEWMT.js";import"./chunk-TG2UTNEO.js";import{b as Y}from"./chunk-YOFFGXOB.js";import{g as E}from"./chunk-XRGPJ3QY.js";import"./chunk-6MRUJ2UW.js";import"./chunk-2LI2GKBQ.js";import"./chunk-QBWJMFH5.js";import{a as ue,f as D}from"./chunk-VTHXE323.js";var q;(function(e){e.MULTIPLIER="multiplier",e.ABSOLUTE="absolute-value"})(q||(q={}));var f=class extends Re(Ee(Se(xe(qe)))){constructor(e){if(super(e),this.url=null,this.dataPreloadedInLocalCache=!1,this.initializationLinkChartConfig=null,this.membershipModified=!0,this._currentLinkChartConfig={layoutMode:"organic-standard"},this._graphTypeLookup=new Map,this.dataManager=null,this.knowledgeGraph=null,this.layers=new($.ofType(K)),this.entityLinkChartDiagramLookup=new Map,this.relationshipLinkChartDiagramLookup=new Map,this.linkChartExtent=new ce({xmin:-1e-7,ymin:-1e-7,xmax:1e-7,ymax:1e-7}),this.memberEntityTypes=null,this.memberRelationshipTypes=null,this.operationalLayerType="LinkChartLayer",this.sublayerIdsCache=new Map,this.tables=new($.ofType(K)),this.type="link-chart",this.chronologicalAuxiliaryGraphics=null,this._originalInclusionList=e?.initializationInclusionModeDefinition,e?.dataPreloadedInLocalCache&&!e?.initializationInclusionModeDefinition)throw new Y("knowledge-graph:linkchart-layer-constructor","If creating a link chart composite layer and configured that data is already loaded in the cache, you must specify an inclusion list so the Composite Layer knows what records belong to it");this.addHandles(ve(()=>this.layers.concat(this.tables),(a,i)=>this._handleSublayersChange(a,i),Ie))}normalizeCtorArgs(e){if(!e)return{};let{url:a,title:i,dataPreloadedInLocalCache:n,initializationLinkChartConfig:t}=e;return{url:a,title:i,dataPreloadedInLocalCache:n,initializationLinkChartConfig:t}}_initializeLayerProperties(e){if(!this.title&&this.url){let o=this.url.split("/");this.title=o[o.length-2]}let a=new Set,i=[],n=[];if(e.inclusionModeDefinition&&(!e.inclusionModeDefinition.namedTypeDefinitions||e.inclusionModeDefinition.namedTypeDefinitions.size<1))throw new Y("knowledge-graph:composite-layer-constructor","If an explicit inclusion definition is defined, at least one namedTypeDefinition must also be defined");e.inclusionModeDefinition?.generateAllSublayers?(i=e.knowledgeGraph.dataModel.entityTypes??[],n=e.knowledgeGraph.dataModel.relationshipTypes??[]):e.inclusionModeDefinition?.namedTypeDefinitions&&e.inclusionModeDefinition?.namedTypeDefinitions.size>0?e.inclusionModeDefinition?.namedTypeDefinitions.forEach((o,h)=>{let d=this._graphTypeLookup.get(h);if(!d)return E.getLogger(this).warn(`A named type, ${h}, was in the inclusion list that wasn't in the data model and will be removed`),void e.inclusionModeDefinition?.namedTypeDefinitions.delete(h);d.type==="relationship"?a.has(h)||(a.add(h),n.push(d)):d.type==="entity"?a.has(h)||(a.add(h),i.push(d)):(E.getLogger(this).warn(`A named type, ${h}, was in the inclusion list that wasn't properly modeled and will be removed`),e.inclusionModeDefinition?.namedTypeDefinitions.delete(h))}):(i=e.knowledgeGraph.dataModel.entityTypes??[],n=e.knowledgeGraph.dataModel.relationshipTypes??[]);let t=new Ke({knowledgeGraph:e.knowledgeGraph,inclusionModeDefinition:e.inclusionModeDefinition});this.knowledgeGraph=e.knowledgeGraph,this.memberEntityTypes=i,this.memberRelationshipTypes=n,this.dataManager=t}load(e){let a=()=>D(this,null,function*(){let i=[],n=[];this.loadLayerAssumingLocalCache(),this._layersLoadedFromAuthoritativeItem()||(yield ge(this)),this.dataManager.inclusionModeDefinition&&(this.dataManager.inclusionModeDefinition.generateAllSublayers=!1),this.dataManager.inclusionModeDefinition?.namedTypeDefinitions.forEach(t=>{t.useAllData=!1}),yield this._initializeDiagram(),this.layers.forEach(t=>{n.push(t.refreshCachedQueryEngine()),i.push(new Promise(o=>{t.on("layerview-create",()=>{o(null)})}))}),this.tables.forEach(t=>{n.push(t.refreshCachedQueryEngine())}),yield Promise.all(n)});return this.addResolvingPromise(new Promise(i=>{_e(this.url).then(n=>D(this,null,function*(){n.dataModel.entityTypes?.forEach(o=>{o.name&&this._graphTypeLookup.set(o.name,o)}),n.dataModel.relationshipTypes?.forEach(o=>{o.name&&this._graphTypeLookup.set(o.name,o)});let t=this.linkChart?.linkChartProperties;if(t?.originIdOf("entitiesUrl")===H.LINK_CHART&&(this.membershipModified=!1,this._originalInclusionList=yield Fe.fetchAndConvertSerializedLinkChart({entitiesUrl:t?.entitiesUrl,relationshipsUrl:t?.relationshipsUrl}),this._alignLayersDataModelAndInclusionDefinition(n.dataModel),this.initializationLinkChartConfig={layoutSettings:t?.layoutSettings??void 0,layoutMode:Ve(t.layoutType)}),this._initializeLayerProperties({knowledgeGraph:n,inclusionModeDefinition:this._originalInclusionList}),this.dataManager.inclusionModeDefinition?.namedTypeDefinitions?.size||(this.dataManager.inclusionModeDefinition={generateAllSublayers:!1,namedTypeDefinitions:new Map},this.dataManager.knowledgeGraph.dataModel.entityTypes?.forEach(o=>{o.name&&this.dataManager.inclusionModeDefinition?.namedTypeDefinitions.set(o.name,{useAllData:!0})}),this.dataManager.knowledgeGraph.dataModel.relationshipTypes?.forEach(o=>{o.name&&this.dataManager.inclusionModeDefinition?.namedTypeDefinitions.set(o.name,{useAllData:!0})})),this.dataPreloadedInLocalCache){let o=Ge.getInstance();for(let[h,d]of this.dataManager.inclusionModeDefinition?.namedTypeDefinitions??[])for(let y of d.members?.values()??[]){let m=o.readFromStoreById(`${h}__${y.id}`);m&&j(this.dataManager.sublayerCaches,h,()=>new Map).set(y.id,m)}yield a()}else{let o=this.initializationLinkChartConfig?.layoutMode==="geographic-organic-standard";this.addResolvingPromise(this.dataManager.refreshCacheContent(void 0,!1,o,!0).then(()=>D(this,null,function*(){Q(e),yield a()})))}i(null)}))})),Promise.resolve(this)}set initializationInclusionModeDefinition(e){this.loadStatus!=="loaded"&&this.loadStatus!=="failed"?this._set("initializationInclusionModeDefinition",e):E.getLogger(this).error("#initializationInclusionModeDefinition","initializationInclusionModeDefinition cannot be changed after the layer is loaded.")}get linkChart(){return this.parent}addRecords(e,a){return D(this,null,function*(){let i=[];a?.cascadeAddRelationshipEndNodes&&this.dataManager.knowledgeGraph.dataModel&&(i=yield $e(e,this.dataManager.knowledgeGraph));let n=e.concat(i).filter(t=>!this.sublayerIdsCache.get(t.typeName)?.has(t.id));n.length>0&&(this.membershipModified=!0),yield this._handleNewRecords(n,a)})}removeRecords(t){return D(this,arguments,function*(e,{cascadeRemoveRelationships:a=!0,recalculateLayout:i=!1,overrideMembershipCheck:n=!1}={cascadeRemoveRelationships:!0,recalculateLayout:!1,overrideMembershipCheck:!1}){let o=[];for(let d of e)(n||this.dataManager.inclusionModeDefinition?.namedTypeDefinitions?.get(d.typeName)?.useAllData===!1&&this.dataManager.inclusionModeDefinition?.namedTypeDefinitions?.get(d.typeName)?.members?.has(d.id))&&o.push(d);if(a){let d=new Set,y=[];for(let m of o)if(this.dataManager.nodeConnectionsLookup.has(m.id))for(let g of this.dataManager.nodeConnectionsLookup.get(m.id))d.add(g);for(let m of d)if(this.dataManager.memberIdTypeLookup.has(m))for(let g of this.dataManager.memberIdTypeLookup.get(m))this.dataManager.relationshipTypeNames.has(g)&&y.push({id:m,typeName:g});o=o.concat(y)}this.dataManager.removeFromLayer(o);for(let d of o)this.sublayerIdsCache.get(d.typeName)?.delete(d.id),this.dataManager.relationshipTypeNames.has(d.typeName)?this.relationshipLinkChartDiagramLookup.delete(d.id):this.entityLinkChartDiagramLookup.delete(d.id);i&&(yield this._calculateLayoutWithSublayerTimeInfo(this._currentLinkChartConfig.layoutMode,{layoutSettings:this._currentLinkChartConfig.layoutSettings})),o.length>0&&(this.membershipModified=!0);let h=[];return this.layers.forEach(d=>{h.push(d.refreshCachedQueryEngine())}),yield Promise.all(h),this._refreshNamedTypes(),o})}expand(e,a){return D(this,null,function*(){let i=[];try{let n=yield this.dataManager.getConnectedRecordIds(e,a?.relationshipTypeNames,a);i=n.filter(t=>!this.sublayerIdsCache.get(t.typeName)?.has(t.id)),yield this._handleNewRecords(n,a),n.length>0&&(this.membershipModified=!0),Q(a?.signal)}catch(n){throw ne(n)&&i.length>0&&this.removeRecords(i,{overrideMembershipCheck:!0}),n}return{records:i}})}loadLayerAssumingLocalCache(){let e=[...this.memberRelationshipTypes,...this.memberEntityTypes];this.originIdOf("layers")===H.DEFAULTS?this._createSublayers(e,this.layers,a=>!!a.geometryType):this._updateSublayers(e,this.layers),this.originIdOf("tables")===H.DEFAULTS?this._createSublayers(e,this.tables,a=>!a.geometryType):this._updateSublayers(e,this.tables),this.dataManager.inclusionModeDefinition?.namedTypeDefinitions?.forEach((a,i)=>{let n=j(this.sublayerIdsCache,i,()=>new Set);a.members?.forEach(({id:t,linkChartLocation:o})=>{if(n.add(t),o){let h="coords"in o&&"lengths"in o?o:V(o);this.dataManager.relationshipTypeNames.has(i)?this.relationshipLinkChartDiagramLookup.set(t,h):this.entityLinkChartDiagramLookup.set(t,h)}})})}calculateLinkChartLayout(e="organic-standard",a){return D(this,null,function*(){let i=[],n=[],t=[];this.dataManager.sublayerCaches.forEach((s,l)=>{this.dataManager.entityTypeNames.has(l)?s.forEach(r=>{i.push({typeName:l,feature:r})}):this.dataManager.relationshipTypeNames.has(l)&&s.forEach(r=>{n.push({typeName:l,feature:r})})}),this.entityLinkChartDiagramLookup=new Map,this.relationshipLinkChartDiagramLookup=new Map;let o=new Map,h=new Map,d=new Map,y=new Map,m=new Uint8Array(i.length),g=new Float64Array(i.length),b=new Float64Array(i.length),W=new Float64Array(i.length),A=new Float64Array(i.length),k=new Uint32Array(n.length),se=new Uint32Array(n.length),fe=new Float64Array(n.length),Le=new Float64Array(n.length),c=[],Je="organic-standard",S=new ce({xmin:-1e-7,ymin:-1e-7,xmax:1e-7,ymax:1e-7}),P,be="organic-standard",u=0,v=0,Xe=Qe.apply;switch(be=e==="geographic-organic-standard"?Je:e,be){case"organic-standard":P=Pe.apply;break;case"organic-community":P=Be.apply;break;case"hierarchical-bottom-to-top":P=je.apply;break;case"radial-root-centric":P=We.apply;break;case"tree-left-to-right":P=He.apply;break;default:P=Ue.apply}let re=!1;i.forEach(({typeName:s,feature:l})=>{if(e!=="chronological-mono-timeline"&&e!=="chronological-multi-timeline"&&a?.lockedNodeLocations?.has(l.attributes[M])){e==="geographic-organic-standard"&&this.dataManager.geographicLookup.has(s)?m[u]=R.IsGeographic:m[u]=R.None;let r=a.lockedNodeLocations.get(l.attributes[M]);g[u]=r.x,b[u]=r.y}else if(e==="geographic-organic-standard"&&this.dataManager.geographicLookup.has(s)){m[u]=R.IsGeographic;let r=null,T=l.attributes[this.dataManager.geographicLookup.get(s).name];switch(this.dataManager.geographicLookup.get(s)?.geometryType){case"esriGeometryPoint":g[u]=T?.x,b[u]=T?.y;break;case"esriGeometryPolygon":r=T?.centroid,r?.x!=null&&r?.y!=null?(g[u]=r.x,b[u]=r.y):m[u]=R.IsMovable;break;case"esriGeometryPolyline":case"esriGeometryMultipoint":r=T?.extent?.center,r?.x!=null&&r?.y!=null?(g[u]=r.x,b[u]=r.y):m[u]=R.IsMovable;break;default:m[u]=R.IsMovable}(g[u]==null||b[u]==null||Number.isNaN(g[u])||Number.isNaN(b[u]))&&(m[u]=R.IsMovable,g[u]=0,b[u]=0)}else if(e==="chronological-mono-timeline"||e==="chronological-multi-timeline"){!re&&a?.lockedNodeLocations?.has(l.attributes[M])&&(re=!0);let r=a?.timeInfoByTypeName?.get(s),T=r?.startField,F=T&&r?.startField?l.attributes[T]:null;W[u]=F?new Date(F).getTime():NaN;let N=r?.endField,x=N&&r?.endField?l.attributes[N]:null;A[u]=x?new Date(x).getTime():NaN,g[u]=0,b[u]=0,m[u]=R.IsMovable}else m[u]=R.IsMovable,g[u]=0,b[u]=0;y.set(l.attributes[M],u),c[u]={feature:l,typeName:s},u++}),re&&E.getLogger(this).warn("Locked node locations are not supported for chronological layout at this time.  Requested node locations were ignored");let we=!1,le=new Map;n.forEach(s=>{let l=s.feature.attributes[Z],r=s.feature.attributes[ee],T=y.get(l),F=y.get(r),N=a?.timeInfoByTypeName?.get(s.typeName),x=a?.timeInfoByTypeName?N?.startField:null,z=x?s.feature.attributes[x]:null,ie=N?.endField,B=ie?s.feature.attributes[ie]:null;if(T!==void 0&&F!==void 0){let G=l+"-"+r;e!=="chronological-mono-timeline"&&e!=="chronological-multi-timeline"||(G=G+"-"+z+"-"+B);let X=le.get(G);X?.has(s.typeName)||(k[v]=T,se[v]=F,e!=="chronological-mono-timeline"&&e!=="chronological-multi-timeline"||(fe[v]=z?new Date(z).getTime():NaN,Le[v]=B?new Date(B).getTime():NaN),X===void 0?le.set(G,new Map([[s.typeName,v]])):X.set(s.typeName,v),v++),t.push(s)}else we=!0,this.relationshipLinkChartDiagramLookup.set(l,null)}),we&&E.getLogger(this).warn("A relationship is a member of this layer that has either origin or destination entity nodes that are not members. The diagram geometry will be set to null");let Ye=this._validateOrganicLayoutSettings(e,a?.layoutSettings?.organicLayoutSettings),he=this._convertValidatedOrganicSettingsToCalculationSettings(Ye);yield Oe();let J=te.Error,I=null;if(e==="chronological-mono-timeline"||e==="chronological-multi-timeline"){let s;({status:J,links:I,graphics:s}=Xe(()=>a?.signal?.aborted??!1,m,g,b,W,A,k.subarray(0,v),se.subarray(0,v),fe.subarray(0,v),Le.subarray(0,v),e==="chronological-multi-timeline",a?.layoutSettings?.chronologicalLayoutSettings)),J===te.Success&&(this.chronologicalAuxiliaryGraphics=s)}else({status:J,links:I}=P(()=>a?.signal?.aborted??!1,m,g,b,k.subarray(0,v),se.subarray(0,v),he.computationBudgetTime,he.idealEdgeLengthMultiplier,he.repulsionRadiusMultiplier));if(Q(a?.signal),J===te.Error)throw new Y("knowledge-graph:layout-failed","Attempting to arrange the records in the specified layout failed");if(J===te.Canceled)throw Ne();for(let s=0;s<c.length;s++){if(b[s]>84.9999?b[s]=84.9999:b[s]<-84.9999&&(b[s]=-84.9999),g[s]>179.9999?g[s]=179.9999:g[s]<-179.9999&&(g[s]=-179.9999),c[s].feature.attributes[C]=new oe(g[s],b[s]),o.has(c[s].typeName))o.get(c[s].typeName)?.set(c[s].feature.attributes[M],c[s].feature);else{let T=new Map;T.set(c[s].feature.attributes[M],c[s].feature),o.set(c[s].typeName,T)}d.set(c[s].feature.attributes[M],c[s].feature);let l=V(c[s].feature.attributes[C]);this.entityLinkChartDiagramLookup.set(c[s].feature.attributes[M],c[s].feature.attributes[C]?l:null);let r=j(this.dataManager.inclusionModeDefinition.namedTypeDefinitions,c[s].typeName,()=>({useAllData:!1,members:new Map}));j(r.members,c[s].feature.attributes[M],()=>({id:c[s].feature.attributes[M],linkChartLocation:void 0})).linkChartLocation=c[s].feature.attributes[C],c[s].feature.attributes[C].x<S.xmin&&(S.xmin=c[s].feature.attributes[C].x),c[s].feature.attributes[C].x>S.xmax&&(S.xmax=c[s].feature.attributes[C].x),c[s].feature.attributes[C].y<S.ymin&&(S.ymin=c[s].feature.attributes[C].y),c[s].feature.attributes[C].y>S.ymax&&(S.ymax=c[s].feature.attributes[C].y)}if(this.linkChartExtent.xmin=S.xmin,this.linkChartExtent.xmax=S.xmax,this.linkChartExtent.ymin=S.ymin,this.linkChartExtent.ymax=S.ymax,!I)throw new Y("knowledge-graph:layout-failed","Attempting to retrieve link geometry from diagram engine failed");let ae=new Map,de=new Map,pe=new Map,Me=new Set;for(let s=0;s<t.length;s++){let l=[],r=t[s],T=r.feature.attributes[Z],F=r.feature.attributes[ee],N=T+"-"+F;if(e==="chronological-mono-timeline"||e==="chronological-multi-timeline"){let p=a?.timeInfoByTypeName?.get(r.typeName),_=a?.timeInfoByTypeName?p?.startField:null,O=_?r.feature.attributes[_]:null,U=p?.endField;N+="-"+O+"-"+(U?r.feature.attributes[U]:null)}let x=le.get(N).get(r.typeName),z=x===0?0:I?.vertexEndIndex[x-1];if(!Me.has(x)){if(Me.add(x),I.types[x]===me.Recursive){let p=[I.vertices[2*z],I.vertices[2*z+1]],_=[I.vertices[2*(z+1)],I.vertices[2*(z+1)+1]],O=[.5*(p[0]+_[0]),.5*(p[1]+_[1])],U=[O[0]-p[0],O[1]-p[1]],et=[O[0]+U[1],O[1]-U[0]],tt=[O[0]-U[1],O[1]+U[0]];l.push(p),l.push(et),l.push(_),l.push(tt),l.push(p)}else{if(I.types[x]!==me.Regular){E.getLogger(this).warn("A relationship generated an unsupported link geometry type.  It will not be rendered");continue}for(let p=z;p<I.vertexEndIndex[x];p++)l.push([I.vertices[2*p],I.vertices[2*p+1]])}if(e!=="chronological-mono-timeline"&&e!=="chronological-multi-timeline"){let p=c[y.get(T)]?.feature.attributes[C],_=c[y.get(F)]?.feature.attributes[C];l[0][0]===p.x&&l[0][1]===p.y||(l[0]=[p.x,p.y]),l[l.length-1][0]===_.x&&l[l.length-1][1]===_.y||(l[l.length-1]=[_.x,_.y])}for(let p=1;p<l.length-1;p++)l[p][1]>85.5?l[p][1]=85.5:l[p][1]<-85.5&&(l[p][1]=-85.5),l[p][0]>179.9999?l[p][0]=179.9999:l[p][0]<-179.9999&&(l[p][0]=-179.9999);ae.has(N)?ae.get(N).push(l):ae.set(N,[l])}let ie=ae.get(N);de.has(N)||(de.set(N,new Map),pe.set(N,new Map));let B=de.get(N),G=pe.get(N);B.has(r.typeName)||(B.set(r.typeName,ie.shift()),G.set(r.typeName,0));let X=B.get(r.typeName);G.set(r.typeName,G.get(r.typeName)+1);let Ce=new ye({paths:[X]});if(r.feature.attributes[C]=Ce,h.has(r.typeName))h.get(r.typeName)?.set(r.feature.attributes[M],r.feature);else{let p=new Map;p.set(r.feature.attributes[M],r.feature),h.set(r.typeName,p)}d.set(r.feature.attributes[M],r.feature);let ke=V(r.feature.attributes[C]);this.relationshipLinkChartDiagramLookup.set(r.feature.attributes[M],r.feature.attributes[C]?ke:null);let Ze=j(this.dataManager.inclusionModeDefinition.namedTypeDefinitions,r.typeName,()=>({useAllData:!1,members:new Map}));j(Ze.members,r.feature.attributes[M],()=>({id:r.feature.attributes[M],linkChartLocation:void 0})).linkChartLocation=ke}for(let s of t)s.feature.attributes[ze]=pe.get(s.feature.attributes[Z]+"-"+s.feature.attributes[ee])?.get(s.typeName)??null;return this._currentLinkChartConfig={layoutMode:e,layoutSettings:a?.layoutSettings?.clone()},{nodes:o,links:h,idMap:d}})}applyNewLinkChartLayout(e="organic-standard",a){return D(this,null,function*(){let i=[];yield this._calculateLayoutWithSublayerTimeInfo(e,a),this.layers.forEach(n=>{i.push(n.refreshCachedQueryEngine())}),this.membershipModified=!0,yield Promise.all(i),this._refreshNamedTypes()})}getCurrentNodeLocations(){let e=new Map;for(let[a,i]of this.dataManager.inclusionModeDefinition?.namedTypeDefinitions.entries()??[])this.dataManager.relationshipTypeNames.has(a)||i?.members?.forEach(n=>{let t=n.linkChartLocation,o,h=n.id;t&&(o="x"in t?{x:t.x,y:t.y}:{x:t.coords[0],y:t.coords[1]},e.set(h,new oe({x:o.x,y:o.y})))});return e}refreshLinkChartCache(e){return D(this,null,function*(){yield this.dataManager.refreshCacheContent(e);let a=[];this.layers.forEach(i=>{a.push(i.refreshCachedQueryEngine())}),yield Promise.all(a),this._refreshNamedTypes()})}connectBetweenEntities(e,a){return D(this,null,function*(){if(!e.length)return{records:[]};let i=[];try{let n=[];for(let t of this.dataManager.relationshipTypeNames){let o=this.sublayerIdsCache.get(t);o&&(n=n.concat(Array.from(o.keys())))}i=yield this.dataManager.getRelationshipsBetweenNodes(e,n,a),yield this._handleNewRecords(i,a),Q(a)}catch(n){throw ne(n)&&this.removeRecords(i),n}return{records:i}})}connectFromEntities(e,a){return D(this,null,function*(){if(!e.length)return{records:[]};let i=[];try{let n=[];for(let o of this.dataManager.relationshipTypeNames){let h=this.sublayerIdsCache.get(o);h&&(n=n.concat(Array.from(h.keys())))}let t=[];for(let o of this.dataManager.entityTypeNames){let h=this.sublayerIdsCache.get(o);h&&(t=t.concat(Array.from(h)))}i=yield this.dataManager.getRelationshipsFromNodes(e,t,n,a),yield this._handleNewRecords(i,a),i.length>0&&(this.membershipModified=!0),Q(a)}catch(n){throw ne(n)&&this.removeRecords(i),n}return{records:i}})}getCurrentLayout(){return this._currentLinkChartConfig.layoutMode}_calculateLayoutWithSublayerTimeInfo(e="organic-standard",a){return D(this,null,function*(){let i=new Map;this.layers.forEach(n=>{i.set(n.objectType.name,n.timeInfo)}),yield this.calculateLinkChartLayout(e,ue({timeInfoByTypeName:i},a)),this.linkChart?.handleChronologicalOverlay()})}_handleNewRecords(e,a){return D(this,null,function*(){let i=[];this.dataManager.addToLayer(e);for(let t of e)this.sublayerIdsCache.has(t.typeName)||(this.sublayerIdsCache.set(t.typeName,new Set),i.push(t.typeName)),this.sublayerIdsCache.get(t.typeName).add(t.id);for(let t of i){let o=this._graphTypeLookup.get(t);if(o){let h=this._createSublayer(o);o.type==="entity"?this.dataManager.entityTypeNames.add(t):this.dataManager.relationshipTypeNames.add(t),h.geometryType?this.layers.push(h):this.tables.push(h),this.dataManager.sublayerCaches.set(t,new Map)}}yield ge(this,i,a),yield this.dataManager.refreshCacheContent(e.map(t=>t.id),void 0,void 0,void 0,a);let n={layoutSettings:this._currentLinkChartConfig.layoutSettings,lockedNodeLocations:new Map};for(let[t,o]of this.entityLinkChartDiagramLookup.entries())o&&n.lockedNodeLocations.set(t,new oe(o.coords[0],o.coords[1]));yield this.applyNewLinkChartLayout(this._currentLinkChartConfig.layoutMode,n)})}_createSublayers(e,a,i){e.forEach(n=>{let t=this._createSublayer(n);i(t)&&a.push(t),this._updateSublayerCaches(n)})}_updateSublayers(e,a){a.forEach(i=>{i.parentCompositeLayer=this;let n=e.find(t=>t.type===i.graphType&&t.name===i.graphTypeName);n&&(i.objectType=n,i.read({title:n.name},{origin:"service"}),this._updateSublayerCaches(n))})}_updateSublayerCaches(e){let a=this.dataManager.sublayerCaches;a.has(e.name)||a.set(e.name,new Map)}_layersLoadedFromAuthoritativeItem(){let e=this.originIdOf("layers");return e>=H.PORTAL_ITEM&&e<H.USER}_initializeDiagram(){return D(this,null,function*(){this.initializationLinkChartConfig?this.initializationLinkChartConfig.doNotRecalculateLayout?(this.dataManager.inclusionModeDefinition?.namedTypeDefinitions?.forEach((e,a)=>{e?.members?.forEach(i=>{let n=i.linkChartLocation,t,o=i.id;if(!n)return;t="x"in n?{x:n.x,y:n.y}:{x:n.coords[0],y:n.coords[1]};let h=V(t);this.dataManager.relationshipTypeNames.has(a)?this.relationshipLinkChartDiagramLookup.set(o,h):this.entityLinkChartDiagramLookup.set(o,h),this.linkChartExtent.xmin>t.x&&(this.linkChartExtent.xmin=t.x),this.linkChartExtent.xmax<t.x&&(this.linkChartExtent.xmax=t.x),this.linkChartExtent.ymin>t.y&&(this.linkChartExtent.ymin=t.y),this.linkChartExtent.ymax<t.y&&(this.linkChartExtent.ymax=t.y)})}),this.memberRelationshipTypes.forEach(e=>{e.name&&this.dataManager.sublayerCaches.get(e.name)?.forEach(a=>{let i=this.relationshipLinkChartDiagramLookup.get(a.attributes[Z]),n=this.relationshipLinkChartDiagramLookup.get(a.attributes[ee]);if(i&&n){let t=V(new ye({paths:[[[i.coords[0],i.coords[1]],[n.coords[0],n.coords[1]]]]}));this.relationshipLinkChartDiagramLookup.set(a.attributes[M],t)}else this.relationshipLinkChartDiagramLookup.set(a.attributes[M],null)})})):yield this._calculateLayoutWithSublayerTimeInfo(this.initializationLinkChartConfig.layoutMode,ue({lockedNodeLocations:this.getCurrentNodeLocations()},this.initializationLinkChartConfig||{})):yield this._calculateLayoutWithSublayerTimeInfo("organic-standard",{lockedNodeLocations:this.getCurrentNodeLocations()})})}_refreshNamedTypes(){for(let e of this.layers)e.emit("refresh",{dataChanged:!0});for(let e of this.tables)e.emit("refresh",{dataChanged:!0})}_validateOrganicLayoutSettings(e,a){let i=k=>typeof k=="number"&&!isNaN(k),n=k=>i(k)&&k>=1,t=k=>i(k)&&k>=1,o=k=>Object.values(q).includes(k),h=k=>i(k)&&k>=0,d={};if(!new Set(["organic-standard","organic-community","geographic-organic-standard","chronological-multi-timeline","chronological-mono-timeline"]).has(e)||!a)return d;let{computationBudgetTime:y,autoRepulsionRadius:m,repulsionRadiusMultiplier:g,absoluteIdealEdgeLength:b,multiplicativeIdealEdgeLength:W,idealEdgeLengthType:A}=a;return t(y)?d.computationBudgetTime=y:y&&E.getLogger(this).warn("Invalid layout computationBudgetTime setting, will revert to default setting"),d.autoRepulsionRadius=m,!m&&n(g)?d.repulsionRadiusMultiplier=g:m||(d.autoRepulsionRadius=!0,E.getLogger(this).warn("Invalid layout repulsionRadiusMultiplier setting, will revert to default setting")),e==="geographic-organic-standard"&&(o(A)?d.idealEdgeLengthType=A:A!==void 0&&E.getLogger(this).warn('Invalid layout idealEdgeLengthType setting, will revert to "multiplier" setting'),A==="absolute-value"&&h(b)?d.absoluteIdealEdgeLength=b:A==="absolute-value"&&b!==void 0?E.getLogger(this).warn("Invalid layout idealEdgeLength setting, will revert to default setting"):A==="multiplier"&&h(W)?d.multiplicativeIdealEdgeLength=W:A==="multiplier"&&W!==void 0&&E.getLogger(this).warn("Invalid layout idealEdgeLength setting, will revert to default setting")),d}_convertValidatedOrganicSettingsToCalculationSettings(e){let a=e.idealEdgeLengthType===q.ABSOLUTE?e.absoluteIdealEdgeLength:e.multiplicativeIdealEdgeLength;return e.idealEdgeLengthType===q.ABSOLUTE&&(a===void 0?a=-1:a*=-1),{computationBudgetTime:e.computationBudgetTime??void 0,repulsionRadiusMultiplier:e.repulsionRadiusMultiplier&&!e.autoRepulsionRadius?e.repulsionRadiusMultiplier:void 0,idealEdgeLengthMultiplier:a}}_createSublayer(e){return new K({objectType:e,parentCompositeLayer:this,graphType:e.type})}_handleSublayersChange(e,a){a&&(a.forEach(i=>{i.parent=null}),this.removeHandles("sublayers-owner")),e&&(e.forEach(i=>{i.parent=this}),this.addHandles([e.on("after-add",({item:i})=>{i.parent=this}),e.on("after-remove",({item:i})=>{i.parent=null})],"sublayers-owner"))}_alignLayersDataModelAndInclusionDefinition(e){let a=new Set((e.entityTypes??[]).map(t=>t.name).concat((e.relationshipTypes??[]).map(t=>t.name))),i=new Set((e.entityTypes??[]).map(t=>t.name)),n=new Set((e.relationshipTypes??[]).map(t=>t.name));if(this.layers){for(let o of this.layers)!o.graphType&&a.has(o.graphTypeName)&&(o.graphType=i.has(o.graphTypeName)?"entity":"relationship");let t=this.layers.filter(o=>a.has(o.graphTypeName)&&(o.graphType==="entity"?i.has(o.graphTypeName):n.has(o.graphTypeName)));this.setAtOrigin("layers",t,Te(this.originIdOf("layers")))}else this.layers=new $;if(this.layers&&this._originalInclusionList){let t=new Set(this._originalInclusionList.namedTypeDefinitions.keys()),o=this.tables?.map(y=>y.graphTypeName)??[],h=this.layers.map(y=>y.graphTypeName).concat(o);for(let y of h)t.has(y)||this._originalInclusionList.namedTypeDefinitions.set(y,{useAllData:!1,members:new Map});let d=[];for(let y of this._originalInclusionList.namedTypeDefinitions.keys())h.includes(y)||(E.getLogger(this).warn(`A named type, ${y}, was in the serialized feature collection but did not have a sublayer config in the item, so will be removed`),d.push(y));for(let y of d)this._originalInclusionList.namedTypeDefinitions.delete(y)}}};L([w(Ae)],f.prototype,"url",void 0),L([w()],f.prototype,"dataPreloadedInLocalCache",void 0),L([w()],f.prototype,"initializationLinkChartConfig",void 0),L([w()],f.prototype,"membershipModified",void 0),L([w()],f.prototype,"dataManager",void 0),L([w()],f.prototype,"initializationInclusionModeDefinition",null),L([w()],f.prototype,"knowledgeGraph",void 0),L([w({type:$.ofType(K),json:{write:{ignoreOrigin:!0}}})],f.prototype,"layers",void 0),L([w({readOnly:!0})],f.prototype,"linkChart",null),L([w()],f.prototype,"entityLinkChartDiagramLookup",void 0),L([w()],f.prototype,"relationshipLinkChartDiagramLookup",void 0),L([w()],f.prototype,"linkChartExtent",void 0),L([w()],f.prototype,"memberEntityTypes",void 0),L([w()],f.prototype,"memberRelationshipTypes",void 0),L([w({type:["LinkChartLayer"]})],f.prototype,"operationalLayerType",void 0),L([w()],f.prototype,"sublayerIdsCache",void 0),L([w({type:$.ofType(K),json:{write:{ignoreOrigin:!0}}})],f.prototype,"tables",void 0),L([w({json:{read:!1}})],f.prototype,"type",void 0),L([w({json:{read:!1}})],f.prototype,"chronologicalAuxiliaryGraphics",void 0),f=L([De("esri.layers.LinkChartLayer")],f);var Ft=f;export{Ft as default};
