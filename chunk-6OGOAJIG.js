import{a as k,b as C,c as I,e as V}from"./chunk-S6VNWKM3.js";import{a as v}from"./chunk-V54VBJP6.js";import{a as w}from"./chunk-ST5H7ZTW.js";import{b as A}from"./chunk-GHDQGSQR.js";function J(i,o,f,c){let{rendererJSON:d,isRGBRenderer:p}=i,t=null,n=null;if(o&&p)t=o;else if(o&&d?.type==="pointCloudUniqueValueRenderer"){n=A.fromJSON(d);let e=n.colorUniqueValueInfos;t=new Uint8Array(3*c);let a=g(n.fieldTransformType);for(let r=0;r<c;r++){let s=(a?a(o[r]):o[r])+"";for(let l=0;l<e.length;l++)if(e[l].values.includes(s)){t[3*r]=e[l].color.r,t[3*r+1]=e[l].color.g,t[3*r+2]=e[l].color.b;break}}}else if(o&&d?.type==="pointCloudStretchRenderer"){n=w.fromJSON(d);let e=n.stops;t=new Uint8Array(3*c);let a=g(n.fieldTransformType);for(let r=0;r<c;r++){let s=a?a(o[r]):o[r],l=e.length-1;if(s<e[0].value)t[3*r]=e[0].color.r,t[3*r+1]=e[0].color.g,t[3*r+2]=e[0].color.b;else if(s>=e[l].value)t[3*r]=e[l].color.r,t[3*r+1]=e[l].color.g,t[3*r+2]=e[l].color.b;else for(let u=1;u<e.length;u++)if(s<e[u].value){let m=(s-e[u-1].value)/(e[u].value-e[u-1].value);t[3*r]=e[u].color.r*m+e[u-1].color.r*(1-m),t[3*r+1]=e[u].color.g*m+e[u-1].color.g*(1-m),t[3*r+2]=e[u].color.b*m+e[u-1].color.b*(1-m);break}}}else if(o&&d?.type==="pointCloudClassBreaksRenderer"){n=v.fromJSON(d);let e=n.colorClassBreakInfos;t=new Uint8Array(3*c);let a=g(n.fieldTransformType);for(let r=0;r<c;r++){let s=a?a(o[r]):o[r];for(let l=0;l<e.length;l++)if(s>=e[l].minValue&&s<=e[l].maxValue){t[3*r]=e[l].color.r,t[3*r+1]=e[l].color.g,t[3*r+2]=e[l].color.b;break}}}else t=new Uint8Array(3*c).fill(255);if(f&&n?.colorModulation){let e=n.colorModulation.minValue,a=n.colorModulation.maxValue,r=.3;for(let s=0;s<c;s++){let l=f[s],u=l>=a?1:l<=e?r:r+(1-r)*(l-e)/(a-e);t[3*s]=u*t[3*s],t[3*s+1]=u*t[3*s+1],t[3*s+2]=u*t[3*s+2]}}return t}function N(i,o){if(i.encoding==null||i.encoding===""){let f=I(o,i);if(f.vertexAttributes.position==null)return;let c=C(o,f.vertexAttributes.position),d=f.header.fields,p=[d.offsetX,d.offsetY,d.offsetZ],t=[d.scaleX,d.scaleY,d.scaleZ],n=c.length/3,e=new Float64Array(3*n);for(let a=0;a<n;a++)e[3*a]=c[3*a]*t[0]+p[0],e[3*a+1]=c[3*a+1]*t[1]+p[1],e[3*a+2]=c[3*a+2]*t[2]+p[2];return e}if(i.encoding==="lepcc-xyz")return k(o).result}function q(i,o,f){return i?.attributeInfo.useElevation?o?S(o,f):null:i?.attributeInfo.storageInfo?V(i.attributeInfo.storageInfo,i.buffer,f):null}function S(i,o){let f=new Float64Array(o);for(let c=0;c<o;c++)f[c]=i[3*c+2];return f}function G(i,o,f,c,d){let p=i.length/3,t=0;for(let n=0;n<p;n++){let e=!0;for(let a=0;a<c.length&&e;a++){let{filterJSON:r}=c[a],s=d[a].values[n];switch(r.type){case"pointCloudValueFilter":{let l=r.mode==="exclude";r.values.includes(s)===l&&(e=!1);break}case"pointCloudBitfieldFilter":{let l=x(r.requiredSetBits),u=x(r.requiredClearBits);((s&l)!==l||s&u)&&(e=!1);break}case"pointCloudReturnFilter":{let l=15&s,u=s>>>4&15,m=u>1,R=l===1,y=l===u,h=!1;for(let b of r.includedReturns)if(b==="last"&&y||b==="firstOfMany"&&R&&m||b==="lastOfMany"&&y&&m||b==="single"&&!m){h=!0;break}h||(e=!1);break}}}e&&(f[t]=n,i[3*t]=i[3*n],i[3*t+1]=i[3*n+1],i[3*t+2]=i[3*n+2],o[3*t]=o[3*n],o[3*t+1]=o[3*n+1],o[3*t+2]=o[3*n+2],t++)}return t}function g(i){switch(i){default:case null:case"none":return o=>o;case"low-four-bit":return o=>15&o;case"high-four-bit":return o=>(240&o)>>4;case"absolute-value":return o=>Math.abs(o);case"modulo-ten":return o=>o%10}}function x(i){let o=0;for(let f of i||[])o|=1<<f;return o}export{J as a,N as b,q as c,S as d,G as e};
