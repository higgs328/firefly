import{n as U,p as W,q as J}from"./chunk-KWZXPJFQ.js";import{a as b,b as V,c as q,d as B}from"./chunk-HUVZNPUP.js";import"./chunk-EZ6BVWLO.js";import{$ as D,B as y,Ba as o,Ca as E,Db as m,Ea as i,Fb as N,I as f,K as h,Lb as A,Mb as k,Nb as M,O as I,_ as O,ac as Z,bc as v,cc as _,ea as T,eb as x,g as c,h as L,ka as n,m as w,mb as R,qb as l,ra as C,ua as P,ub as j}from"./chunk-JXA3LZZ7.js";var G=(()=>{class r{mapService=n(b);zone=n(E);id=i.required();data=R();minzoom=i();maxzoom=i();attribution=i();buffer=i();tolerance=i();cluster=i();clusterRadius=i();clusterMaxZoom=i();clusterMinPoints=i();clusterProperties=i();lineMetrics=i();generateId=i();promoteId=i();filter=i();dynamic=i();updateFeatureData=new w;sub=new L;sourceAdded=!1;featureIdCounter=0;ngOnInit(){this.data()||this.data.set({type:"FeatureCollection",features:[]});let e=this.mapService.mapLoaded$.subscribe(()=>{this.init();let t=f(this.mapService.mapInstance,"styledata").pipe(h(()=>!this.mapService.mapInstance.getSource(this.id()))).subscribe(()=>{this.init()});this.sub.add(t)});this.sub.add(e)}ngOnChanges(e){if(this.sourceAdded&&((e.minzoom&&!e.minzoom.isFirstChange()||e.maxzoom&&!e.maxzoom.isFirstChange()||e.attribution&&!e.attribution.isFirstChange()||e.buffer&&!e.buffer.isFirstChange()||e.tolerance&&!e.tolerance.isFirstChange()||e.cluster&&!e.cluster.isFirstChange()||e.clusterRadius&&!e.clusterRadius.isFirstChange()||e.clusterMaxZoom&&!e.clusterMaxZoom.isFirstChange()||e.clusterMinPoints&&!e.clusterMinPoints.isFirstChange()||e.clusterProperties&&!e.clusterProperties.isFirstChange()||e.lineMetrics&&!e.lineMetrics.isFirstChange()||e.generateId&&!e.generateId.isFirstChange()||e.promoteId&&!e.promoteId.isFirstChange()||e.filter&&!e.filter.isFirstChange()||e.dynamic&&!e.dynamic.isFirstChange())&&(this.ngOnDestroy(),this.ngOnInit()),e.data&&!e.data.isFirstChange())){let t=this.mapService.getSource(this.id());if(t===void 0)return;t.setData(this.data())}}ngOnDestroy(){this.sub.unsubscribe(),this.sourceAdded&&(this.mapService.removeSource(this.id()),this.sourceAdded=!1)}getClusterExpansionZoom(e){return c(this,null,function*(){let t=this.mapService.getSource(this.id());return this.zone.run(()=>c(this,null,function*(){return new Promise((a,p)=>{t.getClusterExpansionZoom(e,(u,d)=>{u?p(u):a(d)})})}))})}getClusterChildren(e){return c(this,null,function*(){let t=this.mapService.getSource(this.id());return this.zone.run(()=>c(this,null,function*(){return new Promise((a,p)=>{t.getClusterChildren(e,(u,d)=>{u?p(u):a(d)})})}))})}getClusterLeaves(e,t,a){return c(this,null,function*(){let p=this.mapService.getSource(this.id());return this.zone.run(()=>c(this,null,function*(){return new Promise((u,d)=>{p.getClusterLeaves(e,t,a,(z,K)=>{z?d(z):u(K||[])})})}))})}_addFeature(e){this.data().features.push(e),this.updateFeatureData.next(null)}_removeFeature(e){let t=this.data(),a=t.features.indexOf(e);a>-1&&t.features.splice(a,1),this.updateFeatureData.next(null)}_getNewFeatureId(){return++this.featureIdCounter}init(){let e={type:"geojson",data:this.data(),minzoom:this.minzoom(),maxzoom:this.maxzoom(),attribution:this.attribution(),buffer:this.buffer(),tolerance:this.tolerance(),cluster:this.cluster(),clusterRadius:this.clusterRadius(),clusterMaxZoom:this.clusterMaxZoom(),clusterMinPoints:this.clusterMinPoints(),clusterProperties:this.clusterProperties(),lineMetrics:this.lineMetrics(),generateId:this.generateId(),promoteId:this.promoteId(),filter:this.filter(),dynamic:this.dynamic()};this.mapService.addSource(this.id(),e);let t=this.updateFeatureData.pipe(I(0)).subscribe(()=>{let a=this.mapService.getSource(this.id());a!==void 0&&a.setData(this.data())});this.sub.add(t),this.sourceAdded=!0}static \u0275fac=function(t){return new(t||r)};static \u0275cmp=l({type:r,selectors:[["mgl-geojson-source"]],inputs:{id:[1,"id"],data:[1,"data"],minzoom:[1,"minzoom"],maxzoom:[1,"maxzoom"],attribution:[1,"attribution"],buffer:[1,"buffer"],tolerance:[1,"tolerance"],cluster:[1,"cluster"],clusterRadius:[1,"clusterRadius"],clusterMaxZoom:[1,"clusterMaxZoom"],clusterMinPoints:[1,"clusterMinPoints"],clusterProperties:[1,"clusterProperties"],lineMetrics:[1,"lineMetrics"],generateId:[1,"generateId"],promoteId:[1,"promoteId"],filter:[1,"filter"],dynamic:[1,"dynamic"]},outputs:{data:"dataChange"},features:[C],decls:0,vars:0,template:function(t,a){},encapsulation:2,changeDetection:0})}return r})();var $=(()=>{class r{mapService=n(b);id=i.required();source=i();type=i.required();metadata=i();sourceLayer=i();filter=i();layout=i();paint=i();before=i();minzoom=i();maxzoom=i();layerClick=new o;layerDblClick=new o;layerMouseDown=new o;layerMouseUp=new o;layerMouseEnter=new o;layerMouseLeave=new o;layerMouseMove=new o;layerMouseOver=new o;layerMouseOut=new o;layerContextMenu=new o;layerTouchStart=new o;layerTouchEnd=new o;layerTouchCancel=new o;layerAdded=!1;sub;ngOnInit(){this.sub=this.mapService.mapLoaded$.pipe(D(()=>f(this.mapService.mapInstance,"styledata").pipe(y(()=>!1),h(()=>!this.mapService.mapInstance.getLayer(this.id())),O(!0)))).subscribe(e=>this.init(e))}ngOnChanges(e){this.layerAdded&&(e.paint&&!e.paint.isFirstChange()&&this.mapService.setLayerAllPaintProperty(this.id(),e.paint.currentValue),e.layout&&!e.layout.isFirstChange()&&this.mapService.setLayerAllLayoutProperty(this.id(),e.layout.currentValue),e.filter&&!e.filter.isFirstChange()&&this.mapService.setLayerFilter(this.id(),e.filter.currentValue),e.before&&!e.before.isFirstChange()&&this.mapService.setLayerBefore(this.id(),e.before.currentValue),(e.minzoom&&!e.minzoom.isFirstChange()||e.maxzoom&&!e.maxzoom.isFirstChange())&&this.mapService.setLayerZoomRange(this.id(),this.minzoom(),this.maxzoom()))}ngOnDestroy(){this.layerAdded&&this.mapService.removeLayer(this.id()),this.sub&&this.sub.unsubscribe()}init(e){let t={layerOptions:{id:this.id(),type:this.type(),source:this.source(),metadata:this.metadata(),"source-layer":this.sourceLayer(),minzoom:this.minzoom(),maxzoom:this.maxzoom(),filter:this.filter(),layout:this.layout(),paint:this.paint()},layerEvents:{layerClick:this.layerClick,layerDblClick:this.layerDblClick,layerMouseDown:this.layerMouseDown,layerMouseUp:this.layerMouseUp,layerMouseEnter:this.layerMouseEnter,layerMouseLeave:this.layerMouseLeave,layerMouseMove:this.layerMouseMove,layerMouseOver:this.layerMouseOver,layerMouseOut:this.layerMouseOut,layerContextMenu:this.layerContextMenu,layerTouchStart:this.layerTouchStart,layerTouchEnd:this.layerTouchEnd,layerTouchCancel:this.layerTouchCancel}};this.mapService.addLayer(t,e,this.before()),this.layerAdded=!0}static \u0275fac=function(t){return new(t||r)};static \u0275cmp=l({type:r,selectors:[["mgl-layer"]],inputs:{id:[1,"id"],source:[1,"source"],type:[1,"type"],metadata:[1,"metadata"],sourceLayer:[1,"sourceLayer"],filter:[1,"filter"],layout:[1,"layout"],paint:[1,"paint"],before:[1,"before"],minzoom:[1,"minzoom"],maxzoom:[1,"maxzoom"]},outputs:{layerClick:"layerClick",layerDblClick:"layerDblClick",layerMouseDown:"layerMouseDown",layerMouseUp:"layerMouseUp",layerMouseEnter:"layerMouseEnter",layerMouseLeave:"layerMouseLeave",layerMouseMove:"layerMouseMove",layerMouseOver:"layerMouseOver",layerMouseOut:"layerMouseOut",layerContextMenu:"layerContextMenu",layerTouchStart:"layerTouchStart",layerTouchEnd:"layerTouchEnd",layerTouchCancel:"layerTouchCancel"},features:[C],decls:0,vars:0,template:function(t,a){},encapsulation:2})}return r})();var F=class r{firestore=n(U);trailsRef;trails;constructor(){this.trailsRef=J(this.firestore,"trails"),this.trails=W(this.trailsRef,{idField:"id"}).pipe(y(s=>s.map(e=>JSON.parse(e.geojson))))}static \u0275fac=function(e){return new(e||r)};static \u0275prov=T({token:r,factory:r.\u0275fac,providedIn:"root"})};var X=()=>({"line-color":"#000000","line-width":5}),Y=()=>({"line-join":"round","line-cap":"round"}),ee=()=>["get","display_color"],te=r=>({"line-color":r,"line-width":2}),g=class r{trailService=n(F);featureCollection;ngOnInit(){this.trailService.trails.subscribe(s=>{this.featureCollection={features:s,type:"FeatureCollection"}})}static \u0275fac=function(e){return new(e||r)};static \u0275cmp=l({type:r,selectors:[["app-trail-layer"]],decls:3,vars:11,consts:[["id","trails-source",3,"data"],["id","trails-outline","type","line",3,"source","paint","layout"],["id","trails-line","type","line",3,"source","paint"]],template:function(e,t){e&1&&M(0,"mgl-geojson-source",0)(1,"mgl-layer",1)(2,"mgl-layer",2),e&2&&(m("data",t.featureCollection),x(),m("source","trails-source")("paint",v(6,X))("layout",v(7,Y)),x(),m("source","trails-source")("paint",_(9,te,v(8,ee))))},dependencies:[G,$],encapsulation:2})};var H=class r extends B{style=this.styles.wildland;static \u0275fac=(()=>{let s;return function(t){return(s||(s=P(r)))(t||r)}})();static \u0275cmp=l({type:r,selectors:[["app-wildland-scene"]],features:[Z([q]),j],decls:2,vars:4,consts:[[1,"map-container",3,"zoom","center"]],template:function(e,t){e&1&&(A(0,"mgl-map",0),M(1,"app-trail-layer"),k()),e&2&&(N(t.style),m("zoom",t.zoom)("center",t.center))},dependencies:[V,g],styles:[".map-container[_ngcontent-%COMP%]{height:100vh;width:100%}"]})};export{H as WildlandSceneComponent};
