import{a as We}from"./chunk-5DVGZXEZ.js";import{c as Ft,d as Vt,e as kt,g as Gt}from"./chunk-WQKVID54.js";import{b as Wt}from"./chunk-DBCWR6HP.js";import{a as Ot,b as At}from"./chunk-XACQ2RJ5.js";import{a as xt,b as Bt}from"./chunk-CQVHC5U2.js";import{a as N}from"./chunk-FSW536RM.js";import{b as yt,c as Rt,e as It,g as Pt,h as Lt}from"./chunk-N7DSOI7B.js";import{a as Ct,b as we,c as Me,d as Nt,g as jt,h as xe,i as Dt,j as Ut}from"./chunk-F4HA2HQL.js";import{a as Et,b as vt}from"./chunk-T5UBLAP4.js";import{g as De,l as be,m as ne}from"./chunk-DA3NC6W4.js";import{d as Mt}from"./chunk-FGABE2LC.js";import{h as wt}from"./chunk-6FZTFPIH.js";import{i as St,j as X}from"./chunk-J5AEP4US.js";import{a as Oe,b as le}from"./chunk-KPT44MCK.js";import{a as Ue}from"./chunk-EM2AEAFS.js";import{a as Be}from"./chunk-VGAXEXH3.js";import{a as _t}from"./chunk-L56OBJFS.js";import{o as oe}from"./chunk-7HMNN4FJ.js";import{a as Ne,e as Te,f as pt,k as ut}from"./chunk-UKAGN54W.js";import{a as ge}from"./chunk-PHMJ7KPL.js";import{a as z,e as Tt,f as gt,h as Z,n as je,o as bt}from"./chunk-YEXMIDOT.js";import{b as ft}from"./chunk-QSQIQSC6.js";import{A as D,e as re,k as ae}from"./chunk-7SDNM7YV.js";import{a as mt}from"./chunk-T6WMVIUG.js";import{f as dt}from"./chunk-ONYJLWAD.js";import{b as lt}from"./chunk-E2QKN2KY.js";import{a as ot,g as nt}from"./chunk-PDQQY7RQ.js";import{a as n,b as ht}from"./chunk-RWCIDBNQ.js";import{b as Ce,x as se}from"./chunk-HM5RIVQC.js";import{a as _e,d as ct}from"./chunk-ALWV3RJ2.js";import{a as it}from"./chunk-QXXXCEV5.js";import{D as at,a as st,b as x,c as L,d as $,e as ue,n as fe,p as ie,v as Le,x as rt,y as C}from"./chunk-6B5XFA6F.js";import{g as tt}from"./chunk-PTZYZULI.js";import{h as J}from"./chunk-OLOKUDVI.js";import{G as et,a as Ie,g as Pe}from"./chunk-ZTOZWLEE.js";import{a as _,c as Re}from"./chunk-BOVYXYHK.js";import{b as pe}from"./chunk-EQZWYK27.js";import{a as $e}from"./chunk-T7DXJKX7.js";import{d as Qe}from"./chunk-BWO7LS2H.js";import{a as ye}from"./chunk-AML4XSEF.js";import{b as Ke}from"./chunk-4PTIEWMT.js";import{g as qe}from"./chunk-XRGPJ3QY.js";var Ht=class extends Oe{get geometries(){return this._geometries}get transformation(){return this._transformation??ct}set transformation(e){this._transformation=Ie(this._transformation??_e(),e),this._invalidateBoundingVolume(),this._emit("transformationChanged",this)}get shaderTransformation(){return this._shaderTransformation}set shaderTransformation(e){this._shaderTransformation=e?Ie(this._shaderTransformation??_e(),e):null,this._invalidateBoundingVolume(),this._emit("shaderTransformationChanged",this)}get effectiveTransformation(){return this.shaderTransformation??this.transformation}constructor(e={}){super(),this.type=le.Object,this._shaderTransformation=null,this._parentLayer=null,this._visible=!0,this.castShadow=e.castShadow??!0,this.usesVerticalDistanceToGround=e.usesVerticalDistanceToGround??!1,this.graphicUid=e.graphicUid,this.layerUid=e.layerUid,e.isElevationSource&&(this.lastValidElevationBB=new Ae),this._geometries=e.geometries?Array.from(e.geometries):new Array}dispose(){this._geometries.length=0}get parentLayer(){return this._parentLayer}set parentLayer(e){ot(this._parentLayer==null||e==null,"Object3D can only be added to a single Layer"),this._parentLayer=e}addGeometry(e){e.visible=this._visible,this._geometries.push(e),this._emit("geometryAdded",{object:this,geometry:e}),this._invalidateBoundingVolume()}removeGeometry(e){let t=this._geometries.splice(e,1)[0];t&&(this._emit("geometryRemoved",{object:this,geometry:t}),this._invalidateBoundingVolume())}removeAllGeometries(){for(;this._geometries.length>0;)this.removeGeometry(0)}geometryVertexAttributeUpdated(e,t,i=!1){this._emit("attributesChanged",{object:this,geometry:e,attribute:t,sync:i}),ht(t)&&this._invalidateBoundingVolume()}get visible(){return this._visible}set visible(e){if(this._visible!==e){this._visible=e;for(let t of this._geometries)t.visible=this._visible;this._emit("visibilityChanged",this)}}maskOccludee(){let e=new Bt;for(let t of this._geometries)t.occludees=Ot(t.occludees,e);return this._emit("occlusionChanged",this),e}removeOcclude(e){for(let t of this._geometries)t.occludees=At(t.occludees,e);this._emit("occlusionChanged",this)}highlight(e){let t=new xt(e);for(let i of this._geometries)i.addHighlight(t);return this._emit("highlightChanged",this),t}removeHighlight(e){for(let t of this._geometries)t.removeHighlight(e);this._emit("highlightChanged",this)}removeStateID(e){e.channel===dt.Highlight?this.removeHighlight(e):this.removeOcclude(e)}getCombinedStaticTransformation(e,t){return Pe(t,this.transformation,e.transformation)}getCombinedShaderTransformation(e,t=_e()){return Pe(t,this.effectiveTransformation,e.transformation)}get boundingVolumeWorldSpace(){return this._bvWorldSpace||(this._bvWorldSpace=this._bvWorldSpace||new Ee,this._validateBoundingVolume(this._bvWorldSpace,he.WorldSpace)),this._bvWorldSpace}get boundingVolumeObjectSpace(){return this._bvObjectSpace||(this._bvObjectSpace=this._bvObjectSpace||new Ee,this._validateBoundingVolume(this._bvObjectSpace,he.ObjectSpace)),this._bvObjectSpace}_validateBoundingVolume(e,t){let i=t===he.ObjectSpace;for(let o of this._geometries){let s=o.boundingInfo;s&&ti(s,e,i?o.transformation:this.getCombinedShaderTransformation(o))}rt(e.bounds,e.min,e.max,.5);for(let o of this._geometries){let s=o.boundingInfo;if(s==null)continue;let d=i?o.transformation:this.getCombinedShaderTransformation(o),c=mt(d);C(Jt,s.center,d);let r=ie(Jt,e.bounds),l=s.radius*c;e.bounds[3]=Math.max(e.bounds[3],r+l)}}_invalidateBoundingVolume(){let e=this._bvWorldSpace?.bounds;this._bvObjectSpace=this._bvWorldSpace=void 0,this._parentLayer&&e&&this._parentLayer.notifyObjectBBChanged(this,e)}_emit(e,t){this._parentLayer&&this._parentLayer.events.emit(e,t)}get test(){}},Ae=class{constructor(){this.min=Re(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this.max=Re(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE)}isEmpty(){return this.max[0]<this.min[0]&&this.max[1]<this.min[1]&&this.max[2]<this.min[2]}},Ee=class extends Ae{constructor(){super(...arguments),this.bounds=ft()}};function ti(a,e,t){let i=a.bbMin,o=a.bbMax;if(et(t)){let s=L(ii,t[12],t[13],t[14]);$(P,i,s),$(U,o,s);for(let d=0;d<3;++d)e.min[d]=Math.min(e.min[d],P[d]),e.max[d]=Math.max(e.max[d],U[d])}else if(C(P,i,t),at(i,o))for(let s=0;s<3;++s)e.min[s]=Math.min(e.min[s],P[s]),e.max[s]=Math.max(e.max[s],P[s]);else{C(U,o,t);for(let s=0;s<3;++s)e.min[s]=Math.min(e.min[s],P[s],U[s]),e.max[s]=Math.max(e.max[s],P[s],U[s]);for(let s=0;s<3;++s){x(P,i),x(U,o),P[s]=o[s],U[s]=i[s],C(P,P,t),C(U,U,t);for(let d=0;d<3;++d)e.min[d]=Math.min(e.min[d],P[d],U[d]),e.max[d]=Math.max(e.max[d],P[d],U[d])}}}var ii=_(),P=_(),U=_(),Jt=_(),he;(function(a){a[a.WorldSpace=0]="WorldSpace",a[a.ObjectSpace=1]="ObjectSpace"})(he||(he={}));var zt=["layerObjectAdded","layerObjectRemoved","layerObjectsAdded","layerObjectsRemoved","transformationChanged","shaderTransformationChanged","visibilityChanged","occlusionChanged","highlightChanged","geometryAdded","geometryRemoved","attributesChanged"];var Zt=class extends Oe{constructor(e,t,i=""){super(),this.stage=e,this.apiLayerUid=i,this.type=le.Layer,this.events=new $e,this.visible=!0,this.sliceable=!1,this._objectsAdded=new ye,this._handles=new Qe,this._objects=new ye,this._pickable=!0,this.visible=t?.visible??!0,this._pickable=t?.pickable??!0,this.updatePolicy=t?.updatePolicy??We.ASYNC,this._disableOctree=t?.disableOctree??!1,e.add(this);for(let o of zt)this._handles.add(this.events.on(o,s=>e.handleEvent(o,s)))}destroy(){this._handles.size&&(this._handles.destroy(),this.stage.remove(this),this.invalidateSpatialQueryAccelerator())}get objects(){return this._objects}set pickable(e){this._pickable=e}get pickable(){return this._pickable&&this.visible}add(e){this._objects.push(e),e.parentLayer=this,this.events.emit("layerObjectAdded",{layer:this,object:e}),this._octree!=null&&this._objectsAdded.push(e)}remove(e){this._objects.removeUnordered(e)&&(e.parentLayer=null,this.events.emit("layerObjectRemoved",{layer:this,object:e}),this._octree!=null&&(this._objectsAdded.removeUnordered(e)||this._octree.remove([e])))}addMany(e){this._objects.pushArray(e);for(let t of e)t.parentLayer=this;this.events.emit("layerObjectsAdded",{layer:this,objects:e}),this._octree!=null&&this._objectsAdded.pushArray(e)}removeMany(e){let t=new Array;if(this._objects.removeUnorderedMany(e,e.length,t),t.length!==0){for(let i of t)i.parentLayer=null;if(this.events.emit("layerObjectsRemoved",{layer:this,objects:t}),this._octree!=null){for(let i=0;i<t.length;)this._objectsAdded.removeUnordered(t[i])?(t[i]=t[t.length-1],t.length-=1):++i;this._octree.remove(t)}}}sync(){this.updatePolicy!==We.SYNC&&this.stage.syncLayer(this.id)}notifyObjectBBChanged(e,t){this._octree==null||this._objectsAdded.includes(e)||this._octree.update(e,t)}getSpatialQueryAccelerator(){return this._octree==null&&this._objects.length>50&&!this._disableOctree?(this._octree=new _t(e=>e.boundingVolumeWorldSpace.bounds),this._octree.add(this._objects.data,this._objects.length)):this._octree!=null&&this._objectsAdded.length>0&&(this._octree.add(this._objectsAdded.data,this._objectsAdded.length),this._objectsAdded.clear()),this._octree}invalidateSpatialQueryAccelerator(){this._octree=Ke(this._octree),this._objectsAdded.clear()}};function wi(a){return a!=null&&a.type===le.Layer}var ve=class extends vt{constructor(e,t){super(e,t,new Et(Gt,()=>import("./chunk-4PPVSPTK.js")),Fe),this.primitiveType=t.wireframe?Ce.LINES:Ce.TRIANGLE_STRIP}_makePipelineState(e,t){let{oitPass:i,output:o,hasOccludees:s,hasPolygonOffset:d}=e,c=i===Ue.NONE,r=i===Ue.FrontFace;return ne({blending:Z(o)?yt(i):null,depthTest:{func:Pt(i)},depthWrite:Rt(e),drawBuffers:o===z.Depth?{buffers:[se.NONE]}:Lt(i,o),colorWrite:be,stencilWrite:s?Me:null,stencilTest:s?t?xe:jt:null,polygonOffset:c||r?d?Xt:null:It})}initializePipeline(e){if(e.occluder){let t=e.hasPolygonOffset?Xt:null;this._occluderPipelineTransparent=ne({blending:De,polygonOffset:t,depthTest:we,depthWrite:null,colorWrite:be,stencilWrite:null,stencilTest:Ut,drawBuffers:e.output===z.Depth?{buffers:[se.NONE]}:null}),this._occluderPipelineOpaque=ne({blending:De,polygonOffset:t,depthTest:we,depthWrite:null,colorWrite:be,stencilWrite:Nt,stencilTest:Dt,drawBuffers:e.output===z.Depth?{buffers:[se.NONE]}:null}),this._occluderPipelineMaskWrite=ne({blending:null,polygonOffset:t,depthTest:Ct,depthWrite:null,colorWrite:null,stencilWrite:Me,stencilTest:xe,drawBuffers:e.output===z.Depth?{buffers:[se.NONE]}:null})}return this._occludeePipeline=this._makePipelineState(e,!0),this._makePipelineState(e,!1)}getPipeline(e,t){if(e)return this._occludeePipeline;switch(t){case N.TRANSPARENT_OCCLUDER_MATERIAL:return this._occluderPipelineTransparent??super.getPipeline();case N.OCCLUDER_MATERIAL:return this._occluderPipelineOpaque??super.getPipeline();default:return this._occluderPipelineMaskWrite??super.getPipeline()}}},Xt={factor:0,units:-4},Fe=new Map([[n.POSITION,0],[n.PREVPOSITION,1],[n.NEXTPOSITION,2],[n.SUBDIVISIONFACTOR,3],[n.UV0,4],[n.COLOR,5],[n.COLORFEATUREATTRIBUTE,5],[n.SIZE,6],[n.SIZEFEATUREATTRIBUTE,6],[n.OPACITYFEATUREATTRIBUTE,7],[n.OBJECTANDLAYERIDCOLOR,8]]);var R;(function(a){a[a.LEFT_JOIN_START=-2]="LEFT_JOIN_START",a[a.LEFT_JOIN_END=-1]="LEFT_JOIN_END",a[a.LEFT_CAP_START=-4]="LEFT_CAP_START",a[a.LEFT_CAP_END=-5]="LEFT_CAP_END",a[a.RIGHT_JOIN_START=2]="RIGHT_JOIN_START",a[a.RIGHT_JOIN_END=1]="RIGHT_JOIN_END",a[a.RIGHT_CAP_START=4]="RIGHT_CAP_START",a[a.RIGHT_CAP_END=5]="RIGHT_CAP_END"})(R||(R={}));var Yt=class extends St{constructor(e){super(e,Ze),this._configuration=new Vt,this.vertexAttributeLocations=Fe,this.produces=new Map([[N.OPAQUE_MATERIAL,t=>Tt(t)||Z(t)&&this.parameters.renderOccluded===X.OccludeAndTransparentStencil],[N.OPAQUE_MATERIAL_WITHOUT_NORMALS,t=>bt(t)],[N.OCCLUDER_MATERIAL,t=>je(t)&&this.parameters.renderOccluded===X.OccludeAndTransparentStencil],[N.TRANSPARENT_OCCLUDER_MATERIAL,t=>je(t)&&this.parameters.renderOccluded===X.OccludeAndTransparentStencil],[N.TRANSPARENT_MATERIAL,t=>Z(t)&&this.parameters.writeDepth&&this.parameters.renderOccluded!==X.OccludeAndTransparentStencil],[N.TRANSPARENT_MATERIAL_WITHOUT_DEPTH,t=>Z(t)&&!this.parameters.writeDepth&&this.parameters.renderOccluded!==X.OccludeAndTransparentStencil],[N.DRAPED_MATERIAL,t=>gt(t)]])}getConfiguration(e,t){this._configuration.output=e,this._configuration.oitPass=t.oitPass,this._configuration.draped=t.slot===N.DRAPED_MATERIAL;let i=this.parameters.stipplePattern!=null&&e!==z.Highlight;return this._configuration.stippleEnabled=i,this._configuration.stippleOffColorEnabled=i&&this.parameters.stippleOffColor!=null,this._configuration.stipplePreferContinuous=i&&this.parameters.stipplePreferContinuous,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.roundJoins=this.parameters.join==="round",this._configuration.capType=this.parameters.cap,this._configuration.applyMarkerOffset=this.parameters.markerParameters!=null&&si(this.parameters.markerParameters),this._configuration.hasPolygonOffset=this.parameters.hasPolygonOffset,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.vvOpacity=!!this.parameters.vvOpacity,this._configuration.innerColorEnabled=this.parameters.innerWidth>0&&this.parameters.innerColor!=null,this._configuration.falloffEnabled=this.parameters.falloff>0,this._configuration.hasOccludees=t.hasOccludees,this._configuration.occluder=this.parameters.renderOccluded===X.OccludeAndTransparentStencil,this._configuration.terrainDepthTest=t.terrainDepthTest&&Z(e),this._configuration.cullAboveTerrain=t.cullAboveTerrain,this._configuration.wireframe=this.parameters.wireframe,this._configuration}get visible(){return this.parameters.color[3]>=Be||this.parameters.stipplePattern!=null&&(this.parameters.stippleOffColor?.[3]??0)>Be}intersectDraped({attributes:e,screenToWorldRatio:t},i,o,s,d,c){if(!o.options.selectionMode)return;let r=e.get(n.SIZE),l=this.parameters.width;if(this.parameters.vvSize){let S=e.get(n.SIZEFEATUREATTRIBUTE).data[0];l*=pe(this.parameters.vvSize.offset[0]+S*this.parameters.vvSize.factor[0],this.parameters.vvSize.minSize[0],this.parameters.vvSize.maxSize[0])}else r&&(l*=r.data[0]);let m=s[0],O=s[1],T=(l/2+4)*t,w=Number.MAX_VALUE,G=0,b=e.get(n.POSITION).data,V=Ye(this.parameters,e)?b.length-2:b.length-5;for(let S=0;S<V;S+=3){let u=b[S],j=b[S+1],p=(S+3)%b.length,I=m-u,y=O-j,h=b[p]-u,k=b[p+1]-j,g=pe((h*I+k*y)/(h*h+k*k),0,1),K=h*g-I,A=k*g-y,H=K*K+A*A;H<w&&(w=H,G=S/3)}w<T*T&&d(c.dist,c.normal,G,!1)}intersect(e,t,i,o,s,d){if(!i.options.selectionMode||!e.visible)return;if(!nt(t))return void qe.getLogger("esri.views.3d.webgl-engine.materials.RibbonLineMaterial").error("intersection assumes a translation-only matrix");let c=e.attributes,r=c.get(n.POSITION).data,l=this.parameters.width;if(this.parameters.vvSize){let u=c.get(n.SIZEFEATUREATTRIBUTE).data[0];l*=pe(this.parameters.vvSize.offset[0]+u*this.parameters.vvSize.factor[0],this.parameters.vvSize.minSize[0],this.parameters.vvSize.maxSize[0])}else c.has(n.SIZE)&&(l*=c.get(n.SIZE).data[0]);let m=i.camera,O=ri;it(O,i.point);let T=l*m.pixelRatio/2+4*m.pixelRatio;L(ce[0],O[0]-T,O[1]+T,0),L(ce[1],O[0]+T,O[1]+T,0),L(ce[2],O[0]+T,O[1]-T,0),L(ce[3],O[0]-T,O[1]-T,0);for(let u=0;u<4;u++)if(!m.unprojectFromRenderScreen(ce[u],F[u]))return;ae(m.eye,F[0],F[1],ke),ae(m.eye,F[1],F[2],Ge),ae(m.eye,F[2],F[3],He),ae(m.eye,F[3],F[0],Je);let w=Number.MAX_VALUE,G=0,b=Ye(this.parameters,c)?r.length-2:r.length-5;for(let u=0;u<b;u+=3){E[0]=r[u]+t[12],E[1]=r[u+1]+t[13],E[2]=r[u+2]+t[14];let j=(u+3)%r.length;if(v[0]=r[j]+t[12],v[1]=r[j+1]+t[13],v[2]=r[j+2]+t[14],D(ke,E)<0&&D(ke,v)<0||D(Ge,E)<0&&D(Ge,v)<0||D(He,E)<0&&D(He,v)<0||D(Je,E)<0&&D(Je,v)<0)continue;if(m.projectToRenderScreen(E,q),m.projectToRenderScreen(v,Q),q[2]<0&&Q[2]>0){ue(B,E,v);let I=m.frustum,y=-D(I[oe.NEAR],E)/Le(B,I[oe.NEAR]);fe(B,B,y),$(E,E,B),m.projectToRenderScreen(E,q)}else if(q[2]>0&&Q[2]<0){ue(B,v,E);let I=m.frustum,y=-D(I[oe.NEAR],v)/Le(B,I[oe.NEAR]);fe(B,B,y),$(v,v,B),m.projectToRenderScreen(v,Q)}else if(q[2]<0&&Q[2]<0)continue;q[2]=0,Q[2]=0;let p=pt(Te(q,Q,Kt),O);p<w&&(w=p,x(qt,E),x(Qt,v),G=u/3)}let V=i.rayBegin,S=i.rayEnd;if(w<T*T){let u=Number.MAX_VALUE;if(ut(Te(qt,Qt,Kt),Te(V,S,ai),Y)){ue(Y,Y,V);let j=st(Y);fe(Y,Y,1/j),u=j/ie(V,S)}d(u,Y,G,!1)}}get _layout(){let e=lt().vec3f(n.POSITION).vec3f(n.PREVPOSITION).vec3f(n.NEXTPOSITION).f32(n.SUBDIVISIONFACTOR).vec2f(n.UV0);return this.parameters.vvSize?e.f32(n.SIZEFEATUREATTRIBUTE):e.f32(n.SIZE),this.parameters.vvColor?e.f32(n.COLORFEATUREATTRIBUTE):e.vec4f(n.COLOR),this.parameters.vvOpacity&&e.f32(n.OPACITYFEATUREATTRIBUTE),ge()&&e.vec4u8(n.OBJECTANDLAYERIDCOLOR),e}createBufferWriter(){return new Xe(this._layout,this.parameters)}createGLMaterial(e){return new ze(e)}validateParameters(e){e.join!=="miter"&&(e.miterLimit=0),e.markerParameters!=null&&(e.markerScale=e.markerParameters.width/e.width)}},ze=class extends Mt{constructor(){super(...arguments),this._stipplePattern=null}dispose(){super.dispose(),this._stippleTextures.release(this._stipplePattern),this._stipplePattern=null}beginSlot(e){let t=this._material.parameters.stipplePattern;return this._stipplePattern!==t&&(this._material.setParameters({stippleTexture:this._stippleTextures.swap(t,this._stipplePattern)}),this._stipplePattern=t),this.getTechnique(ve,e)}},Ze=class extends wt{constructor(){super(...arguments),this.width=0,this.color=tt,this.join="miter",this.cap=Ft.BUTT,this.miterLimit=5,this.writeDepth=!0,this.hasPolygonOffset=!1,this.stippleTexture=null,this.stipplePreferContinuous=!0,this.markerParameters=null,this.markerScale=1,this.hasSlicePlane=!1,this.vvFastUpdate=!1,this.isClosed=!1,this.falloff=0,this.innerWidth=0,this.wireframe=!1}get transparent(){return this.color[3]<1||this.stipplePattern!=null&&(this.stippleOffColor?.[3]??0)<1}},Xe=class{constructor(e,t){this.vertexBufferLayout=e,this._parameters=t,this.numJoinSubdivisions=0;let i=t.stipplePattern?1:0;switch(this._parameters.join){case"miter":case"bevel":this.numJoinSubdivisions=i;break;case"round":this.numJoinSubdivisions=kt+i}}_isClosed(e){return Ye(this._parameters,e)}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){let i=e.get(n.POSITION).indices.length/2+1,o=this._isClosed(e),s=o?2:2*2;return s+=((o?i:i-1)-(o?0:1))*(2*this.numJoinSubdivisions+4),s+=2,this._parameters.wireframe&&(s=2+4*(s-2)),s}write(e,t,i,o,s,d){let c=oi,r=ni,l=li,m=i.get(n.POSITION),O=m.indices,T=m.data.length/3,w=i.get(n.DISTANCETOSTART)?.data;O&&O.length!==2*(T-1)&&console.warn("RibbonLineMaterial does not support indices");let G=i.get(n.SIZEFEATUREATTRIBUTE)?.data[0]??i.get(n.SIZE)?.data[0]??1,b=[1,1,1,1],V=0,S=this.vertexBufferLayout.fields.has(n.COLORFEATUREATTRIBUTE);S?V=i.get(n.COLORFEATUREATTRIBUTE).data[0]:i.has(n.COLOR)&&(b=i.get(n.COLOR).data);let u=this.vertexBufferLayout.fields.has(n.OPACITYFEATUREATTRIBUTE),j=u?i.get(n.OPACITYFEATUREATTRIBUTE).data[0]:0,p=new Float32Array(s.buffer),I=ge()?new Uint8Array(s.buffer):null,y=this.vertexBufferLayout.stride/4,h=d*y,k=h,g=0,K=w?(f,M,W)=>g=w[W]:(f,M,W)=>g+=ie(f,M),A=(f,M,W,te,me,$t,ei)=>{if(p[h++]=M[0],p[h++]=M[1],p[h++]=M[2],p[h++]=f[0],p[h++]=f[1],p[h++]=f[2],p[h++]=W[0],p[h++]=W[1],p[h++]=W[2],p[h++]=te,p[h++]=ei,p[h++]=me,p[h++]=G,S)p[h++]=V;else{let de=Math.min(4*$t,b.length-4);p[h++]=b[de],p[h++]=b[de+1],p[h++]=b[de+2],p[h++]=b[de+3]}u&&(p[h++]=j),ge()&&(o&&(I[4*h]=o[0],I[4*h+1]=o[1],I[4*h+2]=o[2],I[4*h+3]=o[3]),h++)};h+=y,L(r,m.data[0],m.data[1],m.data[2]),e&&C(r,r,e);let H=this._isClosed(i);if(H){let f=m.data.length-3;L(c,m.data[f],m.data[f+1],m.data[f+2]),e&&C(c,c,e)}else L(l,m.data[3],m.data[4],m.data[5]),e&&C(l,l,e),A(r,r,l,1,R.LEFT_CAP_START,0,0),A(r,r,l,1,R.RIGHT_CAP_START,0,0),x(c,r),x(r,l);let Se=H?0:1,ee=H?T:T-1;for(let f=Se;f<ee;f++){let M=(f+1)%T*3;L(l,m.data[M],m.data[M+1],m.data[M+2]),e&&C(l,l,e),K(c,r,f),A(c,r,l,0,R.LEFT_JOIN_END,f,g),A(c,r,l,0,R.RIGHT_JOIN_END,f,g);let W=this.numJoinSubdivisions;for(let te=0;te<W;++te){let me=(te+1)/(W+1);A(c,r,l,me,R.LEFT_JOIN_END,f,g),A(c,r,l,me,R.RIGHT_JOIN_END,f,g)}A(c,r,l,1,R.LEFT_JOIN_START,f,g),A(c,r,l,1,R.RIGHT_JOIN_START,f,g),x(c,r),x(r,l)}H?(L(l,m.data[3],m.data[4],m.data[5]),e&&C(l,l,e),g=K(c,r,ee),A(c,r,l,0,R.LEFT_JOIN_END,Se,g),A(c,r,l,0,R.RIGHT_JOIN_END,Se,g)):(g=K(c,r,ee),A(c,r,r,0,R.LEFT_CAP_END,ee,g),A(c,r,r,0,R.RIGHT_CAP_END,ee,g)),Ve(p,k+y,p,k,y),h=Ve(p,h-y,p,h,y),this._parameters.wireframe&&this._addWireframeVertices(s,k,h,y)}_addWireframeVertices(e,t,i,o){let s=new Float32Array(e.buffer,i*Float32Array.BYTES_PER_ELEMENT),d=new Float32Array(e.buffer,t*Float32Array.BYTES_PER_ELEMENT,i-t),c=0,r=l=>c=Ve(d,l,s,c,o);for(let l=0;l<d.length-1;l+=2*o)r(l),r(l+2*o),r(l+1*o),r(l+2*o),r(l+1*o),r(l+3*o)}};function Ve(a,e,t,i,o){for(let s=0;s<o;s++)t[i++]=a[e++];return i}function Ye(a,e){return a.isClosed?e.get(n.POSITION).indices.length>2:!1}function si(a){return a.anchor===Wt.Tip&&a.hideOnShortSegments&&a.placement==="begin-end"&&a.worldSpace}var E=_(),v=_(),B=_(),Y=_(),ri=_(),q=J(),Q=J(),qt=_(),Qt=_(),Kt=Ne(),ai=Ne(),oi=_(),ni=_(),li=_(),ce=[J(),J(),J(),J()],F=[_(),_(),_(),_()],ke=re(),Ge=re(),He=re(),Je=re();export{Ht as a,Zt as b,wi as c,Yt as d};
