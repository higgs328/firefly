import{a as y}from"./chunk-FPCHE4I2.js";import{i as u,j as g}from"./chunk-EQZWYK27.js";import{a as _}from"./chunk-T7DXJKX7.js";import{a as r}from"./chunk-QGVBCWUY.js";import{e as a}from"./chunk-NFIPKH6V.js";import{l as p}from"./chunk-5QEXLALV.js";import{a as l,b as c}from"./chunk-VTHXE323.js";var A=[-45,0,45,-90,90,-135,180,135],b=[...A,-180],T={0:{label:"north",iconName:"chevron-up"},45:{label:"northEast",iconName:"chevron-up-right"},90:{label:"east",iconName:"chevron-right"},135:{label:"southEast",iconName:"chevron-down-right"},180:{label:"south",iconName:"chevron-down"},"-135":{label:"southWest",iconName:"chevron-down-left"},"-90":{label:"west",iconName:"chevron-left"},"-45":{label:"northWest",iconName:"chevron-up-left"}},M=200;var v="esri-directional-pad",f={base:v,buttonsContainer:`${v}__buttons-container`,button:`${v}__button`,compassButton:`${v}__compass`,rotationContainer:`${v}__rotation-container`,rotationSliderContainer:`${v}__rotation-slider-container`,rotationReset:`${v}__rotation-reset-button`,error:`${v}__error`};function w(t){let e=C(t),o=b.map(n=>({angle:n,offset:Math.abs(n-e)})).sort((n,d)=>n.offset-d.offset),i=o[0].angle;return i===-180?180:i}function C({x:t,y:e}){let o=Math.atan2(t,e);return g(o)}function h(t){let e=u(t);return{x:Math.sin(e),y:Math.cos(e)}}function V(t,e){let o=e.y-t.y,i=e.x-t.x,n=Math.sqrt(i*i+o*o);return{x:i/n,y:o/n}}function D(t){let{x:e,y:o,width:i,height:n}=t.getBoundingClientRect();return{x:e+i/2,y:o+n/2}}var s=class extends y(_.EventedAccessor){constructor(t){super(t),this._initialAngle=void 0,this._movementVector=void 0,this._widgetCenter=void 0,this._anyAngleMovementEnabled=!1,this._movementTimeout=void 0,this._disabled=!1,this._moveOnceDuration=M,this.angle=void 0,this.speed=1,this.view=null,this.beginFollowingPointer=(e,o)=>{if(this.disabled)return;this._widgetCenter=o;let i=this._pointerLocationToVector(e);if(i===void 0)return;let n=this._resolveClosestAngle(e,i);n!==void 0&&(this._emitMove(h(n)),this.angle=n,this._initialAngle=n,this._setMovementTimeout(()=>{this._widgetCenter===void 0&&this._stopMovement()}),document.addEventListener("pointermove",this._onPointerMove,{passive:!0}),document.addEventListener("pointerup",this._onPointerUp,{passive:!0,once:!0}))},this.moveOnce=e=>{let o=h(e);this._emitMove(o),this._setMovementTimeout(this._stopMovement)},this._pointerLocationToVector=e=>{if(this._widgetCenter===void 0)return;let{x:o,y:i}=V(this._widgetCenter,e);return{x:o,y:-i}},this._resolveClosestAngle=(e,o)=>{let i=e.target,n=i?.getAttribute?.("data-angle");if(i?.classList?.contains(f.compassButton))return;let m=Number.parseInt(n??"",10);return Number.isNaN(m)?w(o):m},this._onPointerMove=e=>{if(e.buttons===0)return void this._stopMovement();let o=this._pointerLocationToVector(e);if(o===void 0)return;this._setMovementTimeout(void 0);let i=this._resolveClosestAngle(e,o);if(i===void 0)return void this._emitStop();let n=h(i),d=this._initialAngle!=null&&this._initialAngle!==i;this._anyAngleMovementEnabled||=d;let m=this._anyAngleMovementEnabled?o:n;(m.x!==this._movementVector?.x||m.y!==this._movementVector?.y)&&(this.angle=i,this._emitMove(m))},this._onPointerUp=()=>{this._movementTimeout===void 0?this._stopMovement():this._widgetCenter=void 0},this._stopMovement=()=>{this._emitStop(),this._widgetCenter=void 0,this._initialAngle=void 0,this._anyAngleMovementEnabled=!1,document.removeEventListener("pointermove",this._onPointerMove),document.removeEventListener("pointerup",this._stopMovement),this._setMovementTimeout(void 0)},this.on("move-start",()=>this.view?.mapViewNavigation.begin()),this.on("move-direction-change",({vector:{x:e,y:o}})=>this.view?.mapViewNavigation.continuousPanVector({x:e*this.speed,y:o*this.speed})),this.on("move-stop",()=>this.view?.mapViewNavigation.stop())}destroy(){this._stopMovement()}get disabled(){let{view:t,_disabled:e,supported:o}=this;return t?.ready===!1||e||!o}set disabled(t){this._disabled=t}get rotation(){return this.view?.rotation??this._get("rotation")??0}set rotation(t){this.view?this.view.constraints.rotationEnabled&&this.callGoTo({target:{rotation:t},options:{animate:t===0&&void 0}}):this._set("rotation",t)}get supported(){return this.view==null||this.view.type==="2d"}get state(){let{disabled:t,angle:e}=this;return t?"disabled":e!=null?"moving":"ready"}_setMovementTimeout(t){clearTimeout(this._movementTimeout),this._movementTimeout=t===void 0?void 0:setTimeout(()=>{this._movementTimeout=void 0,t()},this._moveOnceDuration)}_emitMove(t){this._movementVector==null&&this._emitMoveStartEvent({vector:t});let e=this._movementVector;this._movementVector=t,this._emitMoveDirectionChangeEvent({vector:t,oldVector:e})}_emitStop(){this.angle=void 0,this._movementVector!==void 0&&(this._emitMoveStopEvent({oldVector:this._movementVector}),this._movementVector=void 0)}_emitMoveStartEvent(t){this.emit("move-start",c(l({},t),{type:"move-start"}))}_emitMoveDirectionChangeEvent(t){this.emit("move-direction-change",c(l({},t),{type:"move-direction-change"}))}_emitMoveStopEvent(t){this.emit("move-stop",c(l({},t),{type:"move-stop"}))}};r([a()],s.prototype,"_initialAngle",void 0),r([a()],s.prototype,"_movementVector",void 0),r([a()],s.prototype,"_widgetCenter",void 0),r([a()],s.prototype,"_anyAngleMovementEnabled",void 0),r([a()],s.prototype,"_movementTimeout",void 0),r([a()],s.prototype,"_disabled",void 0),r([a()],s.prototype,"_moveOnceDuration",void 0),r([a()],s.prototype,"disabled",null),r([a()],s.prototype,"angle",void 0),r([a({type:Number,range:{min:0,max:100}})],s.prototype,"speed",void 0),r([a()],s.prototype,"rotation",null),r([a()],s.prototype,"supported",null),r([a({readOnly:!0})],s.prototype,"state",null),r([a()],s.prototype,"view",void 0),s=r([p("esri.widgets.DirectionalPad.DirectionalPadViewModel")],s);var F=s;export{A as a,T as b,f as c,D as d,F as e};
