import{a as k}from"./chunk-QWIVERB5.js";import{c as N,l as U}from"./chunk-2BJHWKO6.js";import"./chunk-Q5KIWWVU.js";import{a as L}from"./chunk-4NWJLPNX.js";import{a as I}from"./chunk-RGY7NTLL.js";import"./chunk-GY62SD4Z.js";import"./chunk-IAG3AFVL.js";import"./chunk-H5YAFDFO.js";import"./chunk-JYGVIFB2.js";import"./chunk-EMABSAM2.js";import"./chunk-5BRKCXYS.js";import"./chunk-LQEFWCY6.js";import"./chunk-5REY7VVO.js";import"./chunk-QCZ3ZIGQ.js";import"./chunk-7SDNM7YV.js";import"./chunk-4NUW747S.js";import"./chunk-T6WMVIUG.js";import"./chunk-7VCEHOOE.js";import"./chunk-H25DKJGS.js";import"./chunk-JPMGMA4B.js";import{a as E}from"./chunk-JQAW4OB5.js";import"./chunk-EM35R6FY.js";import{a as z}from"./chunk-HKJZ7WI6.js";import"./chunk-DJW5LMRG.js";import"./chunk-DEH76MSI.js";import"./chunk-ALWV3RJ2.js";import"./chunk-QXXXCEV5.js";import{p as T}from"./chunk-6B5XFA6F.js";import"./chunk-3JGYBNJA.js";import{g as S,p as D,s as A}from"./chunk-DA3SDKGO.js";import"./chunk-ZOEPYNM4.js";import"./chunk-57VFBGF3.js";import"./chunk-GWBRHLNH.js";import"./chunk-BJH4F4SM.js";import"./chunk-Z3RBZHAK.js";import"./chunk-PTZYZULI.js";import"./chunk-NMLYCCKN.js";import"./chunk-MDZTV2VL.js";import{h as R}from"./chunk-RNC4P66O.js";import"./chunk-7LHOQXZT.js";import"./chunk-BCREO4Q5.js";import"./chunk-U4QEPZJ3.js";import"./chunk-KJUZWSCL.js";import"./chunk-3WO6D7MU.js";import"./chunk-BUZ3SPLE.js";import"./chunk-K75TK42V.js";import"./chunk-OLOKUDVI.js";import"./chunk-RSDQHAJX.js";import{a as G}from"./chunk-BOVYXYHK.js";import"./chunk-KVM6SHDX.js";import"./chunk-EQZWYK27.js";import"./chunk-IR6XCBC4.js";import"./chunk-ZQIC5NFT.js";import{c as j}from"./chunk-VIEK2X23.js";import"./chunk-XKIFGPJO.js";import"./chunk-PEW2PLAN.js";import"./chunk-Q6Y4JG7Q.js";import"./chunk-7F5DJLJT.js";import"./chunk-CX5IFQZJ.js";import"./chunk-NJWTSROP.js";import"./chunk-D3R25AF2.js";import"./chunk-ARRCN5K3.js";import"./chunk-SLAWDKDA.js";import"./chunk-4N4D2YQX.js";import"./chunk-G4DZJMGT.js";import"./chunk-X2B63YVS.js";import"./chunk-BAEF3CT6.js";import"./chunk-AUAZP44J.js";import"./chunk-PVDFCTA4.js";import"./chunk-KNVXE32P.js";import"./chunk-76ATOSLU.js";import"./chunk-CCJU4DSH.js";import{a as w,c as O,i as x,j as C,k as V}from"./chunk-TG45K3WR.js";import"./chunk-RAI4DTMT.js";import"./chunk-ACP3S2CH.js";import"./chunk-HVAXZ2NA.js";import{a as v}from"./chunk-T7DXJKX7.js";import"./chunk-TYYVNQUR.js";import{a as o}from"./chunk-QGVBCWUY.js";import{H as g}from"./chunk-MYO4NP2N.js";import{e as i}from"./chunk-NFIPKH6V.js";import"./chunk-JPU2PQZC.js";import{l as u}from"./chunk-5QEXLALV.js";import"./chunk-P6QFA5MM.js";import"./chunk-DGTD7Y73.js";import"./chunk-LI2SX4T6.js";import"./chunk-BWO7LS2H.js";import"./chunk-HEVQSRJ2.js";import"./chunk-OVHPPCBL.js";import"./chunk-SNFOAZZQ.js";import"./chunk-AML4XSEF.js";import"./chunk-4PTIEWMT.js";import{g as f}from"./chunk-TG2UTNEO.js";import"./chunk-YOFFGXOB.js";import"./chunk-XRGPJ3QY.js";import"./chunk-6MRUJ2UW.js";import"./chunk-2LI2GKBQ.js";import{y as b}from"./chunk-QBWJMFH5.js";import{a as H,f as _}from"./chunk-VTHXE323.js";var d=class extends g{get operations(){return this._operations}get updating(){return this._updatingHandles.updating}constructor(e){super(e),this._updatingHandles=new E}initialize(){this.addHandles([f(this._updatingHandles),this._updatingHandles.add(()=>{let e=this.element.georeference;return e?.type==="control-points"?e.controlPoints:null},e=>this._elementControlPointsChanged(e),C)])}_elementControlPointsChanged(e){let t=e?.map(({mapPoint:n})=>n).filter(b),r=this.view.spatialReference;this._updatingHandles.addPromise(this._whenProjected(t,r,n=>{if(!n)return void this._replaceOperations(null);let{_operations:s}=this,c=new R({rings:[n.map(({x:l,y:h})=>[l,h])],spatialReference:r});if(s?.trySetGeometry(c))return void this.onModifiedExternally();let y=this.view.state.viewingMode;this._replaceOperations(new k(N.fromGeometry(c,y),y,l=>this._operationsGeometryChanged(l)))}))}_operationsGeometryChanged(e){let{element:{georeference:t},_operations:r}=this;if(!r||!t||t.type!=="control-points"||!t.controlPoints)return;let n=r.data.geometry,s=t.controlPoints.map(({mapPoint:l})=>l).filter(b);if(n.rings[0]?.length!==s.length)return;let c=n.rings[0].map(([l,h])=>new j({x:l,y:h,spatialReference:n.spatialReference})),y=s.map(({spatialReference:l})=>l);this._updatingHandles.addPromise(this._whenProjected(c,y,l=>this._updateElementControlPoints(l,e)))}_updateElementControlPoints(e,t){let{georeference:r}=this.element;if(!r||!e||r.type!=="control-points"||r.controlPoints?.length!==e?.length)return;let n=r.controlPoints;if(n?.length===e.length)for(let s=0;s<n.length;s++)t&&(n[s].sourcePoint=r.toSource(e[s])),n[s].mapPoint=e[s]}_whenProjected(e,t,r){return _(this,null,function*(){if(!e)return void r(e);let{_operations:n,element:{georeference:s}}=this,c=e.map(({spatialReference:h})=>h),y=Array.isArray(t)?t:new Array(c.length).fill(t);yield A(Array.from(c).map((h,M)=>({source:h,dest:y[M]})));let l=e.map((h,M)=>S(h,y[M]));n===this._operations&&s===this.element.georeference&&r(l)})}_replaceOperations(e){this._operations&&(this.removeHandles(this._operations),this._operations.destroy()),this._operations=e}};o([i({constructOnly:!0})],d.prototype,"view",void 0),o([i({constructOnly:!0})],d.prototype,"layer",void 0),o([i({constructOnly:!0})],d.prototype,"element",void 0),o([i({constructOnly:!0})],d.prototype,"onModifiedExternally",void 0),o([i()],d.prototype,"_operations",void 0),o([i()],d.prototype,"operations",null),o([i()],d.prototype,"updating",null),d=o([u("esri.views.3d.interactive.editingTools.media.MediaElementControllerControlPoints")],d);var m=class extends g{get operations(){return this._operations}get updating(){return this._updatingHandles.updating}constructor(e){super(e),this._updatingHandles=new E}initialize(){this.addHandles([f(this._updatingHandles),this._updatingHandles.add(()=>this.element.georeference?.coords,e=>this._elementCoordinatesChanged(e),C)])}_elementCoordinatesChanged(e){this._updatedElementCoordinates!==e&&this._updatingHandles.addPromise(this._whenProjected(e,this.view.spatialReference,t=>{if(!t)return void this._replaceOperations(null);let{_operations:r}=this;r?.trySetGeometry(t)?this.onModifiedExternally():this._replaceOperations(U.fromGeometry(t,this.view.state.viewingMode))}))}_operationsGeometryChanged(){let{element:{georeference:e},_operations:t}=this;if(!t||!e)return;let r=t.data.geometry;if(!e.coords)return void this._updateElementCoordinates(r);let n=e.coords.spatialReference;this._updatingHandles.addPromise(this._whenProjected(r,n,s=>this._updateElementCoordinates(s)))}_updateElementCoordinates(e){let{georeference:t}=this.element;t&&(t.coords=e,this._updatedElementCoordinates=t.coords)}_whenProjected(e,t,r){return _(this,null,function*(){if(!e)return void r(e);let{_operations:n,element:{georeference:s}}=this,c=yield D(e,t);n===this._operations&&s===this.element.georeference&&r(c)})}_replaceOperations(e){this._operations&&(this.removeHandles(this._operations),this._operations.destroy()),this._operations=e,e&&this.addHandles(e.data.on("change",()=>this._operationsGeometryChanged()),e),this.onModifiedExternally()}};o([i({constructOnly:!0})],m.prototype,"view",void 0),o([i({constructOnly:!0})],m.prototype,"layer",void 0),o([i({constructOnly:!0})],m.prototype,"element",void 0),o([i({constructOnly:!0})],m.prototype,"onModifiedExternally",void 0),o([i()],m.prototype,"_operations",void 0),o([i()],m.prototype,"operations",null),o([i()],m.prototype,"updating",null),m=o([u("esri.views.3d.interactive.editingTools.media.MediaElementControllerShape")],m);function F(e,t,r){return P(e.allLayerViews.find(n=>n.layer===t),r)}function P(e,t){if(!e||e.type!=="media-3d"||e.suspended)return!1;let r=e.layer.source;return!!r&&(r instanceof L||r instanceof I?r===t:"hasElement"in r&&r.hasElement(t))}var a=class extends g{grabbableForEvent(){return!0}constructor(e){super(e),this.interactive=!0,this.selectable=!1,this.grabbable=!0,this.grabbing=!1,this.dragging=!1,this.hovering=!0,this.selected=!1,this.cursor=null,this.consumesClicks=!0,this.events=new v.EventEmitter,this.addHandles(w(()=>this.selected,t=>this.events.emit("select-changed",{action:t?"select":"deselect"}),x))}destroy(){this._set("view",null)}intersectionDistance(e){let{view:t,layer:r,element:n}=this;if(!F(t,r,n))return null;let s=t.toMap(e,{include:{layer:r,element:n}});return s&&z(s,W,t.renderSpatialReference)?T(W,t.state.camera.eye):null}onElevationChange(){}onViewChange(){}};o([i({constructOnly:!0,nonNullable:!0})],a.prototype,"element",void 0),o([i({constructOnly:!0,nonNullable:!0})],a.prototype,"layer",void 0),o([i({constructOnly:!0,nonNullable:!0})],a.prototype,"view",void 0),o([i()],a.prototype,"interactive",void 0),o([i()],a.prototype,"selectable",void 0),o([i()],a.prototype,"grabbable",void 0),o([i()],a.prototype,"grabbing",void 0),o([i()],a.prototype,"dragging",void 0),o([i()],a.prototype,"hovering",void 0),o([i()],a.prototype,"selected",void 0),o([i()],a.prototype,"cursor",void 0),a=o([u("esri.views.3d.interactive.editingTools.media.MediaElementManipulator3D")],a);var W=G();var Z=Symbol(),p=class extends v.EventedAccessor{get operations(){return this._controller?.operations}get elevationInfo(){return{mode:"on-the-ground",offset:0}}get _layerView(){let e=this.view.allLayerViews.find(t=>t.layer===this.layer);return e?.type==="media-3d"?e:null}get visible(){return P(this._layerView,this.element)}get isDraped(){return!0}get origin(){return null}get updating(){return!!this._controller?.updating}get _controllerClass(){return this.tool==="transform"||this.element.georeference?.type!=="control-points"?m:d}constructor(e){super(e),this.tool="transform"}initialize(){this.addHandles([w(()=>this._controllerClass,e=>this._updateController(e),V),O(()=>this._layerView,"element-render-changed",({element:e})=>{this.element===e&&this.emit("committed")})])}toMap(e){let{layer:t,element:r}=this;return this.view.toMap(e,{include:{layer:t,element:r}})}createManipulator(e){let{view:t,layer:r,element:n}=this;return new a(H({view:t,layer:r,element:n},e))}_updateController(e){if(this._controller&&this._controller instanceof e)return;this.removeHandles(Z);let{view:t,layer:r,element:n}=this,s=()=>{this.emit("modified-externally")};this._controller=new e({view:t,layer:r,element:n,onModifiedExternally:s}),s(),this.addHandles(f(this._controller),Z)}};o([i({constructOnly:!0})],p.prototype,"view",void 0),o([i({constructOnly:!0})],p.prototype,"layer",void 0),o([i({constructOnly:!0})],p.prototype,"element",void 0),o([i()],p.prototype,"tool",void 0),o([i()],p.prototype,"_controller",void 0),o([i()],p.prototype,"elevationInfo",null),o([i()],p.prototype,"_layerView",null),o([i()],p.prototype,"visible",null),o([i()],p.prototype,"updating",null),o([i()],p.prototype,"_controllerClass",null),p=o([u("esri.views.3d.interactive.editingTools.ManipulatedObject3DMediaElement")],p);export{p as ManipulatedObject3DMediaElement};
