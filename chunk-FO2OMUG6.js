import{a as q,b as I,d as M}from"./chunk-S7U4DSGB.js";import{d as E}from"./chunk-ZGHRJMZW.js";import{e as j}from"./chunk-EDZQZA57.js";import{a as T,b as c}from"./chunk-V6AA2XHK.js";import{b as d}from"./chunk-NX5B6XBR.js";import{f as y}from"./chunk-ZC6EBRE4.js";import{d as v}from"./chunk-NJWTSROP.js";import{q as O}from"./chunk-4PTIEWMT.js";import{b as F}from"./chunk-2LI2GKBQ.js";import{a as S,b,f}from"./chunk-VTHXE323.js";function K(e,i,m){return f(this,null,function*(){let a=O(m),{point:t,distance:r,returnEdge:p,vertexMode:u}=i;if(!p&&u==="none")return{candidates:[]};let s=F(i.query);s=yield e.schedule(()=>j(s,e.definitionExpression,e.spatialReference),a),s=yield e.reschedule(()=>I(s,{availableFields:e.availableFields,fieldsIndex:e.fieldsIndex,geometryType:e.geometryType,spatialReference:e.spatialReference}),a);let l=!v(t.spatialReference,e.spatialReference);l&&(yield T(t.spatialReference,e.spatialReference));let x=typeof r=="number"?r:r.x,g=typeof r=="number"?r:r.y,R={xmin:t.x-x,xmax:t.x+x,ymin:t.y-g,ymax:t.y+g,spatialReference:t.spatialReference},n=l?c(R,e.spatialReference):R;if(!n)return{candidates:[]};let h=(yield d(y(t),null,{signal:a}))[0],w=(yield d(y(n),null,{signal:a}))[0];if(h==null||w==null)return{candidates:[]};let o=new q(yield e.reschedule(()=>e.searchFeatures(M(w.toJSON())),a),s,e);yield e.reschedule(()=>e.executeObjectIdsQuery(o),a),yield e.reschedule(()=>e.executeTimeQuery(o),a),yield e.reschedule(()=>e.executeAttributesQuery(o),a),yield e.reschedule(()=>k(e,o,a),a);let Q=h.toJSON(),J=l?c(Q,e.spatialReference):Q,N=l?Math.max(n.xmax-n.xmin,n.ymax-n.ymin)/2:r;return o.createSnappingResponse(b(S({},i),{point:J,distance:N}),t.spatialReference)})}function k(e,i,m){return f(this,null,function*(){let{query:a}=i,{spatialRel:t}=a;if(!i?.items?.length||!a.geometry||!t)return;let r=yield E(t,a.geometry,e.geometryType,e.hasZ,e.hasM),p=yield e.runSpatialFilter(i.items,u=>r(u.geometry),m);i.items=p})}export{K as a};
