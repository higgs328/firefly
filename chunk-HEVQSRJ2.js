import{a as p}from"./chunk-OVHPPCBL.js";import{a as h}from"./chunk-AML4XSEF.js";import{L as f,o as D,r as b}from"./chunk-4PTIEWMT.js";import{f as x}from"./chunk-VTHXE323.js";var i=class{constructor(t,s=30){this.name=t,this._counter=0,this._samples=new Array(s)}push(t){t!=null&&(this._samples[++this._counter%this._samples.length]=t)}set(t){t!=null&&(this._samples[this._counter%this._samples.length]=t)}get median(){return this._samples.slice().sort((t,s)=>t-s)[Math.floor(this._samples.length/2)]}get average(){return this._samples.reduce((t,s)=>t+s,0)/this._samples.length}get last(){return this._samples[this._counter%this._samples.length]}};var d=class{constructor(t){this.phases=t,this.paused=!1,this.ticks=-1,this.removed=!1}},w=class{constructor(t){this.callback=t,this.isActive=!0}remove(){this.isActive=!1}},_=0,k=0,c={time:0,deltaTime:0,elapsedFrameTime:0,frameDuration:0},v=["prepare","preRender","render","postRender","update","finish"],A=[],n=new h,F=class{constructor(t){this._task=t}remove(){this._task.removed=!0}pause(){this._task.paused=!0}resume(){this._task.paused=!1,M()}};function j(){r!=null&&(cancelAnimationFrame(r),r=requestAnimationFrame(T))}function M(){r==null&&(_=performance.now(),r=requestAnimationFrame(T))}var u={frameTasks:n,willDispatch:!1,clearFrameTasks:E,dispatch:q,executeFrameTasks:H,reschedule:j};function P(e){let t=new w(e);return A.push(t),u.willDispatch||(u.willDispatch=!0,p(q)),t}function U(e){let t=new d(e);return n.push(t),M(),new F(t)}var r=null;function E(e=!1){n.forAll(t=>{t.removed=!0}),e&&R()}function Q(e){k=Math.max(0,e)}function T(){let e=performance.now();r=null,r=n.some(s=>!s.paused&&!s.removed)?requestAnimationFrame(T):null,u.executeFrameTasks(e)}function H(e){let t=e-_;_=e;let s=k>0?k:1e3/60,l=Math.max(0,t-s);c.time=e,c.frameDuration=s-l;for(let o=0;o<v.length;o++){let y=performance.now(),g=v[o];n.forAll(a=>{a.paused||a.removed||(o===0&&a.ticks++,a.phases[g]&&(c.elapsedFrameTime=performance.now()-e,c.deltaTime=a.ticks===0?0:t,a.phases[g]?.call(a,c)))}),z[o].push(performance.now()-y)}R(),B.push(performance.now()-e)}var m=new h;function R(){n.forAll(e=>{e.removed&&m.push(e)}),n.removeUnorderedMany(m.data,m.length),m.clear()}function q(){for(;A.length;){let e=A.shift();e.isActive&&e.callback()}u.willDispatch=!1}function I(e=1,t){let s=f(),l=()=>{b(t)?s.reject(D()):e===0?s():(--e,p(()=>l()))};return l(),s.promise}function S(e){return I(1,e)}function V(){let e=f(),t=U({postRender:()=>{t.remove(),P(e)}});return e.promise}function W(e){return x(this,null,function*(){yield S(e),yield new Promise(t=>requestAnimationFrame(()=>{e?.aborted||t()}))})}var z=v.map(e=>new i(e)),B=new i("total");export{i as a,F as b,u as c,P as d,U as e,Q as f,I as g,S as h,V as i,W as j,z as k,B as l};
