import{a as oe}from"./chunk-SCMRG5OB.js";import{a as ne}from"./chunk-ACCRJLLW.js";import{a as re}from"./chunk-PAEROXLO.js";import{a as ae}from"./chunk-4Y7EKSO4.js";import{d as te}from"./chunk-456M7HFK.js";import{m as ee}from"./chunk-TPNSUEHH.js";import{a as Z}from"./chunk-CZ6CGC7I.js";import{a as Y}from"./chunk-BPWNCOXC.js";import{a as k}from"./chunk-AVMO6LCR.js";import{a as X}from"./chunk-6F25LG6O.js";import{a as H,d as E}from"./chunk-6RBQSBA2.js";import{Q as ie}from"./chunk-KALOJIUA.js";import{h as Q}from"./chunk-RNC4P66O.js";import{a as M,b as C,d as j}from"./chunk-OLOKUDVI.js";import{a as v,b as K}from"./chunk-BAEF3CT6.js";import{o as R}from"./chunk-AUAZP44J.js";import{d as O}from"./chunk-KNVXE32P.js";import{H as q,z as T}from"./chunk-76ATOSLU.js";import{a as W,f as g}from"./chunk-VTHXE323.js";var se=K()({AIX:"aix",EPS:"eps",GIF:"gif",JPG:"jpg",PDF:"pdf",PNG32:"png32",PNG8:"png8",SVG:"svg",SVGZ:"svgz",TIFF:"tiff"},{ignoreUnknown:!1});var N=new v({MAP_ONLY:"map-only","A3 Landscape":"a3-landscape","A3 Portrait":"a3-portrait","A4 Landscape":"a4-landscape","A4 Portrait":"a4-portrait","Letter ANSI A Landscape":"letter-ansi-a-landscape","Letter ANSI A Portrait":"letter-ansi-a-portrait","Tabloid ANSI B Landscape":"tabloid-ansi-b-landscape","Tabloid ANSI B Portrait":"tabloid-ansi-b-portrait"}),et=N.fromJSON.bind(N),le=N.toJSON.bind(N);function ce(){return{layerDefinition:{name:"multipointLayer",geometryType:"esriGeometryMultipoint",drawingInfo:{renderer:null}},featureSet:{geometryType:"esriGeometryMultipoint",features:[]}}}function ue(){return{layerDefinition:{name:"polygonLayer",geometryType:"esriGeometryPolygon",drawingInfo:{renderer:null}},featureSet:{geometryType:"esriGeometryPolygon",features:[]}}}function U(){return{layerDefinition:{name:"pointLayer",geometryType:"esriGeometryPoint",drawingInfo:{renderer:null}},featureSet:{geometryType:"esriGeometryPoint",features:[]}}}function ye(){return{layerDefinition:{name:"polylineLayer",geometryType:"esriGeometryPolyline",drawingInfo:{renderer:null}},featureSet:{geometryType:"esriGeometryPolyline",features:[]}}}function fe(e,r=15){let t=e.canvas.width,a=e.canvas.height,i=e.getImageData(0,0,t,a).data,o,s,l,n,c,f;e:for(s=a;s--;)for(o=t;o--;)if(i[4*(t*s+o)+3]>r){f=s;break e}if(!f)return null;e:for(o=t;o--;)for(s=f+1;s--;)if(i[4*(t*s+o)+3]>r){c=o;break e}e:for(o=0;o<=c;++o)for(s=f+1;s--;)if(i[4*(t*s+o)+3]>r){l=o;break e}e:for(s=0;s<=f;++s)for(o=l;o<=c;++o)if(i[4*(t*s+o)+3]>r){n=s;break e}return{x:l,y:n,width:c-l,height:f-n}}function G(e){if(!e.attributionVisible)return;let r;return typeof e.originOf=="function"&&e.originOf("copyright")==="user"&&(r=e.copyright),r||!e.hasAttributionData?(r??=e.portalItem?.accessInformation,r??=e.copyright,r??void 0):void 0}function pe(e,r){let t=r.color?.clone()??new X([0,255,255]),a=r.haloColor?.clone()??t.clone();switch(e){case"envelope":case"polygon":return t.a*=r.fillOpacity??.25,new Y({color:t,outline:new k({color:a}),style:"solid"});case"polyline":return new k({color:a});default:return a.a=1,new Z({color:a,outline:null})}}function de(e,r){let t=e.allLayerViews.items;if(r===e.scale)return t.filter(i=>!i.suspended);let a=new Array;for(let i of t){let o=i.parent;o&&o!==i.view&&(Le(o)||Ie(o))&&!a.includes(o)||i.visible&&i.visibleAtCurrentTimeExtent&&te(i.layer.effectiveScaleRange,r)&&a.push(i)}return a}function me(e){return e?.type==="bing-maps"}function _(e){return e&&"blendMode"in e&&"effect"in e}function Le(e){return e.layer.type==="catalog"}function Ie(e){return e.layer.type==="group"}function ge(e){let r=e.layer;if(_(r)){let t=r.blendMode;if((!t||t==="normal")&&(r.effect||"featureEffect"in e&&e.featureEffect))return!0}return!1}var V=new v({"Attribute List Letter ANSI A Landscape":"attribute-list-letter-ansi-a-landscape","Attribute List Letter ANSI A Portrait":"attribute-list-letter-ansi-a-portrait","Attribute List With Group Letter ANSI A Landscape":"attribute-list-with-group-letter-ansi-a-landscape","Attribute List With Group Letter ANSI A Portrait":"attribute-list-with-group-letter-ansi-a-portrait","Page per Feature Letter ANSI A Landscape":"page-per-feature-letter-ansi-a-landscape","Page per Feature Letter ANSI A Portrait":"page-per-feature-letter-ansi-a-portrait"}),ct=V.fromJSON.bind(V),be=V.toJSON.bind(V);var he={Feet:"ft",Kilometers:"km",Meters:"m",Miles:"mi"},we=new v({esriFeet:"Feet",esriKilometers:"Kilometers",esriMeters:"Meters",esriMiles:"Miles"}),xe=new v({esriExecutionTypeSynchronous:"sync",esriExecutionTypeAsynchronous:"async"}),z=new Map;function Ot(e,r,t){return g(this,null,function*(){let a=yield B(e,t),i=yield De(r,a);if((yield ve(e,t))==="sync"){let{results:l}=yield oe(e,i,void 0,t);return l?.[0]?.value}let o=yield re(e,i,void 0,t);yield o.waitForJobCompletion({interval:r.updateDelay});let{value:s}=yield o.fetchResultData("Output_File",null,t);return s})}function B(e,r){return g(this,null,function*(){let t=Pe(e),a=z.get(t)??{gpServerUrl:t,legendLayerNameMap:{},legendLayers:[]};return a.gpMetadata??=(yield R(t,H({f:"json"},r))).data,a.cimVersion=a.gpMetadata.cimVersion,z.set(t,a),a})}function ve(e,r){return g(this,null,function*(){return He(yield B(e,r))})}function Mt(e,r){return g(this,null,function*(){return(yield B(e,r)).gpMetadata.tasks})}function De(e,r){return g(this,null,function*(){r=r||{is11xService:!1,legendLayerNameMap:{},legendLayers:[]};let t=e.template||new ne;t.showLabels==null&&(t.showLabels=!0);let a=t.exportOptions,i,o=le(t.layout);if(a&&(i={dpi:a.dpi},o?.toLowerCase()==="map_only"||o==="")){let{width:u,height:p}=a;i.outputSize=u!=null&&p!=null?[u,p]:void 0}let s=t.layoutOptions,l;if(s){let u,p;s.scalebarUnit==="Miles"||s.scalebarUnit==="Kilometers"?(u="Kilometers",p="Miles"):s.scalebarUnit!=="Meters"&&s.scalebarUnit!=="Feet"||(u="Meters",p="Feet"),l={titleText:s.titleText,authorText:s.authorText,copyrightText:s.copyrightText,customTextElements:s.customTextElements,elementOverrides:s.elementOverrides,scaleBarOptions:u||p?{metricUnit:we.toJSON(u)??void 0,metricLabel:u?he[u]:void 0,nonMetricUnit:we.toJSON(p)??void 0,nonMetricLabel:p?he[p]:void 0}:void 0}}let n=null;s?.legendLayers&&(n=s.legendLayers.map(u=>{let p=u.layerId;r.legendLayerNameMap[p]=u.title;let b={id:p};return u.subLayerIds&&(b.subLayerIds=u.subLayerIds),b}));let c=yield Te(e,t,r);if(c.operationalLayers){let u=new RegExp("[\\u4E00-\\u9FFF\\u0E00-\\u0E7F\\u0900-\\u097F\\u3040-\\u309F\\u30A0-\\u30FF\\u31F0-\\u31FF]"),p=/[\u0600-\u06FF]/,b=y=>{let h=y.text,d=y.font,m=d?.family?.toLowerCase();h&&d&&(m==="arial"||m==="arial unicode ms")&&(d.family=u.test(h)?"Arial Unicode MS":"Arial",d.style!=="normal"&&p.test(h)&&(d.family="Arial Unicode MS"))};for(let y of c.operationalLayers)if(y.featureCollection?.layers)for(let h of y.featureCollection.layers){if(h.layerDefinition?.drawingInfo?.renderer?.symbol){let d=h.layerDefinition.drawingInfo.renderer;d.symbol.type==="esriTS"&&b(d.symbol)}if(h.featureSet?.features)for(let d of h.featureSet.features)d.symbol&&d.symbol.type==="esriTS"&&b(d.symbol)}}e.outSpatialReference&&(c.mapOptions.spatialReference=e.outSpatialReference.toJSON()),Object.assign(c,{exportOptions:i,layoutOptions:l||{}}),Object.assign(c.layoutOptions,{legendOptions:{operationalLayers:n??r.legendLayers.slice()}}),r.legendLayers.length=0,z.set(r.gpServerUrl,r);let f={Web_Map_as_JSON:JSON.stringify(c),Format:se.toJSON(t.format),Layout_Template:o,Layout_Item_ID:void 0,Report_Template:be(t.report),Report_Item_ID:void 0};if(t.layoutItem){delete f.Layout_Template;let u=t.layoutItem;yield u.load(),u.access!=="public"&&O&&(yield O.getCredential(r.gpServerUrl)),f.Layout_Item_ID=JSON.stringify({id:u.id})}if(t.reportItem){delete f.Report_Template;let u=t.reportItem;yield u.load(),u.access!=="public"&&O&&(yield O.getCredential(r.gpServerUrl)),f.Report_Item_ID=JSON.stringify({id:u.id})}return e.extraParameters&&Object.assign(f,e.extraParameters),f})}function Te(e,r,t){return g(this,null,function*(){let a=e.view,i=a.spatialReference,o={operationalLayers:yield Oe(a,r,t)};r.includeTables&&(o.tables=yield Be(a));let s=e.extent||t.ssExtent||a.extent;if(i?.isWrappable&&(s=s.clone()._normalize(!0),i=s.spatialReference),o.mapOptions={extent:s&&s.toJSON(),spatialReference:i&&i.toJSON(),showAttribution:r.attributionVisible},t.ssExtent=null,a.background&&(o.background=a.background.toJSON()),a.rotation&&(o.mapOptions.rotation=-a.rotation),r.scalePreserved&&(o.mapOptions.scale=r.outScale||a.scale),a.timeExtent!=null){let l=a.timeExtent.start!=null?a.timeExtent.start.getTime():null,n=a.timeExtent.end!=null?a.timeExtent.end.getTime():null;o.mapOptions.time=[l,n]}return r.reportOptions&&(o.reportOptions=r.reportOptions),o})}function Pe(e){let r=e,t=r.lastIndexOf("/GPServer/");return t>0&&(r=r.slice(0,t+9)),r}function Oe(e,r,t){return g(this,null,function*(){let a=[],i={layerView:null,printTemplate:r,view:e},o=0;r.scalePreserved&&(o=r.outScale||e.scale);let s=de(e,o);for(let l of s){let n=l.layer;if(!n.loaded||"layers"in n)continue;let c;i.layerView=l,c=ge(l)?yield D(n,i,t):me(n)?Me(n):n?.type==="csv"?yield Ee(n,i,t):n?.type==="catalog-footprint"?yield Ae(n,i,t):n?.type==="feature"?yield Ne(n,i,t):n?.type==="geojson"?yield Ve(n,i,t):n?.type==="graphics"?yield Fe(n,i,t):n?.type==="imagery"?Je(n,t):n?.type==="imagery-tile"?yield Re(n,i,t):n?.type==="kml"?yield Ce(n,i,t):n?.type==="map-image"?ke(n,i,t):n?.type==="map-notes"?yield Ue(i,t):n?.type==="open-street-map"?Ge():n?.type==="stream"?yield _e(n,i,t):n?.type==="subtype-group"?yield ze(n,t):n?.type==="tile"?$e(n,t):n?.type==="vector-tile"?yield We(n,i,t):n?.type==="web-tile"?qe(n):n?.type==="wfs"?yield Ke(n,i,t):n?.type==="wms"?je(n,t):n?.type==="wmts"?Qe(n):yield D(n,i,t),c&&(Array.isArray(c)?a.push(...c):(c.id=n.id,c.title=t.legendLayerNameMap[n.id]||n.title,c.opacity=l.fullOpacity,c.minScale=n.minScale||0,c.maxScale=n.maxScale||0,_(n)&&n.blendMode&&n.blendMode!=="normal"&&(c.blendMode=n.blendMode),a.push(c)))}if(o)for(let l of a)l.minScale=0,l.maxScale=0;if(e.graphics?.length){let l=yield L(null,e.graphics,r,t);l&&a.push(l)}return a})}function Me(e){return{culture:e.culture,key:e.key,type:"BingMaps"+(e.style==="aerial"?"Aerial":e.style==="hybrid"?"Hybrid":"Road")}}function Ae(i,o,s){return g(this,arguments,function*(e,{layerView:r,printTemplate:t},a){if(parseFloat(a.cimVersion)<3.1)return L(e,yield A(r),t,a);let l=e.parent,n={id:(c=S(l,"web-map")).id,url:c.url,layerType:c.layerType,customParameters:c.customParameters,dynamicGroupLayer:{visibility:!1},footprintLayer:c.footprintLayer,layerDefinition:c.layerDefinition};var c;return x(n,l),n})}function Ee(e,r,t){return g(this,null,function*(){e.legendEnabled&&t.legendLayers.push({id:e.id});let a=r.layerView,i=r.printTemplate;if(!(a.filter||e.portalItem&&e.portalItem.access!=="public")){let o=S(e,"web-map");return o.type="CSV",delete o.popupInfo,delete o.layerType,o.showLabels=i.showLabels&&e.labelsVisible,o}return L(e,yield A(a),i,t)})}function L(e,r,t,a){return g(this,null,function*(){let i,o=ue(),s=ye(),l=U(),n=ce(),c=U();if(c.layerDefinition.name="textLayer",delete c.layerDefinition.drawingInfo,e){if(e.declaredClass==="esri.layers.FeatureLayer"||e.declaredClass==="esri.layers.StreamLayer"?o.layerDefinition.name=s.layerDefinition.name=l.layerDefinition.name=n.layerDefinition.name=a.legendLayerNameMap[e.id]||e.arcgisProps?.title||e.title:e.declaredClass==="esri.layers.GraphicsLayer"&&(r=e.graphics.items),e.renderer){let d=e.renderer.toJSON(),m=o.layerDefinition.drawingInfo;m&&(m.renderer=d);let w=s.layerDefinition.drawingInfo;w&&(w.renderer=d);let I=l.layerDefinition.drawingInfo;I&&(I.renderer=d);let P=n.layerDefinition.drawingInfo;P&&(P.renderer=d)}if(t.showLabels&&e.labelsVisible&&typeof e.write=="function"){let d=S(e,"web-map"),m=d.layerDefinition?.drawingInfo?.labelingInfo;if(m){i=!0;let w=o.layerDefinition.drawingInfo;w&&(w.labelingInfo=m);let I=s.layerDefinition.drawingInfo;I&&(I.labelingInfo=m);let P=l.layerDefinition.drawingInfo;P&&(P.labelingInfo=m);let $=n.layerDefinition.drawingInfo;$&&($.labelingInfo=m)}}}let f;e?.renderer||i||(delete o.layerDefinition.drawingInfo,delete s.layerDefinition.drawingInfo,delete l.layerDefinition.drawingInfo,delete n.layerDefinition.drawingInfo);let u=e?.fieldsIndex,p=e?.renderer;if(u){let d=new Set;i&&(yield ie(d,e)),p&&typeof p.collectRequiredFields=="function"&&(yield p.collectRequiredFields(d,u)),f=Array.from(d);let m=u.fields.map(w=>w.toJSON());o.layerDefinition.fields=m,s.layerDefinition.fields=m,l.layerDefinition.fields=m,n.layerDefinition.fields=m}let b=r?.length,y;for(let d=0;d<b;d++){let m=r[d]||r.at(d);if(m.visible!==!1&&m.geometry){if(y=m.toJSON(),y.hasOwnProperty("popupTemplate")&&delete y.popupTemplate,y.geometry?.z&&delete y.geometry.z,y.symbol&&(y.symbol.angle||delete y.symbol.angle,J(y.symbol)?y.symbol=yield F(y.symbol,a):y.symbol.text&&delete y.attributes),(!t||!t.forceFeatureAttributes)&&f?.length){let w={};for(let I of f)y.attributes?.hasOwnProperty(I)&&(w[I]=y.attributes[I]);y.attributes=w}m.geometry.type==="polygon"?o.featureSet.features.push(y):m.geometry.type==="polyline"?s.featureSet.features.push(y):m.geometry.type==="point"?y.symbol?.text?c.featureSet.features.push(y):l.featureSet.features.push(y):m.geometry.type==="multipoint"?n.featureSet.features.push(y):m.geometry.type==="extent"&&(y.geometry=Q.fromExtent(m.geometry).toJSON(),o.featureSet.features.push(y))}}let h=[o,s,n,l,c].filter(d=>d.featureSet.features.length>0);for(let d of h){let m=d.featureSet.features.every(w=>w.symbol);if(m&&(!t||!t.forceFeatureAttributes))for(let w of d.featureSet.features)delete w.attributes;m&&delete d.layerDefinition.drawingInfo,d.layerDefinition.drawingInfo?.renderer&&(yield Se(d.layerDefinition.drawingInfo.renderer,a))}return h.length?{featureCollection:{layers:h},showLabels:i}:null})}function Ne(e,r,t){return g(this,null,function*(){let a,i=e.renderer,o=parseFloat(t.cimVersion);if(e.featureReduction?.type==="binning"||e.featureReduction?.type==="cluster"&&o<2.9||i?.type==="pie-chart"||i?.type==="dot-density"&&o<2.6)return D(e,r,t);e.legendEnabled&&t.legendLayers.push({id:e.id});let s=r.layerView,{printTemplate:l,view:n}=r,c=e.source?.type!=="feature-layer"&&e.source?.type!=="ogc-feature";if(s.filter||c||!i||"field"in i&&i.field!=null&&!e.getField(i.field)){let u=yield A(s);a=yield L(e,u,l,t)}else{if(a={id:(f=S(e)).id,title:f.title,url:f.url,layerType:f.layerType,customParameters:f.customParameters,layerDefinition:f.layerDefinition,charts:l.includeCharts?f.charts:void 0},l.attributionVisible&&(a.credits=G(e)),a.showLabels=l.showLabels&&e.labelsVisible,x(a,e),delete a.layerDefinition?.featureReduction?.disablePopup,delete a.layerDefinition?.featureReduction?.popupInfo,s.displayFilterEnabled||delete a.layerDefinition?.displayFilterInfo,a.layerDefinition?.drawingInfo?.renderer&&(delete a.layerDefinition.minScale,delete a.layerDefinition.maxScale,yield Se(a.layerDefinition.drawingInfo.renderer,t),"visualVariables"in i&&i.visualVariables?.[0])){let p=i.visualVariables[0];if(p.type==="size"&&p.maxSize&&typeof p.maxSize!="number"&&p.minSize&&typeof p.minSize!="number"){let b=ee(p,n.scale);a.layerDefinition.drawingInfo.renderer.visualVariables[0].minSize=b.minSize,a.layerDefinition.drawingInfo.renderer.visualVariables[0].maxSize=b.maxSize}}let u=ae(s);if(u&&(a.layerDefinition??={},a.layerDefinition.definitionExpression=a.layerDefinition.definitionExpression?`(${a.layerDefinition.definitionExpression}) AND (${u})`:u),e.gdbVersion&&(a.layerDefinition??={},a.layerDefinition.gdbVersion=e.gdbVersion),s.hasHighlight&&"highlightIds"in s){let p=s;a.selectionObjectIds=p.highlightIds,a.selectionSymbol=pe(e.geometryType,p.highlightOptions??n.highlightOptions)}}var f;return a})}function Ve(e,r,t){return g(this,null,function*(){return e.featureReduction?.type==="binning"||e.featureReduction?.type==="cluster"?D(e,r,t):(e.legendEnabled&&t.legendLayers.push({id:e.id}),L(e,yield A(r.layerView),r.printTemplate,t))})}function Fe(a,i,o){return g(this,arguments,function*(e,{printTemplate:r},t){return L(e,null,r,t)})}function Je(e,r){e.legendEnabled&&r.legendLayers.push({id:e.id});let t={layerType:(a=S(e)).layerType,customParameters:a.customParameters};var a;return t.bandIds=e.bandIds,t.compressionQuality=e.compressionQuality,t.format=e.format,t.interpolation=e.interpolation,(e.mosaicRule||e.definitionExpression)&&(t.mosaicRule=e.exportImageServiceParameters.mosaicRule.toJSON()),e.rasterFunction&&(t.renderingRule=e.rasterFunction.toJSON()),e.renderer&&(t.layerDefinition??={},t.layerDefinition.drawingInfo??={},t.layerDefinition.drawingInfo.renderer=e.renderer.toJSON()),x(t,e),t}function Re(e,r,t){return g(this,null,function*(){if(e.renderer?.type==="flow")return D(e,r,t);e.legendEnabled&&t.legendLayers.push({id:e.id});let a={bandIds:(i=S(e)).bandIds,customParameters:i.customParameters,interpolation:i.interpolation,layerDefinition:i.layerDefinition};var i;return a.layerType="ArcGISImageServiceLayer",x(a,e),a})}function Ce(e,r,t){return g(this,null,function*(){let a=r.printTemplate;if(!e.portalItem||e.portalItem.access==="public"){let c=S(e,"web-map");return c.type="kml",delete c.layerType,c.url=T(e.url),c}let i=[],o=r.layerView,s="data:image/png;base64,";o.allVisibleMapImages.forEach((c,f)=>{let u={id:`${e.id}_image${f}`,type:"image",title:e.id,minScale:e.minScale||0,maxScale:e.maxScale||0,opacity:o.fullOpacity,extent:c.extent};c.href.startsWith(s)?u.imageData=c.href.slice(s.length):u.url=c.href,i.push(u)});let l=[...o.allVisiblePoints.items,...o.allVisiblePolylines.items,...o.allVisiblePolygons.items],n=W({id:e.id},yield L(null,l,a,t));return i.push(n),i})}function ke(e,{printTemplate:r,view:t},a){let i,o={id:e.id,subLayerIds:[]},s=[],l=t.scale,n=f=>{let u=l===0,p=f.minScale===0||l<=f.minScale,b=f.maxScale===0||l>=f.maxScale;if(f.visible&&(u||p&&b))if(f.sublayers)f.sublayers.forEach(n);else{let y=f.toExportImageJSON(),h={id:f.id,name:f.title,layerDefinition:{definitionExpression:y.definitionExpression,drawingInfo:y.drawingInfo,orderBy:y.orderBy,source:y.source}};s.unshift(h),o.subLayerIds.push(f.id)}};var c;return e.sublayers&&e.sublayers.forEach(n),s.length&&(s=s.map(({id:f,name:u,layerDefinition:p})=>({id:f,name:u,layerDefinition:p})),i={layerType:(c=S(e)).layerType,customParameters:c.customParameters},i.layers=s,i.visibleLayers=e.capabilities?.exportMap?.supportsDynamicLayers?void 0:o.subLayerIds,r.attributionVisible&&(i.credits=G(e)),e.gdbVersion&&(i.gdbVersion=e.gdbVersion),x(i,e),e.legendEnabled&&a.legendLayers.push(o)),i}function Ue(a,i){return g(this,arguments,function*({layerView:e,printTemplate:r},t){let o=[],s=e.layer;if(s.featureCollections!=null)for(let l of s.featureCollections){let n=yield L(l,l.source,r,t);n&&o.push(...n.featureCollection.layers)}else if(s.sublayers!=null)for(let l of s.sublayers){let n=yield L(null,l.graphics,r,t);n&&o.push(...n.featureCollection.layers)}return{featureCollection:{layers:o}}})}function Ge(){return{type:"OpenStreetMap"}}function D(i,o,s){return g(this,arguments,function*(e,{printTemplate:r,view:t},a){let l={type:"image"},n={format:"png",ignoreBackground:!0,ignorePadding:!0,layers:[e]};t.rotation!==0&&(n.rotation=0);let c=a.ssExtent||t.state.extent.clone(),f=96,u=!0,p=!0;if(r.exportOptions){let y=r.exportOptions;y.dpi!=null&&y.dpi>0&&(f=y.dpi),y.width!=null&&y.width>0&&(u=y.width%2==t.width%2),y.height!=null&&y.height>0&&(p=y.height%2==t.height%2)}if(r.layout==="map-only"&&r.scalePreserved&&(!r.outScale||r.outScale===t.scale)&&f===96&&(!u||!p)&&t.state.extent.equals(t.extent)&&(n.area={x:0,y:0,width:t.width,height:t.height},u||(n.area.width-=1),p||(n.area.height-=1),!a.ssExtent)){let y=t.toMap(j(n.area.width,n.area.height));c.ymin=y.y,c.xmax=y.x,a.ssExtent=c}l.extent=c.clone()._normalize(!0).toJSON();let b=yield t.takeScreenshot(n);return l.imageData=q(b.dataUrl)?.data,l})}function _e(i,o,s){return g(this,arguments,function*(e,{layerView:r,printTemplate:t},a){return e.legendEnabled&&a.legendLayers.push({id:e.id}),L(e,yield A(r),t,a)})}function ze(e,r){return g(this,null,function*(){if(e.legendEnabled)for(let i of e.sublayers)i.legendEnabled&&r.legendLayers.push({id:i.id});let t={customParameters:(a=S(e)).customParameters,effect:a.effect,layerDefinition:a.layerDefinition,layerType:a.layerType,layers:a.layers,url:a.url};var a;if(Array.isArray(t.layers))for(let i of t.layers)delete i.popupInfo;return x(t,e),t})}function Be(e){return g(this,null,function*(){let r=[],t=[];for(let i of e.map.allTables)i.type!=="feature"||i.loaded||t.push(i.load());t.length&&(yield Promise.allSettled(t));for(let i of e.map.allTables)if(i.type==="feature"&&i.loaded&&i.isTable&&i.source?.type==="feature-layer"){let o={id:(a=S(i)).id,title:a.title,customParameters:a.customParameters,layerDefinition:{definitionExpression:a.layerDefinition?.definitionExpression},url:a.url};x(o,i),r.push(o)}var a;return r.length?r:void 0})}function $e(e,r){e.legendEnabled&&r.legendLayers.push({id:e.id});let t={layerType:(a=S(e)).layerType,customParameters:a.customParameters};var a;return x(t,e),t}function We(e,r,t){return g(this,null,function*(){let a=r.layerView;if(e.serviceUrl&&e.styleUrl&&!a.spriteSourceChanged&&!a.styleChanged){let i=E(e.styleUrl,e.apiKey),o=E(e.serviceUrl,e.apiKey);if(!i&&!o||t.cimVersion!=="2.1.0"){let s={type:"VectorTileLayer"};return s.styleUrl=T(e.styleUrl),s.token=i,o!==i&&(s.additionalTokens=[{url:e.serviceUrl,token:o}]),s}}return D(e,r,t)})}function qe(e){let r=e.urlTemplate?.replace(/\${/g,"{"),t={type:"WebTiledLayer",urlTemplate:r,credits:e.copyright};return e.subDomains&&e.subDomains.length>0&&(t.subDomains=e.subDomains),t}function Ke(e,r,t){return g(this,null,function*(){return parseFloat(t.cimVersion)<3.5?D(e,r,t):(e.legendEnabled&&t.legendLayers.push({id:e.id}),{layerType:(a=S(e,"web-map")).layerType,layerDefinition:a.layerDefinition,url:a.url,wfsInfo:a.wfsInfo});var a})}function je(e,r){let t,a=[],i=o=>{o.visible&&(o.sublayers?o.sublayers.forEach(i):o.name&&a.unshift(o.name))};return e.sublayers&&e.sublayers.forEach(i),a.length&&(e.legendEnabled&&r.legendLayers.push({id:e.id,subLayerIds:a}),t={type:"wms",customLayerParameters:e.customLayerParameters,customParameters:e.customParameters,transparentBackground:e.imageTransparency,visibleLayers:a,url:T(e.url),version:e.version}),t}function Qe(e){let r=e.activeLayer;return{type:"wmts",customLayerParameters:e.customLayerParameters,customParameters:e.customParameters,format:r.imageFormat,layer:r.id,style:r.styleId,tileMatrixSet:r.tileMatrixSetId,url:T(e.url)}}function x(e,r){r.url&&(e.url=T(e.url||r.url),e.token=E(e.url,r.apiKey))}function F(e,r){return g(this,null,function*(){r.canvas||(r.canvas=document.createElement("canvas"));let t=1024;r.canvas.width=t,r.canvas.height=t;let a=r.canvas.getContext("2d"),i,o;if(e.path){let s=new Path2D(e.path);s.closePath(),a.fillStyle=Array.isArray(e.color)?`rgba(${e.color[0]},${e.color[1]},${e.color[2]},${e.color[3]/255})`:"rgb(0,0,0)",a.fill(s);let l=fe(a);if(!l)return null;a.clearRect(0,0,t,t);let n=M(e.size)/Math.max(l.width,l.height);a.scale(n,n);let c=t/n,f=c/2-l.width/2-l.x,u=c/2-l.height/2-l.y;if(a.translate(f,u),Array.isArray(e.color)&&a.fill(s),e.outline?.width&&Array.isArray(e.outline.color)){let b=e.outline;a.lineWidth=M(b.width)/n,a.lineJoin="round",a.strokeStyle=`rgba(${b.color[0]},${b.color[1]},${b.color[2]},${b.color[3]/255})`,a.stroke(s),l.width+=a.lineWidth,l.height+=a.lineWidth}l.width*=n,l.height*=n;let p=a.getImageData(t/2-l.width/2,t/2-l.height/2,Math.ceil(l.width),Math.ceil(l.height));i=p.width,o=p.height,a.canvas.width=i,a.canvas.height=o,a.putImageData(p,0,0)}else{let s=e.contentType==="image/svg+xml"?"data:image/svg+xml;base64,"+e.imageData:e.url,l=(yield R(s,{responseType:"image"})).data;i=M(e.width),o=M(e.height),a.canvas.width=i,a.canvas.height=o,a.drawImage(l,0,0,a.canvas.width,a.canvas.height)}return{type:"esriPMS",imageData:a.canvas.toDataURL("image/png").slice(22),angle:e.angle,contentType:"image/png",height:C(o),width:C(i),xoffset:e.xoffset,yoffset:e.yoffset}})}function Se(e,r){return g(this,null,function*(){let t=e.type;if(t==="simple"&&J(e.symbol))e.symbol=yield F(e.symbol,r);else if(t==="uniqueValue"||t==="classBreaks"){J(e.defaultSymbol)&&(e.defaultSymbol=yield F(e.defaultSymbol,r));let a=e[t==="uniqueValue"?"uniqueValueInfos":"classBreakInfos"];if(a)for(let i of a)J(i.symbol)&&(i.symbol=yield F(i.symbol,r))}})}function A(e){return g(this,null,function*(){return e.queryFeatures(e.createQuery()).then(r=>r.features)})}function S(e,r){return e.write({},{ignorePersistenceEnabled:!0,origin:r})??{}}function He(e){return e.gpMetadata?.executionType?xe.fromJSON(e.gpMetadata.executionType):"sync"}function J(e){return e&&(e.path||e.contentType==="image/svg+xml"||e.url?.endsWith(".svg"))}export{se as a,et as b,z as c,Ot as d,ve as e,Mt as f,De as g,Pe as h};
