import{a as n}from"./chunk-62UTK67Z.js";import{b}from"./chunk-ACP3S2CH.js";import{a as i}from"./chunk-QGVBCWUY.js";import{H as v}from"./chunk-MYO4NP2N.js";import{e as s}from"./chunk-NFIPKH6V.js";import{l as m}from"./chunk-5QEXLALV.js";import{L as c}from"./chunk-4PTIEWMT.js";var l;(function(e){e[e.WhenToolEditable=0]="WhenToolEditable",e[e.WhenToolNotEditable=1]="WhenToolNotEditable",e[e.Always=2]="Always"})(l||(l={}));var u=class{constructor(){this._isToolEditable=!0,this._manipulators=new b,this._resourceContexts={manipulator3D:{}},this._attached=!1}set isToolEditable(t){this._isToolEditable=t}get length(){return this._manipulators.length}add(t,a=l.WhenToolEditable){this.addMany([t],a)}addMany(t,a=l.WhenToolEditable){for(let r of t){let h={manipulator:r,visibilityPredicate:a,attached:!1};this._manipulators.add(h),this._attached&&this._updateManipulatorAttachment(h)}}remove(t){for(let a=0;a<this._manipulators.length;a++)if(this._manipulators.at(a).manipulator===t){let r=this._manipulators.splice(a,1)[0];this._detachManipulator(r);break}}removeAll(){this._manipulators.forEach(t=>{this._detachManipulator(t)}),this._manipulators.removeAll()}attach(){this._manipulators.forEach(t=>{this._updateManipulatorAttachment(t)}),this._attached=!0}detach(){this._manipulators.forEach(t=>{this._detachManipulator(t)}),this._attached=!1}destroy(){this.detach(),this._manipulators.forEach(({manipulator:t})=>t.destroy()),this._manipulators.destroy(),this._resourceContexts=null}on(t,a){return this._manipulators.on(t,r=>{a(r)})}forEach(t){for(let a of this._manipulators.items)t(a)}some(t){return this._manipulators.items.some(t)}toArray(){let t=[];return this.forEach(a=>t.push(a.manipulator)),t}intersect(t,a){let r=null,h=Number.MAX_VALUE;return this._manipulators.forEach(({manipulator:p,attached:_})=>{if(!_||!p.interactive)return;let d=p.intersectionDistance(t,a);d!=null&&d<h&&(h=d,r=p)}),r}_updateManipulatorAttachment(t){this._isManipulatorItemVisible(t)?this._attachManipulator(t):this._detachManipulator(t)}_attachManipulator(t){t.attached||(t.manipulator.attach&&t.manipulator.attach(this._resourceContexts),t.attached=!0)}_detachManipulator(t){if(!t.attached)return;let a=t.manipulator;a.grabbing=!1,a.dragging=!1,a.hovering=!1,a.selected=!1,a.detach&&a.detach(this._resourceContexts),t.attached=!1}_isManipulatorItemVisible(t){return t.visibilityPredicate===l.Always||(this._isToolEditable?t.visibilityPredicate===l.WhenToolEditable:t.visibilityPredicate===l.WhenToolNotEditable)}};var o=class extends v{constructor(e){super(e),this.manipulators=new u,this.automaticManipulatorSelection=!0,this.hasGrabbedManipulators=!1,this.hasHoveredManipulators=!1,this.firstGrabbedManipulator=null,this.created=!1,this.removeIncompleteOnCancel=!0,this._editableFlags=new Map([[n.MANAGER,!0],[n.USER,!0]]),this._creationFinishedResolver=c()}get active(){return this.view!=null&&this.view.activeTool===this}set visible(e){this._get("visible")!==e&&(this._set("visible",e),this._syncVisible())}get editable(){return this.getEditableFlag(n.USER)}set editable(e){this.setEditableFlag(n.USER,e)}get updating(){return!1}get cursor(){return null}get hasFocusedManipulators(){return this.hasGrabbedManipulators||this.hasHoveredManipulators}destroy(){this.manipulators.destroy(),this._set("view",null)}onAdd(){this._syncVisible()}activate(){this.view!=null&&(this.view.focus(),this.onActivate())}deactivate(){this.onDeactivate()}handleInputEvent(e){this.onInputEvent(e)}handleInputEventAfter(e){this.onInputEventAfter(e)}setEditableFlag(e,t){this._editableFlags.set(e,t),this.manipulators.isToolEditable=this.internallyEditable,this._updateManipulatorAttachment(),e===n.USER&&this.notifyChange("editable"),this.onEditableChange(),this.onManipulatorSelectionChanged()}getEditableFlag(e){return this._editableFlags.get(e)??!1}endDrag(){let e=this.view.inputManager.latestPointerLocation;if(!e)return;let t=!1;this.manipulators.forEach(({manipulator:a})=>{a.dragging&&(t=!0,a.events.emit("drag",{action:"end",start:e,screenPoint:e}))}),t&&(this.view.toolViewManager.activeTool=null)}whenCreated(){return this._creationFinishedResolver.promise}onManipulatorSelectionChanged(){}onActivate(){}onDeactivate(){}onShow(){}onHide(){}onEditableChange(){}onInputEvent(e){}onInputEventAfter(e){}get internallyEditable(){return this.getEditableFlag(n.USER)&&this.getEditableFlag(n.MANAGER)}finishToolCreation(){this.created||this._creationFinishedResolver.resolve(this),this._set("created",!0)}_syncVisible(){if(this.initialized){if(this.visible)this._show();else if(this._hide(),this.active)return void(this.view.activeTool=null)}}_show(){this._updateManipulatorAttachment(),this.onShow()}_hide(){this._updateManipulatorAttachment(),this.onHide()}_updateManipulatorAttachment(){this.visible?this.manipulators.attach():this.manipulators.detach()}};i([s({constructOnly:!0})],o.prototype,"view",void 0),i([s({readOnly:!0})],o.prototype,"active",null),i([s({value:!0})],o.prototype,"visible",null),i([s({value:!0})],o.prototype,"editable",null),i([s({readOnly:!0})],o.prototype,"manipulators",void 0),i([s({readOnly:!0})],o.prototype,"updating",null),i([s()],o.prototype,"cursor",null),i([s({readOnly:!0})],o.prototype,"automaticManipulatorSelection",void 0),i([s()],o.prototype,"hasFocusedManipulators",null),i([s()],o.prototype,"hasGrabbedManipulators",void 0),i([s()],o.prototype,"hasHoveredManipulators",void 0),i([s()],o.prototype,"firstGrabbedManipulator",void 0),i([s({readOnly:!0})],o.prototype,"created",void 0),i([s({readOnly:!0})],o.prototype,"removeIncompleteOnCancel",void 0),o=i([m("esri.views.interactive.InteractiveToolBase")],o);export{u as a,o as b};
