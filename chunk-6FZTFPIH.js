import{j as H}from"./chunk-J5AEP4US.js";import{a as Z}from"./chunk-YHRLMRSO.js";import{a as G}from"./chunk-L7NOU4T2.js";import{a as Y}from"./chunk-44A27HB7.js";import{a as X}from"./chunk-QXNVQZT7.js";import{a as b}from"./chunk-R3XLNYYB.js";import{a as q}from"./chunk-DJW5LMRG.js";import{a as B}from"./chunk-DEH76MSI.js";import{a as y}from"./chunk-ALWV3RJ2.js";import{c as _}from"./chunk-6B5XFA6F.js";import{a as P,b as w,c as I,g as T,h as A,i as R,k as O,l as N,m as E}from"./chunk-ZTOZWLEE.js";import{a as M}from"./chunk-BOVYXYHK.js";import{a as c,d as S,e as k}from"./chunk-HX2VGIR2.js";import{b as x}from"./chunk-EQZWYK27.js";var K=class extends Y{constructor(i,s,e){super(i,"vec4",X.Pass,(o,n,l)=>o.setUniform4fv(i,s(n,l)),e)}};var a,Q;(function(t){t[t.Undefined=0]="Undefined",t[t.DefinedSize=1]="DefinedSize",t[t.DefinedScale=2]="DefinedScale"})(a||(a={})),function(t){t[t.Undefined=0]="Undefined",t[t.DefinedAngle=1]="DefinedAngle"}(Q||(Q={}));var m=class{constructor(i){this.field=i}},V=class extends m{constructor(i){super(i),this.minSize=[0,0,0],this.maxSize=[0,0,0],this.offset=[0,0,0],this.factor=[0,0,0],this.type=[a.Undefined,a.Undefined,a.Undefined]}},C=class extends m{constructor(i){super(i),this.colors=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.values=[0,0,0,0,0,0,0,0]}},D=class extends m{constructor(i){super(i),this.values=[0,0,0,0,0,0,0,0],this.opacityValues=[0,0,0,0,0,0,0,0]}};var U=class{};function p(t){return t!=null}function r(t,i){t&&t.push(i)}function ot(t,i,s,e=y()){let o=t||0,n=i||0,l=s||0;return o!==0&&E(e,e,-o/180*Math.PI),n!==0&&O(e,e,n/180*Math.PI),l!==0&&N(e,e,l/180*Math.PI),e}function u(t,i,s,e,o){let n=t.minSize,l=t.maxSize;if(t.useSymbolValue){let v=e.symbolSize[s];return i.minSize[s]=v,i.maxSize[s]=v,i.offset[s]=i.minSize[s],i.factor[s]=0,i.type[s]=a.DefinedSize,!0}if(p(t.field))return p(t.stops)?t.stops.length===2&&c(t.stops[0].size)&&c(t.stops[1].size)?(W(t.stops[0].size,t.stops[1].size,t.stops[0].value,t.stops[1].value,i,s),i.type[s]=a.DefinedSize,!0):(r(o,"Could not convert size info: stops only supported with 2 elements"),!1):c(n)&&c(l)&&p(t.minDataValue)&&p(t.maxDataValue)?(W(n,l,t.minDataValue,t.maxDataValue,i,s),i.type[s]=a.DefinedSize,!0):t.valueUnit==="unknown"?(r(o,"Could not convert size info: proportional size not supported"),!1):b[t.valueUnit]!=null?(i.minSize[s]=-1/0,i.maxSize[s]=1/0,i.offset[s]=0,i.factor[s]=1/b[t.valueUnit],i.type[s]=a.DefinedSize,!0):(r(o,"Could not convert size info: scale-dependent size not supported"),!1);if(!p(t.field)){if(t.stops?.[0]&&c(t.stops[0].size))return i.minSize[s]=t.stops[0].size,i.maxSize[s]=t.stops[0].size,i.offset[s]=i.minSize[s],i.factor[s]=0,i.type[s]=a.DefinedSize,!0;if(c(n))return i.minSize[s]=n,i.maxSize[s]=n,i.offset[s]=n,i.factor[s]=0,i.type[s]=a.DefinedSize,!0}return r(o,"Could not convert size info: unsupported variant of sizeInfo"),!1}function W(t,i,s,e,o,n){let l=Math.abs(e-s)>0?(i-t)/(e-s):0;o.minSize[n]=l>0?t:i,o.maxSize[n]=l>0?i:t,o.offset[n]=t-s*l,o.factor[n]=l}function st(t,i,s,e){if(t.normalizationField||t.valueRepresentation)return r(e,"Could not convert size info: unsupported property"),null;if(!k(t.field))return r(e,"Could not convert size info: field is not a string"),null;if(i.size){if(t.field)if(i.size.field){if(t.field!==i.size.field)return r(e,"Could not convert size info: multiple fields in use"),null}else i.size.field=t.field}else i.size=new V(t.field);let o;switch(t.axis){case"width":return o=u(t,i.size,0,s,e),o?i:null;case"height":return o=u(t,i.size,2,s,e),o?i:null;case"depth":return o=u(t,i.size,1,s,e),o?i:null;case"width-and-depth":return o=u(t,i.size,0,s,e),o&&u(t,i.size,1,s,e),o?i:null;case null:case void 0:case"all":return o=u(t,i.size,0,s,e),o=o&&u(t,i.size,1,s,e),o=o&&u(t,i.size,2,s,e),o?i:null;default:return r(e,`Could not convert size info: unknown axis "${t.axis}""`),null}}function et(t,i,s){for(let o=0;o<3;++o){let n=i.unitInMeters;t.type[o]===a.DefinedSize&&(n*=i.modelSize[o],t.type[o]=a.DefinedScale),t.minSize[o]=t.minSize[o]/n,t.maxSize[o]=t.maxSize[o]/n,t.offset[o]=t.offset[o]/n,t.factor[o]=t.factor[o]/n}let e;if(t.type[0]!==a.Undefined)e=0;else if(t.type[1]!==a.Undefined)e=1;else{if(t.type[2]===a.Undefined)return r(s,"No size axis contains a valid size or scale"),!1;e=2}for(let o=0;o<3;++o)t.type[o]===a.Undefined&&(t.minSize[o]=t.minSize[e],t.maxSize[o]=t.maxSize[e],t.offset[o]=t.offset[e],t.factor[o]=t.factor[e],t.type[o]=t.type[e]);return!0}function $(t,i,s){t[4*i]=s.r/255,t[4*i+1]=s.g/255,t[4*i+2]=s.b/255,t[4*i+3]=s.a}function nt(t,i,s){if(t.normalizationField)return r(s,"Could not convert color info: unsupported property"),null;if(S(t.field)){if(!t.stops)return r(s,"Could not convert color info: missing stops or colors"),null;{if(t.stops.length>8)return r(s,"Could not convert color info: too many color stops"),null;i.color=new C(t.field);let e=t.stops;for(let o=0;o<8;++o){let n=e[Math.min(o,e.length-1)];i.color.values[o]=n.value,$(i.color.colors,o,n.color)}}}else{if(!(t.stops&&t.stops.length>=0))return r(s,"Could not convert color info: no field and no colors/stops"),null;{let e=t.stops&&t.stops.length>=0&&t.stops[0].color;i.color={field:null,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};for(let o=0;o<8;o++)i.color.values[o]=1/0,$(i.color.colors,o,e)}}return i}function rt(t,i,s){if(t.normalizationField)return r(s,"Could not convert opacity info: unsupported property"),null;if(S(t.field)){if(!t.stops)return r(s,"Could not convert opacity info: missing stops or opacities"),null;{if(t.stops.length>8)return r(s,"Could not convert opacity info: too many opacity stops"),null;i.opacity=new D(t.field);let e=t.stops;for(let o=0;o<8;++o){let n=e[Math.min(o,e.length-1)];i.opacity.values[o]=n.value,i.opacity.opacityValues[o]=n.opacity}}}else{if(!(t.stops&&t.stops.length>=0))return r(s,"Could not convert opacity info: no field and no opacities/stops"),null;{let e=t.stops&&t.stops.length>=0?t.stops[0].opacity:0;i.opacity={field:null,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0]};for(let o=0;o<8;o++)i.opacity.values[o]=1/0,i.opacity.opacityValues[o]=e}}return i}function g(t,i,s){let e=s===2&&t.rotationType==="arithmetic";i.offset[s]=e?90:0,i.factor[s]=e?-1:1,i.type[s]=1}function at(t,i,s){if(!S(t.field))return r(s,"Could not convert rotation info: field is not a string"),null;if(i.rotation){if(t.field)if(i.rotation.field){if(t.field!==i.rotation.field)return r(s,"Could not convert rotation info: multiple fields in use"),null}else i.rotation.field=t.field}else i.rotation={field:t.field,offset:[0,0,0],factor:[1,1,1],type:[0,0,0]};switch(t.axis){case"tilt":return g(t,i.rotation,0),i;case"roll":return g(t,i.rotation,1),i;case null:case void 0:case"heading":return g(t,i.rotation,2),i;default:return r(s,`Could not convert rotation info: unknown axis "${t.axis}""`),null}}var L=class{constructor(i,s=[1,1,1],e=[1,1,1],o=1,n=[0,0,0],l=[1,1,1],v=[0,0,0]){this.supports=i,this.modelSize=s,this.symbolSize=e,this.unitInMeters=o,this.anchor=n,this.scale=l,this.rotation=v}};function J(t,i,s){if(!t)return null;let e=t.reduce((o,n)=>{if(!o)return o;if(n.valueExpression)return r(s,"Could not convert visual variables: arcade expressions not supported"),null;switch(n.type){case"size":return i.supports.size?st(n,o,i,s):o;case"color":return i.supports.color?nt(n,o,s):o;case"opacity":return i.supports.opacity?rt(n,o,s):null;case"rotation":return i.supports.rotation?at(n,o,s):o;default:return null}},new U);return!(t.length>0&&e)||e.size||e.color||e.opacity||e.rotation?e?.size&&!et(e.size,i,s)?null:e:null}var F=class{constructor(i,s,e){this.visualVariables=i,this.materialParameters=s,this.requiresShaderTransformation=e}};function Vt(t,i){if(!t||Z.TESTS_DISABLE_FAST_UPDATES)return null;let s=J(t.visualVariables,i);return s?new F(s,tt(s,i),!!s.size):null}function Ct(t,i,s){if(!i||!t)return!1;let e=t.visualVariables,o=J(i.visualVariables,s);return!!o&&!!(h(e.size,o.size,"size")&&h(e.color,o.color,"color")&&h(e.rotation,o.rotation,"rotation")&&h(e.opacity,o.opacity,"opacity"))&&(t.visualVariables=o,t.materialParameters=tt(o,s),t.requiresShaderTransformation=!!o.size,!0)}function h(t,i,s){if(!!t!=!!i||t&&t.field!==i?.field)return!1;if(t&&s==="rotation"){let e=t,o=i;for(let n=0;n<3;n++)if(e.type[n]!==o.type[n]||e.offset[n]!==o.offset[n]||e.factor[n]!==o.factor[n])return!1}return!0}var z=class extends G{constructor(i){super(),this.vvSize=i?.size??null,this.vvColor=i?.color??null,this.vvOpacity=i?.opacity??null}};function tt(t,i){let s=new z(t);return s.vvSize&&(s.vvSymbolAnchor=i.anchor,I(d),ot(i.rotation[2],i.rotation[0],i.rotation[1],d),s.vvSymbolRotationMatrix=s.vvSymbolRotationMatrix||B(),q(s.vvSymbolRotationMatrix,d)),s}function Dt(t,i,s){if(!t.vvSize)return s;P(f,s);let e=t.vvSymbolRotationMatrix;w(d,e[0],e[1],e[2],0,e[3],e[4],e[5],0,e[6],e[7],e[8],0,0,0,0,1),T(f,f,d);for(let o=0;o<3;++o){let n=t.vvSize.offset[o]+i[0]*t.vvSize.factor[o];j[o]=x(n,t.vvSize.minSize[o],t.vvSize.maxSize[o])}return R(f,f,j),A(f,f,t.vvSymbolAnchor),f}function Ut(t,i,s){if(!i.vvSize)return _(t,1,1,1),t;for(let e=0;e<3;++e){let o=i.vvSize.offset[e]+s[0]*i.vvSize.factor[e];t[e]=x(o,i.vvSize.minSize[e],i.vvSize.maxSize[e])}return t}function Ft(t,i){let s=t==null?0:i.attributes[t];return typeof s=="number"&&isFinite(s)?s:0}var f=y(),j=M(),d=y();var it=class extends z{constructor(){super(...arguments),this.renderOccluded=H.Occlude,this.isDecoration=!1}},It=8;export{K as a,L as b,Vt as c,Ct as d,Dt as e,Ut as f,Ft as g,it as h,It as i};
