import{F as q,G as H,H as y,I,J as tt,K as rt,Y as T}from"./chunk-XXEY6HOD.js";import{a as j}from"./chunk-QRJEAGEQ.js";import{b as z}from"./chunk-3RH2TOVP.js";import{e as $,m as U,r as k}from"./chunk-7SDNM7YV.js";import{a as C}from"./chunk-DJ6DR6TJ.js";import{a as _}from"./chunk-GOGHKRCQ.js";import{d as X}from"./chunk-DJW5LMRG.js";import{a as Y}from"./chunk-DEH76MSI.js";import{G as d,d as R}from"./chunk-6B5XFA6F.js";import{p as Q}from"./chunk-DA3SDKGO.js";import{a as N}from"./chunk-MDZTV2VL.js";import{h as S}from"./chunk-RNC4P66O.js";import{f as m}from"./chunk-BOVYXYHK.js";import{a as E}from"./chunk-7F5DJLJT.js";import{m as K}from"./chunk-NJWTSROP.js";import{a as J}from"./chunk-ARRCN5K3.js";import{p as B}from"./chunk-4PTIEWMT.js";import{f as b}from"./chunk-VTHXE323.js";var x=Math.PI/180;function Et(t){return t.isSpherical?ht(t):ft(t)}function ft(t){let{horizontalFieldOfView:n,verticalFieldOfView:a,geometry:r,cameraHeading:o}=t,i=T(r.y,r.spatialReference),e=t.cameraPitch,s=t.cameraRoll??0,f=150;n>150&&(e=90,s=0,f=5);let c=Math.ceil(n/f),l=lt(c,o,n),g=t.farDistance?t.farDistance*i:t.cameraHeight*i/Math.cos(e*x);t.cameraPitch+a/2>=90&&(g=(t.farDistance||20)*i);let u=new S({spatialReference:r?.spatialReference});u.imageID=t.objectId;let h=null;for(let v of l)h=ut(v,e,t.cameraHeight,r,g,i,a,n,c,u,s,t.nearDistance);return h.imageID=t.objectId,{polygon:u,frustum:h}}function lt(t,n,a){let r=[];if(t%2==0)for(let o=0;o<t/2;o++)r.push(n-a/t*(o+.5),n+a/t*(o+.5));else{r.push(n);for(let o=1;o<t/2;o++)r.push(n-a/t*o,n+a/t*o)}return r.sort(),r}function ut(t,n,a,r,o,i,e,s,f,c,l=0,g=0){let u=X(Y(),tt([t,n,l??0])),h=yt({cameraHeight:a,cameraPitch:n,farDistance:o,location:r,horizontalFieldOfView:s,nearDistance:g,verticalFieldOfView:e},u),v=I([0,0,-1],u),{x:D,y:A}=r,w=H([D,A,a],v,o,i),F=2*Math.tan(e*x/2)*o,M=2*Math.tan(s/f*x/2)*o,P=I([0,1,0],u),p=I([1,0,0],u),V=y(P,F/2,i),O=y(p,M/2,i),G=d(m(),V,O),L=R(m(),V,O),W=mt([R(m(),w,G),R(m(),w,L),d(m(),w,G),d(m(),w,L)],a,r,i);return W.push(W[0]),c.addRing(W),h}function mt(t,n,a,r){return t.map(o=>pt(o,n,a,r))}function ht(t){let{geometry:n,farDistance:a,objectId:r,nearDistance:o,cameraHeight:i}=t,e=T(n.y,n.spatialReference),s=new j({center:n.clone(),radius:a*e});if(s.imageID=r,o){let l=new j({center:n.clone(),radius:o*e});s.addRing(l.rings[0])}let f=n.clone();f.z=i-a*e;let c=z.createSphere(f,{size:2*a*e});return c.imageID=r,{polygon:s,frustum:c}}function Ut(t,n){return t.contains(n)}function Z(t,n){return Math.sign(t)!==Math.sign(n)}function yt(t,n,a){let{cameraHeight:r,cameraPitch:o,farDistance:i,location:e,horizontalFieldOfView:s,nearDistance:f,verticalFieldOfView:c}=t,l=at(e),g=!(o+c/2>=90),u=2*Math.tan(c*x/2)*f,h=2*Math.tan(s*x/2)*f,v=2*Math.tan(c*x/2)*i,D=2*Math.tan(s*x/2)*i,A,w;w=[0,0,-1],w=I(w,n),A=H([e.x,e.y,r],w,i,l),g&&(A[2]=0);let F=H([e.x,e.y,r],w,f,l),M=[0,1,0];M=I(M,n);let P=[1,0,0];P=I(P,n);let p=[],V=[];f?(V=[{faces:[4,0,3,4,7,3]},{faces:[5,1,2,5,6,2]},{faces:[4,0,1,4,5,1]},{faces:[6,2,3,6,7,3]}],p=p.concat(R(m(),F,d(m(),y(M,u/2,l),y(P,h/2,l)))),p=p.concat(R(m(),F,R(m(),y(M,u/2,l),y(P,h/2,l)))),p=p.concat(d(m(),F,d(m(),y(M,u/2,l),y(P,h/2,l)))),p=p.concat(d(m(),F,R(m(),y(M,u/2,l),y(P,h/2,l))))):(p=[e.x,e.y,r],V=[{faces:[0,1,2,0,2,3,0,3,4,0,4,1]}]),p=p.concat(R(m(),A,d(m(),y(M,v/2,l),y(P,D/2,l)))),p=p.concat(R(m(),A,R(m(),y(M,v/2,l),y(P,D/2,l)))),p=p.concat(d(m(),A,d(m(),y(M,v/2,l),y(P,D/2,l)))),p=p.concat(d(m(),A,R(m(),y(M,v/2,l),y(P,D/2,l))));let O=new C({position:Float64Array.from(p)});return new z({vertexAttributes:O,components:V,spatialReference:e.spatialReference})}function pt(t,n,a,r){{let o=Math.sqrt((t[2]-n)**2+(Math.sqrt((t[0]-a.x)**2+(t[1]-a.y)**2)/r)**2)*r,i=y(d(m(),[t[0],t[1],t[2]],[a.x,a.y,n]),1/o,1/r),e=n/(n-t[2]),s={x:(1-e)*a.x+e*t[0],y:(1-e)*a.y+e*t[1],z:(1-e)*n+e*t[2]},f=Math.sqrt((s.z-n)**2+(Math.sqrt((s.x-a.x)**2+(s.y-a.y)**2)/r)**2)*r,c=y(d(m(),[s.x,s.y,s.z],[a.x,a.y,n]),1/f,1/r);return Z(i[0],c[0])&&Z(i[1],c[1])&&Z(i[2],c[2])||t[2]>=0?[t[0],t[1],0]:[s.x,s.y,s.z]}}function kt(t){let{spatialReference:n,x:a,y:r}=t.geometry,{cameraHeading:o,cameraPitch:i,farDistance:e,nearDistance:s}=t,f=at(t.geometry),c=new S({spatialReference:n}),l=Math.abs(1.44*e*f),g=Math.abs(1.44*s*f);(i<20||o==null)&&(g=l);let u=[];return u[0]={x:a+l*Math.sin((o-45)*x),y:r+l*Math.cos((o-45)*x)},u[1]={x:a+l*Math.sin((o+45)*x),y:r+l*Math.cos((o+45)*x)},u[2]={x:a+g*Math.sin((o+135)*x),y:r+g*Math.cos((o+135)*x)},u[3]={x:a+g*Math.sin((o+225)*x),y:r+g*Math.cos((o+225)*x)},c.addRing([[u[0].x,u[0].y,0],[u[1].x,u[1].y,0],[u[2].x,u[2].y,0],[u[3].x,u[3].y,0],[u[0].x,u[0].y,0]]),c}function at(t){return t&&K(t?.spatialReference)?1/Math.cos(Math.PI/2-2*Math.atan(Math.exp(-1*t.y/J.radius))):1}function Tt(t,n){let a=1+n/100;if(t.declaredClass==="esri.geometry.Circle"){let{radius:r,center:o}=t,i=new j({radius:r*a,center:o});return t.rings.length>1&&i.addRing(t.rings[1]),i}if(t.declaredClass==="esri.geometry.Polygon"){let r=new S({spatialReference:t.spatialReference}),o=t.centroid;if(o){let i=[];for(let e=0;e<t.rings[0].length;e++){let s=Math.sqrt((o.x-t.rings[0][e][0])**2+(o.y-t.rings[0][e][1])**2),f=y(d(m(),[t.rings[0][e][0],t.rings[0][e][1],0],[o.x,o.y,0]),1/s,1),c=H([o.x,o.y,0],f,s*a,1);i.push({x:c[0],y:c[1]})}r.addRing([[i[0].x,i[0].y,0],[i[1].x,i[1].y,0],[i[2].x,i[2].y,0],[i[3].x,i[3].y,0],[i[0].x,i[0].y,0]])}return r}return t}function Zt(t,n,a){return b(this,null,function*(){let{cameraHeight:r,cameraLocation:o,cameraPitch:i,frustumVertices:e,horizontalFieldOfView:s,imageHeight:f,imageWidth:c,inSRS:l,outSRS:g,verticalFieldOfView:u,cameraRoll:h,options:v}=a,D=new E(l),A=new E(g),w=rt(s,u,h??0),F=e.length>15;return i+w.vfov/2>=90?yield Mt(e,t,c,f,D,A,F,v):yield gt(e,t,n,o,r,F,D,A,v)})}function gt(t,n,a,r,o,i,e,s,f){return b(this,null,function*(){let c=dt(t,n,a,r,o);if(!c)return;let{farPlane:l,nearPlane:g}=c,u=yield ot([...g?.vertexPositions??t.slice(0,3),...l.vertexPositions],e,s,f),h=st(u);return new z({vertexAttributes:new C({position:u}),components:ct(i?et(h,!0):it(h,!0)),spatialReference:s})})}function dt(t,n,a,r,o){let i=nt(t),e=nt(t,"near");if(!i)return;let s=n.length;for(let f=0;f<s;f++){let c=Array.from(a[f]),l=[c[0]-r[0],c[1]-r[1],c[2]-(r[2]??o)];wt(r,l,f,e),xt(r,l,f,i)}return{farPlane:i,nearPlane:e}}function xt(t,n,a,r){let{coefficients:o,vertexPositions:i}=r,e=m();k(o,{origin:t,direction:n},e)&&i.splice(3*a,3,...e)}function wt(t,n,a,r){if(!r)return;let o=m();k(r.coefficients,{origin:t,direction:n},o)&&r.vertexPositions.splice(3*a,3,...o)}function Mt(t,n,a,r,o,i,e,s){return b(this,null,function*(){let f,c=e?new Array:[t[0],t[1],t[2]],l=new Array;for(let h of n)e?(f=q([h[0],h[1],1],[[0,0,1],[a,0,1],[a,r,1],[0,r,1]],[[t[0],t[1],t[2]],[t[3],t[4],t[5]],[t[6],t[7],t[8]],[t[9],t[10],t[11]]]),c=c.concat(...f),f=q([h[0],h[1],1],[[0,0,1],[a,0,1],[a,r,1],[0,r,1]],[[t[12],t[13],t[14]],[t[15],t[16],t[17]],[t[18],t[19],t[20]],[t[21],t[22],t[23]]]),l=l.concat(...f)):(f=q([h[0],h[1],1],[[0,0,1],[a,0,1],[a,r,1],[0,r,1]],[[t[3],t[4],t[5]],[t[6],t[7],t[8]],[t[9],t[10],t[11]],[t[12],t[13],t[14]]]),c=c.concat(...f));c=c.concat(l);let g=yield ot(c,o,i,s),u=st(g);return new z({vertexAttributes:new C({position:g}),components:ct(e?et(u,!0):it(u,!0)),spatialReference:i})})}function ot(t,n,a,r){return b(this,null,function*(){if(n.equals(a))return t;let o=t.reduce((e,s,f)=>{let c=Math.floor(f/3);return e[c]||(e[c]=new Array),e[c].push(s),e},new Array),{points:i}=yield Q(new N(o,n),a,r);return B(r),i.flat()})}function nt(t,n="far"){let a=$(),r;switch(n){case"far":if(r=Array.from(t.length===15?t.slice(3):t.slice(12)),U(a,r,!1))return{coefficients:a,vertexPositions:r};break;case"near":return r=Array.from(t.slice(0,12)),t.length===15||!U(a,r,!1)?void 0:{coefficients:a,vertexPositions:r}}}var et=(t,n=!1)=>{if(n&&t-2<=4||t<=4||t%2!=0)throw new Error("Invalid number of vertices");let a=[],r=t/2,o=Math.round((n?t-2:t)/2);for(let i=0;i<o;i++){let e=i+r,s=n?e+1:e,f=s%t,c=(n?e:s+1)%t;a.push({faces:new Uint32Array([i,c,f,i,i+1,f])})}return a};function it(t,n=!1){if(t<3||n&&t-1<3)throw new Error("Invalid number of vertices");let a=[],r=n?t-2:t-1;for(let o=0;o<r;o++)a.push({faces:new Uint32Array([0,o+1,o+2])});return a}var ct=t=>t.map(n=>new _(n)),st=t=>t.length/3;export{Et as a,Ut as b,kt as c,Tt as d,Zt as e,ot as f};
