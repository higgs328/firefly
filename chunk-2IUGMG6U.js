import{a as N}from"./chunk-R3G72OWL.js";import{a as J}from"./chunk-OB7VB62O.js";import{a as K}from"./chunk-RUNI4ZN4.js";import{a as q}from"./chunk-UMRL4FCR.js";import"./chunk-UDMXK7SH.js";import{a as H,h as V,j,r as E}from"./chunk-ZEWUF6OQ.js";import"./chunk-JUJYL7GW.js";import"./chunk-ZQ2SHTTW.js";import{a as z}from"./chunk-EPKVBNFW.js";import"./chunk-TGSXSDDB.js";import{a as b}from"./chunk-FHBFWDFD.js";import"./chunk-2HQALWZQ.js";import"./chunk-ZTR6OS44.js";import"./chunk-VRTKAD2J.js";import"./chunk-DBLKLHK2.js";import{a as S}from"./chunk-K75TK42V.js";import{a as O}from"./chunk-GHKL3NOH.js";import"./chunk-MDSLION2.js";import{a as A}from"./chunk-AXYQJCCX.js";import{a as n}from"./chunk-5XCFNEYX.js";import{a as D}from"./chunk-GQL2MBZT.js";import{b as U}from"./chunk-EBIFNV2H.js";import"./chunk-MGGSCSBE.js";import"./chunk-Z6BYFM7E.js";import"./chunk-CFRDSUTM.js";import{o as F}from"./chunk-FB4M3WPV.js";import"./chunk-SLAWDKDA.js";import"./chunk-4N4D2YQX.js";import"./chunk-G4DZJMGT.js";import"./chunk-3VRDAJCX.js";import"./chunk-WTB3O6DJ.js";import"./chunk-7P44K2YD.js";import"./chunk-32OAXCA4.js";import"./chunk-UST6HCE7.js";import"./chunk-K5T5FD5C.js";import"./chunk-MVHHPJM7.js";import"./chunk-VDO6JJ3Y.js";import"./chunk-WFKZLI6F.js";import"./chunk-X2B63YVS.js";import"./chunk-BAEF3CT6.js";import"./chunk-AUAZP44J.js";import"./chunk-PVDFCTA4.js";import"./chunk-KNVXE32P.js";import"./chunk-76ATOSLU.js";import"./chunk-CCJU4DSH.js";import{a as G,c as T,j as P}from"./chunk-TG45K3WR.js";import"./chunk-RAI4DTMT.js";import{b as L}from"./chunk-ACP3S2CH.js";import"./chunk-HVAXZ2NA.js";import"./chunk-T7DXJKX7.js";import"./chunk-TYYVNQUR.js";import{a as t}from"./chunk-QGVBCWUY.js";import{H as x}from"./chunk-MYO4NP2N.js";import{e as o}from"./chunk-NFIPKH6V.js";import"./chunk-JPU2PQZC.js";import{l as w}from"./chunk-5QEXLALV.js";import"./chunk-P6QFA5MM.js";import"./chunk-DGTD7Y73.js";import"./chunk-LI2SX4T6.js";import"./chunk-BWO7LS2H.js";import"./chunk-HEVQSRJ2.js";import"./chunk-OVHPPCBL.js";import"./chunk-SNFOAZZQ.js";import"./chunk-AML4XSEF.js";import"./chunk-4PTIEWMT.js";import"./chunk-TG2UTNEO.js";import"./chunk-YOFFGXOB.js";import"./chunk-XRGPJ3QY.js";import"./chunk-6MRUJ2UW.js";import"./chunk-2LI2GKBQ.js";import"./chunk-QBWJMFH5.js";import{a as _,b as v,f as I}from"./chunk-VTHXE323.js";var m=class extends x{constructor(){super(...arguments),this.closeButton=!1,this.collapseButton=!1,this.errors=!1,this.filter=!1,this.flow=!0,this.heading=!1,this.statusIndicators=!0,this.temporaryLayerIndicators=!1}};t([o({type:Boolean,nonNullable:!0})],m.prototype,"closeButton",void 0),t([o({type:Boolean,nonNullable:!0})],m.prototype,"collapseButton",void 0),t([o({type:Boolean,nonNullable:!0})],m.prototype,"errors",void 0),t([o({type:Boolean,nonNullable:!0})],m.prototype,"filter",void 0),t([o({type:Boolean,nonNullable:!0})],m.prototype,"flow",void 0),t([o({type:Boolean,nonNullable:!0})],m.prototype,"heading",void 0),t([o({type:Boolean,nonNullable:!0})],m.prototype,"statusIndicators",void 0),t([o({type:Boolean,nonNullable:!0})],m.prototype,"temporaryLayerIndicators",void 0),m=t([w("esri.widgets.CatalogLayerList.CatalogLayerListVisibleElements")],m);var $=m;var c="esri-catalog-layer-list",y=`${c}__item`,f={base:c,actionMenu:`${c}__action-menu`,actionGroup:`${c}__action-group`,filterNoResults:`${c}__filter-no-results`,item:y,itemActive:`${y}--active`,itemContentBottom:`${y}-content-bottom`,itemMessage:`${y}-message`,itemActionIcon:`${y}-action-icon`,itemActionImage:`${y}-action-image`,itemTemporaryIcon:`${y}-temporary-icon`,itemTableIcon:`${y}-table-icon`,statusIndicator:`${c}__status-indicator`,publishing:`${c}__publishing`,updating:`${c}__updating`,connectionStatus:`${c}__connection-status`,connectionStatusConnected:`${c}__connection-status--connected`,visibleToggle:`${c}__visible-toggle`,visibleIcon:`${c}__visible-icon`};var k,W=L.ofType(q),Q="nested",i=k=class extends S.IdentifiableMixin(D){constructor(e,l){super(e,l),this._rootListEl=null,this._activeItem=null,this._tooltipReferenceMap=new O,this._focusRootFlowItem=!1,this._focusPanelFlowItem=!1,this._focusLayerFlowItem=null,this._layerListMap=new O,this._rootGroupUid=`operational-${this.uid}`,this._openedLayersController=null,this.catalogLayerList=null,this.catalogOptions=null,this.collapsed=!1,this.filterPlaceholder="",this.filterPredicate=null,this.filterText="",this.headingLevel=2,this.knowledgeGraphOptions=null,this.layerTablesEnabled=new L(["knowledge-graph"]),this.mapImageOptions=null,this.messages=null,this.messagesCommon=null,this.minFilterItems=H,this.openedLayers=new L,this.openedLayerLists=new L,this.selectedItems=new W,this.selectionMode="none",this.tableList=null,this.tileOptions=null,this.viewModel=new N,this.visibilityAppearance="default",this.visibleElements=new $,this._onTablesOpen=s=>{this.onTablesOpen?this.onTablesOpen(s):(this.openedLayers.push(s.layer),this._focusLayerFlowItem=s.layer?.uid)},this._onCatalogOpen=s=>{this.onCatalogOpen?this.onCatalogOpen(s):(this.openedLayers.push(s.layer?.parent),this._focusLayerFlowItem=s.layer?.uid)},this._onPanelOpen=()=>{this._focusPanelFlowItem=!0},this._onTooltipReferenceChange=(s,a)=>{a?this._tooltipReferenceMap.set(s,a):this._tooltipReferenceMap.delete(s)},this._onTriggerAction=(s,a)=>{this.triggerAction(s,a)},this._clearActiveItem=()=>{this._activeItem=null},this._setActiveItem=s=>{if(this.visibilityAppearance!=="default")return;let a=Array.from(s.composedPath()).find(r=>r.classList?.contains(f.item));this._activeItem=E(a)}}initialize(){this.addHandles([T(()=>this.openedLayers,"change",()=>this._handleOpenedLayersChange(),P),T(()=>this.viewModel.catalogItems,"change",()=>V(this.selectedItems),P),G(()=>[this.filterPredicate,this._rootListEl],()=>j(this._rootListEl,this.filterPredicate))])}loadDependencies(){return U({button:()=>import("./chunk-K3RCADAN.js"),flow:()=>import("./chunk-5V3M627Q.js"),"flow-item":()=>import("./chunk-OQ4LXJHQ.js"),list:()=>import("./chunk-4MPCQ5DO.js"),notice:()=>import("./chunk-PEKK3NZO.js"),tooltip:()=>import("./chunk-24BDRL23.js")})}destroy(){this._destroyOpenedLayerLists(),this._tooltipReferenceMap.clear()}get _filterEnabled(){return this.viewModel.totalItems>=this.minFilterItems&&this.visibleElements.filter}get _visibleItems(){return this.catalogItems?.filter(e=>!e.hidden&&(this.visibleElements.errors||!e.error))}get _openedPanelItems(){return this._visibleItems.flatten(e=>e.children).filter(({hidden:e,panel:l})=>!e&&l?.open&&!l.disabled&&l.flowEnabled)}get _renderedOpenLayerFlowItems(){let{openedLayers:e}=this;return e.toArray().map((l,s)=>this._renderLayerFlowItem(l,s===e.length-1))}get catalogItems(){return this.viewModel.catalogItems}set catalogItems(e){this.viewModel.catalogItems=e}get catalogLayer(){return this.viewModel.catalogLayer}set catalogLayer(e){this.viewModel.catalogLayer=e}get icon(){return"catalog-dataset"}set icon(e){this._overrideIfSome("icon",e)}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get listItemCreatedFunction(){return this.viewModel.listItemCreatedFunction}set listItemCreatedFunction(e){this.viewModel.listItemCreatedFunction=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}triggerAction(e,l){return this.viewModel.triggerAction(e,l)}render(){let e=this.viewModel?.state,{_visibleItems:l}=this,s={[b.hidden]:e==="loading",[b.disabled]:e==="disabled"};return n("div",{class:this.classes(f.base,b.widget,b.panel,s)},l?.length?[this._renderItemTooltips(),this._renderItems()]:this._renderNoItems())}_createFlowList(e,l){return I(this,null,function*(){let{_layerListMap:s}=this,a=s.get(e);if(a)return a;let r=e.type==="catalog"?yield this._createCatalogLayerList(e):yield this._createTableList(e);return l.aborted||s.set(e,r),r})}_handleOpenedLayersChange(){return I(this,null,function*(){let{_layerListMap:e,openedLayers:l,openedLayerLists:s}=this;this._openedLayersController?.abort();let a=new AbortController,{signal:r}=a;this._openedLayersController=a,e.forEach((u,g)=>{l.includes(g)||(u.destroy(),e.delete(g))});let h=yield Promise.all(l.map(u=>this._createFlowList(u,r)));if(r.aborted)return;s.removeAll(),s.addMany(h);let p=s.at(-1);p?"catalogLayer"in p?(this._set("catalogLayerList",p),this._set("tableList",null)):(this._set("catalogLayerList",null),this._set("tableList",p)):(this._set("catalogLayerList",null),this._set("tableList",null))})}_destroyOpenedLayerLists(){this.openedLayerLists.destroyAll(),this.openedLayers.removeAll(),this._layerListMap.clear()}_renderItemTooltip(e){let{_tooltipReferenceMap:l,messages:s}=this;return e?.layer?n("calcite-tooltip",{key:`tooltip-${e.layer.uid}`,overlayPositioning:"fixed",referenceElement:l.get(e.layer.uid)},s.layerIncompatibleTooltip):null}_renderItemTooltipNodes(e){return e.incompatible?this._renderItemTooltip(e):e.children?.filter(l=>!l.hidden).toArray().map(l=>this._renderItemTooltipNodes(l))}_renderItemTooltips(){return this._visibleItems?.toArray().map(e=>this._renderItemTooltipNodes(e))}_renderNoItemsMessage(){return n("div",{slot:"message"},this.messages.noItemsToDisplay)}_renderNoItems(){return n("div",{class:f.itemMessage,key:"esri-layer-list__no-items"},n("calcite-notice",{icon:"information",kind:"info",open:!0,width:"full"},this._renderNoItemsMessage()))}_renderPanelFlowItems(){let{_openedPanelItems:e,openedLayers:l}=this;return e.toArray().map(({title:s,panel:a},r)=>{let h=()=>this._handlePanelFlowItemBack(a);return n("calcite-flow-item",{afterCreate:this._focusPanelFlowItemNode,afterUpdate:this._focusPanelFlowItemNode,bind:this,description:s,heading:a.title,headingLevel:this.headingLevel,key:`flow-panel-${a.uid}`,selected:!l.length&&r===e.length-1,onCalciteFlowItemBack:p=>{p.preventDefault(),h()}},a.render(),n("calcite-button",{appearance:"transparent",onclick:h,slot:"footer-actions",width:"full"},this.messagesCommon.back))})}_handlePanelFlowItemBack(e){e.open=!1,this._focusRootFlowItem=!0}_focusRootFlowItemNode(e){this._focusRootFlowItem&&(this._focusRootFlowItem=!1,F(e))}_focusPanelFlowItemNode(e){this._focusPanelFlowItem&&(this._focusPanelFlowItem=!1,F(e))}_renderItems(){let{visible:e,collapsed:l,_visibleItems:s,_filterEnabled:a,_rootGroupUid:r,visibleElements:{closeButton:h,collapseButton:p,heading:u,flow:g},selectionMode:C,filterText:M,filterPlaceholder:X,messages:B,openedLayers:Y,_openedPanelItems:Z}=this,R=[n("calcite-flow-item",{afterCreate:this._focusRootFlowItemNode,afterUpdate:this._focusRootFlowItemNode,bind:this,closable:h,closed:!e,collapsed:l,collapsible:p,heading:u?B.widgetLabel:void 0,headingLevel:this.headingLevel,key:"root-flow-item",selected:!Y.length&&!Z.length,onCalciteFlowItemClose:()=>this.visible=!1},n("calcite-list",{afterCreate:d=>{this._rootListEl=d,d.addEventListener("focusin",this._setActiveItem),d.addEventListener("focusout",this._clearActiveItem)},afterRemoved:d=>{this._rootListEl=null,d.removeEventListener("focusin",this._setActiveItem),d.removeEventListener("focusout",this._clearActiveItem)},"data-layer-type":r,displayMode:Q,filterEnabled:a,filterPlaceholder:X,filterProps:K,filterText:a?M:"",group:r,key:"root-list",label:B.widgetLabel,onmouseleave:this._clearActiveItem,onmouseover:this._setActiveItem,selectionAppearance:"border",selectionMode:C,onCalciteListChange:d=>this._handleCalciteListChange(d),onCalciteListFilter:d=>this.filterText=d.currentTarget?.filterText??""},s?.toArray().map(d=>this._renderItem(d)),s?.length&&a?n("div",{class:f.filterNoResults,slot:"filter-no-results"},n("calcite-notice",{kind:"info",open:!0,width:"full"},this._renderNoItemsMessage())):null)),this._renderPanelFlowItems(),this._renderedOpenLayerFlowItems];return e?g?n("calcite-flow",{key:"root-flow"},R):R:null}_focusLayerFlowItemNode(e){this._focusLayerFlowItem===e.dataset.layerUid&&(this._focusLayerFlowItem=null,F(e))}_renderLayerFlowItem(e,l){let{messages:s,openedLayers:a}=this,r=e.title||this.messages.untitledLayer;return n("calcite-flow-item",{afterCreate:this._focusLayerFlowItemNode,afterUpdate:this._focusLayerFlowItemNode,bind:this,"data-layer-uid":e.uid,description:r,heading:s[e.type==="catalog"?"catalogLayers":"tables"],headingLevel:this.headingLevel,key:`flow-layer-list-${e.uid}`,selected:l,onCalciteFlowItemBack:h=>{h.preventDefault(),a.pop();let p=a.at(-1);p?this._focusLayerFlowItem=p.uid:this._focusRootFlowItem=!0}},this._layerListMap.get(e)?.render())}_createCatalogLayerList(e){return I(this,null,function*(){let{headingLevel:l,catalogOptions:s,view:a,filterPlaceholder:r,listItemCreatedFunction:h,minFilterItems:p,selectionMode:u,visibilityAppearance:g,onCatalogOpen:C,onTablesOpen:M}=this;return new k(v(_({headingLevel:l,view:a,filterPlaceholder:r,listItemCreatedFunction:h,minFilterItems:p,selectionMode:u,visibilityAppearance:g},s),{catalogLayer:e,onCatalogOpen:C,onTablesOpen:M}))})}_getTableListParams(e){switch(e.type){case"knowledge-graph":return v(_({},this.knowledgeGraphOptions),{tables:e.tables});case"map-image":return v(_({},this.mapImageOptions),{tables:e.subtables});case"tile":return v(_({},this.tileOptions),{tables:e.subtables});default:return null}}_createTableList(e){return I(this,null,function*(){let{default:l}=yield import("./chunk-RZ3L7PHE.js"),{headingLevel:s,selectionMode:a}=this;return new l(_({headingLevel:s,selectionMode:a},this._getTableListParams(e)))})}_renderItem(e,l,s){return n(J,{activeItem:this._activeItem,css:f,displayMode:Q,dragEnabled:!1,item:e,key:`layerListItem-${e.layer?.uid}`,layerTablesEnabled:this.layerTablesEnabled,listModeDisabled:this.viewModel.listModeDisabled,messages:this.messages,messagesCommon:this.messagesCommon,parent:l,parentTitles:s,rootGroupUid:this._rootGroupUid,selectedItems:this.selectedItems,selectionMode:this.selectionMode,visibilityAppearance:this.visibilityAppearance,visibleElements:this.visibleElements,onAction:this._onTriggerAction,onCatalogOpen:this._onCatalogOpen,onPanelOpen:this._onPanelOpen,onTablesOpen:this._onTablesOpen,onTooltipReferenceChange:this._onTooltipReferenceChange})}_handleCalciteListChange(e){let{selectionMode:l,selectedItems:s}=this;if(l==="none")return;let a=e.target.selectedItems.map(r=>E(r)).filter(Boolean);s.removeAll(),s.addMany(a)}};t([o()],i.prototype,"_rootListEl",void 0),t([o()],i.prototype,"_activeItem",void 0),t([o()],i.prototype,"_tooltipReferenceMap",void 0),t([o()],i.prototype,"_focusRootFlowItem",void 0),t([o()],i.prototype,"_focusPanelFlowItem",void 0),t([o()],i.prototype,"_focusLayerFlowItem",void 0),t([o()],i.prototype,"_layerListMap",void 0),t([o()],i.prototype,"_filterEnabled",null),t([o()],i.prototype,"_visibleItems",null),t([o()],i.prototype,"_openedPanelItems",null),t([o()],i.prototype,"_renderedOpenLayerFlowItems",null),t([o()],i.prototype,"catalogItems",null),t([o()],i.prototype,"catalogLayer",null),t([o({readOnly:!0})],i.prototype,"catalogLayerList",void 0),t([o()],i.prototype,"catalogOptions",void 0),t([o()],i.prototype,"collapsed",void 0),t([o()],i.prototype,"filterPlaceholder",void 0),t([o()],i.prototype,"filterPredicate",void 0),t([o()],i.prototype,"filterText",void 0),t([o()],i.prototype,"headingLevel",void 0),t([o()],i.prototype,"icon",null),t([o()],i.prototype,"knowledgeGraphOptions",void 0),t([o()],i.prototype,"label",null),t([o()],i.prototype,"layerTablesEnabled",void 0),t([o()],i.prototype,"listItemCreatedFunction",null),t([o()],i.prototype,"mapImageOptions",void 0),t([o(),A("esri/widgets/CatalogLayerList/t9n/CatalogLayerList")],i.prototype,"messages",void 0),t([o(),A("esri/t9n/common")],i.prototype,"messagesCommon",void 0),t([o()],i.prototype,"minFilterItems",void 0),t([o({readOnly:!0})],i.prototype,"openedLayers",void 0),t([o({readOnly:!0})],i.prototype,"openedLayerLists",void 0),t([o()],i.prototype,"onCatalogOpen",void 0),t([o()],i.prototype,"onTablesOpen",void 0),t([o({type:W})],i.prototype,"selectedItems",void 0),t([o()],i.prototype,"selectionMode",void 0),t([o({readOnly:!0})],i.prototype,"tableList",void 0),t([o()],i.prototype,"tileOptions",void 0),t([o()],i.prototype,"view",null),t([z("trigger-action"),o({type:N})],i.prototype,"viewModel",void 0),t([o()],i.prototype,"visibilityAppearance",void 0),t([o({type:$,nonNullable:!0})],i.prototype,"visibleElements",void 0),i=k=t([w("esri.widgets.CatalogLayerList")],i);var ke=i;export{ke as default};
