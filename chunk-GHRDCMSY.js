import{q as A}from"./chunk-DT6D5YZT.js";import{a as fe}from"./chunk-I3XN2LJZ.js";import{a as he,c as W}from"./chunk-FM2MN524.js";import{f as ue,i as q,k as me}from"./chunk-XEJVICTW.js";import{a as u}from"./chunk-ESAKNWVF.js";import{a as de,b as pe}from"./chunk-VS266ZEX.js";import{a as le}from"./chunk-ZNIU6XIO.js";import{a as se}from"./chunk-GEYV2JMR.js";import{m as N}from"./chunk-IGGGB3TP.js";import{c as ce}from"./chunk-C5TDOKQP.js";import{b as x}from"./chunk-2DH3L3DZ.js";import{a as U}from"./chunk-JHVSXE55.js";import{b as ae}from"./chunk-NYVDVEEV.js";import{d as M}from"./chunk-6ZTUPVYX.js";import{w as I,x as L}from"./chunk-Z7TBAZRW.js";import{n as F}from"./chunk-QXSQOLB3.js";import{j as m}from"./chunk-J5AEP4US.js";import{a as ne}from"./chunk-342NGUMP.js";import{a as oe}from"./chunk-NIYDRLW4.js";import{k as ie}from"./chunk-ZM24RY22.js";import{a as z}from"./chunk-6F25LG6O.js";import{a as S}from"./chunk-RWCIDBNQ.js";import{a as E}from"./chunk-EM35R6FY.js";import{b as J,c as w,d as K,g as b,n as Y}from"./chunk-QXXXCEV5.js";import{D as H,b as j,d as $,e as ee,u as te,x as re}from"./chunk-6B5XFA6F.js";import{c as X}from"./chunk-PTZYZULI.js";import{a as Z,m as Q}from"./chunk-NMLYCCKN.js";import{f as T}from"./chunk-OLOKUDVI.js";import{a as g,c as B}from"./chunk-BOVYXYHK.js";import{a as k}from"./chunk-TG45K3WR.js";import{g as O}from"./chunk-TG2UTNEO.js";var V=class extends se{constructor(e){super(e),this._location=g(),this._direction=B(1,0,0),this._width=1,this._offset=1,this._length=18,this._color=X(1,0,1,1),this._renderOccluded=m.OccludeAndTransparent,this.applyProperties(e)}createObject3DResourceFactory(e){return{view:e,createResources:t=>this._createObject3DResources(t),destroyResources:Re,recreateGeometry:(t,r)=>this._recreateObject3DGeometry(t,r),cameraChanged:()=>this._updateGeometry()}}createDrapedResourceFactory(e){return{view:e,createResources:()=>this._createDrapedResources(),destroyResources:we,recreateGeometry:t=>this._recreateDrapedGeometry(t)}}get location(){return this._location}set location(e){H(this._location,e)||(j(this._location,e),this._updateGeometry())}get direction(){return this._direction}set direction(e){H(this._direction,e)||(j(this._direction,e),this._updateGeometry())}setDirectionFromPoints(e,t){te(this._direction,ee(this._direction,t,e)),this._updateGeometry()}get width(){return this._width}set width(e){e!==this._width&&(this._width=e,this._updateMaterial())}get offset(){return this._offset}set offset(e){e!==this._offset&&(this._offset=e,this._updateGeometry())}get length(){return this._length}set length(e){e!==this._length&&(this._length=e,this._updateGeometry())}get color(){return this._color}set color(e){Q(e,this._color)||(Z(this._color,e),this._updateMaterial())}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial())}_createObject3DResources(e){let t=new M(this.materialParameters),r=new Array;return this._createObject3DGeometry(t,e,r),{material:t,geometries:r,forEach:i=>{i(t),r.forEach(i)}}}_recreateObject3DGeometry(e,t){e.geometries.length=0,this._createObject3DGeometry(e.material,t,e.geometries)}_createObject3DGeometry(e,t,r){let[i,o]=ge(e);t.addGeometry(i),t.addGeometry(o),r.push(i),r.push(o),this._updateVerticesObject3D(t)}_createDrapedResources(){let e=new M(this.materialParameters),t=k(()=>this.view.state.contentPixelRatio,()=>this.drapedResources.recreateGeometry());return{material:e,geometries:this._createDrapedGeometry(e),pixelRatioHandle:t}}_recreateDrapedGeometry(e){e.geometries=this._createDrapedGeometry(e.material)}_createDrapedGeometry(e){let t=ge(e);return this._updateVerticesDraped(t),t.map(r=>new ce(r))}_updateMaterial(){let{materialParameters:e}=this;this.object3dResources.resources?.material.setParameters(e),this.drapedResources.resources?.material.setParameters(e)}get materialParameters(){return{width:this._width,color:this._color,renderOccluded:this._renderOccluded,isDecoration:this.isDecoration}}_updateGeometry(){if(this.isDraped)this.drapedResources.recreateGeometry();else{let e=this.object3dResources.object;e&&this._updateVerticesObject3D(e)}}_updateVerticesObject3D(e){let t=this.view.state.camera;t.projectToScreen(this.location,P),$(h,this.location,this.direction),t.projectToScreen(h,y),Y(y,K(y,y,P)),this._updateVertexAttributesObject3D(t,e,0,P,y,1),this._updateVertexAttributesObject3D(t,e,1,P,y,-1)}_updateVertexAttributesObject3D(e,t,r,i,o,n){let s=t.geometries[r],c=s.getMutableAttribute(S.POSITION)?.data;if(!c)return;let{start:d,end:p}=_e(o,i,n,this.offset,this.width,this.length);e.unprojectFromScreen(d,h),c[0]=h[0],c[1]=h[1],c[2]=h[2],e.unprojectFromScreen(p,h),c[3]=h[0],c[4]=h[1],c[5]=h[2],t.geometryVertexAttributeUpdated(s,S.POSITION)}_updateVerticesDraped(e){let{view:{basemapTerrain:{overlayManager:t},state:{contentPixelRatio:r}}}=this,{location:i,width:o,length:n,offset:s}=this,c=ve;c.spatialReference=t.renderer.spatialReference,c.x=i[0],c.y=i[1];let d=this.view.overlayPixelSizeInMapUnits(c)*r,p=o*d,f=n*d,l=s*d;this._updateVertexAttributesDraped(e[0],p,f,l,-1),this._updateVertexAttributesDraped(e[1],p,f,l,1)}_updateVertexAttributesDraped(e,t,r,i,o){let n=e.getMutableAttribute(S.POSITION)?.data;if(!n)return;let{location:s,direction:c}=this,{start:d,end:p}=_e(c,s,o,i,t,r);n[0]=d[0],n[1]=d[1],n[2]=N,n[3]=p[0],n[4]=p[1],n[5]=N,e.invalidateBoundingInfo()}};function ge(a){return[F(a,[g(),g()]),F(a,[g(),g()])]}function _e(a,e,t,r,i,o){let n=b(De,J(De,a[1]*t,a[0]*-t),r+i/2),s=w(G,w(G,w(G,e,b(G,a,o/2)),n),n);return{start:s,end:w(Oe,s,b(Oe,a,-o))}}function Re(a){a.geometries.length=0}function we(a){a.pixelRatioHandle.remove(),a.geometries=[]}var h=g(),De=E(),G=E(),Oe=E(),P=T(),y=T(),ve=oe(0,0,void 0,null);var ye=class extends fe{sortUniqueHints(e){return e.sort((t,r)=>(r instanceof W?r.length:0)-(t instanceof W?t.length:0))}visualizeIntersectionPoint(e,t){let{spatialReference:r,view:i}=t,o=v(t);return O(new U({view:i,primitive:"circle",geometry:q(e.intersectionPoint,r),elevationInfo:e.isDraped?L:I,size:20,outlineSize:2,color:o.intersectionPointColor,outlineColor:o.intersectionPointOutlineColor,pixelSnappingEnabled:!1,isDecoration:!0,attached:!0}))}visualizePoint(e,t){let{view:r,spatialReference:i}=t,o=v(t),n=_(e.point,e.domain,t);return O(new U({view:r,primitive:"circle",geometry:q(n,i),elevationInfo:C(e),size:20,outlineSize:2,color:o.pointColor,outlineColor:o.pointOutlineColor,pixelSnappingEnabled:!1,isDecoration:!0,attached:!0}))}visualizeLine(e,t){let{view:r,spatialReference:i}=t,o=v(t),n=_(e.lineStart,e.domain,t),s=_(e.lineEnd,e.domain,t);return O(be(e.type,n,s,i,C(e),r,o,e.isDraped,e.fadeLeft,e.fadeRight))}visualizeParallelSign(e,t){let{view:r,spatialReference:i}=t,o=v(t),{isDraped:n}=e,s=C(e),c=_(e.lineStart,e.domain,t),d=_(e.lineEnd,e.domain,t),p=D(c,i,s,r,n),f=D(d,i,s,r,n),l=re(f,p,f,.5),R=new V({view:r,attached:!1,offset:u.parallelLineHintOffset,length:u.parallelLineHintLength,width:u.parallelLineHintWidth,color:o.parallelSignColor,location:l,renderOccluded:n?m.OccludeAndTransparent:m.Opaque,isDraped:n,renderGroup:x.SnappingHint,isDecoration:!0});return R.setDirectionFromPoints(p,l),R.attached=!0,O(R)}visualizeRightAngleQuad(e,t){let{view:r,spatialReference:i}=t,o=v(t),n=C(e),{isDraped:s}=e,c=_(e.previousVertex,e.domain,t),d=_(e.centerVertex,e.domain,t),p=_(e.nextVertex,e.domain,t),f=D(c,i,n,r,s),l=D(d,i,n,r,s),R=D(p,i,n,r,s);return O(new le({view:r,attached:!0,color:s?o.rightAngleColorDraped:o.rightAngleColor,renderOccluded:s?m.OccludeAndTransparent:m.Transparent,outlineRenderOccluded:s?m.OccludeAndTransparent:m.Opaque,outlineColor:o.rightAngleOutlineColor,outlineSize:u.rightAngleHintOutlineSize,size:u.rightAngleHintSize,isDraped:s,geometry:{previous:f,center:l,next:R},renderGroup:x.SnappingHint,isDecoration:!0}))}};function v(a){let{effectiveTheme:e}=a.view,t=z.toUnitRGBA(e.accentColor),r=[0,0,0,0];return{intersectionPointColor:r,intersectionPointOutlineColor:t,pointColor:r,pointOutlineColor:t,lineColor:t,lineOutlineColor:void 0,parallelSignColor:t,rightAngleColor:t,rightAngleColorDraped:z.toUnitRGBA(ie(e.accentColor,.5)),rightAngleOutlineColor:t}}function _(a,e,{selfSnappingZ:t,view:r,spatialReference:i}){return e&he.SELF&&ue(a)&&t!=null?me(a,t,r,i):a}function C(a){return a.isDraped?L:I}function be(a,e,t,r,i,o,n,s=!1,c=!0,d=!0){let p=D(e,r,i,o,s),f=D(t,r,i,o,s),l=new de({view:o,extensionType:pe.FADED,start:p,end:f,isDraped:s,color:n.lineColor,renderOccluded:s?m.OccludeAndTransparent:m.Opaque,renderGroup:x.SnappingHint,isDecoration:!0});switch(a){case A.TARGET:l.width=u.lineHintWidthTarget,l.fadedExtensions={start:0,end:u.lineHintFadedExtensions};break;case A.REFERENCE_EXTENSION:l.width=u.lineHintWidthReference,l.fadedExtensions={start:0,end:0};break;case A.REFERENCE:l.width=u.lineHintWidthReference,l.fadedExtensions={start:c?u.lineHintFadedExtensions:0,end:d?u.lineHintFadedExtensions:0}}return l.attached=!0,l}function D(a,e,t,r,i){let o=g();if(i){let n=r.basemapTerrain.overlayManager.renderer.spatialReference;ne(a,e,o,n)}else ae(a,e,t,r,o);return o}export{ye as a};
