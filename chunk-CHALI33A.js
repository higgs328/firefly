import{a as Xt,b as Zt}from"./chunk-D4ULQQN7.js";import{a as Kt}from"./chunk-NTU4GX2J.js";import{b as H}from"./chunk-XHCZWFY2.js";import{c as ot}from"./chunk-2I3LIA7G.js";import{a as _e}from"./chunk-GUIIGAD3.js";import{a as Me,b as Jt}from"./chunk-H2NTHPNN.js";import{a as Pe,b as rt}from"./chunk-KJFE7WVE.js";import{b as Bt}from"./chunk-BKWQOCBC.js";import{o as Oe}from"./chunk-7HMNN4FJ.js";import{a as jt,b as Gt,e as Vt}from"./chunk-UKAGN54W.js";import{a as ce}from"./chunk-342NGUMP.js";import{b as kt,f as qt,m as Wt}from"./chunk-QSQIQSC6.js";import{c as De}from"./chunk-AYNBEMCC.js";import{a as nt}from"./chunk-QCZ3ZIGQ.js";import{B as se,C as Lt,D as zt,e as $e,j as et,s as Ht,u as tt}from"./chunk-7SDNM7YV.js";import{f as Ft}from"./chunk-T6WMVIUG.js";import{a as _t,b as Qe,c as Nt}from"./chunk-EM35R6FY.js";import{a as ie,b as Ut}from"./chunk-HKJZ7WI6.js";import{a as be}from"./chunk-ALWV3RJ2.js";import{w as Ct}from"./chunk-QXXXCEV5.js";import{H as Pt,I as Ye,a as R,b as P,c as bt,d as W,e as B,n as S,o as ye,p as oe,q as Ke,s as Dt,u as te,v as A,w as F,x as Ot,y as ae}from"./chunk-6B5XFA6F.js";import{g as Ze,p as It}from"./chunk-DA3SDKGO.js";import{a as At}from"./chunk-PTZYZULI.js";import{c as wt,h as xt}from"./chunk-NMLYCCKN.js";import{h as ge}from"./chunk-RNC4P66O.js";import{i as Ce}from"./chunk-7LHOQXZT.js";import{j as Rt,k as St,p as vt,s as Et}from"./chunk-ZTOZWLEE.js";import{a as Xe}from"./chunk-RSDQHAJX.js";import{a as f,b as Ie,c as q,i as Je}from"./chunk-BOVYXYHK.js";import{q as Mt}from"./chunk-KVM6SHDX.js";import{b as yt,g as Be,i as y,j as I,l as Te,m as re}from"./chunk-EQZWYK27.js";import{m as Ae}from"./chunk-ZQIC5NFT.js";import{c as v}from"./chunk-VIEK2X23.js";import{i as gt}from"./chunk-Q6Y4JG7Q.js";import{a as he}from"./chunk-7F5DJLJT.js";import{B as k}from"./chunk-NJWTSROP.js";import{p as O}from"./chunk-4PTIEWMT.js";import{g as Tt}from"./chunk-XRGPJ3QY.js";import{a as dt,b as ht,f as U}from"./chunk-VTHXE323.js";function Nr(e,t,n,r){return e.renderCoordsHelper.fromRenderCoords(t.eye,Ne,r)!=null&&Mt(n,Ne)}function _n(e,t){return e.elevationProvider?e.elevationProvider.getElevation(t[0],t[1],t[2],e.renderCoordsHelper.spatialReference,"ground")??0:0}function $t(e,t,n,r){let o=e.state.camera.clone();t&&n&&r&&(o.eye=t,o.center=n,o.up=r),Nn(e,o.ray,J)||P(J,o.center);let a=e.state.constraints,i=a.minimumPoiDistance;if(Ke(o.eye,J)<i){let s=a.collision.enabled;P(ne,o.viewForward),S(ne,ne,i),s?o.eye=B(Ne,J,ne):W(J,o.eye,ne);let c=e.renderCoordsHelper,l=c.getAltitude(o.eye),u=a.collision.elevationMargin;s&&l<u&&(B(ne,J,o.eye),o.eye=c.setAltitude(Ne,u,o.eye),W(J,o.eye,ne))}return o.center=J,o}function Yt(e,t,n){if(!e.state.isGlobal||!e.stateManager.constraintsManager)return!1;let r=_n(e,t),o=e.stateManager.constraintsManager.nearFarHeuristic,{far:a}=o.compute(t,n,e.renderDataExtent,r,Fn),i=a*a;return Ke(t,n)>i}function Nn(e,t,n){let r=Qt[e.viewingMode];r||(r=Bt(e.state.viewingMode),r.options.backfacesTerrain=!e.state.isGlobal,r.options.invisibleTerrain=!0,Qt[e.viewingMode]=r);let{isGlobal:o}=e.state;return!(!e.sceneIntersectionHelper.intersectRay(t,r,n)||Yt(e,t.origin,n))||!(!e.renderCoordsHelper.intersectManifold(t,0,n)||Yt(e,t.origin,n))||!!o&&Un(t,n,k(e.spatialReference).radius)}function Un(e,t,n){let r=A(e.origin,e.origin)-n*n,o=r>0?Math.sqrt(r)/3:1;return S(t,e.direction,o/R(e.direction)),W(t,t,e.origin),!0}var Qt={},Ne=f(),J=f(),ne=f(),Fn={near:0,far:0};function en(e,t){let n=[],r=[];return Ue(n,e,t,N.LEFT),Ue(r,n,t,N.BOTTOM),Ue(n,r,t,N.RIGHT),Ue(r,n,t,N.TOP),r}function Ue(e,t,n,r){let o=Hn(n,r);if(e.length=0,t.length){o(Fe,t[0],t[0])===C.INSIDE&&Re(e,t[0]);for(let a=0;a<t.length;a++){let i=t[a===t.length-1?0:a+1];switch(o(Fe,t[a],i)){case C.INSIDE:Re(e,i);break;case C.INSIDE_OUT:Re(e,Qe(Fe));break;case C.OUTSIDE_IN:Re(e,Qe(Fe)),Re(e,i);case C.OUTSIDE:}}}}function Re(e,t){e.length!==0&&Ct(e.at(-1),t)||e.push(t)}function Hn(e,t){let n=t===N.LEFT||t===N.RIGHT?0:1,r=e[t],o=t===N.LEFT||t===N.BOTTOM?le.MIN:le.MAX,a=n===0?1:0;return(i,s,c)=>{if(s[n]<r&&c[n]<r)return o===le.MIN?C.OUTSIDE:C.INSIDE;if(s[n]>r&&c[n]>r)return o===le.MIN?C.INSIDE:C.OUTSIDE;let l=(c[a]-s[a])/(c[n]-s[n]),u=s[a]+l*(r-s[n]);return i[n]=r,i[a]=u,(s[n]<r?1:-1)*o>0?C.OUTSIDE_IN:C.INSIDE_OUT}}var le,C,N;(function(e){e[e.MIN=1]="MIN",e[e.MAX=-1]="MAX"})(le||(le={})),function(e){e[e.OUTSIDE=0]="OUTSIDE",e[e.INSIDE=1]="INSIDE",e[e.OUTSIDE_IN=2]="OUTSIDE_IN",e[e.INSIDE_OUT=3]="INSIDE_OUT"}(C||(C={})),function(e){e[e.LEFT=0]="LEFT",e[e.BOTTOM=1]="BOTTOM",e[e.RIGHT=2]="RIGHT",e[e.TOP=3]="TOP"}(N||(N={}));var Fe=_t();var Ln=f(),He=f();function Le(){return{direction:f(),up:f()}}function ze(e,t,n,r,o){let a=te(Ln,e),i=A(a,r),s=i>0;i=Math.abs(i),i>.99&&(i=Math.abs(A(t,r)),i<.99?(P(a,t),s&&S(a,a,-1)):a=null);let c=0;if(a){S(He,r,A(r,a)),B(a,a,He);let u=A(a,o)/(R(a)*R(o));F(He,a,o),c=(A(He,r)>0?1:-1)*I(Te(u))}let l=I(Te(-A(r,e)/R(e)));return n?(n.heading=c,n.tilt=l,n):{heading:c,tilt:l}}function je(e,t,n,r){B(tn,n,t),Ht(r,Gt(t,tn),e)||e===n||P(e,n)}var tn=f();var nn=q(0,1,0),rn=q(0,0,1),Se=be(),L=f(),z=f();function on(e,t,n,r=Le()){let{direction:o,up:a}=r;return Et(Se,-y(t)),St(Se,Se,y(n)),ae(o,rn,Se),S(o,o,-1),ae(a,nn,Se),r}function zn(e,t,n,r){return ze(t,n,r,rn,nn)}function jn(e,t,n,r){let o=on(e,n,r),a=f();return S(a,o.direction,-t),W(a,a,e),{up:o.up,eye:a,heading:n,tilt:r}}function Gn(e){return I(e)}function Vn(e){return y(e)}function kn(e,t,n,r,o){let a=e.renderSpatialReference,i=e.spatialReference??t.spatialReference;return ie(t,L,a),ie(t,z,a),L[0]-=n/2,z[0]+=n/2,L[1]-=r/2,z[1]+=r/2,ce(L,a,L,i),ce(z,a,z,i),o?(o.xmin=L[0],o.ymin=L[1],o.xmax=z[0],o.ymax=z[1],o.spatialReference=i):o=new Ae(L[0],L[1],z[0],z[1],i),o}function qn(e,t){let n=e.frustum,{renderCoordsHelper:r}=e,o=r.getAltitude(t),a=e.spatialReference,i=e.state.camera.eye,s=[],c=n.planes[Oe.FAR];for(let l=0;l<4;l++){let u=n.lines[l];r.intersectInfiniteManifold(De(u.origin,u.direction),o,_)||Wn(_,n,r,u.endpoint,o),je(_,i,_,c),s.push(Nt(_[0],_[1]))}return Bn(en(s,r.extent),r,a)}function Wn(e,t,n,r,o){let a=t.lines[H.FAR_LEFT].direction,i=(o-n.getAltitude(r))/a[2];ye(e,r,a,i)}function Bn(e,t,n){let r=e.map(o=>(bt(_,o[0],o[1],0),t.fromRenderCoords(_,_,n),[_[0],_[1]]));return r.length<=2?new ge({spatialReference:n}):(r.push(r[0].slice()),Ce(r)||r.reverse(),new ge({rings:[r],spatialReference:n}))}var _=f(),an=Object.freeze(Object.defineProperty({__proto__:null,directionToHeadingTilt:zn,eyeForCenterWithHeadingTilt:jn,eyeTiltToLookAtTilt:Vn,headingTiltToDirectionUp:on,lookAtTiltToEyeTilt:Gn,toArea:qn,toExtent:kn},Symbol.toStringTag,{value:"Module"}));function cn(e,t,n){e.worldUpAtPosition(t,sn),B(at,n,t);let r=R(at);return r===0?0:Te(A(at,sn)/r)}var sn=f(),at=f();var un=q(0,0,1),fn=te(f(),q(1,1,1)),Jn=new Me(-180,180),ve=be(),X=f(),ue=f();function mn(e,t,n,r=Le()){F(X,e,un),A(X,X)===0&&F(X,e,fn),vt(ve,-y(t),e),Rt(ve,ve,-y(n),X);let{up:o,direction:a}=r;return F(o,X,e),te(o,o),ae(o,o,ve),te(a,e),Dt(a,a),ae(a,a,ve),r}function Xn(e,t,n,r){let o=X,a=ue;return te(o,e),F(ue,o,un),A(ue,ue)===0&&F(ue,o,fn),F(a,ue,o),ze(t,n,r,o,a)}function Zn(e,t,n,r){let o={eye:f(),up:null,tilt:r,heading:n},a=X;a[0]=e[0],a[1]=e[2],a[2]=-e[1];let i=t,s=y(n),c=y(r),l=Math.sin(s),u=Math.cos(s),p=Math.sin(c),d=Math.cos(c),h=R(a),m;if(Math.abs(c)<1e-8)m=i+h;else{let we=h/p,xe=re(i/we),We=Math.PI-c-xe;m=we*Math.sin(We)}let w=d*i,D=i*i*(p*p),b=u*u*D,x=m-w,T=x*x,g=b*(b+T-a[1]*a[1]);if(g<0)return S(o.eye,a,m/h),o.tilt=0,Ge(o,e);let Y=Math.sqrt(g),j=a[1]*x,G=b+T,Q;if(Q=u>0?-Y+j:Y+j,Math.abs(G)<1e-8)return h<1e-8?(o.eye[0]=0,o.eye[1]=0,o.eye[2]=i):S(o.eye,a,m/h),o.tilt=0,it(o.eye),Ge(o,e);o.eye[1]=Q/G;let M=l*l*D,pe=p*i,qe=u*pe*o.eye[1],de=o.eye[1]*o.eye[1],$=1-de,V=Math.sqrt($),ee=b*de+M-2*qe*V*x+$*T;return Math.abs(ee)<1e-8?(S(o.eye,a,m/h),o.tilt=0,it(o.eye),Ge(o,e)):(o.eye[0]=($*(m*a[0]-w*a[0])-pe*V*(a[0]*o.eye[1]*u+a[2]*l))/ee,o.eye[2]=($*(m*a[2]-w*a[2])-pe*V*(a[2]*o.eye[1]*u-a[0]*l))/ee,S(o.eye,o.eye,m),it(o.eye),Ge(o,e))}function it(e){let t=e[1];e[1]=-e[2],e[2]=t}function Ge(e,t){let n=mn(t,e.heading,e.tilt);return e.up=n.up,e}function Kn(e,t,n){let r=R(t),o=Math.sqrt(n*n+r*r-2*n*r*Math.cos(Math.PI-e)),a=re(n/(o/Math.sin(e)));return I(e-a)}function Yn(e,t,n){let r=y(e),o=R(t);return re(n/(o/Math.sin(r)))+r}function Qn(e,t,n,r,o){let a,i,s,c,l=t.latitude,u=k(e.spatialReference).radius,p=t.longitude,d=Zt(l,n,u)/2;a=p-d,i=p+d;let h=y(l),m=(1+Math.sin(h))/(1-Math.sin(h)),w=(m+1)*Math.tan(r/u/2),D=w*w;function b(T){let g=Math.PI/2;return(T=Jt.normalize(T,-g))>g&&(T=Math.PI-T),T}if(s=1.5*Math.PI-2*Math.atan(.5*(w+Math.sqrt(4*m+D))),c=s+r/u,s=b(s),c=b(c),c<s){let T=c;c=s,s=T}if(s=Math.max(I(s),-90),c=Math.min(I(c),90),i=Jn.monotonic(a,i),i-a>180){let T=(i-a-180)/2;a+=T,i-=T}let x=e.spatialReference&&e.spatialReference.isGeographic?e.spatialReference:he.WGS84;return o?(o.xmin=a,o.ymin=s,o.xmax=i,o.ymax=c,o.spatialReference=x):o=new Ae(a,s,i,c,x),e.spatialReference&&e.spatialReference.isWebMercator&&gt(o,!1,o),o}function $n(e,t){let n=e.frustum,{renderCoordsHelper:r}=e,o=r.getAltitude(t),a=e.spatialReference,i=r.referenceEllipsoid.radius,s=e.state.camera,c=s.eye,l=1+oe(c,t)/(i+o),u=Math.sqrt(l*l-1),{minCurvature:p,maxCurvature:d,minSamples:h,maxSamples:m}=rr,w=nr(e),D=yt((u-p)/(d-p),0,1),b=Math.round(Be(h,m,D)),x=s.aboveGround,T=n.planes[Oe.FAR],g=[],Y=et(Je,or,$e()),j=et(Je,ar,$e());wt(st,0,0,0,0);let G=M=>{};for(let M=0;M<4;M++){let pe=M===H.NEAR_FAR_BOTTOM_RIGHT&&!x||M===H.NEAR_FAR_TOP_LEFT&&x?1-w:0,qe=M===H.NEAR_FAR_BOTTOM_RIGHT&&x||M===H.NEAR_FAR_TOP_LEFT&&!x?w:1,de=n.lines[M],$=n.lines[M===3?0:M+1];for(let V=0;V<b;V++){let ee=V/b,we=M===H.NEAR_FAR_BOTTOM_RIGHT?1-(1-ee)**2:M===H.NEAR_FAR_TOP_LEFT?ee**2:ee,xe=V===0?0:Be(pe,qe,we),We=Ot(sr,de.origin,$.origin,xe),On=Ft(de.direction,$.direction,xe,ir);r.intersectManifoldClosestSilhouette(De(We,On),o,E),je(E,c,E,T),g.push(Ie(E)),g.length!==0&&G(Ye(g.at(-1),E));let Pn=(tt(Y,E)?1:0)|(tt(j,E)?2:0);st[Pn]=1}}g.length>2&&G(Ye(g[0],g.at(-1)));let Q=er(xt(st)>1?tr(pn(g,Y),j):[g],r,a);return new ge({rings:Q,spatialReference:a})}function er(e,t,n){let r=2*Xe();return e.map(o=>{let a=[],i=!1;for(let s of o)t.fromRenderCoords(s,E,n),Math.abs(s[0])<r&&Math.abs(s[1])<r?(a.push([null,E[1]]),a.push([null,E[1]]),i=!0):a.push([E[0],E[1]]);if(i)for(let s=0;s<a.length;s++){let c=a[s];if(c[0]!=null)continue;let l=a[s+1],u=a.at(s===0?-1:s-1);c[0]=u[0],s++;let p=a.at(s===a.length-1?0:s+1);l[0]=p[0]}return a.push(a[0]),Ce(a)||a.reverse(),a})}function tr(e,t){let n=[];for(let r of e)n.push(...pn(r,t));return n}function pn(e,t){let n=[],r=[],o=Xe();for(let i=0;i<e.length;i++){let s=e[i],c=i===e.length-1?e[0]:e[i+1],l=Vt(s,c,cr),u=Lt(t,l.origin,l.vector,zt.NONE,E);switch(u){case se.INSIDE:n.push(s);break;case se.OUTSIDE:r.push(s);break;case se.INTERSECTS_INSIDE_OUT:case se.INTERSECTS_OUTSIDE_IN:{let[p,d,h]=u===se.INTERSECTS_INSIDE_OUT?[1,n,r]:[-1,r,n],m=t,w=ye(f(),E,m,p*o),D=ye(f(),E,m,p*-o);d.push(s),d.push(w),h.push(D)}}}let a=[];return n.length&&a.push(n),r.length&&a.push(r),a}function nr(e){let{renderCoordsHelper:t,state:{camera:n}}=e,{center:r,eye:o}=n,a=Math.abs(t.getAltitude(r)),i=Math.abs(Math.PI/2-cn(t,r,o));return qt(ln,t.referenceEllipsoid.radius+a),Wt(ln,i,n.distance,n.fovY)}var rr={minCurvature:y(5),maxCurvature:y(50),minSamples:1,maxSamples:6},or=q(1,0,0),ar=q(0,1,0),ir=f(),sr=f(),E=f(),ln=kt(),cr=jt(),st=At(),dn=Object.freeze(Object.defineProperty({__proto__:null,directionToHeadingTilt:Xn,eyeForCenterWithHeadingTilt:Zn,eyeTiltToLookAtTilt:Yn,headingTiltToDirectionUp:mn,lookAtTiltToEyeTilt:Kn,toArea:$n,toExtent:Qn},Symbol.toStringTag,{value:"Module"}));var ut=()=>Tt.getLogger("esri.views.3d.support.cameraUtils"),Tn=96*39.37,ct=1,lr=8,ur=5,gn=1,fr={heading:0,tilt:0},Ee=f(),mr=new Me(-20037508342788905e-9,20037508342788905e-9),pr=new Me(-180,180),Z;function me(e){return e.spatialReference??he.WGS84}function K({state:e}){return e.isGlobal?dn:an}function sa(e,t,n,r,o){return K(e).headingTiltToDirectionUp(t,n,r,o)}function dr(e,t){if(t==null)return null;let n=e.renderSpatialReference,r=K(e).headingTiltToDirectionUp,o=f();if(!ie(t.position,o,n))return null;let a=r(o,t.heading,t.tilt);S(a.direction,a.direction,e.state.camera.distance),W(a.direction,a.direction,o);let i=$t(e,o,a.direction,a.up);return i.fov=y(t.fov),i.row=t.layout.row,i.rows=t.layout.rows,i.column=t.layout.column,i.columns=t.layout.columns,i}(function(e){e[e.LOCKED=0]="LOCKED",e[e.ADJUST=1]="ADJUST"})(Z||(Z={}));var fe=f();function ca(e,t,n){let r=e.renderSpatialReference,o=ft(e,t.eye,t.viewForward,t.up,fr),a=me(e);return ce(t.eye,r,fe,a)||(a=he.WGS84,ce(t.eye,r,fe,a)),n==null?n=new _e(new v(fe,a),o.heading,o.tilt,I(t.fov)):(n.position.x=fe[0],n.position.y=fe[1],n.position.z=fe[2],n.position.spatialReference=a,n.heading=o.heading,n.tilt=o.tilt,n.fov=I(t.fov)),n.layout.row=t.row,n.layout.rows=t.rows,n.layout.column=t.column,n.layout.columns=t.columns,n}function lt(e,t){let{camera:n}=e.state,{unitInMeters:r}=e.renderCoordsHelper;return t/=r,n.width/2/n.pixelRatio/(Tn/t)/Math.tan(n.fovX/2)}function hr(e,t){let{camera:n}=e.state,{unitInMeters:r}=e.renderCoordsHelper,o=t*Math.tan(n.fovX/2),a=n.width/2/n.pixelRatio;return Tn/(a/o)*r}function Tr(e,t,n,r){let o=r.levelAtScale(t),a=yn(ft(e,n.eye,n.viewForward,n.up).tilt),i=Math.max(o-a,0);return r.scaleAtLevel(i)}function hn(e,t,n){let r=n.levelAtScale(e),o=yn(t);return n.scaleAtLevel(r+o)}function yn(e){return 2*((e>90?180-e:e)/90)**2}function gr(e,t,n=0){let r=e.basemapTerrain?.tilingScheme;if(!r)return 0;let o=k(e.spatialReference).radius,a=e.state.viewingMode===nt.Local?t.eye[2]:R(t.eye)-o;return Tr(e,hr(e,Math.abs(a-n)),t,r)}function yr(e,t,n=0){let r=dr(e,t);return r?gr(e,r,n):0}var Mr=1,Rr=100;function la(e,t,n,r,o){if(t===0)return 0;let a=oe(n.eye,r),i=e.basemapTerrain?.tilingScheme;if(!i)return ut().error("#scaleToTargetDistance()","Cannot compute distance from scale without a tiling scheme"),a;let s=a,c=ft(e,n.eye,n.viewForward,n.up),l=c.tilt>90;if(e.state.isLocal){let m=(lt(e,hn(t,c.tilt,i))-Math.abs(n.eye[2]-o[2]))/Math.cos(y(c.tilt));return s=l?s-m:s+m,s}let u=1/0,p=0,d=Ve(e,c.heading,c.tilt,r,a,Z.ADJUST);if(!d)return s;let h=R(o);for(;u>Mr&&p<Rr;){let m=R(d.eye),w=l?180-d.tilt:d.tilt,D=y(w),b=Math.sin(D)*m,x=Math.cos(D)*m,T=lt(e,hn(t,d.tilt,i)),g=l?h-T:h+T,Y=re(b/g),j=Math.cos(Y)*g-x,G=oe(d.eye,r);s=l?G-j:G+j,d=Ve(e,c.heading,c.tilt,r,s,Z.ADJUST);let Q=pt(e,d,I(n.fov));if(!d||!Q)return s;let M=yr(e,Q,h-k(e.spatialReference).radius);u=Math.abs(t-M),++p}return s}function ua(e,t,n,r,o,a){return U(this,null,function*(){return Sr(e,t,lt(e,n),r,o,a)})}function fa(e,t,n,r,o,a){return pt(e,Ve(e,r.heading,r.tilt,t,n,o),r.fov,a)}function Sr(e,t,n,r,o,a){return U(this,null,function*(){let i=yield Rn(e,r.heading,r.tilt,t,n,o,a);return O(a),Dn(e,i,r.fov,a)})}function ft(e,t,n,r,o){return K(e).directionToHeadingTilt(t,n,r,o)}function Mn(e,t){return!!(e.basemapTerrain&&e.renderCoordsHelper.fromRenderCoords(t,Ee,e.spatialReference)&&e.elevationProvider&&(ot(e.elevationProvider,Ee)??0)>Ee[2]-gn)}function vr(e,t,n){return U(this,null,function*(){if(Mn(e,t))return!0;let{elevationProvider:r,spatialReference:o,renderCoordsHelper:a}=e;if(r==null||!a.fromRenderCoords(t,Ee,o))return!1;let[i,s,c]=Ee,l=(yield r.queryElevation(i,s,c,o,"ground",n))??0;return O(n),l>c-gn})}function Er(e,t,n){return U(this,null,function*(){let r=f();if(t==null)return P(r,e.state.camera.center);if(t instanceof v){let{renderSpatialReference:o,basemapTerrain:a,elevationProvider:i}=e,s=t.spatialReference;if(yield Ut(t,r,o,0,{signal:n}),O(n),t.z==null&&a!=null&&i!=null){let c=yield i.queryElevation(t.x,t.y,t.z??0,s,"ground",n);O(n),c!=null&&e.renderCoordsHelper.setAltitude(r,c)}return r}return P(r,t)})}function wr(e,t){let n=f();if(t==null)return P(n,e.state.camera.center);if(t instanceof v){if(!ie(t,n,e.renderSpatialReference))return null;let{basemapTerrain:r,elevationProvider:o}=e;if(t.z==null&&r!=null&&o!=null){let a=ot(o,t);a!=null&&e.renderCoordsHelper.setAltitude(n,a)}return n}return P(n,t)}function Ve(e,t,n,r,o,a){return Sn(e,t,n,r instanceof v?r:null,wr(e,r),o,a)}function Rn(e,t,n,r,o,a,i){return U(this,null,function*(){let s=r instanceof v?r:null,c=yield Er(e,r,i);return O(i),vn(e,t,n,s,c,o,a,i)})}function Sn(e,t,n,r,o,a,i){if(o==null||!r&&(r=new v({spatialReference:me(e)}),!Pe(o,e.renderSpatialReference,r)))return null;let s=En(e,t,n,o,a,i);if(wn(e,n,i)&&Mn(e,s.eye)){let{tilt:c,mode:l}=xn(e,n,o,a);return Sn(e,t,c,r,o,a,l)}return An(s,o)}function vn(e,t,n,r,o,a,i,s){return U(this,null,function*(){r||(r=new v({spatialReference:me(e)}),(yield rt(o,e.renderSpatialReference,r,{signal:s}))||(r=null)),O(s);let c=En(e,t,n,o,a,i);if(wn(e,n,i)&&(yield vr(e,c.eye,s))){O(s);let{tilt:l,mode:u}=xn(e,n,o,a);return vn(e,t,l,r,o,a,u,s)}return An(c,o)})}function En(e,t,n,r,o,a){let i=Ar(e,t,n,r,o=Math.max(o,e.state.constraints.minimumPoiDistance),a);return(0,K(e).eyeForCenterWithHeadingTilt)(r,o,i.heading,i.tilt)}function wn(e,t,n){let r=e.map.ground.navigationConstraint;return n===Z.ADJUST&&e.state.isGlobal&&t>0&&(r==null||r.type==="stay-above")}function xn(e,t,n,r){let o=bn(e,n,r,Cr(e,r,t,n));return{tilt:o,mode:t-o<1?Z.LOCKED:Z.ADJUST}}function An(e,t){return ht(dt({},e),{center:Ie(t)})}function In(e,t){let{state:n,spatialReference:r}=e,o=t.spatialReference;return n.isGlobal&&Kt(o,nt.Global)||n.isLocal&&r.equals(o)}function Cn(e,t){let n,r,o;if(e.state.isGlobal){let u=new v(t.xmin,t.ymin,t.spatialReference),p=new v(t.xmax,t.ymax,t.spatialReference),d=t.spatialReference.isGeographic?pr:mr;n=new v({x:d.center(u.x,p.x),y:(p.y+u.y)/2,z:t.zmax!=null&&t.zmin!=null?(t.zmax+t.zmin)/2:void 0,spatialReference:t.spatialReference});let h=k(t.spatialReference),m=Xt(n,u,p);r=m.lon,o=m.lat,d.diff(u.x,p.x)>d.range/2&&(r+=h.halfCircumference),r=Math.min(r,h.halfCircumference),o=Math.min(o,h.halfCircumference)}else{let u=e.renderSpatialReference??t.spatialReference;u.equals(t.spatialReference)||(t=Ze(t,u)),r=t.xmax-t.xmin,o=t.ymax-t.ymin;let p=t.zmax!=null&&t.zmin!=null?(t.zmax+t.zmin)/2:void 0;n=new v({x:t.xmin+.5*r,y:t.ymin+.5*o,z:p,spatialReference:u})}let a=t.zmax!=null&&t.zmin!=null?t.zmax-t.zmin:0,i=e.state.camera,s=1/Math.tan(i.fovX/2),c=1/Math.tan(i.fovY/2),l=1/Math.tan(i.fov/2);return{center:n,distance:Math.max(.5*r*s,.5*o*c,.5*a*l)/ct}}function ma(e,t,n,r,o,a){return U(this,null,function*(){let i=In(e,t)?t:yield It(t,e.spatialReference,{signal:a});O(a);let{center:s,distance:c}=Cn(e,i),l=yield Rn(e,n,r,s,c,o,a);return O(a),Dn(e,l,e.camera.fov,a)})}function pa(e,t,n,r,o,a){let i;try{i=In(e,t)?t:Ze(t,e.spatialReference)}catch{return null}let{center:s,distance:c}=Cn(e,i),l=Ve(e,n,r,s,c,o);return l==null?null:pt(e,l,e.camera.fov,a)}function da(e,t,n){let r=e.renderSpatialReference,o=new v({spatialReference:me(e)});if(!Pe(n,r,o))return null;let a=Math.tan(t.fovX/2),i=Math.tan(t.fovY/2),s=Pt(t.eye,n),c=2*s*a*ct,l=2*s*i*ct;return K(e).toExtent(e,o,c,l)}function ha(e,t){return K(e).toArea(e,t)}function xr(e,t,n){let r=e.pointsOfInterest.centerOnSurfaceFrequent.distance;if(Math.log(n/r)/Math.LN2>lr)return!0;let o=t,a=e.pointsOfInterest.centerOnSurfaceFrequent.renderLocation;return oe(o,a)/(Math.tan(.5*e.state.camera.fov)*r)>ur}function Ar(e,t,n,r,o,a){let i=0;return a===Z.ADJUST&&xr(e,r,o)?(t=0,i=Ir(e,o,n,r)):i=mt(e,r,o,n),i=e.state.constraints.clampTilt(o,i),{heading:t,tilt:n=bn(e,r,o,i)}}var ke=.7;function Ir(e,t,n,r){let o=mt(e,r,t,n);if(!e.state.constraints.tilt)return o;let a=e.state.constraints.tilt(t);a.max=Math.min(a.max,.5*Math.PI);let i=a.min*(1-ke)+a.max*ke;return Math.min(o,i)}function Cr(e,t,n,r){let o=mt(e,r,t,n);if(!e.state.constraints.tilt)return o;let a=e.state.constraints.tilt(t);return o=Math.min(o,.5*Math.PI),a.min*(1-ke)+o*ke}function bn(e,t,n,r){return K(e).lookAtTiltToEyeTilt(r,t,n)}function mt(e,t,n,r){return K(e).eyeTiltToLookAtTilt(r,t,n)}function pt(e,t,n,r){if(t==null)return null;let o=e.renderSpatialReference,a=new v({spatialReference:me(e)});return Pe(t.eye,o,a)?(r??=new _e,r.position=a,r.heading=t.heading,r.tilt=t.tilt,r.fov=n,r):null}function Dn(e,t,n,r){return U(this,null,function*(){let o=e.renderSpatialReference,a=new v({spatialReference:me(e)});return yield rt(t.eye,o,a,{signal:r}),O(r),new _e(a,t.heading,t.tilt,n)})}function Ta(e,t){let n=e.basemapTerrain?.tilingScheme;if(n)return n.levelAtScale(t);ut().error("#scaleToZoom()","Cannot compute zoom from scale without a tiling scheme")}function ga(e,t){let n=e.basemapTerrain?.tilingScheme;if(n)return n.scaleAtLevel(t);ut().error("#zoomToScale()","Cannot compute scale from zoom without a tiling scheme")}export{Nr as a,_n as b,$t as c,Le as d,cn as e,Z as f,me as g,sa as h,dr as i,ca as j,lt as k,hr as l,Tr as m,la as n,ua as o,fa as p,Sr as q,ft as r,Ve as s,ma as t,pa as u,da as v,ha as w,Ta as x,ga as y};
