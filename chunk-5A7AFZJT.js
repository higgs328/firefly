import{a as T}from"./chunk-Z5EURZKA.js";import{a as B}from"./chunk-PE276TWH.js";import{a as M}from"./chunk-IBVI7JQ7.js";import{a as F}from"./chunk-2DFFQEIV.js";import{a as R}from"./chunk-J2AEVBSH.js";import{y as w,z as C}from"./chunk-XR5FT7TQ.js";import{i as j}from"./chunk-N3HRYLNW.js";import{b as h}from"./chunk-2HYVVLKS.js";import{a as E}from"./chunk-CSNRCIB5.js";import{$ as z,Z as k}from"./chunk-KALOJIUA.js";import{a as g,b as I}from"./chunk-PQGCNP5H.js";import{a as D}from"./chunk-JLPLCY2B.js";import{d as L}from"./chunk-SLAWDKDA.js";import{a as A}from"./chunk-BAEF3CT6.js";import{d as f}from"./chunk-KNVXE32P.js";import{d as P}from"./chunk-RAI4DTMT.js";import{g as v}from"./chunk-5QEXLALV.js";import{b as i}from"./chunk-YOFFGXOB.js";import{a as b,b as x,f as s}from"./chunk-VTHXE323.js";var wt=new A({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryMultiPatch:"multipatch"});function gt(t,e,n,r){return s(this,null,function*(){let a=yield m(t);if(yield q(t,e,r),!a.addAttachment)throw new i(r,"Layer source does not support addAttachment capability");return a.addAttachment(e,n)})}function q(t,e,n){let{attributes:r}=e,{objectIdField:a}=t;return t.capabilities?.data?.supportsAttachment?e?r?a&&r[a]?Promise.resolve():Promise.reject(new i(n,`feature is missing the identifying attribute ${a}`)):Promise.reject(new i(n,"'attributes' are required on a feature to query attachments")):Promise.reject(new i(n,"A feature is required to add/delete/update attachments")):Promise.reject(new i(n,"this layer doesn't support attachments"))}function It(t,e,n,r,a){return s(this,null,function*(){let o=yield m(t);if(yield q(t,e,a),!o.updateAttachment)throw new i(a,"Layer source does not support updateAttachment capability");return o.updateAttachment(e,n,r)})}function Ft(t,e,n){return s(this,null,function*(){let{applyEdits:r}=yield import("./chunk-NSMI24YS.js"),a=yield t.load(),o=n;return a.type==="feature"&&a.infoFor3D&&e.deleteFeatures!=null&&a.globalIdField!=null&&(o=x(b({},o),{globalIdToObjectId:yield H(a,e.deleteFeatures,a.globalIdField)})),r(a,a.source,e,n)})}function St(t,e,n){return s(this,null,function*(){let{uploadAssets:r}=yield import("./chunk-NSMI24YS.js"),a=yield t.load();return r(a,a.source,e,n)})}function qt(t,e,n,r){return s(this,null,function*(){let a=yield m(t);if(yield q(t,e,r),!a.deleteAttachments)throw new i(r,"Layer source does not support deleteAttachments capability");return a.deleteAttachments(e,n)})}function Ot(t,e,n){return s(this,null,function*(){let r=(yield t.load({signal:e?.signal})).source;if(!r.fetchRecomputedExtents)throw new i(n,"Layer source does not support fetchUpdates capability");return r.fetchRecomputedExtents(e)})}function xt(t,e,n,r){return s(this,null,function*(){e=M.from(e),yield t.load();let a=t.source,o=t.capabilities;if(!o?.data?.supportsAttachment)throw new i(r,"this layer doesn't support attachments");let{attachmentTypes:l,objectIds:c,globalIds:u,num:p,size:d,start:y,where:O}=e;if(!o?.operations?.supportsQueryAttachments&&(l?.length>0||u?.length>0||d?.length>0||p||y||O))throw new i(r,"when 'capabilities.operations.supportsQueryAttachments' is false, only objectIds is supported",e);if(!(c?.length||u?.length||O))throw new i(r,"'objectIds', 'globalIds', or 'where' are required to perform attachment query",e);if(!a.queryAttachments)throw new i(r,"Layer source does not support queryAttachments capability",e);return!o?.attachment?.supportsOrderByFields&&e.orderByFields?.length&&((e=e.clone()).orderByFields=null),a.queryAttachments(e)})}function vt(t,e,n,r){return s(this,null,function*(){let a=yield m(t);if(!a.queryObjectIds)throw new i(r,"Layer source does not support queryObjectIds capability");return a.queryObjectIds(h.from(e)??t.createQuery(),n)})}function At(t,e,n,r){return s(this,null,function*(){let a=yield m(t);if(!a.queryFeatureCount)throw new i(r,"Layer source does not support queryFeatureCount capability");return a.queryFeatureCount(h.from(e)??t.createQuery(),n)})}function Pt(t,e,n,r){return s(this,null,function*(){let a=yield m(t);if(!a.queryExtent)throw new i(r,"Layer source does not support queryExtent capability");return a.queryExtent(h.from(e)??t.createQuery(),n)})}function Lt(t,e,n,r){return s(this,null,function*(){let a=yield m(t);if(!a.queryRelatedFeatures)throw new i(r,"Layer source does not support queryRelatedFeatures capability");return a.queryRelatedFeatures(F.from(e),n)})}function Ct(t,e,n,r){return s(this,null,function*(){let a=yield m(t);if(!a.queryRelatedFeaturesCount)throw new i(r,"Layer source does not support queryRelatedFeaturesCount capability");return a.queryRelatedFeaturesCount(F.from(e),n)})}function Dt(t){return s(this,null,function*(){let e=t.source;if(e?.refresh)try{let{dataChanged:n,updates:r}=yield e.refresh();if(r!=null&&(t.sourceJSON=b(b({},t.sourceJSON),r),t.read(r,{origin:"service",url:t.parsedUrl})),n)return!0}catch{}if(t.definitionExpression)try{return(yield D(t.definitionExpression,t.fieldsIndex)).hasDateFunctions}catch{}return!1})}function Et(t){let e=new h,n=t.capabilities?.data,r=t.capabilities?.query;e.historicMoment=t.historicMoment,e.gdbVersion=t.gdbVersion,e.returnGeometry=!0,r&&(e.compactGeometryEnabled=r.supportsCompactGeometry,e.defaultSpatialReferenceEnabled=r.supportsDefaultSpatialReference),n&&(n.supportsZ&&t.returnZ!=null&&(e.returnZ=t.returnZ),n.supportsM&&t.returnM!=null&&(e.returnM=t.returnM)),e.outFields=["*"];let{timeOffset:a,timeExtent:o}=t;return e.timeExtent=a!=null&&o!=null?o.offset(-a.value,a.unit):o||null,e.multipatchOption=t.geometryType==="multipatch"?"xyFootprint":null,e}function jt(t){let{globalIdField:e,fields:n}=t;if(e)return e;if(n){for(let r of n)if(r.type==="esriFieldTypeGlobalID")return r.name}}function Tt(t){let{objectIdField:e,fields:n}=t;if(e)return e;if(n){for(let r of n)if(r.type==="esriFieldTypeOID")return r.name}}function Rt(t){return t.currentVersion?t.currentVersion:t.hasOwnProperty("capabilities")||t.hasOwnProperty("drawingInfo")||t.hasOwnProperty("hasAttachments")||t.hasOwnProperty("htmlPopupType")||t.hasOwnProperty("relationships")||t.hasOwnProperty("timeInfo")||t.hasOwnProperty("typeIdField")||t.hasOwnProperty("types")?10:9.3}function Bt(t,e,n,r){let a=n?.feature,o=!!t.subtypes?.length;if(o&&!n?.excludeImpliedDomains){let u=Q(t,e);if(u)return u}let l=o&&J(t,a);if(l){let u=l?.domains?.[e];return u?.type==="inherited"?r:u}let c=K(t.types,t.typeIdField,a);if(c){let u=c.domains&&c.domains[e];if(u&&u?.type!=="inherited")return u}if(r)return r;if(!n?.excludeImpliedDomains){let u=$(t,e);if(u)return u}return null}function J(t,e){let{subtypes:n,subtypeField:r}=t;if(!e?.attributes||!n?.length||!r)return null;let a=e.attributes[r];return a==null?null:n.find(o=>o.code===a)}function Q(t,e){let{fieldsIndex:n,subtypeField:r}=t,{name:a,type:o}=n.get(e)??{};if(!a)return null;if((r&&n.get(r)?.name)===a&&t.subtypes?.length){let l=t.subtypes.map(c=>new g({code:U(c.code,o),name:c.name}));if(l?.length)return new I({codedValues:l})}return null}function $(t,e){let{fieldsIndex:n}=t,{name:r,type:a}=n.get(e)??{};if(!r)return null;if(("typeIdField"in t?n.get(t.typeIdField)?.name:null)===r&&"types"in t&&t.types?.length){let o=t.types.map(l=>new g({code:U(l.id,a),name:l.name}));return new I({codedValues:o})}return null}function U(t,e){return e?z({type:e})&&typeof t=="number"?`${t}`:k({type:e})&&typeof t=="string"?Number.parseInt(t,10):t:t}function m(t){return s(this,null,function*(){return(yield t.load()).source})}function Mt(t,e){return s(this,null,function*(){if(!f)return;let n=f.findCredential(t);if(n)return n.userId;let r;try{let a=yield w(t,e);a&&(r=yield f.checkSignInStatus(`${a}/sharing`))}catch{}return r?r.userId:null})}function V(t,e){return s(this,null,function*(){if(!f||f.findCredential(t))return;let n;try{let r=yield w(t,e);r&&(n=yield f.checkSignInStatus(`${r}/sharing`))}catch{}if(n)try{let r=e!=null?e.signal:null;yield f.getCredential(t,{signal:r})}catch{}})}function kt(t,e,n){return s(this,null,function*(){let r=t.parsedUrl?.path;r&&t.authenticationTriggerEvent===e&&(yield V(r,n))})}function zt(t){return s(this,null,function*(){let e=t.parsedUrl?.path;e&&W(t)&&(yield V(e))})}function W(t){return Z(t)&&("serviceDefinitionExpression"in t&&G(t.serviceDefinitionExpression)||"definitionExpression"in t&&G(t.definitionExpression))}function Z(t){return!(!C(t)||!t.capabilities?.query.supportsCurrentUser)}function G(t){return!!t?.toLowerCase().includes("current_user")}function Gt(t){return!_(t)&&(t.userHasUpdateItemPrivileges||t.editingEnabled)}var S=v({types:j});function Nt(t,e){if(t.defaultSymbol)return t.types?.length?new B({defaultSymbol:S(t.defaultSymbol,t,e),field:t.typeIdField,uniqueValueInfos:t.types.map(n=>({id:n.id,symbol:S(n.symbol,n,e)}))}):new R({symbol:S(t.defaultSymbol,t,e)})}function Ut(t){let e=t.sourceJSON?.cacheMaxAge;if(!e)return!1;let n=t.editingInfo?.lastEditDate?.getTime();return n==null||(e*=1e3,Date.now()-n<e)}function H(t,e,n){return s(this,null,function*(){if(e==null)return null;let r=[],{objectIdField:a}=t;if(e.forEach(p=>{let d=null;if("attributes"in p){let{attributes:y}=p;d={globalId:y[n],objectId:y[a]!=null&&y[a]!==-1?y[a]:null}}else d={globalId:p.globalId,objectId:p.objectId!=null&&p.objectId!==-1?p.objectId:null};d.globalId!=null&&(d.objectId!=null&&d.objectId!==-1||r.push(d.globalId))}),r.length===0)return null;let o=t.createQuery();o.where=r.map(p=>`${n}='${p}'`).join(" OR "),o.returnGeometry=!1,o.outFields=[a,n],o.cacheHint=!1;let l=yield P(T(t,o));if(!l.ok)return null;let c=new Map,u=l.value.features;for(let p of u){let d=p.attributes[n],y=p.attributes[a];d!=null&&y!=null&&y!==-1&&c.set(L(d),y)}return c})}function K(t,e,n){if(!e||!n||!t)return null;let r=n.getAttribute(e);return r==null?null:t.find(a=>{let{id:o}=a;return o!=null&&o.toString()===r.toString()})??null}function _(t){return t.sourceJSON?.isMultiServicesView||X(t)}function X(t){return!!t.sourceJSON?.capabilities?.toLowerCase().split(",").map(e=>e.trim()).includes("map")}function Vt(t,e,n){let r=e?.queryAttributeBins;if(!r)throw new i(n,"Layer source does not support binning");switch(t.binParameters.type){case"auto-interval":if(!r.supportsAutoInterval)throw new i(n,"Layer source does not support auto-interval binning");if(t.binParameters.normalizationType&&(!r.supportsNormalization||!N(t.binParameters.normalizationType,r.supportedNormalizationTypes)))throw new i(n,"Layer source does not support normalization binning");break;case"date":if(!r.supportsDate)throw new i(n,"Layer source does not support date binning");if(t.binParameters.snapToData&&!r.supportsSnapToData)throw new i(n,"Layer source does not support snapToData binning");if(t.binParameters.returnFullIntervalBin&&!r.supportsReturnFullIntervalBin)throw new i(n,"Layer source does not support returnFullIntervalBin binning");break;case"fixed-boundaries":if(!r.supportsFixedBoundaries)throw new i(n,"Layer source does not support fixed-boundaries binning");break;case"fixed-interval":if(!r.supportsFixedInterval)throw new i(n,"Layer source does not support fixed-interval binning");if(t.binParameters.normalizationType&&(!r.supportsNormalization||!N(t.binParameters.normalizationType,r.supportedNormalizationTypes)))throw new i(n,"Layer source does not support normalization binning")}if(t.binParameters.stackBy&&!r.supportsStackBy)throw new i(n,"Layer source does not support stackBy binning");if(t.binParameters.splitBy&&!r.supportsSplitBy)throw new i(n,"Layer source does not support splitBy binning");if(t.binParameters.firstDayOfWeek&&!r.supportsFirstDayOfWeek)throw new i(n,"Layer source does not support firstDayOfWeek binning");let a=r?.supportedStatistics;if(t.outStatistics&&a){let o=new Map([["count","count"],["sum","sum"],["min","min"],["max","max"],["avg","avg"],["stddev","stddev"],["var","var"],["percentile-continuous","percentileContinuous"],["percentile-discrete","percentileDiscrete"],["centroid-aggregate","centroid"],["convex-hull-aggregate","convexHull"],["envelope-aggregate","envelope"]]);for(let{statisticType:l}of t.outStatistics){let c=o.get(l);if(c&&!a[c])throw new i(n,`Layer source does not support ${l} statistic type`)}}}function N(t,e){return t!=null&&!!e?.[E.toJSON(t)]}export{wt as a,gt as b,It as c,Ft as d,St as e,qt as f,Ot as g,xt as h,vt as i,At as j,Pt as k,Lt as l,Ct as m,Dt as n,Et as o,jt as p,Tt as q,Rt as r,Bt as s,J as t,Q as u,$ as v,Mt as w,V as x,kt as y,zt as z,G as A,Gt as B,Nt as C,Ut as D,H as E,K as F,_ as G,Vt as H};
