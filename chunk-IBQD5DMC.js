import{a as Q}from"./chunk-XE6PIB3P.js";import{b as ee}from"./chunk-7F42SXKP.js";import{a as J}from"./chunk-BZ74LSSN.js";import{a as Z}from"./chunk-DLZUPWTU.js";import{a as K}from"./chunk-B3IHY5YC.js";import{a as X}from"./chunk-6M7OOF37.js";import{a as A,d as Y}from"./chunk-6HT3BT3B.js";import{a as q}from"./chunk-2WYOVBUR.js";import{a as B}from"./chunk-Z5EURZKA.js";import{b as D,h as v}from"./chunk-XR5FT7TQ.js";import{a as W}from"./chunk-LAX5536Z.js";import{b as H}from"./chunk-2HYVVLKS.js";import{a as M}from"./chunk-IR6XCBC4.js";import{o as P}from"./chunk-AUAZP44J.js";import{f as z}from"./chunk-CCJU4DSH.js";import{a as I}from"./chunk-QGVBCWUY.js";import{e as C}from"./chunk-NFIPKH6V.js";import{l as V}from"./chunk-5QEXLALV.js";import{e as x,f as g}from"./chunk-VTHXE323.js";var G=class extends z.JSONSupportMixin(M){constructor(t){super(t),this.rulesCategorized={attachment:[],containment:[],connectivity:[]},this.request=P}initialize(){}load(t){return g(this,null,function*(){let e=this.rulesLayer.load(t).then(()=>this._initializeRulesTable());return this.addResolvingPromise(e),this})}getFeaturesCanAssociateWithClause(t,e,o){return this._getWhereClauseForCompatibleFeatures(t,e,o)}getFeaturesCanAssociateWith(t,e,o){return this._getFeatureSourceLayerId(t)==null?[]:e.filter(r=>this.canAssociateFeatures(t,r,o))}canAssociateFeatures(t,e,o){let[r,s]=this._getFeatureAssetCodes(t),n=this._getFeatureSourceLayerId(t),[l,y]=this._getFeatureAssetCodes(e),p=this._getFeatureSourceLayerId(e);return n!=null&&p!=null&&o.some(a=>{let{type:i,direction:u}=a;return this._getRulesForAssociationType(i).some(c=>this._getRuleFieldValuesForAssociation(c,i,u)?.some(m=>n===m?.ruleLayerIdForSource&&r===m?.ruleAssetGroupCodeForSource&&s===m?.ruleAssetTypeCodeForSource&&p===m?.ruleLayerIdForTarget&&l===m?.ruleAssetGroupCodeForTarget&&y===m?.ruleAssetTypeCodeForTarget))})}getLayersCanAssociateWith(t,e,o){return this._getFeatureSourceLayerId(t)==null?[]:e.filter(r=>this.canAssociateFeatureToLayer(t,r,o))}canAssociateFeatureToLayer(t,e,o){let r=v(e)?e.parent:e;if(!r)return!1;let s=r.layerId,n=v(e)?e.subtypeCode:null,[l,y]=this._getFeatureAssetCodes(t),p=this._getFeatureSourceLayerId(t);return p!=null&&o.some(a=>{let{type:i,direction:u}=a;return this._getRulesForAssociationType(i).some(c=>this._getRuleFieldValuesForAssociation(c,i,u)?.some(m=>p===m?.ruleLayerIdForSource&&l===m?.ruleAssetGroupCodeForSource&&y===m?.ruleAssetTypeCodeForSource&&s===m?.ruleLayerIdForTarget&&(n==null||n===m?.ruleAssetGroupCodeForTarget)))})}getFeatureSQL(t,e){let o=t.layerId.toString(),r=t.fieldsIndex?.normalizeFieldName("assetGroup"),s=t.fieldsIndex?.normalizeFieldName("assetType"),n=r?e.attributes[r]:null,l=s?e.attributes[s]:null,y=this.rulesHash[o];if(y){let p=y.assetGroupHash[n];if(p)return p.assetTypeHash[l]||null}return null}_initializeRulesTable(){return g(this,null,function*(){let t={},e;(function(r){r[r.from=0]="from",r[r.to=1]="to",r[r.via=2]="via"})(e||(e={}));let o=[{networkSourceId:"fromNetworkSource",assetGroupId:"fromAssetGroup",assetTypeId:"fromAssetType"},{networkSourceId:"toNetworkSource",assetGroupId:"toAssetGroup",assetTypeId:"toAssetType"},{networkSourceId:"viaNetworkSource",assetGroupId:"viaAssetGroup",assetTypeId:"viaAssetType"}];this.rulesCategorized={attachment:[],containment:[],connectivity:[]};for(let r of this.rules){if(r.ruleType===A.RTAttachment){this.rulesCategorized.attachment.push(r);continue}if(r.ruleType===A.RTContainment){this.rulesCategorized.containment.push(r);continue}if(r.ruleType===A.RTJunctionJunctionConnectivity){this.rulesCategorized.connectivity.push(r);continue}this.rulesCategorized.connectivity.push(r);let s=[[e.from,e.to],[e.to,e.from]];r.ruleType===A.RTEdgeJunctionEdgeConnectivity&&(s=[[e.from,e.via],[e.via,e.from],[e.to,e.via],[e.via,e.to]]);for(let n of s){let l=n.shift(),y=n.shift(),p=!1;switch(r.ruleType){case A.RTEdgeJunctionEdgeConnectivity:p=l===e.from||l===e.to;break;case A.RTJunctionEdgeConnectivity:p=l===e.to}let a=o[l],i=r[a.networkSourceId]?.layerId.toString()??"",u=r[a.assetGroupId]?.assetGroupCode?.toString(),c=r[a.assetTypeId],d=c?.assetTypeCode?.toString(),m=o[y],S=r[m.networkSourceId]?.layerId.toString()??"",f=r[m.assetGroupId]?.assetGroupCode?.toString(),b=r[m.assetTypeId],_=b?.assetTypeCode?.toString(),E=t[i]??{assetGroupHash:{}};if(!(u&&d&&f&&_))continue;let L=E.assetGroupHash[u]??{assetTypeHash:{}},T=L.assetTypeHash[d]??{};if(T[S]=T[S]??{},p){T[i]=T[i]??{};let N=`(assetgroup = ${u} AND assettype = ${d})`;b?.connectivityPolicy==="esriNECPEndVertex"?T[i].endVertex=T[i]?.endVertex?`${T[i].endVertex}`:`${N}`:T[i].anyVertex=T[i].anyVertex?`${T[i].anyVertex}`:`${N}`}let h=`(assetgroup = ${f} AND assettype = ${_})`;b?.connectivityPolicy==="esriNECPEndVertex"?T[S].endVertex=T[S]?.endVertex?`${T[S].endVertex} OR ${h}`:`${h}`:T[S].anyVertex=T[S]?.anyVertex?`${T[S].anyVertex} OR ${h}`:`${h}`,L.assetTypeHash[d]=T,E.assetGroupHash[u]=L,t[i]=E}}this._set("rulesHash",t)})}_getRuleFieldValuesForAssociation(t,e,o="from"){switch(e){case"attachment":case"containment":return o==="from"?[{ruleLayerIdForSource:t.fromNetworkSource?.layerId,ruleAssetGroupCodeForSource:t.fromAssetGroup?.assetGroupCode,ruleAssetTypeCodeForSource:t.fromAssetType?.assetTypeCode,ruleLayerIdForTarget:t.toNetworkSource?.layerId,ruleAssetGroupCodeForTarget:t.toAssetGroup?.assetGroupCode,ruleAssetTypeCodeForTarget:t.toAssetType?.assetTypeCode}]:[{ruleLayerIdForSource:t.toNetworkSource?.layerId,ruleAssetGroupCodeForSource:t.toAssetGroup?.assetGroupCode,ruleAssetTypeCodeForSource:t.toAssetType?.assetTypeCode,ruleLayerIdForTarget:t.fromNetworkSource?.layerId,ruleAssetGroupCodeForTarget:t.fromAssetGroup?.assetGroupCode,ruleAssetTypeCodeForTarget:t.fromAssetType?.assetTypeCode}];case"connectivity":case"junction-junction-connectivity":return[{ruleLayerIdForSource:t.fromNetworkSource?.layerId,ruleAssetGroupCodeForSource:t.fromAssetGroup?.assetGroupCode,ruleAssetTypeCodeForSource:t.fromAssetType?.assetTypeCode,ruleLayerIdForTarget:t.toNetworkSource?.layerId,ruleAssetGroupCodeForTarget:t.toAssetGroup?.assetGroupCode,ruleAssetTypeCodeForTarget:t.toAssetType?.assetTypeCode},{ruleLayerIdForSource:t.toNetworkSource?.layerId,ruleAssetGroupCodeForSource:t.toAssetGroup?.assetGroupCode,ruleAssetTypeCodeForSource:t.toAssetType?.assetTypeCode,ruleLayerIdForTarget:t.fromNetworkSource?.layerId,ruleAssetGroupCodeForTarget:t.fromAssetGroup?.assetGroupCode,ruleAssetTypeCodeForTarget:t.fromAssetType?.assetTypeCode}];case"junction-edge-from-connectivity":case"junction-edge-midspan-connectivity":case"junction-edge-to-connectivity":return t.ruleType===A.RTEdgeJunctionEdgeConnectivity?[{ruleLayerIdForSource:t.fromNetworkSource?.layerId,ruleAssetGroupCodeForSource:t.fromAssetGroup?.assetGroupCode,ruleAssetTypeCodeForSource:t.fromAssetType?.assetTypeCode,ruleLayerIdForTarget:t.viaNetworkSource?.layerId,ruleAssetGroupCodeForTarget:t.viaAssetGroup?.assetGroupCode,ruleAssetTypeCodeForTarget:t.viaAssetType?.assetTypeCode},{ruleLayerIdForSource:t.viaNetworkSource?.layerId,ruleAssetGroupCodeForSource:t.viaAssetGroup?.assetGroupCode,ruleAssetTypeCodeForSource:t.viaAssetType?.assetTypeCode,ruleLayerIdForTarget:t.fromNetworkSource?.layerId,ruleAssetGroupCodeForTarget:t.fromAssetGroup?.assetGroupCode,ruleAssetTypeCodeForTarget:t.fromAssetType?.assetTypeCode},{ruleLayerIdForSource:t.toNetworkSource?.layerId,ruleAssetGroupCodeForSource:t.toAssetGroup?.assetGroupCode,ruleAssetTypeCodeForSource:t.toAssetType?.assetTypeCode,ruleLayerIdForTarget:t.viaNetworkSource?.layerId,ruleAssetGroupCodeForTarget:t.viaAssetGroup?.assetGroupCode,ruleAssetTypeCodeForTarget:t.viaAssetType?.assetTypeCode},{ruleLayerIdForSource:t.viaNetworkSource?.layerId,ruleAssetGroupCodeForSource:t.viaAssetGroup?.assetGroupCode,ruleAssetTypeCodeForSource:t.viaAssetType?.assetTypeCode,ruleLayerIdForTarget:t.toNetworkSource?.layerId,ruleAssetGroupCodeForTarget:t.toAssetGroup?.assetGroupCode,ruleAssetTypeCodeForTarget:t.toAssetType?.assetTypeCode}]:[{ruleLayerIdForSource:t.fromNetworkSource?.layerId,ruleAssetGroupCodeForSource:t.fromAssetGroup?.assetGroupCode,ruleAssetTypeCodeForSource:t.fromAssetType?.assetTypeCode,ruleLayerIdForTarget:t.toNetworkSource?.layerId,ruleAssetGroupCodeForTarget:t.toAssetGroup?.assetGroupCode,ruleAssetTypeCodeForTarget:t.toAssetType?.assetTypeCode},{ruleLayerIdForSource:t.toNetworkSource?.layerId,ruleAssetGroupCodeForSource:t.toAssetGroup?.assetGroupCode,ruleAssetTypeCodeForSource:t.toAssetType?.assetTypeCode,ruleLayerIdForTarget:t.fromNetworkSource?.layerId,ruleAssetGroupCodeForTarget:t.fromAssetGroup?.assetGroupCode,ruleAssetTypeCodeForTarget:t.fromAssetType?.assetTypeCode}];default:return[]}}_getWhereClauseForCompatibleFeatures(t,e,o){let r=new Map,[s,n]=this._getAssetFieldNames(t.sourceLayer),[l,y]=this._getFeatureAssetCodes(t),p=this._getFeatureSourceLayerId(t),a=v(e)?e.parent:e,i=v(e)?e.subtypeCode:null;o.forEach(c=>{let{type:d,direction:m}=c;this._getRulesForAssociationType(d).forEach(S=>{this._getRuleFieldValuesForAssociation(S,d,m).forEach(f=>{if(f.ruleAssetGroupCodeForTarget!=null&&f.ruleAssetTypeCodeForTarget!=null&&p===f?.ruleLayerIdForSource&&l===f?.ruleAssetGroupCodeForSource&&y===f?.ruleAssetTypeCodeForSource&&a.layerId===f?.ruleLayerIdForTarget&&(i==null||i===f?.ruleAssetGroupCodeForTarget)){let b=r.get(f.ruleAssetGroupCodeForTarget)??new Set;b.add(f.ruleAssetTypeCodeForTarget),r.set(f.ruleAssetGroupCodeForTarget,b)}})})});let u=[];return this._mergeAssetCodes(r).forEach((c,d)=>u.push(`${s} IN (${d}) AND ${n} IN (${Array.from(c).sort().join(", ")})`)),u.length>1&&(u=u.map(c=>`(${c})`)),u.join(" OR ")}_getRulesForAssociationType(t){let{rulesCategorized:e}=this;switch(t){case"attachment":return e.attachment;case"containment":return e.containment;case"connectivity":case"junction-junction-connectivity":return e.connectivity.filter(o=>o.ruleType===A.RTJunctionJunctionConnectivity);case"junction-edge-from-connectivity":case"junction-edge-midspan-connectivity":case"junction-edge-to-connectivity":return e.connectivity.filter(o=>o.ruleType===A.RTJunctionEdgeConnectivity||o.ruleType===A.RTEdgeJunctionEdgeConnectivity);default:return[]}}_getFeatureSourceLayerId(t){let{sourceLayer:e}=t,o;return D(e)?o=e.layerId:v(e)&&(o=e.parent?.layerId),o??null}_getAssetFieldNames(t){return!t||!("fieldsIndex"in t)?[null,null]:[t.fieldsIndex.normalizeFieldName("assetGroup")??null,t.fieldsIndex.normalizeFieldName("assetType")??null]}_getFeatureAssetCodes(t){let[e,o]=this._getAssetFieldNames(t.sourceLayer);return[e?t.attributes[e]:null,o?t.attributes[o]:null]}_areSetsEqual(t,e){if(t.size!==e.size)return!1;for(let o of t)if(!e.has(o))return!1;return!0}_mergeAssetCodes(t){let e=new Map,o=new Set;for(let[r,s]of t){let n=new Set([r]);for(let[y,p]of t)r!==y&&!o.has(y)&&this._areSetsEqual(s,p)&&(n.add(y),o.add(y));let l=Array.from(n).sort().join(", ");e.set(l,s)}return e}};I([C({constructOnly:!0})],G.prototype,"rulesLayer",void 0),I([C({constructOnly:!0})],G.prototype,"rules",void 0),I([C({readOnly:!0})],G.prototype,"rulesHash",void 0),I([C()],G.prototype,"rulesCategorized",void 0),I([C({constructOnly:!0})],G.prototype,"request",void 0),G=I([V("esri.networks.RulesTable")],G);var te=G;var w=class t extends ee{constructor(e){super(e),this.sharedNamedTraceConfigurations=[],this.type="utility",this._terminalById=new Map}get serviceTerritoryFeatureLayerId(){return this.dataElement?.serviceTerritoryFeatureLayerId??null}get networkSystemLayers(){return new X({rulesTableId:this.sourceJSON?.systemLayers.rulesTableId,rulesTableUrl:this.sourceJSON?`${this.featureServiceUrl}/${this.sourceJSON?.systemLayers.rulesTableId}`:null,subnetworksTableId:this.sourceJSON?.systemLayers.subnetworksTableId,subnetworksTableUrl:this.sourceJSON?`${this.featureServiceUrl}/${this.sourceJSON?.systemLayers.subnetworksTableId}`:null,dirtyAreasLayerId:this.sourceJSON?.systemLayers.dirtyAreasLayerId,dirtyAreasLayerUrl:this.sourceJSON?`${this.featureServiceUrl}/${this.sourceJSON?.systemLayers.dirtyAreasLayerId}`:null,associationsTableId:this.sourceJSON?.systemLayers.associationsTableId,associationsTableUrl:this.sourceJSON?`${this.featureServiceUrl}/${this.sourceJSON?.systemLayers.associationsTableId}`:null})}get terminalConfigurations(){return this.dataElement?.terminalConfigurations.map(e=>J.fromJSON(e))||[]}get domainNetworkNames(){return this.dataElement?.domainNetworks.map(e=>e.domainNetworkName)||[]}get _utilityLayerList(){let e=new Set;return this.dataElement?.domainNetworks?.map(o=>{o?.edgeSources?.map(({layerId:r,sourceId:s})=>{this._layerIdBySourceId.set(s,r),this._sourceIdByLayerId.set(r,s),e.add(r)}),o?.junctionSources?.map(({layerId:r,sourceId:s})=>{this._layerIdBySourceId.set(s,r),this._sourceIdByLayerId.set(r,s),e.add(r)})}),e}load(e){return g(this,null,function*(){return this.addResolvingPromise(x(t.prototype,this,"load").call(this,e)),this.addResolvingPromise(this._loadNamedTraceConfigurationsFromNetwork(e)),this})}getTerminalConfiguration(e){let o=null,r=null,s=e.layer,n=null;if(s?.type==="feature"){if(n=s.layerId,n===null)return null}else if(s?.type!=="subtype-sublayer"||(n=s?.parent?.layerId??null,n===null))return null;let l=e.attributes;if(l==null)return null;for(let a of Object.keys(l))a.toUpperCase()==="ASSETGROUP"&&(o=e.getAttribute(a)),a.toUpperCase()==="ASSETTYPE"&&(r=e.getAttribute(a));if(!this.dataElement)return null;let y=null,p=this.dataElement.domainNetworks;for(let a of p){let i=a.junctionSources?.find(u=>u.layerId===n);if(i){let u=i.assetGroups?.find(c=>c.assetGroupCode===o);if(u){let c=u.assetTypes?.find(d=>d.assetTypeCode===r);if(c?.isTerminalConfigurationSupported){y=c.terminalConfigurationId;break}}}}if(y!=null){let a=this.dataElement.terminalConfigurations,i=a?.find(u=>u.terminalConfigurationId===y);return i?J.fromJSON(i):null}return null}getTierNames(e){return this.dataElement?.domainNetworks.find(r=>r.domainNetworkName===e)?.tiers.map(r=>r.name)||[]}getRulesTable(){return g(this,null,function*(){return this._sharedRulesTable||(this._sharedRulesTable=this._createRulesTable()),yield this._sharedRulesTable})}getTerminalById(e){if(!this.dataElement||e==null)return null;let o=this._terminalById.get(e);return o??(this.terminalConfigurations.forEach(r=>{r.terminals.forEach(s=>{this._terminalById.set(s.id,s)})}),this._terminalById.get(e))}isUtilityLayer(e){return"layerId"in e?this._utilityLayerList.has(e?.layerId)&&(e.url?.startsWith(this.featureServiceUrl)??!1):!(e.type!=="subtype-sublayer"||!e.parent)&&this._utilityLayerList.has(e.parent.layerId)&&(e.parent.url?.startsWith(this.featureServiceUrl)??!1)}queryAssociations(e,o){return g(this,null,function*(){let[{queryAssociations:r},{default:s}]=yield Promise.all([import("./chunk-OFH7JV64.js"),import("./chunk-XQBDCIFG.js")]),n=s.from(e);return n.gdbVersion=this.gdbVersion,n.moment=this.historicMoment,(yield r(this.networkServiceUrl,n,o)).associations})}synthesizeAssociationGeometries(e){return g(this,null,function*(){let[{synthesizeAssociationGeometries:o},{default:r}]=yield Promise.all([import("./chunk-5TG4VTVY.js"),import("./chunk-5V2JCN33.js")]),s=r.from(e);return s.gdbVersion=this.gdbVersion,s.moment=this.historicMoment,o(this.networkServiceUrl,s)})}trace(e){return g(this,null,function*(){let[{trace:o},{default:r}]=yield Promise.all([import("./chunk-S2MN4LKB.js"),import("./chunk-7XN2JQ33.js")]),s=r.from(e);return s.gdbVersion=this.gdbVersion,s.moment=this.historicMoment,o(this.networkServiceUrl,s)})}submitTraceJob(e){return g(this,null,function*(){let[{submitTraceJob:o},{default:r}]=yield Promise.all([import("./chunk-S2MN4LKB.js"),import("./chunk-7XN2JQ33.js")]),s=r.from(e);s.gdbVersion=this.gdbVersion,s.moment=this.historicMoment;let n=yield o(this.networkServiceUrl,s);return new Z({statusUrl:n})})}canAddAssociation(e){return g(this,null,function*(){let o=yield this.getRulesTable();if(!o)return!1;yield o.load();let r=(a,i)=>a?a.terminalId===1?!i?.terminalId||i?.terminalId===a.terminalId:a.terminalId===i?.terminalId:!i?.terminalId,s=a=>({fromRuleElement:{networkSource:a.fromNetworkSource,assetGroup:a.fromAssetGroup,assetType:a.fromAssetType,terminal:a.fromTerminal},viaRuleElement:a.viaNetworkSource?{networkSource:a.viaNetworkSource,assetGroup:a.viaAssetGroup,assetType:a.viaAssetType,terminal:a.viaTerminal}:void 0,toRuleElement:{networkSource:a.toNetworkSource,assetGroup:a.toAssetGroup,assetType:a.toAssetType,terminal:a.toTerminal}}),n=(a,i,u=!0)=>a.networkSource?.sourceId===i.networkSourceId&&a.assetGroup?.assetGroupCode===i.assetGroupCode&&a.assetType?.assetTypeCode===i.assetTypeCode&&(!u||r(a.terminal,i)),l=(a,i)=>{let{fromRuleElement:u,toRuleElement:c}=s(a);return n(u,i.fromNetworkElement,!1)&&n(c,i.toNetworkElement,!1)},y=(a,i)=>{let{fromRuleElement:u,toRuleElement:c}=s(a);return n(u,i.fromNetworkElement)&&n(c,i.toNetworkElement)||n(u,i.toNetworkElement)&&n(c,i.fromNetworkElement)},p=(a,i)=>{let{fromRuleElement:u,toRuleElement:c,viaRuleElement:d}=s(a);return n(u,i.fromNetworkElement)&&n(d,i.toNetworkElement)||n(u,i.toNetworkElement)&&n(d,i.fromNetworkElement)||n(d,i.fromNetworkElement)&&n(c,i.toNetworkElement)||n(d,i.toNetworkElement)&&n(c,i.fromNetworkElement)};return e.associationType==="containment"?o.rulesCategorized.containment.some(a=>l(a,e)):e.associationType==="attachment"?o.rulesCategorized.attachment.some(a=>l(a,e)):o.rulesCategorized.connectivity.some(a=>a.ruleType===A.RTEdgeJunctionEdgeConnectivity?p(a,e):y(a,e))})}generateAddAssociations(e){let{associationsTable:o}=this.networkSystemLayers,{fromNetworkSourceId:r,fromGlobalId:s,fromTerminalId:n,toNetworkSourceId:l,toGlobalId:y,toTerminalId:p,associationType:a,isContentVisible:i,percentAlong:u,globalId:c}=Q(o);return{addFeatures:e.map(d=>new W({attributes:{[r]:d.fromNetworkElement?.networkSourceId,[s]:d.fromNetworkElement?.globalId,[n]:d.fromNetworkElement?.terminalId,[l]:d.toNetworkElement?.networkSourceId,[y]:d.toNetworkElement?.globalId,[p]:d.toNetworkElement?.terminalId,[a]:Y[d.associationType],[i]:d.isContentVisible==null?void 0:d.isContentVisible?1:0,[u]:d.percentAlong,[c]:d.globalId}})),id:this.networkSystemLayers.associationsTableId,identifierFields:{globalIdField:o?.globalIdField??"globalid",objectIdField:o?.objectIdField??"objectid"}}}generateDeleteAssociations(e){let{associationsTable:o,associationsTableId:r}=this.networkSystemLayers;return{deleteFeatures:e.map(s=>({globalId:s.globalId})),id:r,identifierFields:{globalIdField:o?.globalIdField??"globalid",objectIdField:o?.objectIdField??"objectid"}}}loadAssociationsTable(){return g(this,null,function*(){return this.networkSystemLayers.loadAssociationsTable()})}_loadNamedTraceConfigurationsFromNetwork(e){return g(this,null,function*(){if(this.sharedNamedTraceConfigurations?.length===0)return;let o=this.sharedNamedTraceConfigurations.map(s=>s.globalId),r=yield this.queryNamedTraceConfigurations({globalIds:o},e);for(let s of this.sharedNamedTraceConfigurations){let n=r?.find(l=>l.globalId===s.globalId);if(n){let l=n.write({},{origin:"service"});s.read(l,{origin:"service"})}}})}_createRulesTable(){return g(this,null,function*(){let e=this.networkSystemLayers.rulesTableUrl,o=new q({url:e});yield o.load();let r=this.dataElement?.domainNetworks;if(!r)return null;let s=r.flatMap(l=>[...l.edgeSources||[],...l.junctionSources||[]]),n=(yield oe(o)).map(l=>this._hydrateRuleInfo(o,s,l));return new te({rulesLayer:o,rules:n})})}_hydrateRuleInfo(e,o,r){let s=e.fieldsIndex,n=s.get("RULETYPE"),l=s.get("CREATIONDATE"),y=s.get("FROMNETWORKSOURCEID"),p=s.get("FROMASSETGROUP"),a=s.get("FROMASSETTYPE"),i=s.get("FROMTERMINALID"),u=s.get("TONETWORKSOURCEID"),c=s.get("TOASSETGROUP"),d=s.get("TOASSETTYPE"),m=s.get("TOTERMINALID"),S=s.get("VIANETWORKSOURCEID"),f=s.get("VIAASSETGROUP"),b=s.get("VIAASSETTYPE"),_=s.get("VIATERMINALID"),E=r.attributes[n.name],L=new Date(r.attributes[l.name]),T=[{networkSourceId:r.attributes[y.name],assetGroupId:r.attributes[p.name],assetTypeId:r.attributes[a.name],terminalId:r.attributes[i.name]},{networkSourceId:r.attributes[u.name],assetGroupId:r.attributes[c.name],assetTypeId:r.attributes[d.name],terminalId:r.attributes[m.name]},{networkSourceId:r.attributes[S.name],assetGroupId:r.attributes[f.name],assetTypeId:r.attributes[b.name],terminalId:r.attributes[_.name]}],h;(function(F){F[F.from=0]="from",F[F.to=1]="to",F[F.via=2]="via"})(h||(h={}));let N={ruleType:E,creationDate:L};for(let F of[h.from,h.to,h.via]){if(E!==A.RTEdgeJunctionEdgeConnectivity&&F===h.via)continue;let O=T[F],$=o.find(R=>R.sourceId===O.networkSourceId),U=$?.assetGroups.find(R=>R.assetGroupCode===O.assetGroupId),j=U?.assetTypes.find(R=>R.assetTypeCode===O.assetTypeId),re=this._getTerminal(j,O),k="";switch(F){case h.from:k="from";break;case h.to:k="to";break;case h.via:k="via"}N[`${k}NetworkSource`]=$,N[`${k}AssetGroup`]=U,N[`${k}AssetType`]=j,N[`${k}Terminal`]=re?.toJSON()}return N}_getTerminal(e,o){let r=e?.terminalConfigurationId;return this.terminalConfigurations?.find(n=>n.id===r)?.terminals?.find(n=>n.id===o.terminalId)??null}};function oe(t){return g(this,null,function*(){let e=new H({where:"1=1",outFields:["*"]});return(yield B(t,e)).features})}I([C({type:[K],json:{origins:{"web-map":{read:{source:"traceConfigurations"},write:{target:"traceConfigurations"}},service:{read:{source:"traceConfigurations"}}},read:!1}})],w.prototype,"sharedNamedTraceConfigurations",void 0),I([C({type:["utility"],readOnly:!0,json:{read:!1,write:!1}})],w.prototype,"type",void 0),I([C({readOnly:!0})],w.prototype,"serviceTerritoryFeatureLayerId",null),I([C({readOnly:!0})],w.prototype,"networkSystemLayers",null),I([C({readOnly:!0})],w.prototype,"terminalConfigurations",null),I([C({readOnly:!0})],w.prototype,"domainNetworkNames",null),w=I([V("esri.networks.UtilityNetwork")],w);var Je=w;export{Je as a};
