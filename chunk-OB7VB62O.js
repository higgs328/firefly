import{c as L,d as k,e as O,k as x,r as D,t as P,u as $}from"./chunk-ZEWUF6OQ.js";import{a as I,b as E}from"./chunk-JUJYL7GW.js";import{a as S,c as _}from"./chunk-2HQALWZQ.js";import{a as l}from"./chunk-5XCFNEYX.js";import{a as M}from"./chunk-GQL2MBZT.js";import{b as f}from"./chunk-EBIFNV2H.js";import{o as A}from"./chunk-FB4M3WPV.js";import{a as o}from"./chunk-QGVBCWUY.js";import{e as s}from"./chunk-NFIPKH6V.js";import{l as T}from"./chunk-5QEXLALV.js";var C,n=C=class extends M{constructor(e){super(e),this.dragEnabled=!1,this.listModeDisabled=!1,this.parent=null,this.parentTitles=null,this.viewModel=null,this._onActionMenuOpen=t=>{this.item.actionsOpen=t.currentTarget.open},this._setTooltipReference=t=>{this.onTooltipReferenceChange?.(this.item.layer?.uid,t)},this._removeTooltipReference=()=>{this.onTooltipReferenceChange?.(this.item.layer?.uid,null)}}loadDependencies(){return f({"action-group":()=>import("./chunk-WQ2GF3MJ.js"),"action-menu":()=>import("./chunk-4SH4NG6C.js"),action:()=>import("./chunk-X23M5IZ6.js"),icon:()=>import("./chunk-7Z2RNQA3.js"),"list-item":()=>import("./chunk-MRM6JRFU.js"),list:()=>import("./chunk-4MPCQ5DO.js"),notice:()=>import("./chunk-PEKK3NZO.js")})}render(){let e=this.parentTitles??[],{_title:t,item:i,activeItem:a,selectionMode:r,selectedItems:d,messages:c,parent:m,css:p}=this,y="visibleAtCurrentTimeExtent"in i&&"layerInvisibleAtTime"in c&&!i.visibleAtCurrentTimeExtent?`${t} (${c.layerInvisibleAtTime})`:"visibleAtCurrentScale"in i&&"layerInvisibleAtScale"in c&&!i.visibleAtCurrentScale?`${t} (${c.layerInvisibleAtScale})`:t,b="parent"in i&&i.parent?.layer?.type==="catalog",{layer:h}=i,v="visibleAtCurrentScale"in i&&!i.visibleAtCurrentScale||"visibleAtCurrentTimeExtent"in i&&!i.visibleAtCurrentTimeExtent;return l("calcite-list-item",{afterCreate:g=>this._focusSelectedDragEl(g,i),afterUpdate:g=>this._focusSelectedDragEl(g,i),class:this.classes(p.item,"itemActive"in p&&{[p.itemActive]:a===i}),"data-item":i,"data-layer-id":h?.id,dragDisabled:!i.sortable||b,id:h?.uid,key:`list-item-${h?.uid}`,label:t,metadata:{parentTitles:e,_title:t},open:"open"in i&&i.open,selected:r!=="none"&&d.includes(i),title:y,unavailable:v,value:h?.uid,onCalciteListItemSelect:g=>"visible"in i&&this._handleCalciteListItemSelect(g,i,m),onCalciteListItemToggle:g=>"open"in i&&this._handleCalciteListItemToggle(g,i)},this._renderedCatalogFootprintIcon,this._renderedCatalogDynamicIcon,this._renderedItemStatus,this._renderedItemToggle,this._renderedCatalogSelectNode,this._renderedItemTemporaryIcon,this._renderedChildList,this._renderedItemMessage,this._renderedPanel,this._renderedPanelAction,this._renderedActions)}get _title(){let{messages:e}=this;return this.item.title||("untitledTable"in e?e.untitledTable:e.untitledLayer)}get _renderedItemStatus(){let{item:e,parent:t,visibleElements:i,css:a}=this;if(!i.statusIndicators)return null;let{publishing:r}=e,d="updating"in e&&e.updating&&!t,c="connectionStatus"in e?e.connectionStatus:void 0,m=!!c;return l("calcite-icon",{class:this.classes(a.statusIndicator,{[a.publishing]:r},"updating"in a&&{[a.updating]:d},"connectionStatus"in a&&{[a.connectionStatus]:m},"connectionStatusConnected"in a&&{[a.connectionStatusConnected]:m&&c==="connected"}),icon:k({connectionStatus:c,publishing:r}),key:"layer-item-status",scale:"s",slot:"content-end"})}get _renderedItemTemporaryIcon(){let{item:e,visibleElements:t,css:i}=this,{layer:a}=e,r="temporaryLayerIndicators"in t&&t.temporaryLayerIndicators,d="temporaryTableIndicators"in t&&t.temporaryTableIndicators,c=a&&"persistenceEnabled"in a&&(S(a)||!a.persistenceEnabled);return(r||d)&&c?l("calcite-icon",{class:i.itemTemporaryIcon,icon:"temporary",key:"temporary-icon",scale:"s",slot:"content-start",title:this.messages.temporary}):null}get _renderedItemToggle(){let{item:e,parent:t,messages:i,visibilityAppearance:a,css:r}=this;if(!("visible"in e&&"layerVisibility"in i&&"visibleToggle"in r&&a))return null;let{visible:d}=e,c=this._getParentVisibilityMode(t);if(c==="inherited")return null;let m=L({visible:d,exclusive:c==="exclusive",visibilityAppearance:a}),p=a==="checkbox",y=i.layerVisibility;return l("calcite-action",{appearance:"transparent",class:r.visibleToggle,icon:p?m:void 0,key:"visibility-toggle",onclick:()=>this._toggleVisibility(e,t),scale:"s",slot:p?"actions-start":"actions-end",text:y,title:y},p?null:l("calcite-icon",{class:this.classes({[r.visibleIcon]:c!=="exclusive"&&d}),icon:m,scale:"s"}))}get _renderedPanel(){let{panel:e}=this.item;return!e?.open||e.disabled||e.flowEnabled?null:l("div",{class:this.css.itemContentBottom,key:`content-panel-${e.uid}`,slot:"content-bottom"},e.render())}get _renderedPanelAction(){let{panel:e}=this.item;if(!e?.visible)return null;let{open:t,title:i,disabled:a}=e;return l("calcite-action",{active:t,appearance:"transparent",disabled:a,icon:I(e),key:`action-${e.uid}`,onclick:()=>this._togglePanel(e),scale:"s",slot:"actions-end",text:i??"",title:i??void 0},this._renderFallbackIcon(e))}get _renderedActions(){switch(this._actionsCount){case 0:return null;case 1:return this._singleAction;default:return this._renderedActionMenu}}get _renderedActionMenu(){let{item:e,messagesCommon:t}=this,i=t.options;return l("calcite-action-menu",{appearance:"transparent",key:"item-action-menu",label:t.menu,open:e.actionsOpen,overlayPositioning:"fixed",placement:"bottom-end",scale:"s",slot:"actions-end",onCalciteActionMenuOpen:this._onActionMenuOpen},l("calcite-action",{appearance:"transparent",icon:"ellipsis",scale:"s",slot:"trigger",text:i,title:i}),this._renderedActionMenuContent)}get _renderedActionMenuContent(){return this._filteredSections.toArray().map(e=>l("calcite-action-group",{key:`action-section-${e.uid}`},e.toArray().map(t=>this._renderAction({action:t,textEnabled:!0}))))}get _renderedCatalogFootprintIcon(){let{css:e}=this,t=this.item.layer,i=t?.type==="catalog-footprint",a=t?.type==="sublayer"&&_(t,"footprints");return"itemCatalogIcon"in e&&(i||a)?l("calcite-icon",{class:e.itemCatalogIcon,icon:"footprint",key:"footprint",scale:"s",slot:"content-start"}):null}get _renderedCatalogDynamicIcon(){let{css:e}=this,t=this.item.layer,i=t?.type==="catalog-dynamic-group",a=t?.type==="sublayer"&&_(t,"layers-in-view");return"itemCatalogIcon"in e&&(i||a)?l("calcite-icon",{class:e.itemCatalogIcon,icon:"catalog-dataset",key:"catalog-dataset",scale:"s",slot:"content-start"}):null}get _renderedCatalogSelectNode(){let{_title:e,item:t,visibleElements:i}=this;if(!("visible"in t))return;let{layer:a}=t,r=a?.type==="catalog-dynamic-group";return"catalogLayerList"in i&&i.catalogLayerList&&r?l("calcite-action",{appearance:"transparent",disabled:!a.visible,icon:"chevron-right",iconFlipRtl:!0,onclick:()=>this._triggerOnCatalogOpen(t),scale:"s",slot:"actions-end",text:e}):null}get _renderedChildList(){let{dragEnabled:e,item:t,rootGroupUid:i,listModeDisabled:a,selectionMode:r,displayMode:d}=this;if(!("children"in t))return;let c=[...this.parentTitles??[],t.title],{children:m,layer:p}=t,y=p?.type!=="catalog-dynamic-group"&&P(t),b=!a&&O(p),h=p?.type==="group",v=!b&&!y&&e&&h,g=!!e&&"childrenSortable"in t&&t.childrenSortable&&x(t);return y||v?l("calcite-list",{canPull:u=>!!this.canMove&&this.canMove(u,"pull"),canPut:u=>!!this.canMove&&this.canMove(u,"put"),"data-item":t,"data-layer-type":i,displayMode:d,dragEnabled:g,group:h?i:`${i}-${p?.uid}`,key:`child-list-${p?.uid}`,label:t.title,selectionAppearance:"border",selectionMode:r},m?.filter(u=>!u.hidden&&(this.visibleElements.errors||!u.error)).toArray().map(u=>this._renderItem(u,t,c)),this._renderedTablesItem):null}get _hasTables(){let{layerTablesEnabled:e}=this,t=this.item.layer;if(!e||!t)return!1;switch(t.type){case"knowledge-graph":return e.includes(t.type)&&"tables"in t&&!!t.tables?.length;case"map-image":case"tile":return e.includes(t.type)&&"subtables"in t&&!!t.subtables?.length;default:return!1}}get _renderedTablesItem(){let{item:e,messages:t,css:i}=this,{layer:a}=e;return"itemTableIcon"in i&&"visible"in e&&"tables"in t&&this._hasTables?l("calcite-list-item",{class:i.item,"data-layer-id":a?.id,dragDisabled:!0,key:`list-item-table-list-tables-${a?.uid}`,label:t.tables,title:t.tables,onCalciteListItemSelect:()=>this._triggerOnTablesOpen(e)},l("calcite-icon",{class:i.itemTableIcon,icon:"table",scale:"s",slot:"content-start"}),l("calcite-icon",{flipRtl:!0,icon:"chevron-right",scale:"s",slot:"content-end"})):null}get _renderedItemMessage(){let{item:e,messages:t,css:i}=this;return e.error?l("div",{class:i.itemMessage,key:"esri-layer-list__error",slot:"content-bottom"},l("calcite-notice",{icon:"exclamation-mark-triangle",kind:"warning",open:!0,scale:"s",width:"full"},l("div",{slot:"message"},"tableError"in t?t.tableError:t.layerError))):"incompatible"in e&&e.incompatible&&"layerIncompatible"in t?l("div",{class:i.itemMessage,key:"esri-layer-list__incompatible",slot:"content-bottom"},l("calcite-notice",{afterCreate:this._setTooltipReference,afterRemoved:this._removeTooltipReference,bind:this,icon:"exclamation-mark-triangle",kind:"warning",open:!0,scale:"s",tabIndex:0,width:"full"},l("div",{slot:"message"},t.layerIncompatible))):null}get _singleAction(){return this._renderAction({action:$(this._filteredSections),textEnabled:!1})}get _filteredSections(){return this.item.actionsSections.map(e=>e.filter(t=>t.visible))}get _actionsCount(){return this.item.actionsSections.reduce((e,t)=>e+t.length,0)}_renderAction(e){let{item:t}=this,{action:i,textEnabled:a}=e;if(!i)return null;let{active:r,disabled:d,title:c,type:m,indicator:p}=i;return l("calcite-action",{active:m==="toggle"&&i.value,appearance:"transparent","data-action-id":i.id,disabled:d,icon:I(i),indicator:p,key:`action-${i.uid}`,loading:r,onclick:()=>this._triggerAction(t,i),scale:"s",slot:a?void 0:"actions-end",text:c??"",textEnabled:a,title:c??void 0},this._renderFallbackIcon(i))}_renderFallbackIcon(e){let{css:t}=this,{className:i,icon:a}=e;if(a)return null;let r="image"in e?e.image:void 0,d={[t.itemActionIcon]:!!i,[t.itemActionImage]:!!r};return i&&(d[i]=!0),r||i?l("span",{"aria-hidden":"true",class:this.classes(t.itemActionIcon,d),key:"icon",styles:E(r)}):null}_renderItem(e,t,i=[]){return l(C,{activeItem:this.activeItem,canMove:this.canMove,css:this.css,displayMode:this.displayMode,dragEnabled:this.dragEnabled,item:e,key:`layerListItem-${e.layer?.uid}`,layerTablesEnabled:this.layerTablesEnabled,listModeDisabled:this.listModeDisabled,messages:this.messages,messagesCommon:this.messagesCommon,parent:t,parentTitles:i,rootGroupUid:this.rootGroupUid,selectedDragItemLayerUid:this.selectedDragItemLayerUid,selectedItems:this.selectedItems,selectionMode:this.selectionMode,visibilityAppearance:this.visibilityAppearance,visibleElements:this.visibleElements,onAction:this.onAction,onCatalogOpen:this.onCatalogOpen,onPanelOpen:this.onPanelOpen,onSelectedDragItemLayerUidChange:this.onSelectedDragItemLayerUidChange,onTablesOpen:this.onTablesOpen,onTooltipReferenceChange:this.onTooltipReferenceChange})}_triggerAction(e,t){t&&e&&(t.type==="toggle"&&(t.value=!t.value),this.onAction(t,e))}_triggerOnTablesOpen(e){e&&this.onTablesOpen&&this.onTablesOpen(e)}_triggerOnCatalogOpen(e){e&&this.onCatalogOpen?.(e)}_focusSelectedDragEl(e,t){this.selectedDragItemLayerUid===t.layer?.uid&&(A(e),this.onSelectedDragItemLayerUidChange?.(null))}_handleCalciteListItemToggle(e,t){e.stopPropagation(),t.open=e.target.open}_getParentVisibilityMode(e){return e&&"visibilityMode"in e?e.visibilityMode:null}_handleCalciteListItemSelect(e,t,i){if(D(e.target)!==t)return;let a=this._getParentVisibilityMode(i);this.selectionMode==="none"&&a!=="inherited"&&this._toggleVisibility(t,i)}_togglePanel(e){e.open=!e.open,e.open&&this.onPanelOpen()}_toggleVisibility(e,t){!e||!("visible"in e)||this._getParentVisibilityMode(t)==="exclusive"&&e.visible||(e.visible=!e.visible)}};n.vnodeSelector="calcite-list-item",o([s()],n.prototype,"activeItem",void 0),o([s()],n.prototype,"canMove",void 0),o([s()],n.prototype,"css",void 0),o([s()],n.prototype,"displayMode",void 0),o([s()],n.prototype,"dragEnabled",void 0),o([s()],n.prototype,"item",void 0),o([s()],n.prototype,"layerTablesEnabled",void 0),o([s()],n.prototype,"listModeDisabled",void 0),o([s()],n.prototype,"messages",void 0),o([s()],n.prototype,"messagesCommon",void 0),o([s()],n.prototype,"onAction",void 0),o([s()],n.prototype,"onPanelOpen",void 0),o([s()],n.prototype,"onCatalogOpen",void 0),o([s()],n.prototype,"onTablesOpen",void 0),o([s()],n.prototype,"onSelectedDragItemLayerUidChange",void 0),o([s()],n.prototype,"onTooltipReferenceChange",void 0),o([s()],n.prototype,"parent",void 0),o([s()],n.prototype,"parentTitles",void 0),o([s()],n.prototype,"rootGroupUid",void 0),o([s()],n.prototype,"selectionMode",void 0),o([s()],n.prototype,"selectedItems",void 0),o([s()],n.prototype,"selectedDragItemLayerUid",void 0),o([s()],n.prototype,"visibleElements",void 0),o([s()],n.prototype,"visibilityAppearance",void 0),o([s()],n.prototype,"_title",null),o([s()],n.prototype,"_renderedItemStatus",null),o([s()],n.prototype,"_renderedItemTemporaryIcon",null),o([s()],n.prototype,"_renderedItemToggle",null),o([s()],n.prototype,"_renderedPanel",null),o([s()],n.prototype,"_renderedPanelAction",null),o([s()],n.prototype,"_renderedActions",null),o([s()],n.prototype,"_renderedActionMenu",null),o([s()],n.prototype,"_renderedActionMenuContent",null),o([s()],n.prototype,"_renderedCatalogFootprintIcon",null),o([s()],n.prototype,"_renderedCatalogDynamicIcon",null),o([s()],n.prototype,"_renderedCatalogSelectNode",null),o([s()],n.prototype,"_renderedChildList",null),o([s()],n.prototype,"_hasTables",null),o([s()],n.prototype,"_renderedTablesItem",null),o([s()],n.prototype,"_renderedItemMessage",null),o([s()],n.prototype,"_singleAction",null),o([s()],n.prototype,"_filteredSections",null),o([s()],n.prototype,"_actionsCount",null),n=C=o([T("esri.widgets.LayerList.LayerListItem")],n);var K=n;export{K as a};
