import{a as J}from"./chunk-C5Z6B7V6.js";import{a as O}from"./chunk-F7UGNZLD.js";import{a as E}from"./chunk-LORHDXEB.js";import{a as F,b as q}from"./chunk-5BPM64SU.js";import{a as $}from"./chunk-6F25LG6O.js";import{a as j}from"./chunk-MIS6QMFE.js";import{a as N}from"./chunk-IR6XCBC4.js";import{a as T}from"./chunk-CX5IFQZJ.js";import{f as d}from"./chunk-CCJU4DSH.js";import{b as x}from"./chunk-ACP3S2CH.js";import{a as o}from"./chunk-QGVBCWUY.js";import{e as l}from"./chunk-NFIPKH6V.js";import{l as u}from"./chunk-5QEXLALV.js";import{r as v}from"./chunk-P6QFA5MM.js";import{b as L,p as m,y as _}from"./chunk-4PTIEWMT.js";import{b as A}from"./chunk-YOFFGXOB.js";import{g}from"./chunk-XRGPJ3QY.js";import{b as h}from"./chunk-2LI2GKBQ.js";import{b}from"./chunk-QBWJMFH5.js";import{a as f,b as S,f as c}from"./chunk-VTHXE323.js";var w,p=w=class extends d{constructor(e){super(e),this.type="none"}clone(){return new w({type:this.type})}};o([j({none:"none",stayAbove:"stay-above"}),l({json:{write:{isRequired:!0}}})],p.prototype,"type",void 0),p=w=o([u("esri.ground.NavigationConstraint")],p);var G,C,a=C=class extends d.JSONSupportMixin(N){constructor(e){super(e),this[G]=!0,this.opacity=1,this.surfaceColor=null,this.navigationConstraint=null,this.layers=new x;let r=t=>{t.parent&&t.parent!==this&&"remove"in t.parent&&t.parent.remove(t),t.parent=this,t.type!=="elevation"&&t.type!=="base-elevation"&&g.getLogger(this).error(`Layer '${t.title}, id:${t.id}' of type '${t.type}' is not supported as a ground layer and will therefore be ignored. Only layers of type 'elevation' are supported.`)},i=t=>{t.parent=null};this.addHandles([this.layers.on("after-add",t=>r(t.item)),this.layers.on("after-remove",t=>i(t.item))])}initialize(){this.when().catch(e=>{_(e)||g.getLogger(this).error("#load()","Failed to load ground",e)}),this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)}destroy(){let e=this.layers.removeAll();for(let r of e)L(r);this.layers.destroy()}normalizeCtorArgs(e){return e&&"resourceInfo"in e&&(this._set("resourceInfo",e.resourceInfo),delete(e=f({},e)).resourceInfo),e}get layers(){return this._get("layers")}set layers(e){this._set("layers",E(e,this._get("layers")))}writeLayers(e,r,i,t){let s=[];e&&(t=S(f({},t),{layerContainerType:"ground"}),e.forEach(n=>{if("write"in n){let y={};b(n)().write(y,t)&&s.push(y)}else t?.messages&&t.messages.push(new A("layer:unsupported",`Layers (${n.title}, ${n.id}) of type '${n.declaredClass}' cannot be persisted in the ground`,{layer:n}))})),r.layers=s}load(e){return this.addResolvingPromise(this._loadFromSource(e)),Promise.resolve(this)}loadAll(){return O(this,e=>{e(this.layers)})}queryElevation(e,r){return c(this,null,function*(){yield this.load({signal:r?.signal});let{ElevationQuery:i}=yield import("./chunk-QZVUTWAJ.js");m(r);let t=new i,s=this.layers.filter(P).toArray();return t.queryAll(s,e,r)})}createElevationSampler(e,r){return c(this,null,function*(){yield this.load({signal:r?.signal});let{ElevationQuery:i}=yield import("./chunk-QZVUTWAJ.js");m(r);let t=new i,s=this.layers.filter(P).toArray();return t.createSamplerAll(s,e,r)})}clone(){let e={opacity:this.opacity,surfaceColor:h(this.surfaceColor),navigationConstraint:h(this.navigationConstraint),layers:this.layers.slice()};return this.loaded&&(e.loadStatus="loaded"),new C({resourceInfo:this.resourceInfo}).set(e)}read(e,r){this.resourceInfo||this._set("resourceInfo",{data:e,context:r}),super.read(e,r)}_loadFromSource(e){let r=this.resourceInfo;return r?this._loadLayersFromJSON(r.data,r.context,e):Promise.resolve()}_loadLayersFromJSON(e,r,i){return c(this,null,function*(){let t=r?.origin||"web-scene",s=r?.portal||null,n=r?.url||null,{populateOperationalLayers:y}=yield import("./chunk-4PI6XTSR.js");m(i);let I=[];if(e.layers&&Array.isArray(e.layers)){let R={context:{origin:t,url:n,portal:s,layerContainerType:"ground"},defaultLayerType:"ArcGISTiledElevationServiceLayer"};I.push(y(this.layers,e.layers,R))}yield Promise.allSettled(I)})}};function z(e){return e&&"createElevationSampler"in e}function P(e){return e.type==="elevation"||z(e)}G=J,o([l({json:{read:!1,write:{isRequired:!0}}})],a.prototype,"layers",null),o([T("layers")],a.prototype,"writeLayers",null),o([l({readOnly:!0})],a.prototype,"resourceInfo",void 0),o([l({type:Number,nonNullable:!0,range:{min:0,max:1},json:{type:v,read:{reader:q,source:"transparency"},write:{writer:(e,r)=>{r.transparency=F(e)},target:"transparency"}}})],a.prototype,"opacity",void 0),o([l({type:$,json:{type:[v],write:(e,r)=>{r.surfaceColor=e.toJSON().slice(0,3)}}})],a.prototype,"surfaceColor",void 0),o([l({type:p,json:{write:!0}})],a.prototype,"navigationConstraint",void 0),a=C=o([u("esri.Ground")],a);var ge=a;export{ge as a};
