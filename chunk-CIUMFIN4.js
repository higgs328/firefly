import{a as q}from"./chunk-UZ6X2SIU.js";import{a as W}from"./chunk-3LFQVTDE.js";import{b as G}from"./chunk-BKWQOCBC.js";import{b as B}from"./chunk-3ZJ4NMBE.js";import{a as g}from"./chunk-CTVZOIWY.js";import{h as I}from"./chunk-QSQIQSC6.js";import{a as L}from"./chunk-ALWV3RJ2.js";import{a as z,c as A,y as F}from"./chunk-6B5XFA6F.js";import{a as l,d as H,j as R}from"./chunk-57VFBGF3.js";import{y as P}from"./chunk-ZTOZWLEE.js";import{a as E}from"./chunk-BOVYXYHK.js";import{C as x,h as O}from"./chunk-KVM6SHDX.js";import{d as N}from"./chunk-NJWTSROP.js";import{a as _}from"./chunk-ARRCN5K3.js";import{a as M}from"./chunk-T7DXJKX7.js";import{a as f}from"./chunk-QGVBCWUY.js";import{H as w}from"./chunk-MYO4NP2N.js";import{e as d}from"./chunk-NFIPKH6V.js";import{l as j}from"./chunk-5QEXLALV.js";import{g as b}from"./chunk-XRGPJ3QY.js";function $(e,r,t,n){let i=H(r,n);if(i==null)return!1;let s=i.source.spatialReferenceId,a=i.dest.spatialReferenceId;if(s===a&&s!==l.UNKNOWN||N(r,n))return t[0]=1,t[1]=1,t[2]=1,!0;if(s===l.SPHERICAL_ECEF){let p=z(e),h=p/Math.sqrt(e[0]*e[0]+e[1]*e[1]),o=p/_.radius;if(a===l.WEB_MERCATOR)return t[0]=h*o,t[1]=h*o,t[2]=1,!0;if(a===l.WGS84||a===l.CGCS2000){let m=R;return t[0]=m*h*o,t[1]=m*o,t[2]=1,!0}}else if(s===l.PLATE_CARREE){if(a===l.WGS84||a===l.CGCS2000)return t[0]=R,t[1]=R,t[2]=1,!0;if(a===l.WEB_MERCATOR){let p=e[1]/_.radius;return t[0]=1,t[1]=1/Math.cos(p),t[2]=1,!0}}return!1}var u=class extends M.EventedMixin(w){constructor(e){super(e),this._tmpEvent=new W,this._renderCoordsHelper=e.view.renderCoordsHelper,this._renderSR=this._renderCoordsHelper.spatialReference,this._layerElevationSource=e.layerElevationSource}initialize(){this._intersector=G(this.view.state.viewingMode),this._intersector.options.store=B.MIN,this._intersector.options.normalRequired=!1,this._tmpEvent.context=this.intersectionHandler.isGround?"ground":"scene"}get spatialReference(){return this.view?.elevationProvider?.spatialReference}getElevation(e,r,t,n){let i=this._renderCoordsHelper,s=A(c,e,r,t);if(!i.toRenderCoords(s,n,s))return b.getLogger(this).error("could not project point to compute elevation"),null;let{layerElevationSource:a,_intersector:p,intersectionHandler:h}=this,o=a.fullExtent,m=o!=null&&Number.isFinite(o.xmin)&&Number.isFinite(o.xmax)&&Number.isFinite(o.ymin)&&Number.isFinite(o.ymax)&&Number.isFinite(o.zmin)&&Number.isFinite(o.zmax)?new g(o.zmin,o.zmax):a.elevationRange;if(m==null)return null;let y=a.elevationOffset,K=m.elevationRangeMin+y,Q=m.elevationRangeMax+y,S=i.setAltitude(Z,Q,s),C=i.setAltitude(k,K,s);return p.reset(S,C,null),h.intersect(p,null,S,C,null,!0),p.results.min.getIntersectionPoint(s)?i.getAltitude(s):null}getSphereElevationBounds(e,r){return q(e,r,T,this._renderSR),this._layerElevationSource.getElevationRange(T)}getRootElevationBounds(){let e=this.layerElevationSource.fullExtent;return e?.hasZ?new g(e.zmin,e.zmax):null}objectsChanged(e){this.spatialReference&&(this._computeLayerExtent(e,this._tmpEvent.extent),this._tmpEvent.spatialReference=this.spatialReference,this.emit("elevation-change",this._tmpEvent))}objectChanged(e){this.spatialReference&&(this._computeObjectExtent(e,this._tmpEvent.extent),this._tmpEvent.spatialReference=this.spatialReference,this.emit("elevation-change",this._tmpEvent))}_computeObjectExtent(e,r){x(r),this._expandExtent(e,r)}_computeLayerExtent(e,r){x(r);for(let t of e)this._expandExtent(t,r)}_expandExtent(e,r){let t=this.spatialReference;if(t==null||e==null)return;P(v,e.quaternion),v[12]=e.center[0],v[13]=e.center[1],v[14]=e.center[2];let n=e.halfSize;for(let i=0;i<8;++i)c[0]=1&i?n[0]:-n[0],c[1]=2&i?n[1]:-n[1],c[2]=4&i?n[2]:-n[2],F(c,c,v),this._renderCoordsHelper.fromRenderCoords(c,c,t),O(r,c,r)}};f([d({constructOnly:!0})],u.prototype,"layerElevationSource",void 0),f([d({constructOnly:!0})],u.prototype,"intersectionHandler",void 0),f([d({constructOnly:!0})],u.prototype,"view",void 0),f([d()],u.prototype,"spatialReference",null),u=f([j("esri.views.3d.layers.i3s.LayerElevationProvider")],u);var v=L(),T=I(0,0,0,0),c=E(),Z=E(),k=E();var U=class{constructor(r,t,n,i){this.toMapSpace=r,this.transform=t,this.obb=n,this.geometry=i}};var D=class{constructor(r,t){this.position=r,this.rotationScale=t,this.origin=void 0}};export{$ as a,u as b,U as c,D as d};
