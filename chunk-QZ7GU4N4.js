import{b as w}from"./chunk-N2JUYKXN.js";import{b as S}from"./chunk-7U52UAO2.js";import{h as g,j as F}from"./chunk-BBB7KLHV.js";import{a as D}from"./chunk-4YTM754S.js";import{b as O}from"./chunk-2HYVVLKS.js";import{b}from"./chunk-ZXKU6WBY.js";import{w as y}from"./chunk-4PTIEWMT.js";import{b as p}from"./chunk-YOFFGXOB.js";import{a as d}from"./chunk-QBWJMFH5.js";import{a as m,f as c}from"./chunk-VTHXE323.js";function P(e,o,t,r){return c(this,null,function*(){return Z(o,yield X(e,o,t,r),t,r)})}function X(e,o,t,r){return c(this,null,function*(){let a=m({},r),i=G(o,t),n=o.outStatistics?.[0]!=null,l=d("featurelayer-pbf-statistics"),u=!n||l,s;if(t?.format==="pbf"&&u)try{s=yield w(e,i,a)}catch(f){if(f.name!=="query:parsing-pbf")throw f;t.format="json"}return t?.format!=="json"&&u||(s=yield S(e,i,a)),Y(t?.fieldsIndex,s.fields),s})}function Y(e,o){if(e!=null&&o!=null)for(let t of o){let r=e.get(t.name);r&&Object.assign(t,r.toJSON())}}function Z(e,o,t,r){return c(this,null,function*(){let a=t?.infoFor3D;if(!h(e,a)||a==null||!o.assetMaps||!o.features?.length)return D.fromJSON(o);let{meshFeatureSetFromJSON:i}=yield y(import("./chunk-3T4TTPRT.js"),r);return i(e,a,o)})}function G(e,o){let t=O.from(e);t.sourceSpatialReference=t.sourceSpatialReference??o?.sourceSpatialReference??null,(o?.gdbVersion||o?.dynamicDataSource)&&(t=t===e?t.clone():t,t.gdbVersion=e.gdbVersion||o.gdbVersion,t.dynamicDataSource=e.dynamicDataSource?b.from(e.dynamicDataSource):o.dynamicDataSource);let r=o?.infoFor3D;if(r!=null&&h(e,r)){t=t===e?t.clone():t,t.formatOf3DObjects=null;let a=g(r),i=F(r);for(let n of r.queryFormats){if(n===a){t.formatOf3DObjects=n;break}n!==i||t.formatOf3DObjects||(t.formatOf3DObjects=n)}if(!t.formatOf3DObjects)throw new p("query:unsupported-3d-query-formats","Could not find any supported 3D object query format. Only supported formats are 3D_glb and 3D_gltf");if(t.outFields==null||!t.outFields.includes("*")){t=t===e?t.clone():t,t.outFields==null&&(t.outFields=[]);let{originX:n,originY:l,originZ:u,translationX:s,translationY:f,translationZ:j,scaleX:x,scaleY:R,scaleZ:q,rotationX:J,rotationY:N,rotationZ:Q,rotationDeg:V}=r.transformFieldRoles;t.outFields.push(n,l,u,s,f,j,x,R,q,J,N,Q,V)}}return t}function h(e,o){return o!=null&&e.returnGeometry===!0&&e.multipatchOption!=="xyFootprint"&&!e.outStatistics}export{P as a,X as b,Y as c};
