import{D as P,F as E,ja as G,ma as v,na as w,p as C,pa as H,sa as J,v as f,wa as R}from"./chunk-A2QQP5DF.js";import{a as q}from"./chunk-LTHAIW3V.js";import{G as B,K as F}from"./chunk-WFHQTMIY.js";import{a as z,b as O,v as V}from"./chunk-V3KEO7AJ.js";var L=H;function _(g,s){return{m_geometry:g,m_side:s}}function N(g,s,m,t,r,o){if(s.isEmpty()){let h=_(s,0);return void r.push(h)}if(m.isEmpty()){let h=_(s,0);return void r.push(h)}let e=[],n=new E;{let h=n.createGeometryUserIndex(),x=n.addGeometry(s),b=n.addGeometry(m),l=new R(o),d=0,c=null;if(n.hasCurves()){c=new L;let a=n.getEnvelope2D(o);d=w(t.total());let y=v(t.total(),a);G(n,y,t.total(),12e3,c,null,o)}n.dbgVerifyCurves(),l.setEditShapeCrackAndCluster(n,t),l.cut(g,h,x,b,e);for(let a of e){c!==null&&c.stitchCurves(n,a,d,!1);let y=_(n.getGeometry(a),J(n.getGeometryUserIndex(a,h)));r.push(y)}c!==null&&c.clearStitcher(n)}}function Q(g,s,m,t,r,o){if(s.isEmpty()){let h=_(s,0);return void r.push(h)}if(m.isEmpty()){let h=_(s,0);return void r.push(h)}let e=[],n=new E;{let h=n.createGeometryUserIndex(),x=n.addGeometry(s),b=n.addGeometry(m),l=new R(o),d=0,c=null;if(n.hasCurves()){c=new L;let u=n.getEnvelope2D(o);d=w(t.total());let p=v(t.total(),u);G(n,p,t.total(),12e3,c,null,o)}n.dbgVerifyCurves(),l.setEditShapeCrackAndCluster(n,t),l.cut(!1,h,x,b,e),c!==null&&c.stitchCurves(n,P,d,!0);let a=n.getGeometry(x),y=new f,k=new f,I=[];for(let u=0;u<e.length;u++){let p=null;{let i=new E,A=i.addGeometry(a),D=i.addGeometry(n.getGeometry(e[u]));if(i.hasCurves()){let U=i.getEnvelope2D(o);d=w(t.total());let M=v(t.total(),U);G(i,M,t.total(),12e3,c,null,o)}l.setEditShapeCrackAndCluster(i,t);let S=l.intersection(A,D);if(c!==null&&c.stitchCurves(i,P,d,!0),p=i.getGeometry(S),p.isEmpty())continue;let T=n.getGeometryUserIndex(e[u],h);T===2?y.add(p,!1):T===1?k.add(p,!1):I.push(p)}{let i=new E,A=i.addGeometry(a),D=i.addGeometry(n.getGeometry(e[u]));if(i.hasCurves()){let T=i.getEnvelope2D(o);d=w(t.total());let U=v(t.total(),T);G(i,U,t.total(),12e3,c,null,o)}l.setEditShapeCrackAndCluster(i,t);let S=l.difference(A,D);c!==null&&c.stitchCurves(i,P,d,!0),a=i.getGeometry(S)}}if(!a.isEmpty()&&e.length>0&&I.push(a),y.isEmpty()&&k.isEmpty())return;if(!y.isEmpty()){let u=_(y,1);r.push(u)}if(!k.isEmpty()){let u=_(k,2);r.push(u)}for(let u=0,p=I.length;u<p;++u){let i=_(I[u],3);r.push(i)}}}var K=class{getOperatorType(){return 10005}accelerateGeometry(s,m,t){return!1}canAccelerateGeometry(s){return!1}supportsCurves(){return!0}execute(s,m,t,r,o){return new j(s,m,t,r,o)}},j=class extends q{constructor(s,m,t,r,o){super(),this.m_cutIndex=-1,this.m_cuts=[],this.m_progressTracker=o,this.m_cuttee=m.clone(),this.m_cutter=new C({copy:t}),this.m_bConsiderTouch=s;let e=B(m,t);this.m_tolerance=F(r,e,!0)}next(){return this.m_cutIndex===-1&&this.generateCuts(),++this.m_cutIndex<this.m_cuts.length?this.m_cuts[this.m_cutIndex]:null}getGeometryID(){return this.m_cutIndex}tock(){return!0}getRank(){return 1}generateCuts(){switch(this.m_cuttee.getGeometryType()){case O.enumPolyline:this.generatePolylineCuts();break;case O.enumPolygon:this.generatePolygonCuts()}}generatePolylineCuts(){let s=new C,m=new C,t=new C;this.m_cuts.length=0,this.m_cuts.push(s),this.m_cuts.push(m);let r=[];N(this.m_bConsiderTouch,this.m_cuttee,this.m_cutter,this.m_tolerance,r,this.m_progressTracker);for(let o=0;o<r.length;o++){let e=r[o];e.m_side===1?s.add(e.m_geometry,!1):e.m_side===2||e.m_side===4?m.add(e.m_geometry,!1):e.m_side===3?this.m_cuts.push(e.m_geometry):e.m_side===0?t.add(e.m_geometry,!1):V("")}t.isEmpty()||s.isEmpty()&&m.isEmpty()&&!(this.m_cuts.length>=3)||this.m_cuts.push(t),s.isEmpty()&&m.isEmpty()&&this.m_cuts.length<3&&(this.m_cuts.length=0)}generatePolygonCuts(){let s=new f,m=new f,t=new f;this.m_cuts.length=0,this.m_cuts.push(s),this.m_cuts.push(m);let r=[];Q(this.m_bConsiderTouch,this.m_cuttee,this.m_cutter,this.m_tolerance,r,this.m_progressTracker);for(let o=0;o<r.length;o++){let e=r[o];e.m_side===1?s.add(e.m_geometry,!1):e.m_side===2?m.add(e.m_geometry,!1):e.m_side===3?this.m_cuts.push(e.m_geometry):e.m_side===0?t.add(e.m_geometry,!1):V("")}z(t.isEmpty()||r.length===1),s.isEmpty()&&m.isEmpty()&&this.m_cuts.length<3&&(this.m_cuts.length=0)}};export{K as a};
