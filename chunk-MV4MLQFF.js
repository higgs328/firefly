import{A as pt,C as mt,a as st,g as at,h as ot,j as nt,p as lt,t as R,u as ht,v as _,w as b,x as w,y as F,z as ct}from"./chunk-5UAVTNPR.js";import{b as ut}from"./chunk-C6XCYNTY.js";import{a as et}from"./chunk-PFQXJNFG.js";import{d as tt,e as ee,j as D,m as rt,q as it}from"./chunk-EB24NRSQ.js";import{a as Ke}from"./chunk-MRKUOXYW.js";import{c as Xe}from"./chunk-2XTO2IAR.js";import{a as T}from"./chunk-FSW536RM.js";import{k as Qe,m as Ye,n as Ze}from"./chunk-VN5FPMRB.js";import{a as Je}from"./chunk-CY62WWD7.js";import{b as g}from"./chunk-QAHTJVUZ.js";import{a as Me,b as je}from"./chunk-T5UBLAP4.js";import{b as ze,k as Be,l as Ve,m as Ne}from"./chunk-DA3NC6W4.js";import{d as $e}from"./chunk-FGABE2LC.js";import{i as ke,k as We}from"./chunk-J5AEP4US.js";import{b as He}from"./chunk-KPT44MCK.js";import{a as X}from"./chunk-VGAXEXH3.js";import{h as K}from"./chunk-YEXMIDOT.js";import{b as L}from"./chunk-37H4LYIE.js";import{b as O}from"./chunk-YQNUGDFH.js";import{a as qe}from"./chunk-QCZ3ZIGQ.js";import{a as Ue}from"./chunk-YHWE4TIZ.js";import{c as Fe,d as Ie}from"./chunk-EFZOSMYP.js";import{n as we}from"./chunk-36M5A2TS.js";import{a as J}from"./chunk-6F25LG6O.js";import{d as Ge,e as Pe}from"./chunk-XLL67PCY.js";import{m as ve}from"./chunk-25WBXAEY.js";import{c as Ee}from"./chunk-5LG2P6MT.js";import{E as Se,F as Y,G as Le,P as _e,j as ge,o as be}from"./chunk-GJ2QRXGN.js";import{b as Re}from"./chunk-E2QKN2KY.js";import{a as u}from"./chunk-RWCIDBNQ.js";import{a as Te}from"./chunk-EM35R6FY.js";import{c as x,i as Z}from"./chunk-HM5RIVQC.js";import{g as Ae}from"./chunk-QXXXCEV5.js";import{n as Oe}from"./chunk-6B5XFA6F.js";import{a as xe,c as De,f as Ce}from"./chunk-PTZYZULI.js";import{a as de}from"./chunk-MDZTV2VL.js";import{h as fe}from"./chunk-RNC4P66O.js";import{a as Q}from"./chunk-OLOKUDVI.js";import{a as A}from"./chunk-BOVYXYHK.js";import{a as $,j as ye}from"./chunk-KVM6SHDX.js";import{d as ue}from"./chunk-NJWTSROP.js";import{a as P}from"./chunk-RAI4DTMT.js";import{a as f}from"./chunk-QGVBCWUY.js";import{a as ce}from"./chunk-JPU2PQZC.js";import{L as me,o as v,p as k,u as W,v as pe}from"./chunk-4PTIEWMT.js";import{f as le,g as he}from"./chunk-XRGPJ3QY.js";import{A as ne,a as se,x as ae,y as oe}from"./chunk-QBWJMFH5.js";import{a as j,b as H,f as m}from"./chunk-VTHXE323.js";var yt=class{constructor(e,t){this.spatialReference=e,this._view=t}getElevation(e,t,r){return this._view.elevationProvider.getElevation(e,t,0,this.spatialReference,r)}queryElevation(e,t,r,i,s){return m(this,null,function*(){return this._view.elevationProvider.queryElevation(e,t,0,this.spatialReference,s,r,i)})}},dt=class{constructor(e,t,r,i){this.spatialReference=t,this._getElevationQueryProvider=r,this._queries=new Array,this._queryOptions=H(j({},i),{ignoreInvisibleLayers:!0}),this._frameTask=e.registerTask(Ge.ELEVATION_QUERY,this)}destroy({completeTasks:e}={completeTasks:!1}){if(this._frameTask.remove(),this.running)if(e)this.runTask(Pe);else for(let t of this._queries)t.result.reject(v())}queryElevation(e,t,r,i=0){let s=me(),a={x:e,y:t,minDemResolution:i,result:s,signal:r};return this._queries.push(a),W(r,()=>{ae(this._queries,a),s.reject(v())}),s.promise}get running(){return this._queries.length>0}runTask(e){let t=this._queries;this._queries=[];let r=this._getElevationQueryProvider();if(!r)return t.forEach(h=>h.result.reject()),void e.madeProgress();let i=t.map(h=>[h.x,h.y]),s=t.reduce((h,c)=>Math.min(h,c.minDemResolution),1/0),a=new de({points:i,spatialReference:this.spatialReference}),n=t.length>1&&t.some(h=>!!h.signal)?new AbortController:null,l=n!=null?n.signal:t[0].signal;if(n!=null){let h=0;t.forEach(c=>W(c.signal,()=>{h++,c.result.reject(v()),h===t.length&&n.abort()}))}let p=H(j({},this._queryOptions),{minDemResolution:s,signal:l});r.queryElevation(a,p).then(h=>{t.forEach((c,N)=>{c.signal!=null&&c.signal.aborted?c.result.reject(v()):c.result.resolve(h.geometry.points[N][2])})}).catch(h=>{t.forEach(c=>c.result.reject(h))}),e.madeProgress()}get test(){}};var S,d;(function(o){o[o.USER=1]="USER",o[o.SCALE_RANGE=2]="SCALE_RANGE",o[o.FILTER=4]="FILTER",o[o.DECONFLICTION=8]="DECONFLICTION",o[o.ALL_GRAPHIC=15]="ALL_GRAPHIC",o[o.ALL_LABEL=255]="ALL_LABEL"})(S||(S={})),function(o){o[o.GRAPHIC=1]="GRAPHIC",o[o.LABEL=16]="LABEL"}(d||(d={}));var I=class{constructor(e,t,r){this.graphic=e,this.renderingInfo=t,this.layer=r}};var U=class extends je{constructor(e,t){super(e,t,new Me(ut,()=>import("./chunk-Y6PLBELF.js")))}initializePipeline(e){let{hudDepth:t,terrainDepthTest:r}=e,i={func:r?Z.ALWAYS:Z.LESS};return Ne(t?{depthTest:i,depthWrite:Be}:{blending:ze(x.ONE,x.SRC_ALPHA,x.ONE_MINUS_SRC_ALPHA,x.ONE_MINUS_SRC_ALPHA),depthTest:i,colorWrite:Ve})}};var y=class extends Je{constructor(e){super(),this.spherical=e,this.screenCenterOffsetUnitsEnabled=!1,this.occlusionTestEnabled=!0,this.hasVerticalOffset=!1,this.hasScreenSizePerspective=!1,this.hudDepth=!1,this.hudDepthAlignStart=!1,this.terrainDepthTest=!1,this.draped=!1}};f([g()],y.prototype,"screenCenterOffsetUnitsEnabled",void 0),f([g()],y.prototype,"occlusionTestEnabled",void 0),f([g()],y.prototype,"hasVerticalOffset",void 0),f([g()],y.prototype,"hasScreenSizePerspective",void 0),f([g()],y.prototype,"hudDepth",void 0),f([g()],y.prototype,"hudDepthAlignStart",void 0),f([g()],y.prototype,"terrainDepthTest",void 0);var E=class extends ke{constructor(e,t){super(e,C),this.produces=new Map([[T.LINE_CALLOUTS,r=>K(r)],[T.LINE_CALLOUTS_HUD_DEPTH,r=>K(r)]]),this._configuration=new y(t),this._uniqueMaterialIdentifier=q(this.parameters)}passParameters(){return this.parameters}getConfiguration(e,t){let r=t.slot===T.LINE_CALLOUTS_HUD_DEPTH;return this._configuration.occlusionTestEnabled=this.parameters.occlusionTest,this._configuration.hasVerticalOffset=this.parameters.verticalOffset!=null,this._configuration.hasScreenSizePerspective=this.parameters.screenSizePerspective!=null,this._configuration.hudDepth=r,this._configuration.hudDepthAlignStart=!!this.parameters.hudDepthAlignStart,this._configuration.screenCenterOffsetUnitsEnabled=this.parameters.centerOffsetUnits==="screen",this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.terrainDepthTest=t.terrainDepthTest,this._configuration}get visible(){return this.parameters.color[3]>=X||(this.parameters.borderColor?.[3]??0)>=X}intersect(){}createGLMaterial(e){return new te(e)}createBufferWriter(){return new re}validateParameters(e){this._uniqueMaterialIdentifier=q(e)}get uniqueMaterialIdentifier(){return this._uniqueMaterialIdentifier}};function q({renderOccluded:o,isDecoration:e,horizontalScreenOffset:t,color:r,size:i,occlusionTest:s,shaderPolygonOffset:a,hudDepthAlignStart:n,centerOffsetUnits:l,hasSlicePlane:p,screenSizePerspective:h,verticalOffset:c,borderColor:N}){return le`${o}:${e}:${t}:[${r}]:${i}:${s}:${a}:${n}:${l}:${p}:${h!=null}:{${c.screenLength}:${c.minWorldLength}:${c.maxWorldLength}}:[${N}]`}var te=class extends $e{beginSlot(e){return this.getTechnique(U,e)}},C=class extends We{constructor(){super(...arguments),this.horizontalScreenOffset=0,this.color=De(0,0,0,1),this.size=1,this.occlusionTest=!1,this.shaderPolygonOffset=1e-5,this.hudDepthAlignStart=!1,this.centerOffsetUnits="world",this.hasSlicePlane=!1}},xt=Re().vec3f(u.POSITION).vec3f(u.NORMAL).vec2f(u.UV0).vec4f(u.CENTEROFFSETANDDISTANCE),ft=[L(0,0),L(1,0),L(0,1),L(1,0),L(1,1),L(0,1)],re=class{constructor(){this.vertexBufferLayout=xt}elementCount(e){return 6*e.get(u.POSITION).indices.length}write(e,t,r,i,s,a){Ye(r.get(u.POSITION),e,s.position,a,6),Ze(r.get(u.NORMAL),t,s.normal,a,6),Qe(r.get(u.CENTEROFFSETANDDISTANCE),s.centerOffsetAndDistance,a,6);for(let n=0;n<ft.length;++n)s.uv0.setVec(a+n,ft[n])}};var G=class o extends ct{constructor(e,t){super(e,null,t,Gt),this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1},this.ensureDrapedStatus(!1)}doLoad(){return m(this,null,function*(){this._materials[0]=new E(this._materialParameters,this._context.spherical),this._context.stage.add(this._materials[0])})}destroy(){super.destroy(),this._context.stage.remove(this._materials[0]),this._materials.length=0}_perInstanceMaterialParameters(e){let t=this._materialParameters;return t.horizontalScreenOffset=e.horizontalScreenOffset??0,t.centerOffsetUnits=e.centerOffsetUnits||"world",t}get _materialParameters(){let e=new C,t=this.symbol,r=t.callout;if(r.color){let a=J.toUnitRGBA(r.color);a[3]*=this._getLayerOpacity(),e.color=a}else e.color=Ce;if(e.size=Q(r.size||0),t.verticalOffset){let{screenLength:a,minWorldLength:n,maxWorldLength:l}=t.verticalOffset;e.verticalOffset={screenLength:Q(a),minWorldLength:n||0,maxWorldLength:l??1/0}}e.borderColor=r.border?.color!=null?J.toUnitRGBA(r.border.color):null;let i=t.symbolLayers.at(0).type==="object",s=t.type==="label-3d";return e.occlusionTest=!i&&!se("enable-feature:non-occluded-hud"),i&&(e.shaderPolygonOffset=0),e.hudDepthAlignStart=s,e.hasSlicePlane=this._context.slicePlaneEnabled,e.screenSizePerspective=this._context.screenSizePerspectiveEnabled?this._context.sharedResources.screenSizePerspectiveSettings:null,e}_defaultElevationInfoNoZ(){return Ct}createGraphics3DGraphic(e){let t=e.renderingInfo,r=e.graphic,i=this.setGraphicElevationContext(r,new it,t.elevationOffset||0),s=t.symbol,a=this._elevationContext.mode==="on-the-ground"&&(s.type==="cim"||!s.symbolLayers.some(l=>l.type==="object"||l.type==="text"));if(s.type!=="label-3d"&&a||s.type==="point-3d"&&s.symbolLayers.every(l=>l.type==="text"&&!Ie(l)))return null;let n=Ke(r.geometry);return n==null?null:this._createAs3DShape(n,i,t,r.uid)}layerOpacityChanged(){this._materials[0]?.setParameters(this._materialParameters)}layerElevationInfoChanged(e,t,r){let i=this._elevationContext.mode,s=tt(o.elevationModeChangeTypes,r,i);return s!==D.UPDATE||e.forEach(a=>{let n=t(a);n!=null&&this.updateGraphicElevationContext(a.graphic,n)}),s}slicePlaneEnabledChanged(){return this._materials[0]?.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return!0}setGraphicElevationContext(e,t,r=0){return super.setGraphicElevationContext(e,t),t.addOffsetRenderUnits(r),t}updateGraphicElevationContext(e,t){let{elevationContext:r,metadata:i}=t;this.setGraphicElevationContext(e,r,i?.elevationOffset??0),t.needsElevationUpdates=ee(r.mode)}computeComplexity(){return new at({verticesPerFeature:6})}_getOrCreateMaterial(e){let t=this._perInstanceMaterialParameters(e),r=q(t);if(r===this._materials[0]?.uniqueMaterialIdentifier)return{material:this._materials[0],isUnique:!1};if(e.materialCollection!=null){let i=e.materialCollection.get(r);return i==null&&(i=new E(t,this._context.spherical),e.materialCollection.add(r,i)),{material:i,isUnique:!1}}return{material:new E(t,this._context.spherical),isUnique:!0}}_createAs3DShape(e,t,r,i){let s=this._context.layer.uid,a=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:i,layerUid:s}),n=this._getOrCreateMaterial(r),l=new Xe(n.material,Dt(r),null,He.Point,a),p=pt(this._context,e,l,t,i);if(p==null)return null;let h=new R(this,p.object,[l],n.isUnique?[n.material]:null,null,lt,t);return h.metadata=new ht(r.elevationOffset),h.alignedSampledElevation=p.sampledElevation,h.needsElevationUpdates=ee(t.mode),mt(h,e,this._context.elevationProvider),h}};function Dt(o){let{translation:e,centerOffset:t}=o,r=new O(e?[e[0],e[1],e[2]]:[0,0,0],ie,3,!0),i=new O(t?[t[0],t[1],t[2],t[3]]:[0,0,0,1],ie,4,!0);return[[u.POSITION,r],[u.NORMAL,new O([0,0,1],ie,3,!0)],[u.CENTEROFFSETANDDISTANCE,i]]}G.elevationModeChangeTypes={definedChanged:D.UPDATE,staysOnTheGround:D.UPDATE,onTheGroundChanged:D.RECREATE};var ie=[0],Ct={mode:"relative-to-ground",offset:0},Gt={ignoreDrivers:!0,renderPriority:0,renderPriorityStep:1},gt=class extends st{constructor(e,t,r=A(),i=xe(),s=0,a="world",n=0,l=null){super(e,t),this.translation=r,this.centerOffset=i,this.horizontalScreenOffset=s,this.centerOffsetUnits=a,this.elevationOffset=n,this.materialCollection=l}},bt=class extends I{};var St=()=>he.getLogger("esri.views.3d.layers.graphics.Graphics3DCalloutSymbolLayerFactory");function Ur(o,e){if(!Fe(o))return St().error("Graphics3DCalloutSymbolLayerFactory#make",`symbol of type '${o.type}' does not support callouts`),null;if(!o.callout)return null;let t=Pt[o.callout.type];return t?new t(o,e):(St().error("Graphics3DCalloutSymbolLayerFactory#make",`unknown or unsupported callout type ${o.callout.type}`),null)}var Pt={line:G};var Lt=class{constructor(e,t){this.scheduler=e,this.schedule=t,this.sharedResources=null,this.streamDataRequester=null,this.elevationProvider=null,this.renderer=null,this.stage=null,this.clippingExtent=null,this.renderCoordsHelper=null,this.overlaySR=null,this.layer=null,this.drapeSourceRenderer=null,this.graphicsCoreOwner=null,this.localOriginFactory=null,this.featureExpressionInfoContext=null,this.screenSizePerspectiveEnabled=!0,this.slicePlaneEnabled=!1,this.physicalBasedRenderingEnabled=!1,this.skipHighSymbolLods=!1,this.isAsync=!1}get spherical(){return this.stage.view.state.viewingMode===qe.Global}get doublePrecisionRequiresObfuscation(){return this.stage.renderView.renderingContext.driverTest.doublePrecisionRequiresObfuscation.result}},M=class{constructor(){this.renderPriority=0,this.renderPriorityStep=1,this.ignoreDrivers=!1}};var _t=new ce(Array,o=>Se(o,_e),null,10,5),At=$(),z=class{get labelLayers(){return this._labelLayers||ne}get extent(){return this._extent}get isElevationSource(){return this.layers.some(e=>e?.isElevationSource)}constructor(e,t,r,i,s){this.graphic=e,this.graphics3DSymbol=t,this.layers=r,this._visibleFlags=S.ALL_LABEL,this.deconflictionPriority=0,++t.referenced,this._featureExpressionFeature=s?rt(s,e,i):null}initialize(e){this._layer=e,this._forEachSymbolLayerGraphic(t=>{t.initialize(e),t.setVisibility(this.isVisible())})}destroy(){this._forEachSymbolLayerGraphic(e=>e.destroy()),this._calloutLayer=null,--this.graphics3DSymbol.referenced,this.graphics3DSymbol=null}get destroyed(){return this.layers==null}clearLabelGraphics(){this._forEachLabelGraphic(e=>e.destroy()),this._labelLayers=null}addLabelGraphic(e,t){this._labelLayers||(this._labelLayers=new Array),this._labelLayers.push(e),e.initialize(t),e.setVisibility(this.isVisible(d.LABEL))}setCalloutGraphic(e){this._calloutLayer=e,this._layer&&(e.initialize(this._layer),e.setVisibility(this.isVisible()))}get calloutLayer(){return this._calloutLayer}get isDraped(){let e=!1;return this._forEachSymbolLayerGraphic(t=>{t.type==="draped"&&(e=!0)}),e}isVisible(e=d.GRAPHIC,t){let r=t?this._visibleFlags|t|d.LABEL*t:this._visibleFlags;return e===d.GRAPHIC?(r&S.ALL_GRAPHIC)===S.ALL_GRAPHIC:(r&S.ALL_LABEL)===S.ALL_LABEL}setVisibilityFlag(e,t,r){let i=this.isVisible(e);r?this._visibleFlags|=e*t:this._visibleFlags&=~(e*t);let s=this.isVisible(e);if(i===s)return!1;if(e===d.LABEL)this._forEachLabelGraphic(a=>a.setVisibility(s));else{this._forEachSymbolLayerGraphic(n=>n.setVisibility(s));let a=this.isVisible(d.LABEL);this._forEachLabelGraphic(n=>n.setVisibility(a))}return!0}getVisibilityFlag(e,t){return!!(this._visibleFlags&e*t)}computeExtent(e){if(!this._extent){let t=this.graphic.geometry;if(t==null)return!1;this._extent=$(),we(t,this._extent);let r=t.spatialReference;if(!ue(r,e)&&!et(this._extent,r,this._extent,e))return this._extent=null,!1}return!0}getAsOptimizedGeometry(e,t){return this._optimizedGeometry||(this._optimizedGeometry=this._convertGraphicToOptimizedGeometry(this.graphic,e,t)),this._optimizedGeometry}_convertGraphicToOptimizedGeometry(e,t,r){let i=e.geometry;return i.type!=="mesh"&&i.type!=="extent"||(i=fe.fromExtent(i.type==="mesh"?i.extent:i)),ve(i,t,r)}get usedMemory(){let e=Ee(this.graphic.attributes);return this._forEachSymbolLayerGraphic(t=>e+=t.graphics3DSymbolLayer.usedMemory),e}computeAttachmentOrigin(){let e={render:{origin:A(),num:0},draped:{origin:Te(),num:0}};for(let t of this.layers)t?.computeAttachmentOrigin(e);return e.render.num>1&&Oe(e.render.origin,e.render.origin,1/e.render.num),e.draped.num>1&&Ae(e.draped.origin,e.draped.origin,1/e.draped.num),e}getProjectedBoundingBox(e,t,r,i,s){return m(this,null,function*(){return s||(s={boundingBox:null,requiresDrapedElevation:!1,screenSpaceObjects:[]}),s.boundingBox?Y(s.boundingBox):s.boundingBox=Y(),s.requiresDrapedElevation=!1,yield P(this.layers,a=>m(this,null,function*(){if(a==null)return;let n=a.type==="draped"?t:e,l=_t.acquire(),p=yield a.getProjectedBoundingBox(n,r,s.screenSpaceObjects,i,l);isFinite(p[2])&&isFinite(p[5])||(s.requiresDrapedElevation=!0),p&&ge(s.boundingBox,l),_t.release(l)})),be(s.boundingBox)||ye(Le(s.boundingBox,At))?s:null})}needsElevationUpdates(){for(let e of this.layers)if(e!=null&&(e.type==="object3d"||e.type==="lod-instance")&&e.needsElevationUpdates)return!0;return this._labelLayers?.some(e=>e?.needsElevationUpdates??!1)??!1}alignWithElevation(e,t,r){this._forEachRenderedGraphic(i=>{i.type!=="object3d"&&i.type!=="lod-instance"||i.alignWithElevation(e,t,this._featureExpressionFeature,r)})}alignWithAbsoluteElevation(e,t,r){this._forEachRenderedGraphic(i=>{i.type==="object3d"&&i.alignWithAbsoluteElevation(e,t,r)})}addObjectStateSet(e){this._forEachSymbolLayerGraphic(t=>t.addObjectState(e))}removeObjectState(e){this._forEachSymbolLayerGraphic(t=>t.removeObjectState(e))}updateHighlights(e){this._forEachSymbolLayerGraphic(t=>t.updateHighlights(e))}_forEachGraphicList(e,t){e?.forEach(r=>r&&t(r))}_forEachSymbolLayerGraphic(e){this._forEachGraphicList(this.layers,e),this._calloutLayer&&e(this._calloutLayer)}_forEachLabelGraphic(e){this._forEachGraphicList(this.labelLayers,e)}_forEachRenderedGraphic(e){this._forEachSymbolLayerGraphic(e),this._forEachLabelGraphic(e)}get test(){}};function B(o){return 2216+4096*o.symbolLayers.length+o.complexity.memory.resourceBytes}var Et=class extends w{set symbol(e){this._symbol=e,e.symbolLayers.forEach((t,r)=>{let i=this.symbolLayers[r];i!=null&&(i.symbol=e,i.symbolLayer=t)})}get symbol(){return this._symbol}constructor(e,t,r){super(t.schedule),this._symbol=e,this._context=t,this._backgroundLayers=r,this._destroyed=!1,this.symbolLayers=new Array,this.referenced=0,this._extentPadding=0}doLoad(e){return m(this,null,function*(){let t=this._symbol.symbolLayers;this._extentPadding=0,this._backgroundLayers&&(t=this._backgroundLayers.concat(t));let r=t.length;for(;this.symbolLayers.length<t.length;)this.symbolLayers.push(null);this.symbolLayers.length=t.length;let i=[],{make:s}=yield import("./chunk-WQZTAWWQ.js");for(let a=0;a<r;a++){let n=t.at(a);if(n.enabled===!1)continue;V.renderPriority=1-(1+a)/r,V.renderPriorityStep=1/r,V.ignoreDrivers=n.ignoreDrivers;let l=s(this.symbol,n,this._context,V),p=pe(e,()=>{this.symbolLayers[a]=null,l.destroy()});p&&i.push(p),this.symbolLayers[a]=l}if(yield P(this.symbolLayers,(a,n)=>m(this,null,function*(){if(a!=null)try{yield a.load(),this._extentPadding+=Math.max(this._extentPadding,a.extentPadding)}catch{this.symbolLayers[n]=null}})),i.forEach(a=>a.remove()),k(e),this.symbolLayers.length&&!this.symbolLayers.some(a=>!!a))throw new Error})}getSymbolLayerSize(e){let t=this.symbolLayers[e];return t!=null?t.getCachedSize():null}get extentPadding(){return this._extentPadding}get symbologySnappingSupported(){return this.symbolLayers.some(e=>e?.queryForSnapping)}updateFocus(e,t){this.symbolLayers.forEach(r=>r?.updateFocus(e,t))}createGraphics3DGraphic(e,t){let r=e.graphic,i=this.symbolLayers.map(a=>a?.createGraphics3DGraphic(e)??null),s=this._context.arcade||this._context.featureExpressionInfoContext?.arcade?.modules||null;return new z(r,t||this,i,e.layer,s)}get complexity(){return nt(this.symbolLayers.map(e=>e!=null?e.complexity:null))}globalPropertyChanged(e,t){let r=this.symbolLayers.length;for(let i=0;i<r;i++){let s=this.symbolLayers[i],a=n=>{let l=n.layers[i];return l instanceof R?l:null};if(s!=null&&!s.globalPropertyChanged(e,t,a))return!1}return!0}applyRendererDiff(e,t){return this.loadStatus!==F.LOADED?_.RecreateSymbol:this.symbolLayers.reduce((r,i)=>r!==_.RecreateSymbol&&i!=null?Math.min(r,i.applyRendererDiff(e,t)):r,_.FastUpdate)}prepareSymbolPatch(e){if(this.loadStatus===F.FAILED||e.diff.type!=="partial")return;let t=e.diff.diff;if(!t.symbolLayers||t.symbolLayers.type!=="partial")return;let r=t.symbolLayers.diff;this.symbolLayers.forEach((i,s)=>{if(i==null)return;let a=r[s];if(a){let n={diff:a,graphics3DGraphicPatches:[],symbolLayerStatePatches:[]};i.prepareSymbolLayerPatch(n),e.symbolStatePatches.push(...n.symbolLayerStatePatches),n.graphics3DGraphicPatches.length&&e.graphics3DGraphicPatches.push((l,p)=>{let h=l.layers[s];h!=null&&n.graphics3DGraphicPatches.forEach(c=>c(h,p))})}})}updateGeometry(e,t){return this._updateGeometryOrTransform(e,(r,i)=>r.updateGeometry(i,t))}updateTransform(e,t,r,i){return this._updateGeometryOrTransform(e,(s,a)=>s.updateTransform(a,t,r,i))}_updateGeometryOrTransform(e,t){for(let r=0;r<this.symbolLayers.length;r++){let i=this.symbolLayers[r];if(i==null)continue;let s=e.layers[r];if(!s||!t(i,s))return!1}return!0}onRemoveGraphic(e){for(let t=0;t<this.symbolLayers.length;t++){let r=this.symbolLayers[t];if(r==null)continue;let i=e.layers[t];i!=null&&r.onRemoveGraphic(i)}}getFastUpdateStatus(){let e=!1,t=!1;for(let r of this.symbolLayers)if(r!=null){if(r.loadStatus===F.LOADING)return b.Loading;r.isFastUpdatesEnabled()?t=!0:e=!0}return t?e?b.Mixed:b.Fast:e?b.Slow:b.Undefined}queryForSnapping(e,t,r,i){return m(this,null,function*(){let s=this.symbolLayers.filter(oe).filter(n=>n.queryForSnapping!=null).map(n=>n.queryForSnapping(e,t,r,i)),a=yield Promise.all(s);return k(i),a.flat()})}destroy(){if(!this.destroyed){super.destroy();for(let e of this.symbolLayers)e?.destroy();this.symbolLayers.length=0,this._destroyed=!0}}get destroyed(){return this._destroyed}get cachedMemory(){return B(this)}},V=new M;var vt=class extends w{constructor(e,t,r){super(t),this.symbol=e,this._convert=r,this.symbologySnappingSupported=!1,this.graphics3DSymbol=null,this.referenced=0}getSymbolLayerSize(e){return this.graphics3DSymbol!=null?this.graphics3DSymbol.getSymbolLayerSize(e):null}get symbolLayers(){return this.graphics3DSymbol!=null?this.graphics3DSymbol.symbolLayers:[]}get extentPadding(){return this.graphics3DSymbol!=null?this.graphics3DSymbol.extentPadding:0}doLoad(e){return m(this,null,function*(){let t=yield this.symbol.fetchSymbol({signal:e,acceptedFormats:Ue});t.id=this.symbol.id,this.graphics3DSymbol=this._convert(t),this.graphics3DSymbol!=null&&(yield this.graphics3DSymbol.load())})}createGraphics3DGraphic(e){return this.graphics3DSymbol!=null?this.graphics3DSymbol.createGraphics3DGraphic(e,this):null}get complexity(){return this.graphics3DSymbol!=null?this.graphics3DSymbol.complexity:ot}globalPropertyChanged(e,t){return this.graphics3DSymbol!=null&&this.graphics3DSymbol.globalPropertyChanged(e,t)}applyRendererDiff(e,t){return this.graphics3DSymbol!=null?this.graphics3DSymbol.applyRendererDiff(e,t):_.RecreateSymbol}prepareSymbolPatch(e){this.graphics3DSymbol!=null&&this.graphics3DSymbol.prepareSymbolPatch(e)}updateGeometry(e,t){return this.graphics3DSymbol!=null&&this.graphics3DSymbol.updateGeometry(e,t)}updateTransform(e,t,r,i){return this.graphics3DSymbol?.updateTransform(e,t,r,i)??!1}onRemoveGraphic(){}updateFocus(e,t){}getFastUpdateStatus(){return this.graphics3DSymbol?.getFastUpdateStatus()??b.Loading}destroy(){this.graphics3DSymbol!=null&&this.graphics3DSymbol.destroy(),this.graphics3DSymbol=void 0,super.destroy()}get destroyed(){return this.graphics3DSymbol===void 0}get cachedMemory(){return B(this)}};export{yt as a,dt as b,S as c,d,I as e,Lt as f,gt as g,bt as h,Ur as i,Et as j,vt as k};
