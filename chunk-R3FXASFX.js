import{a as v}from"./chunk-Y6AUTJNM.js";import{a as w}from"./chunk-HB42CTAY.js";import{p as V,v as _}from"./chunk-PKVI3POI.js";import{m as C}from"./chunk-Y4PJQPM4.js";import{B as h,g as A}from"./chunk-XR5FT7TQ.js";import{a as c,c as f,j as b}from"./chunk-TG45K3WR.js";import{a as r}from"./chunk-QGVBCWUY.js";import{e as i}from"./chunk-NFIPKH6V.js";import{l as m}from"./chunk-5QEXLALV.js";var L=3,t=class extends v{constructor(e){super(e),this._relationshipVM=null,this.group=null,this.type="relationship",this.addHandles([c(()=>({feature:this.feature,element:this.element,layer:this.layer}),l=>this._createRelationshipVM(l),b),f(()=>this.relatedLayer,"edits",()=>this._relationshipVM?.refresh())])}destroy(){this._relationshipVM?.destroy()}get canAddRelatedFeature(){let{editable:e,featureCount:l,relationship:a}=this;if(!a||!this.loaded||!this.relatedLayerAllowsAdds||this.allCategories?.length&&!this.activeCategory)return!1;let{cardinality:o,role:s}=a;return!(o==="one-to-one"&&l>0)&&o!=="many-to-many"&&!(o==="one-to-many"&&s==="destination"&&l>0)&&e}get activeCategory(){return this._relationshipVM?.activeCategory}set activeCategory(e){let l=this._relationshipVM;l&&(l.activeCategory=e)}get allCategories(){let{relatedLayer:e}=this,l=this._relationshipVM?.categories;if(!A(e))return;let a=(e.subtypes??[]).map(({code:o,name:s})=>{let n=l?.find(p=>p.name===s);return{name:s,count:n?.count??0,value:n?.value??o}});return a.length?a:null}get categories(){return this.showAllEnabled?this.allCategories:this.allCategories?.slice(0,this.displayCount)}get displayCount(){return this.element.displayCount??L}get displayType(){return this.element.displayType}get editable(){return!!this.relatedLayerAllowsEdits&&(this.evaluatedEditableExpression??!0)}get featureCount(){return this._relationshipVM?.featureCount??0}get label(){return this.activeCategory?.name?this.activeCategory.name:this.getFormattedLabel(this.element?.label)}get loaded(){return this._relationshipVM?.state!=="loading"}get map(){return this._get("map")}set map(e){e&&this._relationshipVM?.set("map",e),this._set("map",e)}get orderByFields(){return this.element.orderByFields}get originHasValidKey(){return!(!this.relationship||!this.feature.getAttribute(this.relationship.keyField))}get relationship(){return this._relationshipVM?.relationship}get relationshipId(){return this.element.relationshipId}get relatedFeatureInfos(){let{_relationshipVM:e,timeZone:l}=this;if(!e?.relatedFeatures?.length||!e?.relatedLayer)return[];let{itemDescriptionFieldName:a,relatedFeatures:o,relatedLayer:s}=e,n=s&&"formTemplate"in s&&s.formTemplate?s.formTemplate.title:void 0;return o.map(p=>{let d;if(a){let u=p.getAttribute(a),y=s.fieldsIndex.get(a);if(y){let g=_({values:[u],fields:[y],timeZone:l??void 0})[a];g!=null&&(d=g.toString())}}return{feature:p,description:d,title:n?V({label:n,attributes:p.attributes,fieldsIndex:s.fieldsIndex,timeZone:l}):void 0}}).toArray()}get relatedLayer(){return this._relationshipVM?.relatedLayer}get relatedLayerIsTable(){return!!this.relatedLayer?.isTable}get relatedLayerAllowsAdds(){let{relatedLayer:e}=this;return!e||!this.relatedLayerAllowsEdits?!1:!!h(e)?.operations?.supportsAdd}get relatedLayerAllowsEdits(){let{relatedLayer:e}=this;return e?!!h(e)?.operations?.supportsEditing:!1}get showAllEnabled(){return this._get("showAllEnabled")}set showAllEnabled(e){this._relationshipVM?.set("showAllEnabled",e),this._set("showAllEnabled",e)}get showAllActionVisible(){return!this.showAllEnabled&&this.featureCount>0&&this.featureCount>this.displayCount}get showAllCategoriesVisible(){let e=this.allCategories?.length??0;return!this.showAllEnabled&&e>0&&e>this.displayCount}get visible(){let{relationship:e}=this;if(!e)return!1;let{cardinality:l}=e;return l!=="many-to-many"&&(this.evaluatedVisibilityExpression!=null?this.evaluatedVisibilityExpression:this.element!=null)}get updating(){return this._relationshipVM?.state==="loading"||this._relationshipVM?.state==="querying"}incrementPage(){this._relationshipVM&&this._relationshipVM.featurePage++}getRelatedFeatureByObjectId(e){return this._relationshipVM?.getRelatedFeatureByObjectId(e)}_createRelationshipVM(e){let{feature:l,element:a,layer:o}=e;if(this._relationshipVM?.destroy(),!l||!a||!o)return;let{displayCount:s,map:n,orderByFields:p,relationshipId:d,showAllEnabled:u}=this;C(o)&&(this._relationshipVM=new w({graphic:l,displayCount:s,layer:o,map:n,orderByFields:p,relationshipId:d,showAllEnabled:u}))}};r([i()],t.prototype,"_relationshipVM",void 0),r([i()],t.prototype,"canAddRelatedFeature",null),r([i()],t.prototype,"activeCategory",null),r([i()],t.prototype,"allCategories",null),r([i()],t.prototype,"categories",null),r([i()],t.prototype,"displayCount",null),r([i()],t.prototype,"displayType",null),r([i()],t.prototype,"editable",null),r([i()],t.prototype,"featureCount",null),r([i()],t.prototype,"group",void 0),r([i()],t.prototype,"label",null),r([i()],t.prototype,"loaded",null),r([i()],t.prototype,"map",null),r([i()],t.prototype,"orderByFields",null),r([i()],t.prototype,"originHasValidKey",null),r([i()],t.prototype,"relationship",null),r([i()],t.prototype,"relationshipId",null),r([i()],t.prototype,"relatedFeatureInfos",null),r([i()],t.prototype,"relatedLayer",null),r([i()],t.prototype,"relatedLayerIsTable",null),r([i()],t.prototype,"relatedLayerAllowsAdds",null),r([i()],t.prototype,"relatedLayerAllowsEdits",null),r([i()],t.prototype,"showAllEnabled",null),r([i()],t.prototype,"showAllActionVisible",null),r([i()],t.prototype,"showAllCategoriesVisible",null),r([i({readOnly:!0})],t.prototype,"type",void 0),r([i()],t.prototype,"visible",null),r([i()],t.prototype,"updating",null),t=r([m("esri.widgets.FeatureForm.RelationshipInput")],t);var j=t;export{j as a};
