import{a as te}from"./chunk-EBIFNV2H.js";import{a as W}from"./chunk-MGGSCSBE.js";import{a as re,b as oe,c as se,d as T}from"./chunk-Z6BYFM7E.js";import{a as w}from"./chunk-CFRDSUTM.js";import{a as X,b as Y,c as Z,d as N,e as ee}from"./chunk-FB4M3WPV.js";import{a as K}from"./chunk-SLAWDKDA.js";import{a as G}from"./chunk-4N4D2YQX.js";import{a as Q}from"./chunk-G4DZJMGT.js";import{b as V}from"./chunk-UST6HCE7.js";import{f as B}from"./chunk-WFKZLI6F.js";import{a as S,b as q,k as J}from"./chunk-TG45K3WR.js";import{a as U}from"./chunk-T7DXJKX7.js";import{a as p}from"./chunk-QGVBCWUY.js";import{C as z}from"./chunk-MYO4NP2N.js";import{e as m}from"./chunk-NFIPKH6V.js";import{l as M}from"./chunk-5QEXLALV.js";import{i as H}from"./chunk-LI2SX4T6.js";import{K as D,b as C,k as x,l as $,t as L}from"./chunk-4PTIEWMT.js";import{g as j}from"./chunk-XRGPJ3QY.js";import{b as O}from"./chunk-2LI2GKBQ.js";import{a as v,f as E}from"./chunk-VTHXE323.js";var ie={handleInterceptedEvent:(e,t,o,r)=>(e.scheduleRender(),t.properties[`on${r.type}`].apply(t.properties.bind||o,[r]))};var fe={namespace:void 0,performanceLogger:()=>{},eventHandlerInterceptor:void 0,styleApplyer:(e,t,o)=>{t.charAt(0)==="-"?e.style.setProperty(t,o):e.style[t]=o}},ne=e=>v(v({},fe),e);var ge=(e,t)=>{let o=[];for(;e&&e!==t;)o.push(e),e=e.parentNode;return o},ve=(e,t)=>e.find(t),ae=(e,t,o=!1)=>{let r=e;return t.forEach((c,n)=>{let h=r?.children?ve(r.children,i=>i.domNode===c):void 0;o&&!h&&n!==t.length-1||(r=h)}),r},de=e=>{let t,o=v(v({},ie),e),r=ne(o),c=r.performanceLogger,n,h=!0,i=!1,s=[],u=[],f=(l,a,P)=>{let y;r.eventHandlerInterceptor=(we,Pe,Re,Ee)=>function(_){let R;c("domEvent",_);let I=ge(_.currentTarget,y.domNode),me=I.some(b=>customElements.get(b?.tagName?.toLowerCase()));if(_.eventPhase===Event.CAPTURING_PHASE||!me)I.reverse(),R=ae(y.getLastRender(),I);else{let b=_.composedPath(),ue=b.slice(b.indexOf(_.currentTarget),b.indexOf(y.domNode)).reverse();R=ae(y.getLastRender(),ue,!0)}let k;return R&&(k=o.handleInterceptedEvent(t,R,this,_)),c("domEventProcessed",_),k},o.postProcessProjectionOptions?.(r);let F=P();y=l(a,F,r),r.eventHandlerInterceptor=void 0,s.push(y),u.push(P),o.afterFirstVNodeRendered&&o.afterFirstVNodeRendered(y,F)},g=()=>{if(n=void 0,h){h=!1,c("renderStart",void 0);for(let l=0;l<s.length;l++){let a=u[l]();c("rendered",void 0);try{s[l].update(a)}catch(P){console.error(P)}c("patched",void 0)}c("renderDone",void 0),h=!0}};return o.modifyDoRenderImplementation&&(g=o.modifyDoRenderImplementation(g,s,u)),t={renderNow:g,scheduleRender:()=>{n||i||(n=requestAnimationFrame(g))},stop:()=>{n&&(cancelAnimationFrame(n),n=void 0),i=!0},resume:()=>{i=!1,h=!0,t.scheduleRender()},append:(l,a)=>{f(w.append,l,a)},insertBefore:(l,a)=>{f(w.insertBefore,l,a)},merge:(l,a)=>{f(w.merge,l,a)},replace:(l,a)=>{f(w.replace,l,a)},detach:l=>{for(let a=0;a<u.length;a++)if(u[a]===l)return u.splice(a,1),s.splice(a,1)[0];throw new Error("renderFunction was not found")}},t};var le=new Set;function ce(e){le.add(e),e.finally(()=>le.delete(e))}var he,ye="esri.widgets.Widget",_e=0;function pe(e,t){let o=Object.prototype.hasOwnProperty;for(let r in t)o.call(t,r)&&o.call(e,r)&&(e[r]!=null&&t[r]!=null&&typeof e[r]=="object"&&typeof t[r]=="object"?pe(e[r],t[r]):e[r]=t[r]);return e}var be=de({postProcessProjectionOptions(e){let t=e.eventHandlerInterceptor,o=/capture$/i;e.eventHandlerInterceptor=(r,c,n,h)=>{let i=t?.(r,c,n,h),s=o.test(r);if(!((r=r.replace(o,"")).toLowerCase()in n)||s){let u=r[2].toLowerCase()+r.slice(3),f=a=>i?.call(n,a);n.addEventListener(u,f,s);let g=()=>n.removeEventListener(u,f,s),l=h.afterRemoved;h.afterRemoved=a=>{l?.(a),g()}}return i}},handleInterceptedEvent(e,t,o,r){let{eventPhase:c,type:n}=r,h=c===Event.CAPTURING_PHASE,i=`on${n}${h?"capture":""}`,s=t.properties;(s&&i in s||(i=`on${n[0].toUpperCase()}${n.slice(1)}${h?"Capture":""}`,s&&i in s))&&(X(),e.scheduleRender(),s[i].call(s.bind||o,r))}}),A=!1,d=class extends G.EsriPromiseMixin(U.EventedAccessor){constructor(e,t){super(e,t),this._attached=!1,this._projector=be,this._readyForTrueRender=!1,this.key=this,this.autoRenderingEnabled=!0,this._loadLocale=D(()=>E(this,null,function*(){if(this._messageBundleProps?.length){let i=yield Promise.allSettled(this._messageBundleProps.map(f=>E(this,[f],function*({bundlePath:s,propertyName:u}){if(this.destroyed)return;let g=yield V(s);this.uiStrings&&Object.keys(this.uiStrings)&&(g=pe(O(g),this.uiStrings)),this[u]=g})));if(this.destroyed)return;for(let s of i)s.status==="rejected"&&j.getLogger(this).error("widget-intl:locale-error",this.declaredClass,s.reason)}yield this.loadLocale()})),te();let o="esri-widget-uid-"+K(),r=this.render.bind(this);this._trackingTarget=new z(()=>{this.autoRenderingEnabled&&this.scheduleRender()});let c=()=>({vnodeSelector:"div",properties:{key:`${o}-hidden`,class:"",styles:{display:"none"}},domNode:null,children:void 0,text:void 0}),n=()=>{if(!this._readyForTrueRender||this.destroyed)return null;let i=r()??c(),s=i.properties??={};if(s.key??=o,T(i.vnodeSelector)){if(!this.visible)return c()}else this.visible?s.styles||(s.styles={}):(s.class="",s.styles={display:"none"}),s.styles.display??="";let u=0;return i.children?.forEach(f=>{T(f.vnodeSelector)||(f.properties??={},f.properties.key??=`${this.id}--${u++}`)}),se(this,i)};this.render=()=>{if(A)return n();let i=Y(this)??null;if(i)return i;this._trackingTarget.clear(),A=!0;try{i=H(this._trackingTarget,n)}catch(s){throw j.getLogger(this).error(s),s}finally{A=!1}return i&&Z(this,i),i};let h=this.beforeFirstRender();h?this._resourcesFetch=h.then(()=>{this._readyForTrueRender=!0,this._postInitialize()}):(this._resourcesFetch=Promise.resolve().then(()=>{this._postInitialize()}),this._readyForTrueRender=!0),this.addResolvingPromise(this._resourcesFetch),ce(this._resourcesFetch)}normalizeCtorArgs(e,t){let o=v({},e);return t&&(o.container=t),o}postInitialize(){}beforeFirstRender(){let e=this.loadDependencies();return this._messageBundleProps?.length||e?Promise.all([e,this._loadLocale()]).then(()=>{}).catch(L):null}loadDependencies(){return null}loadLocale(){return null}destroy(){this.destroyed||(C(this._trackingTarget),C(this.viewModel),this._detach(this.container),this._set("container",null),this._emitter.clear(),this.render=()=>null,this._projector=null,N(this))}set container(e){this._get("container")||this._set("container",e)}castContainer(e){return W(e)}get domNode(){return this.container}set domNode(e){this.container=e}get icon(){return null}set icon(e){this._overrideIfSome("icon",e)}get id(){return this._get("id")||this.container?.id||Date.now().toString(16)+"-widget-"+_e++}set id(e){e&&this._set("id",e)}get label(){return this.declaredClass.split(".").pop()}set label(e){this._overrideIfSome("label",e)}get renderable(){return this._resourcesFetch}get visible(){return this._get("visible")}set visible(e){this._set("visible",e)}get[(he=re,oe)](){return{projector:this._projector}}render(){throw new Error("not implemented")}scheduleRender(){this.destroyed||(N(this),this._projector.scheduleRender())}classes(...e){return ee.apply(this,e)}renderNow(){N(this),this._projector.renderNow()}_postInitialize(){if(this.destroyed)return;this.scheduleRender(),this._delegatedEventNames?.length&&this.addHandles(S(()=>this.viewModel,(t,o)=>{o&&this.removeHandles("delegated-events"),t&&x(t)&&this.addHandles(this._delegatedEventNames.map(r=>$(t,r,c=>{this.emit(r,c)})),"delegated-events")},J)),this.postInitialize();let e=()=>E(this,null,function*(){yield this._loadLocale().catch(L),this.scheduleRender()});this.addHandles([B(e),S(()=>this.uiStrings,e),q(()=>this.container,t=>{this.destroyed||this._attach(t)},{initial:!0,once:!0})])}_attach(e){e&&(this._projector.merge(e,this.render),this._attached=!0)}_detach(e){this._attached&&(this._projector.detach(this.render),this._attached=!1),e?.parentNode?.removeChild(e)}};d[he]=!0,d.vnodeSelector="div",p([m()],d.prototype,"_readyForTrueRender",void 0),p([m({value:null})],d.prototype,"container",null),p([Q("container")],d.prototype,"castContainer",null),p([m()],d.prototype,"icon",null),p([m()],d.prototype,"id",null),p([m()],d.prototype,"label",null),p([m()],d.prototype,"renderable",null),p([m()],d.prototype,"uiStrings",void 0),p([m()],d.prototype,"viewModel",void 0),p([m({value:!0})],d.prototype,"visible",null),p([m()],d.prototype,"key",void 0),p([m()],d.prototype,"children",void 0),p([m()],d.prototype,"afterCreate",void 0),p([m()],d.prototype,"afterUpdate",void 0),p([m()],d.prototype,"afterRemoved",void 0),d=p([M(ye)],d);var dt=d;export{dt as a};
